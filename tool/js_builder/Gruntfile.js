var fs=require("fs"),amdjsBuild=require("amdjs-build"),TRANS_DIR="./_transport/",COMBI_DIR="./_combi/",AMDJS_BUILD_DIR="./_amdjs_build/",DEST_DIR="./built/",SRC_DIR="../../js/";module.exports=function(s){s.initConfig({pkg:s.file.readJSON("package.json"),clean:{before:[TRANS_DIR,COMBI_DIR,AMDJS_BUILD_DIR,DEST_DIR],after:[TRANS_DIR,COMBI_DIR,AMDJS_BUILD_DIR]},transport:{options:{paths:[SRC_DIR],alias:{jquery:"conf/jquery"},debug:!1},target:{files:[{cwd:SRC_DIR,expand:!0,src:["**/*.js","!conf/requireConf.js","!lib/require.js"],dest:TRANS_DIR}]}},combi:{target:{options:{modulesPath:TRANS_DIR,seajsUse:"",complete:function(s){fs.existsSync(AMDJS_BUILD_DIR)||fs.mkdirSync(AMDJS_BUILD_DIR);s.forEach((function(s){var e;e=s.indexOf("/")>-1?s.split("/").pop():s,amdjsBuild(s,AMDJS_BUILD_DIR+e.replace(/\.js$/,".min.js"),"$AJB")}))}},files:[{cwd:TRANS_DIR,expand:!0,src:"page/*.js",dest:COMBI_DIR}]}},uglify:{options:{report:"min"},target:{files:[{cwd:AMDJS_BUILD_DIR,expand:!0,src:"*.js",dest:DEST_DIR}]}}}),s.loadNpmTasks("grunt-contrib-clean"),s.loadNpmTasks("grunt-cmd-transport"),s.loadNpmTasks("grunt-cmd-combi"),s.loadNpmTasks("grunt-contrib-uglify"),s.registerTask("default","默认任务",(function(){})),s.registerTask("build",["clean:before","transport","combi","uglify","clean:after"])};