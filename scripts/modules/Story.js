var Story=function(){$("#levelSelect");var e,t,r,o=function(){for(var t=0,r=0;r<e.length;++r)"level"==e[r].type&&++t;return t},i=function(o){"instruction"==e[t=o].type?(mediator.publish("overlay_render",e[t]),r.visited_instructions.indexOf(t)<0&&r.visited_instructions.push(t),mediator.publish("cookie_data_save",r)):(mediator.publish("board_render",e[t]),r.played_levels.indexOf(e[t].number)<0&&(r.played_levels.push(e[t].number),r.last_level=e[t].number),mediator.publish("cookie_data_save",r))},s=function(e){return r.visited_instructions.indexOf(e)>=0};return{getStory:function(){$.getJSON("story.json",(function(t){e=t,mediator.publish("story_num_levels",o()),mediator.publish("story_story_loaded")}))},setBookmark:i,setBookmarkAtLevel:function(t){if((r=t).last_level<0)i(0);else for(var o=0;o<e.length;++o){var s=r.last_level;if(e[o].number==s)return void i(o)}},advance:function(){if(t<e.length-1){for(;s(++t)&&t!=e.length-1;);i(t)}}}}();mediator.installTo(Story),mediator.subscribe("story_get_story",Story.getStory),mediator.subscribe("story_set_bookmark_at_level",Story.setBookmarkAtLevel),mediator.subscribe("story_advance",Story.advance),mediator.subscribe("board_level_complete",Story.advance);