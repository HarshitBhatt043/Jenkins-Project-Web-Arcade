var Board=function(){var e,o,t,r,d=[],a=!1,s=-1,i=function(){u(r)},l=function(){$("td.selected").removeClass("selected"),d[r.selected.x][r.selected.y].addClass("selected");for(var o=0;o<r.contents.length;++o){var t=o%3,a=Math.floor(o/3);r.mode.indexOf("b&w")>-1&&("b"==r.colors[o]?(d[t][a].removeClass("white"),d[t][a].addClass("black")):(d[t][a].removeClass("black"),d[t][a].addClass("white")))}(function(){for(var e=c(0,0),o=0;o<3;++o)for(var t=0;t<3;++t)if(c(o,t)!=e)return!1;return!0})()&&(e.fadeOut(options.fade,(function(){mediator.publish("board_level_complete"),mediator.publish("board_faded_out")})),$("#introtutorial").fadeOut(options.fade),mediator.publish("board_fade_out"))};function n(e,o){var t=r.selected;d[t.x][t.y].hasClass("black")?c(t.x,t.y,c(t.x,t.y)-1):c(t.x,t.y,c(t.x,t.y)+1),mediator.publish("selector_snap_to",e,o),mediator.publish("sound_play_tone",c(t.x,t.y))}function c(e,o,t){if(3!=arguments.length)return parseInt(d[e][o].html());d[e][o].html(t)}var u=function(t){mediator.publish("overlay_set_inactive"),"1"==(r=t).number&&$("#introtutorial").show();for(var i=0;i<r.contents.length;++i){var n=i%3,u=Math.floor(i/3);c(n,u,r.contents[i]),r.mode.indexOf("b&w")>-1&&("b"==r.colors[i]?(d[n][u].removeClass("white"),d[n][u].addClass("black")):(d[n][u].removeClass("black"),d[n][u].addClass("white")))}r.selected={x:t.initialSelected.x,y:t.initialSelected.y},o.html("level "+r.number+"/"+s),e.fadeIn(options.fade,(function(){mediator.publish("selector_snap_to",r.selected.x,r.selected.y),mediator.publish("board_faded_in")})),a=!0,mediator.publish("board_fade_in"),l()};return{render:u,up:function(){a&&r.selected.y>0&&(n(r.selected.x,--r.selected.y),l())},down:function(){a&&r.selected.y<2&&(n(r.selected.x,++r.selected.y),l())},left:function(){a&&r.selected.x>0&&(n(--r.selected.x,r.selected.y),l())},right:function(){a&&r.selected.x<2&&(n(++r.selected.x,r.selected.y),l())},reset:i,setNumLevels:function(e){s<0&&(s=e)},setInactive:function(){e.fadeOut(options.fade),a=!1,mediator.publish("board_fade_out")},updateMuteButton:function(e){toggleMuteLink.html(e?"mute":"unmute")},quickHide:function(){e.hide()},quickShow:function(){e.show()},domReady:function(){e=$("#board"),o=$("#level"),$("#overlay"),t=$("#reset");for(var r=0;r<4;++r){d.push([]);for(var a=0;a<4;++a)d[r].push($('td[data-x="'+r+'"][data-y="'+a+'"]'))}t.on("click",i)}}}();mediator.installTo(Board),Board.subscribe("board_render",Board.render),Board.subscribe("board_set_inactive",Board.setNumLevels),Board.subscribe("controls_key_down",Board.down),Board.subscribe("controls_key_left",Board.left),Board.subscribe("controls_key_right",Board.right),Board.subscribe("controls_key_up",Board.up),Board.subscribe("swipe_down_board",Board.down),Board.subscribe("swipe_left_board",Board.left),Board.subscribe("swipe_right_board",Board.right),Board.subscribe("swipe_up_board",Board.up),Board.subscribe("controls_key_r",Board.reset),Board.subscribe("story_num_levels",Board.setNumLevels),Board.subscribe("loader_dom_ready",Board.domReady);