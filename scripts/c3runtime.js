"use strict";function lineInt(e,t,s){var i=[0,0],r=e[1][1]-e[0][1],n=e[0][0]-e[1][0];e=r*e[0][0]+n*e[0][1];var a=t[1][1]-t[0][1],o=t[0][0]-t[1][0];t=a*t[0][0]+o*t[0][1];var h=r*o-a*n;return scalar_eq(h,0,s||0)||(i[0]=(o*e-n*t)/h,i[1]=(r*t-a*e)/h),i}function lineSegmentsIntersect(e,t,s,i){var r=t[0]-e[0];t=t[1]-e[1];var n=i[0]-s[0],a=i[1]-s[1];return 0!=n*t-a*r&&(i=(r*(s[1]-e[1])+t*(e[0]-s[0]))/(n*t-a*r),e=(n*(e[1]-s[1])+a*(s[0]-e[0]))/(a*r-n*t),0<=i&&1>=i&&0<=e&&1>=e)}function triangleArea(e,t,s){return(t[0]-e[0])*(s[1]-e[1])-(s[0]-e[0])*(t[1]-e[1])}function isLeft(e,t,s){return 0<triangleArea(e,t,s)}function isLeftOn(e,t,s){return 0<=triangleArea(e,t,s)}function isRight(e,t,s){return 0>triangleArea(e,t,s)}function isRightOn(e,t,s){return 0>=triangleArea(e,t,s)}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).glMatrix={})}(this,(function(e){function t(e,t,s){var i=t[0],r=t[1],n=t[2];t=t[3];var a=s[0],o=s[1],h=s[2];return s=s[3],e[0]=i*a+n*o,e[1]=r*a+t*o,e[2]=i*h+n*s,e[3]=r*h+t*s,e}function s(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e}function i(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4];t=t[5];var h=s[0],l=s[1],c=s[2],u=s[3],p=s[4];return s=s[5],e[0]=i*h+n*l,e[1]=r*h+a*l,e[2]=i*c+n*u,e[3]=r*c+a*u,e[4]=i*p+n*s+o,e[5]=r*p+a*s+t,e}function r(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e}function n(){var e=new me(9);return me!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function a(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7];t=t[8];var u=s[0],p=s[1],_=s[2],m=s[3],d=s[4],g=s[5],f=s[6],C=s[7];return s=s[8],e[0]=u*i+p*a+_*l,e[1]=u*r+p*o+_*c,e[2]=u*n+p*h+_*t,e[3]=m*i+d*a+g*l,e[4]=m*r+d*o+g*c,e[5]=m*n+d*h+g*t,e[6]=f*i+C*a+s*l,e[7]=f*r+C*o+s*c,e[8]=f*n+C*h+s*t,e}function o(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e[6]=t[6]-s[6],e[7]=t[7]-s[7],e[8]=t[8]-s[8],e}function h(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=t[8],p=t[9],_=t[10],m=t[11],d=t[12],g=t[13],f=t[14];t=t[15];var C=s[0],S=s[1],y=s[2],$=s[3];return e[0]=C*i+S*o+y*u+$*d,e[1]=C*r+S*h+y*p+$*g,e[2]=C*n+S*l+y*_+$*f,e[3]=C*a+S*c+y*m+$*t,C=s[4],S=s[5],y=s[6],$=s[7],e[4]=C*i+S*o+y*u+$*d,e[5]=C*r+S*h+y*p+$*g,e[6]=C*n+S*l+y*_+$*f,e[7]=C*a+S*c+y*m+$*t,C=s[8],S=s[9],y=s[10],$=s[11],e[8]=C*i+S*o+y*u+$*d,e[9]=C*r+S*h+y*p+$*g,e[10]=C*n+S*l+y*_+$*f,e[11]=C*a+S*c+y*m+$*t,C=s[12],S=s[13],y=s[14],$=s[15],e[12]=C*i+S*o+y*u+$*d,e[13]=C*r+S*h+y*p+$*g,e[14]=C*n+S*l+y*_+$*f,e[15]=C*a+S*c+y*m+$*t,e}function c(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,h=r+r,l=n+n;t=i*o;var c=i*h;i*=l;var u=r*h;return r*=l,n*=l,o*=a,h*=a,a*=l,e[0]=1-(u+n),e[1]=c+a,e[2]=i-h,e[3]=0,e[4]=c-a,e[5]=1-(t+n),e[6]=r+o,e[7]=0,e[8]=i+h,e[9]=r-o,e[10]=1-(t+u),e[11]=0,e[12]=s[0],e[13]=s[1],e[14]=s[2],e[15]=1,e}function u(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function p(e,t){var s=t[4],i=t[5],r=t[6],n=t[8],a=t[9],o=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(s,i,r),e[2]=Math.hypot(n,a,o),e}function _(e,t){var s=new me(3);p(s,t);var i=1/s[0],r=1/s[1],n=1/s[2],a=t[0]*i;s=t[1]*r;var o=t[2]*n,h=t[4]*i,l=t[5]*r,c=t[6]*n;return i*=t[8],r*=t[9],0<(n=a+l+(t=t[10]*n))?(a=2*Math.sqrt(n+1),e[3]=.25*a,e[0]=(c-r)/a,e[1]=(i-o)/a,e[2]=(s-h)/a):a>l&&a>t?(a=2*Math.sqrt(1+a-l-t),e[3]=(c-r)/a,e[0]=.25*a,e[1]=(s+h)/a,e[2]=(i+o)/a):l>t?(a=2*Math.sqrt(1+l-a-t),e[3]=(i-o)/a,e[0]=(s+h)/a,e[1]=.25*a,e[2]=(c+r)/a):(a=2*Math.sqrt(1+t-a-l),e[3]=(s-h)/a,e[0]=(i+o)/a,e[1]=(c+r)/a,e[2]=.25*a),e}function m(e,t,s,i,r){return t=1/Math.tan(t/2),e[0]=t/s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&1/0!==r?(s=1/(i-r),e[10]=(r+i)*s,e[14]=2*r*i*s):(e[10]=-1,e[14]=-2*i),e}function d(e,t,s,i,r,n,a){var o=1/(t-s),h=1/(i-r),l=1/(n-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+s)*o,e[13]=(r+i)*h,e[14]=(a+n)*l,e[15]=1,e}function g(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e[6]=t[6]-s[6],e[7]=t[7]-s[7],e[8]=t[8]-s[8],e[9]=t[9]-s[9],e[10]=t[10]-s[10],e[11]=t[11]-s[11],e[12]=t[12]-s[12],e[13]=t[13]-s[13],e[14]=t[14]-s[14],e[15]=t[15]-s[15],e}function f(){var e=new me(3);return me!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function C(e){return Math.hypot(e[0],e[1],e[2])}function S(e,t,s){var i=new me(3);return i[0]=e,i[1]=t,i[2]=s,i}function y(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e}function $(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e[2]=t[2]*s[2],e}function G(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e[2]=t[2]/s[2],e}function I(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function T(e,t){var s=t[0]-e[0],i=t[1]-e[1];return s*s+i*i+(e=t[2]-e[2])*e}function b(e){var t=e[0],s=e[1];return t*t+s*s+(e=e[2])*e}function P(e,t){var s=t[0],i=t[1],r=t[2];return 0<(s=s*s+i*i+r*r)&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function v(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function R(e,t,s){var i=t[0],r=t[1];t=t[2];var n=s[0],a=s[1];return s=s[2],e[0]=r*s-t*a,e[1]=t*n-i*s,e[2]=i*a-r*n,e}function j(){var e=new me(4);return me!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function A(e){var t=new me(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function x(e,t,s,i){var r=new me(4);return r[0]=e,r[1]=t,r[2]=s,r[3]=i,r}function E(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function M(e,t,s,i,r){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e}function w(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e}function D(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e}function O(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e[2]=t[2]*s[2],e[3]=t[3]*s[3],e}function B(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e[2]=t[2]/s[2],e[3]=t[3]/s[3],e}function L(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e}function F(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function k(e,t){var s=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return s*s+i*i+r*r+(e=t[3]-e[3])*e}function N(e){return Math.hypot(e[0],e[1],e[2],e[3])}function V(e){var t=e[0],s=e[1],i=e[2];return t*t+s*s+i*i+(e=e[3])*e}function W(e,t){var s=t[0],i=t[1],r=t[2],n=s*s+i*i+r*r+(t=t[3])*t;return 0<n&&(n=1/Math.sqrt(n)),e[0]=s*n,e[1]=i*n,e[2]=r*n,e[3]=t*n,e}function U(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function H(e,t,s,i){var r=t[0],n=t[1],a=t[2];return t=t[3],e[0]=r+i*(s[0]-r),e[1]=n+i*(s[1]-n),e[2]=a+i*(s[2]-a),e[3]=t+i*(s[3]-t),e}function X(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Y(){var e=new me(4);return me!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function z(e,t,s){s*=.5;var i=Math.sin(s);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(s),e}function q(e,t,s){var i=t[0],r=t[1],n=t[2];t=t[3];var a=s[0],o=s[1],h=s[2];return s=s[3],e[0]=i*s+t*a+r*h-n*o,e[1]=r*s+t*o+n*a-i*h,e[2]=n*s+t*h+i*o-r*a,e[3]=t*s-i*a-r*o-n*h,e}function K(e,t,s){s*=.5;var i=t[0],r=t[1],n=t[2];t=t[3];var a=Math.sin(s);return s=Math.cos(s),e[0]=i*s+t*a,e[1]=r*s+n*a,e[2]=n*s-r*a,e[3]=t*s-i*a,e}function J(e,t,s){s*=.5;var i=t[0],r=t[1],n=t[2];t=t[3];var a=Math.sin(s);return s=Math.cos(s),e[0]=i*s-n*a,e[1]=r*s+t*a,e[2]=n*s+i*a,e[3]=t*s-r*a,e}function Q(e,t,s){s*=.5;var i=t[0],r=t[1],n=t[2];t=t[3];var a=Math.sin(s);return s=Math.cos(s),e[0]=i*s+r*a,e[1]=r*s-i*a,e[2]=n*s+t*a,e[3]=t*s-n*a,e}function Z(e,t){var s=t[0],i=t[1],r=t[2],n=Math.sqrt(s*s+i*i+r*r);t=Math.exp(t[3]);var a=0<n?t*Math.sin(n)/n:0;return e[0]=s*a,e[1]=i*a,e[2]=r*a,e[3]=t*Math.cos(n),e}function ee(e,t){var s=t[0],i=t[1],r=t[2];t=t[3];var n=Math.sqrt(s*s+i*i+r*r);return n=0<n?Math.atan2(n,t)/n:0,e[0]=s*n,e[1]=i*n,e[2]=r*n,e[3]=.5*Math.log(s*s+i*i+r*r+t*t),e}function te(e,t,s,i){var r=t[0],n=t[1],a=t[2];t=t[3];var o=s[0],h=s[1],l=s[2],c=r*o+n*h+a*l+t*(s=s[3]);if(0>c&&(c=-c,o=-o,h=-h,l=-l,s=-s),1e-6<1-c){var u=Math.acos(c),p=Math.sin(u);c=Math.sin((1-i)*u)/p,i=Math.sin(i*u)/p}else c=1-i;return e[0]=c*r+i*o,e[1]=c*n+i*h,e[2]=c*a+i*l,e[3]=c*t+i*s,e}function se(e,t){var s=t[0]+t[4]+t[8];if(0<s)s=Math.sqrt(s+1),e[3]=.5*s,s=.5/s,e[0]=(t[5]-t[7])*s,e[1]=(t[6]-t[2])*s,e[2]=(t[1]-t[3])*s;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var r=(i+1)%3,n=(i+2)%3;s=Math.sqrt(t[3*i+i]-t[3*r+r]-t[3*n+n]+1),e[i]=.5*s,s=.5/s,e[3]=(t[3*r+n]-t[3*n+r])*s,e[r]=(t[3*r+i]+t[3*i+r])*s,e[n]=(t[3*n+i]+t[3*i+n])*s}return e}function ie(e,t,s){var i=.5*s[0],r=.5*s[1];s=.5*s[2];var n=t[0],a=t[1],o=t[2];return t=t[3],e[0]=n,e[1]=a,e[2]=o,e[3]=t,e[4]=i*t+r*o-s*a,e[5]=r*t+s*n-i*o,e[6]=s*t+i*a-r*n,e[7]=-i*n-r*a-s*o,e}function re(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function ne(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=s[4],h=s[5],l=s[6],c=s[7],u=t[4],p=t[5],_=t[6];t=t[7];var m=s[0],d=s[1],g=s[2];return s=s[3],e[0]=i*s+a*m+r*g-n*d,e[1]=r*s+a*d+n*m-i*g,e[2]=n*s+a*g+i*d-r*m,e[3]=a*s-i*m-r*d-n*g,e[4]=i*c+a*o+r*l-n*h+u*s+t*m+p*g-_*d,e[5]=r*c+a*h+n*o-i*l+p*s+t*d+_*m-u*g,e[6]=n*c+a*l+i*h-r*o+_*s+t*g+u*d-p*m,e[7]=a*c-i*o-r*h-n*l+t*s-u*m-p*d-_*g,e}function ae(){var e=new me(2);return me!=Float32Array&&(e[0]=0,e[1]=0),e}function oe(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e}function he(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e}function le(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e}function ce(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function ue(e,t){var s=t[0]-e[0];return s*s+(e=t[1]-e[1])*e}function pe(e){return Math.hypot(e[0],e[1])}function _e(e){var t=e[0];return t*t+(e=e[1])*e}var me="undefined"!=typeof Float32Array?Float32Array:Array,de=Math.random,ge=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var fe,Ce=Object.freeze({__proto__:null,EPSILON:1e-6,get ARRAY_TYPE(){return me},RANDOM:de,ANGLE_ORDER:"zyx",setMatrixArrayType:function(e){me=e},toRadian:function(e){return e*ge},equals:function(e,t){return Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))}}),Se=Object.freeze({__proto__:null,create:function(){var e=new me(4);return me!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new me(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues:function(e,t,s,i){var r=new me(4);return r[0]=e,r[1]=t,r[2]=s,r[3]=i,r},set:function(e,t,s,i,r){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e},transpose:function(e,t){if(e===t){var s=t[1];e[1]=t[2],e[2]=s}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=s*(t=t[3])-r*i;return n?(n=1/n,e[0]=t*n,e[1]=-i*n,e[2]=-r*n,e[3]=s*n,e):null},adjoint:function(e,t){var s=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=s,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:t,rotate:function(e,t,s){var i=t[0],r=t[1],n=t[2];t=t[3];var a=Math.sin(s);return s=Math.cos(s),e[0]=i*s+n*a,e[1]=r*s+t*a,e[2]=i*-a+n*s,e[3]=r*-a+t*s,e},scale:function(e,t,s){var i=t[1],r=t[2],n=t[3],a=s[0];return s=s[1],e[0]=t[0]*a,e[1]=i*a,e[2]=r*s,e[3]=n*s,e},fromRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=t,e[1]=s,e[2]=-s,e[3]=t,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3])},LDU:function(e,t,s,i){return e[2]=i[2]/i[0],s[0]=i[0],s[1]=i[1],s[3]=i[3]-e[2]*s[1],[e,t,s]},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e},subtract:s,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){var s=e[0],i=e[1],r=e[2];e=e[3];var n=t[0],a=t[1],o=t[2];return t=t[3],Math.abs(s-n)<=1e-6*Math.max(1,Math.abs(s),Math.abs(n))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e},mul:t,sub:s}),ye=Object.freeze({__proto__:null,create:function(){var e=new me(6);return me!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new me(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues:function(e,t,s,i,r,n){var a=new me(6);return a[0]=e,a[1]=t,a[2]=s,a[3]=i,a[4]=r,a[5]=n,a},set:function(e,t,s,i,r,n,a){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4];t=t[5];var o=s*n-i*r;return o?(o=1/o,e[0]=n*o,e[1]=-i*o,e[2]=-r*o,e[3]=s*o,e[4]=(r*t-n*a)*o,e[5]=(i*a-s*t)*o,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:i,rotate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4];t=t[5];var h=Math.sin(s);return s=Math.cos(s),e[0]=i*s+n*h,e[1]=r*s+a*h,e[2]=i*-h+n*s,e[3]=r*-h+a*s,e[4]=o,e[5]=t,e},scale:function(e,t,s){var i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=s[0];return s=s[1],e[0]=t[0]*h,e[1]=i*h,e[2]=r*s,e[3]=n*s,e[4]=a,e[5]=o,e},translate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4];t=t[5];var h=s[0];return s=s[1],e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=i*h+n*s+o,e[5]=r*h+a*s+t,e},fromRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=t,e[1]=s,e[2]=-s,e[3]=t,e[4]=0,e[5]=0,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e},subtract:r,multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e[4]=t[4]+s[4]*i,e[5]=t[5]+s[5]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4];e=e[5];var o=t[0],h=t[1],l=t[2],c=t[3],u=t[4];return t=t[5],Math.abs(s-o)<=1e-6*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(i-h)<=1e-6*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-l)<=1e-6*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-c)<=1e-6*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-u)<=1e-6*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},mul:i,sub:r}),$e=Object.freeze({__proto__:null,create:n,fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new me(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,s,i,r,n,a,o,h){var l=new me(9);return l[0]=e,l[1]=t,l[2]=s,l[3]=i,l[4]=r,l[5]=n,l[6]=a,l[7]=o,l[8]=h,l},set:function(e,t,s,i,r,n,a,o,h,l){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e[6]=o,e[7]=h,e[8]=l,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var s=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=s,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=(t=t[8])*a-o*l,u=-t*n+o*h,p=l*n-a*h,_=s*c+i*u+r*p;return _?(_=1/_,e[0]=c*_,e[1]=(-t*i+r*l)*_,e[2]=(o*i-r*a)*_,e[3]=u*_,e[4]=(t*s-r*h)*_,e[5]=(-o*s+r*n)*_,e[6]=p*_,e[7]=(-l*s+i*h)*_,e[8]=(a*s-i*n)*_,e):null},adjoint:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7];return t=t[8],e[0]=a*t-o*l,e[1]=r*l-i*t,e[2]=i*o-r*a,e[3]=o*h-n*t,e[4]=s*t-r*h,e[5]=r*n-s*o,e[6]=n*l-a*h,e[7]=i*h-s*l,e[8]=s*a-i*n,e},determinant:function(e){var t=e[3],s=e[4],i=e[5],r=e[6],n=e[7],a=e[8];return e[0]*(a*s-i*n)+e[1]*(-a*t+i*r)+e[2]*(n*t-s*r)},multiply:a,translate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7];t=t[8];var u=s[0];return s=s[1],e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=o,e[5]=h,e[6]=u*i+s*a+l,e[7]=u*r+s*o+c,e[8]=u*n+s*h+t,e},rotate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7];t=t[8];var u=Math.sin(s);return s=Math.cos(s),e[0]=s*i+u*a,e[1]=s*r+u*o,e[2]=s*n+u*h,e[3]=s*a-u*i,e[4]=s*o-u*r,e[5]=s*h-u*n,e[6]=l,e[7]=c,e[8]=t,e},scale:function(e,t,s){var i=s[0];return s=s[1],e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=t,e[1]=s,e[2]=0,e[3]=-s,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){var s=t[0],i=t[1],r=t[2],n=s+s,a=i+i,o=r+r;s*=n;var h=i*n;i*=a;var l=r*n,c=r*a;return r*=o,n*=t=t[3],a*=t,t*=o,e[0]=1-i-r,e[3]=h-t,e[6]=l+a,e[1]=h+t,e[4]=1-s-r,e[7]=c-n,e[2]=l-a,e[5]=c+n,e[8]=1-s-i,e},normalFromMat4:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],p=t[10],_=t[11],m=t[12],d=t[13],g=t[14],f=s*o-i*a,C=s*h-r*a,S=s*l-n*a,y=i*h-r*o,$=i*l-n*o,G=r*l-n*h,I=c*d-u*m,T=c*g-p*m,b=u*g-p*d;return(_=f*(p=p*(t=t[15])-_*g)-C*(u=u*t-_*d)+S*b+y*(c=c*t-_*m)-$*T+G*I)?(_=1/_,e[0]=(o*p-h*u+l*b)*_,e[1]=(h*c-a*p-l*T)*_,e[2]=(a*u-o*c+l*I)*_,e[3]=(r*u-i*p-n*b)*_,e[4]=(s*p-r*c+n*T)*_,e[5]=(i*c-s*u-n*I)*_,e[6]=(d*G-g*$+t*y)*_,e[7]=(g*S-m*G-t*C)*_,e[8]=(m*$-d*S+t*f)*_,e):null},projection:function(e,t,s){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/s,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e[8]=t[8]+s[8],e},subtract:o,multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e[4]=t[4]+s[4]*i,e[5]=t[5]+s[5]*i,e[6]=t[6]+s[6]*i,e[7]=t[7]+s[7]*i,e[8]=t[8]+s[8]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],h=e[6],l=e[7];e=e[8];var c=t[0],u=t[1],p=t[2],_=t[3],m=t[4],d=t[5],g=t[6],f=t[7];return t=t[8],Math.abs(s-c)<=1e-6*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-u)<=1e-6*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-p)<=1e-6*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-_)<=1e-6*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-m)<=1e-6*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-d)<=1e-6*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(h-g)<=1e-6*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(l-f)<=1e-6*Math.max(1,Math.abs(l),Math.abs(f))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},mul:a,sub:o}),Ge=Object.freeze({__proto__:null,create:function(){var e=new me(16);return me!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone:function(e){var t=new me(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,s,i,r,n,a,o,h,l,c,u,p,_,m,d){var g=new me(16);return g[0]=e,g[1]=t,g[2]=s,g[3]=i,g[4]=r,g[5]=n,g[6]=a,g[7]=o,g[8]=h,g[9]=l,g[10]=c,g[11]=u,g[12]=p,g[13]=_,g[14]=m,g[15]=d,g},set:function(e,t,s,i,r,n,a,o,h,l,c,u,p,_,m,d,g){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e[6]=o,e[7]=h,e[8]=l,e[9]=c,e[10]=u,e[11]=p,e[12]=_,e[13]=m,e[14]=d,e[15]=g,e},identity:h,transpose:function(e,t){if(e===t){var s=t[1],i=t[2],r=t[3],n=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=s,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=n,e[11]=t[14],e[12]=r,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],p=t[10],_=t[11],m=t[12],d=t[13],g=t[14],f=s*o-i*a,C=s*h-r*a,S=s*l-n*a,y=i*h-r*o,$=i*l-n*o,G=r*l-n*h,I=c*d-u*m,T=c*g-p*m,b=c*(t=t[15])-_*m,P=u*g-p*d,v=u*t-_*d,R=p*t-_*g,j=f*R-C*v+S*P+y*b-$*T+G*I;return j?(j=1/j,e[0]=(o*R-h*v+l*P)*j,e[1]=(r*v-i*R-n*P)*j,e[2]=(d*G-g*$+t*y)*j,e[3]=(p*$-u*G-_*y)*j,e[4]=(h*b-a*R-l*T)*j,e[5]=(s*R-r*b+n*T)*j,e[6]=(g*S-m*G-t*C)*j,e[7]=(c*G-p*S+_*C)*j,e[8]=(a*v-o*b+l*I)*j,e[9]=(i*b-s*v-n*I)*j,e[10]=(m*$-d*S+t*f)*j,e[11]=(u*S-c*$-_*f)*j,e[12]=(o*T-a*P-h*I)*j,e[13]=(s*P-i*T+r*I)*j,e[14]=(d*C-m*y-g*f)*j,e[15]=(c*y-u*C+p*f)*j,e):null},adjoint:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],p=t[10],_=t[11],m=t[12],d=t[13],g=t[14],f=s*o-i*a,C=s*h-r*a,S=s*l-n*a,y=i*h-r*o,$=i*l-n*o,G=r*l-n*h,I=c*d-u*m,T=c*g-p*m,b=c*(t=t[15])-_*m,P=u*g-p*d,v=u*t-_*d,R=p*t-_*g;return e[0]=o*R-h*v+l*P,e[1]=r*v-i*R-n*P,e[2]=d*G-g*$+t*y,e[3]=p*$-u*G-_*y,e[4]=h*b-a*R-l*T,e[5]=s*R-r*b+n*T,e[6]=g*S-m*G-t*C,e[7]=c*G-p*S+_*C,e[8]=a*v-o*b+l*I,e[9]=i*b-s*v-n*I,e[10]=m*$-d*S+t*f,e[11]=u*S-c*$-_*f,e[12]=o*T-a*P-h*I,e[13]=s*P-i*T+r*I,e[14]=d*C-m*y-g*f,e[15]=c*y-u*C+p*f,e},determinant:function(e){var t=e[0],s=e[1],i=e[2],r=e[4],n=e[5],a=e[6],o=e[8],h=e[9],l=e[10],c=e[12],u=e[13],p=e[14],_=t*n-s*r,m=t*a-i*r,d=s*a-i*n,g=o*u-h*c,f=o*p-l*c,C=h*p-l*u;return e[7]*(t*C-s*f+i*g)-e[3]*(r*C-n*f+a*g)+e[15]*(o*d-h*m+l*_)-e[11]*(c*d-u*m+p*_)},multiply:l,translate:function(e,t,s){var i=s[0],r=s[1];if(s=s[2],t===e)e[12]=t[0]*i+t[4]*r+t[8]*s+t[12],e[13]=t[1]*i+t[5]*r+t[9]*s+t[13],e[14]=t[2]*i+t[6]*r+t[10]*s+t[14],e[15]=t[3]*i+t[7]*r+t[11]*s+t[15];else{var n=t[0],a=t[1],o=t[2],h=t[3],l=t[4],c=t[5],u=t[6],p=t[7],_=t[8],m=t[9],d=t[10],g=t[11];e[0]=n,e[1]=a,e[2]=o,e[3]=h,e[4]=l,e[5]=c,e[6]=u,e[7]=p,e[8]=_,e[9]=m,e[10]=d,e[11]=g,e[12]=n*i+l*r+_*s+t[12],e[13]=a*i+c*r+m*s+t[13],e[14]=o*i+u*r+d*s+t[14],e[15]=h*i+p*r+g*s+t[15]}return e},scale:function(e,t,s){var i=s[0],r=s[1];return s=s[2],e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,t,s,i){var r=i[0],n=i[1];i=i[2];var a=Math.hypot(r,n,i);if(1e-6>a)return null;r*=a=1/a,n*=a,i*=a;var o=Math.sin(s),h=Math.cos(s),l=1-h;s=t[0],a=t[1];var c=t[2],u=t[3],p=t[4],_=t[5],m=t[6],d=t[7],g=t[8],f=t[9],C=t[10],S=t[11],y=r*r*l+h,$=n*r*l+i*o,G=i*r*l-n*o,I=r*n*l-i*o,T=n*n*l+h,b=i*n*l+r*o,P=r*i*l+n*o;return r=n*i*l-r*o,n=i*i*l+h,e[0]=s*y+p*$+g*G,e[1]=a*y+_*$+f*G,e[2]=c*y+m*$+C*G,e[3]=u*y+d*$+S*G,e[4]=s*I+p*T+g*b,e[5]=a*I+_*T+f*b,e[6]=c*I+m*T+C*b,e[7]=u*I+d*T+S*b,e[8]=s*P+p*r+g*n,e[9]=a*P+_*r+f*n,e[10]=c*P+m*r+C*n,e[11]=u*P+d*r+S*n,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},rotateX:function(e,t,s){var i=Math.sin(s);s=Math.cos(s);var r=t[4],n=t[5],a=t[6],o=t[7],h=t[8],l=t[9],c=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=r*s+h*i,e[5]=n*s+l*i,e[6]=a*s+c*i,e[7]=o*s+u*i,e[8]=h*s-r*i,e[9]=l*s-n*i,e[10]=c*s-a*i,e[11]=u*s-o*i,e},rotateY:function(e,t,s){var i=Math.sin(s);s=Math.cos(s);var r=t[0],n=t[1],a=t[2],o=t[3],h=t[8],l=t[9],c=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=r*s-h*i,e[1]=n*s-l*i,e[2]=a*s-c*i,e[3]=o*s-u*i,e[8]=r*i+h*s,e[9]=n*i+l*s,e[10]=a*i+c*s,e[11]=o*i+u*s,e},rotateZ:function(e,t,s){var i=Math.sin(s);s=Math.cos(s);var r=t[0],n=t[1],a=t[2],o=t[3],h=t[4],l=t[5],c=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=r*s+h*i,e[1]=n*s+l*i,e[2]=a*s+c*i,e[3]=o*s+u*i,e[4]=h*s-r*i,e[5]=l*s-n*i,e[6]=c*s-a*i,e[7]=u*s-o*i,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,s){var i=s[0],r=s[1];s=s[2];var n=Math.hypot(i,r,s);if(1e-6>n)return null;i*=n=1/n,r*=n,s*=n,n=Math.sin(t);var a=1-(t=Math.cos(t));return e[0]=i*i*a+t,e[1]=r*i*a+s*n,e[2]=s*i*a-r*n,e[3]=0,e[4]=i*r*a-s*n,e[5]=r*r*a+t,e[6]=s*r*a+i*n,e[7]=0,e[8]=i*s*a+r*n,e[9]=r*s*a-i*n,e[10]=s*s*a+t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromXRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=s,e[7]=0,e[8]=0,e[9]=-s,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=t,e[1]=0,e[2]=-s,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=s,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=t,e[1]=s,e[2]=0,e[3]=0,e[4]=-s,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:c,fromQuat2:function(e,t){var s=new me(3),i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7],p=i*i+r*r+n*n+a*a;return 0<p?(s[0]=2*(o*a+u*i+h*n-l*r)/p,s[1]=2*(h*a+u*r+l*i-o*n)/p,s[2]=2*(l*a+u*n+o*r-h*i)/p):(s[0]=2*(o*a+u*i+h*n-l*r),s[1]=2*(h*a+u*r+l*i-o*n),s[2]=2*(l*a+u*n+o*r-h*i)),c(e,t,s),e},getTranslation:u,getScaling:p,getRotation:_,decompose:function(e,t,s,i){t[0]=i[12],t[1]=i[13],t[2]=i[14];var r=i[0],n=i[1],a=i[2],o=i[4],h=i[5],l=i[6],c=i[8];t=i[9],i=i[10],s[0]=Math.hypot(r,n,a),s[1]=Math.hypot(o,h,l),s[2]=Math.hypot(c,t,i);var u=1/s[0],p=1/s[1],_=1/s[2];return n*=p,a*=_,o*=u,l*=_,c*=u,t*=p,0<(p=(s=r*u)+(h*=p)+(i*=_))?(i=2*Math.sqrt(p+1),e[3]=.25*i,e[0]=(l-t)/i,e[1]=(c-a)/i,e[2]=(n-o)/i):s>h&&s>i?(i=2*Math.sqrt(1+s-h-i),e[3]=(l-t)/i,e[0]=.25*i,e[1]=(n+o)/i,e[2]=(c+a)/i):h>i?(i=2*Math.sqrt(1+h-s-i),e[3]=(c-a)/i,e[0]=(n+o)/i,e[1]=.25*i,e[2]=(l+t)/i):(i=2*Math.sqrt(1+i-s-h),e[3]=(n-o)/i,e[0]=(c+a)/i,e[1]=(l+t)/i,e[2]=.25*i),e},fromRotationTranslationScale:function(e,t,s,i){var r=t[0],n=t[1],a=t[2],o=t[3],h=r+r,l=n+n,c=a+a;t=r*h;var u=r*l;r*=c;var p=n*l;n*=c,a*=c,h*=o,l*=o,o*=c,c=i[0];var _=i[1];return i=i[2],e[0]=(1-(p+a))*c,e[1]=(u+o)*c,e[2]=(r-l)*c,e[3]=0,e[4]=(u-o)*_,e[5]=(1-(t+a))*_,e[6]=(n+h)*_,e[7]=0,e[8]=(r+l)*i,e[9]=(n-h)*i,e[10]=(1-(t+p))*i,e[11]=0,e[12]=s[0],e[13]=s[1],e[14]=s[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,s,i,r){var n=t[0],a=t[1],o=t[2],h=t[3],l=n+n,c=a+a,u=o+o;t=n*l;var p=n*c,_=n*u;n=a*c,a*=u;var m=o*u;o=h*l,c*=h;var d=h*u,g=i[0],f=i[1];u=i[2],i=r[0],h=r[1],r=r[2],l=(1-(n+m))*g;var C=(p+d)*g;return g*=_-c,p=(p-d)*f,m=(1-(t+m))*f,f*=a+o,_=(_+c)*u,a=(a-o)*u,t=(1-(t+n))*u,e[0]=l,e[1]=C,e[2]=g,e[3]=0,e[4]=p,e[5]=m,e[6]=f,e[7]=0,e[8]=_,e[9]=a,e[10]=t,e[11]=0,e[12]=s[0]+i-(l*i+p*h+_*r),e[13]=s[1]+h-(C*i+m*h+a*r),e[14]=s[2]+r-(g*i+f*h+t*r),e[15]=1,e},fromQuat:function(e,t){var s=t[0],i=t[1],r=t[2],n=s+s,a=i+i,o=r+r;s*=n;var h=i*n;i*=a;var l=r*n,c=r*a;return r*=o,n*=t=t[3],a*=t,t*=o,e[0]=1-i-r,e[1]=h+t,e[2]=l-a,e[3]=0,e[4]=h-t,e[5]=1-s-r,e[6]=c+n,e[7]=0,e[8]=l+a,e[9]=c-n,e[10]=1-s-i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,s,i,r,n,a){var o=1/(s-t),h=1/(r-i),l=1/(n-a);return e[0]=2*n*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*h,e[6]=0,e[7]=0,e[8]=(s+t)*o,e[9]=(r+i)*h,e[10]=(a+n)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*n*2*l,e[15]=0,e},perspectiveNO:m,perspective:m,perspectiveZO:function(e,t,s,i,r){return t=1/Math.tan(t/2),e[0]=t/s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&1/0!==r?(s=1/(i-r),e[10]=r*s,e[14]=r*i*s):(e[10]=-1,e[14]=-i),e},perspectiveFromFieldOfView:function(e,t,s,i){var r=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=2/(a+(t=Math.tan(t.rightDegrees*Math.PI/180))),h=2/(r+n);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-(a-t)*o*.5,e[9]=(r-n)*h*.5,e[10]=i/(s-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*s/(s-i),e[15]=0,e},orthoNO:d,ortho:d,orthoZO:function(e,t,s,i,r,n,a){var o=1/(t-s),h=1/(i-r);return a=1/(n-a),e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=a,e[11]=0,e[12]=(t+s)*o,e[13]=(r+i)*h,e[14]=n*a,e[15]=1,e},lookAt:function(e,t,s,i){var r=t[0],n=t[1];t=t[2];var a=i[0],o=i[1],l=i[2],c=s[0];i=s[1];var u=s[2];if(1e-6>Math.abs(r-c)&&1e-6>Math.abs(n-i)&&1e-6>Math.abs(t-u))return h(e);s=r-c,i=n-i,c=t-u;var p=1/Math.hypot(s,i,c);u=o*(c*=p)-l*(i*=p),l=l*(s*=p)-a*c,a=a*i-o*s,(p=Math.hypot(u,l,a))?(u*=p=1/p,l*=p,a*=p):a=l=u=0,o=i*a-c*l;var _=c*u-s*a,m=s*l-i*u;return(p=Math.hypot(o,_,m))?(o*=p=1/p,_*=p,m*=p):m=_=o=0,e[0]=u,e[1]=o,e[2]=s,e[3]=0,e[4]=l,e[5]=_,e[6]=i,e[7]=0,e[8]=a,e[9]=m,e[10]=c,e[11]=0,e[12]=-(u*r+l*n+a*t),e[13]=-(o*r+_*n+m*t),e[14]=-(s*r+i*n+c*t),e[15]=1,e},targetTo:function(e,t,s,i){var r=t[0],n=t[1];t=t[2];var a=i[0],o=i[1],h=i[2];i=r-s[0];var l=n-s[1],c=i*i+l*l+(s=t-s[2])*s;0<c&&(i*=c=1/Math.sqrt(c),l*=c,s*=c);var u=o*s-h*l;return 0<(c=u*u+(h=h*i-a*s)*h+(a=a*l-o*i)*a)&&(u*=c=1/Math.sqrt(c),h*=c,a*=c),e[0]=u,e[1]=h,e[2]=a,e[3]=0,e[4]=l*a-s*h,e[5]=s*u-i*a,e[6]=i*h-l*u,e[7]=0,e[8]=i,e[9]=l,e[10]=s,e[11]=0,e[12]=r,e[13]=n,e[14]=t,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e[8]=t[8]+s[8],e[9]=t[9]+s[9],e[10]=t[10]+s[10],e[11]=t[11]+s[11],e[12]=t[12]+s[12],e[13]=t[13]+s[13],e[14]=t[14]+s[14],e[15]=t[15]+s[15],e},subtract:g,multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12]*s,e[13]=t[13]*s,e[14]=t[14]*s,e[15]=t[15]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e[4]=t[4]+s[4]*i,e[5]=t[5]+s[5]*i,e[6]=t[6]+s[6]*i,e[7]=t[7]+s[7]*i,e[8]=t[8]+s[8]*i,e[9]=t[9]+s[9]*i,e[10]=t[10]+s[10]*i,e[11]=t[11]+s[11]*i,e[12]=t[12]+s[12]*i,e[13]=t[13]+s[13]*i,e[14]=t[14]+s[14]*i,e[15]=t[15]+s[15]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:function(e,t){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=e[9],p=e[10],_=e[11],m=e[12],d=e[13],g=e[14];e=e[15];var f=t[0],C=t[1],S=t[2],y=t[3],$=t[4],G=t[5],I=t[6],T=t[7],b=t[8],P=t[9],v=t[10],R=t[11],j=t[12],A=t[13],x=t[14];return t=t[15],Math.abs(s-f)<=1e-6*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(i-C)<=1e-6*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(r-S)<=1e-6*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(n-y)<=1e-6*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-$)<=1e-6*Math.max(1,Math.abs(a),Math.abs($))&&Math.abs(o-G)<=1e-6*Math.max(1,Math.abs(o),Math.abs(G))&&Math.abs(h-I)<=1e-6*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(l-T)<=1e-6*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-b)<=1e-6*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(u-P)<=1e-6*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(p-v)<=1e-6*Math.max(1,Math.abs(p),Math.abs(v))&&Math.abs(_-R)<=1e-6*Math.max(1,Math.abs(_),Math.abs(R))&&Math.abs(m-j)<=1e-6*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(d-A)<=1e-6*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(g-x)<=1e-6*Math.max(1,Math.abs(g),Math.abs(x))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},mul:l,sub:g}),Ie=(fe=f(),function(e,t,s,i,r,n){for(t||(t=3),s||(s=0),i=i?Math.min(i*t+s,e.length):e.length;s<i;s+=t)fe[0]=e[s],fe[1]=e[s+1],fe[2]=e[s+2],r(fe,fe,n),e[s]=fe[0],e[s+1]=fe[1],e[s+2]=fe[2];return e});Ie=Object.freeze({__proto__:null,create:f,clone:function(e){var t=new me(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:C,fromValues:S,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,s,i){return e[0]=t,e[1]=s,e[2]=i,e},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e},subtract:y,multiply:$,divide:G,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e[2]=Math.min(t[2],s[2]),e},max:function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e[2]=Math.max(t[2],s[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e},scaleAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e},distance:I,squaredDistance:T,squaredLength:b,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:P,dot:v,cross:R,lerp:function(e,t,s,i){var r=t[0],n=t[1];return t=t[2],e[0]=r+i*(s[0]-r),e[1]=n+i*(s[1]-n),e[2]=t+i*(s[2]-t),e},slerp:function(e,t,s,i){var r=Math.acos(Math.min(Math.max(v(t,s),-1),1)),n=Math.sin(r),a=Math.sin((1-i)*r)/n;return i=Math.sin(i*r)/n,e[0]=a*t[0]+i*s[0],e[1]=a*t[1]+i*s[1],e[2]=a*t[2]+i*s[2],e},hermite:function(e,t,s,i,r,n){var a=n*n,o=a*(2*n-3)+1,h=a*(n-2)+n,l=a*(n-1);return n=a*(3-2*n),e[0]=t[0]*o+s[0]*h+i[0]*l+r[0]*n,e[1]=t[1]*o+s[1]*h+i[1]*l+r[1]*n,e[2]=t[2]*o+s[2]*h+i[2]*l+r[2]*n,e},bezier:function(e,t,s,i,r,n){var a=1-n,o=a*a,h=n*n,l=o*a;return o*=3*n,a*=3*h,n*=h,e[0]=t[0]*l+s[0]*o+i[0]*a+r[0]*n,e[1]=t[1]*l+s[1]*o+i[1]*a+r[1]*n,e[2]=t[2]*l+s[2]*o+i[2]*a+r[2]*n,e},random:function(e,t){t=t||1;var s=2*de()*Math.PI,i=2*de()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(s)*r,e[1]=Math.sin(s)*r,e[2]=i*t,e},transformMat4:function(e,t,s){var i=t[0],r=t[1];t=t[2];var n=s[3]*i+s[7]*r+s[11]*t+s[15];return n=n||1,e[0]=(s[0]*i+s[4]*r+s[8]*t+s[12])/n,e[1]=(s[1]*i+s[5]*r+s[9]*t+s[13])/n,e[2]=(s[2]*i+s[6]*r+s[10]*t+s[14])/n,e},transformMat3:function(e,t,s){var i=t[0],r=t[1];return t=t[2],e[0]=i*s[0]+r*s[3]+t*s[6],e[1]=i*s[1]+r*s[4]+t*s[7],e[2]=i*s[2]+r*s[5]+t*s[8],e},transformQuat:function(e,t,s){var i=s[0],r=s[1],n=s[2],a=t[0],o=t[1],h=r*(t=t[2])-n*o,l=n*a-i*t,c=i*o-r*a;return s=2*s[3],e[0]=a+h*s+2*(r*c-n*l),e[1]=o+l*s+2*(n*h-i*c),e[2]=t+c*s+2*(i*l-r*h),e},rotateX:function(e,t,s,i){var r=[],n=[];return r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[0],n[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),n[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2],e},rotateY:function(e,t,s,i){var r=[],n=[];return r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),n[1]=r[1],n[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2],e},rotateZ:function(e,t,s,i){var r=[],n=[];return r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),n[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),n[2]=r[2],e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2],e},angle:function(e,t){var s=e[0],i=e[1],r=e[2],n=t[0],a=t[1],o=t[2];return e=(s=Math.sqrt((s*s+i*i+r*r)*(n*n+a*a+o*o)))&&v(e,t)/s,Math.acos(Math.min(Math.max(e,-1),1))},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var s=e[0],i=e[1];e=e[2];var r=t[0],n=t[1];return t=t[2],Math.abs(s-r)<=1e-6*Math.max(1,Math.abs(s),Math.abs(r))&&Math.abs(i-n)<=1e-6*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},sub:y,mul:$,div:G,dist:I,sqrDist:T,len:C,sqrLen:b,forEach:Ie});var Te=function(){var e=j();return function(t,s,i,r,n,a){for(s||(s=4),i||(i=0),r=r?Math.min(r*s+i,t.length):t.length;i<r;i+=s)e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],e[3]=t[i+3],n(e,e,a),t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3];return t}}();Te=Object.freeze({__proto__:null,create:j,clone:A,fromValues:x,copy:E,set:M,add:w,subtract:D,multiply:O,divide:B,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e[2]=Math.min(t[2],s[2]),e[3]=Math.min(t[3],s[3]),e},max:function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e[2]=Math.max(t[2],s[2]),e[3]=Math.max(t[3],s[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:L,scaleAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e},distance:F,squaredDistance:k,length:N,squaredLength:V,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:W,dot:U,cross:function(e,t,s,i){var r=s[0]*i[1]-s[1]*i[0],n=s[0]*i[2]-s[2]*i[0],a=s[0]*i[3]-s[3]*i[0],o=s[1]*i[2]-s[2]*i[1],h=s[1]*i[3]-s[3]*i[1];s=s[2]*i[3]-s[3]*i[2],i=t[0];var l=t[1],c=t[2];return t=t[3],e[0]=l*s-c*h+t*o,e[1]=-i*s+c*a-t*n,e[2]=i*h-l*a+t*r,e[3]=-i*o+l*n-c*r,e},lerp:H,random:function(e,t){t=t||1;do{var s=2*de()-1,i=2*de()-1,r=s*s+i*i}while(1<=r);do{var n=2*de()-1,a=2*de()-1,o=n*n+a*a}while(1<=o);return r=Math.sqrt((1-r)/o),e[0]=t*s,e[1]=t*i,e[2]=t*n*r,e[3]=t*a*r,e},transformMat4:function(e,t,s){var i=t[0],r=t[1],n=t[2];return t=t[3],e[0]=s[0]*i+s[4]*r+s[8]*n+s[12]*t,e[1]=s[1]*i+s[5]*r+s[9]*n+s[13]*t,e[2]=s[2]*i+s[6]*r+s[10]*n+s[14]*t,e[3]=s[3]*i+s[7]*r+s[11]*n+s[15]*t,e},transformQuat:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=s[0],o=s[1],h=s[2],l=(s=s[3])*i+o*n-h*r,c=s*r+h*i-a*n,u=s*n+a*r-o*i;return i=-a*i-o*r-h*n,e[0]=l*s+i*-a+c*-h-u*-o,e[1]=c*s+i*-o+u*-a-l*-h,e[2]=u*s+i*-h+l*-o-c*-a,e[3]=t[3],e},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:X,equals:function(e,t){var s=e[0],i=e[1],r=e[2];e=e[3];var n=t[0],a=t[1],o=t[2];return t=t[3],Math.abs(s-n)<=1e-6*Math.max(1,Math.abs(s),Math.abs(n))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},sub:D,mul:O,div:B,dist:F,sqrDist:k,len:N,sqrLen:V,forEach:Te});var be=function(){var e=f(),t=S(1,0,0),s=S(0,1,0);return function(i,r,n){var a=v(r,n);return-.999999>a?(R(e,t,r),1e-6>C(e)&&R(e,s,r),P(e,e),z(i,e,Math.PI),i):.999999<a?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(R(e,r,n),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+a,W(i,i))}}(),Pe=function(){var e=Y(),t=Y();return function(s,i,r,n,a,o){return te(e,i,a,o),te(t,r,n,o),te(s,e,t,2*o*(1-o)),s}}(),ve=function(){var e=n();return function(t,s,i,r){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-s[0],e[5]=-s[1],e[8]=-s[2],W(t,se(t,e))}}();be=Object.freeze({__proto__:null,create:Y,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:z,getAxisAngle:function(e,t){var s=2*Math.acos(t[3]),i=Math.sin(s/2);return 1e-6<i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),s},getAngle:function(e,t){return e=U(e,t),Math.acos(2*e*e-1)},multiply:q,rotateX:K,rotateY:J,rotateZ:Q,calculateW:function(e,t){var s=t[0],i=t[1];return t=t[2],e[0]=s,e[1]=i,e[2]=t,e[3]=Math.sqrt(Math.abs(1-s*s-i*i-t*t)),e},exp:Z,ln:ee,pow:function(e,t,s){return ee(e,t),L(e,e,s),Z(e,e),e},slerp:te,random:function(e){var t=de(),s=de(),i=de(),r=Math.sqrt(1-t);return t=Math.sqrt(t),e[0]=r*Math.sin(2*Math.PI*s),e[1]=r*Math.cos(2*Math.PI*s),e[2]=t*Math.sin(2*Math.PI*i),e[3]=t*Math.cos(2*Math.PI*i),e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=s*s+i*i+r*r+(t=t[3])*t;return n=n?1/n:0,e[0]=-s*n,e[1]=-i*n,e[2]=-r*n,e[3]=t*n,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat3:se,fromEuler:function(e,t,s,i){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"zyx",n=Math.PI/360;t*=n,i*=n,s*=n,n=Math.sin(t);var a=Math.cos(t),o=Math.sin(s),h=Math.cos(s),l=Math.sin(i),c=Math.cos(i);switch(r){case"xyz":e[0]=n*h*c+a*o*l,e[1]=a*o*c-n*h*l,e[2]=a*h*l+n*o*c,e[3]=a*h*c-n*o*l;break;case"xzy":e[0]=n*h*c-a*o*l,e[1]=a*o*c-n*h*l,e[2]=a*h*l+n*o*c,e[3]=a*h*c+n*o*l;break;case"yxz":e[0]=n*h*c+a*o*l,e[1]=a*o*c-n*h*l,e[2]=a*h*l-n*o*c,e[3]=a*h*c+n*o*l;break;case"yzx":e[0]=n*h*c+a*o*l,e[1]=a*o*c+n*h*l,e[2]=a*h*l-n*o*c,e[3]=a*h*c-n*o*l;break;case"zxy":e[0]=n*h*c-a*o*l,e[1]=a*o*c+n*h*l,e[2]=a*h*l+n*o*c,e[3]=a*h*c-n*o*l;break;case"zyx":e[0]=n*h*c-a*o*l,e[1]=a*o*c+n*h*l,e[2]=a*h*l-n*o*c,e[3]=a*h*c+n*o*l;break;default:throw Error("Unknown angle order "+r)}return e},str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},clone:A,fromValues:x,copy:E,set:M,add:w,mul:q,scale:L,dot:U,lerp:H,length:N,len:N,squaredLength:V,sqrLen:V,normalize:W,exactEquals:X,equals:function(e,t){return.999999<=Math.abs(U(e,t))},rotationTo:be,sqlerp:Pe,setAxes:ve}),Pe=Object.freeze({__proto__:null,create:function(){var e=new me(8);return me!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone:function(e){var t=new me(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues:function(e,t,s,i,r,n,a,o){var h=new me(8);return h[0]=e,h[1]=t,h[2]=s,h[3]=i,h[4]=r,h[5]=n,h[6]=a,h[7]=o,h},fromRotationTranslationValues:function(e,t,s,i,r,n,a){var o=new me(8);return o[0]=e,o[1]=t,o[2]=s,o[3]=i,r*=.5,n*=.5,a*=.5,o[4]=r*i+n*s-a*t,o[5]=n*i+a*e-r*s,o[6]=a*i+r*t-n*e,o[7]=-r*e-n*t-a*s,o},fromRotationTranslation:ie,fromTranslation:function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat4:function(e,t){var s=Y();_(s,t);var i=new me(3);return u(i,t),ie(e,s,i),e},copy:re,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set:function(e,t,s,i,r,n,a,o,h){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e[6]=o,e[7]=h,e},getReal:E,getDual:function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setReal:E,setDual:function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation:function(e,t){var s=t[4],i=t[5],r=t[6],n=t[7],a=-t[0],o=-t[1],h=-t[2];return t=t[3],e[0]=2*(s*t+n*a+i*h-r*o),e[1]=2*(i*t+n*o+r*a-s*h),e[2]=2*(r*t+n*h+s*o-i*a),e},translate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=.5*s[0],h=.5*s[1];s=.5*s[2];var l=t[4],c=t[5],u=t[6];return t=t[7],e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=a*o+r*s-n*h+l,e[5]=a*h+n*o-i*s+c,e[6]=a*s+i*h-r*o+u,e[7]=-i*o-r*h-n*s+t,e},rotateX:function(e,t,s){var i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=o*a+c*i+h*n-l*r,p=h*a+c*r+l*i-o*n,_=l*a+c*n+o*r-h*i;return o=c*a-o*i-h*r-l*n,K(e,t,s),i=e[0],r=e[1],n=e[2],a=e[3],e[4]=u*a+o*i+p*n-_*r,e[5]=p*a+o*r+_*i-u*n,e[6]=_*a+o*n+u*r-p*i,e[7]=o*a-u*i-p*r-_*n,e},rotateY:function(e,t,s){var i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=o*a+c*i+h*n-l*r,p=h*a+c*r+l*i-o*n,_=l*a+c*n+o*r-h*i;return o=c*a-o*i-h*r-l*n,J(e,t,s),i=e[0],r=e[1],n=e[2],a=e[3],e[4]=u*a+o*i+p*n-_*r,e[5]=p*a+o*r+_*i-u*n,e[6]=_*a+o*n+u*r-p*i,e[7]=o*a-u*i-p*r-_*n,e},rotateZ:function(e,t,s){var i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=o*a+c*i+h*n-l*r,p=h*a+c*r+l*i-o*n,_=l*a+c*n+o*r-h*i;return o=c*a-o*i-h*r-l*n,Q(e,t,s),i=e[0],r=e[1],n=e[2],a=e[3],e[4]=u*a+o*i+p*n-_*r,e[5]=p*a+o*r+_*i-u*n,e[6]=_*a+o*n+u*r-p*i,e[7]=o*a-u*i-p*r-_*n,e},rotateByQuatAppend:function(e,t,s){var i=s[0],r=s[1],n=s[2];s=s[3];var a=t[0],o=t[1],h=t[2],l=t[3];return e[0]=a*s+l*i+o*n-h*r,e[1]=o*s+l*r+h*i-a*n,e[2]=h*s+l*n+a*r-o*i,e[3]=l*s-a*i-o*r-h*n,a=t[4],o=t[5],h=t[6],l=t[7],e[4]=a*s+l*i+o*n-h*r,e[5]=o*s+l*r+h*i-a*n,e[6]=h*s+l*n+a*r-o*i,e[7]=l*s-a*i-o*r-h*n,e},rotateByQuatPrepend:function(e,t,s){var i=t[0],r=t[1],n=t[2];t=t[3];var a=s[0],o=s[1],h=s[2],l=s[3];return e[0]=i*l+t*a+r*h-n*o,e[1]=r*l+t*o+n*a-i*h,e[2]=n*l+t*h+i*o-r*a,e[3]=t*l-i*a-r*o-n*h,a=s[4],o=s[5],h=s[6],l=s[7],e[4]=i*l+t*a+r*h-n*o,e[5]=r*l+t*o+n*a-i*h,e[6]=n*l+t*h+i*o-r*a,e[7]=t*l-i*a-r*o-n*h,e},rotateAroundAxis:function(e,t,s,i){if(1e-6>Math.abs(i))return re(e,t);var r=Math.hypot(s[0],s[1],s[2]);i*=.5;var n=Math.sin(i),a=n*s[0]/r,o=n*s[1]/r;s=n*s[2]/r,i=Math.cos(i),r=t[0],n=t[1];var h=t[2],l=t[3];return e[0]=r*i+l*a+n*s-h*o,e[1]=n*i+l*o+h*a-r*s,e[2]=h*i+l*s+r*o-n*a,e[3]=l*i-r*a-n*o-h*s,r=t[4],n=t[5],h=t[6],t=t[7],e[4]=r*i+t*a+n*s-h*o,e[5]=n*i+t*o+h*a-r*s,e[6]=h*i+t*s+r*o-n*a,e[7]=t*i-r*a-n*o-h*s,e},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e},multiply:ne,mul:ne,scale:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e},dot:U,lerp:function(e,t,s,i){var r=1-i;return 0>U(t,s)&&(i=-i),e[0]=t[0]*r+s[0]*i,e[1]=t[1]*r+s[1]*i,e[2]=t[2]*r+s[2]*i,e[3]=t[3]*r+s[3]*i,e[4]=t[4]*r+s[4]*i,e[5]=t[5]*r+s[5]*i,e[6]=t[6]*r+s[6]*i,e[7]=t[7]*r+s[7]*i,e},invert:function(e,t){var s=V(t);return e[0]=-t[0]/s,e[1]=-t[1]/s,e[2]=-t[2]/s,e[3]=t[3]/s,e[4]=-t[4]/s,e[5]=-t[5]/s,e[6]=-t[6]/s,e[7]=t[7]/s,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},length:N,len:N,squaredLength:V,sqrLen:V,normalize:function(e,t){var s=V(t);if(0<s){s=Math.sqrt(s);var i=t[0]/s,r=t[1]/s,n=t[2]/s,a=t[3]/s,o=t[4],h=t[5],l=t[6],c=i*o+r*h+n*l+a*(t=t[7]);e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=(o-i*c)/s,e[5]=(h-r*c)/s,e[6]=(l-n*c)/s,e[7]=(t-a*c)/s}return e},str:function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals:function(e,t){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],h=e[6];e=e[7];var l=t[0],c=t[1],u=t[2],p=t[3],_=t[4],m=t[5],d=t[6];return t=t[7],Math.abs(s-l)<=1e-6*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(i-c)<=1e-6*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-u)<=1e-6*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-p)<=1e-6*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-_)<=1e-6*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-m)<=1e-6*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(h-d)<=1e-6*Math.max(1,Math.abs(h),Math.abs(d))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))}}),ve=function(){var e=ae();return function(t,s,i,r,n,a){for(s||(s=2),i||(i=0),r=r?Math.min(r*s+i,t.length):t.length;i<r;i+=s)e[0]=t[i],e[1]=t[i+1],n(e,e,a),t[i]=e[0],t[i+1]=e[1];return t}}(),ve=Object.freeze({__proto__:null,create:ae,clone:function(e){var t=new me(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var s=new me(2);return s[0]=e,s[1]=t,s},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,s){return e[0]=t,e[1]=s,e},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e},subtract:oe,multiply:he,divide:le,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e},max:function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e},scaleAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e},distance:ce,squaredDistance:ue,length:pe,squaredLength:_e,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:function(e,t){var s=t[0],i=t[1];return 0<(s=s*s+i*i)&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,s){return t=t[0]*s[1]-t[1]*s[0],e[0]=e[1]=0,e[2]=t,e},lerp:function(e,t,s,i){var r=t[0];return t=t[1],e[0]=r+i*(s[0]-r),e[1]=t+i*(s[1]-t),e},random:function(e,t){t=t||1;var s=2*de()*Math.PI;return e[0]=Math.cos(s)*t,e[1]=Math.sin(s)*t,e},transformMat2:function(e,t,s){var i=t[0];return t=t[1],e[0]=s[0]*i+s[2]*t,e[1]=s[1]*i+s[3]*t,e},transformMat2d:function(e,t,s){var i=t[0];return t=t[1],e[0]=s[0]*i+s[2]*t+s[4],e[1]=s[1]*i+s[3]*t+s[5],e},transformMat3:function(e,t,s){var i=t[0];return t=t[1],e[0]=s[0]*i+s[3]*t+s[6],e[1]=s[1]*i+s[4]*t+s[7],e},transformMat4:function(e,t,s){var i=t[0];return t=t[1],e[0]=s[0]*i+s[4]*t+s[12],e[1]=s[1]*i+s[5]*t+s[13],e},rotate:function(e,t,s,i){var r=t[0]-s[0];t=t[1]-s[1];var n=Math.sin(i);return i=Math.cos(i),e[0]=r*i-t*n+s[0],e[1]=r*n+t*i+s[1],e},angle:function(e,t){var s=e[0];e=e[1];var i=t[0];t=t[1];var r=Math.sqrt((s*s+e*e)*(i*i+t*t));return Math.acos(Math.min(Math.max(r&&(s*i+e*t)/r,-1),1))},zero:function(e){return e[0]=0,e[1]=0,e},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,t){var s=e[0];e=e[1];var i=t[0];return t=t[1],Math.abs(s-i)<=1e-6*Math.max(1,Math.abs(s),Math.abs(i))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},len:pe,sub:oe,mul:he,div:le,dist:ce,sqrDist:ue,sqrLen:_e,forEach:ve}),e.glMatrix=Ce,e.mat2=Se,e.mat2d=ye,e.mat3=$e,e.mat4=Ge,e.quat=be,e.quat2=Pe,e.vec2=ve,e.vec3=Ie,e.vec4=Te,Object.defineProperty(e,"__esModule",{value:!0})})),self.GraphemeSplitter=function(){function e(e,t){void 0===t&&(t=0);var s=e.charCodeAt(t);if(55296<=s&&56319>=s&&t<e.length-1){var i=s;return 56320<=(e=e.charCodeAt(t+1))&&57343>=e?1024*(i-55296)+(e-56320)+65536:i}return 56320<=s&&57343>=s&&1<=t?(i=e.charCodeAt(t-1),e=s,55296<=i&&56319>=i?1024*(i-55296)+(e-56320)+65536:e):s}function t(e,t,s){var i=[e].concat(t).concat([s]),r=i[i.length-2],n=i.lastIndexOf(14);return 1<n&&i.slice(1,n).every((function(e){return 3==e}))&&-1==[3,13,17].indexOf(e)?2:0<(e=i.lastIndexOf(4))&&i.slice(1,e).every((function(e){return 4==e}))&&-1==[12,4].indexOf(r)?1==i.filter((function(e){return 4==e})).length%2?3:4:0==r&&1==s?0:2==r||0==r||1==r?14==s&&t.every((function(e){return 3==e}))?2:1:2==s||0==s||1==s?1:(6!=r||6!=s&&7!=s&&9!=s&&10!=s)&&(9!=r&&7!=r||7!=s&&8!=s)&&(10!=r&&8!=r||8!=s)?3==s||15==s||5==s||12==r?0:(e=-1!=i.indexOf(3)?i.lastIndexOf(3)-1:i.length-2,-1!=[13,17].indexOf(i[e])&&i.slice(e+1,-1).every((function(e){return 3==e}))&&14==s||15==r&&-1!=[16,17].indexOf(s)?0:-1!=t.indexOf(4)?2:4==r&&4==s?0:1):0}function s(e){return 1536<=e&&1541>=e||1757==e||1807==e||2274==e||3406==e||69821==e||70082<=e&&70083>=e||72250==e||72326<=e&&72329>=e||73030==e?12:13==e?0:10==e?1:0<=e&&9>=e||11<=e&&12>=e||14<=e&&31>=e||127<=e&&159>=e||173==e||1564==e||6158==e||8203==e||8206<=e&&8207>=e||8232==e||8233==e||8234<=e&&8238>=e||8288<=e&&8292>=e||8293==e||8294<=e&&8303>=e||55296<=e&&57343>=e||65279==e||65520<=e&&65528>=e||65529<=e&&65531>=e||113824<=e&&113827>=e||119155<=e&&119162>=e||917504==e||917505==e||917506<=e&&917535>=e||917632<=e&&917759>=e||918e3<=e&&921599>=e?2:768<=e&&879>=e||1155<=e&&1159>=e||1160<=e&&1161>=e||1425<=e&&1469>=e||1471==e||1473<=e&&1474>=e||1476<=e&&1477>=e||1479==e||1552<=e&&1562>=e||1611<=e&&1631>=e||1648==e||1750<=e&&1756>=e||1759<=e&&1764>=e||1767<=e&&1768>=e||1770<=e&&1773>=e||1809==e||1840<=e&&1866>=e||1958<=e&&1968>=e||2027<=e&&2035>=e||2070<=e&&2073>=e||2075<=e&&2083>=e||2085<=e&&2087>=e||2089<=e&&2093>=e||2137<=e&&2139>=e||2260<=e&&2273>=e||2275<=e&&2306>=e||2362==e||2364==e||2369<=e&&2376>=e||2381==e||2385<=e&&2391>=e||2402<=e&&2403>=e||2433==e||2492==e||2494==e||2497<=e&&2500>=e||2509==e||2519==e||2530<=e&&2531>=e||2561<=e&&2562>=e||2620==e||2625<=e&&2626>=e||2631<=e&&2632>=e||2635<=e&&2637>=e||2641==e||2672<=e&&2673>=e||2677==e||2689<=e&&2690>=e||2748==e||2753<=e&&2757>=e||2759<=e&&2760>=e||2765==e||2786<=e&&2787>=e||2810<=e&&2815>=e||2817==e||2876==e||2878==e||2879==e||2881<=e&&2884>=e||2893==e||2902==e||2903==e||2914<=e&&2915>=e||2946==e||3006==e||3008==e||3021==e||3031==e||3072==e||3134<=e&&3136>=e||3142<=e&&3144>=e||3146<=e&&3149>=e||3157<=e&&3158>=e||3170<=e&&3171>=e||3201==e||3260==e||3263==e||3266==e||3270==e||3276<=e&&3277>=e||3285<=e&&3286>=e||3298<=e&&3299>=e||3328<=e&&3329>=e||3387<=e&&3388>=e||3390==e||3393<=e&&3396>=e||3405==e||3415==e||3426<=e&&3427>=e||3530==e||3535==e||3538<=e&&3540>=e||3542==e||3551==e||3633==e||3636<=e&&3642>=e||3655<=e&&3662>=e||3761==e||3764<=e&&3769>=e||3771<=e&&3772>=e||3784<=e&&3789>=e||3864<=e&&3865>=e||3893==e||3895==e||3897==e||3953<=e&&3966>=e||3968<=e&&3972>=e||3974<=e&&3975>=e||3981<=e&&3991>=e||3993<=e&&4028>=e||4038==e||4141<=e&&4144>=e||4146<=e&&4151>=e||4153<=e&&4154>=e||4157<=e&&4158>=e||4184<=e&&4185>=e||4190<=e&&4192>=e||4209<=e&&4212>=e||4226==e||4229<=e&&4230>=e||4237==e||4253==e||4957<=e&&4959>=e||5906<=e&&5908>=e||5938<=e&&5940>=e||5970<=e&&5971>=e||6002<=e&&6003>=e||6068<=e&&6069>=e||6071<=e&&6077>=e||6086==e||6089<=e&&6099>=e||6109==e||6155<=e&&6157>=e||6277<=e&&6278>=e||6313==e||6432<=e&&6434>=e||6439<=e&&6440>=e||6450==e||6457<=e&&6459>=e||6679<=e&&6680>=e||6683==e||6742==e||6744<=e&&6750>=e||6752==e||6754==e||6757<=e&&6764>=e||6771<=e&&6780>=e||6783==e||6832<=e&&6845>=e||6846==e||6912<=e&&6915>=e||6964==e||6966<=e&&6970>=e||6972==e||6978==e||7019<=e&&7027>=e||7040<=e&&7041>=e||7074<=e&&7077>=e||7080<=e&&7081>=e||7083<=e&&7085>=e||7142==e||7144<=e&&7145>=e||7149==e||7151<=e&&7153>=e||7212<=e&&7219>=e||7222<=e&&7223>=e||7376<=e&&7378>=e||7380<=e&&7392>=e||7394<=e&&7400>=e||7405==e||7412==e||7416<=e&&7417>=e||7616<=e&&7673>=e||7675<=e&&7679>=e||8204==e||8400<=e&&8412>=e||8413<=e&&8416>=e||8417==e||8418<=e&&8420>=e||8421<=e&&8432>=e||11503<=e&&11505>=e||11647==e||11744<=e&&11775>=e||12330<=e&&12333>=e||12334<=e&&12335>=e||12441<=e&&12442>=e||42607==e||42608<=e&&42610>=e||42612<=e&&42621>=e||42654<=e&&42655>=e||42736<=e&&42737>=e||43010==e||43014==e||43019==e||43045<=e&&43046>=e||43204<=e&&43205>=e||43232<=e&&43249>=e||43302<=e&&43309>=e||43335<=e&&43345>=e||43392<=e&&43394>=e||43443==e||43446<=e&&43449>=e||43452==e||43493==e||43561<=e&&43566>=e||43569<=e&&43570>=e||43573<=e&&43574>=e||43587==e||43596==e||43644==e||43696==e||43698<=e&&43700>=e||43703<=e&&43704>=e||43710<=e&&43711>=e||43713==e||43756<=e&&43757>=e||43766==e||44005==e||44008==e||44013==e||64286==e||65024<=e&&65039>=e||65056<=e&&65071>=e||65438<=e&&65439>=e||66045==e||66272==e||66422<=e&&66426>=e||68097<=e&&68099>=e||68101<=e&&68102>=e||68108<=e&&68111>=e||68152<=e&&68154>=e||68159==e||68325<=e&&68326>=e||69633==e||69688<=e&&69702>=e||69759<=e&&69761>=e||69811<=e&&69814>=e||69817<=e&&69818>=e||69888<=e&&69890>=e||69927<=e&&69931>=e||69933<=e&&69940>=e||70003==e||70016<=e&&70017>=e||70070<=e&&70078>=e||70090<=e&&70092>=e||70191<=e&&70193>=e||70196==e||70198<=e&&70199>=e||70206==e||70367==e||70371<=e&&70378>=e||70400<=e&&70401>=e||70460==e||70462==e||70464==e||70487==e||70502<=e&&70508>=e||70512<=e&&70516>=e||70712<=e&&70719>=e||70722<=e&&70724>=e||70726==e||70832==e||70835<=e&&70840>=e||70842==e||70845==e||70847<=e&&70848>=e||70850<=e&&70851>=e||71087==e||71090<=e&&71093>=e||71100<=e&&71101>=e||71103<=e&&71104>=e||71132<=e&&71133>=e||71219<=e&&71226>=e||71229==e||71231<=e&&71232>=e||71339==e||71341==e||71344<=e&&71349>=e||71351==e||71453<=e&&71455>=e||71458<=e&&71461>=e||71463<=e&&71467>=e||72193<=e&&72198>=e||72201<=e&&72202>=e||72243<=e&&72248>=e||72251<=e&&72254>=e||72263==e||72273<=e&&72278>=e||72281<=e&&72283>=e||72330<=e&&72342>=e||72344<=e&&72345>=e||72752<=e&&72758>=e||72760<=e&&72765>=e||72767==e||72850<=e&&72871>=e||72874<=e&&72880>=e||72882<=e&&72883>=e||72885<=e&&72886>=e||73009<=e&&73014>=e||73018==e||73020<=e&&73021>=e||73023<=e&&73029>=e||73031==e||92912<=e&&92916>=e||92976<=e&&92982>=e||94095<=e&&94098>=e||113821<=e&&113822>=e||119141==e||119143<=e&&119145>=e||119150<=e&&119154>=e||119163<=e&&119170>=e||119173<=e&&119179>=e||119210<=e&&119213>=e||119362<=e&&119364>=e||121344<=e&&121398>=e||121403<=e&&121452>=e||121461==e||121476==e||121499<=e&&121503>=e||121505<=e&&121519>=e||122880<=e&&122886>=e||122888<=e&&122904>=e||122907<=e&&122913>=e||122915<=e&&122916>=e||122918<=e&&122922>=e||125136<=e&&125142>=e||125252<=e&&125258>=e||917536<=e&&917631>=e||917760<=e&&917999>=e?3:127462<=e&&127487>=e?4:2307==e||2363==e||2366<=e&&2368>=e||2377<=e&&2380>=e||2382<=e&&2383>=e||2434<=e&&2435>=e||2495<=e&&2496>=e||2503<=e&&2504>=e||2507<=e&&2508>=e||2563==e||2622<=e&&2624>=e||2691==e||2750<=e&&2752>=e||2761==e||2763<=e&&2764>=e||2818<=e&&2819>=e||2880==e||2887<=e&&2888>=e||2891<=e&&2892>=e||3007==e||3009<=e&&3010>=e||3014<=e&&3016>=e||3018<=e&&3020>=e||3073<=e&&3075>=e||3137<=e&&3140>=e||3202<=e&&3203>=e||3262==e||3264<=e&&3265>=e||3267<=e&&3268>=e||3271<=e&&3272>=e||3274<=e&&3275>=e||3330<=e&&3331>=e||3391<=e&&3392>=e||3398<=e&&3400>=e||3402<=e&&3404>=e||3458<=e&&3459>=e||3536<=e&&3537>=e||3544<=e&&3550>=e||3570<=e&&3571>=e||3635==e||3763==e||3902<=e&&3903>=e||3967==e||4145==e||4155<=e&&4156>=e||4182<=e&&4183>=e||4228==e||6070==e||6078<=e&&6085>=e||6087<=e&&6088>=e||6435<=e&&6438>=e||6441<=e&&6443>=e||6448<=e&&6449>=e||6451<=e&&6456>=e||6681<=e&&6682>=e||6741==e||6743==e||6765<=e&&6770>=e||6916==e||6965==e||6971==e||6973<=e&&6977>=e||6979<=e&&6980>=e||7042==e||7073==e||7078<=e&&7079>=e||7082==e||7143==e||7146<=e&&7148>=e||7150==e||7154<=e&&7155>=e||7204<=e&&7211>=e||7220<=e&&7221>=e||7393==e||7410<=e&&7411>=e||7415==e||43043<=e&&43044>=e||43047==e||43136<=e&&43137>=e||43188<=e&&43203>=e||43346<=e&&43347>=e||43395==e||43444<=e&&43445>=e||43450<=e&&43451>=e||43453<=e&&43456>=e||43567<=e&&43568>=e||43571<=e&&43572>=e||43597==e||43755==e||43758<=e&&43759>=e||43765==e||44003<=e&&44004>=e||44006<=e&&44007>=e||44009<=e&&44010>=e||44012==e||69632==e||69634==e||69762==e||69808<=e&&69810>=e||69815<=e&&69816>=e||69932==e||70018==e||70067<=e&&70069>=e||70079<=e&&70080>=e||70188<=e&&70190>=e||70194<=e&&70195>=e||70197==e||70368<=e&&70370>=e||70402<=e&&70403>=e||70463==e||70465<=e&&70468>=e||70471<=e&&70472>=e||70475<=e&&70477>=e||70498<=e&&70499>=e||70709<=e&&70711>=e||70720<=e&&70721>=e||70725==e||70833<=e&&70834>=e||70841==e||70843<=e&&70844>=e||70846==e||70849==e||71088<=e&&71089>=e||71096<=e&&71099>=e||71102==e||71216<=e&&71218>=e||71227<=e&&71228>=e||71230==e||71340==e||71342<=e&&71343>=e||71350==e||71456<=e&&71457>=e||71462==e||72199<=e&&72200>=e||72249==e||72279<=e&&72280>=e||72343==e||72751==e||72766==e||72873==e||72881==e||72884==e||94033<=e&&94078>=e||119142==e||119149==e?5:4352<=e&&4447>=e||43360<=e&&43388>=e?6:4448<=e&&4519>=e||55216<=e&&55238>=e?7:4520<=e&&4607>=e||55243<=e&&55291>=e?8:44032==e||44060==e||44088==e||44116==e||44144==e||44172==e||44200==e||44228==e||44256==e||44284==e||44312==e||44340==e||44368==e||44396==e||44424==e||44452==e||44480==e||44508==e||44536==e||44564==e||44592==e||44620==e||44648==e||44676==e||44704==e||44732==e||44760==e||44788==e||44816==e||44844==e||44872==e||44900==e||44928==e||44956==e||44984==e||45012==e||45040==e||45068==e||45096==e||45124==e||45152==e||45180==e||45208==e||45236==e||45264==e||45292==e||45320==e||45348==e||45376==e||45404==e||45432==e||45460==e||45488==e||45516==e||45544==e||45572==e||45600==e||45628==e||45656==e||45684==e||45712==e||45740==e||45768==e||45796==e||45824==e||45852==e||45880==e||45908==e||45936==e||45964==e||45992==e||46020==e||46048==e||46076==e||46104==e||46132==e||46160==e||46188==e||46216==e||46244==e||46272==e||46300==e||46328==e||46356==e||46384==e||46412==e||46440==e||46468==e||46496==e||46524==e||46552==e||46580==e||46608==e||46636==e||46664==e||46692==e||46720==e||46748==e||46776==e||46804==e||46832==e||46860==e||46888==e||46916==e||46944==e||46972==e||47e3==e||47028==e||47056==e||47084==e||47112==e||47140==e||47168==e||47196==e||47224==e||47252==e||47280==e||47308==e||47336==e||47364==e||47392==e||47420==e||47448==e||47476==e||47504==e||47532==e||47560==e||47588==e||47616==e||47644==e||47672==e||47700==e||47728==e||47756==e||47784==e||47812==e||47840==e||47868==e||47896==e||47924==e||47952==e||47980==e||48008==e||48036==e||48064==e||48092==e||48120==e||48148==e||48176==e||48204==e||48232==e||48260==e||48288==e||48316==e||48344==e||48372==e||48400==e||48428==e||48456==e||48484==e||48512==e||48540==e||48568==e||48596==e||48624==e||48652==e||48680==e||48708==e||48736==e||48764==e||48792==e||48820==e||48848==e||48876==e||48904==e||48932==e||48960==e||48988==e||49016==e||49044==e||49072==e||49100==e||49128==e||49156==e||49184==e||49212==e||49240==e||49268==e||49296==e||49324==e||49352==e||49380==e||49408==e||49436==e||49464==e||49492==e||49520==e||49548==e||49576==e||49604==e||49632==e||49660==e||49688==e||49716==e||49744==e||49772==e||49800==e||49828==e||49856==e||49884==e||49912==e||49940==e||49968==e||49996==e||50024==e||50052==e||50080==e||50108==e||50136==e||50164==e||50192==e||50220==e||50248==e||50276==e||50304==e||50332==e||50360==e||50388==e||50416==e||50444==e||50472==e||50500==e||50528==e||50556==e||50584==e||50612==e||50640==e||50668==e||50696==e||50724==e||50752==e||50780==e||50808==e||50836==e||50864==e||50892==e||50920==e||50948==e||50976==e||51004==e||51032==e||51060==e||51088==e||51116==e||51144==e||51172==e||51200==e||51228==e||51256==e||51284==e||51312==e||51340==e||51368==e||51396==e||51424==e||51452==e||51480==e||51508==e||51536==e||51564==e||51592==e||51620==e||51648==e||51676==e||51704==e||51732==e||51760==e||51788==e||51816==e||51844==e||51872==e||51900==e||51928==e||51956==e||51984==e||52012==e||52040==e||52068==e||52096==e||52124==e||52152==e||52180==e||52208==e||52236==e||52264==e||52292==e||52320==e||52348==e||52376==e||52404==e||52432==e||52460==e||52488==e||52516==e||52544==e||52572==e||52600==e||52628==e||52656==e||52684==e||52712==e||52740==e||52768==e||52796==e||52824==e||52852==e||52880==e||52908==e||52936==e||52964==e||52992==e||53020==e||53048==e||53076==e||53104==e||53132==e||53160==e||53188==e||53216==e||53244==e||53272==e||53300==e||53328==e||53356==e||53384==e||53412==e||53440==e||53468==e||53496==e||53524==e||53552==e||53580==e||53608==e||53636==e||53664==e||53692==e||53720==e||53748==e||53776==e||53804==e||53832==e||53860==e||53888==e||53916==e||53944==e||53972==e||54e3==e||54028==e||54056==e||54084==e||54112==e||54140==e||54168==e||54196==e||54224==e||54252==e||54280==e||54308==e||54336==e||54364==e||54392==e||54420==e||54448==e||54476==e||54504==e||54532==e||54560==e||54588==e||54616==e||54644==e||54672==e||54700==e||54728==e||54756==e||54784==e||54812==e||54840==e||54868==e||54896==e||54924==e||54952==e||54980==e||55008==e||55036==e||55064==e||55092==e||55120==e||55148==e||55176==e?9:44033<=e&&44059>=e||44061<=e&&44087>=e||44089<=e&&44115>=e||44117<=e&&44143>=e||44145<=e&&44171>=e||44173<=e&&44199>=e||44201<=e&&44227>=e||44229<=e&&44255>=e||44257<=e&&44283>=e||44285<=e&&44311>=e||44313<=e&&44339>=e||44341<=e&&44367>=e||44369<=e&&44395>=e||44397<=e&&44423>=e||44425<=e&&44451>=e||44453<=e&&44479>=e||44481<=e&&44507>=e||44509<=e&&44535>=e||44537<=e&&44563>=e||44565<=e&&44591>=e||44593<=e&&44619>=e||44621<=e&&44647>=e||44649<=e&&44675>=e||44677<=e&&44703>=e||44705<=e&&44731>=e||44733<=e&&44759>=e||44761<=e&&44787>=e||44789<=e&&44815>=e||44817<=e&&44843>=e||44845<=e&&44871>=e||44873<=e&&44899>=e||44901<=e&&44927>=e||44929<=e&&44955>=e||44957<=e&&44983>=e||44985<=e&&45011>=e||45013<=e&&45039>=e||45041<=e&&45067>=e||45069<=e&&45095>=e||45097<=e&&45123>=e||45125<=e&&45151>=e||45153<=e&&45179>=e||45181<=e&&45207>=e||45209<=e&&45235>=e||45237<=e&&45263>=e||45265<=e&&45291>=e||45293<=e&&45319>=e||45321<=e&&45347>=e||45349<=e&&45375>=e||45377<=e&&45403>=e||45405<=e&&45431>=e||45433<=e&&45459>=e||45461<=e&&45487>=e||45489<=e&&45515>=e||45517<=e&&45543>=e||45545<=e&&45571>=e||45573<=e&&45599>=e||45601<=e&&45627>=e||45629<=e&&45655>=e||45657<=e&&45683>=e||45685<=e&&45711>=e||45713<=e&&45739>=e||45741<=e&&45767>=e||45769<=e&&45795>=e||45797<=e&&45823>=e||45825<=e&&45851>=e||45853<=e&&45879>=e||45881<=e&&45907>=e||45909<=e&&45935>=e||45937<=e&&45963>=e||45965<=e&&45991>=e||45993<=e&&46019>=e||46021<=e&&46047>=e||46049<=e&&46075>=e||46077<=e&&46103>=e||46105<=e&&46131>=e||46133<=e&&46159>=e||46161<=e&&46187>=e||46189<=e&&46215>=e||46217<=e&&46243>=e||46245<=e&&46271>=e||46273<=e&&46299>=e||46301<=e&&46327>=e||46329<=e&&46355>=e||46357<=e&&46383>=e||46385<=e&&46411>=e||46413<=e&&46439>=e||46441<=e&&46467>=e||46469<=e&&46495>=e||46497<=e&&46523>=e||46525<=e&&46551>=e||46553<=e&&46579>=e||46581<=e&&46607>=e||46609<=e&&46635>=e||46637<=e&&46663>=e||46665<=e&&46691>=e||46693<=e&&46719>=e||46721<=e&&46747>=e||46749<=e&&46775>=e||46777<=e&&46803>=e||46805<=e&&46831>=e||46833<=e&&46859>=e||46861<=e&&46887>=e||46889<=e&&46915>=e||46917<=e&&46943>=e||46945<=e&&46971>=e||46973<=e&&46999>=e||47001<=e&&47027>=e||47029<=e&&47055>=e||47057<=e&&47083>=e||47085<=e&&47111>=e||47113<=e&&47139>=e||47141<=e&&47167>=e||47169<=e&&47195>=e||47197<=e&&47223>=e||47225<=e&&47251>=e||47253<=e&&47279>=e||47281<=e&&47307>=e||47309<=e&&47335>=e||47337<=e&&47363>=e||47365<=e&&47391>=e||47393<=e&&47419>=e||47421<=e&&47447>=e||47449<=e&&47475>=e||47477<=e&&47503>=e||47505<=e&&47531>=e||47533<=e&&47559>=e||47561<=e&&47587>=e||47589<=e&&47615>=e||47617<=e&&47643>=e||47645<=e&&47671>=e||47673<=e&&47699>=e||47701<=e&&47727>=e||47729<=e&&47755>=e||47757<=e&&47783>=e||47785<=e&&47811>=e||47813<=e&&47839>=e||47841<=e&&47867>=e||47869<=e&&47895>=e||47897<=e&&47923>=e||47925<=e&&47951>=e||47953<=e&&47979>=e||47981<=e&&48007>=e||48009<=e&&48035>=e||48037<=e&&48063>=e||48065<=e&&48091>=e||48093<=e&&48119>=e||48121<=e&&48147>=e||48149<=e&&48175>=e||48177<=e&&48203>=e||48205<=e&&48231>=e||48233<=e&&48259>=e||48261<=e&&48287>=e||48289<=e&&48315>=e||48317<=e&&48343>=e||48345<=e&&48371>=e||48373<=e&&48399>=e||48401<=e&&48427>=e||48429<=e&&48455>=e||48457<=e&&48483>=e||48485<=e&&48511>=e||48513<=e&&48539>=e||48541<=e&&48567>=e||48569<=e&&48595>=e||48597<=e&&48623>=e||48625<=e&&48651>=e||48653<=e&&48679>=e||48681<=e&&48707>=e||48709<=e&&48735>=e||48737<=e&&48763>=e||48765<=e&&48791>=e||48793<=e&&48819>=e||48821<=e&&48847>=e||48849<=e&&48875>=e||48877<=e&&48903>=e||48905<=e&&48931>=e||48933<=e&&48959>=e||48961<=e&&48987>=e||48989<=e&&49015>=e||49017<=e&&49043>=e||49045<=e&&49071>=e||49073<=e&&49099>=e||49101<=e&&49127>=e||49129<=e&&49155>=e||49157<=e&&49183>=e||49185<=e&&49211>=e||49213<=e&&49239>=e||49241<=e&&49267>=e||49269<=e&&49295>=e||49297<=e&&49323>=e||49325<=e&&49351>=e||49353<=e&&49379>=e||49381<=e&&49407>=e||49409<=e&&49435>=e||49437<=e&&49463>=e||49465<=e&&49491>=e||49493<=e&&49519>=e||49521<=e&&49547>=e||49549<=e&&49575>=e||49577<=e&&49603>=e||49605<=e&&49631>=e||49633<=e&&49659>=e||49661<=e&&49687>=e||49689<=e&&49715>=e||49717<=e&&49743>=e||49745<=e&&49771>=e||49773<=e&&49799>=e||49801<=e&&49827>=e||49829<=e&&49855>=e||49857<=e&&49883>=e||49885<=e&&49911>=e||49913<=e&&49939>=e||49941<=e&&49967>=e||49969<=e&&49995>=e||49997<=e&&50023>=e||50025<=e&&50051>=e||50053<=e&&50079>=e||50081<=e&&50107>=e||50109<=e&&50135>=e||50137<=e&&50163>=e||50165<=e&&50191>=e||50193<=e&&50219>=e||50221<=e&&50247>=e||50249<=e&&50275>=e||50277<=e&&50303>=e||50305<=e&&50331>=e||50333<=e&&50359>=e||50361<=e&&50387>=e||50389<=e&&50415>=e||50417<=e&&50443>=e||50445<=e&&50471>=e||50473<=e&&50499>=e||50501<=e&&50527>=e||50529<=e&&50555>=e||50557<=e&&50583>=e||50585<=e&&50611>=e||50613<=e&&50639>=e||50641<=e&&50667>=e||50669<=e&&50695>=e||50697<=e&&50723>=e||50725<=e&&50751>=e||50753<=e&&50779>=e||50781<=e&&50807>=e||50809<=e&&50835>=e||50837<=e&&50863>=e||50865<=e&&50891>=e||50893<=e&&50919>=e||50921<=e&&50947>=e||50949<=e&&50975>=e||50977<=e&&51003>=e||51005<=e&&51031>=e||51033<=e&&51059>=e||51061<=e&&51087>=e||51089<=e&&51115>=e||51117<=e&&51143>=e||51145<=e&&51171>=e||51173<=e&&51199>=e||51201<=e&&51227>=e||51229<=e&&51255>=e||51257<=e&&51283>=e||51285<=e&&51311>=e||51313<=e&&51339>=e||51341<=e&&51367>=e||51369<=e&&51395>=e||51397<=e&&51423>=e||51425<=e&&51451>=e||51453<=e&&51479>=e||51481<=e&&51507>=e||51509<=e&&51535>=e||51537<=e&&51563>=e||51565<=e&&51591>=e||51593<=e&&51619>=e||51621<=e&&51647>=e||51649<=e&&51675>=e||51677<=e&&51703>=e||51705<=e&&51731>=e||51733<=e&&51759>=e||51761<=e&&51787>=e||51789<=e&&51815>=e||51817<=e&&51843>=e||51845<=e&&51871>=e||51873<=e&&51899>=e||51901<=e&&51927>=e||51929<=e&&51955>=e||51957<=e&&51983>=e||51985<=e&&52011>=e||52013<=e&&52039>=e||52041<=e&&52067>=e||52069<=e&&52095>=e||52097<=e&&52123>=e||52125<=e&&52151>=e||52153<=e&&52179>=e||52181<=e&&52207>=e||52209<=e&&52235>=e||52237<=e&&52263>=e||52265<=e&&52291>=e||52293<=e&&52319>=e||52321<=e&&52347>=e||52349<=e&&52375>=e||52377<=e&&52403>=e||52405<=e&&52431>=e||52433<=e&&52459>=e||52461<=e&&52487>=e||52489<=e&&52515>=e||52517<=e&&52543>=e||52545<=e&&52571>=e||52573<=e&&52599>=e||52601<=e&&52627>=e||52629<=e&&52655>=e||52657<=e&&52683>=e||52685<=e&&52711>=e||52713<=e&&52739>=e||52741<=e&&52767>=e||52769<=e&&52795>=e||52797<=e&&52823>=e||52825<=e&&52851>=e||52853<=e&&52879>=e||52881<=e&&52907>=e||52909<=e&&52935>=e||52937<=e&&52963>=e||52965<=e&&52991>=e||52993<=e&&53019>=e||53021<=e&&53047>=e||53049<=e&&53075>=e||53077<=e&&53103>=e||53105<=e&&53131>=e||53133<=e&&53159>=e||53161<=e&&53187>=e||53189<=e&&53215>=e||53217<=e&&53243>=e||53245<=e&&53271>=e||53273<=e&&53299>=e||53301<=e&&53327>=e||53329<=e&&53355>=e||53357<=e&&53383>=e||53385<=e&&53411>=e||53413<=e&&53439>=e||53441<=e&&53467>=e||53469<=e&&53495>=e||53497<=e&&53523>=e||53525<=e&&53551>=e||53553<=e&&53579>=e||53581<=e&&53607>=e||53609<=e&&53635>=e||53637<=e&&53663>=e||53665<=e&&53691>=e||53693<=e&&53719>=e||53721<=e&&53747>=e||53749<=e&&53775>=e||53777<=e&&53803>=e||53805<=e&&53831>=e||53833<=e&&53859>=e||53861<=e&&53887>=e||53889<=e&&53915>=e||53917<=e&&53943>=e||53945<=e&&53971>=e||53973<=e&&53999>=e||54001<=e&&54027>=e||54029<=e&&54055>=e||54057<=e&&54083>=e||54085<=e&&54111>=e||54113<=e&&54139>=e||54141<=e&&54167>=e||54169<=e&&54195>=e||54197<=e&&54223>=e||54225<=e&&54251>=e||54253<=e&&54279>=e||54281<=e&&54307>=e||54309<=e&&54335>=e||54337<=e&&54363>=e||54365<=e&&54391>=e||54393<=e&&54419>=e||54421<=e&&54447>=e||54449<=e&&54475>=e||54477<=e&&54503>=e||54505<=e&&54531>=e||54533<=e&&54559>=e||54561<=e&&54587>=e||54589<=e&&54615>=e||54617<=e&&54643>=e||54645<=e&&54671>=e||54673<=e&&54699>=e||54701<=e&&54727>=e||54729<=e&&54755>=e||54757<=e&&54783>=e||54785<=e&&54811>=e||54813<=e&&54839>=e||54841<=e&&54867>=e||54869<=e&&54895>=e||54897<=e&&54923>=e||54925<=e&&54951>=e||54953<=e&&54979>=e||54981<=e&&55007>=e||55009<=e&&55035>=e||55037<=e&&55063>=e||55065<=e&&55091>=e||55093<=e&&55119>=e||55121<=e&&55147>=e||55149<=e&&55175>=e||55177<=e&&55203>=e?10:9757==e||9977==e||9994<=e&&9997>=e||127877==e||127938<=e&&127940>=e||127943==e||127946<=e&&127948>=e||128066<=e&&128067>=e||128070<=e&&128080>=e||128110==e||128112<=e&&128120>=e||128124==e||128129<=e&&128131>=e||128133<=e&&128135>=e||128170==e||128372<=e&&128373>=e||128378==e||128400==e||128405<=e&&128406>=e||128581<=e&&128583>=e||128587<=e&&128591>=e||128675==e||128692<=e&&128694>=e||128704==e||128716==e||129304<=e&&129308>=e||129310<=e&&129311>=e||129318==e||129328<=e&&129337>=e||129341<=e&&129342>=e||129489<=e&&129501>=e?13:127995<=e&&127999>=e?14:8205==e?15:9792==e||9794==e||9877<=e&&9878>=e||9992==e||10084==e||127752==e||127806==e||127859==e||127891==e||127908==e||127912==e||127979==e||127981==e||128139==e||128187<=e&&128188>=e||128295==e||128300==e||128488==e||128640==e||128658==e?16:128102<=e&&128105>=e?17:11}return this.nextBreak=function(i,r){if(void 0===r&&(r=0),0>r)return 0;if(r>=i.length-1)return i.length;var n=s(e(i,r)),a=[];for(r+=1;r<i.length;r++){var o=i,h=r-1;if(!(55296<=o.charCodeAt(h)&&56319>=o.charCodeAt(h)&&56320<=o.charCodeAt(h+1)&&57343>=o.charCodeAt(h+1))){if(t(n,a,o=s(e(i,r))))return r;a.push(o)}}return i.length},this.splitGraphemes=function(e){for(var t,s=[],i=0;(t=this.nextBreak(e,i))<e.length;)s.push(e.slice(i,t)),i=t;return i<e.length&&s.push(e.slice(i)),s},this.iterateGraphemes=function(e){var t=0,s={next:function(){var s;if((s=this.nextBreak(e,t))<e.length){var i=e.slice(t,s);return t=s,{value:i,done:!1}}return t<e.length?(i=e.slice(t),t=e.length,{value:i,done:!1}):{value:void 0,done:!0}}.bind(this)};return"undefined"!=typeof Symbol&&Symbol.iterator&&(s[Symbol.iterator]=function(){return s}),s},this.countGraphemes=function(e){for(var t,s=0,i=0;(t=this.nextBreak(e,i))<e.length;)i=t,s++;return i<e.length&&s++,s},this};var tmpPoint1$$module$str$c3runtime=[],tmpPoint2$$module$str$c3runtime=[];function collinear(e,t,s,i){if(i){var r=tmpPoint1$$module$str$c3runtime,n=tmpPoint2$$module$str$c3runtime;return r[0]=t[0]-e[0],r[1]=t[1]-e[1],n[0]=s[0]-t[0],n[1]=s[1]-t[1],Math.acos((r[0]*n[0]+r[1]*n[1])/(Math.sqrt(r[0]*r[0]+r[1]*r[1])*Math.sqrt(n[0]*n[0]+n[1]*n[1])))<i}return 0===triangleArea(e,t,s)}function sqdist(e,t){var s=t[0]-e[0];return s*s+(e=t[1]-e[1])*e}function polygonAt(e,t){var s=e.length;return e[0>t?t%s+s:t%s]}function polygonClear(e){e.length=0}function polygonAppend(e,t,s,i){for(;s<i;s++)e.push(t[s])}function polygonReverse(e){for(var t=[],s=e.length,i=0;i!==s;i++)t.push(e.pop());for(i=0;i!==s;i++)e[i]=t[i]}function polygonIsReflex(e,t){return isRight(polygonAt(e,t-1),polygonAt(e,t),polygonAt(e,t+1))}var tmpLine1$$module$str$c3runtime=[],tmpLine2$$module$str$c3runtime=[];function polygonCanSee(e,t,s){var i=tmpLine1$$module$str$c3runtime,r=tmpLine2$$module$str$c3runtime;if(isLeftOn(polygonAt(e,t+1),polygonAt(e,t),polygonAt(e,s))&&isRightOn(polygonAt(e,t-1),polygonAt(e,t),polygonAt(e,s)))return!1;for(var n=sqdist(polygonAt(e,t),polygonAt(e,s)),a=0;a!==e.length;++a)if((a+1)%e.length!==t&&a!==t&&isLeftOn(polygonAt(e,t),polygonAt(e,s),polygonAt(e,a+1))&&isRightOn(polygonAt(e,t),polygonAt(e,s),polygonAt(e,a))){i[0]=polygonAt(e,t),i[1]=polygonAt(e,s),r[0]=polygonAt(e,a),r[1]=polygonAt(e,a+1);var o=lineInt(i,r);if(sqdist(polygonAt(e,t),o)<n)return!1}return!0}function polygonCanSee2(e,t,s){for(var i=0;i!==e.length;++i)if(i!==t&&i!==s&&(i+1)%e.length!==t&&(i+1)%e.length!==s&&lineSegmentsIntersect(polygonAt(e,t),polygonAt(e,s),polygonAt(e,i),polygonAt(e,i+1)))return!1;return!0}function polygonCopy(e,t,s,i){if(polygonClear(i=i||[]),t<s)for(var r=t;r<=s;r++)i.push(e[r]);else{for(r=0;r<=s;r++)i.push(e[r]);for(r=t;r<e.length;r++)i.push(e[r])}return i}function polygonGetCutEdges(e){for(var t,s,i=[],r=[],n=Number.MAX_VALUE,a=0;a<e.length;++a)if(polygonIsReflex(e,a))for(var o=0;o<e.length;++o)if(polygonCanSee(e,a,o)){t=polygonGetCutEdges(polygonCopy(e,a,o,r)),s=polygonGetCutEdges(polygonCopy(e,o,a,r));for(var h=0;h<s.length;h++)t.push(s[h]);t.length<n&&(i=t,n=t.length,i.push([polygonAt(e,a),polygonAt(e,o)]))}return i}function polygonSlice(e,t){if(0===t.length)return[e];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2===t[0].length&&t[0][0]instanceof Array){e=[e];for(var s=0;s<t.length;s++)for(var i=t[s],r=0;r<e.length;r++){var n=polygonSlice(e[r],i);if(n){e.splice(r,1),e.push(n[0],n[1]);break}}return e}return i=t,s=e.indexOf(i[0]),r=e.indexOf(i[1]),-1!==s&&-1!==r&&[polygonCopy(e,s,r),polygonCopy(e,r,s)]}function getIntersectionPoint(e,t,s,i,r){var n=t[1]-e[1];t=e[0]-t[0],e=n*e[0]+t*e[1];var a=i[1]-s[1];i=s[0]-i[0],s=a*s[0]+i*s[1];var o=n*i-a*t;return scalar_eq(o,0,r||0)?[0,0]:[(i*e-t*s)/o,(n*s-a*e)/o]}function polygonQuickDecomp(e,t,s,i,r,n,a){n=n||100,a=a||0,r=r||25,t=void 0!==t?t:[],s=s||[],i=i||[];var o,h=[0,0],l=[0,0],c=[0,0],u=0,p=0,_=0,m=[],d=[];if(3>e.length)return t;if(++a>n)return t;for(var g=0;g<e.length;++g)if(polygonIsReflex(e,g)){s.push(e[g]);for(var f=o=Number.MAX_VALUE,C=0;C<e.length;++C){if(isLeft(polygonAt(e,g-1),polygonAt(e,g),polygonAt(e,C))&&isRightOn(polygonAt(e,g-1),polygonAt(e,g),polygonAt(e,C-1))&&(c=getIntersectionPoint(polygonAt(e,g-1),polygonAt(e,g),polygonAt(e,C),polygonAt(e,C-1)),isRight(polygonAt(e,g+1),polygonAt(e,g),c))){var S=sqdist(e[g],c);S<o&&(o=S,l=c,p=C)}isLeft(polygonAt(e,g+1),polygonAt(e,g),polygonAt(e,C+1))&&isRightOn(polygonAt(e,g+1),polygonAt(e,g),polygonAt(e,C))&&(c=getIntersectionPoint(polygonAt(e,g+1),polygonAt(e,g),polygonAt(e,C),polygonAt(e,C+1)),isLeft(polygonAt(e,g-1),polygonAt(e,g),c)&&((S=sqdist(e[g],c))<f&&(f=S,h=c,u=C)))}if(p===(u+1)%e.length)c[0]=(l[0]+h[0])/2,c[1]=(l[1]+h[1])/2,i.push(c),g<u?(polygonAppend(m,e,g,u+1),m.push(c),d.push(c),0!==p&&polygonAppend(d,e,p,e.length),polygonAppend(d,e,0,g+1)):(0!==g&&polygonAppend(m,e,g,e.length),polygonAppend(m,e,0,u+1),m.push(c),d.push(c),polygonAppend(d,e,p,g+1));else{if(p>u&&(u+=e.length),h=Number.MAX_VALUE,u<p)return t;for(C=p;C<=u;++C)isLeftOn(polygonAt(e,g-1),polygonAt(e,g),polygonAt(e,C))&&isRightOn(polygonAt(e,g+1),polygonAt(e,g),polygonAt(e,C))&&((S=sqdist(polygonAt(e,g),polygonAt(e,C)))<h&&polygonCanSee2(e,g,C)&&(h=S,_=C%e.length));g<_?(polygonAppend(m,e,g,_+1),0!==_&&polygonAppend(d,e,_,e.length),polygonAppend(d,e,0,g+1)):(0!==g&&polygonAppend(m,e,g,e.length),polygonAppend(m,e,0,_+1),polygonAppend(d,e,_,g+1))}return m.length<d.length?(polygonQuickDecomp(m,t,s,i,r,n,a),polygonQuickDecomp(d,t,s,i,r,n,a)):(polygonQuickDecomp(d,t,s,i,r,n,a),polygonQuickDecomp(m,t,s,i,r,n,a)),t}return t.push(e),t}function scalar_eq(e,t,s){return Math.abs(e-t)<=(s||0)}function points_eq(e,t,s){return scalar_eq(e[0],t[0],s)&&scalar_eq(e[1],t[1],s)}self.polyDecomp={decomp:function(e){var t=polygonGetCutEdges(e);return 0<t.length?polygonSlice(e,t):[e]},quickDecomp:polygonQuickDecomp,isSimple:function(e){var t;for(t=0;t<e.length-1;t++)for(var s=0;s<t-1;s++)if(lineSegmentsIntersect(e[t],e[t+1],e[s],e[s+1]))return!1;for(t=1;t<e.length-2;t++)if(lineSegmentsIntersect(e[0],e[e.length-1],e[t],e[t+1]))return!1;return!0},removeCollinearPoints:function(e,t){for(var s=0,i=e.length-1;3<e.length&&0<=i;--i)collinear(polygonAt(e,i-1),polygonAt(e,i),polygonAt(e,i+1),t)&&(e.splice(i%e.length,1),s++);return s},removeDuplicatePoints:function(e,t){for(var s=e.length-1;1<=s;--s)for(var i=e[s],r=s-1;0<=r;--r)points_eq(i,e[r],t)&&e.splice(s,1)},makeCCW:function(e){for(var t=0,s=1;s<e.length;++s)(e[s][1]<e[t][1]||e[s][1]===e[t][1]&&e[s][0]>e[t][0])&&(t=s);return!isLeft(polygonAt(e,t-1),polygonAt(e,t),polygonAt(e,t+1))&&(polygonReverse(e),!0)}};let isReady=!1,hasAppStarted=!1,buildMode="dev";const C3=self.C3=class{constructor(){throw TypeError("static class can't be instantiated")}static SetReady(){isReady=!0}static IsReady(){return isReady}static SetAppStarted(){hasAppStarted=!0}static HasAppStarted(){return hasAppStarted}static SetBuildMode(e){buildMode=e}static GetBuildMode(){return buildMode}static IsReleaseBuild(){return"final"===buildMode}};C3.isDebug=!1,C3.isDebugDefend=!1,C3.hardwareConcurrency=navigator.hardwareConcurrency||2,self.C3X={};const C3$jscomp$2=self.C3;C3$jscomp$2.QueryParser=class{constructor(e){this._queryString=e,this._parameters=new Map,this._Parse()}_Parse(){var e=this._queryString;(e.startsWith("?")||e.startsWith("#"))&&(e=e.substr(1)),e=e.split("&");for(const t of e)this._ParseParameter(t)}_ParseParameter(e){if(e)if(e.includes("=")){var t=e.indexOf("="),s=decodeURIComponent(e.substring(0,t));e=decodeURIComponent(e.substring(t+1)),this._parameters.set(s,e)}else this._parameters.set(e,null)}LogAll(){for(const e of this._parameters);}Has(e){return this._parameters.has(e)}Get(e){return void 0===(e=this._parameters.get(e))?null:e}ClearHash(){history.replaceState("",document.title,location.pathname+location.search)}Reparse(e){this._queryString=e,this._parameters.clear(),this._Parse()}},C3$jscomp$2.QueryString=new C3$jscomp$2.QueryParser(location.search),C3$jscomp$2.LocationHashString=new C3$jscomp$2.QueryParser(location.hash),C3$jscomp$2.QueryString.Has("perf")&&(C3$jscomp$2.isPerformanceProfiling=!0),"dev"!==C3$jscomp$2.QueryString.Get("mode")&&C3$jscomp$2.SetBuildMode("final");const C3$jscomp$3=self.C3;C3$jscomp$3.Platform={OS:"(unknown)",OSVersion:"(unknown)",Browser:"(unknown)",BrowserVersion:"(unknown)",BrowserVersionNumber:NaN,BrowserEngine:"(unknown)",Context:"browser",IsDesktop:!0,IsMobile:!1,IsAppleOS:!1,IsIpadOS:!1,GetDetailedInfo:async()=>{}};const windowsNTVerMap=new Map([[5,"2000"],[5.1,"XP"],[5.2,"XP"],[6,"Vista"],[6.1,"7"],[6.2,"8"],[6.3,"8.1"],[10,"10"]]);function GetWindowsNTVersionName(e){const t=parseFloat(e),s=windowsNTVerMap.get(t);return s||(13<=t?"11":"NT "+e)}const uaStr=navigator.userAgent,uaData=navigator.userAgentData;if(uaData&&0<uaData.brands.length){C3$jscomp$3.Platform.OS=uaData.platform,C3$jscomp$3.Platform.IsMobile=uaData.mobile,C3$jscomp$3.Platform.IsDesktop=!C3$jscomp$3.Platform.IsMobile;const e=new Map([["Google Chrome","Chrome"],["Microsoft Edge","Edge"],["Opera","Opera"],["Opera GX","Opera GX"],["Mozilla Firefox","Firefox"],["Apple Safari","Safari"],["NW.js","NW.js"]]),t=new Map([["Chromium","Chromium"],["Gecko","Gecko"],["WebKit","WebKit"]]);function s(s){let i="",r="",n="",a="";for(const o of s)s=e.get(o.brand),!i&&s&&(i=s,r=o.version),s=t.get(o.brand),!n&&s&&(n=s,a=o.version);i||"Chromium"!==n||(C3$jscomp$3.Platform.Browser="Chromium",C3$jscomp$3.Platform.BrowserVersion=a),C3$jscomp$3.Platform.Browser=i||"(unknown)",C3$jscomp$3.Platform.BrowserVersion=r||"(unknown)",C3$jscomp$3.Platform.BrowserEngine=n||"(unknown)"}s(uaData.brands);let i=!1;C3$jscomp$3.Platform.GetDetailedInfo=async()=>{if(!i)try{const e=await navigator.userAgentData.getHighEntropyValues(["platformVersion","fullVersionList"]);s(e.fullVersionList),C3$jscomp$3.Platform.OSVersion="Windows"===C3$jscomp$3.Platform.OS?GetWindowsNTVersionName(e.platformVersion):e.platformVersion,i=!0}catch(e){}}}else{function e(e,t){e=Array.isArray(e)?e:[e];for(const s of e)if(e=s.exec(uaStr)){t(e);break}}e(/windows\s+nt\s+([\d\.]+)/i,(e=>{C3$jscomp$3.Platform.OS="Windows",C3$jscomp$3.Platform.OSVersion=GetWindowsNTVersionName(e[1])})),e(/mac\s+os\s+x\s+([\d\._]+)/i,(e=>{C3$jscomp$3.Platform.OS="macOS",C3$jscomp$3.Platform.OSVersion=e[1].replace(/_/g,".")})),e(/CrOS/,(()=>{C3$jscomp$3.Platform.OS="Chrome OS"})),e(/linux|openbsd|freebsd|netbsd/i,(()=>{C3$jscomp$3.Platform.OS="Linux"})),e(/android/i,(()=>{C3$jscomp$3.Platform.OS="Android"})),e(/android\s+([\d\.]+)/i,(e=>{C3$jscomp$3.Platform.OS="Android",C3$jscomp$3.Platform.OSVersion=e[1]})),"(unknown)"===C3$jscomp$3.Platform.OS&&(e(/(iphone|ipod|ipad)/i,(e=>{C3$jscomp$3.Platform.OS="iOS"})),e([/iphone\s+os\s+([\d\._]+)/i,/ipad[^)]*os\s+([\d\._]+)/i],(e=>{C3$jscomp$3.Platform.OS="iOS",C3$jscomp$3.Platform.OSVersion=e[1].replace(/_/g,".")})));const t=/chrome\//i.test(uaStr),s=/chromium\//i.test(uaStr),i=/edg\//i.test(uaStr),r=/OPR\//.test(uaStr),n=/nwjs/i.test(uaStr),a=/safari\//i.test(uaStr),o=/webkit/i.test(uaStr);i||r||e(/chrome\/([\d\.]+)/i,(e=>{C3$jscomp$3.Platform.Browser="Chrome",C3$jscomp$3.Platform.BrowserVersion=e[1],C3$jscomp$3.Platform.BrowserEngine="Chromium"})),e(/edg\/([\d\.]+)/i,(e=>{C3$jscomp$3.Platform.Browser="Edge",C3$jscomp$3.Platform.BrowserVersion=e[1],C3$jscomp$3.Platform.BrowserEngine="Chromium"})),e(/OPR\/([\d\.]+)/,(e=>{C3$jscomp$3.Platform.Browser="Opera",C3$jscomp$3.Platform.BrowserVersion=e[1],C3$jscomp$3.Platform.BrowserEngine="Chromium"})),e(/chromium\/([\d\.]+)/i,(e=>{C3$jscomp$3.Platform.Browser="Chromium",C3$jscomp$3.Platform.BrowserVersion=e[1],C3$jscomp$3.Platform.BrowserEngine="Chromium"})),e(/nwjs\/[0-9.]+/i,(e=>{C3$jscomp$3.Platform.Browser="NW.js",C3$jscomp$3.Platform.BrowserVersion=e[1],C3$jscomp$3.Platform.BrowserEngine="Chromium",C3$jscomp$3.Platform.Context="nwjs"})),e(/firefox\/([\d\.]+)/i,(e=>{C3$jscomp$3.Platform.Browser="Firefox",C3$jscomp$3.Platform.BrowserVersion=e[1],C3$jscomp$3.Platform.BrowserEngine="Gecko"})),!a||t||s||i||r||n||(C3$jscomp$3.Platform.Browser="Safari",C3$jscomp$3.Platform.BrowserEngine="WebKit",e(/version\/([\d\.]+)/i,(e=>{C3$jscomp$3.Platform.BrowserVersion=e[1]})),e(/crios\/([\d\.]+)/i,(e=>{C3$jscomp$3.Platform.Browser="Chrome for iOS",C3$jscomp$3.Platform.BrowserVersion=e[1]})),e(/fxios\/([\d\.]+)/i,(e=>{C3$jscomp$3.Platform.Browser="Firefox for iOS",C3$jscomp$3.Platform.BrowserVersion=e[1]})),e(/edgios\/([\d\.]+)/i,(e=>{C3$jscomp$3.Platform.Browser="Edge for iOS",C3$jscomp$3.Platform.BrowserVersion=e[1]}))),"(unknown)"===C3$jscomp$3.Platform.BrowserEngine&&o&&(C3$jscomp$3.Platform.BrowserEngine="WebKit"),"Android"===C3$jscomp$3.Platform.OS&&"Safari"===C3$jscomp$3.Platform.Browser&&(C3$jscomp$3.Platform.Browser="Stock");const h=new Set(["Windows","macOS","Linux","Chrome OS"]).has(C3$jscomp$3.Platform.OS)||"nwjs"===C3$jscomp$3.Platform.Context;C3$jscomp$3.Platform.IsDesktop=h,C3$jscomp$3.Platform.IsMobile=!h}"Chrome"===C3$jscomp$3.Platform.Browser&&"browser"===C3$jscomp$3.Platform.Context&&/wv\)/.test(uaStr)&&(C3$jscomp$3.Platform.Context="webview"),"nwjs"!==C3$jscomp$3.Platform.Context&&"undefined"!=typeof window&&(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||navigator.standalone)&&(C3$jscomp$3.Platform.Context="webapp"),C3$jscomp$3.Platform.BrowserVersionNumber=parseFloat(C3$jscomp$3.Platform.BrowserVersion),"macOS"===C3$jscomp$3.Platform.OS&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints&&(C3$jscomp$3.Platform.OS="iOS",C3$jscomp$3.Platform.OSVersion=C3$jscomp$3.Platform.BrowserVersion,C3$jscomp$3.Platform.IsDesktop=!1,C3$jscomp$3.Platform.IsMobile=!0,C3$jscomp$3.Platform.IsIpadOS=!0),C3$jscomp$3.Platform.IsAppleOS="macOS"===C3$jscomp$3.Platform.OS||"iOS"===C3$jscomp$3.Platform.OS;const DATABASE_PROMISE_MAP=new Map,SUPPORTS_GETALL="undefined"!=typeof IDBObjectStore&&"function"==typeof IDBObjectStore.prototype.getAll,SUPPORTS_GETALLKEYS="undefined"!=typeof IDBObjectStore&&"function"==typeof IDBObjectStore.prototype.getAllKeys;function asyncifyRequest(e){return new Promise(((t,s)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>s(e.error)}))}function asyncifyTransaction(e){return new Promise(((t,s)=>{e.oncomplete=()=>t(),e.onerror=()=>s(e.error),e.onabort=()=>s(e.error)}))}function openReadOnlyTransaction(e,t){return openTransaction(e,t)}function openWriteTransaction(e,t){return openTransaction(e,t,!0)}async function openTransaction(e,t,s=!1,i=!0){const r=await lazyOpenDatabase(e);try{return t(r.transaction(["keyvaluepairs"],s?"readwrite":"readonly"))}catch(r){if(i&&"InvalidStateError"===r.name)return DATABASE_PROMISE_MAP.delete(e),openTransaction(e,t,s,!1);throw r}}function lazyOpenDatabase(e){RequireString(e);let t=DATABASE_PROMISE_MAP.get(e);return t instanceof Promise||(t=openDatabase$jscomp$1(e),DATABASE_PROMISE_MAP.set(e,t),t.catch((t=>DATABASE_PROMISE_MAP.delete(e)))),t}async function openDatabase$jscomp$1(e){RequireString(e);const t=indexedDB.open(e,2);return t.addEventListener("upgradeneeded",(e=>{try{e.target.result.createObjectStore("keyvaluepairs")}catch(e){}})),asyncifyRequest(t)}function RequireString(e){if("string"!=typeof e)throw new TypeError("expected string")}function getEntriesFromCursor(e,t){const s=e.objectStore("keyvaluepairs").openCursor();return new Promise((e=>{const i=[];s.onsuccess=s=>{if(s=s.target.result){switch(t){case"entries":i.push([s.key,s.value]);break;case"keys":i.push(s.key);break;case"values":i.push(s.value)}s.continue()}else e(i)}}))}class KVStorageContainer{constructor(e){RequireString(e),this.name=e}async ready(){await lazyOpenDatabase(this.name)}set(e,t){return RequireString(e),openWriteTransaction(this.name,(async s=>{var i=s.objectStore("keyvaluepairs").put(t,e);i=asyncifyRequest(i),s=asyncifyTransaction(s),await Promise.all([s,i])}))}get(e){return RequireString(e),openReadOnlyTransaction(this.name,(async t=>{var s=t.objectStore("keyvaluepairs").get(e);return s=asyncifyRequest(s),t=asyncifyTransaction(t),[,t]=await Promise.all([t,s]),t}))}delete(e){return RequireString(e),openWriteTransaction(this.name,(async t=>{var s=t.objectStore("keyvaluepairs").delete(e);s=asyncifyRequest(s),t=asyncifyTransaction(t),await Promise.all([t,s])}))}clear(){return openWriteTransaction(this.name,(async e=>{var t=e.objectStore("keyvaluepairs").clear();t=asyncifyRequest(t),e=asyncifyTransaction(e),await Promise.all([e,t])}))}keys(){return openReadOnlyTransaction(this.name,(async e=>{if(SUPPORTS_GETALLKEYS){var t=e.objectStore("keyvaluepairs").getAllKeys();t=asyncifyRequest(t)}else t=getEntriesFromCursor(e,"keys");return e=asyncifyTransaction(e),[,e]=await Promise.all([e,t]),e}))}values(){return openReadOnlyTransaction(this.name,(async e=>{if(SUPPORTS_GETALL){var t=e.objectStore("keyvaluepairs").getAll();t=asyncifyRequest(t)}else t=getEntriesFromCursor(e,"values");return e=asyncifyTransaction(e),[,e]=await Promise.all([e,t]),e}))}entries(){return openReadOnlyTransaction(this.name,(async e=>{var t=getEntriesFromCursor(e,"entries");return e=asyncifyTransaction(e),[,t]=await Promise.all([e,t]),t}))}}self.KVStorageContainer=KVStorageContainer;const KVStorageContainer$jscomp$1=self.KVStorageContainer,CRITICAL_ERRORS=[/no available storage method found/i,/an attempt was made to break through the security policy of the user agent/i,/the user denied permission to access the database/i,/a mutation operation was attempted on a database that did not allow mutations/i,/idbfactory\.open\(\) called in an invalid security context/i],memoryStorage=new WeakMap;let isInMemory=!1;function NOT_IMPLEMENTED(e){throw Error(`"${e}" is not implemented`)}function DISALLOW_CALLBACK(e){if("function"==typeof e)throw Error("localforage callback API is not implemented; please use the promise API instead")}function StructuredClone(e){return"object"==typeof e?new Promise((t=>{const{port1:s,port2:i}=new MessageChannel;i.onmessage=e=>t(e.data),s.postMessage(e)})):Promise.resolve(e)}"undefined"==typeof indexedDB&&(isInMemory=!0);class ForageAdaptor{constructor(e){this._inst=e,memoryStorage.set(this,new Map)}_MaybeSwitchToMemoryFallback(e){if(!isInMemory)for(const t of CRITICAL_ERRORS)if(e&&t.test(e.message)){isInMemory=!0;break}}async _getItemFallback(e){return e=memoryStorage.get(this).get(e),void 0===(e=await StructuredClone(e))?null:e}async _setItemFallback(e,t){t=await StructuredClone(t),memoryStorage.get(this).set(e,t)}_removeItemFallback(e){memoryStorage.get(this).delete(e)}_clearFallback(){memoryStorage.get(this).clear()}_keysFallback(){return Array.from(memoryStorage.get(this).keys())}IsUsingFallback(){return isInMemory}async getItem(e,t){if(DISALLOW_CALLBACK(t),isInMemory)return await this._getItemFallback(e);let s;try{s=await this._inst.get(e)}catch(t){return this._MaybeSwitchToMemoryFallback(t),isInMemory?await this._getItemFallback(e):null}return void 0===s?null:s}async setItem(e,t,s){if(DISALLOW_CALLBACK(s),void 0===t&&(t=null),isInMemory)await this._setItemFallback(e,t);else try{await this._inst.set(e,t)}catch(s){if(this._MaybeSwitchToMemoryFallback(s),!isInMemory)throw s;await this._setItemFallback(e,t)}}async removeItem(e,t){if(DISALLOW_CALLBACK(t),isInMemory)this._removeItemFallback(e);else try{await this._inst.delete(e)}catch(t){this._MaybeSwitchToMemoryFallback(t),isInMemory&&this._removeItemFallback(e)}}async clear(e){if(DISALLOW_CALLBACK(e),isInMemory)this._clearFallback();else try{await this._inst.clear()}catch(e){this._MaybeSwitchToMemoryFallback(e),isInMemory&&this._clearFallback()}}async keys(e){if(DISALLOW_CALLBACK(e),isInMemory)return this._keysFallback();e=[];try{e=await this._inst.keys()}catch(e){if(this._MaybeSwitchToMemoryFallback(e),isInMemory)return this._keysFallback()}return e}ready(e){return DISALLOW_CALLBACK(e),isInMemory?Promise.resolve(!0):this._inst.ready()}createInstance(e){if("object"!=typeof e)throw new TypeError("invalid options object");if("string"!=typeof(e=e.name))throw new TypeError("invalid store name");return e=new KVStorageContainer$jscomp$1(e),new ForageAdaptor(e)}length(e){NOT_IMPLEMENTED("localforage.length()")}key(e,t){NOT_IMPLEMENTED("localforage.key()")}iterate(e,t){NOT_IMPLEMENTED("localforage.iterate()")}setDriver(e){NOT_IMPLEMENTED("localforage.setDriver()")}config(e){NOT_IMPLEMENTED("localforage.config()")}defineDriver(e){NOT_IMPLEMENTED("localforage.defineDriver()")}driver(){NOT_IMPLEMENTED("localforage.driver()")}supports(e){NOT_IMPLEMENTED("localforage.supports()")}dropInstance(){NOT_IMPLEMENTED("localforage.dropInstance()")}disableMemoryMode(){isInMemory=!1}}self.localforage=new ForageAdaptor(new KVStorageContainer$jscomp$1("localforage"));const C3$jscomp$4=self.C3;if(C3$jscomp$4.Supports={},C3$jscomp$4.Supports.WebAnimations=(()=>{try{if("Safari"===C3$jscomp$4.Platform.Browser||"undefined"==typeof document)return!1;const e=document.createElement("div");return void 0!==e.animate&&void 0!==e.animate([{opacity:"0"},{opacity:"1"}],1e3).reverse}catch(e){return!1}})(),C3$jscomp$4.Supports.DialogElement="undefined"!=typeof HTMLDialogElement,C3$jscomp$4.Supports.RequestIdleCallback=!!self.requestIdleCallback,C3$jscomp$4.Supports.ImageBitmap=!!self.createImageBitmap,C3$jscomp$4.Supports.ImageBitmapOptions=!1,C3$jscomp$4.Supports.ImageBitmapOptionsResize=!1,C3$jscomp$4.Supports.ImageBitmap){try{self.createImageBitmap(new ImageData(32,32),{premultiplyAlpha:"none"}).then((()=>{C3$jscomp$4.Supports.ImageBitmapOptions=!0})).catch((()=>{C3$jscomp$4.Supports.ImageBitmapOptions=!1}))}catch(e){C3$jscomp$4.Supports.ImageBitmapOptions=!1}try{self.createImageBitmap(new ImageData(32,32),{resizeWidth:10,resizeHeight:10}).then((e=>{C3$jscomp$4.Supports.ImageBitmapOptionsResize=10===e.width&&10===e.height})).catch((()=>{C3$jscomp$4.Supports.ImageBitmapOptionsResize=!1}))}catch(e){C3$jscomp$4.Supports.ImageBitmapOptionsResize=!1}}C3$jscomp$4.Supports.ClipboardReadText=!(!navigator.clipboard||!navigator.clipboard.readText||"Firefox"===C3$jscomp$4.Platform.Browser),C3$jscomp$4.Supports.PermissionsQuery=!(!navigator.permissions||!navigator.permissions.query),C3$jscomp$4.Supports.ClipboardPermissionsQuery=!1,C3$jscomp$4.Supports.PermissionsQuery&&navigator.permissions.query({name:"clipboard-read"}).then((()=>{C3$jscomp$4.Supports.ClipboardPermissionsQuery=!0})).catch((()=>{C3$jscomp$4.Supports.ClipboardPermissionsQuery=!1})),C3$jscomp$4.Supports.AsyncClipboardApi=!!(navigator.permissions&&navigator.clipboard&&self.ClipboardItem),C3$jscomp$4.Supports.Proxies="undefined"!=typeof Proxy,C3$jscomp$4.Supports.DownloadAttribute="undefined"!=typeof document&&void 0!==document.createElement("a").download,C3$jscomp$4.Supports.Fetch="function"==typeof fetch,C3$jscomp$4.Supports.PersistentStorage=!!(self.isSecureContext&&"Opera"!==C3$jscomp$4.Platform.Browser&&navigator.storage&&navigator.storage.persist),C3$jscomp$4.Supports.StorageQuotaEstimate=!!(self.isSecureContext&&navigator.storage&&navigator.storage.estimate),C3$jscomp$4.Supports.Fullscreen=(()=>{if("undefined"==typeof document||"iOS"===C3$jscomp$4.Platform.OS)return!1;const e=document.documentElement;return!!(e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen)})(),C3$jscomp$4.Supports.ImageDecoder=void 0!==self.ImageDecoder,C3$jscomp$4.Supports.WebCodecs=!!self.VideoEncoder,C3$jscomp$4.Supports.NativeFileSystemAPI=!!self.showOpenFilePicker,C3$jscomp$4.Supports.QueryLocalFonts=!!self.queryLocalFonts,C3$jscomp$4.Supports.UserActivation=!!navigator.userActivation,C3$jscomp$4.Supports.CanvasToBlobWebP=!1,(async()=>{let e;"undefined"==typeof document?e=new OffscreenCanvas(32,32):(e=document.createElement("canvas"),e.width=32,e.height=32);var t=e.getContext("2d");t.fillStyle="blue",t.fillRect(0,0,32,32),t=null;try{e.toBlob?t=await new Promise((t=>e.toBlob(t,"image/webp",1))):e.convertToBlob&&(t=await e.convertToBlob({type:"image/webp",quality:1})),C3$jscomp$4.Supports.CanvasToBlobWebP=t&&"image/webp"===t.type}catch(e){C3$jscomp$4.Supports.CanvasToBlobWebP=!1}})();const C3$jscomp$5=self.C3;if(!String.prototype.trimStart){const e=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*/;String.prototype.trimStart=function(){return this.replace(e,"")}}if(!String.prototype.trimEnd){const e=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*$/;String.prototype.trimEnd=function(){return this.replace(e,"")}}if(String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(C3$jscomp$5.EscapeRegex(e),"g"),t)}),Array.prototype.values||(Array.prototype.values=function*(){for(const e of this)yield e}),!Array.prototype.flat){function e(t,s){return t.reduce(((t,i)=>(0<s&&Array.isArray(i)?Array.prototype.push.apply(t,e(i,s-1)):t.push(i),t)),[])}Array.prototype.flat=function(t=1){return e(this,t)}}Array.prototype.at||(Array.prototype.at=function(e){if(0>(e=Math.trunc(e)||0)&&(e+=this.length),!(0>e||e>=this.length))return this[e]}),String.prototype.at||(String.prototype.at=function(e){if(0>(e=Math.trunc(e)||0)&&(e+=this.length),!(0>e||e>=this.length))return this[e]}),RegExp.escape||(RegExp.escape=function(e){return String(e).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}),navigator.storage&&!navigator.storage.estimate&&navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota&&(navigator.storage.estimate=function(){return new Promise(((e,t)=>navigator.webkitTemporaryStorage.queryUsageAndQuota(((t,s)=>e({usage:t,quota:s})),t)))}),void 0===self.isSecureContext&&(self.isSecureContext="https:"===location.protocol),void 0===self.globalThis&&(self.globalThis=self);const C3$jscomp$6=self.C3;function assertFail(e){C3$jscomp$6.GetCallStack()}self.assert=function(e,t){e||assertFail(t)};const C3$jscomp$7=self.C3,C3X=self.C3X;C3$jscomp$7.IsNumber=function(e){return"number"==typeof e},C3$jscomp$7.IsFiniteNumber=function(e){return C3$jscomp$7.IsNumber(e)&&isFinite(e)},C3$jscomp$7.RequireNumber=function(e){if(!C3$jscomp$7.IsNumber(e))throw new TypeError("expected number")},C3$jscomp$7.RequireOptionalNumber=function(e){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.RequireNumberInRange=function(e,t,s){if(!C3$jscomp$7.IsNumber(e)||isNaN(e)||t>e||s<e)throw new RangeError("number outside of range")},C3$jscomp$7.RequireAllNumber=function(...e){for(let t of e);},C3$jscomp$7.RequireFiniteNumber=function(e){if(!C3$jscomp$7.IsFiniteNumber(e))throw new TypeError("expected finite number")},C3$jscomp$7.RequireOptionalFiniteNumber=function(e){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.RequireAllFiniteNumber=function(...e){for(let t of e);},C3$jscomp$7.IsString=function(e){return"string"==typeof e},C3$jscomp$7.RequireString=function(e){if(!C3$jscomp$7.IsString(e))throw new TypeError("expected string")},C3$jscomp$7.RequireOptionalString=function(e){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.RequireAllString=function(...e){for(let t of e);},C3$jscomp$7.IsSimpleObject=function(e){return"object"==typeof e&&null!==e&&((e=Object.getPrototypeOf(e))?e.constructor===Object:null===e)},C3$jscomp$7.RequireSimpleObject=function(e){if(!C3$jscomp$7.IsSimpleObject(e))throw new TypeError("expected simple object")},C3$jscomp$7.RequireOptionalSimpleObject=function(e){if(!C3$jscomp$7.IsNullOrUndefined(e)&&!C3$jscomp$7.IsSimpleObject(e))throw new TypeError("expected simple object")},C3$jscomp$7.IsObject=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},C3$jscomp$7.RequireObject=function(e){if(!C3$jscomp$7.IsObject(e))throw new TypeError("expected object")},C3$jscomp$7.RequireOptionalObject=function(e){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.RequireAllObject=function(...e){for(let t of e);},C3$jscomp$7.IsFileLike=function(e){return C3$jscomp$7.IsInstanceOf(e,Blob)&&"string"==typeof e.name},C3$jscomp$7.RequireFileLike=function(e){if(!C3$jscomp$7.IsFileLike(e))throw new TypeError("expected file")},C3$jscomp$7.RequireOptionalFileLike=function(e){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.IsArray=function(e){return Array.isArray(e)},C3$jscomp$7.RequireArray=function(e){if(!C3$jscomp$7.IsArray(e))throw new TypeError("expected array")},C3$jscomp$7.RequireOptionalArray=function(e){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.RequireAllArray=function(...e){for(let t of e);},C3$jscomp$7.Is2DArray=function(e){return!!C3$jscomp$7.IsArray(e)&&(!e.length||!!C3$jscomp$7.IsArray(e[0]))},C3$jscomp$7.Require2DArray=function(e){if(!C3$jscomp$7.Is2DArray(e))throw new TypeError("expected 2d array");for(let t of e)if(!C3$jscomp$7.IsArray(t))throw new TypeError("expected 2d array")},C3$jscomp$7.RequireOptional2DArray=function(e){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.IsFunction=function(e){return"function"==typeof e},C3$jscomp$7.RequireFunction=function(e,t){if(!C3$jscomp$7.IsFunction(e))throw new TypeError("expected function");if(!C3$jscomp$7.IsNullOrUndefined(t)&&e!==t)throw new TypeError("expected same function reference")},C3$jscomp$7.RequireOptionalFunction=function(e){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.RequireAllFunction=function(...e){for(let t of e);},C3$jscomp$7.RequireAnyFunction=function(e,...t){if(!C3$jscomp$7.IsFunction(e))throw new TypeError("expected function");if(!t.length)throw Error("missing comparison functions");for(let s of t)if(!C3$jscomp$7.IsNullOrUndefined(s)&&e===s)return;throw new TypeError("expected same function reference")},C3$jscomp$7.RequireOptionalAllFunction=function(...e){if(!C3$jscomp$7.IsNullOrUndefined(e))for(let t of e);},C3$jscomp$7.IsInstanceOf=function(e,t){return e instanceof t},C3$jscomp$7.IsInstanceOfAny=function(e,...t){for(let s of t)if(C3$jscomp$7.IsInstanceOf(e,s))return!0;return!1},C3$jscomp$7.RequireInstanceOf=function(e,t){if(!C3$jscomp$7.IsInstanceOf(e,t))throw new TypeError("unexpected type")},C3$jscomp$7.RequireOptionalInstanceOf=function(e,t){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.RequireAllInstanceOf=function(e,...t){for(let e of t);},C3$jscomp$7.RequireAnyInstanceOf=function(e,...t){if(!C3$jscomp$7.IsInstanceOfAny(e,...t))throw new TypeError("unexpected type")},C3$jscomp$7.RequireAnyOptionalInstanceOf=function(e,...t){if(!C3$jscomp$7.IsNullOrUndefined(e)&&!C3$jscomp$7.IsInstanceOfAny(e,...t))throw new TypeError("unexpected type")},C3$jscomp$7.IsArrayOf=function(e,t){for(let s of e)if(!C3$jscomp$7.IsInstanceOf(s,t))return!1;return!0},C3$jscomp$7.IsArrayOfFiniteNumbers=function(e){for(let t of e)if(!C3$jscomp$7.IsFiniteNumber(t))return!1;return!0},C3$jscomp$7.RequireArrayOf=function(e,t){for(let t of e);},C3$jscomp$7.RequireOptionalArrayOf=function(e,t){if(!C3$jscomp$7.IsNullOrUndefined(e))for(let t of e);},C3$jscomp$7.RequireArrayOfAny=function(e,...t){for(let t of e);},C3$jscomp$7.RequireOptionalArrayOfAny=function(e,...t){if(!C3$jscomp$7.IsNullOrUndefined(e))for(let t of e);},C3$jscomp$7.IsDOMNode=function(e,t){return!(C3$jscomp$7.IsNullOrUndefined(e)||!C3$jscomp$7.IsString(e.nodeName))&&(!t||C3$jscomp$7.equalsNoCase(e.nodeName,t))},C3$jscomp$7.RequireDOMNode=function(e,t){if(C3$jscomp$7.IsNullOrUndefined(e)||!C3$jscomp$7.IsString(e.nodeName))throw new TypeError("expected DOM node");if(t&&!C3$jscomp$7.equalsNoCase(e.nodeName,t))throw new TypeError(`expected DOM '${t}' node`)},C3$jscomp$7.RequireOptionalDOMNode=function(e,t){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.IsHTMLElement=function(e,t){return!(C3$jscomp$7.IsNullOrUndefined(e)||!C3$jscomp$7.IsString(e.tagName))&&(!t||C3$jscomp$7.equalsNoCase(e.tagName,t))},C3$jscomp$7.RequireHTMLElement=function(e,t){if(C3$jscomp$7.IsNullOrUndefined(e)||!C3$jscomp$7.IsString(e.tagName))throw new TypeError("expected HTML element");if(t&&!C3$jscomp$7.equalsNoCase(e.tagName,t))throw new TypeError(`expected HTML '${t}' element`)},C3$jscomp$7.RequireOptionalHTMLElement=function(e,t){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.IsDrawable=function(e){return C3$jscomp$7.IsHTMLElement(e,"img")||C3$jscomp$7.IsHTMLElement(e,"canvas")||C3$jscomp$7.IsHTMLElement(e,"video")||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap},C3$jscomp$7.RequireDrawable=function(e){if(!C3$jscomp$7.IsDrawable(e))throw new TypeError("expected drawable")},C3$jscomp$7.RequireOptionalDrawable=function(e){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.IsDrawableOrImageData=function(e){return e instanceof ImageData||C3$jscomp$7.IsDrawable(e)},C3$jscomp$7.RequireDrawableOrImageData=function(e){if(!C3$jscomp$7.IsDrawableOrImageData(e))throw new TypeError("expected drawable or image data")},C3$jscomp$7.RequireOptionalDrawableOrImageData=function(e){if(!C3$jscomp$7.IsNullOrUndefined(e)&&!C3$jscomp$7.IsDrawableOrImageData(e))throw new TypeError("expected drawable or image data")},C3$jscomp$7.IsStringLike=function(e){return"string"==typeof e||C3$jscomp$7.HtmlString&&e instanceof C3$jscomp$7.HtmlString||e instanceof C3$jscomp$7.BBString},C3$jscomp$7.RequireStringLike=function(e){if(!C3$jscomp$7.IsStringLike(e))throw new TypeError("expected string-like")},C3$jscomp$7.RequireOptionalStringLike=function(e){C3$jscomp$7.IsNullOrUndefined(e)},C3$jscomp$7.RequireAllStringLike=function(...e){for(let t of e);},C3$jscomp$7.RequireOverride=function(){throw Error("must be overridden")},C3$jscomp$7.NotYetImplemented=function(){throw Error("not yet implemented")},C3$jscomp$7.IsDefined=function(e,...t){if(void 0===e)return!1;for(let s of t){if(void 0===e[s])return!1;e=e[s]}return!0},C3$jscomp$7.IsNullOrUndefined=function(e){return null==e},C3$jscomp$7.AreArrayElementsOfSameType=function(e){let t=e[0].constructor;for(let s of e)if(s.constructor!==t)return!1;return t},C3$jscomp$7.AreArrayElementsOfType=function(e,t){for(let s of e)if(!(s instanceof t))return!1;return!0};const TypedArray$jscomp$1=Object.getPrototypeOf(Uint8Array);C3$jscomp$7.IsTypedArray=function(e){return C3$jscomp$7.IsInstanceOf(e,TypedArray$jscomp$1)},C3$jscomp$7.RequireTypedArray=function(e){},C3$jscomp$7.WeakRequireTypedArray=function(e){C3$jscomp$7.WeakRequireInstanceOf(e,TypedArray$jscomp$1)},C3$jscomp$7.WeakRequireAnyInstanceOf=function(e,...t){if(!C3$jscomp$7.WeakIsAnyInstanceOf(e,...t))throw new TypeError("unexpected type")},C3$jscomp$7.WeakIsAnyInstanceOf=function(e,...t){for(const s of t)if(C3$jscomp$7.WeakIsInstanceOf(e,s))return!0;return!1},C3$jscomp$7.WeakRequireInstanceOf=function(e,t){if(!C3$jscomp$7.WeakIsInstanceOf(e,t))throw new TypeError("unexpected type")},C3$jscomp$7.WeakIsInstanceOf=function(e,t){for(;e=Object.getPrototypeOf(e);)if(e.constructor.name===t.name)return!0;return!1},C3X.RequireNumber=C3$jscomp$7.RequireNumber,C3X.RequireOptionalNumber=C3$jscomp$7.RequireOptionalNumber,C3X.RequireFiniteNumber=C3$jscomp$7.RequireFiniteNumber,C3X.RequireOptionalFiniteNumber=C3$jscomp$7.RequireOptionalFiniteNumber,C3X.RequireString=C3$jscomp$7.RequireString,C3X.RequireOptionalString=C3$jscomp$7.RequireOptionalString,C3X.RequireObject=C3$jscomp$7.RequireObject,C3X.RequireOptionalObject=C3$jscomp$7.RequireOptionalObject,C3X.RequireArray=C3$jscomp$7.RequireArray,C3X.RequireOptionalArray=C3$jscomp$7.RequireOptionalArray,C3X.RequireFunction=C3$jscomp$7.RequireFunction,C3X.RequireOptionalFunction=C3$jscomp$7.RequireOptionalFunction,C3X.RequireInstanceOf=C3$jscomp$7.RequireInstanceOf,C3X.RequireOptionalInstanceOf=C3$jscomp$7.RequireOptionalInstanceOf,C3X.IsNullOrUndefined=C3$jscomp$7.IsNullOrUndefined;const C3$jscomp$8=self.C3,logRafIds=new Map;let measures;function isValidTypeChange(e,t){return e=C3$jscomp$8.getType(e),t=C3$jscomp$8.getType(t),"null"===e||"null"===t||"undefined"!==e&&"undefined"!==t&&e===t}C3$jscomp$8.ColorLog=function(e,t){},C3$jscomp$8.RafLog=function(e,...t){logRafIds.has(e)||logRafIds.set(e,-1),-1===logRafIds.get(e)&&logRafIds.set(e,requestAnimationFrame((()=>{logRafIds.set(e,-1)})))},C3$jscomp$8.StartMeasure=function(e){performance.mark(e),measures||(measures=new Map),measures.has(e)||measures.set(e,{current:0,total:0,average:0,calls:1,toString:function(){return`current => ${this.current.toPrecision(3)} :: average => ${this.average.toPrecision(3)} :: calls => ${this.calls}`}})},C3$jscomp$8.EndMeasure=function(e){performance.measure("measure",e);const t=performance.getEntriesByName("measure")[0];(e=measures.get(e)).current=t.duration,e.total+=e.current,e.average=e.total/e.calls,e.calls++,performance.clearMarks(),performance.clearMeasures()},C3$jscomp$8.GetCallStack=function(){return Error().stack},C3$jscomp$8.Debugger=function(){},C3$jscomp$8.cast=function(e,t){return e&&e instanceof t?e:null},C3$jscomp$8.getName=function(e){return void 0===e?"undefined":null===e?"null":"boolean"==typeof e?"<boolean>":C3$jscomp$8.IsNumber(e)?"<number>":C3$jscomp$8.IsString(e)?"<string>":C3$jscomp$8.IsArray(e)?"<array>":"symbol"==typeof e?"<"+e.toString()+">":C3$jscomp$8.IsFunction(e)?e.name&&"Function"!==e.name?e.name:"<anonymous function>":"object"==typeof e?e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"<anonymous object>":"<unknown>"},C3$jscomp$8.getType=function(e){return null===e?"null":Array.isArray(e)?"array":typeof e},C3$jscomp$8.range=function*(e,t){if(!isFinite(Math.abs(e-t)))throw Error("Invalid parameters");if(e>t)for(--e;e>=t;e--)yield e;else for(;e<t;e++)yield e};let ctorObjectToProxy=new Map,ctorProxyToObject=new Map,proxyToObject=new WeakMap,releasedObjects=new WeakMap;C3$jscomp$8.DefendHandler={};const VALID_GET_MISSING_KEYS=new Set(["then","splice"]);function logDefendedObjectWarning(e){}C3$jscomp$8.DefendHandler.get=function(e,t){return t in e||"symbol"==typeof t||VALID_GET_MISSING_KEYS.has(t)||logDefendedObjectWarning(`Accessed missing property '${t}' from defended object '${C3$jscomp$8.getName(e)}', returning undefined`),releasedObjects.has(e)&&"symbol"!=typeof t&&!VALID_GET_MISSING_KEYS.has(t)&&logDefendedObjectWarning(`Accessed property '${t}' on a released object '${C3$jscomp$8.getName(e)}'\nObject was originally released at: ${releasedObjects.get(e)})\nCall stack at access: `),e[t]},C3$jscomp$8.DefendHandler.set=function(e,t,s){return t in e||ctorObjectToProxy.has(e)||logDefendedObjectWarning(`Set non-existent property '${t}' to '${s}' on defended object '${C3$jscomp$8.getName(e)}'`),isValidTypeChange(e[t],s)||ctorObjectToProxy.has(e)||logDefendedObjectWarning(`Set '${C3$jscomp$8.getType(e[t])}' property '${t}' to type '${C3$jscomp$8.getType(s)}' on defended object '${C3$jscomp$8.getName(e)}'`),releasedObjects.has(e)&&logDefendedObjectWarning(`Set property '${t}' on a released object '${C3$jscomp$8.getName(e)}'\nObject was originally released at: ${releasedObjects.get(e)})\nCall stack at access: `),e[t]=s,!0},C3$jscomp$8.DefendHandler.deleteProperty=function(e,t){throw new ReferenceError(`Cannot delete property '${t}' from defended object '${C3$jscomp$8.getName(e)}'`)},C3$jscomp$8.DefendHandler.defineProperty=function(e,t,s){throw new ReferenceError(`Cannot define property '${t}' on defended object '${C3$jscomp$8.getName(e)}'`)},C3$jscomp$8.DefendHandler.enumerate=function(e){throw new ReferenceError(`Cannot enumerate defended object '${C3$jscomp$8.getName(e)}'`)};let checkRafId=-1;function CheckDefendedObjectsUsedCorrectly(){if(checkRafId=-1,0<ctorObjectToProxy.size||0<ctorProxyToObject.size){[...new Set([...ctorObjectToProxy.keys()].map((e=>C3$jscomp$8.getName(e))))].join();ctorObjectToProxy.clear(),ctorProxyToObject.clear()}}C3$jscomp$8.DefendedBase=class{constructor(){if(C3$jscomp$8.isDebugDefend&&C3$jscomp$8.Supports.Proxies){var e=new.target;e=Object.create(e.prototype);var t=new Proxy(e,C3$jscomp$8.DefendHandler);return ctorObjectToProxy.set(e,t),ctorProxyToObject.set(t,e),proxyToObject.set(t,e),-1===checkRafId&&(checkRafId=requestAnimationFrame(CheckDefendedObjectsUsedCorrectly)),t}}},C3$jscomp$8.debugDefend=function(e){if(C3$jscomp$8.isDebugDefend&&C3$jscomp$8.Supports.Proxies&&e instanceof C3$jscomp$8.DefendedBase){if(!ctorProxyToObject.has(e))return e;let t=ctorProxyToObject.get(e);return ctorProxyToObject.delete(e),ctorObjectToProxy.delete(t),e}return C3$jscomp$8.isDebug?Object.seal(e):e},C3$jscomp$8.New=function(e,...t){let s;try{s=new e(...t)}catch(e){throw ctorProxyToObject.clear(),ctorObjectToProxy.clear(),e}return C3$jscomp$8.isDebugDefend&&VerifyObjectPropertiesConsistent(e,s),C3$jscomp$8.debugDefend(s)},C3$jscomp$8.Release=function(e){(e=proxyToObject.get(e))&&releasedObjects.set(e,C3$jscomp$8.GetCallStack())},C3$jscomp$8.WasReleased=function(e){return!!(e=proxyToObject.get(e))&&!!releasedObjects.get(e)};let typeProperties=new Map;function getObjectPropertySet(e){let t=new Set;for(let s in e)t.add(s);return t}function VerifyObjectPropertiesConsistent(e,t){t=getObjectPropertySet(t);let s=typeProperties.get(e);if(s){let e=[];for(let i of s.values())t.has(i)?t.delete(i):e.push(i);C3$jscomp$8.appendArray(e,[...t]),e.length}else typeProperties.set(e,t)}C3$jscomp$8.PerfMark=class{constructor(e){this._name="",e&&this.start(e)}start(e){C3$jscomp$8.isPerformanceProfiling&&(this._name=e,performance.mark(this._name+"-Start"))}end(){C3$jscomp$8.isPerformanceProfiling&&(performance.mark(this._name+"-End"),performance.measure(this._name,this._name+"-Start",this._name+"-End"))}next(e){C3$jscomp$8.isPerformanceProfiling&&(this.end(),this._name=e,performance.mark(this._name+"-Start"))}};const C3$jscomp$9=self.C3,TWO_PI=2*Math.PI,D_TO_R=Math.PI/180,R_TO_D=180/Math.PI;C3$jscomp$9.wrap=function(e,t,s){return e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),e<t?(e=s-(t-e)%(s-t))===s?0:e:t+(e-t)%(s-t)},C3$jscomp$9.mapToRange=function(e,t,s,i,r){return(e-t)*(r-i)/(s-t)+i},C3$jscomp$9.normalize=function(e,t,s){return(e-t)/(s-t)},C3$jscomp$9.clamp=function(e,t,s){return e<t?t:e>s?s:e},C3$jscomp$9.clampAngle=function(e){return 0>(e%=TWO_PI)&&(e+=TWO_PI),e},C3$jscomp$9.toRadians=function(e){return e*D_TO_R},C3$jscomp$9.toDegrees=function(e){return e*R_TO_D},C3$jscomp$9.distanceTo=function(e,t,s,i){return Math.hypot(s-e,i-t)},C3$jscomp$9.distanceSquared=function(e,t,s,i){return(e=s-e)*e+(t=i-t)*t},C3$jscomp$9.angleTo=function(e,t,s,i){return Math.atan2(i-t,s-e)},C3$jscomp$9.angleDiff=function(e,t){return e===t||1<=(e=Math.sin(e)*Math.sin(t)+Math.cos(e)*Math.cos(t))?0:-1>=e?Math.PI:Math.acos(e)},C3$jscomp$9.angleRotate=function(e,t,s){let i=Math.sin(e),r=Math.cos(e),n=Math.sin(t),a=Math.cos(t);return Math.acos(i*n+r*a)>s?0<r*n-i*a?C3$jscomp$9.clampAngle(e+s):C3$jscomp$9.clampAngle(e-s):C3$jscomp$9.clampAngle(t)},C3$jscomp$9.angleClockwise=function(e,t){return 0>=Math.cos(e)*Math.sin(t)-Math.sin(e)*Math.cos(t)},C3$jscomp$9.angleLerp=function(e,t,s,i=0){let r=C3$jscomp$9.angleDiff(e,t);return i*=TWO_PI,C3$jscomp$9.angleClockwise(t,e)?C3$jscomp$9.clampAngle(e+(r+i)*s):C3$jscomp$9.clampAngle(e-(r+i)*s)},C3$jscomp$9.angleLerpClockwise=function(e,t,s,i=0){const r=C3$jscomp$9.angleDiff(e,t);return i*=TWO_PI,C3$jscomp$9.angleClockwise(t,e)?C3$jscomp$9.clampAngle(e+(r+i)*s):C3$jscomp$9.clampAngle((TWO_PI-r+i)*s)},C3$jscomp$9.angleLerpAntiClockwise=function(e,t,s,i=0){const r=C3$jscomp$9.angleDiff(e,t);return i*=TWO_PI,C3$jscomp$9.angleClockwise(t,e)?C3$jscomp$9.clampAngle((-TWO_PI+r-i)*s):C3$jscomp$9.clampAngle(e-(r+i)*s)},C3$jscomp$9.lerp=function(e,t,s){return e+s*(t-e)},C3$jscomp$9.unlerp=function(e,t,s){return e===t?0:(s-e)/(t-e)},C3$jscomp$9.relerp=function(e,t,s,i,r){return C3$jscomp$9.lerp(i,r,C3$jscomp$9.unlerp(e,t,s))},C3$jscomp$9.qarp=function(e,t,s,i){return C3$jscomp$9.lerp(C3$jscomp$9.lerp(e,t,i),C3$jscomp$9.lerp(t,s,i),i)},C3$jscomp$9.cubic=function(e,t,s,i,r){return C3$jscomp$9.lerp(C3$jscomp$9.qarp(e,t,s,r),C3$jscomp$9.qarp(t,s,i,r),r)},C3$jscomp$9.cosp=function(e,t,s){return(e+t+(e-t)*Math.cos(s*Math.PI))/2},C3$jscomp$9.isPOT=function(e){return 0<e&&0==(e-1&e)},C3$jscomp$9.nextHighestPowerOfTwo=function(e){--e;for(let t=1;32>t;t<<=1)e|=e>>t;return e+1},C3$jscomp$9.roundToNearestFraction=function(e,t){return Math.round(e*t)/t},C3$jscomp$9.floorToNearestFraction=function(e,t){return Math.floor(e*t)/t},C3$jscomp$9.round6dp=function(e){return Math.round(1e6*e)/1e6},C3$jscomp$9.toFixed=function(e,t){for(t=(e=e.toFixed(t)).length-1;0<=t&&"0"===e.charAt(t);--t);return 0<=t&&"."===e.charAt(t)&&--t,0>t?e:e.substr(0,t+1)},C3$jscomp$9.PackRGB=function(e,t,s){return C3$jscomp$9.clamp(e,0,255)|C3$jscomp$9.clamp(t,0,255)<<8|C3$jscomp$9.clamp(s,0,255)<<16};const ALPHAEX_SHIFT=1024;function isNegativeZero(e){return 0===e&&0>1/e}C3$jscomp$9.PackRGBAEx=function(e,t,s,i){return e=C3$jscomp$9.clamp(Math.floor(1024*e),-8192,8191),t=C3$jscomp$9.clamp(Math.floor(1024*t),-8192,8191),s=C3$jscomp$9.clamp(Math.floor(1024*s),-8192,8191),i=C3$jscomp$9.clamp(Math.floor(1023*i),0,1023),0>e&&(e+=16384),0>t&&(t+=16384),0>s&&(s+=16384),-(268435456*e*ALPHAEX_SHIFT+16384*t*ALPHAEX_SHIFT+s*ALPHAEX_SHIFT+i)},C3$jscomp$9.PackRGBEx=function(e,t,s){return C3$jscomp$9.PackRGBAEx(e,t,s,1)},C3$jscomp$9.GetRValue=function(e){return 0<=e?(255&e)/255:(8191<(e=Math.floor(-e/(268435456*ALPHAEX_SHIFT)))&&(e-=16384),e/1024)},C3$jscomp$9.GetGValue=function(e){return 0<=e?((65280&e)>>8)/255:(8191<(e=Math.floor(-e%(268435456*ALPHAEX_SHIFT)/(16384*ALPHAEX_SHIFT)))&&(e-=16384),e/1024)},C3$jscomp$9.GetBValue=function(e){return 0<=e?((16711680&e)>>16)/255:(8191<(e=Math.floor(-e%(16384*ALPHAEX_SHIFT)/ALPHAEX_SHIFT))&&(e-=16384),e/1024)},C3$jscomp$9.GetAValue=function(e){return isNegativeZero(e)?0:0<=e?1:Math.floor(-e%ALPHAEX_SHIFT)/1023},C3$jscomp$9.greatestCommonDivisor=function(e,t){for(e=Math.floor(e),t=Math.floor(t);0!==t;){let s=t;t=e%t,e=s}return e};const COMMON_ASPECT_RATIOS=[[3,2],[4,3],[5,4],[5,3],[6,5],[14,9],[16,9],[16,10],[21,9]];C3$jscomp$9.getAspectRatio=function(e,t){if((e=Math.floor(e))===(t=Math.floor(t)))return[1,1];for(var s of COMMON_ASPECT_RATIOS){let i=e/s[0]*s[1];if(1>Math.abs(t-i))return s.slice(0);if(i=e/s[1]*s[0],1>Math.abs(t-i))return[s[1],s[0]]}return[e/(s=C3$jscomp$9.greatestCommonDivisor(e,t)),t/s]},C3$jscomp$9.segmentsIntersect=function(e,t,s,i,r,n,a,o){var h=Math.min(e,s),l=Math.max(r,a);return!(Math.max(e,s)<Math.min(r,a)||h>l)&&(h=Math.min(t,i),l=Math.max(n,o),!(Math.max(t,i)<Math.min(n,o)||h>l)&&(h=r-e+a-s,l=n-t+o-i,e=s-e,t=i-t,r=a-r,n=o-n,o=Math.abs(t*r-n*e),!(Math.abs(r*l-n*h)>o)&&Math.abs(e*l-t*h)<=o))},C3$jscomp$9.segmentsIntersectPreCalc=function(e,t,s,i,r,n,a,o,h,l,c,u){const p=Math.max(h,c);return!(n<Math.min(h,c)||r>p)&&(r=Math.max(l,u),!(o<Math.min(l,u)||a>r)&&(a=h-e+c-s,o=l-t+u-i,e=s-e,t=i-t,h=c-h,l=u-l,u=Math.abs(t*h-l*e),!(Math.abs(h*o-l*a)>u)&&Math.abs(e*o-t*a)<=u))},C3$jscomp$9.segmentIntersectsQuad=function(e,t,s,i,r){const n=Math.min(e,s),a=Math.max(e,s),o=Math.min(t,i),h=Math.max(t,i),l=r.getTlx(),c=r.getTly(),u=r.getTrx(),p=r.getTry(),_=r.getBrx(),m=r.getBry(),d=r.getBlx();return r=r.getBly(),C3$jscomp$9.segmentsIntersectPreCalc(e,t,s,i,n,a,o,h,l,c,u,p)||C3$jscomp$9.segmentsIntersectPreCalc(e,t,s,i,n,a,o,h,u,p,_,m)||C3$jscomp$9.segmentsIntersectPreCalc(e,t,s,i,n,a,o,h,_,m,d,r)||C3$jscomp$9.segmentsIntersectPreCalc(e,t,s,i,n,a,o,h,d,r,l,c)},C3$jscomp$9.segmentIntersectsAnyN=function(e,t,s,i,r){const n=Math.min(e,s),a=Math.max(e,s),o=Math.min(t,i),h=Math.max(t,i);let l=0;for(let c=r.length-4;l<=c;l+=2)if(C3$jscomp$9.segmentsIntersectPreCalc(e,t,s,i,n,a,o,h,r[l],r[l+1],r[l+2],r[l+3]))return!0;return C3$jscomp$9.segmentsIntersectPreCalc(e,t,s,i,n,a,o,h,r[l],r[l+1],r[0],r[1])},C3$jscomp$9.rayIntersect=function(e,t,s,i,r,n,a,o){const h=(s-=e)*(n=o-n)-(i-t)*(a-r);return 0===h?2:0<(i=((t-i)*(a-e)+s*(o-t))/h)&&1.000001>i?(n*(a-e)+(r-a)*(o-t))/h:2},C3$jscomp$9.rayIntersectExtended=function(e,t,s,i,r,n,a,o,h){const l=(a-r)*h;return h*=o-n,C3$jscomp$9.rayIntersect(e,t,s,i,r-l,n-h,a+l,o+h)},C3$jscomp$9.isPointInTriangleInclusive=function(e,t,s,i,r,n,a,o){return r-=s,a-=s,e-=s,s=t-i,t=r*r+(n-=i)*n,i=r*a+n*(o-=i),r=r*e+n*s,n=((n=a*a+o*o)*r-i*(a=a*e+o*s))*(o=1/(t*n-i*i)),r=(t*a-i*r)*o,0<=n&&0<=r&&1>=n+r},C3$jscomp$9.triangleCartesianToBarycentric=function(e,t,s,i,r,n,a,o){e-=s;const h=t-i;return t=(r-=s)*r+(n-=i)*n,i=r*(a-=s)+n*(o-=i),[1-(o=((s=a*a+o*o)*(r=e*r+h*n)-i*(n=e*a+h*o))/(a=t*s-i*i))-(r=(t*n-i*r)/a),o,r]},C3$jscomp$9.triangleBarycentricToCartesian=function(e,t,s,i,r,n,a,o,h){return[e*i+t*n+s*o,e*r+t*a+s*h]};const C3$jscomp$10=self.C3;let mainDocument=null,baseHref="";if("undefined"!=typeof document){mainDocument=document;const e=document.querySelector("base");(baseHref=e&&e.hasAttribute("href")?e.getAttribute("href"):"")&&(baseHref.startsWith("/")&&(baseHref=baseHref.substr(1)),baseHref.endsWith("/")||(baseHref+="/"))}C3$jscomp$10.GetBaseHref=function(){return baseHref},C3$jscomp$10.GetBaseURL=function(){if(!mainDocument)return"";const e=mainDocument.location;return C3$jscomp$10.GetPathFromURL(e.origin+e.pathname)+baseHref},C3$jscomp$10.GetPathFromURL=function(e){if(!e.length||e.endsWith("/")||e.endsWith("\\"))return e;const t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return-1===t?"":e.substr(0,t+1)},C3$jscomp$10.GetFilenameFromURL=function(e){if(!e.length)return e;if(e.endsWith("/")||e.endsWith("\\"))return"";const t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return-1===t?e:e.substr(t+1)},C3$jscomp$10.GetFileExtension=function(e){let t=e.lastIndexOf(".");return 1>t?"":e.substr(t)},C3$jscomp$10.SetFileExtension=function(e,t){const s=e.lastIndexOf(".");return-1===s?e+"."+t:e.substr(0,s+1)+t},C3$jscomp$10.GetFileNamePart=function(e){let t=e.lastIndexOf(".");return 1>t?e:e.substr(0,t)},C3$jscomp$10.NormalizeFileSeparator=function(e){return e.replace(/\\/g,"/")},C3$jscomp$10.IsFileExtension=function(e,t){return t===(e=e?C3$jscomp$10.GetFileExtension(e).slice(1):"")},C3$jscomp$10.FileNameEquals=function(e,t){let s,i;return C3$jscomp$10.IsFileLike(e)&&(s=C3$jscomp$10.GetFileNamePart(e.name)),C3$jscomp$10.IsString(e)&&(s=C3$jscomp$10.GetFileNamePart(e)),C3$jscomp$10.IsFileLike(t)&&(i=C3$jscomp$10.GetFileNamePart(t.name)),C3$jscomp$10.IsString(t)&&(i=C3$jscomp$10.GetFileNamePart(t)),s===i},C3$jscomp$10.ParseFilePath=function(e){e=C3$jscomp$10.NormalizeFileSeparator(e);let t=/^\w:\//.exec(e);t?(t=t[0],"/"!==(e=e.slice(3))[0]&&(e="/"+e)):t="",1<(e=e.replace(/\/{2,}/g,"/")).length&&"/"===e.slice(-1)&&(e=e.slice(0,-1));var s=e.lastIndexOf("/")+1;let i="",r=e,n="";return 0<s&&(i=e.slice(0,s),r=e.slice(s)),e=r,0<(s=r.lastIndexOf("."))&&(n=r.slice(s),e=r.slice(0,-n.length)),{dir:i,base:r,name:e,root:t,ext:n,full:t+i+r}},C3$jscomp$10.Wait=function(e,t){return new Promise(((s,i)=>{self.setTimeout(s,e,t)}))},C3$jscomp$10.swallowException=function(e){try{e()}catch(e){C3$jscomp$10.isDebug}},C3$jscomp$10.noop=function(){},C3$jscomp$10.equalsNoCase=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e===t||e.normalize().toLowerCase()===t.normalize().toLowerCase())},C3$jscomp$10.equalsCase=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e===t||e.normalize()===t.normalize())},C3$jscomp$10.typedArraySet16=function(e,t,s){e[s++]=t[0],e[s++]=t[1],e[s++]=t[2],e[s++]=t[3],e[s++]=t[4],e[s++]=t[5],e[s++]=t[6],e[s++]=t[7],e[s++]=t[8],e[s++]=t[9],e[s++]=t[10],e[s++]=t[11],e[s++]=t[12],e[s++]=t[13],e[s++]=t[14],e[s]=t[15]},C3$jscomp$10.truncateArray=function(e,t){e.length=t},C3$jscomp$10.clearArray=function(e){e&&0!==e.length&&C3$jscomp$10.truncateArray(e,0)},C3$jscomp$10.clear2DArray=function(e){if(e){for(let t=0;t<e.length;t++)C3$jscomp$10.truncateArray(e[t],0);C3$jscomp$10.truncateArray(e,0)}},C3$jscomp$10.extendArray=function(e,t,s){t|=0;var i=e.length;if(!(t<=i))for(;i<t;++i)e.push(s)},C3$jscomp$10.resizeArray=function(e,t,s){t|=0;const i=e.length;t<i?C3$jscomp$10.truncateArray(e,t):t>i&&C3$jscomp$10.extendArray(e,t,s)},C3$jscomp$10.shallowAssignArray=function(e,t){C3$jscomp$10.clearArray(e),C3$jscomp$10.appendArray(e,t)},C3$jscomp$10.appendArray=function(e,t){if(1e4>t.length)e.push(...t);else for(let s=0,i=t.length;s<i;++s)e.push(t[s])},C3$jscomp$10.arrayRemove=function(e,t){if(!(0>(t=Math.floor(t))||t>=e.length)){for(var s=e.length-1;t<s;++t)e[t]=e[t+1];C3$jscomp$10.truncateArray(e,s)}},C3$jscomp$10.arrayFindRemove=function(e,t){0<=(t=e.indexOf(t))&&e.splice(t,1)},C3$jscomp$10.arraysEqual=function(e,t){let s=e.length;if(t.length!==s)return!1;for(let i=0;i<s;++i)if(e[i]!==t[i])return!1;return!0},C3$jscomp$10.arrayFilterOut=function(e,t){let s=[],i=0;for(let r=0,n=e.length;r<n;++r){let n=e[r];t(n)?s.push(n):(e[i]=n,++i)}return C3$jscomp$10.truncateArray(e,i),s},C3$jscomp$10.arrayRemoveAllInSet=function(e,t){const s=e.length;let i=0;for(let s=0,r=e.length;s<r;++s){let r=e[s];t.has(r)||(e[i++]=r)}return C3$jscomp$10.truncateArray(e,i),s-i},C3$jscomp$10.isArrayIndexInBounds=function(e,t){return e===Math.floor(e)&&(0<=e&&e<t.length)},C3$jscomp$10.validateArrayIndex=function(e,t){if(!C3$jscomp$10.isArrayIndexInBounds(e,t))throw new RangeError("array index out of bounds")},C3$jscomp$10.cloneArray=function(e){return e.slice()},C3$jscomp$10.deepCloneArray=function(e,t){let s=[];for(let i of e)if(C3$jscomp$10.IsObject(i)){if(!(e=t(i)))throw Error("missing clone");if(e.constructor!==i.constructor)throw Error("object is not a clone");s.push(e)}else C3$jscomp$10.IsArray(i)?s.push(C3$jscomp$10.deepCloneArray(i,t)):s.push(i);return s},C3$jscomp$10.clone2DArray=function(e){let t=[];for(let s of e)t.push(s.slice());return t},C3$jscomp$10.mergeSets=function(e,t){return new Set([...e,...t])},C3$jscomp$10.mergeSetsInPlace=function(e,t){for(const s of t)e.add(s);return e},C3$jscomp$10.first=function(e){for(let t of e)return t;return null},C3$jscomp$10.xor=function(e,t){return!e!=!t},C3$jscomp$10.compare=function(e,t,s){switch(t){case 0:return e===s;case 1:return e!==s;case 2:return e<s;case 3:return e<=s;case 4:return e>s;case 5:return e>=s;default:return!1}},C3$jscomp$10.hasAnyOwnProperty=function(e){for(let t in e)if(e.hasOwnProperty(t))return!0;return!1},C3$jscomp$10.PromiseAllWithProgress=function(e,t){return e.length?new Promise(((s,i)=>{const r=[];let n=0,a=!1;for(let o=0,h=e.length;o<h;++o)r.push(void 0),e[o].then((i=>{a||(r[o]=i,++n,n===e.length?s(r):t(n,e.length))})).catch((e=>{a=!0,i(e)}))})):Promise.resolve([])};let memoryCallbacks=[];C3$jscomp$10.AddLibraryMemoryCallback=function(e){memoryCallbacks.push(e)},C3$jscomp$10.GetEstimatedLibraryMemoryUsage=function(){let e=0;for(let t of memoryCallbacks){e+=t()}return Math.floor(e)};let nextTaskId=1;const activeTaskIds=new Map,taskMessageChannel=new MessageChannel;taskMessageChannel.port2.onmessage=function(e){e=e.data;const t=activeTaskIds.get(e);activeTaskIds.delete(e),t&&t(performance.now())},C3$jscomp$10.RequestUnlimitedAnimationFrame=function(e){const t=nextTaskId++;return activeTaskIds.set(t,e),taskMessageChannel.port1.postMessage(t),t},C3$jscomp$10.CancelUnlimitedAnimationFrame=function(e){activeTaskIds.delete(e)},C3$jscomp$10.PostTask=C3$jscomp$10.RequestUnlimitedAnimationFrame,C3$jscomp$10.WaitForNextTask=function(){return new Promise((e=>C3$jscomp$10.PostTask(e)))};const activeRPAFids=new Set;C3$jscomp$10.RequestPostAnimationFrame=function(e){const t=self.requestAnimationFrame((async s=>{await C3$jscomp$10.WaitForNextTask(),activeRPAFids.has(t)&&(activeRPAFids.delete(t),e(s))}));return activeRPAFids.add(t),t},C3$jscomp$10.CancelPostAnimationFrame=function(e){activeRPAFids.has(e)&&(self.cancelAnimationFrame(e),activeRPAFids.delete(e))};const C3$jscomp$11=self.C3;C3$jscomp$11.IsAbsoluteURL=function(e){return/^(?:[a-z\-]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)},C3$jscomp$11.IsRelativeURL=function(e){return!C3$jscomp$11.IsAbsoluteURL(e)},C3$jscomp$11.ThrowIfNotOk=function(e){if(!e.ok)throw Error(`fetch '${e.url}' response returned ${e.status} ${e.statusText}`)},C3$jscomp$11.FetchOk=function(e,t){return fetch(e,t).then((e=>(C3$jscomp$11.ThrowIfNotOk(e),e)))},C3$jscomp$11.FetchText=function(e){return C3$jscomp$11.FetchOk(e).then((e=>e.text()))},C3$jscomp$11.FetchJson=function(e){return C3$jscomp$11.FetchOk(e).then((e=>e.json()))},C3$jscomp$11.FetchBlob=function(e){return C3$jscomp$11.FetchOk(e).then((e=>e.blob()))},C3$jscomp$11.FetchArrayBuffer=function(e){return C3$jscomp$11.FetchOk(e).then((e=>e.arrayBuffer()))},C3$jscomp$11.FetchImage=function(e){return new Promise(((t,s)=>{const i=new Image;i.onload=()=>t(i),i.onerror=e=>s(e),i.src=e}))},C3$jscomp$11.BlobToArrayBuffer=function(e){return"function"==typeof e.arrayBuffer?e.arrayBuffer():new Promise(((t,s)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=()=>s(i.error),i.readAsArrayBuffer(e)}))},C3$jscomp$11.BlobToString=function(e){return"function"==typeof e.text?e.text():new Promise(((t,s)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=()=>s(i.error),i.readAsText(e)}))},C3$jscomp$11.BlobToJson=function(e){return C3$jscomp$11.BlobToString(e).then((e=>JSON.parse(e)))},C3$jscomp$11.BlobToImage=async function(e,t){e=URL.createObjectURL(e);try{const s=await C3$jscomp$11.FetchImage(e);return URL.revokeObjectURL(e),e="",t&&"function"==typeof s.decode&&await s.decode(),s}finally{e&&URL.revokeObjectURL(e)}},C3$jscomp$11.CreateCanvas=function(e,t){if("undefined"!=typeof document&&"function"==typeof document.createElement){const s=document.createElement("canvas");return s.width=e,s.height=t,s}return new OffscreenCanvas(e,t)},C3$jscomp$11.CanvasToBlob=function(e,t,s){if("number"!=typeof s&&(s=1),t=t||"image/png",s=C3$jscomp$11.clamp(s,0,1),e.toBlob)return new Promise((i=>e.toBlob(i,t,s)));if(e.convertToBlob)return e.convertToBlob({type:t,quality:s});throw Error("could not convert canvas to blob")},C3$jscomp$11.DrawableToBlob=function(e,t,s){const i=C3$jscomp$11.CreateCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),C3$jscomp$11.CanvasToBlob(i,t,s)},C3$jscomp$11.ImageDataToBlob=function(e,t,s){if(C3$jscomp$11.Supports.ImageBitmapOptions)return createImageBitmap(e,{premultiplyAlpha:"none"}).then((e=>C3$jscomp$11.DrawableToBlob(e,t,s)));if(C3$jscomp$11.Supports.ImageBitmap)return createImageBitmap(e).then((e=>C3$jscomp$11.DrawableToBlob(e,t,s)));const i=C3$jscomp$11.CreateCanvas(e.width,e.height);return i.getContext("2d").putImageData(e,0,0),C3$jscomp$11.CanvasToBlob(i,t,s)},C3$jscomp$11.CopySet=function(e,t){e.clear();for(const s of t)e.add(s)},C3$jscomp$11.MapToObject=function(e){const t=Object.create(null);for(const[s,i]of e.entries())t[s]=i;return t},C3$jscomp$11.ObjectToMap=function(e,t){t.clear();for(const[s,i]of Object.entries(e))t.set(s,i)},C3$jscomp$11.ToSuperJSON=function e(t){if("object"==typeof t&&null!==t){if(t instanceof Set)return{_c3type_:"set",data:[...t].map((t=>e(t)))};if(t instanceof Map)return{_c3type_:"map",data:[...t].map((t=>[t[0],e(t[1])]))};const s=Object.create(null);for(const[i,r]of Object.entries(t))s[i]=e(r);return s}return t},C3$jscomp$11.FromSuperJSON=function e(t){if("object"==typeof t&null!==t){if("set"===t._c3type_)return new Set(t.data.map((t=>e(t))));if("map"===t._c3type_)return new Map(t.data.map((t=>[t[0],e(t[1])])));const s=Object.create(null);for(const[i,r]of Object.entries(t))s[i]=e(r);return s}return t},C3$jscomp$11.CSSToCamelCase=function(e){if(e.startsWith("--"))return e;let t="",s=!1;for(const i of e)"-"===i?s=!0:s?(t+=i.toUpperCase(),s=!1):t+=i;return t},C3$jscomp$11.IsIterator=function(e){return"object"==typeof e&&"function"==typeof e.next},C3$jscomp$11.MakeFilledArray=function(e,t){const s=[];if("function"==typeof t)for(var i=0;i<e;++i)s.push(t());else for(i=0;i<e;++i)s.push(t);return s};const C3$jscomp$12=self.C3,HSL_TEST=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?/i,HSLA_TEST=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?,([0-9.])/i;function padTwoDigits(e){return 0===e.length?"00":1===e.length?"0"+e:e}function hueToRGB(e,t,s){return 0>s&&(s+=1),1<s&&--s,s<1/6?e+6*(t-e)*s:.5>s?t:s<2/3?e+(t-e)*(2/3-s)*6:e}C3$jscomp$12.Color=class{constructor(e,t,s,i){this._a=this._b=this._g=this._r=0,e instanceof C3$jscomp$12.Color?this.set(e):this.setRgba(e||0,t||0,s||0,i||0)}setRgb(e,t,s){return this._r=+e,this._g=+t,this._b=+s,this.clamp(),this}setRgba(e,t,s,i){return this._r=+e,this._g=+t,this._b=+s,this._a=+i,this.clamp(),this}set(e){return this._r=e._r,this._g=e._g,this._b=e._b,this._a=e._a,this}copy(e){return this.set(e)}add(e){this._r+=e._r,this._g+=e._g,this._b+=e._b,this._a+=e._a,this.clamp()}addRgb(e,t,s,i=0){this._r+=+e,this._g+=+t,this._b+=+s,this._a+=+i,this.clamp()}diff(e){this.setR(Math.max(this._r,e._r)-Math.min(this._r,e._r)),this.setG(Math.max(this._g,e._g)-Math.min(this._g,e._g)),this.setB(Math.max(this._b,e._b)-Math.min(this._b,e._b)),this.setA(Math.max(this._a,e._a)-Math.min(this._a,e._a)),this.clamp()}copyRgb(e){this._r=e._r,this._g=e._g,this._b=e._b}setR(e){this._r=C3$jscomp$12.clamp(+e,0,1)}getR(){return this._r}setG(e){this._g=C3$jscomp$12.clamp(+e,0,1)}getG(){return this._g}setB(e){this._b=C3$jscomp$12.clamp(+e,0,1)}getB(){return this._b}setA(e){this._a=C3$jscomp$12.clamp(+e,0,1)}getA(){return this._a}clone(){return C3$jscomp$12.New(C3$jscomp$12.Color,this._r,this._g,this._b,this._a)}toArray(){return[this._r,this._g,this._b,this._a]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._r,e[t++]=this._g,e[t++]=this._b,e[t]=this._a}writeRGBToTypedArray(e,t){e[t++]=this._r,e[t++]=this._g,e[t]=this._b}equals(e){return this._r===e._r&&this._g===e._g&&this._b===e._b&&this._a===e._a}equalsIgnoringAlpha(e){return this._r===e._r&&this._g===e._g&&this._b===e._b}equalsRgb(e,t,s){return this._r===e&&this._g===t&&this._b===s}equalsRgba(e,t,s,i){return this._r===e&&this._g===t&&this._b===s&&this._a===i}equalsF32Array(e,t){return e[t]===Math.fround(this._r)&&e[t+1]===Math.fround(this._g)&&e[t+2]===Math.fround(this._b)&&e[t+3]===Math.fround(this._a)}equalsRGBF32Array(e,t){return e[t]===Math.fround(this._r)&&e[t+1]===Math.fround(this._g)&&e[t+2]===Math.fround(this._b)}multiply(e){this._r*=e._r,this._g*=e._g,this._b*=e._b,this._a*=e._a}multiplyAlpha(e){this._r*=e,this._g*=e,this._b*=e,this._a*=e}premultiply(){return this._r*=this._a,this._g*=this._a,this._b*=this._a,this}unpremultiply(){return this._r/=this._a,this._g/=this._a,this._b/=this._a,this}clamp(){return this._r=C3$jscomp$12.clamp(this._r,0,1),this._g=C3$jscomp$12.clamp(this._g,0,1),this._b=C3$jscomp$12.clamp(this._b,0,1),this._a=C3$jscomp$12.clamp(this._a,0,1),this}setFromRgbValue(e){this._r=C3$jscomp$12.GetRValue(e),this._g=C3$jscomp$12.GetGValue(e),this._b=C3$jscomp$12.GetBValue(e),this._a=C3$jscomp$12.GetAValue(e)}getCssRgb(e,t,s){return`rgb(${100*(e=C3$jscomp$12.IsFiniteNumber(e)?e:this.getR())}%, ${100*(t=C3$jscomp$12.IsFiniteNumber(t)?t:this.getG())}%, ${100*(s=C3$jscomp$12.IsFiniteNumber(s)?s:this.getB())}%)`}getCssRgba(e,t,s,i){return`rgba(${100*(e=C3$jscomp$12.IsFiniteNumber(e)?e:this.getR())}%, ${100*(t=C3$jscomp$12.IsFiniteNumber(t)?t:this.getG())}%, ${100*(s=C3$jscomp$12.IsFiniteNumber(s)?s:this.getB())}%, ${i=C3$jscomp$12.IsFiniteNumber(i)?i:this.getA()})`}toHexString(){const e=Math.round(255*this.getR()),t=Math.round(255*this.getG()),s=Math.round(255*this.getB());return"#"+padTwoDigits(e.toString(16))+padTwoDigits(t.toString(16))+padTwoDigits(s.toString(16))}parseHexString(e){if("string"!=typeof e)return!1;let t,s;if("#"===(e=e.trim()).charAt(0)&&(e=e.substr(1)),3===e.length)t=parseInt(e[0],16)/15,s=parseInt(e[1],16)/15,e=parseInt(e[2],16)/15;else{if(6!==e.length)return!1;t=parseInt(e.substr(0,2),16)/255,s=parseInt(e.substr(2,2),16)/255,e=parseInt(e.substr(4,2),16)/255}return isFinite(t)&&this.setR(t),isFinite(s)&&this.setG(s),isFinite(e)&&this.setB(e),this.setA(1),!0}toCommaSeparatedRgb(){return`${Math.round(255*this.getR())}, ${Math.round(255*this.getG())}, ${Math.round(255*this.getB())}`}toRgbArray(){return[Math.round(255*this.getR()),Math.round(255*this.getG()),Math.round(255*this.getB())]}parseCommaSeparatedRgb(e){if("string"!=typeof e)return!1;var t=(e=e.replace(/^rgb\(|\)|%/,"")).split(",");if(3>t.length)return!1;e=parseInt(t[0].trim(),10)/255;const s=parseInt(t[1].trim(),10)/255;return t=parseInt(t[2].trim(),10)/255,isFinite(e)&&this.setR(e),isFinite(s)&&this.setG(s),isFinite(t)&&this.setB(t),this.setA(1),!0}parseCommaSeparatedPercentageRgb(e){if("string"!=typeof e)return!1;var t=(e=e.replace(/^rgb\(|\)|%/,"")).split(",");if(3>t.length)return!1;e=parseInt(t[0].trim(),10)/100;const s=parseInt(t[1].trim(),10)/100;return t=parseInt(t[2].trim(),10)/100,isFinite(e)&&this.setR(e),isFinite(s)&&this.setG(s),isFinite(t)&&this.setB(t),this.setA(1),!0}parseCommaSeparatedRgba(e){if("string"!=typeof e)return!1;var t=(e=e.replace(/^rgba\(|\)|%/,"")).split(",");if(4>t.length)return!1;e=parseInt(t[0].trim(),10)/255;const s=parseInt(t[1].trim(),10)/255,i=parseInt(t[2].trim(),10)/255;return t=parseFloat(t[3].trim()),isFinite(e)&&this.setR(e),isFinite(s)&&this.setG(s),isFinite(i)&&this.setB(i),isFinite(t)&&this.setA(t),!0}parseCommaSeparatedPercentageRgba(e){if("string"!=typeof e)return!1;var t=(e=e.replace(/^rgba\(|\)|%/,"")).split(",");if(4>t.length)return!1;e=parseInt(t[0].trim(),10)/100;const s=parseInt(t[1].trim(),10)/100,i=parseInt(t[2].trim(),10)/100;return t=parseFloat(t[3].trim()),isFinite(e)&&this.setR(e),isFinite(s)&&this.setG(s),isFinite(i)&&this.setB(i),isFinite(t)&&this.setA(t),!0}parseString(e){if("string"!=typeof e)return!1;if((e=e.replace(/\s+/,"")).includes(",")){if(e.startsWith("rgb("))return e.includes("%")?this.parseCommaSeparatedPercentageRgb(e):this.parseCommaSeparatedRgb(e);if(e.startsWith("rgba("))return e.includes("%")?this.parseCommaSeparatedPercentageRgba(e):this.parseCommaSeparatedRgba(e);if(e.startsWith("hsl(")||e.startsWith("hsla("))return this.parseHSLString(e);const t=e.split(",");if(e.includes("%")){if(3===t.length)return this.parseCommaSeparatedPercentageRgb(e);if(4===t.length)return this.parseCommaSeparatedPercentageRgba(e)}else{if(3===t.length)return this.parseCommaSeparatedRgb(e);if(4===t.length)return this.parseCommaSeparatedRgba(e)}return!1}return this.parseHexString(e)}toJSON(){return[this._r,this._g,this._b,this._a]}setFromHSLA(e,t,s,i){if(e%=360,t=C3$jscomp$12.clamp(t,0,100),s=C3$jscomp$12.clamp(s,0,100),i=C3$jscomp$12.clamp(i,0,1),e/=360,s/=100,0===(t/=100))s=t=e=s;else{const i=.5>s?s*(1+t):s+t-s*t,r=2*s-i;s=hueToRGB(r,i,e+1/3),t=hueToRGB(r,i,e),e=hueToRGB(r,i,e-1/3)}return this.setR(s),this.setG(t),this.setB(e),this.setA(i),this}parseHSLString(e){var t=e.replace(/ |hsl|hsla|\(|\)|;/gi,"");return e=HSL_TEST.exec(t),t=HSLA_TEST.exec(t),e&&4===e.length?(this.setFromHSLA(+e[1],+e[2],+e[3],1),!0):!(!t||5!==t.length)&&(this.setFromHSLA(+e[1],+e[2],+e[3],+e[4]),!0)}toHSLAString(){var e=this._r;const t=this._g,s=this._b,i=this._a;return`hsla(${C3$jscomp$12.Color.GetHue(e,t,s)}, ${C3$jscomp$12.Color.GetSaturation(e,t,s)}%, ${e=C3$jscomp$12.Color.GetLuminosity(e,t,s)}%, ${i})`}toHSLAArray(){const e=this._r,t=this._g,s=this._b;return[C3$jscomp$12.Color.GetHue(e,t,s),C3$jscomp$12.Color.GetSaturation(e,t,s),C3$jscomp$12.Color.GetLuminosity(e,t,s),this._a]}setFromJSON(e){!Array.isArray(e)||3>e.length||(this._r=e[0],this._g=e[1],this._b=e[2],this._a=4<=e.length?e[3]:1)}set r(e){this.setR(e)}get r(){return this.getR()}set g(e){this.setG(e)}get g(){return this.getG()}set b(e){this.setB(e)}get b(){return this.getB()}set a(e){this.setA(e)}get a(){return this.getA()}setAtIndex(e,t){switch(e){case 0:this.setR(t);break;case 1:this.setG(t);break;case 2:this.setB(t);break;case 3:this.setA(t);break;default:throw new RangeError("invalid color index")}}getAtIndex(e){switch(e){case 0:return this.getR();case 1:return this.getG();case 2:return this.getB();case 3:return this.getA();default:throw new RangeError("invalid color index")}}static Equals(e,t){let s;if(Array.isArray(e))s=new C3$jscomp$12.Color,s.setFromJSON(e);else{if(!(e instanceof C3$jscomp$12.Color))throw Error("unexpected type");s=e}if(Array.isArray(t))(e=new C3$jscomp$12.Color).setFromJSON(t);else{if(!(t instanceof C3$jscomp$12.Color))throw Error("unexpected type");e=t}return s.equals(e)}static DiffChannel(e,t){return C3$jscomp$12.clamp(Math.max(e,t)-Math.min(e,t),0,1)}static Diff(e,t){const s=new C3$jscomp$12.Color;return s.setR(Math.max(e._r,t._r)-Math.min(e._r,t._r)),s.setG(Math.max(e._g,t._g)-Math.min(e._g,t._g)),s.setB(Math.max(e._b,t._b)-Math.min(e._b,t._b)),s.setA(Math.max(e._a,t._a)-Math.min(e._a,t._a)),s}static DiffNoAlpha(e,t){const s=new C3$jscomp$12.Color(0,0,0,1);return s.setR(Math.max(e._r,t._r)-Math.min(e._r,t._r)),s.setG(Math.max(e._g,t._g)-Math.min(e._g,t._g)),s.setB(Math.max(e._b,t._b)-Math.min(e._b,t._b)),s}static GetHue(e,t,s){const i=Math.max(e,t,s),r=Math.min(e,t,s);if(i===r)return 0;let n=0;switch(i){case e:n=(t-s)/(i-r)+(t<s?6:0);break;case t:n=(s-e)/(i-r)+2;break;case s:n=(e-t)/(i-r)+4}return Math.round(n/6*360)}static GetSaturation(e,t,s){const i=Math.max(e,t,s);return i===(e=Math.min(e,t,s))?0:(t=i-e,Math.round(100*(.5<(i+e)/2?t/(2-i-e):t/(i+e))))}static GetLuminosity(e,t,s){const i=Math.max(e,t,s);return i?Math.round((i+Math.min(e,t,s))/2*100):0}},C3$jscomp$12.Color.White=Object.freeze(C3$jscomp$12.New(C3$jscomp$12.Color,1,1,1,1)),C3$jscomp$12.Color.Black=Object.freeze(C3$jscomp$12.New(C3$jscomp$12.Color,0,0,0,1)),C3$jscomp$12.Color.TransparentBlack=Object.freeze(C3$jscomp$12.New(C3$jscomp$12.Color,0,0,0,0));const C3$jscomp$13=self.C3;C3$jscomp$13.Vector2=class{constructor(e,t){this._y=this._x=0,e instanceof C3$jscomp$13.Vector2?this.copy(e):this.set(e||0,t||0)}set(e,t){this._x=+e,this._y=+t}copy(e){this._x=e._x,this._y=e._y}equals(e){return this._x===e._x&&this._y===e._y}equalsValues(e,t){return this._x===e&&this._y===t}equalsF32Array(e,t){return e[t]===Math.fround(this._x)&&e[t+1]===Math.fround(this._y)}setX(e){this._x=+e}getX(){return this._x}setY(e){this._y=+e}getY(){return this._y}toArray(){return[this._x,this._y]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._x,e[t]=this._y}offset(e,t){this._x+=+e,this._y+=+t}scale(e,t){this._x*=e,this._y*=t}divide(e,t){this._x/=e,this._y/=t}round(){this._x=Math.round(this._x),this._y=Math.round(this._y)}floor(){this._x=Math.floor(this._x),this._y=Math.floor(this._y)}ceil(){this._x=Math.ceil(this._x),this._y=Math.ceil(this._y)}angle(){return C3$jscomp$13.angleTo(0,0,this._x,this._y)}lengthSquared(){return this._x*this._x+this._y*this._y}length(){return Math.hypot(this._x,this._y)}rotatePrecalc(e,t){const s=this._x*t-this._y*e;this._y=this._y*t+this._x*e,this._x=s}rotate(e){0!==e&&this.rotatePrecalc(Math.sin(e),Math.cos(e))}rotateAbout(e,t,s){0===e||t===this._x&&s===this._y||(this._x-=t,this._y-=s,this.rotatePrecalc(Math.sin(e),Math.cos(e)),this._x+=+t,this._y+=+s)}move(e,t){0!==t&&(this._x+=Math.cos(e)*t,this._y+=Math.sin(e)*t)}normalize(){const e=this.length();0!==e&&1!==e&&(this._x/=e,this._y/=e)}clamp(e,t){this._x=C3$jscomp$13.clamp(this._x,e,t),this._y=C3$jscomp$13.clamp(this._y,e,t)}};const C3$jscomp$14=self.C3;C3$jscomp$14.Rect=class{constructor(e,t,s,i){this._bottom=this._right=this._top=this._left=0,e instanceof C3$jscomp$14.Rect?this.copy(e):this.set(e||0,t||0,s||0,i||0)}set(e,t,s,i){this._left=+e,this._top=+t,this._right=+s,this._bottom=+i}setWH(e,t,s,i){e=+e,t=+t,this._left=e,this._top=t,this._right=e+ +s,this._bottom=t+ +i}copy(e){this._left=+e._left,this._top=+e._top,this._right=+e._right,this._bottom=+e._bottom}clone(){return new C3$jscomp$14.Rect(this._left,this._top,this._right,this._bottom)}static Merge(e,t){const s=new C3$jscomp$14.Rect;return s.setLeft(Math.min(e._left,t._left)),s.setTop(Math.min(e._top,t._top)),s.setRight(Math.max(e._right,t._right)),s.setBottom(Math.max(e._bottom,t._bottom)),s}static FromObject(e){return new C3$jscomp$14.Rect(e.left,e.top,e.right,e.bottom)}equals(e){return this._left===e._left&&this._top===e._top&&this._right===e._right&&this._bottom===e._bottom}equalsWH(e,t,s,i){return this._left===e&&this._top===t&&this.width()===s&&this.height()===i}equalsF32Array(e,t){return e[t]===Math.fround(this._left)&&e[t+1]===Math.fround(this._top)&&e[t+2]===Math.fround(this._right)&&e[t+3]===Math.fround(this._bottom)}setLeft(e){this._left=+e}getLeft(){return this._left}setTop(e){this._top=+e}getTop(){return this._top}setRight(e){this._right=+e}getRight(){return this._right}setBottom(e){this._bottom=+e}getBottom(){return this._bottom}toArray(){return[this._left,this._top,this._right,this._bottom]}toTypedArray(){return new Float64Array(this.toArray())}toDOMRect(){return new DOMRect(this._left,this._top,this.width(),this.height())}writeToTypedArray(e,t){e[t++]=this._left,e[t++]=this._top,e[t++]=this._right,e[t]=this._bottom}writeAsQuadToTypedArray(e,t){e[t++]=this._left,e[t++]=this._top,e[t++]=this._right,e[t++]=this._top,e[t++]=this._right,e[t++]=this._bottom,e[t++]=this._left,e[t]=this._bottom}writeAsQuadToTypedArray3D(e,t,s){e[t++]=this._left,e[t++]=this._top,e[t++]=s,e[t++]=this._right,e[t++]=this._top,e[t++]=s,e[t++]=this._right,e[t++]=this._bottom,e[t++]=s,e[t++]=this._left,e[t++]=this._bottom,e[t]=s}width(){return this._right-this._left}height(){return this._bottom-this._top}midX(){return(this._left+this._right)/2}midY(){return(this._top+this._bottom)/2}offset(e,t){e=+e,t=+t,this._left+=e,this._top+=t,this._right+=e,this._bottom+=t}offsetLeft(e){this._left+=+e}offsetTop(e){this._top+=+e}offsetRight(e){this._right+=+e}offsetBottom(e){this._bottom+=+e}toSquare(e){if("x"!==e)throw Error("invalid axis, only 'x' supported");this._bottom=this._top<this._bottom?this._left<this._right?this._top+this.width():this._top-this.width():this._left<this._right?this._top-this.width():this._top+this.width()}inflate(e,t){e=+e,t=+t,this._left-=e,this._top-=t,this._right+=e,this._bottom+=t}deflate(e,t){e=+e,t=+t,this._left+=e,this._top+=t,this._right-=e,this._bottom-=t}multiply(e,t){this._left*=e,this._top*=t,this._right*=e,this._bottom*=t}divide(e,t){this._left/=e,this._top/=t,this._right/=e,this._bottom/=t}mirrorAround(e){this._left=+e-this._left,this._right=+e-this._right}flipAround(e){this._top=+e-this._top,this._bottom=+e-this._bottom}rotate90DegreesAround(e,t){const s=this.width(),i=this.height(),r=this.getLeft()+s*e,n=this.getTop()+i*t;this.setWH(r-i*t,n-s*e,i,s)}swapLeftRight(){const e=this._left;this._left=this._right,this._right=e}swapTopBottom(){const e=this._top;this._top=this._bottom,this._bottom=e}shuntY(e){const t=this._top;this._top=+e-this._bottom,this._bottom=+e-t}round(){this._left=Math.round(this._left),this._top=Math.round(this._top),this._right=Math.round(this._right),this._bottom=Math.round(this._bottom)}roundInner(){this._left=Math.ceil(this._left),this._top=Math.ceil(this._top),this._right=Math.floor(this._right),this._bottom=Math.floor(this._bottom)}roundOuter(){this._left=Math.floor(this._left),this._top=Math.floor(this._top),this._right=Math.ceil(this._right),this._bottom=Math.ceil(this._bottom)}floor(){this._left=Math.floor(this._left),this._top=Math.floor(this._top),this._right=Math.floor(this._right),this._bottom=Math.floor(this._bottom)}ceil(){this._left=Math.ceil(this._left),this._top=Math.ceil(this._top),this._right=Math.ceil(this._right),this._bottom=Math.ceil(this._bottom)}clamp(e,t,s,i){this._left<e&&(this._left=+e),this._top<t&&(this._top=+t),this._right>s&&(this._right=+s),this._bottom>i&&(this._bottom=+i)}clampFlipped(e,t,s,i){this._left<e&&(this._left=+e),this._top>t&&(this._top=+t),this._right>s&&(this._right=+s),this._bottom<i&&(this._bottom=+i)}normalize(){this._left>this._right&&this.swapLeftRight(),this._top>this._bottom&&this.swapTopBottom()}intersectsRect(e){return!(e._right<this._left||e._bottom<this._top||e._left>this._right||e._top>this._bottom)}intersectsRectOffset(e,t,s){return!(e._right+t<this._left||e._bottom+s<this._top||e._left+t>this._right||e._top+s>this._bottom)}containsPoint(e,t){return e>=this._left&&e<=this._right&&t>=this._top&&t<=this._bottom}containsRect(e){return e._left>=this._left&&e._top>=this._top&&e._right<=this._right&&e._bottom<=this._bottom}expandToContain(e){e._left<this._left&&(this._left=+e._left),e._top<this._top&&(this._top=+e._top),e._right>this._right&&(this._right=+e._right),e._bottom>this._bottom&&(this._bottom=+e._bottom)}lerpInto(e){this._left=C3$jscomp$14.lerp(e._left,e._right,this._left),this._top=C3$jscomp$14.lerp(e._top,e._bottom,this._top),this._right=C3$jscomp$14.lerp(e._left,e._right,this._right),this._bottom=C3$jscomp$14.lerp(e._top,e._bottom,this._bottom)}};const C3$jscomp$15=self.C3;C3$jscomp$15.Quad=class{constructor(e,t,s,i,r,n,a,o){this._bly=this._blx=this._bry=this._brx=this._try=this._trx=this._tly=this._tlx=0,e instanceof C3$jscomp$15.Quad?this.copy(e):this.set(e||0,t||0,s||0,i||0,r||0,n||0,a||0,o||0)}set(e,t,s,i,r,n,a,o){this._tlx=+e,this._tly=+t,this._trx=+s,this._try=+i,this._brx=+r,this._bry=+n,this._blx=+a,this._bly=+o}setRect(e,t,s,i){this.set(e,t,s,t,s,i,e,i)}copy(e){this._tlx=e._tlx,this._tly=e._tly,this._trx=e._trx,this._try=e._try,this._brx=e._brx,this._bry=e._bry,this._blx=e._blx,this._bly=e._bly}equals(e){return this._tlx===e._tlx&&this._tly===e._tly&&this._trx===e._trx&&this._try===e._try&&this._brx===e._brx&&this._bry===e._bry&&this._blx===e._blx&&this._bly===e._bly}setTlx(e){this._tlx=+e}getTlx(){return this._tlx}setTly(e){this._tly=+e}getTly(){return this._tly}setTrx(e){this._trx=+e}getTrx(){return this._trx}setTry(e){this._try=+e}getTry(){return this._try}setBrx(e){this._brx=+e}getBrx(){return this._brx}setBry(e){this._bry=+e}getBry(){return this._bry}setBlx(e){this._blx=+e}getBlx(){return this._blx}setBly(e){this._bly=+e}getBly(){return this._bly}toDOMQuad(){return new DOMQuad(new DOMPoint(this._tlx,this._tly),new DOMPoint(this._trx,this._try),new DOMPoint(this._brx,this._bry),new DOMPoint(this._blx,this._bly))}toArray(){return[this._tlx,this._tly,this._trx,this._try,this._brx,this._bry,this._blx,this._bly]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._tlx,e[t++]=this._tly,e[t++]=this._trx,e[t++]=this._try,e[t++]=this._brx,e[t++]=this._bry,e[t++]=this._blx,e[t]=this._bly}writeToTypedArray3D(e,t,s){e[t++]=this._tlx,e[t++]=this._tly,e[t++]=s,e[t++]=this._trx,e[t++]=this._try,e[t++]=s,e[t++]=this._brx,e[t++]=this._bry,e[t++]=s,e[t++]=this._blx,e[t++]=this._bly,e[t]=s}offset(e,t){e=+e,t=+t,this._tlx+=e,this._tly+=t,this._trx+=e,this._try+=t,this._brx+=e,this._bry+=t,this._blx+=e,this._bly+=t}round(){this._tlx=Math.round(this._tlx),this._tly=Math.round(this._tly),this._trx=Math.round(this._trx),this._try=Math.round(this._try),this._brx=Math.round(this._brx),this._bry=Math.round(this._bry),this._blx=Math.round(this._blx),this._bly=Math.round(this._bly)}floor(){this._tlx=Math.floor(this._tlx),this._tly=Math.floor(this._tly),this._trx=Math.floor(this._trx),this._try=Math.floor(this._try),this._brx=Math.floor(this._brx),this._bry=Math.floor(this._bry),this._blx=Math.floor(this._blx),this._bly=Math.floor(this._bly)}ceil(){this._tlx=Math.ceil(this._tlx),this._tly=Math.ceil(this._tly),this._trx=Math.ceil(this._trx),this._try=Math.ceil(this._try),this._brx=Math.ceil(this._brx),this._bry=Math.ceil(this._bry),this._blx=Math.ceil(this._blx),this._bly=Math.ceil(this._bly)}setFromRect(e){this._tlx=e._left,this._tly=e._top,this._trx=e._right,this._try=e._top,this._brx=e._right,this._bry=e._bottom,this._blx=e._left,this._bly=e._bottom}setFromRotatedRect(e,t){0===t?this.setFromRect(e):this.setFromRotatedRectPrecalc(e,Math.sin(t),Math.cos(t))}setFromRotatedRectPrecalc(e,t,s){const i=e._left*t,r=e._top*t,n=e._right*t;t*=e._bottom;const a=e._left*s,o=e._top*s,h=e._right*s;e=e._bottom*s,this._tlx=a-r,this._tly=o+i,this._trx=h-r,this._try=o+n,this._brx=h-t,this._bry=e+n,this._blx=a-t,this._bly=e+i}getBoundingBox(e){e.set(Math.min(this._tlx,this._trx,this._brx,this._blx),Math.min(this._tly,this._try,this._bry,this._bly),Math.max(this._tlx,this._trx,this._brx,this._blx),Math.max(this._tly,this._try,this._bry,this._bly))}containsPoint(e,t){var s=this._trx-this._tlx,i=this._try-this._tly;const r=this._brx-this._tlx,n=this._bry-this._tly;var a=s*s+i*i;let o=s*r+i*n;const h=r*r+n*n,l=r*(e-=this._tlx)+n*(t-=this._tly);let c=1/(a*h-o*o);return a=(a*l-o*(i=s*e+i*t))*c,0<=(s=(h*i-o*l)*c)&&0<a&&1>s+a||(o=(s=this._blx-this._tlx)*r+(i=this._bly-this._tly)*n,c=1/((a=s*s+i*i)*h-o*o),a=(a*l-o*(i=s*e+i*t))*c,0<=(s=(h*i-o*l)*c)&&0<a&&1>s+a)}midX(){return(this._tlx+this._trx+this._brx+this._blx)/4}midY(){return(this._tly+this._try+this._bry+this._bly)/4}intersectsSegment(e,t,s,i){return!(!this.containsPoint(e,t)&&!this.containsPoint(s,i))||C3$jscomp$15.segmentIntersectsQuad(e,t,s,i,this)}intersectsQuad(e){var t=e.midX(),s=e.midY();if(this.containsPoint(t,s))return!0;if(t=this.midX(),s=this.midY(),e.containsPoint(t,s))return!0;t=this._tlx,s=this._tly;const i=this._trx,r=this._try,n=this._brx,a=this._bry,o=this._blx,h=this._bly;return C3$jscomp$15.segmentIntersectsQuad(t,s,i,r,e)||C3$jscomp$15.segmentIntersectsQuad(i,r,n,a,e)||C3$jscomp$15.segmentIntersectsQuad(n,a,o,h,e)||C3$jscomp$15.segmentIntersectsQuad(o,h,t,s,e)}rotatePointsAnticlockwise(){const e=this._tlx,t=this._tly;this._tlx=this._trx,this._tly=this._try,this._trx=this._brx,this._try=this._bry,this._brx=this._blx,this._bry=this._bly,this._blx=e,this._bly=t}mirror(){this._swap(0,2),this._swap(1,3),this._swap(6,4),this._swap(7,5)}flip(){this._swap(0,6),this._swap(1,7),this._swap(2,4),this._swap(3,5)}diag(){this._swap(2,6),this._swap(3,7)}_swap(e,t){const s=this._getAtIndex(e);this._setAtIndex(e,this._getAtIndex(t)),this._setAtIndex(t,s)}_getAtIndex(e){switch(e){case 0:return this._tlx;case 1:return this._tly;case 2:return this._trx;case 3:return this._try;case 4:return this._brx;case 5:return this._bry;case 6:return this._blx;case 7:return this._bly;default:throw new RangeError("invalid quad point index")}}_setAtIndex(e,t){switch(t=+t,e){case 0:this._tlx=t;break;case 1:this._tly=t;break;case 2:this._trx=t;break;case 3:this._try=t;break;case 4:this._brx=t;break;case 5:this._bry=t;break;case 6:this._blx=t;break;case 7:this._bly=t;break;default:throw new RangeError("invalid quad point index")}}};const C3$jscomp$16=self.C3,DEFAULT_POLY_POINTS=[0,0,1,0,1,1,0,1],tempQuad=C3$jscomp$16.New(C3$jscomp$16.Quad);C3$jscomp$16.CollisionPoly=class extends C3$jscomp$16.DefendedBase{constructor(e,t=!0){super(),e||(e=DEFAULT_POLY_POINTS),this._ptsArr=Float64Array.from(e),this._bbox=new C3$jscomp$16.Rect,this._isBboxChanged=!0,this._enabled=t}Release(){}pointsArr(){return this._ptsArr}pointCount(){return this._ptsArr.length/2}setPoints(e){this._ptsArr.length===e.length?this._ptsArr.set(e):this._ptsArr=Float64Array.from(e),this._isBboxChanged=!0}setDefaultPoints(){this.setPoints(DEFAULT_POLY_POINTS)}copy(e){this.setPoints(e._ptsArr)}setBboxChanged(){this._isBboxChanged=!0}_updateBbox(){if(this._isBboxChanged){var e=this._ptsArr,t=e[0],s=e[1],i=t,r=s;for(let n=0,a=e.length;n<a;n+=2){const a=e[n],o=e[n+1];a<t&&(t=a),a>i&&(i=a),o<s&&(s=o),o>r&&(r=o)}this._bbox.set(t,s,i,r),this._isBboxChanged=!1}}setFromRect(e,t,s){let i=this._ptsArr;8!==i.length&&(this._ptsArr=i=new Float64Array(8)),i[0]=e.getLeft()-t,i[1]=e.getTop()-s,i[2]=e.getRight()-t,i[3]=e.getTop()-s,i[4]=e.getRight()-t,i[5]=e.getBottom()-s,i[6]=e.getLeft()-t,i[7]=e.getBottom()-s,this._bbox.copy(e),0===t&&0===s||this._bbox.offset(-t,-s),this._isBboxChanged=!1}setFromQuad(e,t,s){tempQuad.copy(e),tempQuad.offset(t,s),this.setPoints(tempQuad.toArray()),this._isBboxChanged=!0}transform(e,t,s){let i=0,r=1;0!==s&&(i=Math.sin(s),r=Math.cos(s)),this.transformPrecalc(e,t,i,r)}transformPrecalc(e,t,s,i){const r=this._ptsArr;for(let n=0,a=r.length;n<a;n+=2){const a=n+1,o=r[n]*e,h=r[a]*t;r[n]=o*i-h*s,r[a]=h*i+o*s}this._isBboxChanged=!0}offset(e,t){const s=this._ptsArr;for(let i=0,r=s.length;i<r;i+=2)s[i]+=e,s[i+1]+=t}containsPoint(e,t){const s=this._ptsArr;if(e===s[0]&&t===s[1])return!0;this._updateBbox();var i=this._bbox;const r=i.getLeft()-110,n=i.getTop()-101,a=i.getRight()+131;let o,h,l,c,u,p,_,m;r<e?(o=r,l=e):(o=e,l=r),n<t?(h=n,c=t):(h=t,c=n),a<e?(u=a,_=e):(u=e,_=a),(i=i.getBottom()+120)<t?(p=i,m=t):(p=t,m=i);let d=0,g=0;for(let C=0,S=s.length;C<S;C+=2){var f=(C+2)%S;const y=s[C],$=s[C+1],G=s[f];f=s[f+1],C3$jscomp$16.segmentsIntersectPreCalc(r,n,e,t,o,l,h,c,y,$,G,f)&&++d,C3$jscomp$16.segmentsIntersectPreCalc(a,i,e,t,u,_,p,m,y,$,G,f)&&++g}return 1==d%2||1==g%2}intersectsPoly(e,t,s){const i=e._ptsArr,r=this._ptsArr;if(this.containsPoint(i[0]+t,i[1]+s)||e.containsPoint(r[0]-t,r[1]-s))return!0;for(let a=0,o=r.length;a<o;a+=2){var n=(a+2)%o;e=r[a];const h=r[a+1],l=r[n];let c,u,p,_;n=r[n+1],e<l?(c=e,p=l):(c=l,p=e),h<n?(u=h,_=n):(u=n,_=h);for(let r=0,a=i.length;r<a;r+=2){const o=(r+2)%a;if(C3$jscomp$16.segmentsIntersectPreCalc(e,h,l,n,c,p,u,_,i[r]+t,i[r+1]+s,i[o]+t,i[o+1]+s))return!0}}return!1}intersectsSegment(e,t,s,i,r,n){if(this.containsPoint(s-e,i-t)||this.containsPoint(r-e,n-t))return!0;let a,o,h,l;s<r?(a=s,h=r):(a=r,h=s),i<n?(o=i,l=n):(o=n,l=i);const c=this._ptsArr;for(let u=0,p=c.length;u<p;u+=2){const _=(u+2)%p;if(C3$jscomp$16.segmentsIntersectPreCalc(s,i,r,n,a,h,o,l,c[u]+e,c[u+1]+t,c[_]+e,c[_+1]+t))return!0}return!1}mirror(e){const t=this._ptsArr;for(let s=0,i=t.length;s<i;s+=2)t[s]=2*e-t[s];this._isBboxChanged=!0}flip(e){const t=this._ptsArr;for(let s=0,i=t.length;s<i;s+=2){const i=s+1;t[i]=2*e-t[i]}this._isBboxChanged=!0}diag(){const e=this._ptsArr;for(let t=0,s=e.length;t<s;t+=2){const s=t+1,i=e[t];e[t]=e[s],e[s]=i}this._isBboxChanged=!0}GetMidX(){const e=this._ptsArr;let t=0;for(let s=0,i=e.length;s<i;s+=2)t+=e[s];return t/this.pointCount()}GetMidY(){const e=this._ptsArr;let t=0;for(let s=0,i=e.length;s<i;s+=2)t+=e[s+1];return t/this.pointCount()}GetPointsArray(){return this._ptsArr}GetPointCount(){return this.pointCount()}IsEnabled(){return this._enabled}};const C3$jscomp$17=self.C3;C3$jscomp$17.PairMap=class extends C3$jscomp$17.DefendedBase{constructor(e){if(super(),this._firstMap=new Map,e)for(const[t,s,i]of e)this.Set(t,s,i)}Release(){this.Clear(),this._firstMap=null}Clear(){const e=this._firstMap;for(const t of e.values())t.clear();e.clear()}Set(e,t,s){const i=this._firstMap;let r=i.get(e);r||(r=new Map,i.set(e,r)),r.set(t,s)}Get(e,t){return(e=this._firstMap.get(e))?e.get(t):e}Has(e,t){return!!(e=this._firstMap.get(e))&&e.has(t)}Delete(e,t){const s=this._firstMap,i=s.get(e);return!!i&&((t=i.delete(t))&&0===i.size&&s.delete(e),t)}DeleteEither(e){const t=this._firstMap,s=t.get(e);s&&(s.clear(),t.delete(e));for(const[s,i]of t.entries())i.delete(e)&&0===i.size&&t.delete(s)}GetSize(){let e=0;for(const t of this._firstMap.values())e+=t.size;return e}*values(){for(const e of this._firstMap.values())yield*e.values()}*keyPairs(){for(const[e,t]of this._firstMap.entries())for(const s of t.keys())yield[e,s]}*entries(){for(const[e,t]of this._firstMap.entries())for(const[s,i]of t.entries())yield[e,s,i]}};const C3$jscomp$18=self.C3;C3$jscomp$18.ArraySet=class extends C3$jscomp$18.DefendedBase{constructor(){super(),this._set=new Set,this._arr=[],this._needToRebuildArray=!1}Release(){this.Clear()}Clear(){this._set.clear(),C3$jscomp$18.clearArray(this._arr),this._needToRebuildArray=!1}Add(e){this._set.has(e)||(this._set.add(e),this._needToRebuildArray||this._arr.push(e))}Has(e){return this._set.has(e)}Delete(e){this._set.delete(e)&&(this._needToRebuildArray=!0)}GetSize(){return this._set.size}IsEmpty(){return 0===this._set.size}GetArray(){return this._needToRebuildArray&&(this._RebuildArray(),this._needToRebuildArray=!1),this._arr}_RebuildArray(){const e=this._arr;C3$jscomp$18.clearArray(e);for(const t of this._set)e.push(t)}};const C3$jscomp$19=self.C3,EASE_MAP=new Map,PREDEFINED_EASE_MAP=new Map,CUSTOM_EASE_EDITOR_MAP=new Map,CUSTOM_EASE_RUNTIME_MAP=new Map,PRIVATE_EASE_MAP=new Map,BUILT_IN_TRANSITION_MAP=new Map,ALIAS_MAP=new Map;ALIAS_MAP.set("linear","noease"),ALIAS_MAP.set("default","noease");const EASE_TRANSLATION_KEYS="default noease easeinquad easeoutquad easeinoutquad easeincubic easeoutcubic easeinoutcubic easeinquart easeoutquart easeinoutquart easeinquint easeoutquint easeinoutquint easeinsine easeoutsine easeinoutsine easeinexpo easeoutexpo easeinoutexpo easeincirc easeoutcirc easeinoutcirc easeinelastic easeoutelastic easeinoutelastic easeinback easeoutback easeinoutback easeinbounce easeoutbounce easeinoutbounce".split(" "),SHORT_EASE_TRANSLATION_KEYS="default noease quad cubic quart quint sine expo circ elastic back bounce".split(" "),EASE_API2INTERNAL_NAMES=new Map([["linear","noease"],["in-sine","easeinsine"],["out-sine","easeoutsine"],["in-out-sine","easeinoutsine"],["in-elastic","easeinelastic"],["out-elastic","easeoutelastic"],["in-out-elastic","easeinoutelastic"],["in-back","easeinback"],["out-back","easeoutback"],["in-out-back","easeinoutback"],["in-bounce","easeinbounce"],["out-bounce","easeoutbounce"],["in-out-bounce","easeinoutbounce"],["in-cubic","easeincubic"],["out-cubic","easeoutcubic"],["in-out-cubic","easeinoutcubic"],["in-quadratic","easeinquad"],["out-quadratic","easeoutquad"],["in-out-quadratic","easeinoutquad"],["in-quartic","easeinquart"],["out-quartic","easeoutquart"],["in-out-quartic","easeinoutquart"],["in-quintic","easeinquint"],["out-quintic","easeoutquint"],["in-out-quintic","easeinoutquint"],["in-circular","easeincirc"],["out-circular","easeoutcirc"],["in-out-circular","easeinoutcirc"],["in-exponential","easeinexpo"],["out-exponential","easeoutexpo"],["in-out-exponential","easeinoutexpo"]]);self.Ease=class e{constructor(){}static InheritEase(){return"default"}static DefaultEase(){return"noease"}static ToInternal(e){return EASE_API2INTERNAL_NAMES.get(e)}static GetEditorEaseNames(e,...t){return this._CreateEaseMap(),e?(CUSTOM_EASE_EDITOR_MAP.has(e)||CUSTOM_EASE_EDITOR_MAP.set(e,new Map),e=CUSTOM_EASE_EDITOR_MAP.get(e)):e=CUSTOM_EASE_RUNTIME_MAP,(e=[...e.keys()]).sort(),[...PREDEFINED_EASE_MAP.keys()].concat(e).filter((e=>!t.includes(e)))}static GetRuntimeEaseNames(){this._CreateEaseMap();const e=[...CUSTOM_EASE_RUNTIME_MAP.keys()];return e.sort(),[...PREDEFINED_EASE_MAP.keys()].concat(e)}static GetCustomRuntimeEaseNames(){this._CreateEaseMap();const e=[...CUSTOM_EASE_RUNTIME_MAP.keys()];return e.sort(),e}static IsPredefinedTranslatedName(e){for(const t of EASE_TRANSLATION_KEYS)if(self.lang(`ui.bars.timeline.eases.${t}`)===e)return!0;for(const t of SHORT_EASE_TRANSLATION_KEYS)if(self.lang(`ui.bars.timeline.short-eases.${t}`)===e)return!0}static IsNamePredefined(e){return this._CreateEaseMap(),[...PREDEFINED_EASE_MAP.keys()].includes(e)}static _GetEase(t){const s=ALIAS_MAP.get(t);return s?EASE_MAP.get(s):e.IsNamePredefined(t)?EASE_MAP.get(t):PRIVATE_EASE_MAP.has(t)?PRIVATE_EASE_MAP.get(t):void 0}static GetBuiltInTransition(e){return this._CreateEaseMap(),BUILT_IN_TRANSITION_MAP.get(e)}static GetEditorEase(t,s){this._CreateEaseMap();const i=e._GetEase(t);if(i)return i;if(!s)throw Error("missing ease function");return CUSTOM_EASE_EDITOR_MAP.get(s).get(t)}static GetRuntimeEase(t){this._CreateEaseMap();const s=e._GetEase(t);return s||CUSTOM_EASE_RUNTIME_MAP.get(t)}static GetEaseFromIndex(e){return this._CreateEaseMap(),this.GetRuntimeEaseNames()[e]}static GetIndexForEase(e,t){return this._CreateEaseMap(),this.GetEditorEaseNames(t).indexOf(e)}static GetIndexForEaseAtRuntime(e){return this.GetIndexForEase(e)}static _CreateEaseMap(){0===EASE_MAP.size&&(this._AddPredifinedEase("default",(()=>{})),this._AddPredifinedEase("noease",[{x:0,y:0,sax:.336,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.336,eay:0,se:!1,ee:!0}],!0),this._AddPredifinedEase("easeinsine",[{x:0,y:0,sax:.485,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.038,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutsine",[{x:0,y:0,sax:.038,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.485,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutsine",[{x:0,y:0,sax:.336,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.336,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinelastic",[{x:0,y:0,sax:.018,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.116,y:.002,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.266,y:-.005,sax:.024,say:0,eax:-.021,eay:0,se:!0,ee:!0},{x:.416,y:.016,sax:.024,say:0,eax:-.026,eay:0,se:!0,ee:!0},{x:.566,y:-.045,sax:.061,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.716,y:.132,sax:.072,say:-.004,eax:-.045,eay:0,se:!0,ee:!0},{x:.866,y:-.373,sax:.06,say:0,eax:-.049,eay:-.002,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.038,eay:-.263,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutelastic",[{x:0,y:0,sax:.038,say:.263,eax:0,eay:0,se:!0,ee:!1},{x:.136,y:1.373,sax:.049,say:.002,eax:-.06,eay:0,se:!0,ee:!0},{x:.286,y:.868,sax:.045,say:0,eax:-.072,eay:.004,se:!0,ee:!0},{x:.436,y:1.045,sax:.025,say:0,eax:-.061,eay:0,se:!0,ee:!0},{x:.586,y:.984,sax:.026,say:0,eax:-.024,eay:0,se:!0,ee:!0},{x:.736,y:1.005,sax:.021,say:0,eax:-.024,eay:0,se:!0,ee:!0},{x:.886,y:.998,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.018,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutelastic",[{x:0,y:0,sax:.025,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.067,y:.001,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.18,y:-.005,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.292,y:.025,sax:.053,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.405,y:-.118,sax:.069,say:0,eax:-.027,eay:0,se:!0,ee:!0},{x:.597,y:1.118,sax:.027,say:0,eax:-.069,eay:0,se:!0,ee:!0},{x:.71,y:.975,sax:.025,say:0,eax:-.053,eay:0,se:!0,ee:!0},{x:.822,y:1.005,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.935,y:.999,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.025,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinback",[{x:0,y:0,sax:.35,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.34,eay:-1.579,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutback",[{x:0,y:0,sax:.34,say:1.579,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.35,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutback",[{x:0,y:0,sax:.035,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.242,y:-.1,sax:.258,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.76,y:1.1,sax:.025,say:0,eax:-.26,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.035,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinbounce",[{x:0,y:0,sax:.033,say:.025,eax:0,eay:0,se:!0,ee:!1},{x:.092,y:0,sax:.026,say:.078,eax:-.033,eay:.025,se:!0,ee:!0},{x:.274,y:0,sax:.097,say:.319,eax:-.026,eay:.078,se:!0,ee:!0},{x:.637,y:0,sax:.105,say:.625,eax:-.097,eay:.319,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.125,eay:-.004,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutbounce",[{x:0,y:0,sax:.125,say:.004,eax:0,eay:0,se:!0,ee:!1},{x:.365,y:1,sax:.097,say:-.319,eax:-.105,eay:-.625,se:!0,ee:!0},{x:.728,y:1,sax:.026,say:-.078,eax:-.097,eay:-.319,se:!0,ee:!0},{x:.91,y:1,sax:.033,say:-.025,eax:-.026,eay:-.078,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.033,eay:-.025,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutbounce",[{x:0,y:0,sax:.01,say:.006,eax:0,eay:0,se:!0,ee:!1},{x:.046,y:0,sax:.021,say:.038,eax:-.01,eay:.006,se:!0,ee:!0},{x:.137,y:0,sax:.059,say:.158,eax:-.021,eay:.038,se:!0,ee:!0},{x:.319,y:0,sax:.117,say:.744,eax:-.059,eay:.158,se:!0,ee:!0},{x:.683,y:1,sax:.059,say:-.158,eax:-.117,eay:-.744,se:!0,ee:!0},{x:.865,y:1,sax:.021,say:-.038,eax:-.059,eay:-.158,se:!0,ee:!0},{x:.956,y:1,sax:.01,say:-.006,eax:-.021,eay:-.038,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.01,eay:-.006,se:!1,ee:!0}]),this._AddPredifinedEase("easeincubic",[{x:0,y:0,sax:.75,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.138,eay:-.321,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutcubic",[{x:0,y:0,sax:.138,say:.321,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.75,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutcubic",[{x:0,y:0,sax:.285,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.081,say:.272,eax:-.081,eay:-.272,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.285,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquad",[{x:0,y:0,sax:.4,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.178,eay:-.392,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquad",[{x:0,y:0,sax:.178,say:.392,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.4,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquad",[{x:0,y:0,sax:.25,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.03,say:.065,eax:-.03,eay:-.065,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.25,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquart",[{x:0,y:0,sax:.264,say:.079,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.329,eay:-1.287,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquart",[{x:0,y:0,sax:.329,say:1.287,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.264,eay:-.079,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquart",[{x:0,y:0,sax:.765,say:.03,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.765,eay:-.03,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquint",[{x:0,y:0,sax:.6,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.2,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquint",[{x:0,y:0,sax:.2,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.6,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquint",[{eax:0,eay:0,ee:!1,sax:.84,say:0,se:!0,x:0,y:0},{eax:-.84,eay:0,ee:!0,sax:0,say:0,se:!1,x:1,y:1}]),this._AddPredifinedEase("easeincirc",[{x:0,y:0,sax:.25,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.024,eay:-.808,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutcirc",[{x:0,y:0,sax:.024,say:.808,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.25,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutcirc",[{x:0,y:0,sax:.125,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.02,say:.428,eax:-.02,eay:-.428,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.125,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinexpo",[{x:0,y:0,sax:.66,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.14,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutexpo",[{x:0,y:0,sax:.14,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.66,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutexpo",[{eax:0,eay:0,ee:!1,sax:.345,say:0,se:!0,x:0,y:0},{eax:-.06,eay:-.5,ee:!0,sax:.06,say:.5,se:!0,x:.5,y:.5},{eax:-.335,eay:0,ee:!0,sax:0,say:0,se:!1,x:1,y:1}]),this._AddPrivateCustomEase("cubicbezier",this.EaseCubicBezier),this._AddPrivateCustomEase("spline",this.EaseSpline))}static _AddPredifinedEase(t,s,i=!1){if("function"==typeof s)e._AddEase(t,s,"predefined");else{if(!C3$jscomp$19.IsArray(s))throw Error("unexpected arguments");if(self.BuiltInTransition){const r=C3$jscomp$19.New(self.BuiltInTransition,t,i);r.SetFromJson(s),e._AddEase(t,((e,t,s,i)=>r.Interpolate(e,t,s,i)),"predefined"),BUILT_IN_TRANSITION_MAP.set(t,r)}else{const r=C3$jscomp$19.New(C3$jscomp$19.Transition,[t,s.map((e=>[e.x,e.y,e.sax,e.say,e.eax,e.eay,e.se,e.ee]))],!1);r.MakeLinear(i),e._AddEase(t,((e,t,s,i)=>r.Interpolate(e,t,s,i)),"predefined")}}}static _AddPrivateCustomEase(t,s){e._AddEase(t,s,"private")}static AddCustomEase(t,s,i){this._CreateEaseMap(),e._AddEase(t,s,"custom",i)}static RemoveCustomEase(e,t){this.IsNamePredefined(e)||[...PRIVATE_EASE_MAP.keys()].includes(e)||(t=CUSTOM_EASE_EDITOR_MAP.get(t))&&t.delete(e)}static _AddEase(e,t,s,i){switch(s){case"predefined":EASE_MAP.set(e,t),PREDEFINED_EASE_MAP.set(e,t);break;case"custom":i?(CUSTOM_EASE_EDITOR_MAP.has(i)||CUSTOM_EASE_EDITOR_MAP.set(i,new Map),CUSTOM_EASE_EDITOR_MAP.get(i).set(e,t)):CUSTOM_EASE_RUNTIME_MAP.set(e,t);break;case"private":EASE_MAP.set(e,t),PRIVATE_EASE_MAP.set(e,t);break;default:throw Error("unexpected ease mode")}}static NoEase(e,t,s,i){return s*e/i+t}static EaseInQuad(e,t,s,i){return s*(e/=i)*e+t}static EaseOutQuad(e,t,s,i){return-s*(e/=i)*(e-2)+t}static EaseInOutQuad(e,t,s,i){return 1>(e/=i/2)?s/2*e*e+t:-s/2*(--e*(e-2)-1)+t}static EaseInCubic(e,t,s,i){return s*(e/=i)*e*e+t}static EaseOutCubic(e,t,s,i){return s*((e=e/i-1)*e*e+1)+t}static EaseInOutCubic(e,t,s,i){return 1>(e/=i/2)?s/2*e*e*e+t:s/2*((e-=2)*e*e+2)+t}static EaseInQuart(e,t,s,i){return s*(e/=i)*e*e*e+t}static EaseOutQuart(e,t,s,i){return-s*((e=e/i-1)*e*e*e-1)+t}static EaseInOutQuart(e,t,s,i){return 1>(e/=i/2)?s/2*e*e*e*e+t:-s/2*((e-=2)*e*e*e-2)+t}static EaseInQuint(e,t,s,i){return s*(e/=i)*e*e*e*e+t}static EaseOutQuint(e,t,s,i){return s*((e=e/i-1)*e*e*e*e+1)+t}static EaseInOutQuint(e,t,s,i){return 1>(e/=i/2)?s/2*e*e*e*e*e+t:s/2*((e-=2)*e*e*e*e+2)+t}static EaseInSine(e,t,s,i){return-s*Math.cos(e/i*(Math.PI/2))+s+t}static EaseOutSine(e,t,s,i){return s*Math.sin(e/i*(Math.PI/2))+t}static EaseInOutSine(e,t,s,i){return-s/2*(Math.cos(Math.PI*e/i)-1)+t}static EaseInExpo(e,t,s,i){return 0===e?t:s*Math.pow(2,10*(e/i-1))+t}static EaseOutExpo(e,t,s,i){return e===i?t+s:s*(1-Math.pow(2,-10*e/i))+t}static EaseInOutExpo(e,t,s,i){return 0===e?t:e===i?t+s:1>(e/=i/2)?s/2*Math.pow(2,10*(e-1))+t:s/2*(2-Math.pow(2,-10*--e))+t}static EaseInCirc(e,t,s,i){return-s*(Math.sqrt(1-(e/=i)*e)-1)+t}static EaseOutCirc(e,t,s,i){return s*Math.sqrt(1-(e=e/i-1)*e)+t}static EaseInOutCirc(e,t,s,i){return 1>(e/=i/2)?-s/2*(Math.sqrt(1-e*e)-1)+t:s/2*(Math.sqrt(1-(e-=2)*e)+1)+t}static EaseInElastic(e,t,s,i){let r=0,n=s;return 0===e?t:1==(e/=i)?t+s:(r||(r=.3*i),n<Math.abs(s)?(n=s,s=r/4):s=r/(2*Math.PI)*Math.asin(s/n),-n*Math.pow(2,10*--e)*Math.sin(2*(e*i-s)*Math.PI/r)+t)}static EaseOutElastic(e,t,s,i){let r,n=0,a=s;return 0===e?t:1==(e/=i)?t+s:(n||(n=.3*i),a<Math.abs(s)?(a=s,r=n/4):r=n/(2*Math.PI)*Math.asin(s/a),a*Math.pow(2,-10*e)*Math.sin(2*(e*i-r)*Math.PI/n)+s+t)}static EaseInOutElastic(e,t,s,i){let r,n=0,a=s;return 0===e?t:2==(e/=i/2)?t+s:(n||(n=.3*i*1.5),a<Math.abs(s)?(a=s,r=n/4):r=n/(2*Math.PI)*Math.asin(s/a),1>e?-.5*a*Math.pow(2,10*--e)*Math.sin(2*(e*i-r)*Math.PI/n)+t:a*Math.pow(2,-10*--e)*Math.sin(2*(e*i-r)*Math.PI/n)*.5+s+t)}static EaseInBack(e,t,s,i,r){return void 0===r&&(r=1.70158),s*(e/=i)*e*((r+1)*e-r)+t}static EaseOutBack(e,t,s,i,r){return void 0===r&&(r=1.70158),s*((e=e/i-1)*e*((r+1)*e+r)+1)+t}static EaseInOutBack(e,t,s,i,r){return void 0===r&&(r=1.70158),1>(e/=i/2)?s/2*e*e*((1+(r*=1.525))*e-r)+t:s/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t}static EaseInBounce(t,s,i,r){return i-e.EaseOutBounce(r-t,0,i,r)+s}static EaseOutBounce(e,t,s,i){return(e/=i)<1/2.75?7.5625*s*e*e+t:e<2/2.75?s*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?s*(7.5625*(e-=2.25/2.75)*e+.9375)+t:s*(7.5625*(e-=2.625/2.75)*e+.984375)+t}static EaseInOutBounce(t,s,i,r){return t<r/2?.5*e.EaseInBounce(2*t,0,i,r)+s:.5*e.EaseOutBounce(2*t-r,0,i,r)+.5*i+s}static EaseCubicBezier(e,t,s,i,r){return t+3*e*(s-t)+3*e**2*(t+i-2*s)+e**3*(r-t+3*s-3*i)}static EaseSpline(e,t,s,i,r,n,a,o,h,l){return i===r&&n===a?e:(e=get_t_for_x(e,t,i,n,o,l),t=a$jscomp$281(s,r,a,h),i=b$jscomp$150(s,r,a,h),s=c$jscomp$42(s,r,a,h),calc_bezier(e,t,i,s))}static GetBezierSamples(e,t,s,i){const r=[],n=a$jscomp$281(e,t,s,i),a=b$jscomp$150(e,t,s,i);for(e=c$jscomp$42(e,t,s,i),t=0;11>t;++t)s=calc_bezier(t*SAMPLE_STEP,n,a,e),r.push(s);return r}};const SAMPLE_STEP=.1,a$jscomp$281=(e,t,s,i)=>i-3*s+3*t-e,b$jscomp$150=(e,t,s,i)=>3*s-6*t+3*e,c$jscomp$42=(e,t,s,i)=>3*(t-e),calc_bezier=(e,t,s,i)=>((t*e+s)*e+i)*e,get_slope=(e,t,s,i)=>3*t*e*e+2*s*e+i,get_t_for_x=(e,t,s,i,r,n)=>{if(1==e)return 1;for(var a=0,o=1,h=n[o];10!=o&&h<=e;)h=n[++o],a+=SAMPLE_STEP;if(n=a+(e-(h=n[--o]))/(n[o+1]-h)*SAMPLE_STEP,o=a$jscomp$281(t,s,i,r),h=b$jscomp$150(t,s,i,r),t=c$jscomp$42(t,s,i,r),0!==(s=get_slope(n,o,h,t)))if(.01<=s)for(a=0;4>a;++a)n-=(s=calc_bezier(n,o,h,t)-e)/(i=get_slope(n,o,h,t));else{let l;s=a,a+=SAMPLE_STEP,i=0;do{0<(r=calc_bezier(n=s+(a-s)/2,o,h,t)-e)?a=n:s=n,r=1e-7<Math.abs(r),l=10>++i}while(r&&l)}return n},C3$jscomp$20=self.C3;function RequireStringOrNumber(e){C3$jscomp$20.IsString(e)}C3$jscomp$20.ProbabilityTable=class{constructor(){this._items=[],this._totalWeight=0}Release(){this.Clear(),this._items=null}Clear(){C3$jscomp$20.clear2DArray(this._items),this._totalWeight=0}GetTotalWeight(){return this._totalWeight}Sample(e=Math.random()*this.GetTotalWeight()){let t=0;for(const[s,i]of this._items)if(t+=s,e<t)return i;return 0}AddItem(e,t){RequireStringOrNumber(t),this._totalWeight+=e,this._items.push([e,t])}RemoveItem(e,t){RequireStringOrNumber(t);const s=0===e;for(let i=0;i<this._items.length;i++){const r=this._items[i],n=r[1]===t;if((s||r[0]===e)&&n){this._items.splice(i,1),this._totalWeight-=r[0];break}}}asJSON(){return JSON.stringify(this._items)}static fromJSON(e){const t=new C3$jscomp$20.ProbabilityTable;e=JSON.parse(e);for(const s of e)t.AddItem(s[0],s[1]);return t}};let nextId=0;self.C3.ScreenReaderText=class{constructor(e,t){this._runtime=e,this._text=t,this._id=nextId++,this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"create",id:this._id,text:this._text})}Release(){this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"release",id:this._id}),this._runtime=null,this._text="",this._id=-1}SetText(e){this._text!==e&&(this._text=e,this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"update",id:this._id,text:this._text}))}},self.C3.Event=class{constructor(e,t){this.type=e,this.cancelable=!!t,this.isAsync=this.propagationStopped=this.defaultPrevented=!1}preventDefault(){if(!this.cancelable)throw Error(`event '${this.type}' is not cancelable`);this.defaultPrevented=!0}stopPropagation(){if(!this.cancelable)throw Error(`event '${this.type}' cannot be stopped`);if(this.isAsync)throw Error(`cannot stop async event '${this.type}' propagation`);this.propagationStopped=!0}};const C3$jscomp$23=self.C3;C3$jscomp$23.Event.Handler=class extends C3$jscomp$23.DefendedBase{constructor(e){super(),this._type=e,this._captureListeners=[],this._captureListenersSet=new Set,this._listeners=[],this._listenersSet=new Set,this._fireDepth=0,this._queueModifyListeners=[]}Release(){0<this._fireDepth||(C3$jscomp$23.clearArray(this._captureListeners),this._captureListenersSet.clear(),C3$jscomp$23.clearArray(this._listeners),this._listenersSet.clear(),C3$jscomp$23.clearArray(this._queueModifyListeners),C3$jscomp$23.Release(this))}_AddListener(e,t){this._IsFiring()?this._queueModifyListeners.push({op:"add",func:e,capture:t}):t?this._captureListenersSet.has(e)||(this._captureListeners.push(e),this._captureListenersSet.add(e)):this._listenersSet.has(e)||(this._listeners.push(e),this._listenersSet.add(e))}_RemoveListener(e,t){this._IsFiring()?this._queueModifyListeners.push({op:"remove",func:e,capture:t}):t?this._captureListenersSet.has(e)&&(this._captureListenersSet.delete(e),C3$jscomp$23.arrayFindRemove(this._captureListeners,e)):this._listenersSet.has(e)&&(this._listenersSet.delete(e),C3$jscomp$23.arrayFindRemove(this._listeners,e))}_IsEmpty(){return!this._captureListeners.length&&!this._listeners.length}_IsFiring(){return 0<this._fireDepth}_ProcessQueuedListeners(){const e=new Set,t=new Set;for(const s of this._queueModifyListeners)if("add"===s.op)this._AddListener(s.func,s.capture),s.capture?t.delete(s.func):e.delete(s.func);else{if("remove"!==s.op)throw Error("invalid op");s.capture?(this._captureListenersSet.delete(s.func),t.add(s.func)):(this._listenersSet.delete(s.func),e.add(s.func))}C3$jscomp$23.arrayRemoveAllInSet(this._listeners,e),C3$jscomp$23.arrayRemoveAllInSet(this._captureListeners,t),C3$jscomp$23.clearArray(this._queueModifyListeners)}_FireCancellable(e){this._IncreaseFireDepth();let t=!1;for(let s=0,i=this._captureListeners.length;s<i;++s)if(this._captureListeners[s](e),e.propagationStopped){t=!0;break}if(!t)for(let t=0,s=this._listeners.length;t<s&&(this._listeners[t](e),!e.propagationStopped);++t);return this._DecreaseFireDepth(),!e.defaultPrevented}_FireNonCancellable(e){this._IncreaseFireDepth();for(let t=0,s=this._captureListeners.length;t<s;++t)this._captureListeners[t](e);for(let t=0,s=this._listeners.length;t<s;++t)this._listeners[t](e);return this._DecreaseFireDepth(),!0}_IncreaseFireDepth(){this._fireDepth++}_DecreaseFireDepth(){this._fireDepth--,0===this._fireDepth&&0<this._queueModifyListeners.length&&this._ProcessQueuedListeners()}SetDelayRemoveEventsEnabled(e){e?this._IncreaseFireDepth():this._DecreaseFireDepth()}_FireAsync(e){let t=[];for(let s=0,i=this._captureListeners.length;s<i;++s){let i=this._captureListeners[s];t.push(C3$jscomp$23.Asyncify((()=>i(e))))}for(let s=0,i=this._listeners.length;s<i;++s){let i=this._listeners[s];t.push(C3$jscomp$23.Asyncify((()=>i(e))))}return Promise.all(t).then((()=>!e.defaultPrevented))}_FireAndWait_AsyncOptional(e){const t=[];this._IncreaseFireDepth();for(let i=0,r=this._captureListeners.length;i<r;++i){var s=this._captureListeners[i](e);s instanceof Promise&&t.push(s)}for(let i=0,r=this._listeners.length;i<r;++i)(s=this._listeners[i](e))instanceof Promise&&t.push(s);return this._DecreaseFireDepth(),t.length?Promise.all(t).then((()=>!e.defaultPrevented)):!e.defaultPrevented}async _FireAndWaitAsync(e){return await this._FireAndWait_AsyncOptional(e)}async _FireAndWaitAsyncSequential(e){this._IncreaseFireDepth();for(let s=0,i=this._captureListeners.length;s<i;++s){var t=this._captureListeners[s](e);t instanceof Promise&&await t}for(let s=0,i=this._listeners.length;s<i;++s)(t=this._listeners[s](e))instanceof Promise&&await t;return this._DecreaseFireDepth(),!e.defaultPrevented}*_FireAsGenerator(e){this._IncreaseFireDepth();for(let s=0,i=this._captureListeners.length;s<i;++s){var t=this._captureListeners[s](e);C3$jscomp$23.IsIterator(t)&&(yield*t)}for(let s=0,i=this._listeners.length;s<i;++s)t=this._listeners[s](e),C3$jscomp$23.IsIterator(t)&&(yield*t);this._DecreaseFireDepth()}};const C3$jscomp$24=self.C3;C3$jscomp$24.Event.Dispatcher=class extends C3$jscomp$24.DefendedBase{constructor(){super(),this._eventHandlers=new Map,this._dispatcherWasReleased=!1}Release(){if(this._dispatcherWasReleased)throw Error("already released");this.ClearEvents(),this._dispatcherWasReleased=!0,C3$jscomp$24.Release(this)}WasReleased(){return this._dispatcherWasReleased}ClearEvents(){for(let e of this._eventHandlers.values())e.Release();this._eventHandlers.clear()}_GetHandlerByType(e,t){let s=this._eventHandlers.get(e);return s||(t?(s=C3$jscomp$24.New(C3$jscomp$24.Event.Handler,e),this._eventHandlers.set(e,s),s):null)}HasAnyHandlerFor(e){return this._eventHandlers.has(e)}addEventListener(e,t,s){this._GetHandlerByType(e,!0)._AddListener(t,!!s)}removeEventListener(e,t,s){let i=this._GetHandlerByType(e,!1);i&&(i._RemoveListener(t,!!s),i._IsEmpty()&&this._eventHandlers.delete(e))}dispatchEvent(e){const t=this._GetHandlerByType(e.type,!1);return!t||(e.cancelable?t._FireCancellable(e):t._FireNonCancellable(e))}dispatchEventAsync(e){const t=this._GetHandlerByType(e.type,!1);return t?(e.isAsync=!0,t._FireAsync(e)):Promise.resolve(!0)}async dispatchEventAndClearAsync(e){const t=this._GetHandlerByType(e.type,!1);return!t||(this._eventHandlers.delete(e.type),e.isAsync=!0,e=await t._FireAsync(e),t.Release(),e)}async dispatchEventAndWaitAsync(e){const t=this._GetHandlerByType(e.type,!1);return!t||await t._FireAndWaitAsync(e)}dispatchEventAndWait_AsyncOptional(e){const t=this._GetHandlerByType(e.type,!1);return!t||t._FireAndWait_AsyncOptional(e)}async dispatchEventAndWaitAsyncSequential(e){const t=this._GetHandlerByType(e.type,!1);return!t||await t._FireAndWaitAsyncSequential(e)}dispatchGeneratorEvent(e){const t=this._GetHandlerByType(e.type,!1);if(!t)return null;if(e.cancelable)throw Error("not supported");return t._FireAsGenerator(e)}SetDelayRemoveEventsEnabled(e){for(const t of this._eventHandlers.values())t.SetDelayRemoveEventsEnabled(e)}};const C3$jscomp$25=self.C3,SETTIMEOUT_INTERVAL=16,SUPPORTS_RIC="undefined"!=typeof requestIdleCallback;let workQueue=[],callbackId=-1,highThroughputMode=0;function SetNewCallback(e){callbackId=SUPPORTS_RIC&&0===highThroughputMode?requestIdleCallback(DoAsyncifiedWork,{timeout:35}):setTimeout(DoAsyncifiedWork,0<highThroughputMode?1:e)}function DoAsyncifiedWork(e){if(callbackId=-1,workQueue.length){var t=performance.now(),s=0;do{DoNextAsyncifiedJob(workQueue.shift());var i=performance.now(),r=(i-t)/++s*1.1}while(workQueue.length&&(SUPPORTS_RIC&&0===highThroughputMode&&void 0!==e?r<e.timeRemaining():12>i-t+r));-1===callbackId&&workQueue.length&&SetNewCallback(Math.max(SETTIMEOUT_INTERVAL-(i-t),4))}}function DoNextAsyncifiedJob(e){let t;try{t=e.func()}catch(t){return void e.reject(t)}e.resolve(t)}let asyncifyDisabled=C3$jscomp$25.QueryString.Has("disable-asyncify");C3$jscomp$25.Asyncify=function(e){let t=null;return C3$jscomp$25.isDebug&&(t=C3$jscomp$25.GetCallStack()),new Promise(((s,i)=>{workQueue.push({func:e,resolve:s,reject:i,stack:t}),asyncifyDisabled?DoNextAsyncifiedJob(workQueue.pop()):-1===callbackId&&SetNewCallback(SETTIMEOUT_INTERVAL)}))},C3$jscomp$25.Asyncify.SetHighThroughputMode=function(e){if(e)++highThroughputMode;else if(--highThroughputMode,0>highThroughputMode)throw Error("already turned off high throughput mode")};const C3$jscomp$26=self.C3,IDLE_CHECK_MIN_INTERVAL=1e3,IDLE_CHECK_TIMER_OVERSHOOT=100;let cachedNowTime=-1;function ClearTimeCache(){cachedNowTime=-1}C3$jscomp$26.FastGetDateNow=function(){return-1===cachedNowTime&&(cachedNowTime=Date.now(),self.setTimeout(ClearTimeCache,16)),cachedNowTime};let timerId=-1,nextDeadline=-1,activeIdleTimeouts=new Set;function CheckActiveIdleTimeouts(){nextDeadline=timerId=-1;let e=Date.now();for(let t of activeIdleTimeouts)if(t._CheckTimeout(e)){let e=t._GetDeadline();(-1===nextDeadline||e<nextDeadline)&&(nextDeadline=e)}else activeIdleTimeouts.delete(t);-1!==nextDeadline&&(timerId=self.setTimeout(CheckActiveIdleTimeouts,Math.max(nextDeadline-e+IDLE_CHECK_TIMER_OVERSHOOT,IDLE_CHECK_MIN_INTERVAL)))}C3$jscomp$26.IdleTimeout=class{constructor(e,t){this._callback=e,this._timeout=1e3*t,this._deadline=0,this._isActive=!1}Reset(){let e=C3$jscomp$26.FastGetDateNow();this._deadline=e+this._timeout,this._isActive||(activeIdleTimeouts.add(this),this._isActive=!0),-1===timerId?(nextDeadline=this._deadline,timerId=self.setTimeout(CheckActiveIdleTimeouts,this._timeout+IDLE_CHECK_TIMER_OVERSHOOT)):this._deadline<nextDeadline&&nextDeadline>e+IDLE_CHECK_MIN_INTERVAL&&(self.clearTimeout(timerId),nextDeadline=this._deadline,timerId=self.setTimeout(CheckActiveIdleTimeouts,this._timeout+IDLE_CHECK_TIMER_OVERSHOOT))}_CheckTimeout(e){return!(e>=this._deadline)||(this._callback()?(this._deadline=e+this._timeout,!0):this._isActive=!1)}_GetDeadline(){return this._deadline}Cancel(){this._isActive&&(activeIdleTimeouts.delete(this),this._isActive=!1,0===activeIdleTimeouts.size&&-1!==timerId&&(self.clearTimeout(timerId),nextDeadline=timerId=-1))}Release(){this.Cancel(),this._callback=null}};const C3$jscomp$27=self.C3;C3$jscomp$27.Disposable=class e{constructor(e){this._disposed=!1,this._disposeAction=e}Dispose(){this._disposed||(this._disposed=!0,this._disposeAction&&(this._disposeAction(),this._disposeAction=null))}IsDisposed(){return this._disposed}Release(){this.Dispose()}static Release(t){return new e((()=>t.Release()))}static From(e,t,s,i,r){if(null==i)i=!1;else if("boolean"!=typeof i&&"object"!=typeof i)throw new TypeError("invalid event listener options");if(r&&(s=s.bind(r)),t.includes(" ")){t=t.split(" "),r=new C3$jscomp$27.CompositeDisposable;for(let n of t)e.addEventListener(n,s,i),r.Add(C3$jscomp$27.New(C3$jscomp$27.Disposable,(()=>e.removeEventListener(n,s,i))));return r}return e.addEventListener(t,s,i),C3$jscomp$27.New(C3$jscomp$27.Disposable,(()=>e.removeEventListener(t,s,i)))}},C3$jscomp$27.StubDisposable=class extends C3$jscomp$27.Disposable{SetAction(e){this._disposeAction=e}},C3$jscomp$27.CompositeDisposable=class extends C3$jscomp$27.Disposable{constructor(...e){super(),this._disposables=new Set;for(let t of e)this.Add(t)}Add(...e){if(this._disposed)throw Error("already disposed");for(let t of e)this._disposables.add(t)}Remove(e){if(this._disposed)throw Error("already disposed");this._disposables.delete(e)}RemoveAll(){if(this._disposed)throw Error("already disposed");if(this._disposables){for(let e of this._disposables)e.Dispose();this._disposables.clear()}}IsDisposed(){return this._disposed}Dispose(){if(this._disposed)throw Error("already disposed");this._disposed=!0;for(let e of this._disposables)e.Dispose();this._disposables.clear(),this._disposables=null}Release(){this.Dispose()}};const C3$jscomp$28=self.C3;C3$jscomp$28.KahanSum=class extends C3$jscomp$28.DefendedBase{constructor(){super(),this._sum=this._t=this._y=this._c=0}Add(e){this._y=+e-this._c,this._t=this._sum+this._y,this._c=this._t-this._sum-this._y,this._sum=this._t}Subtract(e){this._sum-=+e}Get(){return this._sum}Reset(){this._sum=this._t=this._y=this._c=0}Set(e){this._t=this._y=this._c=0,this._sum=+e}Copy(e){this._c=e._c,this._y=e._y,this._t=e._t,this._sum=e._sum}Release(){}};const C3$jscomp$29=self.C3,js_cols={RBnode:function(e){this.tree=e,this.left=this.right=this.tree.sentinel,this.parent=null,this.color=!1,this.key=null},RedBlackSet:function(e){this.size=0,this.sentinel=new js_cols.RBnode(this),this.sentinel.color=!1,this.root=this.sentinel,this.root.parent=this.sentinel,this.compare=e||this.default_compare}};js_cols.RedBlackSet.prototype.default_compare=function(e,t){return e<t?-1:t<e?1:0},js_cols.RedBlackSet.prototype.clone=function(){var e=new js_cols.RedBlackSet(this.compare);return e.insertAll(this),e},js_cols.RedBlackSet.prototype.clear=function(){this.size=0,this.sentinel=new js_cols.RBnode(this),this.sentinel.color=!1,this.root=this.sentinel,this.root.parent=this.sentinel},js_cols.RedBlackSet.prototype.leftRotate=function(e){var t=e.right;e.right=t.left,t.left!=this.sentinel&&(t.left.parent=e),t.parent=e.parent,e.parent==this.sentinel?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t},js_cols.RedBlackSet.prototype.rightRotate=function(e){var t=e.left;e.left=t.right,t.right!=this.sentinel&&(t.right.parent=e),t.parent=e.parent,e.parent==this.sentinel?this.root=t:e==e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t},js_cols.RedBlackSet.prototype.insert=function(e){if(this.contains(e))this.get_(e).key=e;else{var t=new js_cols.RBnode(this);t.key=e,e=this.sentinel;for(var s=this.root;s!=this.sentinel;)e=s,s=0>this.compare(t.key,s.key)?s.left:s.right;t.parent=e,e==this.sentinel?this.root=t:0>this.compare(t.key,e.key)?e.left=t:e.right=t,t.left=this.sentinel,t.right=this.sentinel,t.color=!0,this.insertFixup(t),this.size++}},js_cols.RedBlackSet.prototype.insertFixup=function(e){for(;e!=this.sentinel&&e!=this.root&&1==e.parent.color;)if(e.parent==e.parent.parent.left){var t=e.parent.parent.right;1==t.color?(e.parent.color=!1,t.color=!1,e.parent.parent.color=!0,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.leftRotate(e)),e.parent.color=!1,e.parent.parent.color=!0,e.parent.parent!=this.sentinel&&this.rightRotate(e.parent.parent))}else 1==(t=e.parent.parent.left).color?(e.parent.color=!1,t.color=!1,e.parent.parent.color=!0,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rightRotate(e)),e.parent.color=!1,e.parent.parent.color=!0,e.parent.parent!=this.sentinel&&this.leftRotate(e.parent.parent));this.root.color=!1},js_cols.RedBlackSet.prototype.delete_=function(e){var t=e.left==this.sentinel||e.right==this.sentinel?e:this.successor_(e),s=t.left!=this.sentinel?t.left:t.right;s.parent=t.parent,t.parent==this.sentinel?this.root=s:t==t.parent.left?t.parent.left=s:t.parent.right=s,t!=e&&(e.key=t.key),0==t.color&&this.deleteFixup(s),this.size--},js_cols.RedBlackSet.prototype.deleteFixup=function(e){for(;e!=this.root&&0==e.color;)if(e==e.parent.left){var t=e.parent.right;1==t.color&&(t.color=!1,e.parent.color=!0,this.leftRotate(e.parent),t=e.parent.right),0==t.left.color&&0==t.right.color?(t.color=!0,e=e.parent):(0==t.right.color&&(t.left.color=!1,t.color=!0,this.rightRotate(t),t=e.parent.right),t.color=e.parent.color,e.parent.color=!1,t.right.color=!1,this.leftRotate(e.parent),e=this.root)}else 1==(t=e.parent.left).color&&(t.color=!1,e.parent.color=!0,this.rightRotate(e.parent),t=e.parent.left),0==t.right.color&&0==t.left.color?(t.color=!0,e=e.parent):(0==t.left.color&&(t.right.color=!1,t.color=!0,this.leftRotate(t),t=e.parent.left),t.color=e.parent.color,e.parent.color=!1,t.left.color=!1,this.rightRotate(e.parent),e=this.root);e.color=!1},js_cols.RedBlackSet.prototype.remove=function(e){if((e=this.get_(e))!=this.sentinel){var t=e.key;return this.delete_(e),t}return null},js_cols.RedBlackSet.prototype.removeSwapped=function(e,t){this.remove(t)},js_cols.RedBlackSet.prototype.min=function(e){for(;e.left!=this.sentinel;)e=e.left;return e},js_cols.RedBlackSet.prototype.max=function(e){for(;e.right!=this.sentinel;)e=e.right;return e},js_cols.RedBlackSet.prototype.successor_=function(e){if(e.right!=this.sentinel)return this.min(e.right);for(var t=e.parent;t!=this.sentinel&&e==t.right;)e=t,t=t.parent;return t},js_cols.RedBlackSet.prototype.predeccessor_=function(e){if(e.left!=this.sentinel)return this.max(e.left);for(var t=e.parent;t!=this.sentinel&&e==t.left;)e=t,t=t.parent;return t},js_cols.RedBlackSet.prototype.successor=function(e){if(0<this.size){if((e=this.get_(e))==this.sentinel)return null;if(e.right!=this.sentinel)return this.min(e.right).key;for(var t=e.parent;t!=this.sentinel&&e==t.right;)e=t,t=t.parent;return t!=this.sentinel?t.key:null}return null},js_cols.RedBlackSet.prototype.predecessor=function(e){if(0<this.size){if((e=this.get_(e))==this.sentinel)return null;if(e.left!=this.sentinel)return this.max(e.left).key;for(var t=e.parent;t!=this.sentinel&&e==t.left;)e=t,t=t.parent;return t!=this.sentinel?t.key:null}return null},js_cols.RedBlackSet.prototype.getMin=function(){return this.min(this.root).key},js_cols.RedBlackSet.prototype.getMax=function(){return this.max(this.root).key},js_cols.RedBlackSet.prototype.get_=function(e){for(var t=this.root;t!=this.sentinel&&0!=this.compare(t.key,e);)t=0>this.compare(e,t.key)?t.left:t.right;return t},js_cols.RedBlackSet.prototype.contains=function(e){return null!=this.get_(e).key},js_cols.RedBlackSet.prototype.getValues=function(){var e=[];return this.forEach((function(t){e.push(t)})),e},js_cols.RedBlackSet.prototype.insertAll=function(e){if("array"==js_cols.typeOf(e))for(var t=0;t<e.length;t++)this.insert(e[t]);else if("function"==js_cols.typeOf(e.forEach))e.forEach(this.insert,this);else if("function"==js_cols.typeOf(e.getValues))for(e=e.getValues(),t=0;t<e.length;t++)this.insert(e[t]);else if("object"==js_cols.typeOf(e))for(t in e)this.insert(e[t])},js_cols.RedBlackSet.prototype.removeAll=function(e){if("array"==js_cols.typeOf(e))for(var t=0;t<e.length;t++)this.remove(e[t]);else if("function"==js_cols.typeOf(e.forEach))e.forEach(this.removeSwapped,this);else if("function"==js_cols.typeOf(e.getValues))for(e=e.getValues(),t=0;t<e.length;t++)this.remove(e[t]);else if("object"==js_cols.typeOf(e))for(t in e)this.remove(e[t])},js_cols.RedBlackSet.prototype.containsAll=function(e){if("array"==js_cols.typeOf(e)){for(var t=0;t<e.length;t++)if(!this.contains(e[t]))return!1;return!0}if("function"==js_cols.typeOf(e.forEach))return e.every(this.contains,this);if("function"==js_cols.typeOf(e.getValues)){for(e=e.getValues(),t=0;t<e.length;t++)if(!this.contains(e[t]))return!1;return!0}if("object"==js_cols.typeOf(e)){for(t in e)if(!this.contains(e[t]))return!1;return!0}},js_cols.RedBlackSet.prototype.range=function(e,t){var s=[];return this.traverseFromTo((function(e){s.push(e)}),e,t),s},js_cols.RedBlackSet.prototype.traverse=function(e,t){if(!this.isEmpty())for(var s=this.min(this.root);s!=this.sentinel&&!e.call(t,s.key,this);)s=this.successor_(s)},js_cols.RedBlackSet.prototype.traverseFrom=function(e,t,s){if(!this.isEmpty())for(t=this.get_(t);t!=this.sentinel&&!e.call(s,t.key,this);)t=this.successor_(t)},js_cols.RedBlackSet.prototype.traverseTo=function(e,t,s){if(!this.isEmpty()){var i=this.min(this.root);for(t=this.get_(t);i!=t&&!e.call(s,i.key,this);)i=this.successor_(i)}},js_cols.RedBlackSet.prototype.traverseFromTo=function(e,t,s,i){if(!this.isEmpty())for(t=this.get_(t),s=this.get_(s);t!=s&&!e.call(i,t.key,this);)t=this.successor_(t)},js_cols.RedBlackSet.prototype.traverseBackwards=function(e,t){if(!this.isEmpty())for(var s=this.max(this.root);s!=this.sentinel&&!e.call(t,s.key,this);)s=this.predeccessor_(s)},js_cols.RedBlackSet.prototype.forEach=function(e,t){if(!this.isEmpty())for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))e.call(t,s.key,s.key,this)},js_cols.RedBlackSet.prototype.some=function(e,t){if(this.isEmpty())return!1;for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))if(e.call(t,s.key,s.key,this))return!0;return!1},js_cols.RedBlackSet.prototype.every=function(e,t){if(this.isEmpty())return!1;for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))if(!e.call(t,s.key,s.key,this))return!1;return!0},js_cols.RedBlackSet.prototype.map=function(e,t){var s=[];if(this.isEmpty())return s;for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))s.push(e.call(t,i.key,i.key,this));return s},js_cols.RedBlackSet.prototype.filter=function(e,t){var s=[];if(this.isEmpty())return s;for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))e.call(t,i.key,i.key,this)&&s.push(i.key);return s},js_cols.RedBlackSet.prototype.getCount=function(){return this.size},js_cols.RedBlackSet.prototype.isEmpty=function(){return 0==this.size},js_cols.RedBlackSet.prototype.isSubsetOf=function(e){var t=js_cols.getCount(e);if(this.getCount()>t)return!1;if(t=0,this.isEmpty())return!0;for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))js_cols.contains.call(e,e,s.key)&&t++;return t==this.getCount()},js_cols.RedBlackSet.prototype.intersection=function(e){var t=new js_cols.RedBlackSet(this.compare);if(this.isEmpty())return t;for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))e.contains.call(e,s.key,s.key,this)&&t.insert(s.key);return t},C3$jscomp$29.RedBlackSet=class extends C3$jscomp$29.DefendedBase{constructor(e){super(),this._rbSet=new js_cols.RedBlackSet(e),this._enableQueue=!1,this._queueInsert=new Set,this._queueRemove=new Set}Add(e){this._enableQueue?this._rbSet.contains(e)?this._queueRemove.delete(e):this._queueInsert.add(e):this._rbSet.insert(e)}Remove(e){this._enableQueue?this._rbSet.contains(e)?this._queueRemove.add(e):this._queueInsert.delete(e):this._rbSet.remove(e)}Has(e){return this._enableQueue?!!this._queueInsert.has(e)||!this._queueRemove.has(e)&&this._rbSet.contains(e):this._rbSet.contains(e)}Clear(){this._rbSet.clear(),this._queueInsert.clear(),this._queueRemove.clear()}toArray(){if(this._enableQueue)throw Error("cannot be used in queueing mode");return this._rbSet.getValues()}GetSize(){return this._rbSet.getCount()+this._queueInsert.size-this._queueRemove.size}IsEmpty(){return 0===this.GetSize()}Front(){if(this.IsEmpty())throw Error("empty set");if(this._enableQueue)throw Error("cannot be used in queueing mode");const e=this._rbSet;return e.min(e.root).key}Shift(){if(this.IsEmpty())throw Error("empty set");if(this._enableQueue)throw Error("cannot be used in queueing mode");const e=this.Front();return this.Remove(e),e}SetQueueingEnabled(e){if(e=!!e,this._enableQueue!==e&&(this._enableQueue=e,!e)){for(const e of this._queueRemove)this._rbSet.remove(e);this._queueRemove.clear();for(const e of this._queueInsert)this._rbSet.insert(e);this._queueInsert.clear()}}ForEach(e){this._rbSet.forEach(e)}*values(){if(!this.IsEmpty()){var e=this._rbSet;for(let t=e.min(e.root);t!=e.sentinel;t=e.successor_(t))yield t.key}}[Symbol.iterator](){return this.values()}};const C3$jscomp$30=self.C3;C3$jscomp$30.PromiseThrottle=class{constructor(e=C3$jscomp$30.hardwareConcurrency){this._maxParallel=e,this._queue=[],this._activeCount=0}Add(e){return new Promise(((t,s)=>{this._queue.push({func:e,resolve:t,reject:s}),this._MaybeStartNext()}))}_FindInQueue(e){for(let t=0,s=this._queue.length;t<s;++t)if(this._queue[t].func===e)return t;return-1}RemoveAndResolve(e,t){if(-1===(e=this._FindInQueue(e)))throw Error("cannot find promise to resolve");this._queue[e].resolve(t),this._queue.splice(e,1)}RemoveAndReject(e,t){if(-1===(e=this._FindInQueue(e)))throw Error("cannot find promise to reject");this._queue[e].reject(t),this._queue.splice(e,1)}async _MaybeStartNext(){if(this._queue.length&&!(this._activeCount>=this._maxParallel)){this._activeCount++;var e=this._queue.shift();try{const t=await e.func();e.resolve(t)}catch(t){e.reject(t)}this._activeCount--,this._MaybeStartNext()}}static async Batch(e,t){const s=[];let i=!1;const r=async e=>{for(;(e=t.pop())&&!i;)try{s.push(await e())}catch(e){throw i=!0,e}},n=[];for(;e--;)n.push(r());return await Promise.all(n),s}};const C3$jscomp$31=self.C3;C3$jscomp$31.RateLimiter=class{constructor(e,t,s){this._callback=e,this._interval=t,this._intervalOnBattery=s||2*t,this._timerId=-1,this._lastCallTime=-1/0,this._timerCallFunc=()=>this._OnTimer(),this._canRunImmediate=this._ignoreReset=!1,this._callbackArguments=null}SetCanRunImmediate(e){this._canRunImmediate=!!e}_GetInterval(){return void 0!==C3$jscomp$31.Battery&&C3$jscomp$31.Battery.IsOnBatteryPower()?this._intervalOnBattery:this._interval}Call(...e){if(-1===this._timerId){this._callbackArguments=e;var t=(e=C3$jscomp$31.FastGetDateNow())-this._lastCallTime,s=this._GetInterval();t>=s&&this._canRunImmediate?(this._lastCallTime=e,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(s-t,4))}}_RunCallback(){this._ignoreReset=!0;const e=this._callbackArguments;this._callbackArguments=null,e?this._callback(...e):this._callback(),this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._callbackArguments=null,this._lastCallTime=C3$jscomp$31.FastGetDateNow())}_OnTimer(){this._timerId=-1,this._lastCallTime=C3$jscomp$31.FastGetDateNow(),this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer(),this._timerCallFunc=this._callbackArguments=this._callback=null}};const C3$jscomp$32=self.C3;C3$jscomp$32.SVGRasterManager=class{constructor(){this._images=new Map,this._allowNpotSurfaces=!1,this._redrawCallback=this._releaseResultCallback=this._rasterAtSizeCallback=this._getBaseSizeCallback=null}SetNpotSurfaceAllowed(e){this._allowNpotSurfaces=!!e}IsNpotSurfaceAllowed(){return this._allowNpotSurfaces}SetGetBaseSizeCallback(e){this._getBaseSizeCallback=e}GetBaseSize(e){if(!this._getBaseSizeCallback)throw Error("no get base size callback set");return this._getBaseSizeCallback(e)}SetRasterAtSizeCallback(e){this._rasterAtSizeCallback=e}RasterAtSize(e,t,s,i,r,n){if(!this._rasterAtSizeCallback)throw Error("no raster at size callback set");return this._rasterAtSizeCallback(e,t,s,i,r,n)}SetReleaseResultCallback(e){this._releaseResultCallback=e}ReleaseResult(e){if(!this._releaseResultCallback)throw Error("no release result callback set");this._releaseResultCallback(e)}SetRedrawCallback(e){this._redrawCallback=e}Redraw(){if(!this._redrawCallback)throw Error("no redraw callback set");this._redrawCallback()}AddImage(e){let t=this._images.get(e);return t||(t=C3$jscomp$32.New(C3$jscomp$32.SVGRasterImage,this,e),this._images.set(e,t)),t.IncReference(),t}_RemoveImage(e){this._images.delete(e.GetDataSource())}OnTexturesChanged(){for(const e of this._images.values())e.ReleaseRasterizedResult(),e.ForceRasterAgain()}};const C3$jscomp$33=self.C3;C3$jscomp$33.SVGRasterImage=class{constructor(e,t){this._manager=e,this._dataSource=t,this._baseHeight=this._baseWidth=this._refCount=0,this._getBaseSizePromise=this._manager.GetBaseSize(t).then((e=>{this._baseWidth=e[0],this._baseHeight=e[1],this._manager.Redraw()})).catch((e=>{this._hadError=!0,this._manager.Redraw()})),this._rasterImageHeight=this._rasterImageWidth=this._rasterSurfaceHeight=this._rasterSurfaceWidth=0,this._isRasterizing=!1,this._rasterizedResult=null,this._hadError=this._forceRaster=!1}Release(){if(0>=this._refCount)throw Error("already released");this._refCount--,0===this._refCount&&this._Release()}ReleaseRasterizedResult(){this._rasterizedResult&&(this._manager.ReleaseResult(this._rasterizedResult),this._rasterizedResult=null)}_Release(){this.ReleaseRasterizedResult(),this._manager._RemoveImage(this),this._manager=null}GetDataSource(){return this._dataSource}IncReference(){this._refCount++}HasReferences(){return 0<this._refCount}GetRasterizedResult(){return this._rasterizedResult}ForceRasterAgain(){this._forceRaster=!0}async StartRasterForSize(e,t,s){if(0!==t&&0!==s&&!this._hadError&&!this._isRasterizing){var i=C3$jscomp$33.nextHighestPowerOfTwo(Math.ceil(t)),r=C3$jscomp$33.nextHighestPowerOfTwo(Math.ceil(s)),n=Math.max(i,r);4096<n&&(t*=n=4096/n,s*=n,i=Math.min(Math.ceil(i*n),4096),r=Math.min(Math.ceil(r*n),4096)),t<i&&s<r&&(i/r>(s=t/s)?(t=r*s,s=r):(t=i,s=i/s)),this._manager.IsNpotSurfaceAllowed()&&(i=Math.ceil(t),r=Math.ceil(s)),i<=this._rasterSurfaceWidth&&r<=this._rasterSurfaceHeight&&!this._forceRaster||(this._isRasterizing=!0,this._rasterSurfaceWidth=i,this._rasterSurfaceHeight=r,e=await this._manager.RasterAtSize(this._dataSource,e,this._rasterSurfaceWidth,this._rasterSurfaceHeight,t,s),this._manager&&(this.ReleaseRasterizedResult(),this._rasterizedResult=e,this._rasterImageWidth=t,this._rasterImageHeight=s,this._forceRaster=this._isRasterizing=!1,this._manager.Redraw()))}}WhenBaseSizeReady(){return this._getBaseSizePromise}GetBaseWidth(){return this._baseWidth}GetBaseHeight(){return this._baseHeight}GetRasterWidth(){return this._rasterImageWidth}GetRasterHeight(){return this._rasterImageHeight}HadError(){return this._hadError}};const C3$jscomp$34=self.C3;C3$jscomp$34.UTF8_BOM="\ufeff";const NUMERIC_CHARS=new Set([..."0123456789"]);C3$jscomp$34.IsNumericChar=function(e){return NUMERIC_CHARS.has(e)};const WHITESPACE_CHARS=new Set([..." \t\n\r\u2028\u2029"]);C3$jscomp$34.IsWhitespaceChar=function(e){return WHITESPACE_CHARS.has(e)},C3$jscomp$34.FilterWhitespace=function(e){return[...e].filter((e=>!C3$jscomp$34.IsWhitespaceChar(e))).join("")},C3$jscomp$34.IsStringAllWhitespace=function(e){for(const t of e)if(!C3$jscomp$34.IsWhitespaceChar(t))return!1;return!0},C3$jscomp$34.IsCharArrayAllWhitespace=function(e){for(const t of e)if(!C3$jscomp$34.IsWhitespaceChar(t))return!1;return!0},C3$jscomp$34.IsUnprintableChar=function(e){return 1===e.length&&32>e.charCodeAt(0)},C3$jscomp$34.FilterUnprintableChars=function(e){return[...e].filter((e=>!C3$jscomp$34.IsUnprintableChar(e))).join("")};const NUMERIC_STRING_CHARS=new Set([..."0123456789.+-e"]);C3$jscomp$34.IsStringNumber=function(e){if(!(e=e.trim()).length)return!1;let t=e.charAt(0);if("-"!==t&&!NUMERIC_CHARS.has(t))return!1;for(let t of e)if(!NUMERIC_STRING_CHARS.has(t))return!1;return!0},C3$jscomp$34.RemoveTrailingDigits=function(e){let t=e.length;for(;0<t;){let s=e.charAt(t-1);if(!C3$jscomp$34.IsNumericChar(s))break;--t}return e.substr(0,t)},C3$jscomp$34.IncrementNumberAtEndOf=function(e){let t=C3$jscomp$34.RemoveTrailingDigits(e);return t+(e=(e=e.substr(t.length))?(parseInt(e,10)+1).toString():"2")};const HTML_ENTITY_MAP=new Map([["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#39;"]]);function lookupHtmlEntity(e){return HTML_ENTITY_MAP.get(e)}const HTML_ENTITY_REGEX=/[&<>"']/g;C3$jscomp$34.EscapeHTML=function(e){return e.replace(HTML_ENTITY_REGEX,lookupHtmlEntity)},C3$jscomp$34.EscapeJS=function(e){return e=C3$jscomp$34.ReplaceAll(e,"\\","\\\\"),e=C3$jscomp$34.ReplaceAll(e,'"','\\"'),e=C3$jscomp$34.ReplaceAll(e,"\t","\\t"),e=C3$jscomp$34.ReplaceAll(e,"\r",""),C3$jscomp$34.ReplaceAll(e,"\n","\\n")},C3$jscomp$34.EscapeXML=function(e){return e=C3$jscomp$34.ReplaceAll(e,"&","&amp;"),e=C3$jscomp$34.ReplaceAll(e,"<","&lt;"),e=C3$jscomp$34.ReplaceAll(e,">","&gt;"),C3$jscomp$34.ReplaceAll(e,'"',"&quot;")};const ESCAPE_REGEX=/[-[\]{}()*+?.,\\^$|#\s]/g;C3$jscomp$34.EscapeRegex=function(e){return e.replace(ESCAPE_REGEX,"\\$&")},C3$jscomp$34.CountCharsInString=function(e,t){let s=0;for(const i of e)i===t&&++s;return s},C3$jscomp$34.FindAll=function(e,t,s=!1){if(!t)return[];s||(e=e.toLowerCase(),t=t.toLowerCase()),s=t.length;var i=0;let r=[];for(;-1<(i=e.indexOf(t,i));)r.push(i),i+=s;return r},C3$jscomp$34.ReplaceAll=function(e,t,s){return e.replaceAll(t,(()=>s))},C3$jscomp$34.ReplaceAllCaseInsensitive=function(e,t,s){return e.replace(new RegExp(C3$jscomp$34.EscapeRegex(t),"gi"),(()=>s))},C3$jscomp$34.SetElementContent=function(e,t){"string"==typeof t?e.textContent=t:t.isPlainText()?e.textContent=t.toString():(e.innerHTML=t.toHTML(),t instanceof C3$jscomp$34.BBString&&t.attachLinkHandlers(e))},C3$jscomp$34.StringLikeEquals=function(e,t){return e instanceof C3$jscomp$34.HtmlString||e instanceof C3$jscomp$34.BBString?e.equals(t):t instanceof C3$jscomp$34.HtmlString||t instanceof C3$jscomp$34.BBString?t.equals(e):e===t},C3$jscomp$34.StringSubstitute=function(e,...t){let s=e;for(let i=0,r=t.length;i<r;++i){const r=`{${i}}`;if(!e.includes(r))throw Error(`missing placeholder '${r}' in string substitution`);s=s.replace(r,t[i].toString())}return s},C3$jscomp$34.StringSubstituteAllowMissing=function(e,...t){let s=e,i=-1,r=-1;for(let n=0,a=t.length;n<a;++n){const a=`{${n}}`;e.includes(a)?(r=n,s=s.replace(a,t[n].toString())):-1===i&&(i=n)}if(0<=i&&0<=r&&i<r)throw Error(`missing placeholder '${i}' in string substitution`);return s},C3$jscomp$34.StringSubstituteMap=function(e,t){for(let[s,i]of Object.entries(t))e=e.replaceAll(s,i.toString());return e},C3$jscomp$34.SortAZ=function(e,t){return e>t?1:e<t?-1:0},C3$jscomp$34.SortAZCaseInsensitive=function(e,t){return(e=e.toLowerCase())>(t=t.toLowerCase())?1:e<t?-1:0};let intlSegmenter=null,graphemeSplitter=null;self.Intl&&self.Intl.Segmenter?intlSegmenter=new self.Intl.Segmenter:graphemeSplitter=new self.GraphemeSplitter,C3$jscomp$34.SplitGraphemes=function(e){if(intlSegmenter){const t=[];for(const s of intlSegmenter.segment(e))t.push(s.segment);return t}return graphemeSplitter.splitGraphemes(e)},C3$jscomp$34.IterateGraphemes=function*(e){if(intlSegmenter)for(const t of intlSegmenter.segment(e))yield t.segment;else yield*graphemeSplitter.iterateGraphemes(e)},C3$jscomp$34.CountGraphemes=function(e){if(intlSegmenter){let t=0;for(const s of intlSegmenter.segment(e))++t;return t}return graphemeSplitter.countGraphemes(e)};const MEGABYTE=1048576,GIGABYTE=1024*MEGABYTE,TERABYTE=1024*GIGABYTE;C3$jscomp$34.FormatDataSize=function(e,t){t="common."+(t?"dataRates":"dataSizes")+".";const s=self.langSub;return 1024>e?s(t+"bytes",e):e<MEGABYTE?s(t+"kilobytes",e=10>(e/=1024)?Math.round(10*e)/10:Math.round(e)):e<GIGABYTE?s(t+"megabytes",e=10>(e/=MEGABYTE)?Math.round(10*e)/10:Math.round(e)):e<TERABYTE?s(t+"gigabytes",e=10>(e/=GIGABYTE)?Math.round(10*e)/10:Math.round(e)):s(t+"terabytes",e=10>(e/=TERABYTE)?Math.round(10*e)/10:Math.round(e))};const DEFAULT_FORMATTIME_OPTS={approximate:!1,days:!0,hours:!0,minutes:!0,seconds:!0};C3$jscomp$34.FormatTime=function(e,t){t=Object.assign({},DEFAULT_FORMATTIME_OPTS,t),C3$jscomp$34.Lang.PushContext("common.time");const s=[],i=self.lang,r=self.langPluralSub;if(t.days){var n=Math.floor(e/86400);0<n&&(e-=86400*n,s.push(r(".days",null,n)))}return t.hours&&(0<(n=Math.floor(e/3600))||s.length)&&(e-=3600*n,s.push(r(".hours",null,n))),t.minutes&&(0<(n=Math.floor(e/60))||s.length||!t.seconds)&&(e-=60*n,s.push(r(".minutes",null,n))),t.seconds&&s.push(r(".seconds",null,Math.floor(e%60))),e=(t.approximate?i(".approx-prefix"):"")+s.join(i(".separator")),C3$jscomp$34.Lang.PopContext(),e},C3$jscomp$34.ZeroPad=function(e,t){let s=0>e?"-":"";t-=(e=(e=Math.abs(e)).toString()).length;for(let e=0;e<t;++e)s+="0";return s+e},C3$jscomp$34.StringToTitleCase=function(e){return e.toLowerCase().replace(/\b\w/g,(e=>e.toUpperCase()))},C3$jscomp$34.CompareVersionStrings=function(e,t){e=e.split(".").map((e=>e.trim())),t=t.split(".").map((e=>e.trim())),C3$jscomp$34.resizeArray(e,4,"0"),C3$jscomp$34.resizeArray(t,4,"0"),e=e.map((e=>parseInt(e,10))),t=t.map((e=>parseInt(e,10)));for(let s=0;4>s;++s){const i=e[s]-t[s];if(0!==i)return 0>i?-1:1}return 0},C3$jscomp$34.CreateGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=Math.floor(16*Math.random());return("x"===e?t:3&t|8).toString(16)}))},C3$jscomp$34.StringHammingDistance=function(e,t){if(e.length!==t.length)throw Error("strings must be same length");let s=0;for(let i=0,r=e.length;i<r;++i)e.charAt(i)!==t.charAt(i)&&++s;return s},C3$jscomp$34.StringLevenshteinDistance=function(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;let s,i,r,n;if(e.length>t.length){var a=e;e=t,t=a}for(n=Array(e.length+1),a=0;a<=e.length;a++)n[a]=a;for(a=1;a<=t.length;a++){for(i=a,s=1;s<=e.length;s++)r=t[a-1]===e[s-1]?n[s-1]:Math.min(n[s-1]+1,Math.min(i+1,n[s]+1)),n[s-1]=i,i=r;n[e.length]=i}return n[e.length]};const C3$jscomp$35=self.C3,BB_CODE_MAP=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["sub","sub"],["sup","sup"],["small","small"],["mark","mark"],["code","code"],["a1","a"],["a2","a"],["a3","a"],["a4","a"],["a5","a"],["a6","a"],["a7","a"],["a8","a"],["a9","a"],["tip1","abbr"],["tip2","abbr"],["tip3","abbr"],["tip4","abbr"],["tip5","abbr"],["tip6","abbr"],["tip7","abbr"],["tip8","abbr"],["tip9","abbr"],["bad",["span","bbCodeBad"]],["good",["span","bbCodeGood"]],["info",["span","bbCodeInfo"]],["h1",["span","bbCodeH1"]],["h2",["span","bbCodeH2"]],["h3",["span","bbCodeH3"]],["h4",["span","bbCodeH4"]],["item",["span","bbCodeItem"]]]),BBREGEX=/\[(\/?)([a-zA-Z0-9]+)\]/g,CUSTOM_BBREGEX=/\[(\/?)([^\[\n]*?)\]/g;let linkActions=null,tipList=null,classIndex=0;function bbToHtmlReplacerFunc(e,t,s){var i=BB_CODE_MAP.get(s);if(!i)return"class"===s?t?"</span>":`<span class="bbclass${classIndex++}">`:e;if("string"==typeof i){if("a"===i&&0===linkActions.length||"abbr"===i&&0===tipList.length)return e;if("a"!==i||t){if("abbr"!==i||t)return"<"+t+i+">";if(0>(t=parseInt(s.substring(3),10)-1)||t>=tipList.length)throw Error("invalid bbcode tip substitution");if(i="","string"==typeof(t=tipList[t])?i=t:"function"==typeof t&&(i=t()),"string"!=typeof i)throw new TypeError("invalid bbcode tip");return`<abbr title="${C3$jscomp$35.ReplaceAll(i,'"',"&quot;")}">`}if(0>(t=parseInt(s.substring(1),10)-1)||t>=linkActions.length)throw Error("invalid bbcode link substitution");if("string"==typeof(i=linkActions[t]))return`<a href="${linkActions[t]}">`;if("function"==typeof i)return`<a class="bblink${t}">`;throw new TypeError("invalid bbcode link action")}return Array.isArray(i)?(e=i[0],i=i[1],t?"</"+e+">":`<${e} class="${i}">`):void 0}const LINEBREAK_REGEX=/\n/g;C3$jscomp$35.BBString=class{constructor(e,t){if(this._bbstr=t&&t.noEscape?e:C3$jscomp$35.EscapeHTML(e),this._htmlstr="",this._convertLineBreaks=!1,this._linkActions=[],this._tipList=[],t){if(this._convertLineBreaks=!!t.convertLineBreaks,t.links){if(9<t.links.length)throw Error("too many links");this._linkActions=t.links}if(t.tips){if(9<t.tips.length)throw Error("too many tips");this._tipList=t.tips}}this._hasAnyBBtags=this._bbstr.includes("["),this._needsLineBreakConversion=this._convertLineBreaks&&this._bbstr.includes("\n"),this._isPlain=!this._hasAnyBBtags&&!this._needsLineBreakConversion&&!this._bbstr.includes("&"),this._hasParsedFragments=!1,this._fragments=[]}toString(){return this._bbstr}valueOf(){return this._bbstr}isPlainText(){return this._isPlain}toPlainText(){return this._hasAnyBBtags?this._bbstr.replace(BBREGEX,""):this._bbstr}toHTML(){if(this._isPlain)return this._bbstr;if(!this._htmlstr&&this._bbstr){let e=this._bbstr;this._hasAnyBBtags&&(classIndex=0,linkActions=this._linkActions,tipList=this._tipList,e=e.replace(BBREGEX,bbToHtmlReplacerFunc),tipList=linkActions=null),this._needsLineBreakConversion&&(e=e.replace(LINEBREAK_REGEX,"<br>")),this._htmlstr=e}return this._htmlstr}attachLinkHandlers(e){if(this._linkActions.length)for(let t=0,s=this._linkActions.length;t<s;++t){const s=this._linkActions[t];if("function"!=typeof s)continue;const i=e.querySelector(".bblink"+t);if(!i)throw Error("unable to attach BBString link handler");i.onclick=s}}equals(e){return e instanceof C3$jscomp$35.HtmlString?this.toHTML()===e.toHTML():e instanceof C3$jscomp$35.BBString?this._bbstr===e._bbstr:this._bbstr===e}toFragmentList(){if(this._hasParsedFragments)return this._fragments;const e=this._bbstr,t=[];let s=CUSTOM_BBREGEX.lastIndex=0;for(var i;null!==(i=CUSTOM_BBREGEX.exec(e));){var r=i.index;if(0<r&&"\\"===e.charAt(r-1))continue;var n=i[0],a=i[1];i=i[2];const o=e.substring(s,r);if(s=r+n.length,o&&this._fragments.push({text:o,styles:t.slice(0)}),i)if(a){for(i=i.toLowerCase(),r=t.length-1;0<=r;--r)if(t[r].tag===i){t.splice(r,1);break}}else r=i,n=null,-1!==(a=i.indexOf("="))?(r=i.substring(0,a).toLowerCase(),n=i.substring(a+1)):r=r.toLowerCase(),t.push({tag:r,param:n})}s<e.length&&this._fragments.push({text:e.substring(s),styles:t.slice(0)});for(const e of this._fragments)e.text=this._ProcessBBCodeEscapeSequences(e.text);return this._hasParsedFragments=!0,this._fragments}_ProcessBBCodeEscapeSequences(e){return e=C3$jscomp$35.ReplaceAll(e,"\\[","["),C3$jscomp$35.ReplaceAll(e,"\\\\","\\")}static StripTags(e){return C3$jscomp$35.New(C3$jscomp$35.BBString,e,{noEscape:!0}).toPlainText()}static StripAnyTags(e){return e.replace(CUSTOM_BBREGEX,"")}};const C3$jscomp$36=self.C3;function IsWordBreakWhiteSpace(e){return""!==e&&""!==e&&C3$jscomp$36.IsWhitespaceChar(e)}function WordBreakTrimEnd(e){for(;0<e.length&&IsWordBreakWhiteSpace(e.at(-1));)e.pop()}function IsNewline(e){return"\n"===e||"\r\n"===e}C3$jscomp$36.WordWrap=class{constructor(){this._lines=[]}GetLines(){return this._lines}GetLineCount(){return this._lines.length}_MeasureLine(e,t){let s=0,i=0,r=0,n=0,a=0;for(const o of e)-1===o.width&&(e=t(o.chArr,o.styles),o.width=e.width,o.height=e.height,o.fontBoundingBoxAscent=e.fontBoundingBoxAscent||0,o.fontBoundingBoxDescent=e.fontBoundingBoxDescent||0,o.topToAlphabeticDistance=e.topToAlphabeticDistance||0),s+=o.width,i=Math.max(i,o.height),r=Math.max(r,o.fontBoundingBoxAscent),n=Math.max(n,o.fontBoundingBoxDescent),a=Math.max(a,o.topToAlphabeticDistance);return{width:s,height:i,fontBoundingBoxAscent:r,fontBoundingBoxDescent:n,topToAlphabeticDistance:a}}_AddLine(e,t,s,i,r,n){this._lines.push({fragments:e,width:t,height:s,fontBoundingBoxAscent:i,fontBoundingBoxDescent:r,topToAlphabeticDistance:n})}WordWrap(e,t,s,i,r){if("string"==typeof e&&(e=[{text:e,styles:[]}]),C3$jscomp$36.clearArray(this._lines),!(!e.length||1===e.length&&!e[0].text.length||2>s)){if(1===(e=e.map((e=>({chArr:C3$jscomp$36.SplitGraphemes(e.text),styles:e.styles})))).length){var n=e[0];const i=n.chArr;if(n=n.styles,100>=i.length&&!i.includes("\n")){let{width:e,height:a,fontBoundingBoxAscent:o,fontBoundingBoxDescent:h,topToAlphabeticDistance:l}=t(i,n);if(e+=r,o=o||0,h=h||0,l=l||0,e<=s)return void this._AddLine([{chArr:i,styles:n,width:e,height:a,fontBoundingBoxAscent:o,fontBoundingBoxDescent:h,topToAlphabeticDistance:l}],e,a,o,h,l)}}if("word"===i)i=this._TokeniseWords(e);else{i=[];for(const t of e)C3$jscomp$36.appendArray(i,t.chArr.map((e=>[{chArr:[e],styles:t.styles}])))}this._WrapText(i,t,s,r)}}_TokeniseWords(e){const t=[];let s=[],i=!1;for(const n of e){var r=n.chArr;e=n.styles;for(const n of r)IsNewline(n)?(0<s.length&&t.push(s),t.push([{chArr:["\n"],styles:e}]),s=[]):0===s.length?(s.push({chArr:[n],styles:e}),i=IsWordBreakWhiteSpace(n)):(r=IsWordBreakWhiteSpace(n))===i?(r=s.at(-1)).styles===e?r.chArr.push(n):s.push({chArr:[n],styles:e}):(t.push(s),s=[],s.push({chArr:[n],styles:e}),i=r)}return 0<s.length&&t.push(s),t}_CopyLine(e){return e.map((e=>({chArr:e.chArr.slice(0),styles:e.styles,width:e.width,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent,topToAlphabeticDistance:e.topToAlphabeticDistance})))}_AddWordToLine(e,t){var s=e.length?e.at(-1):null;let i=0;for(s&&t[0].styles===s.styles&&(C3$jscomp$36.appendArray(s.chArr,t[0].chArr),s.width=-1,s.height=-1,s.fontBoundingBoxAscent=-1,s.fontBoundingBoxDescent=-1,s.topToAlphabeticDistance=-1,i=1),s=t.length;i<s;++i){const s=t[i];e.push({chArr:s.chArr.slice(0),styles:s.styles,width:-1,height:-1,fontBoundingBoxAscent:-1,fontBoundingBoxDescent:-1,topToAlphabeticDistance:-1})}}_WrapText(e,t,s,i){let r=[],n=0,a=0,o=0,h=0;var l=0;for(const i of e){if(1===i.length&&1===i[0].chArr.length&&IsNewline(i[0].chArr[0])){0===a&&(a=(l=t([" "],i[0].styles)).height,o=l.fontBoundingBoxAscent||0,h=l.fontBoundingBoxDescent||0,l=l.topToAlphabeticDistance||0),this._AddLine(r,n,a,o,h,l),r=[],l=h=o=a=n=0;continue}e=this._CopyLine(r),this._AddWordToLine(e,i);const c=this._MeasureLine(e,t),u=c.width;u>=s?(0<r.length&&this._AddLine(r,n,a,o,h,l),r=[],C3$jscomp$36.IsCharArrayAllWhitespace(i[0].chArr)?l=h=o=a=n=0:(this._AddWordToLine(r,i),n=(l=this._MeasureLine(r,t)).width,a=l.height,o=l.fontBoundingBoxAscent,h=l.fontBoundingBoxDescent,l=l.topToAlphabeticDistance)):(r=e,n=u,a=c.height,o=c.fontBoundingBoxAscent,h=c.fontBoundingBoxDescent,l=c.topToAlphabeticDistance)}0<r.length&&this._AddLine(r,n,a,o,h,l),this._TrimLinesTrailingWhitespace(t,i)}_TrimLinesTrailingWhitespace(e,t){for(const i of this._lines){const r=i.fragments;if(!r.length)continue;let n=r.at(-1);var s=n.chArr;const a=s.slice(0);if(WordBreakTrimEnd(a),0===a.length)i.width-=n.width,r.pop();else if(a.length<s.length){s=e(a,n.styles).width;const t=n.width-s;n.width=s,n.chArr=a,i.width-=t}0!==t&&0<r.length&&(n=r.at(-1),n.width+=t,i.width+=t)}}Clear(){C3$jscomp$36.clearArray(this._lines)}GetMaxLineWidth(){return this._lines.reduce(((e,t)=>Math.max(e,t.width)),0)}GetTotalLineHeight(){return this._lines.reduce(((e,t)=>e+t.height),0)}};const C3$jscomp$37=self.C3,glMatrix=self.glMatrix,vec3$jscomp$1=glMatrix.vec3,vec4$jscomp$1=glMatrix.vec4,mat4$jscomp$1=glMatrix.mat4,tempVec3a=vec3$jscomp$1.create(),tempVec3b=vec3$jscomp$1.create(),tempVec3c=vec3$jscomp$1.create(),tempVec4=vec4$jscomp$1.create(),tempMat4=mat4$jscomp$1.create(),neartl=vec3$jscomp$1.create(),neartr=vec3$jscomp$1.create(),nearbl=vec3$jscomp$1.create(),nearbr=vec3$jscomp$1.create(),fartl=vec3$jscomp$1.create(),fartr=vec3$jscomp$1.create(),farbl=vec3$jscomp$1.create(),farbr=vec3$jscomp$1.create(),unitViewport=vec4$jscomp$1.fromValues(0,0,1,1);function PlaneFromPoints(e,t,s,i){vec3$jscomp$1.subtract(tempVec3a,s,t),vec3$jscomp$1.subtract(tempVec3b,e,t),vec3$jscomp$1.cross(tempVec3c,tempVec3a,tempVec3b),vec3$jscomp$1.normalize(tempVec3c,tempVec3c),i.set(tempVec3c[0],tempVec3c[1],tempVec3c[2],vec3$jscomp$1.dot(e,tempVec3c))}function IsInFrontOfPlane(e,t,s,i,r,n,a){const o=a.x,h=a.y,l=a.z,c=a.w,u=a.xF,p=a.yF,_=1-u,m=1-p,d=1-(a=a.zF);return o*e*u+o*i*_+h*t*p+h*r*m+l*s*a+l*n*d>=c||o*i*u+o*e*_+h*r*p+h*t*m+l*n*a+l*s*d>c}function IsPointInFrontOfPlane(e,t,s,i){return i.x*e+i.y*t+i.z*s>=i.w}C3$jscomp$37.Gfx={Project(e,t,s,i,r,n,a){const o=i[0]*e+i[4]*t+i[8]*s+i[12],h=i[1]*e+i[5]*t+i[9]*s+i[13],l=i[2]*e+i[6]*t+i[10]*s+i[14];return i=i[3]*e+i[7]*t+i[11]*s+i[15],e=r[0]*o+r[4]*h+r[8]*l+r[12]*i,t=r[1]*o+r[5]*h+r[9]*l+r[13]*i,s=r[2]*o+r[6]*h+r[10]*l+r[14]*i,0!=(r=r[3]*o+r[7]*h+r[11]*l+r[15]*i)&&(r=1/r,a[0]=(e*r*.5+.5)*n[2]+n[0],a[1]=(t*r*.5+.5)*n[3]+n[1],a[2]=.5*(1+s*r),!0)},Unproject:(e,t,s,i,r,n,a)=>(mat4$jscomp$1.multiply(tempMat4,r,i),null!==mat4$jscomp$1.invert(tempMat4,tempMat4)&&(tempVec4[0]=(e-n[0])/n[2]*2-1,tempVec4[1]=(t-n[1])/n[3]*2-1,tempVec4[2]=2*s-1,tempVec4[3]=1,vec4$jscomp$1.transformMat4(tempVec4,tempVec4,tempMat4),0!==tempVec4[3]&&(tempVec4[3]=1/tempVec4[3],a[0]=tempVec4[0]*tempVec4[3],a[1]=tempVec4[1]*tempVec4[3],a[2]=tempVec4[2]*tempVec4[3],!0))),UnprojectScreenToWorldZ(e,t,s,i,r,n,a){const o=tempVec3a;if(!C3$jscomp$37.Gfx.Unproject(e,t,0,i,r,n,o)||!C3$jscomp$37.Gfx.Unproject(e,t,1,i,r,n,tempVec3b))return!1;if(vec3$jscomp$1.subtract(tempVec3b,tempVec3b,o),e=tempVec3c,vec3$jscomp$1.set(e,0,0,1),s=-s,i=0,0===(t=vec3$jscomp$1.dot(e,tempVec3b))){if(0!==vec3$jscomp$1.dot(e,o)+s)return!1}else if(0>(i=-(vec3$jscomp$1.dot(o,e)+s)/t))return!1;return vec3$jscomp$1.scaleAndAdd(a,o,tempVec3b,i),!0}};class Plane{constructor(){this.zF=this.yF=this.xF=this.w=this.z=this.y=this.x=NaN}set(e,t,s,i){this.x=e,this.y=t,this.z=s,this.w=i,this.xF=0<e?1:0,this.yF=0<t?1:0,this.zF=0<s?1:0}}C3$jscomp$37.Gfx.ViewFrustum=class{constructor(){this._leftP=new Plane,this._topP=new Plane,this._rightP=new Plane,this._bottomP=new Plane,this._nearP=new Plane,this._farP=new Plane}CalculatePlanes(e,t){C3$jscomp$37.Gfx.Unproject(0,1,0,e,t,unitViewport,neartl),C3$jscomp$37.Gfx.Unproject(1,1,0,e,t,unitViewport,neartr),C3$jscomp$37.Gfx.Unproject(0,0,0,e,t,unitViewport,nearbl),C3$jscomp$37.Gfx.Unproject(1,0,0,e,t,unitViewport,nearbr),C3$jscomp$37.Gfx.Unproject(0,1,1,e,t,unitViewport,fartl),C3$jscomp$37.Gfx.Unproject(1,1,1,e,t,unitViewport,fartr),C3$jscomp$37.Gfx.Unproject(0,0,1,e,t,unitViewport,farbl),C3$jscomp$37.Gfx.Unproject(1,0,1,e,t,unitViewport,farbr),PlaneFromPoints(nearbl,neartl,fartl,this._leftP),PlaneFromPoints(neartl,neartr,fartr,this._topP),PlaneFromPoints(neartr,nearbr,farbr,this._rightP),PlaneFromPoints(nearbr,nearbl,farbl,this._bottomP),PlaneFromPoints(farbl,fartl,fartr,this._farP),PlaneFromPoints(nearbr,neartr,neartl,this._nearP)}ContainsAABB(e,t,s,i,r,n){return IsInFrontOfPlane(e,t,s,i,r,n,this._leftP)&&IsInFrontOfPlane(e,t,s,i,r,n,this._topP)&&IsInFrontOfPlane(e,t,s,i,r,n,this._rightP)&&IsInFrontOfPlane(e,t,s,i,r,n,this._bottomP)&&IsInFrontOfPlane(e,t,s,i,r,n,this._nearP)&&IsInFrontOfPlane(e,t,s,i,r,n,this._farP)}IsBehindNearPlane(e,t,s){return!IsPointInFrontOfPlane(e,t,s,this._nearP)}};const C3$jscomp$38=self.C3,glMatrix$jscomp$1=self.glMatrix,vec3$jscomp$2=glMatrix$jscomp$1.vec3,vec4$jscomp$2=glMatrix$jscomp$1.vec4,mat4$jscomp$2=glMatrix$jscomp$1.mat4,tempMat4$jscomp$1=mat4$jscomp$2.create(),tmpVec3a=vec3$jscomp$2.fromValues(0,0,0),tmpVec3b=vec3$jscomp$2.fromValues(0,0,0),tmpVec3c=vec3$jscomp$2.fromValues(0,0,0),defaultUpVector=vec3$jscomp$2.fromValues(0,1,0);vec4$jscomp$2.fromValues(0,0,0,0);const tmpQuad=new C3$jscomp$38.Quad,tmpRect=new C3$jscomp$38.Rect,defaultTexCoordsQuad=new C3$jscomp$38.Quad(0,0,1,0,1,1,0,1),DEFAULT_RENDERERBASE_OPTS={nearZ:1,farZ:1e4};C3$jscomp$38.Gfx.RendererBase=class{constructor(e){e=Object.assign({},DEFAULT_RENDERERBASE_OPTS,e),this._height=this._width=0,this._fovY=C3$jscomp$38.toRadians(45),this._tan_fovY_2=Math.tan(this._fovY/2),this._matP=mat4$jscomp$2.create(),this._matMV=mat4$jscomp$2.create(),this._zAxisScale=!1,this._nearZ=e.nearZ,this._farZ=e.farZ,this._allShaderPrograms=[],this._shaderProgramsByName=new Map,this._spSmoothLineFill=this._spSmoothEllipseOutline=this._spSmoothEllipseFill=this._spHardEllipseOutline=this._spHardEllipseFill=this._spPenumbraFill=this._spLinearGradientFill=this._spColorFill=this._spTileRandomization=this._spTilemapFill=this._spPoints=this._spTextureFill=null,this._stateGroups=new Map,this._currentStateGroup=null,this._blendModeTable=[],this._namedBlendModeMap=new Map,this._currentZ=this._baseZ=0,this._lineWidth=1,this._lineWidthStack=[this._lineWidth],this._lineCap=1,this._lineCapStack=[this._lineCap],this._lineOffset=.5,this._lineOffsetStack=[this._lineOffset],this._frameNumber=0,this._enableMipmaps=!0,this._hasMajorPerformanceCaveat=!1}FillIndexBufferData(e){let t=0,s=e.length,i=0;for(;t<s;)e[t++]=i,e[t++]=i+1,e[t++]=i+2,e[t++]=i,e[t++]=i+2,e[t++]=i+3,i+=4}_ClearState(){this._currentZ=this._baseZ=0,this._spSmoothLineFill=this._spSmoothEllipseOutline=this._spSmoothEllipseFill=this._spHardEllipseOutline=this._spHardEllipseFill=this._spPenumbraFill=this._spLinearGradientFill=this._spColorFill=this._spTileRandomization=this._spTilemapFill=this._spPoints=this._spTextureFill=null,this._ClearAllShaderPrograms()}InitState(){this._ClearState(),this._currentStateGroup=null}OnDeviceOrContextLost(){for(const e of this._allShaderPrograms)e.Release();this._ClearState()}GetWidth(){return this._width}GetHeight(){return this._height}GetDefaultCameraZ(e){return this.IsZAxisScaleNormalized()?100:e/(2*this._GetTanFovYDiv2())}GetZAxisScaleFactor(e){return this.IsZAxisScaleNormalized()?e/(2*this._GetTanFovYDiv2())/this.GetDefaultCameraZ(e):1}SetNearZ(e){this._nearZ=e}GetNearZ(){return this._nearZ}SetFarZ(e){this._farZ=e}GetFarZ(){return this._farZ}SetFovY(e){this._fovY=e,this._tan_fovY_2=Math.tan(this._fovY/2)}GetFovY(){return this._fovY}_GetTanFovYDiv2(){return this._tan_fovY_2}SetZAxisScaleNormalized(){this._zAxisScale=!1}SetZAxisScaleRegular(){this._zAxisScale=!0}IsZAxisScaleNormalized(){return!this._zAxisScale}IsZAxisScaleRegular(){return this._zAxisScale}CalculatePerspectiveMatrix(e,t,s=.5,i=.5){const r=this.GetNearZ(),n=this.GetFarZ();var a=this.GetFovY();if(.5===s&&.5===i)this.IsWebGPU()?mat4$jscomp$2.perspectiveZO(e,a,t,r,n):mat4$jscomp$2.perspective(e,a,t,r,n);else{a=2*(s=1-s)-2,s*=2;const o=2*i-2;i*=2;const h=this._GetTanFovYDiv2()*r;t*=h,mat4$jscomp$2.frustum(e,a*t,s*t,o*h,i*h,r,n)}}CalculateOrthographicMatrix(e,t,s,i=1){var r=self.devicePixelRatio;const n=2*this.GetDefaultCameraZ(s)*r*this._GetTanFovYDiv2()/s;s=s*n/(2*r*i),i=-(t=t*n/(2*r*i)),r=-s,this.IsWebGPU()?mat4$jscomp$2.orthoZO(e,i,t,r,s,this.GetNearZ(),this.GetFarZ()):mat4$jscomp$2.ortho(e,i,t,r,s,this.GetNearZ(),this.GetFarZ())}CalculateLookAtModelView(e,t,s,i,r,n=1){let a=1;this.IsZAxisScaleNormalized()&&(a=200*this._GetTanFovYDiv2()/r),vec3$jscomp$2.set(tmpVec3c,a,-a,1),vec3$jscomp$2.multiply(tmpVec3a,t,tmpVec3c),vec3$jscomp$2.multiply(tmpVec3b,s,tmpVec3c),mat4$jscomp$2.lookAt(e,tmpVec3a,tmpVec3b,i||defaultUpVector),tmpVec3c[2]=n,mat4$jscomp$2.scale(e,e,tmpVec3c)}CalculateLookAtModelView2(e,t,s,i,r,n,a,o){return vec3$jscomp$2.set(tmpVec3a,e,t,s),vec3$jscomp$2.set(tmpVec3b,i,r,n),this.CalculateLookAtModelView(tempMat4$jscomp$1,tmpVec3a,tmpVec3b,defaultUpVector,a,o),tempMat4$jscomp$1}_AddShaderProgram(e){this._allShaderPrograms.push(e),this._shaderProgramsByName.set(e.GetName(),e)}_RemoveShaderProgram(e){const t=this._allShaderPrograms.indexOf(e);-1!==t&&this._allShaderPrograms.splice(t,1),this._shaderProgramsByName.delete(e.GetName())}_ClearAllShaderPrograms(){C3$jscomp$38.clearArray(this._allShaderPrograms),this._shaderProgramsByName.clear()}GetShaderProgramByName(e){return this._shaderProgramsByName.get(e)||null}GetTextureFillShaderProgram(){return this._spTextureFill}SetTextureFillMode(){this.SetProgram(this._spTextureFill)}GetPointsRenderingProgram(){return this._spPoints}SetPointsRenderingProgram(){this.SetProgram(this._spPoints)}SetTilemapFillMode(){this.SetProgram(this._spTilemapFill)}SetTileRandomizationMode(){this.SetProgram(this._spTileRandomization)}SetColorFillMode(){this.SetProgram(this._spColorFill)}SetLinearGradientFillMode(){this.SetProgram(this._spLinearGradientFill)}SetPenumbraFillMode(){this.SetProgram(this._spPenumbraFill)}SetHardEllipseFillMode(){this.SetProgram(this._spHardEllipseFill)}SetHardEllipseOutlineMode(){this.SetProgram(this._spHardEllipseOutline)}SetSmoothEllipseFillMode(){this.SetProgram(this._spSmoothEllipseFill)}SetSmoothEllipseOutlineMode(){this.SetProgram(this._spSmoothEllipseOutline)}SetSmoothLineFillMode(){this.SetProgram(this._spSmoothLineFill)}_SetCurrentStateGroup(e){this._currentStateGroup=e}GetCurrentStateGroup(){return this._currentStateGroup}AcquireStateGroup(e,t,s,i){const r=C3$jscomp$38.Gfx.StateGroup.MakeKey(e,t,s,i);let n=this._stateGroups.get(r);return n||(n=C3$jscomp$38.New(C3$jscomp$38.Gfx.StateGroup,this,e,t,s,i),this._stateGroups.set(r,n)),n.AddRef(),n}ReleaseStateGroup(e){e.DecRef(),0===e._GetRefCount()&&(this._currentStateGroup===e&&(this._currentStateGroup=null),this._stateGroups.delete(e.GetKey()),e.Release())}_InitBlendModeData(e){C3$jscomp$38.clearArray(this._blendModeTable),this._namedBlendModeMap.clear();let t=0;for(const s of e){e=s[0];const i=s[1],r=s[2];this._blendModeTable.push([i,r]),this._namedBlendModeMap.set(e,{number:t,srcBlend:i,destBlend:r}),t++}}_GetBlendByIndex(e){return this._blendModeTable[e]}GetSrcBlendByIndex(e){return this._GetBlendByIndex(e)[0]}GetDestBlendByIndex(e){return this._GetBlendByIndex(e)[1]}GetNamedBlend(e){if(void 0===(e=this._namedBlendModeMap.get(e)))throw Error("invalid blend name");return e}NamedBlendToNumber(e){if(void 0===(e=this._namedBlendModeMap.get(e)))throw Error("invalid blend name");return e.number}SetBaseZ(e){this._baseZ=e}GetBaseZ(){return this._baseZ}SetCurrentZ(e){this._currentZ=e,this._currentStateGroup=null}GetCurrentZ(){return this._currentZ}Line(e,t,s,i){var r=C3$jscomp$38.angleTo(e,t,s,i),n=.5*this._lineWidth;const a=Math.sin(r)*n;r=Math.cos(r)*n,2===(n=this._lineCap)?this.LinePreCalc_LineCap2(e,t,0,s,i,0,a,r):1===n?this.LinePreCalc_LineCap1(e,t,0,s,i,0,a,r):this.LinePreCalc_LineCap0(e,t,0,s,i,0,a,r)}Line3D(e,t,s,i,r,n){var a=C3$jscomp$38.angleTo(e,t,i,r),o=.5*this._lineWidth;const h=Math.sin(a)*o;a=Math.cos(a)*o,2===(o=this._lineCap)?this.LinePreCalc_LineCap2(e,t,s,i,r,n,h,a):1===o?this.LinePreCalc_LineCap1(e,t,s,i,r,n,h,a):this.LinePreCalc_LineCap0(e,t,s,i,r,n,h,a)}LinePreCalc_LineCap2(e,t,s,i,r,n,a,o){var h=this._lineOffset;e=e+h-o,t=t+h-a,i=i+h+o,r=r+h+a,h=2*o;const l=2*a;this.Quad3D2(e+a,t-o,s,i+a,r-o,n,i-a-h,r+o-l,n,e-a+h,t+o+l,s,defaultTexCoordsQuad)}LinePreCalc_LineCap1(e,t,s,i,r,n,a,o){const h=this._lineOffset;e=e+h-o,t=t+h-a,i=i+h+o,r=r+h+a,this.Quad3D2(e+a,t-o,s,i+a,r-o,n,i-a,r+o,n,e-a,t+o,s,defaultTexCoordsQuad)}LinePreCalc_LineCap0(e,t,s,i,r,n,a,o){const h=this._lineOffset;e+=h,t+=h,i+=h,r+=h,this.Quad3D2(e+a,t-o,s,i+a,r-o,n,i-a,r+o,n,e-a,t+o,s,defaultTexCoordsQuad)}TexturedLine(e,t,s,i,r,n){var a=C3$jscomp$38.angleTo(e,t,s,i),o=.5*this._lineWidth;const h=Math.sin(a)*o;a=Math.cos(a)*o,2===(o=this._lineCap)?this.TexturedLinePreCalc_LineCap2(e,t,s,i,h,a,r,n):1===o?this.TexturedLinePreCalc_LineCap1(e,t,s,i,h,a,r,n):this.TexturedLinePreCalc_LineCap0(e,t,s,i,h,a,r,n)}TexturedLinePreCalc_LineCap2(e,t,s,i,r,n,a,o){var h=this._lineOffset;e=e+h-n,t=t+h-r,s=s+h+n,i=i+h+r,h=2*n;const l=2*r;tmpQuad.set(e+r,t-n,s+r,i-n,s-r-h,i+n-l,e-r+h,t+n+l),tmpRect.set(a,0,o,0),this.Quad3(tmpQuad,tmpRect)}TexturedLinePreCalc_LineCap1(e,t,s,i,r,n,a,o){const h=this._lineOffset;e=e+h-n,t=t+h-r,s=s+h+n,i=i+h+r,tmpQuad.set(e+r,t-n,s+r,i-n,s-r,i+n,e-r,t+n),tmpRect.set(a,0,o,0),this.Quad3(tmpQuad,tmpRect)}TexturedLinePreCalc_LineCap0(e,t,s,i,r,n,a,o){const h=this._lineOffset;e+=h,t+=h,s+=h,i+=h,tmpQuad.set(e+r,t-n,s+r,i-n,s-r,i+n,e-r,t+n),tmpRect.set(a,0,o,0),this.Quad3(tmpQuad,tmpRect)}LineRect(e,t,s,i){const r=.5*this._lineWidth,n=this._lineCap;2===n?this._LineRectPreCalc_LineCap2(e,t,s,i,r):1===n?this._LineRectPreCalc_LineCap1(e,t,s,i,r):this._LineRectPreCalc_LineCap0(e,t,s,i,r)}_LineRectPreCalc_LineCap2(e,t,s,i,r){this.LinePreCalc_LineCap2(e,t,0,s,t,0,0,r),this.LinePreCalc_LineCap2(s,t,0,s,i,0,r,0),this.LinePreCalc_LineCap2(s,i,0,e,i,0,0,-r),this.LinePreCalc_LineCap2(e,i,0,e,t,0,-r,0)}_LineRectPreCalc_LineCap1(e,t,s,i,r){this.LinePreCalc_LineCap1(e,t,0,s,t,0,0,r),this.LinePreCalc_LineCap1(s,t,0,s,i,0,r,0),this.LinePreCalc_LineCap1(s,i,0,e,i,0,0,-r),this.LinePreCalc_LineCap1(e,i,0,e,t,0,-r,0)}_LineRectPreCalc_LineCap0(e,t,s,i,r){this.LinePreCalc_LineCap0(e,t,0,s,t,0,0,r),this.LinePreCalc_LineCap0(s,t,0,s,i,0,r,0),this.LinePreCalc_LineCap0(s,i,0,e,i,0,0,-r),this.LinePreCalc_LineCap0(e,i,0,e,t,0,-r,0)}LineRect2(e){this.LineRect(e.getLeft(),e.getTop(),e.getRight(),e.getBottom())}LineQuad(e){var t=C3$jscomp$38.angleTo(e.getTlx(),e.getTly(),e.getTrx(),e.getTry()),s=.5*this._lineWidth;const i=Math.sin(t)*s;t=Math.cos(t)*s,2===(s=this._lineCap)?this._LineQuadPreCalc_LineCap2(e,i,t):1===s?this._LineQuadPreCalc_LineCap1(e,i,t):this._LineQuadPreCalc_LineCap0(e,i,t)}_LineQuadPreCalc_LineCap2(e,t,s){this.LinePreCalc_LineCap2(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap2(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap2(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap2(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}_LineQuadPreCalc_LineCap1(e,t,s){this.LinePreCalc_LineCap1(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap1(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap1(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap1(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}_LineQuadPreCalc_LineCap0(e,t,s){this.LinePreCalc_LineCap0(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap0(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap0(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap0(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}SetLineWidth(e){this._lineWidth=e,this._lineWidthStack[this._lineWidthStack.length-1]=e}GetLineWidth(){return this._lineWidth}PushLineWidth(e){if(100<=this._lineWidthStack.length)throw Error("pushed too many line widths - check push/pop pairs");this._lineWidthStack.push(e),this._lineWidth=e}PopLineWidth(){if(1>=this._lineWidthStack.length)throw Error("cannot pop last line width - check push/pop pairs");this._lineWidthStack.pop(),this._lineWidth=this._lineWidthStack.at(-1)}SetLineCapButt(){this._lineCap=0,this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapSquare(){this._lineCap=1,this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapZag(){this._lineCap=2,this._lineCapStack[this._lineCapStack.length-1]=0}PushLineCap(e){if("butt"===e)this.PushLineCapButt();else if("square"===e)this.PushLineCapSquare();else{if("zag"!==e)throw Error("invalid line cap");this.PushLineCapZag()}}PushLineCapButt(){if(100<=this._lineCapStack.length)throw Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(0),this._lineCap=0}PushLineCapSquare(){if(100<=this._lineCapStack.length)throw Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(1),this._lineCap=1}PushLineCapZag(){if(100<=this._lineCapStack.length)throw Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(2),this._lineCap=2}PopLineCap(){if(1>=this._lineCapStack.length)throw Error("cannot pop last line cap - check push/pop pairs");this._lineCapStack.pop(),this._lineCap=this._lineCapStack.at(-1)}SetLineOffset(e){this._lineOffset=e,this._lineOffsetStack[this._lineOffsetStack.length-1]=e}GetLineOffset(){return this._lineOffset}PushLineOffset(e){if(100<=this._lineOffsetStack.length)throw Error("pushed too many line offsets - check push/pop pairs");this._lineOffsetStack.push(e),this._lineOffset=e}PopLineOffset(){if(1>=this._lineOffsetStack.length)throw Error("cannot pop last line offset - check push/pop pairs");this._lineOffsetStack.pop(),this._lineOffset=this._lineOffsetStack.at(-1)}ConvexPoly(e){var t=e.length/2;if(3>t)throw Error("need at least 3 points");const s=(t-=2)-1,i=e[0],r=e[1];for(let n=0;n<t;n+=2){const t=2*n,a=e[t+2],o=e[t+3],h=e[t+4],l=e[t+5];n===s?this.Quad2(i,r,a,o,h,l,h,l):this.Quad2(i,r,a,o,h,l,e[t+6],e[t+7])}}GetNumVertexComponents(){return 3}Finish(){this.EndBatch(!0),this._frameNumber++}GetFrameNumber(){return this._frameNumber}IncrementFrameNumber(){this._frameNumber++}SetMipmapsEnabled(e){this._enableMipmaps=!!e}AreMipmapsEnabled(){return this._enableMipmaps}SetHasMajorPerformanceCaveat(e){this._hasMajorPerformanceCaveat=!!e}HasMajorPerformanceCaveat(){return this._hasMajorPerformanceCaveat}IsWebGL(){return!1}IsWebGPU(){return!1}},self.C3.Gfx.ShaderProgramBase=class{constructor(e,t,s){this._name=t,this._renderer=e,this._extendBoxHorizontal=s.extendBoxHorizontal||0,this._extendBoxVertical=s.extendBoxVertical||0,this._crossSampling=!!s.crossSampling,this._mustPreDraw=!!s.mustPreDraw,this._preservesOpaqueness=!!s.preservesOpaqueness,this._animated=!!s.animated,this._blendsBackground=!!s.blendsBackground,this._usesDepth=!!s.usesDepth,this._usesAnySrcRectOrPixelSize=!1,this._needsPostDrawOrExtendBox=this._crossSampling||this._blendsBackground||0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}Release(){this._renderer=null}GetRenderer(){return this._renderer}GetName(){return this._name}ExtendsBox(){return 0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}GetBoxExtendHorizontal(){return this._extendBoxHorizontal}GetBoxExtendVertical(){return this._extendBoxVertical}UsesCrossSampling(){return this._crossSampling}MustPreDraw(){return this._mustPreDraw}PreservesOpaqueness(){return this._preservesOpaqueness}IsAnimated(){return this._animated}BlendsBackground(){return this._blendsBackground}UsesDepth(){return this._usesDepth}UsesAnySrcRectOrPixelSize(){return this._usesAnySrcRectOrPixelSize}NeedsPostDrawOrExtendsBox(){return this._needsPostDrawOrExtendBox}UsesIsSrcTexRotated(){return!1}};const C3$jscomp$40=self.C3;C3$jscomp$40.Gfx.StateGroup=class{constructor(e,t,s,i,r){this._renderer=e,this._refCount=0,this._shaderProgram=null,this._shaderProgramName="",this._blendMode=s,this._color=C3$jscomp$40.New(C3$jscomp$40.Color),this._color.set(i),this._zElevation=r,"string"==typeof t?this._shaderProgramName=t:(this._shaderProgram=t,this._shaderProgramName=this._shaderProgram.GetName())}Release(){if(0<this._refCount)throw Error("releasing state group still in use");this._shaderProgram=this._renderer=null,this._shaderProgramName=""}Apply(){const e=this._renderer;e.SetProgram(this._shaderProgram),e.SetBlendMode(this._blendMode),e.SetColor(this._color),e.SetCurrentZ(this._zElevation),e._SetCurrentStateGroup(this)}GetKey(){return C3$jscomp$40.Gfx.StateGroup.MakeKey(this._shaderProgramName,this._blendMode,this._color,this._zElevation)}AddRef(){++this._refCount}DecRef(){--this._refCount}_GetRefCount(){return this._refCount}OnContextLost(){this._shaderProgram=null}OnContextRestored(e){if(this._shaderProgram=e.GetShaderProgramByName(this._shaderProgramName),!this._shaderProgram)throw Error("failed to restore shader program")}static MakeKey(e,t,s,i){return("string"==typeof e?e:e.GetName())+","+t+","+s.getR()+","+s.getG()+","+s.getB()+","+s.getA()+","+i}};const C3$jscomp$41=self.C3,tempQuadTex=C3$jscomp$41.New(C3$jscomp$41.Quad);function interpolateQuad(e,t,s){const i=s.getTlx(),r=s.getTly(),n=s.getTrx()-i,a=s.getTry()-r;return[i+n*e+(s.getBlx()-i)*t,r+a*e+(s=s.getBly()-r)*t]}C3$jscomp$41.Gfx.MeshPoint=class{constructor(e,t,s){this._mesh=e,this._col=t,this._row=s,this._v=this._u=this._zElevation=this._y=this._x=0}_Init(e,t,s,i){this._x=e,this._y=t,this._u=s,this._v=i}GetX(){return this._x}SetX(e){this._x!==e&&(this._x=e,this._mesh._SetPointsChanged())}GetY(){return this._y}SetY(e){this._y!==e&&(this._y=e,this._mesh._SetPointsChanged())}GetZElevation(){return this._zElevation}SetZElevation(e){this._zElevation!==e&&(this._zElevation=Math.max(e,0),this._mesh._SetPointsChanged())}GetU(){return this._u}SetU(e){this._u=e}GetV(){return this._v}SetV(e){this._v=e}_Interpolate_TexRect(e,t,s){[this._x,this._y]=interpolateQuad(e._x,e._y,t),this._zElevation=e._zElevation,this._u=C3$jscomp$41.lerp(s.getLeft(),s.getRight(),e._u),this._v=C3$jscomp$41.lerp(s.getTop(),s.getBottom(),e._v)}_Interpolate_TexQuad(e,t,s){[this._x,this._y]=interpolateQuad(e._x,e._y,t),this._zElevation=e._zElevation,[this._u,this._v]=interpolateQuad(e._u,e._v,s)}SaveToJson(){return{x:this.GetX(),y:this.GetY(),z:this.GetZElevation(),u:this.GetU(),v:this.GetV()}}LoadFromJson(e){this.SetX(e.x),this.SetY(e.y),e.hasOwnProperty("z")&&this.SetZElevation(e.z),this.SetU(e.u),this.SetV(e.v)}GetMesh(){return this._mesh}GetColumn(){return this._col}GetRow(){return this._row}},C3$jscomp$41.Gfx.Mesh=class{constructor(e,t,s){if(2>e||2>t)throw Error("invalid mesh size");this._hsize=e,this._vsize=t,this._owner=s||null,this._pts=[],this._minY=this._minX=0,this._maxY=this._maxX=1,this._maxZ=0,this._pointsChanged=!1,s=e-1;const i=t-1;for(let r=0;r<t;++r){const t=[];for(let n=0;n<e;++n){const e=C3$jscomp$41.New(C3$jscomp$41.Gfx.MeshPoint,this,n,r),a=n/s,o=r/i;e._Init(a,o,a,o),t.push(e)}this._pts.push(t)}}Release(){C3$jscomp$41.clearArray(this._pts)}GetHSize(){return this._hsize}GetVSize(){return this._vsize}GetOwner(){return this._owner}_GetPoints(){return this._pts}_SetPointsChanged(){this._pointsChanged=!0}_MaybeComputeBounds(){if(this._pointsChanged){var e=1/0,t=1/0,s=-1/0,i=-1/0,r=0;for(const n of this._pts)for(const a of n){const n=a.GetX(),o=a.GetY();e=Math.min(e,n),t=Math.min(t,o),s=Math.max(s,n),i=Math.max(i,o),r=Math.max(r,a.GetZElevation())}this._minX=e,this._minY=t,this._maxX=s,this._maxY=i,this._maxZ=r,this._pointsChanged=!1}}GetMinX(){return this._MaybeComputeBounds(),this._minX}GetMinY(){return this._MaybeComputeBounds(),this._minY}GetMaxX(){return this._MaybeComputeBounds(),this._maxX}GetMaxY(){return this._MaybeComputeBounds(),this._maxY}GetMaxZ(){return this._MaybeComputeBounds(),this._maxZ}HasAnyZElevation(){return 0<this.GetMaxZ()}GetMeshPointAt(e,t){return e=Math.floor(e),t=Math.floor(t),0>e||e>=this._hsize||0>t||t>=this._vsize?null:this._pts[t][e]}CalculateTransformedMesh(e,t,s){const i=s instanceof C3$jscomp$41.Rect;if(e.GetHSize()!==this.GetHSize()||e.GetVSize()!==this.GetVSize())throw Error("source mesh wrong size");e=e._pts;const r=this._pts;for(let n=0,a=r.length;n<a;++n){const a=e[n],o=r[n];for(let e=0,r=o.length;e<r;++e){const r=a[e],n=o[e];i?n._Interpolate_TexRect(r,t,s):n._Interpolate_TexQuad(r,t,s)}}}Draw(e){const t=this._pts;let s=t[0];for(let i=1,r=t.length;i<r;++i){const r=t[i];let n=s[0],a=r[0];for(let t=1,i=r.length;t<i;++t){const i=s[t],o=r[t];tempQuadTex.set(n.GetU(),n.GetV(),i.GetU(),i.GetV(),o.GetU(),o.GetV(),a.GetU(),a.GetV()),e.Quad3D2(n.GetX(),n.GetY(),n.GetZElevation(),i.GetX(),i.GetY(),i.GetZElevation(),o.GetX(),o.GetY(),o.GetZElevation(),a.GetX(),a.GetY(),a.GetZElevation(),tempQuadTex),n=i,a=o}s=r}}Outline(e,t){t||(t=(e,t,s)=>[e,t,s]);const s=this._pts;let i=s[0];for(let r=1,n=s.length;r<n;++r){const a=s[r];let o=i[0],h=a[0];for(let s=1,l=a.length;s<l;++s){const c=i[s],u=a[s],[p,_,m]=t(o.GetX(),o.GetY(),o.GetZElevation()),[d,g,f]=t(c.GetX(),c.GetY(),c.GetZElevation()),[C,S,y]=t(u.GetX(),u.GetY(),u.GetZElevation()),[$,G,I]=t(h.GetX(),h.GetY(),h.GetZElevation());e.Line3D(p,_,m,d,g,f),e.Line3D(p,_,m,C,S,y),e.Line3D(p,_,m,$,G,I),s===l-1&&e.Line3D(d,g,f,C,S,y),r===n-1&&e.Line3D($,G,I,C,S,y),o=c,h=u}i=a}}InsertPolyMeshVertices(e){e=e.pointsArr();const t=[],s=this.GetHSize()-1,i=this.GetVSize()-1,r=1/s,n=1/i,a=s-1,o=i-1;let h=e[0],l=e[1],c=C3$jscomp$41.clamp(Math.floor(h*s),0,a),u=C3$jscomp$41.clamp(Math.floor(l*i),0,o),p=0,_=0,m=0;var d=-1;const g=()=>{h=C3$jscomp$41.clamp(C3$jscomp$41.lerp(h,p,m),0,1),l=C3$jscomp$41.clamp(C3$jscomp$41.lerp(l,_,m),0,1),t.push(h,l)};for(let f=0,C=e.length;f<C;f+=2)for(h=e[f],l=e[f+1],t.push(h,l),c=C3$jscomp$41.clamp(Math.floor(h*s),0,a),u=C3$jscomp$41.clamp(Math.floor(l*i),0,o),p=e[d=(f+2)%C],_=e[d+1],d=-1;;){if(1e6<t.length)throw Error("Too many mesh poly points");const e=c*r,s=u*n,i=(c+1)*r,f=(u+1)*n;if(C3$jscomp$41.isPointInTriangleInclusive(h,l,e,s,i,s,i,f),0!==d&&(m=C3$jscomp$41.rayIntersectExtended(h,l,p,_,e,s,i,f,-.001),0<=m&&.99999999>=m))g(),d=0;else if(0<u&&2!==d&&(m=C3$jscomp$41.rayIntersectExtended(h,l,p,_,e,s,i,s,.001),0<=m&&.99999999>=m))g(),u--,d=4;else if(c<a&&3!==d&&(m=C3$jscomp$41.rayIntersectExtended(h,l,p,_,i,s,i,f,.001),0<=m&&.99999999>=m))g(),c++,d=1;else if(0<c&&1!==d&&(m=C3$jscomp$41.rayIntersectExtended(h,l,p,_,e,s,e,f,.001),0<=m&&.99999999>=m))g(),c--,d=3;else{if(!(u<o&&4!==d&&(m=C3$jscomp$41.rayIntersectExtended(h,l,p,_,e,f,i,f,.001),0<=m&&.99999999>=m)))break;g(),u++,d=2}}return C3$jscomp$41.New(C3$jscomp$41.CollisionPoly,t)}TransformCollisionPoly(e,t){e=this._TransformPolyPoints(e),this._SimplifyPoly(e),t.setPoints(e)}_TransformPolyPoints(e){const t=[];for(let s=0,i=(e=e.pointsArr()).length;s<i;s+=2){const[i,r]=this.TransformPoint(e[s],e[s+1]);t.push(i,r)}return t}TransformPoint(e,t){var s=this.GetHSize()-1,i=this.GetVSize()-1,r=1/s,n=1/i;s=C3$jscomp$41.clamp(Math.floor(e*s),0,s-1);const a=C3$jscomp$41.clamp(Math.floor(t*i),0,i-1);i=s*r;const o=a*n,h=(s+1)*r,l=(a+1)*n,c=this.GetMeshPointAt(s,a),u=this.GetMeshPointAt(s+1,a+1),p=C3$jscomp$41.isPointInTriangleInclusive(e,t,i,o,h,o,h,l);r=p?i+r:i,n=p?o:o+n,s=this.GetMeshPointAt(s+(p?1:0),a+(p?0:1));const[_,m,d]=C3$jscomp$41.triangleCartesianToBarycentric(e,t,i,o,r,n,h,l);return C3$jscomp$41.triangleBarycentricToCartesian(_,m,d,c.GetX(),c.GetY(),s.GetX(),s.GetY(),u.GetX(),u.GetY())}_SimplifyPoly(e){const t=[];let s=e[0],i=e[1],r=s-e.at(-2),n=i-e.at(-1);for(let o=0,h=e.length;o<h;o+=2){var a=(o+2)%h;const l=e[a],c=l-s,u=(a=e[a+1])-i,p=1e-7>Math.abs(u)&&1e-7>Math.abs(n)&&Math.sign(c)===Math.sign(r);(!(1e-7>Math.abs(c)&&1e-7>Math.abs(r)&&Math.sign(u)===Math.sign(n)||p)&&.001<Math.abs(c/r-u/n)||0==c&&0===u)&&t.push(s,i),s=l,i=a,r=c,n=u}6<=t.length&&t.length<e.length&&C3$jscomp$41.shallowAssignArray(e,t)}SaveToJson(){return{cols:this.GetHSize(),rows:this.GetVSize(),points:this._pts.map((e=>e.map((e=>e.SaveToJson()))))}}LoadFromJson(e){const t=this.GetHSize(),s=this.GetVSize();if(e.cols!==t||e.rows!==s)throw Error("mesh data wrong size");e=e.points;for(let i=0;i<s;++i){const s=e[i];for(let e=0;e<t;++e)this.GetMeshPointAt(e,i).LoadFromJson(s[e])}}};const C3$jscomp$42=self.C3,VALID_PIXEL_FORMATS=new Set(["rgba8","rgb8","rgba4","rgb5_a1","rgb565"]),VALID_SAMPLINGS=new Set(["nearest","bilinear","trilinear"]),VALID_MIPMAP_QUALITIES=new Set(["default","low","high"]),VALID_WRAP_MODES=new Set(["clamp-to-edge","repeat","mirror-repeat"]);function GetFormatSpecifiers(e,t){let s,i;switch(e){case"rgba8":e=t.RGBA8,i=s=t.RGBA,t=t.UNSIGNED_BYTE;break;case"rgb8":e=t.RGB8,i=s=t.RGB,t=t.UNSIGNED_BYTE;break;case"rgba4":e=t.RGBA4,i=s=t.RGBA,t=t.UNSIGNED_SHORT_4_4_4_4;break;case"rgb5_a1":e=t.RGB5_A1,i=s=t.RGBA,t=t.UNSIGNED_SHORT_5_5_5_1;break;case"rgb565":e=t.RGB565,i=s=t.RGB,t=t.UNSIGNED_SHORT_5_6_5;break;default:throw Error("invalid pixel format")}return{sizedinternalformat:e,internalformat:s,format:i,type:t}}const CREATEFROM_DEFAULT_OPTIONS={wrapX:"clamp-to-edge",wrapY:"clamp-to-edge",sampling:"trilinear",anisotropy:0,pixelFormat:"rgba8",mipMap:!0,mipMapQuality:"default",premultiplyAlpha:!0,isSvg:!1,width:-1,height:-1},UPDATE_DEFAULT_OPTIONS={premultiplyAlpha:!0,flipY:!1},allTextures=new Set;C3$jscomp$42.Gfx.WebGLRendererTexture=class{constructor(e){this._renderer=e,this._texture=null,this._height=this._width=0,this._isStatic=!0,this._wrapY=this._wrapX="clamp-to-edge",this._sampling="trilinear",this._anisotropy=0,this._pixelFormat="rgba8",this._isMipMapped=!1,this._mipMapQuality="default",this._refCount=0}_CreateStatic(e,t){if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||e instanceof ImageData||e instanceof ArrayBuffer)&&null!==e)throw Error("invalid texture source");if(t=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,t),this._texture)throw Error("already created texture");if(this._wrapX=t.wrapX,this._wrapY=t.wrapY,this._sampling=t.sampling,this._anisotropy=t.anisotropy,this._pixelFormat=t.pixelFormat,this._isMipMapped=!!t.mipMap&&this._renderer.AreMipmapsEnabled(),this._mipMapQuality=t.mipMapQuality,!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw Error("invalid mipmap quality");if(this._isStatic=!0,e instanceof ArrayBuffer||null===e||t.isSvg){if(this._width=t.width,this._height=t.height,e instanceof ArrayBuffer&&e.byteLength!==this._width*this._height*4)throw Error("ArrayBuffer wrong size")}else this._width=e.width,this._height=e.height;if(0>=this._width||0>=this._height)throw Error("invalid texture data size");if(t.isSvg){var s=C3$jscomp$42.CreateCanvas(this._width,this._height);s.getContext("2d").drawImage(e,0,0,this._width,this._height),e=s}var i=C3$jscomp$42.isPOT(this._width)&&C3$jscomp$42.isPOT(this._height);if(s=this._renderer.GetMaxTextureSize(),this._width>s||this._height>s)throw Error("texture data exceeds maximum texture size");s=this._renderer.GetContext();var r=this._renderer.GetWebGLVersionNumber();if(this._texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this._texture),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),t=GetFormatSpecifiers(this._pixelFormat,s),this._renderer.SupportsNPOTTextures()||i||!this._IsTiled())2<=r?(s.texStorage2D(s.TEXTURE_2D,this._isMipMapped?Math.floor(Math.log2(Math.max(this._width,this._height))+1):1,t.sizedinternalformat,this._width,this._height),e instanceof ArrayBuffer?s.texSubImage2D(s.TEXTURE_2D,0,0,0,this._width,this._height,t.format,t.type,new Uint8Array(e)):null!==e&&s.texSubImage2D(s.TEXTURE_2D,0,0,0,t.format,t.type,e)):e instanceof ArrayBuffer?s.texImage2D(s.TEXTURE_2D,0,t.internalformat,this._width,this._height,0,t.format,t.type,new Uint8Array(e)):null===e?s.texImage2D(s.TEXTURE_2D,0,t.internalformat,this._width,this._height,0,t.format,t.type,null):s.texImage2D(s.TEXTURE_2D,0,t.internalformat,t.format,t.type,e);else{if(null===e)throw Error("cannot pass null data when creating a NPOT tiled texture without NPOT support");e instanceof ArrayBuffer&&(e=new ImageData(new Uint8ClampedArray(e),this._width,this._height)),e instanceof ImageData&&((i=C3$jscomp$42.CreateCanvas(this._width,this._height)).getContext("2d").putImageData(e,0,0),e=i),(r=(i=C3$jscomp$42.CreateCanvas(C3$jscomp$42.nextHighestPowerOfTwo(this._width),C3$jscomp$42.nextHighestPowerOfTwo(this._height))).getContext("2d")).imageSmoothingEnabled="nearest"!==this._sampling,r.drawImage(e,0,0,this._width,this._height,0,0,i.width,i.height),s.texImage2D(s.TEXTURE_2D,0,t.internalformat,t.format,t.type,i)}null!==e&&this._SetTextureParameters(s),s.bindTexture(s.TEXTURE_2D,null),this._renderer._ResetLastTexture(),this._refCount=1,allTextures.add(this)}_CreateDynamic(e,t,s){if(s=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,s),this._texture)throw Error("already created texture");if(this._wrapX=s.wrapX,this._wrapY=s.wrapY,this._sampling=s.sampling,this._pixelFormat=s.pixelFormat,this._isMipMapped=!!s.mipMap&&this._renderer.AreMipmapsEnabled(),this._mipMapQuality=s.mipMapQuality,!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw Error("invalid mipmap quality");if(this._isStatic=!1,this._width=Math.floor(e),this._height=Math.floor(t),e=C3$jscomp$42.isPOT(this._width)&&C3$jscomp$42.isPOT(this._height),t=this._renderer.GetMaxTextureSize(),0>=this._width||0>=this._height)throw Error("invalid texture size");if(this._width>t||this._height>t)throw Error("texture exceeds maximum texture size");if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!e)throw Error("non-power-of-two tiled textures not supported");e=this._renderer.GetContext(),t=this._renderer.GetWebGLVersionNumber(),this._texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._texture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),s=GetFormatSpecifiers(this._pixelFormat,e),e.texImage2D(e.TEXTURE_2D,0,2<=t?s.sizedinternalformat:s.internalformat,this._width,this._height,0,s.format,s.type,null),this._SetTextureParameters(e),e.bindTexture(e.TEXTURE_2D,null),this._renderer._ResetLastTexture(),this._refCount=1,allTextures.add(this)}_GetMipMapHint(e){if("default"===this._mipMapQuality)return this._isStatic?e.NICEST:e.FASTEST;if("low"===this._mipMapQuality)return e.FASTEST;if("high"===this._mipMapQuality)return e.NICEST;throw Error("invalid mipmap quality")}_IsTiled(){return"clamp-to-edge"!==this._wrapX||"clamp-to-edge"!==this._wrapY}_GetTextureWrapMode(e,t){if("clamp-to-edge"===t)return e.CLAMP_TO_EDGE;if("repeat"===t)return e.REPEAT;if("mirror-repeat"===t)return e.MIRRORED_REPEAT;throw Error("invalid wrap mode")}_SetTextureParameters(e){var t=C3$jscomp$42.isPOT(this._width)&&C3$jscomp$42.isPOT(this._height);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this._GetTextureWrapMode(e,this._wrapX)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this._GetTextureWrapMode(e,this._wrapY)),"nearest"===this._sampling?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),this._isMipMapped=!1):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),(t||this._renderer.SupportsNPOTTextures())&&this._isMipMapped?(e.hint(e.GENERATE_MIPMAP_HINT,this._GetMipMapHint(e)),e.generateMipmap(e.TEXTURE_2D),t="trilinear"===this._sampling&&!this._renderer.HasMajorPerformanceCaveat(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.LINEAR_MIPMAP_NEAREST)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),this._isMipMapped=!1)),(t=this._renderer._GetAnisotropicExtension())&&0<this._anisotropy&&"nearest"!==this._sampling&&e.texParameterf(e.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this._anisotropy,this._renderer._GetMaxAnisotropy()))}_Update(e,t){if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||e instanceof ImageData))throw Error("invalid texture source");if(!this._texture||0>=this._refCount)throw Error("texture not created");if(this._isStatic)throw Error("cannot update static texture");t=Object.assign({},UPDATE_DEFAULT_OPTIONS,t);const s=e.width||e.videoWidth,i=e.height||e.videoHeight;var r=this._renderer.GetWebGLVersionNumber();const n=this._renderer.GetContext();n.bindTexture(n.TEXTURE_2D,this._texture),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!!t.flipY),t=GetFormatSpecifiers(this._pixelFormat,n),r=2<=r?t.sizedinternalformat:t.internalformat;try{if(this._width===s&&this._height===i){const s=C3$jscomp$42.isPOT(this._width)&&C3$jscomp$42.isPOT(this._height);n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.format,t.type,e),(s||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(n.hint(n.GENERATE_MIPMAP_HINT,this._GetMipMapHint(n)),n.generateMipmap(n.TEXTURE_2D))}else{this._width=s,this._height=i;const a=C3$jscomp$42.isPOT(this._width)&&C3$jscomp$42.isPOT(this._height);if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!a)throw Error("non-power-of-two tiled textures not supported");n.texImage2D(n.TEXTURE_2D,0,r,t.format,t.type,e),(a||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(n.hint(n.GENERATE_MIPMAP_HINT,this._GetMipMapHint(n)),n.generateMipmap(n.TEXTURE_2D))}}catch(e){}n.bindTexture(n.TEXTURE_2D,null),this._renderer._ResetLastTexture()}_Delete(){if(0<this._refCount)throw Error("texture still has references");if(!this._texture)throw Error("already deleted texture");allTextures.delete(this),this._renderer.GetContext().deleteTexture(this._texture),this._texture=null}IsValid(){return!!this._texture}_GetTexture(){return this._texture}GetRenderer(){return this._renderer}AddReference(){this._refCount++}SubtractReference(){if(0>=this._refCount)throw Error("no more references");this._refCount--}GetReferenceCount(){return this._refCount}GetWidth(){return this._width}GetHeight(){return this._height}IsStatic(){return this._isStatic}GetEstimatedMemoryUsage(){let e=this._width*this._height;switch(this._pixelFormat){case"rgba8":e*=4;break;case"rgb8":e*=3;break;case"rgba4":case"rgb5_a1":case"rgb565":e*=2}return this._isMipMapped&&(e+=Math.floor(e/3)),e}static OnContextLost(){allTextures.clear()}static allTextures(){return allTextures.values()}};const C3$jscomp$43=self.C3,glMatrix$jscomp$2=self.glMatrix,mat4$jscomp$3=glMatrix$jscomp$2.mat4,VALID_SAMPLINGS$jscomp$1=new Set(["nearest","bilinear","trilinear"]),DEFAULT_RENDERTARGET_OPTIONS={sampling:"trilinear",alpha:!0,depth:!1,isSampled:!0,isDefaultSize:!0,multisampling:0},allRenderTargets=new Set;C3$jscomp$43.Gfx.WebGLRenderTarget=class{constructor(e){this._renderer=e,this._renderBuffer=this._texture=this._frameBufferNoDepth=this._frameBuffer=null,this._height=this._width=0,this._isDefaultSize=!0,this._sampling="trilinear",this._alpha=!0,this._depth=!1,this._isSampled=!0,this._multisampling=0,this._projectionMatrix=mat4$jscomp$3.create(),this._lastFarZ=this._lastNearZ=this._lastFov=0}_Create(e,t,s){s=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,s);const i=this._renderer.GetWebGLVersionNumber();if(this._texture||this._renderBuffer)throw Error("already created render target");if(this._sampling=s.sampling,this._alpha=!!s.alpha,this._depth=!!s.depth,this._isSampled=!!s.isSampled,this._isDefaultSize=!!s.isDefaultSize,this._multisampling=s.multisampling,!VALID_SAMPLINGS$jscomp$1.has(this._sampling))throw Error("invalid sampling");if(0<this._multisampling&&(2>i||this._isSampled))throw Error("invalid use of multisampling");if(2>i&&(this._isSampled=!0),this._width=e,this._height=t,0>=this._width||0>=this._height)throw Error("invalid render target size");this._CalculateProjection(),e=this._renderer.GetContext(),this._frameBuffer=e.createFramebuffer(),this._depth&&(this._frameBufferNoDepth=e.createFramebuffer()),this._isSampled?(this._texture=this._renderer.CreateDynamicTexture(this._width,this._height,{sampling:this._sampling,pixelFormat:this._alpha?"rgba8":"rgb8",mipMap:!1}),t=this._texture._GetTexture(),e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))):(this._renderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this._renderBuffer),t=this._alpha?e.RGBA8:e.RGB8,0<this._multisampling&&((s=e.getInternalformatParameter(e.RENDERBUFFER,t,e.SAMPLES))&&s[0]?(s=s[0],this._multisampling>s&&(this._multisampling=s)):this._multisampling=0),0===this._multisampling?e.renderbufferStorage(e.RENDERBUFFER,t,this._width,this._height):e.renderbufferStorageMultisample(e.RENDERBUFFER,this._multisampling,t,this._width,this._height),e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,this._renderBuffer),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,this._renderBuffer)),e.bindRenderbuffer(e.RENDERBUFFER,null)),t=this._renderer._GetDepthBuffer(),this._depth&&t&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),this._renderer._CanSampleDepth()?e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,t,0):e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)),e.bindFramebuffer(e.FRAMEBUFFER,null),allRenderTargets.add(this)}_Resize(e,t){this._width===e&&this._height===t||(this._width=e,this._height=t,this._CalculateProjection(),(e=this._renderer.GetContext()).bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),this._texture?this._texture._Update(new ImageData(this._width,this._height)):(e.bindRenderbuffer(e.RENDERBUFFER,this._renderBuffer),e.renderbufferStorage(e.RENDERBUFFER,this._alpha?e.RGBA8:e.RGB8,this._width,this._height),e.bindRenderbuffer(e.RENDERBUFFER,null)),t=this._renderer._GetDepthBuffer(),this._depth&&t&&(this._renderer._CanSampleDepth()?e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,t,0):e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)),e.bindFramebuffer(e.FRAMEBUFFER,null))}_Delete(){if(!this._texture&&!this._renderBuffer)throw Error("already deleted render target");allRenderTargets.delete(this);var e=this._renderer.GetContext();this._texture?(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)),this._renderer.DeleteTexture(this._texture),this._texture=null):this._renderBuffer&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null)),e.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null),e.bindFramebuffer(e.FRAMEBUFFER,null),2<=this._renderer.GetWebGLVersionNumber()&&(e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)),e.deleteFramebuffer(this._frameBuffer),this._depth&&e.deleteFramebuffer(this._frameBufferNoDepth),(e=this._renderer.GetBatchState()).currentFramebuffer=null,this._frameBuffer=e.currentFramebufferNoDepth=null}_CalculateProjection(){this._renderer.CalculatePerspectiveMatrix(this._projectionMatrix,this._width/this._height),this._lastFov=this._renderer.GetFovY(),this._lastNearZ=this._renderer.GetNearZ(),this._lastFarZ=this._renderer.GetFarZ()}_GetFramebuffer(){return this._frameBuffer}_GetFramebufferNoDepth(){return this._frameBufferNoDepth}GetRenderer(){return this._renderer}GetTexture(){return this._texture}GetProjectionMatrix(){return this._renderer.GetFovY()===this._lastFov&&this._renderer.GetNearZ()===this._lastNearZ&&this._renderer.GetFarZ()===this._lastFarZ||this._CalculateProjection(),this._projectionMatrix}IsLinearSampling(){return"nearest"!==this._sampling}HasAlpha(){return this._alpha}IsSampled(){return this._isSampled}HasDepthBuffer(){return this._depth}GetWidth(){return this._width}GetHeight(){return this._height}IsDefaultSize(){return this._isDefaultSize}GetMultisampling(){return this._multisampling}GetOptions(){const e={sampling:this._sampling,alpha:this._alpha,isSampled:this._isSampled};return this._isDefaultSize||(e.width=this._width,e.height=this._height),e}IsCompatibleWithOptions(e){return!("nearest"!==(e=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,e)).sampling!==this.IsLinearSampling()||!!e.alpha!==this.HasAlpha()||!!e.depth!==this.HasDepthBuffer()||2<=this._renderer.GetWebGLVersionNumber()&&!!e.isSampled!==this.IsSampled())&&("number"==typeof e.width||"number"==typeof e.height?!this.IsDefaultSize()&&this.GetWidth()===e.width&&this.GetHeight()===e.height:this.IsDefaultSize())}_GetWebGLTexture(){return this._texture?this._texture._GetTexture():null}GetEstimatedMemoryUsage(){return this._texture?this._texture.GetEstimatedMemoryUsage():this._width*this._height*(this._alpha?4:3)}static async DebugReadPixelsToBlob(e,t){return e=await e.ReadBackRenderTargetToImageData(t,!0),await C3$jscomp$43.ImageDataToBlob(e)}static OnContextLost(){allRenderTargets.clear()}static allRenderTargets(){return allRenderTargets.values()}static ResizeAll(e,t){for(const s of allRenderTargets)s.IsDefaultSize()&&s._Resize(e,t)}};const C3$jscomp$44=self.C3,RESERVED_UNIFORM_NAMES=new Set("aPos aTex aPoints matP matMV samplerFront samplerBack samplerDepth destStart destEnd srcStart srcEnd srcOriginStart srcOriginEnd pixelSize seconds devicePixelRatio layerScale layerAngle layoutStart layoutEnd color color2_ pointTexStart pointTexEnd zElevation tileSize tileSpacing outlineThickness zNear zFar".split(" "));C3$jscomp$44.Gfx.WebGLShaderProgram=class extends C3$jscomp$44.Gfx.ShaderProgramBase{static async Compile(e,t,s,i){const r=e.GetContext(),n=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(n,t),r.compileShader(n),t=r.createShader(r.VERTEX_SHADER),r.shaderSource(t,s),r.compileShader(t);const a=r.createProgram();r.attachShader(a,n),r.attachShader(a,t),r.bindAttribLocation(a,0,"aPos"),r.bindAttribLocation(a,1,"aTex"),r.bindAttribLocation(a,2,"aPoints"),r.linkProgram(a);const o=e._GetParallelShaderCompileExtension();if(o?await e._WaitForObjectReady((()=>r.getProgramParameter(a,o.COMPLETION_STATUS_KHR))):await C3$jscomp$44.Wait(5),!r.getShaderParameter(n,r.COMPILE_STATUS))throw i=r.getShaderInfoLog(n),r.deleteShader(n),r.deleteShader(t),r.deleteProgram(a),Error("Error compiling fragment shader: "+i);if(!r.getShaderParameter(t,r.COMPILE_STATUS))throw i=r.getShaderInfoLog(t),r.deleteShader(n),r.deleteShader(t),r.deleteProgram(a),Error("Error compiling vertex shader: "+i);if(!r.getProgramParameter(a,r.LINK_STATUS))throw i=r.getProgramInfoLog(a),r.deleteShader(n),r.deleteShader(t),r.deleteProgram(a),Error("Error linking shader program: "+i);return(e=C3$jscomp$44.FilterUnprintableChars(r.getProgramInfoLog(a)||"").trim())&&C3$jscomp$44.IsStringAllWhitespace(e),r.deleteShader(n),r.deleteShader(t),a}static async Create(e,t,s,i){return s=await C3$jscomp$44.Gfx.WebGLShaderProgram.Compile(e,t.src,s,i),new C3$jscomp$44.Gfx.WebGLShaderProgram(e,s,t,i)}constructor(e,t,s,i){super(e,i,s);const r=e.GetContext();var n=e.GetBatchState();e.EndBatch(),r.useProgram(t),this._gl=r,this._shaderProgram=t,this._isDeviceTransform="<default-device-transform>"===i,i=r.getAttribLocation(t,"aPos");const a=r.getAttribLocation(t,"aTex");this._locAPoints=r.getAttribLocation(t,"aPoints"),-1!==i&&(r.bindBuffer(r.ARRAY_BUFFER,e._vertexBuffer),r.vertexAttribPointer(i,e.GetNumVertexComponents(),r.FLOAT,!1,0,0),r.enableVertexAttribArray(i)),-1!==a&&(r.bindBuffer(r.ARRAY_BUFFER,e._texcoordBuffer),r.vertexAttribPointer(a,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(a)),-1!==this._locAPoints&&(r.bindBuffer(r.ARRAY_BUFFER,e._pointBuffer),r.vertexAttribPointer(this._locAPoints,4,r.FLOAT,!1,0,0),r.enableVertexAttribArray(this._locAPoints)),r.bindBuffer(r.ARRAY_BUFFER,null),this._uMatP=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"matP","mat4"),this._uMatMV=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"matMV","mat4"),this._uColor=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"color","vec4"),this._uSamplerFront=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"samplerFront","sampler"),this._uPointTexStart=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"pointTexStart","vec2"),this._uPointTexEnd=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"pointTexEnd","vec2"),this._uZElevation=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"zElevation","float"),this._uTileSize=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"tileSize","vec2"),this._uTileSpacing=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"tileSpacing","vec2"),this._uColor2=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"color2_","vec4"),this._uOutlineThickness=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"outlineThickness","float"),this._uSamplerBack=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"samplerBack","sampler"),this._uSamplerDepth=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"samplerDepth","sampler"),this._uDestStart=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"destStart","vec2"),this._uDestEnd=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"destEnd","vec2"),this._uSrcStart=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"srcStart","vec2"),this._uSrcEnd=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"srcEnd","vec2"),this._uSrcOriginStart=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"srcOriginStart","vec2"),this._uSrcOriginEnd=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"srcOriginEnd","vec2"),this._uPixelSize=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"pixelSize","vec2"),this._uSeconds=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"seconds","float"),this._uDevicePixelRatio=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"devicePixelRatio","float"),this._uLayerScale=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"layerScale","float"),this._uLayerAngle=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"layerAngle","float"),this._uLayoutStart=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"layoutStart","vec2"),this._uLayoutEnd=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"layoutEnd","vec2"),this._uZNear=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"zNear","float"),this._uZFar=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,"zFar","float"),this._hasAnyOptionalUniforms=!!(this._uPixelSize.IsUsed()||this._uSeconds.IsUsed()||this._uSamplerBack.IsUsed()||this._uDestStart.IsUsed()||this._uDestEnd.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed()||this._uDevicePixelRatio.IsUsed()||this._uLayerScale.IsUsed()||this._uLayerAngle.IsUsed()||this._uLayoutStart.IsUsed()||this._uLayoutEnd.IsUsed()),t=s.parameters||[],this._uCustomParameters=[],this._usesAnySrcRectOrPixelSize=this._uPixelSize.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed(),this._hasCurrentMatMV=this._hasCurrentMatP=!1,this._uColor.Init4f(1,1,1,1),this._uColor2.Init4f(1,1,1,1),this._uSamplerFront.Init1i(0),this._uSamplerBack.Init1i(1),this._uSamplerDepth.Init1i(2),this._uPointTexStart.Init2f(0,0),this._uPointTexEnd.Init2f(1,1),this._uZElevation.Init1f(0),this._uTileSize.Init2f(0,0),this._uTileSpacing.Init2f(0,0),this._uDestStart.Init2f(0,0),this._uDestEnd.Init2f(1,1),this._uSrcStart.Init2f(0,0),this._uSrcEnd.Init2f(0,0),this._uSrcOriginStart.Init2f(0,0),this._uSrcOriginEnd.Init2f(0,0),this._uPixelSize.Init2f(0,0),this._uDevicePixelRatio.Init1f(1),this._uZNear.Init1f(e.GetNearZ()),this._uZFar.Init1f(e.GetFarZ()),this._uLayerScale.Init1f(1),this._uLayerAngle.Init1f(0),this._uSeconds.Init1f(0),this._uLayoutStart.Init2f(0,0),this._uLayoutEnd.Init2f(0,0),this._uOutlineThickness.Init1f(1);for(const s of t)e=s[2],t=new C3$jscomp$44.Gfx.WebGLShaderUniform(this,s[0],e),"color"===e?t.Init3f(0,0,0):t.Init1f(0),this._uCustomParameters.push(t);this._isDeviceTransform?this._UpdateDeviceTransformUniforms(n.currentMatP):(this.UpdateMatP(n.currentMatP,!0),this.UpdateMatMV(n.currentMV,!0)),n=n.currentShader,r.useProgram(n?n._shaderProgram:null)}Release(){this._gl.deleteProgram(this._shaderProgram),this._shaderProgram=null,this._renderer._RemoveShaderProgram(this),this._gl=null,super.Release()}GetWebGLContext(){return this._gl}GetShaderProgram(){return this._shaderProgram}GetParameterCount(){return this._uCustomParameters.length}GetParameterType(e){return 0>e||e>=this._uCustomParameters.length?null:this._uCustomParameters[e].GetType()}AreCustomParametersAlreadySetInBatch(e){for(let t=0,s=e.length;t<s;++t)if(!this._uCustomParameters[t].IsSetToCustomInBatch(e[t]))return!1;return!0}SetCustomParametersInBatch(e){for(let t=0,s=e.length;t<s;++t)this._uCustomParameters[t].SetBatchValueCustom(e[t])}AreOptionalUniformsAlreadySetInBatch(e,t,s,i,r,n,a,o,h,l){return!(this._uSamplerBack.IsUsed()||this._uPixelSize.IsUsed()&&!this._uPixelSize.IsSetTo2InBatch(r,n)||this._uDestStart.IsUsed()&&!this._uDestStart.IsSetTo2InBatch(e.getLeft(),e.getTop())||this._uDestEnd.IsUsed()&&!this._uDestEnd.IsSetTo2InBatch(e.getRight(),e.getBottom())||this._uDevicePixelRatio.IsUsed()&&!this._uDevicePixelRatio.IsSetTo1InBatch(a)||this._uLayerScale.IsUsed()&&!this._uLayerScale.IsSetTo1InBatch(o)||this._uLayerAngle.IsUsed()&&!this._uLayerAngle.IsSetTo1InBatch(h)||this._uSrcStart.IsUsed()&&!this._uSrcStart.IsSetTo2InBatch(t.getLeft(),t.getTop())||this._uSrcEnd.IsUsed()&&!this._uSrcEnd.IsSetTo2InBatch(t.getRight(),t.getBottom())||this._uSrcOriginStart.IsUsed()&&!this._uSrcOriginStart.IsSetTo2InBatch(s.getLeft(),s.getTop())||this._uSrcOriginEnd.IsUsed()&&!this._uSrcOriginEnd.IsSetTo2InBatch(s.getRight(),s.getBottom())||this._uLayoutStart.IsUsed()&&!this._uLayoutStart.IsSetTo2InBatch(i.getLeft(),i.getTop())||this._uLayoutEnd.IsUsed()&&!this._uLayoutEnd.IsSetTo2InBatch(i.getTop(),i.getBottom())||this._uSeconds.IsUsed()&&!this._uSeconds.IsSetTo1InBatch(l))}SetOptionalUniformsInBatch(e,t,s,i,r,n,a,o,h,l){this._uSamplerBack.IsUsed()||(this._uPixelSize.IsUsed()&&this._uPixelSize.SetBatch2(r,n),this._uDestStart.IsUsed()&&this._uDestStart.SetBatch2(e.getLeft(),e.getTop()),this._uDestEnd.IsUsed()&&this._uDestEnd.SetBatch2(e.getRight(),e.getBottom()),this._uDevicePixelRatio.IsUsed()&&this._uDevicePixelRatio.SetBatch1(a),this._uLayerScale.IsUsed()&&this._uLayerScale.SetBatch1(o),this._uLayerAngle.IsUsed()&&this._uLayerAngle.SetBatch1(h),this._uSrcStart.IsUsed()&&this._uSrcStart.SetBatch2(t.getLeft(),t.getTop()),this._uSrcEnd.IsUsed()&&this._uSrcEnd.SetBatch2(t.getRight(),t.getBottom()),this._uSrcOriginStart.IsUsed()&&this._uSrcOriginStart.SetBatch2(s.getLeft(),s.getTop()),this._uSrcOriginEnd.IsUsed()&&this._uSrcOriginEnd.SetBatch2(s.getRight(),s.getBottom()),this._uLayoutStart.IsUsed()&&this._uLayoutStart.SetBatch2(i.getLeft(),i.getTop()),this._uLayoutEnd.IsUsed()&&this._uLayoutEnd.SetBatch2(i.getTop(),i.getBottom()),this._uSeconds.IsUsed()&&this._uSeconds.SetBatch1(l))}UpdateMatP(e,t){this._hasCurrentMatP&&!t||this._isDeviceTransform||(this._uMatP.IsUsed()&&this._uMatP.UpdateMatrix4fv(e),this._hasCurrentMatP=!0)}SetMatPStale(){this._hasCurrentMatP=!1}UpdateMatMV(e,t){this._hasCurrentMatMV&&!t||this._isDeviceTransform||(this._uMatMV.IsUsed()&&this._uMatMV.UpdateMatrix4fv(e),this._hasCurrentMatMV=!0)}SetMatMVStale(){this._hasCurrentMatMV=!1}_UpdateDeviceTransformUniforms(e){if(!this._isDeviceTransform)throw Error("not device transform shader");this._uMatP.UpdateMatrix4fv(e);const t=(e=this._renderer).GetWidth()/2,s=e.GetHeight()/2;e=e.CalculateLookAtModelView2(t,s,e.GetDefaultCameraZ(e.GetHeight()),t,s,0,e.GetHeight()),this._uMatMV.UpdateMatrix4fv(e)}UpdateColor(e){this._uColor.IsUsed()&&this._uColor.Update4f(e[0],e[1],e[2],e[3])}static GetReservedUniformNames(){return RESERVED_UNIFORM_NAMES}static GetDefaultVertexShaderSource(e){return["#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nattribute highp vec3 aPos;",`attribute ${e=e?"highmedp":"mediump"} vec2 aTex;`,`varying ${e} vec2 vTex;`,"uniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos, 1.0);\n\tvTex = aTex;\n}"].join("\n")}static GetDefaultVertexShaderSource_WebGL2(e){return["#version 300 es\nin highp vec3 aPos;",`in ${e=e?"highp":"mediump"} vec2 aTex;`,`out ${e} vec2 vTex;`,"uniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos, 1.0);\n\tvTex = aTex;\n}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex) * color;\n}"}static GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(){return"#extension GL_EXT_frag_depth : enable\nvarying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex) * color;\n\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetTextureFillFragmentShaderSource_WebGL2(){return"#version 300 es\nin mediump vec2 vTex;\nout lowp vec4 outColor;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\toutColor = texture(samplerFront, vTex) * color;\n\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(){return"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nvarying highmedp vec2 vTex;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nuniform highmedp vec2 srcStart;\nuniform highmedp vec2 pixelSize;\nuniform highmedp vec2 tileSize;\nuniform highmedp vec2 tileSpacing;\nvoid main(void) {\n\thighmedp vec2 tile = floor(vTex);\n\thighmedp vec2 tex = fract(vTex);\n\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);\n\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;\n\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;\n\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;\n}"}static GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(){return"#extension GL_EXT_frag_depth : enable\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nvarying highmedp vec2 vTex;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nuniform highmedp vec2 srcStart;\nuniform highmedp vec2 pixelSize;\nuniform highmedp vec2 tileSize;\nuniform highmedp vec2 tileSpacing;\nvoid main(void) {\n\thighmedp vec2 tile = floor(vTex);\n\thighmedp vec2 tex = fract(vTex);\n\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);\n\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;\n\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;\n\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;\n\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetTilemapFragmentShaderSource_WebGL2(){return"#version 300 es\nin highp vec2 vTex;\nout lowp vec4 outColor;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nuniform highp vec2 srcStart;\nuniform highp vec2 pixelSize;\nuniform highp vec2 tileSize;\nuniform highp vec2 tileSpacing;\nvoid main(void) {\n\thighp vec2 tile = floor(vTex);\n\thighp vec2 tex = fract(vTex);\n\thighp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);\n\thighp vec2 lowerBound = tileOrigin + pixelSize / 2.0;\n\thighp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;\n\toutColor = texture(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;\n\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetTileRandomizationFragmentShaderSource(e,t,s){let i="";return 2<=e?i="#version 300 es\n":(t&&(i="#extension GL_EXT_frag_depth : enable\n"),s&&(i+="#extension GL_EXT_shader_texture_lod : enable\n#extension GL_OES_standard_derivatives : enable\n")),i+`\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision highmedp float;\n${2<=e?"in":"varying"} vec2 vTex;\n${2<=e?"out lowp vec4 outColor;":""}\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nuniform vec2 pixelSize;\n\nuniform vec2 tileSize;\nuniform vec2 tileSpacing;\nuniform float outlineThickness;\n\nconst float PI = 3.1415926;\n\nlowp vec4 cospVec4(lowp vec4 a, lowp vec4 b, float x)\n{\n\treturn (a + b + (a - b) * cos(x * PI)) / 2.0;\n}\n\nvec3 randVec3(vec2 seed)\n{\n\treturn vec3(fract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(12.9898,78.233))) * 43758.5453),\n\t\t\t\tfract(sin(dot(seed.yx + vec2(0.1, 0.1), vec2(12.9898,-78.233))) * 43758.5453),\n\t\t\t\tfract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(-12.9898,-78.233))) * 43758.5453));\n}\n\nlowp vec4 sampleTile(vec2 tile, vec2 uv, vec2 ddx, vec2 ddy)\n{\n\tvec2 posRandom = tileSize;\n\tfloat angleRandom = outlineThickness;\n\t\n\tvec3 rand = (randVec3(floor(tile + 0.5)) - 0.5) * 2.0;\n\t\n\tfloat angle = angleRandom * rand.z * PI;\n\tfloat sin_a = sin(angle);\n\tfloat cos_a = cos(angle);\n\tfloat aspect = pixelSize.x / pixelSize.y;\n\n\tvec2 mid = tile + vec2(0.5, 0.5);\n\tvec2 dp = uv - mid;\n\tdp.x /= aspect;\n\tvec2 r = vec2(dp.x * cos_a - dp.y * sin_a,\n\t\t\t\t  dp.y * cos_a + dp.x * sin_a);\n\tr.x *= aspect;\n\n\tvec2 p = mid + r + (posRandom * rand.xy / 2.0);\n\t\n\t${2<=e?"return textureGrad(samplerFront, p, ddx, ddy);":""}\n\t${2>e&&s?"return texture2DGradEXT(samplerFront, p, ddx, ddy);":""}\n\t${2>e&&!s?"return texture2D(samplerFront, p);":""}\n}\n\nvoid main(void) {\n\t\n\t${2>e?"lowp vec4 outColor;":""}\n\t\n\tfloat blendMarginX = tileSpacing.x;\n\tfloat blendMarginY = tileSpacing.y;\n\t\n\tvec2 tile = floor(vTex);\n\tvec2 tex = fract(vTex);\n\tvec2 ddx = ${2<=e||s?"dFdx(vTex)":"vec2(0.0, 0.0)"};\n\tvec2 ddy = ${2<=e||s?"dFdy(vTex)":"vec2(0.0, 0.0)"};\n\t\n\tvec4 curTile = sampleTile(tile, vTex, ddx, ddy);\n\t\n\tbool inLeftMargin = (tex.x < blendMarginX);\n\tbool inRightMargin = (tex.x > 1.0 - blendMarginX);\n\tbool inTopMargin = (tex.y < blendMarginY);\n\tbool inBottomMargin = (tex.y > 1.0 - blendMarginY);\n\t\n\tif (inLeftMargin)\n\t{\n\t\tlowp vec4 leftTile = sampleTile(tile + vec2(-1.0, 0.0), vTex, ddx, ddy);\n\t\tfloat leftMix = (tex.x / (blendMarginX * 2.0)) + 0.5;\n\t\tlowp vec4 leftMixedTile = cospVec4(leftTile, curTile, leftMix);\n\t\t\n\t\tif (inTopMargin)\n\t\t{\n\t\t\tlowp vec4 topTile =     sampleTile(tile + vec2(0.0,  -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topLeftTile = sampleTile(tile + vec2(-1.0, -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topLeftMixedTile = cospVec4(topLeftTile, topTile, leftMix);\n\t\t\t\n\t\t\toutColor = cospVec4(topLeftMixedTile, leftMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);\n\t\t}\n\t\telse if (inBottomMargin)\n\t\t{\n\t\t\tlowp vec4 bottomTile =     sampleTile(tile + vec2(0.0,  1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomLeftTile = sampleTile(tile + vec2(-1.0, 1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomLeftMixedTile = cospVec4(bottomLeftTile, bottomTile, leftMix);\n\t\t\t\n\t\t\toutColor = cospVec4(leftMixedTile, bottomLeftMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));\n\t\t}\n\t\telse\n\t\t{\n\t\t\toutColor = leftMixedTile;\n\t\t}\n\t}\n\telse if (inRightMargin)\n\t{\n\t\tlowp vec4 rightTile = sampleTile(tile + vec2(1.0, 0.0), vTex, ddx, ddy);\n\t\tfloat rightMix = (tex.x - (1.0 - blendMarginX)) / (blendMarginX * 2.0);\n\t\tlowp vec4 rightMixedTile = cospVec4(curTile, rightTile, rightMix);\n\t\t\n\t\tif (inTopMargin)\n\t\t{\n\t\t\tlowp vec4 topTile =      sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topRightTile = sampleTile(tile + vec2(1.0, -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topRightMixedTile = cospVec4(topTile, topRightTile, rightMix);\n\t\t\t\n\t\t\toutColor = cospVec4(topRightMixedTile, rightMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);\n\t\t}\n\t\telse if (inBottomMargin)\n\t\t{\n\t\t\tlowp vec4 bottomTile =      sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomRightTile = sampleTile(tile + vec2(1.0, 1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomRightMixedTile = cospVec4(bottomTile, bottomRightTile, rightMix);\n\t\t\t\n\t\t\toutColor = cospVec4(rightMixedTile, bottomRightMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));\n\t\t}\n\t\telse\n\t\t{\n\t\t\toutColor = rightMixedTile;\n\t\t}\n\t}\n\telse if (inTopMargin)\n\t{\n\t\tlowp vec4 topTile = sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);\n\t\toutColor = cospVec4(topTile, curTile, (tex.y / (blendMarginY * 2.0)) + 0.5);\n\t}\n\telse if (inBottomMargin)\n\t{\n\t\tlowp vec4 bottomTile = sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);\n\t\toutColor = cospVec4(curTile, bottomTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));\n\t}\n\telse\n\t{\n\t\toutColor = curTile;\n\t}\n\t\n\toutColor *= color;\n\t${2>e?"gl_FragColor = outColor;":""}\n\t${2<=e?"gl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":""}\n\t${2>e&&t?"gl_FragDepthEXT = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":""}\n}\n`}static GetPointVertexShaderSource_WebGL1(){return"attribute vec4 aPoints;\nvarying float pointOpacity;\nuniform float zElevation;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);\n\tgl_PointSize = aPoints.z;\n\tpointOpacity = aPoints.w;\n}"}static GetPointVertexShaderSource_WebGL2(){return"#version 300 es\nin vec4 aPoints;\nout float pointOpacity;\nuniform float zElevation;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);\n\tgl_PointSize = aPoints.z;\n\tpointOpacity = aPoints.w;\n}"}static GetPointFragmentShaderSource_WebGL1_NoFragDepth(){return"uniform lowp sampler2D samplerFront;\nvarying lowp float pointOpacity;\nuniform mediump vec2 pointTexStart;\nuniform mediump vec2 pointTexEnd;\nuniform lowp vec4 color;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, mix(pointTexStart, pointTexEnd, gl_PointCoord)) * color * pointOpacity;\n}"}static GetPointFragmentShaderSource_WebGL1_FragDepthEXT(){return"#extension GL_EXT_frag_depth : enable\nuniform lowp sampler2D samplerFront;\nvarying lowp float pointOpacity;\nuniform mediump vec2 pointTexStart;\nuniform mediump vec2 pointTexEnd;\nuniform lowp vec4 color;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, mix(pointTexStart, pointTexEnd, gl_PointCoord)) * color * pointOpacity;\n\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetPointFragmentShaderSource_WebGL2(){return"#version 300 es\nuniform lowp sampler2D samplerFront;\nin lowp float pointOpacity;\nuniform mediump vec2 pointTexStart;\nuniform mediump vec2 pointTexEnd;\nuniform lowp vec4 color;\nout lowp vec4 outColor;\nvoid main(void) {\n\toutColor = texture(samplerFront, mix(pointTexStart, pointTexEnd, gl_PointCoord)) * color * pointOpacity;\n\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetColorFillFragmentShaderSource(){return"uniform lowp vec4 color;\nvoid main(void) {\n\tgl_FragColor = color;\n}"}static GetLinearGradientFillFragmentShaderSource(){return"precision lowp float;\nvarying mediump vec2 vTex;\nuniform vec4 color;\nuniform vec4 color2_;\nvec3 fromLinear(vec3 linearRGB)\n{\n\tbvec3 cutoff = lessThan(linearRGB, vec3(0.0031308));\n\tvec3 higher = vec3(1.055) * pow(abs(linearRGB), vec3(1.0/2.4)) - vec3(0.055);\n\tvec3 lower = linearRGB * vec3(12.92);\n\treturn mix(higher, lower, vec3(cutoff));\n}\nvec3 toLinear(vec3 sRGB)\n{\n\tbvec3 cutoff = lessThan(sRGB, vec3(0.04045));\n\tvec3 higher = pow(abs((sRGB + vec3(0.055))/vec3(1.055)), vec3(2.4));\n\tvec3 lower = sRGB/vec3(12.92);\n\treturn mix(higher, lower, vec3(cutoff));\n}\nvoid main(void) {\n\tvec3 linearGrad = mix(toLinear(color.rgb), toLinear(color2_.rgb), vTex.x);\n\tfloat a = mix(color.a, color2_.a, vTex.x);\n\tgl_FragColor = vec4(fromLinear(linearGrad) * a, a);\n}"}static GetPenumbraFillFragmentShaderSource(){return"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision lowp float;\nvarying highmedp vec2 vTex;\nuniform vec4 color;\nvoid main(void) {\n\thighmedp float grad = vTex.x / (1.0 - vTex.y);\n\tgl_FragColor = color * (1.0 - (cos(grad * 3.141592653589793) + 1.0) / 2.0);\n}"}static GetSmoothLineFillFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nvoid main(void) {\n\tlowp float f = 1.0 - abs(vTex.y - 0.5) * 2.0;\n\tgl_FragColor = color * f;\n}"}static GetHardEllipseFillFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump float f = step(diffSq.x + diffSq.y, 0.25);\n\tgl_FragColor = color * f;\n}"}static GetHardEllipseOutlineFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform mediump vec2 pixelSize;\nuniform mediump float outlineThickness;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump float distSq = diffSq.x + diffSq.y;\n\tmediump vec2 norm = normalize(diff);\n\tmediump vec2 halfNorm = norm * 0.5;\n\tmediump float innerF = step(distSq, 0.25);\n\tmediump vec2 innerEdge = halfNorm - pixelSize * norm * outlineThickness;\n\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;\n\tmediump float outerF = step(innerEdgeSq.x + innerEdgeSq.y, distSq);\n\tgl_FragColor = color * innerF * outerF;\n}"}static GetSmoothEllipseFillFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform mediump vec2 pixelSize;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump vec2 norm = normalize(diff);\n\tmediump vec2 halfNorm = norm * 0.5;\n\tmediump vec2 halfNormSq = halfNorm * halfNorm;\n\tmediump vec2 innerEdge = halfNorm - pixelSize * norm;\n\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;\n\tmediump float f = smoothstep(halfNormSq.x + halfNormSq.y, innerEdgeSq.x + innerEdgeSq.y, diffSq.x + diffSq.y);\n\tgl_FragColor = color * f;\n}"}static GetSmoothEllipseOutlineFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform mediump vec2 pixelSize;\nuniform mediump float outlineThickness;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump float distSq = diffSq.x + diffSq.y;\n\tmediump vec2 norm = normalize(diff);\n\tmediump vec2 halfNorm = norm * 0.5;\n\tmediump vec2 halfNormSq = halfNorm * halfNorm;\n\tmediump vec2 pxNorm = pixelSize * norm;\n\tmediump vec2 innerEdge1 = halfNorm - pxNorm;\n\tmediump vec2 innerEdge1Sq = innerEdge1 * innerEdge1;\n\tmediump float innerF = smoothstep(halfNormSq.x + halfNormSq.y, innerEdge1Sq.x + innerEdge1Sq.y, distSq);\n\tmediump vec2 innerEdge2 = halfNorm - pxNorm * outlineThickness;\n\tmediump vec2 innerEdge2Sq = innerEdge2 * innerEdge2;\n\tmediump vec2 innerEdge3 = halfNorm - pxNorm * (outlineThickness + 1.0);\n\tmediump vec2 innerEdge3Sq = innerEdge3 * innerEdge3;\n\tmediump float outerF = smoothstep(innerEdge3Sq.x + innerEdge3Sq.y, innerEdge2Sq.x + innerEdge2Sq.y, distSq);\n\tgl_FragColor = color * innerF * outerF;\n}"}};const C3$jscomp$45=self.C3,mat4$jscomp$5=self.glMatrix.mat4,TYPE_SIZES=new Map([["float",1],["percent",1],["sampler",1],["vec2",2],["vec3",3],["color",3],["vec4",4],["mat4",16]]);C3$jscomp$45.Gfx.WebGLShaderUniform=class{constructor(e,t,s){if(!TYPE_SIZES.has(s))throw Error("invalid uniform type");this._owner=e,this._gl=this._owner.GetWebGLContext(),this._name=t,this._type=s,this._isColorType="color"===this._type,this._location=this._gl.getUniformLocation(this._owner.GetShaderProgram(),t),this._isUsed=!!this._location,e=TYPE_SIZES.get(s),this._lastValue=new Float32Array(e),this._lastBatchValue=new Float32Array(e)}Release(){this._location=this._gl=this._owner=null}IsUsed(){return this._isUsed}GetType(){return this._type}IsColorType(){return this._isColorType}Init1f(e){this.IsUsed()&&(this._lastValue[0]=e,this._lastBatchValue.set(this._lastValue),this._gl.uniform1f(this._location,e))}Init1i(e){this.IsUsed()&&(this._lastValue[0]=e,this._lastBatchValue.set(this._lastValue),this._gl.uniform1i(this._location,e))}Init2f(e,t){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastBatchValue.set(this._lastValue),this._gl.uniform2f(this._location,e,t))}Init3f(e,t,s){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastValue[2]=s,this._lastBatchValue.set(this._lastValue),this._gl.uniform3f(this._location,e,t,s))}Init4f(e,t,s,i){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastValue[2]=s,this._lastValue[3]=i,this._lastBatchValue.set(this._lastValue),this._gl.uniform4f(this._location,e,t,s,i))}Update1f(e){e=Math.fround(e);const t=this._lastValue;t[0]!==e&&(t[0]=e,this._gl.uniform1f(this._location,e))}Update1i(e){const t=this._lastValue;t[0]!==e&&(t[0]=e,this._gl.uniform1i(this._location,e))}Update2f(e,t){e=Math.fround(e),t=Math.fround(t);const s=this._lastValue;s[0]===e&&s[1]===t||(s[0]=e,s[1]=t,this._gl.uniform2f(this._location,e,t))}Update3f(e,t,s){e=Math.fround(e),t=Math.fround(t),s=Math.fround(s);const i=this._lastValue;i[0]===e&&i[1]===t&&i[2]===s||(i[0]=e,i[1]=t,i[2]=s,this._gl.uniform3f(this._location,e,t,s))}Update4f(e,t,s,i){e=Math.fround(e),t=Math.fround(t),s=Math.fround(s),i=Math.fround(i);const r=this._lastValue;r[0]===e&&r[1]===t&&r[2]===s&&r[3]===i||(r[0]=e,r[1]=t,r[2]=s,r[3]=i,this._gl.uniform4f(this._location,e,t,s,i))}UpdateMatrix4fv(e){const t=this._lastValue;mat4$jscomp$5.exactEquals(t,e)||(C3$jscomp$45.typedArraySet16(t,e,0),this._gl.uniformMatrix4fv(this._location,!1,e))}IsSetToCustomInBatch(e){const t=this._lastBatchValue;return this.IsColorType()?t[0]===Math.fround(e.getR())&&t[1]===Math.fround(e.getG())&&t[2]===Math.fround(e.getB()):t[0]===Math.fround(e)}SetBatchValueCustom(e){const t=this._lastBatchValue;this.IsColorType()?(t[0]=e.getR(),t[1]=e.getG(),t[2]=e.getB()):t[0]=e}IsSetTo1InBatch(e){return this._lastBatchValue[0]===Math.fround(e)}IsSetTo2InBatch(e,t){const s=this._lastBatchValue;return s[0]===Math.fround(e)&&s[1]===Math.fround(t)}SetBatch1(e){this._lastBatchValue[0]=e}SetBatch2(e,t){const s=this._lastBatchValue;s[0]=e,s[1]=t}};const C3$jscomp$46=self.C3,glMatrix$jscomp$5=self.glMatrix,vec4$jscomp$3=glMatrix$jscomp$5.vec4,mat4$jscomp$6=glMatrix$jscomp$5.mat4;C3$jscomp$46.Gfx.BatchState=class{constructor(e){this.renderer=e,this.currentMV=mat4$jscomp$6.create(),this.currentMatP=mat4$jscomp$6.create(),this.currentFramebufferNoDepth=this.currentFramebuffer=null,this.isDepthSamplingEnabled=!1,this.currentColor=vec4$jscomp$3.fromValues(1,1,1,1),this.currentShader=null,this.pointTexCoords=new C3$jscomp$46.Rect,this.clearColor=C3$jscomp$46.New(C3$jscomp$46.Color,0,0,0,0)}},C3$jscomp$46.Gfx.WebGLBatchJob=class{constructor(e){const t=new ArrayBuffer(96);this._type=0,this._batchState=e,this._gl=e.renderer.GetContext(),this._indexCount=this._startIndex=0,this._texParam=null,this._mat4param=new Float32Array(t,0,16),this._colorParam=new Float32Array(t,64,4),this._srcOriginRect=new Float32Array(t,80,4),this._shaderParams=[]}InitQuad(e,t){this._type=1,this._startIndex=e,this._indexCount=t}DoQuad(){const e=this._gl;e.drawElements(e.TRIANGLES,this._indexCount,e.UNSIGNED_SHORT,this._startIndex)}InitSetTexture(e){this._type=2,this._texParam=e}DoSetTexture(){const e=this._gl,t=this._texParam;e.bindTexture(e.TEXTURE_2D,t?t._GetTexture():null)}InitSetColor(e){this._type=3,e.writeToTypedArray(this._colorParam,0)}DoSetColor(){const e=this._colorParam,t=this._batchState;vec4$jscomp$3.copy(t.currentColor,e),t.currentShader.UpdateColor(e)}InitSetGradientColor(e){this._type=21,e.writeToTypedArray(this._colorParam,0)}DoSetGradientColor(){const e=this._colorParam,t=this._batchState.currentShader;t._uColor2.IsUsed()&&t._uColor2.Update4f(e[0],e[1],e[2],e[3])}InitSetBlend(e,t){this._type=4,this._startIndex=e,this._indexCount=t}DoSetBlend(){this._gl.blendFunc(this._startIndex,this._indexCount)}InitSetViewport(e,t,s,i){this._type=5;const r=this._colorParam;r[0]=e,r[1]=t,r[2]=s,r[3]=i}DoSetViewport(){const e=this._colorParam;this._gl.viewport(e[0],e[1],e[2],e[3])}InitSetProjection(e){this._type=6,mat4$jscomp$6.copy(this._mat4param,e)}DoSetProjection(){const e=this._batchState,t=e.renderer._allShaderPrograms,s=e.currentShader,i=this._mat4param;for(let e=0,r=t.length;e<r;++e){const r=t[e];r===s?r.UpdateMatP(i,!0):r.SetMatPStale()}mat4$jscomp$6.copy(e.currentMatP,i)}InitSetModelView(e){this._type=7,mat4$jscomp$6.copy(this._mat4param,e)}DoSetModelView(){const e=this._batchState,t=e.renderer._allShaderPrograms,s=e.currentShader,i=this._mat4param;for(let e=0,r=t.length;e<r;++e){const r=t[e];r===s?r.UpdateMatMV(i,!0):r.SetMatMVStale()}mat4$jscomp$6.copy(e.currentMV,i)}InitSetRenderTarget(e){this._type=8,this._texParam=e}DoSetRenderTarget(){const e=this._gl,t=this._texParam,s=this._batchState;t?(s.currentFramebuffer=t._GetFramebuffer(),s.currentFramebufferNoDepth=t._GetFramebufferNoDepth(),s.isDepthSamplingEnabled&&s.currentFramebufferNoDepth?e.bindFramebuffer(e.FRAMEBUFFER,s.currentFramebufferNoDepth):e.bindFramebuffer(e.FRAMEBUFFER,s.currentFramebuffer)):(s.currentFramebuffer=null,s.currentFramebufferNoDepth=null,e.bindFramebuffer(e.FRAMEBUFFER,null))}InitClearSurface(e){this._type=9,e.writeToTypedArray(this._mat4param,0)}InitClearSurface2(e,t,s,i){this._type=9;const r=this._mat4param;r[0]=e,r[1]=t,r[2]=s,r[3]=i}DoClearSurface(){const e=this._gl;var t=this._mat4param;const s=this._batchState.clearColor,i=t[0],r=t[1],n=t[2];t=t[3],s.equalsRgba(i,r,n,t)||(e.clearColor(i,r,n,t),s.setRgba(i,r,n,t)),e.clear(e.COLOR_BUFFER_BIT)}InitSetPointTexCoords(e){this._type=15,e.writeToTypedArray(this._mat4param,0)}DoSetPointTextureCoords(){const e=this._mat4param;this._batchState.pointTexCoords.set(e[0],e[1],e[2],e[3])}InitPoints(e,t){this._type=10,this._startIndex=e,this._indexCount=1,this._mat4param[0]=t}DoPoints(){const e=this._gl,t=this._batchState,s=t.renderer._spPoints;e.useProgram(s._shaderProgram),s.UpdateMatP(t.currentMatP,!1),s.UpdateMatMV(t.currentMV,!1);var i=t.pointTexCoords;s._uPointTexStart.IsUsed()&&s._uPointTexStart.Update2f(i.getLeft(),i.getTop()),s._uPointTexEnd.IsUsed()&&s._uPointTexEnd.Update2f(i.getRight(),i.getBottom()),i=this._mat4param[0],s._uZElevation.IsUsed()&&s._uZElevation.Update1f(i),s._uColor.IsUsed()&&(i=t.currentColor,s._uColor.Update4f(i[0],i[1],i[2],i[3])),e.drawArrays(e.POINTS,this._startIndex/4,this._indexCount),e.useProgram(t.currentShader._shaderProgram)}InitSetProgram(e){this._type=11,this._texParam=e}DoSetProgram(){var e=this._gl;const t=this._batchState,s=this._texParam;t.currentShader=s,e.useProgram(s._shaderProgram),s.UpdateMatP(t.currentMatP,!1),s.UpdateMatMV(t.currentMV,!1),s._uColor.IsUsed()&&(e=t.currentColor,s._uColor.Update4f(e[0],e[1],e[2],e[3]))}InitSetProgramParameters(){this._type=12}DoSetProgramParameters(){const e=this._batchState.currentShader,t=this._gl,s=this._mat4param,i=this._colorParam,r=this._srcOriginRect;if(e._uSamplerBack.IsUsed()){const e=this._batchState.renderer,s=this._texParam;e._lastTexture1!==s&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s?s._GetTexture():null),e._lastTexture1=s,t.activeTexture(t.TEXTURE0))}e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(s[0],s[1]),e._uDestStart.IsUsed()&&e._uDestStart.Update2f(s[2],s[3]),e._uDestEnd.IsUsed()&&e._uDestEnd.Update2f(s[4],s[5]),e._uDevicePixelRatio.IsUsed()&&e._uDevicePixelRatio.Update1f(this._indexCount),e._uLayerScale.IsUsed()&&e._uLayerScale.Update1f(s[6]),e._uLayerAngle.IsUsed()&&e._uLayerAngle.Update1f(s[7]),e._uSrcStart.IsUsed()&&e._uSrcStart.Update2f(s[12],s[13]),e._uSrcEnd.IsUsed()&&e._uSrcEnd.Update2f(s[14],s[15]),e._uSrcOriginStart.IsUsed()&&e._uSrcOriginStart.Update2f(r[0],r[1]),e._uSrcOriginEnd.IsUsed()&&e._uSrcOriginEnd.Update2f(r[2],r[3]),e._uLayoutStart.IsUsed()&&e._uLayoutStart.Update2f(i[0],i[1]),e._uLayoutEnd.IsUsed()&&e._uLayoutEnd.Update2f(i[2],i[3]),e._uSeconds.IsUsed()&&e._uSeconds.Update1f(this._startIndex)}InitSetProgramCustomParameters(){this._type=13}DoSetProgramCustomParameters(){const e=this._batchState.currentShader._uCustomParameters,t=this._shaderParams;for(let s=0,i=e.length;s<i;++s){const i=e[s],r=t[s];i.IsColorType()?i.Update3f(r.getR(),r.getG(),r.getB()):i.Update1f(r)}}InitInvalidateFramebuffer(e){this._type=14,this._texParam=e}DoInvalidateFramebuffer(){const e=this._gl,t=this._texParam,s=this._batchState.currentFramebuffer;t!==s&&e.bindFramebuffer(e.FRAMEBUFFER,t),e.invalidateFramebuffer(e.FRAMEBUFFER,[e.COLOR_ATTACHMENT0]),t!==s&&e.bindFramebuffer(e.FRAMEBUFFER,s)}InitBlitFramebuffer(e,t,s){this._type=17;const i=this._mat4param,r=this._batchState.renderer;i[0]=e.GetWidth(),i[1]=e.GetHeight(),i[2]=t?t.GetWidth():r.GetWidth(),i[3]=t?t.GetHeight():r.GetHeight(),i[4]=e.IsLinearSampling()?1:0,i[5]="stretch"===s,s=this._shaderParams,C3$jscomp$46.clearArray(s),s.push(e._GetFramebuffer()),s.push(t?t._GetFramebuffer():null)}DoBlitFramebuffer(){var e=this._mat4param,t=this._shaderParams;const s=this._gl;var i=e[0],r=e[1],n=e[2];const a=e[3],o=0!==e[4];e=0!==e[5];const h=t[1];s.bindFramebuffer(s.READ_FRAMEBUFFER,t[0]),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,h),e?s.blitFramebuffer(0,0,i,r,0,0,n,a,s.COLOR_BUFFER_BIT,o?s.LINEAR:s.NEAREST):(t=Math.min(i,n),i=Math.min(r,a),n=Math.max(r-a,0),r=Math.max(a-r,0),s.blitFramebuffer(0,n,t,i+n,0,r,t,i+r,s.COLOR_BUFFER_BIT,s.NEAREST))}InitStartQuery(e){this._type=18,this._texParam=e}DoStartQuery(){this._texParam.BeginTimeElapsed(),this._texParam=null}InitEndQuery(e){this._type=19,this._texParam=e}DoEndQuery(){this._texParam.EndTimeElapsed(),this._texParam=null}InitSetEllipseParams(e,t,s){this._type=20;const i=this._mat4param;i[0]=e,i[1]=t,i[2]=s}DoSetEllipseParams(){const e=this._batchState.currentShader,t=this._mat4param;e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[0],t[1]),e._uOutlineThickness.IsUsed()&&e._uOutlineThickness.Update1f(t[2])}InitSetTilemapInfo(e,t,s,i,r,n,a){this._type=16;const o=this._mat4param;e.writeToTypedArray(o,0),o[4]=1/t,o[5]=1/s,o[6]=i/t,o[7]=r/s,o[8]=n/t,o[9]=a/s}DoSetTilemapInfo(){const e=this._batchState.currentShader,t=this._mat4param;e._uSrcStart.IsUsed()&&e._uSrcStart.Update2f(t[0],t[1]),e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[4],t[5]),e._uTileSize.IsUsed()&&e._uTileSize.Update2f(t[6],t[7]),e._uTileSpacing.IsUsed()&&e._uTileSpacing.Update2f(t[8],t[9])}InitSetTileRandomizationInfo(e,t,s,i,r,n,a){this._type=29;const o=this._mat4param;o[0]=1/e,o[1]=1/t,o[2]=s,o[3]=i,o[4]=r,o[5]=n,o[6]=a}DoSetTileRandomizationInfo(){const e=this._batchState.currentShader,t=this._mat4param;e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[0],t[1]),e._uTileSize.IsUsed()&&e._uTileSize.Update2f(t[2],t[3]),e._uOutlineThickness.IsUsed()&&e._uOutlineThickness.Update1f(t[4]),e._uTileSpacing.IsUsed()&&e._uTileSpacing.Update2f(t[5],t[6])}InitClearDepth(e){this._type=22,this._startIndex=e?1:0}DoClearDepth(){const e=this._gl,t=0!==this._startIndex;t||e.depthMask(!0),e.clear(e.DEPTH_BUFFER_BIT),t||e.depthMask(!1)}InitSetDepthEnabled(e){this._type=23,this._startIndex=e?1:0}DoSetDepthEnabled(){const e=this._gl;0===this._startIndex?(e.disable(e.DEPTH_TEST),e.depthMask(!1)):(e.enable(e.DEPTH_TEST),e.depthMask(!0))}InitSetDepthSamplingEnabled(e){this._type=24,this._startIndex=e?1:0}DoSetDepthSamplingEnabled(){const e=this._gl,t=this._batchState,s=t.renderer,i=0!==this._startIndex;t.isDepthSamplingEnabled=i,e.activeTexture(e.TEXTURE2),i?(t.currentFramebufferNoDepth&&e.bindFramebuffer(e.FRAMEBUFFER,t.currentFramebufferNoDepth),e.bindTexture(e.TEXTURE_2D,s._GetDepthBuffer())):(e.bindTexture(e.TEXTURE_2D,null),t.currentFramebufferNoDepth&&e.bindFramebuffer(e.FRAMEBUFFER,t.currentFramebuffer)),e.activeTexture(e.TEXTURE0)}InitCoplanarStartStencilPass(){this._type=25}DoCoplanarStartStencilPass(){const e=this._gl;e.clear(e.STENCIL_BUFFER_BIT),e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.colorMask(!1,!1,!1,!1)}InitCoplanarStartColorPass(){this._type=26}DoCoplanarStartColorPass(){const e=this._gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,1,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}InitCoplanarRestore(){this._type=27}DoCoplanarRestore(){const e=this._gl;e.disable(e.STENCIL_TEST)}InitSetScissor(e,t,s,i,r){this._type=28,this._startIndex=e?1:0,(e=this._mat4param)[0]=t,e[1]=s,e[2]=i,e[3]=r}DoSetScissor(){const e=this._gl,t=this._mat4param;1===this._startIndex?(e.enable(e.SCISSOR_TEST),e.scissor(t[0],t[1],t[2],t[3])):e.disable(e.SCISSOR_TEST)}Run(){switch(this._type){case 1:this.DoQuad();break;case 2:this.DoSetTexture();break;case 3:this.DoSetColor();break;case 4:this.DoSetBlend();break;case 5:this.DoSetViewport();break;case 6:this.DoSetProjection();break;case 7:this.DoSetModelView();break;case 8:this.DoSetRenderTarget();break;case 9:this.DoClearSurface();break;case 10:this.DoPoints();break;case 11:this.DoSetProgram();break;case 12:this.DoSetProgramParameters();break;case 13:this.DoSetProgramCustomParameters();break;case 14:this.DoInvalidateFramebuffer();break;case 15:this.DoSetPointTextureCoords();break;case 16:this.DoSetTilemapInfo();break;case 17:this.DoBlitFramebuffer();break;case 18:this.DoStartQuery();break;case 19:this.DoEndQuery();break;case 20:this.DoSetEllipseParams();break;case 21:this.DoSetGradientColor();break;case 22:this.DoClearDepth();break;case 23:this.DoSetDepthEnabled();break;case 24:this.DoSetDepthSamplingEnabled();break;case 25:this.DoCoplanarStartStencilPass();break;case 26:this.DoCoplanarStartColorPass();break;case 27:this.DoCoplanarRestore();break;case 28:this.DoSetScissor();break;case 29:this.DoSetTileRandomizationInfo()}}};const C3$jscomp$47=self.C3,GENERIC_FONT_FAMILIES=new Set("serif sans-serif monospace cursive fantasy system-ui ui-serif ui-sans-serif ui-monospace ui-rounded math emoji fangsong".split(" ")),DEFAULT_OPTS={timeout:60},tempColor=new C3$jscomp$47.Color(0,0,0,1),VALID_HORIZ_ALIGNMENTS=new Set(["left","center","right"]),VALID_VERT_ALIGNMENTS=new Set(["top","center","bottom"]),VALID_WORD_WRAP_MODES=new Set(["word","character"]),allRendererTexts=new Set;function fillOrStrokeText(e,t,s,i,r,n){t?"Gecko"===C3$jscomp$47.Platform.BrowserEngine?e.strokeText(s,i,r,n):e.strokeText(s,i,r):"Gecko"===C3$jscomp$47.Platform.BrowserEngine?e.fillText(s,i,r,n):e.fillText(s,i,r)}function fillOrStrokeRect(e,t,s,i,r,n){t?e.strokeRect(s,i,r,n):e.fillRect(s,i,r,n)}function ptToPx(e){return 4/3*e}C3$jscomp$47.FontManager&&C3$jscomp$47.FontManager.addEventListener("fontload",(e=>{e=e.font.GetName();for(const t of allRendererTexts)(t.IsBBCodeEnabled()||C3$jscomp$47.equalsNoCase(t.GetFontName(),e))&&t._SetTextChanged()}));let didCheckFoundBoundingBoxSupport=!1,supportsFontBoundingBoxMeasurements=!1;C3$jscomp$47.Gfx.RendererText=class{constructor(e,t){t=Object.assign({},DEFAULT_OPTS,t),this._renderer=e,this._fontName="Arial",this._fontSize=16,this._fontSizeScale=1,this._lineHeight=0,this._isItalic=this._isBold=!1,this._colorStr="black",this._isBBcodeEnabled=!1,this.onloadfont=null,this._alreadyLoadedFonts=new Set,this._horizontalAlign="left",this._verticalAlign="top",this._text="",this._bbString=null,this._wrappedText=C3$jscomp$47.New(C3$jscomp$47.WordWrap),this._wrapMode="word",this._isUpdating=this._textChanged=!1,this._isAsync=!0,this._drawMaxCharCount=-1,this._height=this._width=this._cssHeight=this._cssWidth=this._drawCharCount=0,this._zoom=1,this._changed=!1,this._measureContextTop=this._measureContext=this._textContext=this._textCanvas=null,this._lastCanvasHeight=this._lastCanvasWidth=-1,this._lastTextCanvasFillStyle=this._lastMeasureCanvasFont=this._lastTextCanvasFont="",this._lastTextCanvasLineWidth=this._lastTextCanvasOpacity=1,this._measureTextCallback=(e,t)=>this._MeasureText(e,t),this._texture=null,this._textureHeight=this._textureWidth=0,this._rcTex=new C3$jscomp$47.Rect,this._scaleFactor=1,this._needToRecreateTexture=!1,this._textureTimeout=new C3$jscomp$47.IdleTimeout((()=>{this.ReleaseTexture(),this._SetTextCanvasSize(8,8)}),t.timeout),this.ontextureupdate=null,this._wasReleased=!1,allRendererTexts.add(this)}Release(){this.onloadfont=null,this._alreadyLoadedFonts.clear(),this._measureTextCallback=this._measureContextTop=this._measureContext=this._textContext=this._textCanvas=this._bbString=null,this._textureTimeout.Release(),this.ontextureupdate=null,this.ReleaseTexture(),this._wrappedText.Clear(),this._renderer=this._wrappedText=null,this._wasReleased=!0,allRendererTexts.delete(this)}_SetChanged(){this._changed=!0}_SetTextChanged(){this._SetChanged(),this._wrappedText.Clear(),this._textChanged=!0}SetIsAsync(e){this._isAsync=!!e}IsAsync(){return this._isAsync}SetBBCodeEnabled(e){e=!!e,this._isBBcodeEnabled!==e&&(e=(this._isBBcodeEnabled=e)?"alphabetic":"top",this._textContext&&(this._textContext.textBaseline=e),this._measureContext&&(this._measureContext.textBaseline=e),this._SetTextChanged())}IsBBCodeEnabled(){return this._isBBcodeEnabled}SetFontName(e){e||(e="serif"),this._fontName!==e&&(this._fontName=e,this._SetTextChanged())}GetFontName(){return this._fontName}SetFontSize(e){.1>e&&(e=.1),this._fontSize!==e&&(this._fontSize=e,this._SetTextChanged())}SetFontSizeScale(e){this._fontSizeScale!==e&&(this._fontSizeScale=e,this._SetTextChanged())}SetLineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this._SetChanged())}SetBold(e){e=!!e,this._isBold!==e&&(this._isBold=e,this._SetTextChanged())}SetItalic(e){e=!!e,this._isItalic!==e&&(this._isItalic=e,this._SetTextChanged())}SetDrawMaxCharacterCount(e){e=Math.floor(e),this._drawMaxCharCount!==e&&(this._drawMaxCharCount=e,this._SetChanged())}GetDrawMaxCharacterCount(){return this._drawMaxCharCount}_GetStyleTag(e,t){for(let s=e.length-1;0<=s;--s){const i=e[s];if(i.tag===t)return i}return null}_HasStyleTag(e,t){return!!this._GetStyleTag(e,t)}_GetFontString(e,t){let s=[];(this._isBold||this._HasStyleTag(t,"b"))&&s.push("bold"),(this._isItalic||this._HasStyleTag(t,"i"))&&s.push("italic");var i=this._GetStyleTag(t,"size");return i=(i?parseFloat(i.param):this._fontSize)*this._fontSizeScale,e?s.push(i+"pt"):s.push(i*this._scaleFactor*this._zoom*self.devicePixelRatio+"pt"),e=this._fontName,(t=this._GetStyleTag(t,"font"))&&t.param&&(e=t.param,this.onloadfont&&!this._alreadyLoadedFonts.has(e)&&(this.onloadfont(e),this._alreadyLoadedFonts.add(e))),e&&(GENERIC_FONT_FAMILIES.has(e)?s.push(e):s.push('"'+e+'"')),s.join(" ")}SetColor(e){e instanceof C3$jscomp$47.Color&&(e=e.getCssRgb()),this._colorStr!==e&&(this._colorStr=e,this._SetChanged())}SetColorRgb(e,t,s){tempColor.setRgb(e,t,s),this.SetColor(tempColor)}SetHorizontalAlignment(e){if(!VALID_HORIZ_ALIGNMENTS.has(e))throw Error("invalid horizontal alignment");this._horizontalAlign!==e&&(this._horizontalAlign=e,this._SetChanged())}SetVerticalAlignment(e){if(!VALID_VERT_ALIGNMENTS.has(e))throw Error("invalid vertical alignment");this._verticalAlign!==e&&(this._verticalAlign=e,this._SetChanged())}SetWordWrapMode(e){if(!VALID_WORD_WRAP_MODES.has(e))throw Error("invalid word wrap mode");this._wrapMode!==e&&(this._wrapMode=e,this._SetTextChanged())}SetText(e){this._text!==e&&(this._text=e,this._SetTextChanged())}SetSize(e,t,s){if(void 0===s&&(s=1),!(0>=e||0>=e||this._cssWidth===e&&this._cssHeight===t&&this._zoom===s)){1===this._zoom!=(1===s)&&(this._needToRecreateTexture=!0);var i=this._cssWidth,r=this._zoom;this._cssWidth=e,this._cssHeight=t,this._zoom=s,e=self.devicePixelRatio,this._width=this._cssWidth*this._zoom*e,this._height=this._cssHeight*this._zoom*e,s=1,(e=Math.max(this._width,this._height))>(t=Math.min(this._renderer.GetMaxTextureSize(),4096))&&(s=t/e,this._width=Math.min(this._width*s,t),this._height=Math.min(this._height*s,t)),this._scaleFactor=s,0<this._textureWidth&&0<this._textureHeight&&this._zoom===r&&this._rcTex.set(0,0,this._width/this._textureWidth,this._height/this._textureHeight),this._cssWidth!==i?this._SetTextChanged():this._SetChanged()}}GetWidth(){return this._width}GetHeight(){return this._height}GetTextWidth(){return this._MaybeWrapText(),this._wrappedText.GetMaxLineWidth()}GetTextHeight(){return this._MaybeWrapText(),this._wrappedText.GetTotalLineHeight()+this._wrappedText.GetLineCount()*(this._lineHeight+4)-this._lineHeight}GetTexture(){return this._textureTimeout.Reset(),this._MaybeUpdate(),this._texture}_MaybeUpdate(){this._texture&&!this._changed&&!this._textChanged||this._isUpdating||0>=this._width||0>=this._height||(this._changed=!1,this._isUpdating=!0,this._isAsync?C3$jscomp$47.Asyncify((()=>this._DoUpdate())):this._DoUpdate())}_DoUpdate(){this._wasReleased||(this._SetTextCanvasSize(Math.ceil(this._width),Math.ceil(this._height)),this._MaybeWrapText(),this._DrawTextToCanvas(),this._UpdateTexture(),this._textureTimeout.Reset(),this._isUpdating=!1)}_SetTextCanvasSize(e,t){this._textCanvas||(this._textCanvas=C3$jscomp$47.CreateCanvas(16,16));let s=!1;this._lastCanvasWidth===e&&this._lastCanvasHeight===t||(this._lastCanvasWidth=e,this._lastCanvasHeight=t,this._textCanvas.width=e,this._textCanvas.height=t,s=!0),this._textContext||(this._textContext=this._textCanvas.getContext("2d"),s=!0),s?(this._textContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._textContext.font=this._lastTextCanvasFont,this._textContext.fillStyle=this._lastTextCanvasFillStyle,this._textContext.strokeStyle=this._lastTextCanvasFillStyle,this._textContext.globalAlpha=this._lastTextCanvasOpacity,this._textContext.lineWidth=this._lastTextCanvasLineWidth):this._textContext.clearRect(0,0,e,t)}_MaybeCreateMeasureContext(){this._measureContext||(this._measureContext=C3$jscomp$47.CreateCanvas(16,16).getContext("2d"),this._measureContextTop=C3$jscomp$47.CreateCanvas(16,16).getContext("2d"),this._measureContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._measureContextTop.textBaseline="top")}_SetMeasureFontString(e){this._lastMeasureCanvasFont!==e&&(this._lastMeasureCanvasFont=e,this._measureContext.font=e,this._measureContextTop.font=e)}_SupportsFontBoundingBoxMeasurements(){if(!didCheckFoundBoundingBoxSupport){didCheckFoundBoundingBoxSupport=!0,this._MaybeCreateMeasureContext();const e=this._measureContext.measureText("test");supportsFontBoundingBoxMeasurements="number"==typeof e.fontBoundingBoxAscent&&"number"==typeof e.fontBoundingBoxDescent}return supportsFontBoundingBoxMeasurements}_MaybeWrapText(){this._textChanged&&(this._MaybeCreateMeasureContext(),!this._isBBcodeEnabled||this._bbString&&this._bbString.toString()===this._text||(this._bbString=new C3$jscomp$47.BBString(this._text,{noEscape:!0})),this._wrappedText.WordWrap(this._isBBcodeEnabled?this._bbString.toFragmentList():this._text,this._measureTextCallback,this._cssWidth,this._wrapMode,0),this._textChanged=!1)}_MeasureText(e,t){e=e.join(""),this._SetMeasureFontString(this._GetFontString(!0,t)),t=((t=this._GetStyleTag(t,"size"))?parseFloat(t.param):this._fontSize)*this._fontSizeScale;const s=this._measureContext.measureText(e);let i=0;return this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements()&&(e=this._measureContextTop.measureText(e),i=s.fontBoundingBoxAscent-e.fontBoundingBoxAscent),{width:s.width,height:ptToPx(t),fontBoundingBoxAscent:s.fontBoundingBoxAscent||0,fontBoundingBoxDescent:s.fontBoundingBoxDescent||0,topToAlphabeticDistance:i}}_SetDrawFontString(e){this._lastTextCanvasFont!==e&&(this._lastTextCanvasFont=e,this._textContext.font=e)}_SetDrawCanvasColor(e){this._lastTextCanvasFillStyle!==e&&(this._lastTextCanvasFillStyle=e,this._textContext.fillStyle=e,this._textContext.strokeStyle=e)}_SetDrawCanvasOpacity(e){this._lastTextCanvasOpacity!==e&&(this._lastTextCanvasOpacity=e,this._textContext.globalAlpha=e)}_SetDrawCanvasLineWith(e){this._lastTextCanvasLineWidth!==e&&(this._lastTextCanvasLineWidth=e,this._textContext.lineWidth=e)}_DrawTextToCanvas(){this._drawCharCount=0;const e=this._scaleFactor*this._zoom*self.devicePixelRatio,t=(4+this._lineHeight)*e;var s=0;const i=this._wrappedText.GetLines();if(0!==i.length){var r=this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements(),n=i[0].height*e;"center"===this._verticalAlign?(s=i.reduce(((s,i)=>s+i.height*e+t),0)-t,s=Math.max(this._height/2-s/2,0),r&&(n=i[0].topToAlphabeticDistance*e)):"bottom"===this._verticalAlign&&(s=i.reduce(((s,i)=>s+i.height*e+t),0)-this._lineHeight*e,r=r?i.at(-1).fontBoundingBoxDescent*e:0,s=this._height-s-r-2);for(let a=0,o=i.length;a<o;++a){const o=(r=i[a]).height*e,h=s;if(this._isBBcodeEnabled){if(s+=0===a?n:o,0<a&&s>this._height-4*e)break}else if(0<a&&s>=this._height-o)break;0<=h&&this._DrawTextLine(r,s,e),this._isBBcodeEnabled||(s+=o),s+=t}}}_DrawTextLine(e,t,s){let i=0;"center"===this._horizontalAlign?i=(this._width-e.width*s)/2:"right"===this._horizontalAlign&&(i=this._width-e.width*s);for(const r of e.fragments)this._DrawTextFragment(r,i,t,s,e.height),i+=r.width*s}_DrawTextFragment(e,t,s,i,r){const n=this._textContext,a=r/16;r=e.width*i;const o=e.height*i,h=e.height/16;var l=(4+this._lineHeight)*i,c=e.styles,u=e.chArr;if(-1!==this._drawMaxCharCount){if(this._drawCharCount>=this._drawMaxCharCount)return;this._drawCharCount+u.length>this._drawMaxCharCount&&(u=u.slice(0,this._drawMaxCharCount-this._drawCharCount),r=this._MeasureText(u,c).width*i),this._drawCharCount+=u.length}var p=this._GetStyleTag(c,"background");e=this._HasStyleTag(c,"u");const _=this._HasStyleTag(c,"s");if((!C3$jscomp$47.IsCharArrayAllWhitespace(u)||p||e||_)&&!this._HasStyleTag(c,"hide")){u=u.join("");var m=this._GetStyleTag(c,"offsetx");t+=m?parseFloat(m.param)*i:0,s+=(m=this._GetStyleTag(c,"offsety"))?parseFloat(m.param)*i:0,p&&(this._SetDrawCanvasColor(p.param),n.fillRect(t,s-o,r,o+l)),l=this._GetStyleTag(c,"color"),this._SetDrawCanvasColor(l?l.param:this._colorStr),p=this._GetStyleTag(c,"opacity"),this._SetDrawCanvasOpacity(p?parseFloat(p.param)/100:1),p=(p=this._GetStyleTag(c,"linethickness"))?parseFloat(p.param):1,(m=this._HasStyleTag(c,"stroke"))&&this._SetDrawCanvasLineWith(.5*h*p*this._scaleFactor*this._zoom*self.devicePixelRatio),this._SetDrawFontString(this._GetFontString(!1,c)),fillOrStrokeText(n,m,u,t,s,r),!m&&(this._SetDrawCanvasLineWith(.5*h*p*this._scaleFactor*this._zoom*self.devicePixelRatio),c=this._GetStyleTag(c,"outline"))&&(this._SetDrawCanvasColor(c.param),fillOrStrokeText(n,!0,u,t,s,r)),this._SetDrawCanvasColor(l?l.param:this._colorStr),e&&fillOrStrokeRect(n,m,t,s+i*a,r,i*a*p),_&&(i*=h,n.fillRect(t,s-o/4+i/2-i*p/2,r,i*p))}}_UpdateTexture(){!this._renderer.IsContextLost()&&(this._textureWidth=Math.ceil(this._width),this._textureHeight=Math.ceil(this._height),this._rcTex.set(0,0,this._width/this._textureWidth,this._height/this._textureHeight),this._needToRecreateTexture&&(this.ReleaseTexture(),this._needToRecreateTexture=!1),this._texture||(this._texture=this._renderer.CreateDynamicTexture(this._textureWidth,this._textureHeight,{mipMap:1===this._zoom,mipMapQuality:"high"})),this._renderer.UpdateTexture(this._textCanvas,this._texture),this.ontextureupdate)&&this.ontextureupdate()}GetTexRect(){return this._rcTex}ReleaseTexture(){this._texture&&(this._renderer.IsContextLost()||this._renderer.DeleteTexture(this._texture),this._texture=null)}static OnContextLost(){for(const e of allRendererTexts)e.ReleaseTexture()}static GetAll(){return allRendererTexts.values()}};const C3$jscomp$48=self.C3;class WebGLRealTimeElapsedQuery{constructor(e){this._gl=e.GetContext(),this._version=e.GetWebGLVersionNumber(),this._timerExt=e._GetDisjointTimerQueryExtension(),this._query=null,this._hasResult=this._isActive=!1,this._result=0,this._query=1===this._version?this._timerExt.createQueryEXT():this._gl.createQuery()}Release(){this._DeleteQueryObject(),this._timerExt=this._gl=null,this._hasResult=!1}_DeleteQueryObject(){this._query&&(1===this._version?this._timerExt.deleteQueryEXT(this._query):this._gl.deleteQuery(this._query),this._query=null)}BeginTimeElapsed(){if(this._isActive)throw Error("query already active");1===this._version?this._timerExt.beginQueryEXT(this._timerExt.TIME_ELAPSED_EXT,this._query):this._gl.beginQuery(this._timerExt.TIME_ELAPSED_EXT,this._query),this._isActive=!0}EndTimeElapsed(){if(!this._isActive)throw Error("query not active");1===this._version?this._timerExt.endQueryEXT(this._timerExt.TIME_ELAPSED_EXT):this._gl.endQuery(this._timerExt.TIME_ELAPSED_EXT),this._isActive=!1}CheckForResult(){if(this._query&&!this._hasResult&&!this._isActive){var e=1===this._version?this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_AVAILABLE_EXT):this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE),t=this._gl.getParameter(this._timerExt.GPU_DISJOINT_EXT);e&&!t&&(this._result=1===this._version?this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_EXT):this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT),this._result/=1e9,this._hasResult=!0),(e||t)&&this._DeleteQueryObject()}}HasResult(){return this._hasResult}GetResult(){if(!this._hasResult)throw Error("no result available");return this._result}}C3$jscomp$48.Gfx.WebGLTimeElapsedQuery=class{constructor(e){this._renderer=e,this._frameNumber=e.GetFrameNumber(),this._isActive=!1,this._parentQuery=null,this._isNested=!1,this._realQuery=null,this._queries=[]}Release(){for(const e of this._queries)e instanceof WebGLRealTimeElapsedQuery&&e.Release();C3$jscomp$48.clearArray(this._queries),this._renderer=this._realQuery=this._parentQuery=null}BeginTimeElapsed(){if(this._isActive)throw Error("query already active");const e=this._renderer._GetTimeQueryStack();0<e.length?(this._isNested=!0,this._parentQuery=e.at(-1),this._parentQuery._EndReal(),this._parentQuery._queries.push(this)):(this._isNested=!1,this._parentQuery=null),this._isActive=!0,e.push(this),this._StartReal()}EndTimeElapsed(){if(!this._isActive)throw Error("query not active");if(this._renderer._GetTimeQueryStack().pop()!==this)throw Error("can only end most nested query");this._isActive=!1,this._EndReal(),this._parentQuery&&(this._parentQuery._StartReal(),this._parentQuery=null)}_StartReal(){this._realQuery=C3$jscomp$48.New(WebGLRealTimeElapsedQuery,this._renderer),this._queries.push(this._realQuery),this._realQuery.BeginTimeElapsed()}_EndReal(){this._realQuery.EndTimeElapsed(),this._realQuery=null}CheckForResult(){for(const e of this._queries)e.CheckForResult()}IsNested(){return this._isNested}HasResult(){return this._queries.every((e=>e.HasResult()))}GetResult(){return this._queries.reduce(((e,t)=>e+t.GetResult()),0)}GetFrameNumber(){return this._frameNumber}};const C3$jscomp$49=self.C3;C3$jscomp$49.Gfx.WebGLQueryResultBuffer=class{constructor(e,t=1e3){this._renderer=e,this._maxQueries=t,this._buffer=[],this._renderer._AddQueryResultBuffer(this)}Release(){this.Clear(),this._renderer._RemoveQueryResultBuffer(this),this._renderer=null}Clear(){for(const e of this._buffer)e.Release();C3$jscomp$49.clearArray(this._buffer)}AddTimeElapsedQuery(){const e=new C3$jscomp$49.Gfx.WebGLTimeElapsedQuery(this._renderer);return this._buffer.push(e),this._buffer.length>this._maxQueries&&this._buffer.shift().Release(),e}CheckForResults(e){for(const t of this._buffer){if(t.GetFrameNumber()>=e)break;if(t.IsNested())break;t.CheckForResult()}}GetFrameRangeResultSum(e,t){if(t<=e)return NaN;let s=0;for(const i of this._buffer){if(i.GetFrameNumber()>=t)break;if(!(i.GetFrameNumber()<e)){if(!i.HasResult())return NaN;s+=i.GetResult()}}return s}DeleteAllBeforeFrameNumber(e){for(let t=0,s=this._buffer.length;t<s;++t){const s=this._buffer[t];if(!(s.GetFrameNumber()<e)){0<t&&this._buffer.splice(0,t);break}s.Release()}}};const C3$jscomp$50=self.C3,glMatrix$jscomp$6=self.glMatrix,vec4$jscomp$4=glMatrix$jscomp$6.vec4,mat4$jscomp$7=glMatrix$jscomp$6.mat4,DEFAULT_WEBGLRENDERER_OPTS={powerPreference:"default",enableGpuProfiling:!0,alpha:!1,lowLatency:!1,depth:!1,canSampleDepth:!1,maxWebGLVersion:2,failIfMajorPerformanceCaveat:!1},VALID_POWER_PREFERENCES=new Set(["default","low-power","high-performance"]),MAX_INDICES=12e3,LAST_POINT=7996,defaultTexCoordsQuad$jscomp$1=new C3$jscomp$50.Quad(0,0,1,0,1,1,0,1),tmpProjection=mat4$jscomp$7.create(),tmpModelView=mat4$jscomp$7.create(),tmpQuad$jscomp$1=new C3$jscomp$50.Quad,tmpRect$jscomp$1=new C3$jscomp$50.Rect;let loseContextExtension=null;C3$jscomp$50.isDebug&&(self.debug_lose_webgl_context=function(){loseContextExtension&&loseContextExtension.loseContext()},self.debug_restore_webgl_context=function(){loseContextExtension&&loseContextExtension.restoreContext()});const pendingPolls=new Set;let pollRafId=-1;function CheckPendingPolls(){pollRafId=-1;for(const e of pendingPolls)e.checkFunc()&&(e.resolve(),pendingPolls.delete(e));0<pendingPolls.size&&(pollRafId=self.requestAnimationFrame(CheckPendingPolls))}C3$jscomp$50.Gfx.WebGLRenderer=class extends C3$jscomp$50.Gfx.RendererBase{constructor(e,t){if(super(t),t=Object.assign({},DEFAULT_WEBGLRENDERER_OPTS,t),!VALID_POWER_PREFERENCES.has(t.powerPreference))throw Error("invalid power preference");const s={alpha:!!t.alpha,depth:!1,antialias:!1,powerPreference:t.powerPreference,failIfMajorPerformanceCaveat:!!t.failIfMajorPerformanceCaveat};t.lowLatency&&(s.desynchronized=!0,s.preserveDrawingBuffer=!0);let i=null,r=0;if(2<=t.maxWebGLVersion&&(i=e.getContext("webgl2",s),r=2),i||(i=e.getContext("webgl",s),r=1),!i)throw Error("failed to initialise WebGL context");this._gl=i,this._attribs=i.getContextAttributes(),t.lowLatency&&this._attribs.desynchronized,this._versionString=i.getParameter(i.VERSION),this._version=r,this._viewport=vec4$jscomp$4.create(),this._didChangeTransform=!1,this._bbProjectionMatrix=mat4$jscomp$7.create(),this._usesDepthBuffer=!!t.depth,this._canSampleDepth=!(!t.depth||!t.canSampleDepth),this._isDepthEnabled=this._usesDepthBuffer,this._isDepthSamplingEnabled=!1,this._depthBuffer=null,this._isAutoSizeDepthBuffer=!0,this._depthBufferHeight=this._depthBufferWidth=0,this._pointBuffer=this._indexBuffer=this._texcoordBuffer=this._vertexBuffer=null,this._vertexData=new Float32Array(8e3*this.GetNumVertexComponents()),this._indexData=new Uint16Array(MAX_INDICES),this._texcoordData=new Float32Array(16e3),this._pointData=new Float32Array(32e3),this._lastVertexPtr=this._pointPtr=this._texPtr=this._vertexPtr=0,this._spDeviceTransformTextureFill=this._lastProgram=null,this._batch=[],this._topOfBatch=this._batchPtr=0,this._currentRenderTarget=null,this._lastPointZ=0,this._batchState=C3$jscomp$50.New(C3$jscomp$50.Gfx.BatchState,this),this._lastColor=C3$jscomp$50.New(C3$jscomp$50.Color,1,1,1,1),this._lastTexture1=this._lastTexture0=null,this._lastDestBlend=this._lastSrcBlend=0,this._lastPointTexCoords=new C3$jscomp$50.Rect,this._lastScissorRect=C3$jscomp$50.New(C3$jscomp$50.Rect,0,0,-1,-1),this._maxTextureSize=-1,this._highpPrecision=this._maxPointSize=this._minPointSize=0,this._unmaskedRenderer=this._unmaskedVendor="(unavailable)",this._extensions=[],this._isInitialisingAfterContextRestored=!1,this._textureLodExt=this._stdDerivativesExt=this._fragDepthExt=this._depthTextureExt=this._anisotropicExt=this._parallelShaderCompileExt=null,this._maxAnisotropy=0,this._isGpuProfilingEnabled=!!t.enableGpuProfiling,this._timerExt=null,this._allQueryResultBuffers=new Set,this._timeQueryStack=[],this.FillIndexBufferData(this._indexData)}IsWebGL(){return!0}async InitState(){super.InitState();var e=this._gl,t=this.GetNumVertexComponents();this._lastColor.setRgba(1,1,1,1),this._lastTexture1=this._lastTexture0=null,this._pointPtr=this._vertexPtr=0,this._lastVertexPtr=8e3*t-4*t,C3$jscomp$50.clearArray(this._batch),this._topOfBatch=this._batchPtr=0,this._currentRenderTarget=this._lastProgram=null,this._lastPointTexCoords.set(0,0,1,1),this._lastPointZ=0,(t=this._batchState).currentShader=null,t.currentFramebuffer=null,t.currentFramebufferNoDepth=null,vec4$jscomp$4.set(t.currentColor,1,1,1,1),t.clearColor.setRgba(0,0,0,0),t.pointTexCoords.set(0,0,1,1),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this._lastSrcBlend=e.ONE,this._lastDestBlend=e.ONE_MINUS_SRC_ALPHA,this._InitBlendModes(e),e.disable(e.CULL_FACE),e.disable(e.STENCIL_TEST),e.disable(e.DITHER),this._usesDepthBuffer?(e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.LEQUAL)):(e.disable(e.DEPTH_TEST),e.depthMask(!1)),this._isDepthEnabled=this._usesDepthBuffer,this._isDepthSamplingEnabled=!1,this._pointBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._pointBuffer),e.bufferData(e.ARRAY_BUFFER,this._pointData.byteLength,e.DYNAMIC_DRAW),this._vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this._vertexData.byteLength,e.DYNAMIC_DRAW),this._texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._texcoordBuffer),e.bufferData(e.ARRAY_BUFFER,this._texcoordData.byteLength,e.DYNAMIC_DRAW),this._indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indexData,e.STATIC_DRAW),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),t=e.getParameter(e.ALIASED_POINT_SIZE_RANGE),this._minPointSize=t[0],this._maxPointSize=t[1],t=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT);var s=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);if(this._highpPrecision=t&&s?Math.min(t.precision,s.precision):0,2048<this._maxPointSize&&(this._maxPointSize=2048),this._extensions=e.getSupportedExtensions(),(t=e.getExtension("WEBGL_debug_renderer_info"))&&(this._unmaskedVendor=e.getParameter(t.UNMASKED_VENDOR_WEBGL),this._unmaskedRenderer=e.getParameter(t.UNMASKED_RENDERER_WEBGL)),this._parallelShaderCompileExt=e.getExtension("KHR_parallel_shader_compile"),C3$jscomp$50.isDebug&&(loseContextExtension=e.getExtension("WEBGL_lose_context")),this._isGpuProfilingEnabled&&(1===this.GetWebGLVersionNumber()?("Chromium"!==C3$jscomp$50.Platform.BrowserEngine||81<=C3$jscomp$50.Platform.BrowserVersionNumber||"undefined"!=typeof document)&&(this._timerExt=e.getExtension("EXT_disjoint_timer_query")):this._timerExt=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query")),this._maxAnisotropy=(this._anisotropicExt=e.getExtension("EXT_texture_filter_anisotropic"))?e.getParameter(this._anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,2>this.GetWebGLVersionNumber()&&this._usesDepthBuffer&&this._canSampleDepth&&(this._depthTextureExt=e.getExtension("WEBGL_depth_texture"),!this._depthTextureExt))throw Error("no depth texture support");2>this.GetWebGLVersionNumber()&&(this._fragDepthExt=e.getExtension("EXT_frag_depth"),this._stdDerivativesExt=e.getExtension("OES_standard_derivatives"),this._textureLodExt=e.getExtension("EXT_shader_texture_lod")),t=(e=C3$jscomp$50.Gfx.WebGLShaderProgram).GetDefaultVertexShaderSource(!1),s=e.GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth();let i=t,r=e.GetPointFragmentShaderSource_WebGL1_NoFragDepth(),n=e.GetPointVertexShaderSource_WebGL1(),a=e.GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(),o=e.GetDefaultVertexShaderSource(!0);var h=!1;this._usesDepthBuffer&&("Safari"!==C3$jscomp$50.Platform.Browser||15.5<=C3$jscomp$50.Platform.BrowserVersionNumber)&&(2>this.GetWebGLVersionNumber()?this._fragDepthExt&&(s=e.GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(),r=e.GetPointFragmentShaderSource_WebGL1_FragDepthEXT(),a=e.GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(),h=!0):(i=e.GetDefaultVertexShaderSource_WebGL2(),s=e.GetTextureFillFragmentShaderSource_WebGL2(),r=e.GetPointFragmentShaderSource_WebGL2(),n=e.GetPointVertexShaderSource_WebGL2(),a=e.GetTilemapFragmentShaderSource_WebGL2(),o=e.GetDefaultVertexShaderSource_WebGL2(!0))),h=e.GetTileRandomizationFragmentShaderSource(this.GetWebGLVersionNumber(),h,this._stdDerivativesExt&&this._textureLodExt);const l=2<=this.GetWebGLVersionNumber()?e.GetDefaultVertexShaderSource_WebGL2():t;e=[[s,i,"<default>"],[s,i,"<default-device-transform>"],[r,n,"<point>"],[e.GetColorFillFragmentShaderSource(),t,"<fill>"],[e.GetLinearGradientFillFragmentShaderSource(),t,"<lineargradient>"],[e.GetPenumbraFillFragmentShaderSource(),t,"<penumbra>"],[e.GetHardEllipseFillFragmentShaderSource(),t,"<hardellipse>"],[e.GetHardEllipseOutlineFragmentShaderSource(),t,"<hardellipseoutline>"],[e.GetSmoothEllipseFillFragmentShaderSource(),t,"<smoothellipse>"],[e.GetSmoothEllipseOutlineFragmentShaderSource(),t,"<smoothellipseoutline>"],[e.GetSmoothLineFillFragmentShaderSource(),t,"<smoothline>"],[a,o,"<tilemap>"],[h,l,"<tilerandomization>"]],e=await Promise.all(e.map((e=>this.CreateShaderProgram({src:e[0]},e[1],e[2])))),this._spTextureFill=e[0],this._spDeviceTransformTextureFill=e[1],this._spPoints=e[2],this._spColorFill=e[3],this._spLinearGradientFill=e[4],this._spPenumbraFill=e[5],this._spHardEllipseFill=e[6],this._spHardEllipseOutline=e[7],this._spSmoothEllipseFill=e[8],this._spSmoothEllipseOutline=e[9],this._spSmoothLineFill=e[10],this._spTilemapFill=e[11],this._spTileRandomization=e[12],this.SetTextureFillMode()}async CreateShaderProgram(e,t,s){return e=await C3$jscomp$50.Gfx.WebGLShaderProgram.Create(this,e,t,s),this._AddShaderProgram(e),e}ResetLastProgram(){this._lastProgram=null}SetSize(e,t,s){if(this._width!==e||this._height!==t||s){this.EndBatch(),s=this._gl;var i=this._batchState;this._width=e,this._height=t,this._SetViewport(0,0,e,t),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,e/t),this.SetProjectionMatrix(this._bbProjectionMatrix),this._spDeviceTransformTextureFill&&(s.useProgram(this._spDeviceTransformTextureFill.GetShaderProgram()),this._spDeviceTransformTextureFill._UpdateDeviceTransformUniforms(this._matP),this._lastProgram=this._spDeviceTransformTextureFill,this._batchState.currentShader=this._spDeviceTransformTextureFill),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE0),this._lastTexture1=this._lastTexture0=null,this._usesDepthBuffer&&this._isAutoSizeDepthBuffer&&this._SetDepthBufferSize(this._width,this._height),this._currentRenderTarget&&this._currentRenderTarget._Resize(this._width,this._height),s.bindFramebuffer(s.FRAMEBUFFER,null),this._currentRenderTarget=null,i.currentFramebuffer=null,i.currentFramebufferNoDepth=null}}_SetDepthBufferSize(e,t){const s=this._gl;this._depthBuffer&&this._depthBufferWidth===e&&this._depthBufferHeight===t||(this._canSampleDepth?(this._depthBuffer&&s.deleteTexture(this._depthBuffer),this._depthBuffer=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this._depthBuffer),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),2<=this.GetWebGLVersionNumber()?s.texImage2D(s.TEXTURE_2D,0,s.DEPTH24_STENCIL8,e,t,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):this._depthTextureExt&&s.texImage2D(s.TEXTURE_2D,0,s.DEPTH_STENCIL,e,t,0,s.DEPTH_STENCIL,this._depthTextureExt.UNSIGNED_INT_24_8_WEBGL,null),s.bindTexture(s.TEXTURE_2D,null)):(this._depthBuffer&&s.deleteRenderbuffer(this._depthBuffer),this._depthBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this._depthBuffer),s.renderbufferStorage(s.RENDERBUFFER,2<=this._version?s.DEPTH24_STENCIL8:s.DEPTH_STENCIL,e,t),s.bindRenderbuffer(s.RENDERBUFFER,null)),this._depthBufferWidth=e,this._depthBufferHeight=t)}SetFixedSizeDepthBuffer(e,t){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!1,this._SetDepthBufferSize(e,t))}SetAutoSizeDepthBuffer(){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!0,this._SetDepthBufferSize(this._width,this._height))}_SetViewport(e,t,s,i){const r=this._viewport;r[0]===e&&r[1]===t&&r[2]===s&&r[3]===i||(this.PushBatch().InitSetViewport(e,t,s,i),vec4$jscomp$4.set(r,e,t,s,i),this._topOfBatch=0)}SetFovY(e){super.SetFovY(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetNearZ(e){super.SetNearZ(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetFarZ(e){super.SetFarZ(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetProjectionMatrix(e){mat4$jscomp$7.exactEquals(this._matP,e)||(this.PushBatch().InitSetProjection(e),mat4$jscomp$7.copy(this._matP,e),this._topOfBatch=0,this._didChangeTransform=!0)}SetDefaultRenderTargetProjectionState(){let e,t;var s=this._currentRenderTarget;null===s?(e=this._bbProjectionMatrix,t=this.GetWidth(),s=this.GetHeight()):(e=s.GetProjectionMatrix(),t=s.GetWidth(),s=s.GetHeight()),this.SetProjectionMatrix(e),this._SetViewport(0,0,t,s)}SetModelViewMatrix(e){mat4$jscomp$7.exactEquals(this._matMV,e)||(this.PushBatch().InitSetModelView(e),mat4$jscomp$7.copy(this._matMV,e),this._topOfBatch=0,this._didChangeTransform=!0)}ResetDidChangeTransformFlag(){this._didChangeTransform=!1}DidChangeTransform(){return this._didChangeTransform}GetBatchState(){return this._batchState}PushBatch(){const e=this._batch;return this._batchPtr===e.length&&e.push(new C3$jscomp$50.Gfx.WebGLBatchJob(this._batchState)),e[this._batchPtr++]}EndBatch(){0===this._batchPtr||this.IsContextLost()||(this._WriteBuffers(),this._ExecuteBatch(),this._topOfBatch=this._pointPtr=this._texPtr=this._vertexPtr=this._batchPtr=0)}_WriteBuffers(){const e=this._gl;0<this._pointPtr&&(e.bindBuffer(e.ARRAY_BUFFER,this._pointBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._pointData.subarray(0,this._pointPtr))),0<this._vertexPtr&&(e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._vertexData.subarray(0,this._vertexPtr)),e.bindBuffer(e.ARRAY_BUFFER,this._texcoordBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._texcoordData.subarray(0,this._texPtr)))}_ExecuteBatch(){const e=this._batch;for(let t=0,s=this._batchPtr;t<s;++t)e[t].Run()}GetOpacity(){return this._lastColor.getA()}SetColorRgba(e,t,s,i){const r=this._lastColor;r.equalsRgba(e,t,s,i)||(r.setRgba(e,t,s,i),this.PushBatch().InitSetColor(r),this._topOfBatch=0,this._currentStateGroup=null)}SetOpacity(e){const t=this._lastColor;t.getA()!==e&&(t.setA(e),this.PushBatch().InitSetColor(t),this._topOfBatch=0,this._currentStateGroup=null)}SetColor(e){const t=this._lastColor;t.equals(e)||(t.set(e),this.PushBatch().InitSetColor(t),this._topOfBatch=0,this._currentStateGroup=null)}ResetColor(){this.SetColorRgba(1,1,1,1)}GetColor(){return this._lastColor}SetTexture(e){e!==this._lastTexture0&&(this.PushBatch().InitSetTexture(e),this._lastTexture0=e,this._topOfBatch=0)}_ResetLastTexture(){this._lastTexture0=null}SetBlendMode(e){e=this._GetBlendByIndex(e),this._SetBlend(e[0],e[1])}SetNamedBlendMode(e){e=this.GetNamedBlend(e),this._SetBlend(e.srcBlend,e.destBlend)}_SetBlend(e,t){e===this._lastSrcBlend&&t===this._lastDestBlend||(this.PushBatch().InitSetBlend(e,t),this._lastSrcBlend=e,this._lastDestBlend=t,this._topOfBatch=0,this._currentStateGroup=null)}IsPremultipliedAlphaBlend(){return this._lastSrcBlend===this._gl.ONE&&this._lastDestBlend===this._gl.ONE_MINUS_SRC_ALPHA}SetAlphaBlend(){this._SetBlend(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)}SetNoPremultiplyAlphaBlend(){this._SetBlend(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA)}SetCopyBlend(){this._SetBlend(this._gl.ONE,this._gl.ZERO)}Rect(e){this.Rect2(e.getLeft(),e.getTop(),e.getRight(),e.getBottom())}Rect2(e,t,s,i){this.Quad2(e,t,s,t,s,i,e,i)}_ExtendQuadBatch(){let e=this._vertexPtr;e>=this._lastVertexPtr&&(this.EndBatch(),e=0),1===this._topOfBatch?this._batch[this._batchPtr-1]._indexCount+=6:(this.PushBatch().InitQuad(e,6),this._topOfBatch=1)}_WriteQuadToVertexBuffer(e){e.writeToTypedArray3D(this._vertexData,this._vertexPtr,this._baseZ+this._currentZ),this._vertexPtr+=12}Quad(e){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),defaultTexCoordsQuad$jscomp$1.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad2(e,t,s,i,r,n,a,o){this._ExtendQuadBatch();const h=this._vertexData;let l=this._vertexPtr;const c=this._baseZ+this._currentZ;h[l++]=e,h[l++]=t,h[l++]=c,h[l++]=s,h[l++]=i,h[l++]=c,h[l++]=r,h[l++]=n,h[l++]=c,h[l++]=a,h[l++]=o,h[l++]=c,this._vertexPtr=l,defaultTexCoordsQuad$jscomp$1.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3(e,t){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),t.writeAsQuadToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad4(e,t){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),t.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3D(e,t,s,i,r,n,a,o,h,l,c,u,p){this._ExtendQuadBatch();const _=this._vertexData;let m=this._vertexPtr;const d=this._baseZ+this._currentZ;_[m++]=e,_[m++]=t,_[m++]=d+s,_[m++]=i,_[m++]=r,_[m++]=d+n,_[m++]=a,_[m++]=o,_[m++]=d+h,_[m++]=l,_[m++]=c,_[m++]=d+u,this._vertexPtr=m,p.writeAsQuadToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3D2(e,t,s,i,r,n,a,o,h,l,c,u,p){this._ExtendQuadBatch();const _=this._vertexData;let m=this._vertexPtr;const d=this._baseZ+this._currentZ;_[m++]=e,_[m++]=t,_[m++]=d+s,_[m++]=i,_[m++]=r,_[m++]=d+n,_[m++]=a,_[m++]=o,_[m++]=d+h,_[m++]=l,_[m++]=c,_[m++]=d+u,this._vertexPtr=m,p.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}FullscreenQuad(e,t){mat4$jscomp$7.copy(tmpProjection,this._matP),mat4$jscomp$7.copy(tmpModelView,this._matMV),this.SetDefaultRenderTargetProjectionState();const[s,i]=this.GetRenderTargetSize(this._currentRenderTarget);var r=this.CalculateLookAtModelView2(0,0,this.GetDefaultCameraZ(i),0,0,0,i);if(this.SetModelViewMatrix(r),"crop"===e&&this._currentRenderTarget&&t){e=this._width/2,r=this._height/2;const s=t.GetWidth();t=t.GetHeight();var n=this._currentRenderTarget.GetWidth(),a=this._currentRenderTarget.GetHeight();n=Math.min(n,s);const i=Math.min(a,t),o=Math.max(t-a,0);a=Math.max(a-t,0),tmpRect$jscomp$1.set(-e,r-a,-e+n,r-i-a),tmpQuad$jscomp$1.setFromRect(tmpRect$jscomp$1),tmpRect$jscomp$1.set(0,o,n,i+o),tmpRect$jscomp$1.divide(s,t),this.Quad3(tmpQuad$jscomp$1,tmpRect$jscomp$1)}else e=s/2,r=i/2,this.Rect2(-e,r,e,-r);this.SetProjectionMatrix(tmpProjection),this.SetModelViewMatrix(tmpModelView)}StartRenderingPoints(e){this._lastPointTexCoords.equals(e)||(this._lastPointTexCoords.copy(e),this.PushBatch().InitSetPointTexCoords(e),this._topOfBatch=0)}FinishRenderingPoints(){}Point(e,t,s,i){this._pointPtr>=LAST_POINT&&this.EndBatch();let r=this._pointPtr;var n=this._baseZ+this._currentZ;2===this._topOfBatch&&this._lastPointZ===n?this._batch[this._batchPtr-1]._indexCount++:(this.PushBatch().InitPoints(r,n),this._topOfBatch=2,this._lastPointZ=n),(n=this._pointData)[r++]=e,n[r++]=t,n[r++]=s,n[r++]=i,this._pointPtr=r}SetProgram(e){this._lastProgram!==e&&(this.PushBatch().InitSetProgram(e),this._lastProgram=e,this._topOfBatch=0,this._currentStateGroup=null)}SetDeviceTransformTextureFillMode(){this.SetProgram(this._spDeviceTransformTextureFill)}SetGradientColor(e){this.PushBatch().InitSetGradientColor(e),this._topOfBatch=0}SetEllipseParams(e,t,s=1){this.PushBatch().InitSetEllipseParams(e,t,s),this._topOfBatch=0}SetTilemapInfo(e,t,s,i,r,n,a){if(this._lastProgram!==this._spTilemapFill)throw Error("must set tilemap fill mode first");this.PushBatch().InitSetTilemapInfo(e,t,s,i,r,n,a),this._topOfBatch=0}SetTileRandomizationInfo(e,t,s,i,r,n,a){if(this._lastProgram!==this._spTileRandomization)throw Error("must set tile randomization mode first");this.PushBatch().InitSetTileRandomizationInfo(e,t,s,i,r,n,a),this._topOfBatch=0}SetProgramParameters(e,t,s,i,r,n,a,o,h,l,c){const u=this._lastProgram;if(u._hasAnyOptionalUniforms&&!u.AreOptionalUniformsAlreadySetInBatch(t,s,i,r,n,a,o,h,l,c)){var p=this.PushBatch();p.InitSetProgramParameters(),u.SetOptionalUniformsInBatch(t,s,i,r,n,a,o,h,l,c);var _=p._mat4param;_[0]=n,_[1]=a,t.writeToTypedArray(_,2),_[6]=h,_[7]=l,s.writeToTypedArray(_,12),t=p._colorParam,r.writeToTypedArray(t,0),r=t[1],t[1]=t[3],t[3]=r,i.writeToTypedArray(p._srcOriginRect,0),p._startIndex=c,p._indexCount=o,u._uSamplerBack.IsUsed()?p._texParam=e?e.GetTexture():null:p._texParam=null,this._topOfBatch=0}}SetProgramCustomParameters(e){const t=this._lastProgram;if(0!==e.length&&!t.AreCustomParametersAlreadySetInBatch(e)){var s=this.PushBatch();s.InitSetProgramCustomParameters(),t.SetCustomParametersInBatch(e),C3$jscomp$50.shallowAssignArray(s._shaderParams,e),this._topOfBatch=0}}ClearRgba(e,t,s,i){this.PushBatch().InitClearSurface2(e,t,s,i),this._topOfBatch=0}Clear(e){this.PushBatch().InitClearSurface(e),this._topOfBatch=0}Start(){}Finish(){super.Finish(),this._gl.flush()}ClearDepth(){this._usesDepthBuffer&&this._currentRenderTarget&&this._currentRenderTarget.HasDepthBuffer()&&(this.PushBatch().InitClearDepth(this._isDepthEnabled),this._topOfBatch=0)}SetDepthEnabled(e){e=!!e,this._isDepthEnabled!==e&&this._usesDepthBuffer&&(this._isDepthEnabled=e,this.PushBatch().InitSetDepthEnabled(e),this._topOfBatch=0)}IsDepthEnabled(){return this._isDepthEnabled}_GetDepthBuffer(){return this._depthBuffer}_CanSampleDepth(){return this._canSampleDepth}SetDepthSamplingEnabled(e){if(e=!!e,this._canSampleDepth&&this._isDepthSamplingEnabled!==e){if(e&&this.IsDepthEnabled())throw Error("depth still enabled");this._isDepthSamplingEnabled=e,this.PushBatch().InitSetDepthSamplingEnabled(e),this._topOfBatch=0}}SetScissorRect(e,t,s,i,r=0){e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),i=Math.floor(i),this._lastScissorRect.equalsWH(e,t,s,i)||(this._lastScissorRect.setWH(e,t,s,i),t=(r||this.GetRenderTargetSize(this.GetRenderTarget())[1])-t-i,this.PushBatch().InitSetScissor(!0,e,t,s,i),this._topOfBatch=0)}RemoveScissorRect(){-1!==this._lastScissorRect.getRight()&&(this._lastScissorRect.set(0,0,-1,-1),this.PushBatch().InitSetScissor(!1,0,0,0,0),this._topOfBatch=0)}CheckForQueryResults(){for(const e of this._allQueryResultBuffers)e.CheckForResults(this._frameNumber)}IsContextLost(){return!this._gl||this._gl.isContextLost()||this._isInitialisingAfterContextRestored}OnContextLost(){super.OnDeviceOrContextLost(),C3$jscomp$50.Gfx.WebGLRendererTexture.OnContextLost(),C3$jscomp$50.Gfx.WebGLRenderTarget.OnContextLost(),C3$jscomp$50.Gfx.RendererText.OnContextLost();for(const e of this._allQueryResultBuffers)e.Clear();this._extensions=[],this._textureLodExt=this._stdDerivativesExt=this._fragDepthExt=this._depthTextureExt=this._anisotropicExt=this._parallelShaderCompileExt=this._timerExt=null,this._maxAnisotropy=0,this._unmaskedRenderer=this._unmaskedVendor="(unavailable)",this._depthBuffer=this._spDeviceTransformTextureFill=this._lastProgram=null;for(const e of this._stateGroups.values())e.OnContextLost()}async OnContextRestored(){this._isInitialisingAfterContextRestored=!0,await this.InitState(),this._isInitialisingAfterContextRestored=!1;for(const e of this._stateGroups.values())e.OnContextRestored(this);this.SetSize(this._width,this._height,!0)}CreateStaticTexture(e,t){if(this.IsContextLost())throw Error("context lost");this.EndBatch();const s=C3$jscomp$50.New(C3$jscomp$50.Gfx.WebGLRendererTexture,this);return s._CreateStatic(e,t),s}async CreateStaticTextureAsync(e,t){if(this.IsContextLost())throw Error("context lost");if(t=Object.assign({},t),!C3$jscomp$50.Supports.ImageBitmapOptions||"Safari"===C3$jscomp$50.Platform.Browser&&e instanceof ImageData&&"undefined"!=typeof Image){if(e instanceof Blob){if("undefined"==typeof Image)throw Error("texture upload variant not supported in worker");e=await C3$jscomp$50.BlobToImage(e)}return await C3$jscomp$50.Asyncify((()=>this.CreateStaticTexture(e,t)))}let s=await createImageBitmap(e,{premultiplyAlpha:"premultiply"});const i=t.wrapX&&"clamp-to-edge"!==t.wrapX||t.wrapY&&"clamp-to-edge"!==t.wrapY,r=C3$jscomp$50.isPOT(s.width)&&C3$jscomp$50.isPOT(s.height);return this.SupportsNPOTTextures()||r||!i?t.premultiplyAlpha=!1:C3$jscomp$50.Supports.ImageBitmapOptionsResize?(s=await createImageBitmap(e,{premultiplyAlpha:"premultiply",resizeWidth:C3$jscomp$50.nextHighestPowerOfTwo(s.width),resizeHeight:C3$jscomp$50.nextHighestPowerOfTwo(s.height)}),t.premultiplyAlpha=!1):s=await createImageBitmap(e,{premultiplyAlpha:"none"}),await C3$jscomp$50.Asyncify((()=>this.CreateStaticTexture(s,t)))}CreateDynamicTexture(e,t,s){this.EndBatch();const i=C3$jscomp$50.New(C3$jscomp$50.Gfx.WebGLRendererTexture,this);return i._CreateDynamic(e,t,s),i}UpdateTexture(e,t,s){this.EndBatch(),t._Update(e,s)}DeleteTexture(e){e&&(e.SubtractReference(),0<e.GetReferenceCount()||(this.EndBatch(),e===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),e===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),e._Delete()))}CreateRenderTarget(e){let t=this._width,s=this._height,i=!0;if(e&&("number"==typeof e.width&&(t=e.width,i=!1),"number"==typeof e.height&&(s=e.height,i=!1)),0>=t||0>=s)throw Error("invalid size");this.EndBatch();const r=C3$jscomp$50.New(C3$jscomp$50.Gfx.WebGLRenderTarget,this);return r._Create(t,s,Object.assign({isDefaultSize:i},e)),this._currentRenderTarget=null,this._batchState.currentFramebuffer=null,this._batchState.currentFramebufferNoDepth=null,r}SetRenderTarget(e,t=!0){e!==this._currentRenderTarget&&(e&&e.IsDefaultSize()&&e._Resize(this._width,this._height),this.PushBatch().InitSetRenderTarget(e),this._currentRenderTarget=e,this._topOfBatch=0,t&&this.SetDefaultRenderTargetProjectionState())}GetRenderTarget(){return this._currentRenderTarget}GetRenderTargetSize(e){return e?[e.GetWidth(),e.GetHeight()]:[this._width,this._height]}CopyRenderTarget(e,t="stretch"){2>this._version||this._currentRenderTarget&&0<this._currentRenderTarget.GetMultisampling()?(this.SetCopyBlend(),this.ResetColor(),this.DrawRenderTarget(e,t)):(this.PushBatch().InitBlitFramebuffer(e,this._currentRenderTarget,t),this._topOfBatch=0)}DrawRenderTarget(e,t="stretch"){if(!(e=e.GetTexture()))throw Error("not a texture-backed render target");this.SetTexture(e),this.FullscreenQuad(t,e)}InvalidateRenderTarget(e){2>this._version||(this.PushBatch().InitInvalidateFramebuffer(e._GetFramebuffer()),this._topOfBatch=0)}DeleteRenderTarget(e){this.SetRenderTarget(null),this.EndBatch();const t=e.GetTexture();t===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),t===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),e._Delete()}async ReadBackRenderTargetToImageData(e,t,s){this.EndBatch();const i=this._currentRenderTarget;if(e)var r=e.GetWidth(),n=e.GetHeight(),a=e._GetFramebuffer();else r=this.GetWidth(),n=this.GetHeight(),a=null;let o=e=0;var h=r,l=n;s&&(e=C3$jscomp$50.clamp(Math.floor(s.getLeft()),0,r-1),o=C3$jscomp$50.clamp(Math.floor(s.getTop()),0,n-1),h=0===(h=s.width())?r-e:C3$jscomp$50.clamp(Math.floor(h),0,r-e),o=n-(o+(l=0===(l=s.height())?n-o:C3$jscomp$50.clamp(Math.floor(l),0,n-o))));const c=this._gl;if(c.bindFramebuffer(c.FRAMEBUFFER,a),n=()=>{c.bindFramebuffer(c.FRAMEBUFFER,null),this._currentRenderTarget=null,this._batchState.currentFramebuffer=null,this._batchState.currentFramebufferNoDepth=null,this.SetRenderTarget(i)},!t&&2<=this.GetWebGLVersionNumber()){c.bindFramebuffer(c.READ_FRAMEBUFFER,a),a=c.createBuffer(),s=h*l*4,r=c.PIXEL_PACK_BUFFER,c.bindBuffer(r,a),c.bufferData(r,s,c.STREAM_READ),c.readPixels(e,o,h,l,c.RGBA,c.UNSIGNED_BYTE,0),c.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.bindBuffer(r,null),n();const i=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);await this._WaitForObjectReady((()=>c.getSyncParameter(i,c.SYNC_STATUS)===c.SIGNALED)),c.deleteSync(i),t=new ImageData(h,l),c.bindBuffer(r,a),c.getBufferSubData(r,0,new Uint8Array(t.data.buffer),0,s),c.bindBuffer(r,null),c.deleteBuffer(a)}else t=new ImageData(h,l),c.readPixels(e,o,h,l,c.RGBA,c.UNSIGNED_BYTE,new Uint8Array(t.data.buffer)),n();return t}CoplanarStartStencilPass(){this.SetDepthEnabled(!0),this.PushBatch().InitCoplanarStartStencilPass(),this._topOfBatch=0}CoplanarStartColorPass(){this.SetDepthEnabled(!1),this.PushBatch().InitCoplanarStartColorPass(),this._topOfBatch=0}CoplanarRestoreStandardRendering(){this.SetDepthEnabled(!0),this.PushBatch().InitCoplanarRestore(),this._topOfBatch=0}StartQuery(e){this.SupportsGPUProfiling()&&(this.PushBatch().InitStartQuery(e),this._topOfBatch=0)}EndQuery(e){this.SupportsGPUProfiling()&&(this.PushBatch().InitEndQuery(e),this._topOfBatch=0)}_WaitForObjectReady(e){const t=new Promise((t=>pendingPolls.add({resolve:t,checkFunc:e})));return-1===pollRafId&&(pollRafId=self.requestAnimationFrame(CheckPendingPolls)),t}IsDesynchronized(){return!!this._attribs.desynchronized}GetEstimatedBackBufferMemoryUsage(){return this._width*this._height*(this._attribs.alpha?4:3)}GetEstimatedRenderBufferMemoryUsage(){let e=0;for(const t of C3$jscomp$50.Gfx.WebGLRenderTarget.allRenderTargets())t.GetTexture()||(e+=t.GetEstimatedMemoryUsage());return e}GetEstimatedTextureMemoryUsage(){let e=0;for(const t of C3$jscomp$50.Gfx.WebGLRendererTexture.allTextures())e+=t.GetEstimatedMemoryUsage();return e}GetEstimatedTotalMemoryUsage(){return this.GetEstimatedBackBufferMemoryUsage()+this.GetEstimatedRenderBufferMemoryUsage()+this.GetEstimatedTextureMemoryUsage()}GetWebGLVersionString(){return this._versionString}GetWebGLVersionNumber(){return this._version}GetDisplayName(){return"webgl"+this.GetWebGLVersionNumber()}SupportsNPOTTextures(){return 2<=this.GetWebGLVersionNumber()}GetMaxTextureSize(){return this._maxTextureSize}GetMinPointSize(){return this._minPointSize}GetMaxPointSize(){return this._maxPointSize}SupportsHighP(){return 0!==this._highpPrecision}GetHighPPrecision(){return this._highpPrecision}GetUnmaskedVendor(){return this._unmaskedVendor}GetUnmaskedRenderer(){return this._unmaskedRenderer}GetWebGLExtensionsAnalyticsString(){if(2<=this.GetWebGLVersionNumber())return"webgl2";const e=[];return this._fragDepthExt&&e.push("EXT_frag_depth"),this._stdDerivativesExt&&e.push("OES_standard_derivatives"),this._textureLodExt&&e.push("EXT_shader_texture_lod"),0<e.length?"webgl1:"+e.join(","):"webgl1:none"}GetExtensions(){return this._extensions}SupportsGPUProfiling(){return!!this._timerExt}_GetDisjointTimerQueryExtension(){return this._timerExt}_GetParallelShaderCompileExtension(){return this._parallelShaderCompileExt}_GetAnisotropicExtension(){return this._anisotropicExt}_GetMaxAnisotropy(){return this._maxAnisotropy}_AddQueryResultBuffer(e){this._allQueryResultBuffers.add(e)}_RemoveQueryResultBuffer(e){this._allQueryResultBuffers.delete(e)}_GetTimeQueryStack(){return this._timeQueryStack}GetContext(){return this._gl}_InitBlendModes(e){this._InitBlendModeData([["normal",e.ONE,e.ONE_MINUS_SRC_ALPHA],["additive",e.ONE,e.ONE],["xor",e.ONE,e.ONE_MINUS_SRC_ALPHA],["copy",e.ONE,e.ZERO],["destination-over",e.ONE_MINUS_DST_ALPHA,e.ONE],["source-in",e.DST_ALPHA,e.ZERO],["destination-in",e.ZERO,e.SRC_ALPHA],["source-out",e.ONE_MINUS_DST_ALPHA,e.ZERO],["destination-out",e.ZERO,e.ONE_MINUS_SRC_ALPHA],["source-atop",e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],["destination-atop",e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA]])}CreateRendererText(){return C3$jscomp$50.New(C3$jscomp$50.Gfx.RendererText,this)}CreateWebGLText(){return this.CreateRendererText()}};const DEFAULT_CTOR_OPTS={getDrawSize:null,getRenderTarget:null,releaseRenderTarget:null,getTime:null,redraw:null};self.C3.Gfx.EffectChainManager=class{constructor(e){e=Object.assign({},DEFAULT_CTOR_OPTS,e),this._cbGetDrawSize=e.getDrawSize,this._cbGetRenderTarget=e.getRenderTarget,this._cbReleaseRenderTarget=e.releaseRenderTarget,this._cbGetTime=e.getTime,this._cbRedraw=e.redraw,this._webgpuBackTexture=null,this._allEffectChains=new Set}_AddEffectChain(e){this._allEffectChains.add(e)}_RemoveEffectChain(e){this._allEffectChains.delete(e)}OnContextLost(){this._webgpuBackTexture=null;for(const e of this._allEffectChains)e.OnContextLost()}GetDrawSize(e){return this._cbGetDrawSize?this._cbGetDrawSize(e):[e.GetWidth(),e.GetHeight()]}GetRenderTarget(e){return this._cbGetRenderTarget(e)}ReleaseRenderTarget(e,t){this._cbReleaseRenderTarget(e,t)}GetTime(){return this._cbGetTime()}Redraw(e){this._cbRedraw(e)}_GetWebGPUBackTexture(e,t,s){return!this._webgpuBackTexture||this._webgpuBackTexture.GetWidth()===t&&this._webgpuBackTexture.GetHeight()===s||(e.DeleteTexture(this._webgpuBackTexture),this._webgpuBackTexture=null),null===this._webgpuBackTexture&&(this._webgpuBackTexture=e.CreateStaticTexture(null,{width:t,height:s,sampling:"nearest",mipMap:!1})),this._webgpuBackTexture}};const C3$jscomp$52=self.C3,mat4$jscomp$8=self.glMatrix.mat4,tempRect=C3$jscomp$52.New(C3$jscomp$52.Rect),tempRect2=C3$jscomp$52.New(C3$jscomp$52.Rect),tempRect3=C3$jscomp$52.New(C3$jscomp$52.Rect),tempRect4=C3$jscomp$52.New(C3$jscomp$52.Rect),tempMat4a=mat4$jscomp$8.create(),tempMat4b$jscomp$1=mat4$jscomp$8.create(),DEFAULT_CTOR_OPTS$jscomp$1={drawContent:null,getSourceTextureInfo:null,getShaderParameters:null,invalidateRenderTargets:!1},DEFAULT_BUILDSTEPS_OPTS={indexMap:null,forcePreDraw:!1,forcePostDraw:!1,is3D:!1,isSourceTextureRotated:!1,isRotatedOrNegativeSizeInstance:!1,useFullSurface:!1};C3$jscomp$52.Gfx.EffectChain=class{constructor(e,t){t=Object.assign({},DEFAULT_CTOR_OPTS$jscomp$1,t),this._manager=e,this._cbDrawContent=t.drawContent,this._cbGetSourceTextureInfo=t.getSourceTextureInfo,this._cbGetShaderParameters=t.getShaderParameters,this._cbDrawContentHook=null,this._shaderProgramList=[],this._shaderProgramIndices=[],this._steps=[],this._needsRebuild=!1,this._blendMode=0,this._isSourceTextureRotated=this._useFullSurface=this._canUseFastPath=this._depthEnabledAtStart=this._didChangeTransform=this._useCopyTextureBackgroundSampling=this._isAnyIsSrcTexRotated=this._isAnyShaderCrossSampling=this._isAnyShaderBackgroundBlending=this._isAnyShaderDepthSampling=this._isAnyShaderAnimated=!1,this._numTempSurfacesRequired=0,this._renderTargets=[null,null,null],this._invalidateRenderTargets=!!t.invalidateRenderTargets,this._drawHeight=this._drawWidth=this._boxExtendVertical=this._boxExtendHorizontal=0,this._contextObject=this._contentObject=null,this._layoutRect=C3$jscomp$52.New(C3$jscomp$52.Rect),this._drawSurfaceRect=C3$jscomp$52.New(C3$jscomp$52.Rect),this._rcTexOriginal=C3$jscomp$52.New(C3$jscomp$52.Rect),this._rcTexBounce=C3$jscomp$52.New(C3$jscomp$52.Rect),this._rcTexDest=C3$jscomp$52.New(C3$jscomp$52.Rect),this._layerScale=this._devicePixelRatio=1,this._time=this._layerAngle=0,this._backTex=this._destRenderTarget=null,this._compositOffY=this._compositOffX=0,this._updateOwnProjection=!1,this._projectionMatrix=mat4$jscomp$8.create(),this._modelViewMatrix=mat4$jscomp$8.create(),this._manager._AddEffectChain(this)}Release(){this._manager._RemoveEffectChain(this),C3$jscomp$52.clearArray(this._steps),C3$jscomp$52.clearArray(this._shaderProgramList),C3$jscomp$52.clearArray(this._shaderProgramIndices),this._cbGetShaderParameters=this._cbGetSourceTextureInfo=this._cbDrawContent=this._contextObject=this._contentObject=null}OnContextLost(){this._needsRebuild=!0,C3$jscomp$52.clearArray(this._steps),C3$jscomp$52.clearArray(this._shaderProgramList),C3$jscomp$52.clearArray(this._shaderProgramIndices)}NeedsRebuild(){return this._needsRebuild}BuildSteps(e,t){if(t=Object.assign({},DEFAULT_BUILDSTEPS_OPTS,t),C3$jscomp$52.clearArray(this._steps),this._boxExtendVertical=this._boxExtendHorizontal=0,this._useCopyTextureBackgroundSampling=this._isAnyIsSrcTexRotated=this._isAnyShaderCrossSampling=this._isAnyShaderBackgroundBlending=this._isAnyShaderDepthSampling=this._isAnyShaderAnimated=!1,this._numTempSurfacesRequired=0,this._isSourceTextureRotated=!!t.isSourceTextureRotated,this._useFullSurface=!!t.useFullSurface,this._needsRebuild=!1,C3$jscomp$52.shallowAssignArray(this._shaderProgramList,e),0!==e.length){if(t.indexMap){if(t.indexMap.length!==e.length)throw Error("incorrect indexMap length");C3$jscomp$52.shallowAssignArray(this._shaderProgramIndices,t.indexMap)}else{C3$jscomp$52.clearArray(this._shaderProgramIndices);for(let t=0,s=e.length;t<s;++t)this._shaderProgramIndices.push(t)}for(var s of e)this._boxExtendHorizontal+=s.GetBoxExtendHorizontal(),this._boxExtendVertical+=s.GetBoxExtendVertical(),s.IsAnimated()&&(this._isAnyShaderAnimated=!0),s.UsesDepth()&&(this._isAnyShaderDepthSampling=!0),s.BlendsBackground()&&(this._isAnyShaderBackgroundBlending=!0),s.UsesCrossSampling()&&(this._isAnyShaderCrossSampling=!0),s.UsesIsSrcTexRotated()&&(this._isAnyIsSrcTexRotated=!0);if(this._useCopyTextureBackgroundSampling=this._ShouldUseCopyTextureBackgroundSampling(e[0].GetRenderer()),s=this._ShouldPreDraw(e[0],t),t=this._ShouldPostDraw(e.at(-1),t),1!==e.length||s||t){this._canUseFastPath=!1;var i=0;s&&(this._numTempSurfacesRequired=1,this._steps.push(C3$jscomp$52.New(C3$jscomp$52.Gfx.EffectChain.Step.PreDraw,this,-1,1)),i=1);for(let r=0,n=e.length;r<n;++r)0!==r||s?(e=1===i?2:1,r!==n-1||t||(e=0),this._numTempSurfacesRequired=Math.max(this._numTempSurfacesRequired,e),this._steps.push(C3$jscomp$52.New(C3$jscomp$52.Gfx.EffectChain.Step.Bounce,this,i,e,r)),i=e):(this._numTempSurfacesRequired=1,this._steps.push(C3$jscomp$52.New(C3$jscomp$52.Gfx.EffectChain.Step.FirstBounce,this,-1,1,r)),i=1);t&&this._steps.push(C3$jscomp$52.New(C3$jscomp$52.Gfx.EffectChain.Step.PostDraw,this,i,0))}else this._canUseFastPath=!0}}_ShouldPreDraw(e,t){return!(!(t.forcePreDraw||e.MustPreDraw()||t.is3D||e.UsesDepth()&&!this._useFullSurface)&&(0===this._boxExtendHorizontal&&0===this._boxExtendVertical||this._useFullSurface))||!!e.GetRenderer().IsWebGL()&&(e.BlendsBackground()&&(t.isRotatedOrNegativeSizeInstance||t.isSourceTextureRotated)||e.UsesAnySrcRectOrPixelSize()&&t.isSourceTextureRotated)}_ShouldPostDraw(e,t){return!!t.forcePostDraw||(e.GetRenderer().IsWebGL()?e.BlendsBackground()||e.UsesCrossSampling():(e.BlendsBackground()||e.UsesCrossSampling())&&this._UseRenderTargetBackgroundSampling())}_ShouldUseCopyTextureBackgroundSampling(e){return e.IsWebGPU()&&this._isAnyShaderBackgroundBlending&&!this._isAnyShaderCrossSampling}Render(e,t,s){e.IsWebGPU()&&null===t&&(t=e.GetBackbufferRenderTarget()),this._destRenderTarget=t,this._contentObject=s.contentObject||null,this._contextObject=s.contextObject||null,this._blendMode=s.blendMode||0,this._devicePixelRatio=s.devicePixelRatio||1,this._layerScale=s.layerScale||1,this._layerAngle=s.layerAngle||0,this._time="number"==typeof s.time?s.time:this._manager.GetTime(),this._didChangeTransform=!1,e.ResetDidChangeTransformFlag(),this._isAnyShaderAnimated&&this._Redraw();let i=!1;if(this._UseCopyTextureBackgroundSampling()&&(this._CalculateDrawSizeAndRectangles(e,s),i=!0,this._backTex=this._manager._GetWebGPUBackTexture(e,this._drawWidth,this._drawHeight),tempRect.copy(this._drawSurfaceRect),tempRect.roundOuter(),e.CopyTextureToTexture(this._destRenderTarget.GetTexture(),this._backTex,tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height())),this._canUseFastPath)this._Render_FastPath(e,s);else{i||this._CalculateDrawSizeAndRectangles(e,s),e.ResetColor(),e.SetBaseZ(0),e.SetCurrentZ(0),this._cbDrawContentHook=s.drawContentHook||null,this._compositOffX=s.compositOffX||0,this._compositOffY=s.compositOffY||0,this._updateOwnProjection=!!s.updateOwnProjection,this._OnBeforeStartEffectChain(e),this._renderTargets[0]=t,this._renderTargets[1]=1<=this._numTempSurfacesRequired?this._GetRenderTarget():null,this._renderTargets[2]=2===this._numTempSurfacesRequired?this._GetRenderTarget():null;for(const i of this._steps)t=this._GetRenderTargetForId(i.GetSrcTargetId()),s=this._GetRenderTargetForId(i.GetDestTargetId()),e.IsWebGPU()?i.Run_WebGPU(e,t,s):i.Run_WebGL(e,t,s);this._renderTargets[1]&&this._ReleaseRenderTarget(this._renderTargets[1]),this._renderTargets[2]&&this._ReleaseRenderTarget(this._renderTargets[2]),this._renderTargets.fill(null),this._OnAfterEndEffectChain(e),this._cbDrawContentHook=this._contextObject=this._contentObject=this._backTex=this._destRenderTarget=null}}_CalculateDrawSizeAndRectangles(e,t){const[s,i]=this._manager.GetDrawSize(e);this._SetDrawSize(e,s,i),this._CalculateRectangles(t)}_SetDrawSize(e,t,s){if(0>=t||0>=s)throw Error("invalid draw size");this._drawWidth===t&&this._drawHeight===s||this._CalculateDeviceTransformMatrices(e,t,s,0,0,this._projectionMatrix,this._modelViewMatrix),this._drawWidth=t,this._drawHeight=s}_CalculateDeviceTransformMatrices(e,t,s,i,r,n,a){i=t/2+i,r=s/2+r,e.CalculatePerspectiveMatrix(n,t/s),e=e.CalculateLookAtModelView2(i,r,e.GetDefaultCameraZ(s),i,r,0,s),mat4$jscomp$8.copy(a,e)}_CalculateRectangles(e){this._layoutRect.copy(e.layoutRect),e.drawSurfaceRect?this._drawSurfaceRect.copy(e.drawSurfaceRect):this._drawSurfaceRect.set(0,0,this._drawWidth,this._drawHeight),this._rcTexOriginal.copy(this._drawSurfaceRect),this._rcTexOriginal.divide(this._drawWidth,this._drawHeight),e=this._layerScale*this._devicePixelRatio,this._drawSurfaceRect.inflate(this._boxExtendHorizontal*e,this._boxExtendVertical*e),this._rcTexDest.copy(this._drawSurfaceRect),this._rcTexDest.divide(this._drawWidth,this._drawHeight),this._drawSurfaceRect.clamp(0,0,this._drawWidth,this._drawHeight),this._rcTexBounce.copy(this._drawSurfaceRect),this._rcTexBounce.divide(this._drawWidth,this._drawHeight)}_OnBeforeStartEffectChain(e){if(this._depthEnabledAtStart=e.IsDepthEnabled(),this._useFullSurface)e.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&e.SetDepthSamplingEnabled(!0);else{if(tempRect.copy(this._drawSurfaceRect),e.IsWebGL()){const e=this._layerScale*this._devicePixelRatio;tempRect.inflate(Math.max(this._boxExtendHorizontal,1)*e,Math.max(this._boxExtendVertical,1)*e),tempRect.roundOuter(),tempRect.clamp(0,0,this._drawWidth,this._drawHeight)}else tempRect.roundOuter();e.SetScissorRect(tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height(),this._drawHeight)}}_OnAfterEffectChainDrawContent(e){e.ResetColor(),this._useFullSurface||(e.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&e.SetDepthSamplingEnabled(!0)),e.IsWebGPU()&&e.SetNormalizedCoordsProgramVariant(!0)}_OnAfterEndEffectChain(e){e.SetDepthSamplingEnabled(!1),e.SetDepthEnabled(this._depthEnabledAtStart),this._useFullSurface||e.RemoveScissorRect(),e.IsWebGPU()&&e.SetNormalizedCoordsProgramVariant(!1),this._didChangeTransform=e.DidChangeTransform()}_ClampRcTexDest(){this._rcTexDest.clamp(0,0,1,1)}_GetRenderTargetForId(e){return 0>e?null:this._renderTargets[e]}_GetRenderTarget(){return this._manager.GetRenderTarget(this)}_GetDestRenderTarget(){return this._destRenderTarget}_ReleaseRenderTarget(e){this._manager.ReleaseRenderTarget(e,this)}_GetShaderProgramAt(e){return this._shaderProgramList[e]}_DrawContent(e){this._cbDrawContentHook?this._cbDrawContentHook(this,e,(()=>this._cbDrawContent(e,this))):this._cbDrawContent(e,this),this._canUseFastPath||this._OnAfterEffectChainDrawContent(e)}_IsRenderTargetSameSizeAndOffset(e){if(this._useFullSurface)return!0;if(0!==this._compositOffX||0!==this._compositOffY)return!1;const[t,s]=e.GetRenderTargetSize(e.GetRenderTarget());return t===this._drawWidth&&s===this._drawHeight}_SetDeviceTransform(e,t){let s=this._projectionMatrix,i=this._modelViewMatrix;if(t&&!this._IsRenderTargetSameSizeAndOffset(e)){s=tempMat4a,i=tempMat4b$jscomp$1;const[t,r]=e.GetRenderTargetSize(e.GetRenderTarget());this._CalculateDeviceTransformMatrices(e,t,r,this._compositOffX,this._compositOffY,s,i),this._useFullSurface||e.RemoveScissorRect()}e.SetProjectionMatrix(s),e.SetModelViewMatrix(i)}_Redraw(){this._manager.Redraw(this)}_GetShaderParameters(e){return this._cbGetShaderParameters(this._shaderProgramIndices[e])}_SetProgramParameters(e,t){let s=this._rcTexDest,i=this._rcTexBounce,r=this._rcTexOriginal;e.IsWebGL()&&(tempRect2.copy(s),tempRect2.flipAround(1),s=tempRect2,tempRect3.copy(i),tempRect3.flipAround(1),i=tempRect3,tempRect4.copy(r),tempRect4.flipAround(1),r=tempRect4),this._DoSetProgramParameters(e,t,i,r,s,1/this._drawWidth,1/this._drawHeight)}_SetFirstBounceProgramParameters(e,t){let s=this._rcTexBounce,i=this._rcTexOriginal,r=1/this._drawWidth,n=1/this._drawHeight;if(this._cbGetSourceTextureInfo){let{srcTexRect:e,srcWidth:t,srcHeight:a}=this._cbGetSourceTextureInfo(this._contentObject);e||(tempRect.set(0,0,0,0),e=tempRect),t||(t=this._drawWidth),a||(a=this._drawHeight),i=s=e,r=1/t,n=1/a}else e.IsWebGL()&&(tempRect3.copy(s),tempRect3.flipAround(1),s=tempRect3,tempRect4.copy(i),tempRect4.flipAround(1),i=tempRect4);let a=this._rcTexDest;e.IsWebGL()&&(a=tempRect2,a.copy(this._rcTexDest),a.flipAround(1)),this._DoSetProgramParameters(e,t,s,i,a,r,n),e.IsWebGPU()&&this._isAnyIsSrcTexRotated&&e.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated)}_GetBackTex(e){return this._isAnyShaderBackgroundBlending?e.IsWebGPU()?this._UseCopyTextureBackgroundSampling()?this._backTex:this._destRenderTarget.GetTexture():this._destRenderTarget:null}_DoSetProgramParameters(e,t,s,i,r,n,a){e.SetProgramParameters(this._GetBackTex(e),r,s,i,this._layoutRect,n,a,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time),e.SetProgramCustomParameters(this._GetShaderParameters(t))}_Render_FastPath(e,t){var s=this._shaderProgramList[0];const i=e.IsDepthEnabled(),r=s.UsesDepth();let n;if(r&&(e.SetDepthEnabled(!1),e.SetDepthSamplingEnabled(!0),this._rcTexDest.set(0,0,1,1),this._rcTexOriginal.set(0,0,1,1)),e.SetProgram(s),e.SetBlendMode(this._blendMode),e.SetRenderTarget(this._destRenderTarget),this._rcTexOriginal.set(0,0,1,1),s.UsesAnySrcRectOrPixelSize()&&this._cbGetSourceTextureInfo){const{srcTexRect:e,srcWidth:t,srcHeight:i}=this._cbGetSourceTextureInfo(this._contentObject);e&&this._rcTexOriginal.copy(e),s=Number.isFinite(t)?1/t:0,n=Number.isFinite(i)?1/i:0}else{const[t,i]=this._manager.GetDrawSize(e);s=1/t,n=1/i}t.layoutRect?this._layoutRect.copy(t.layoutRect):this._layoutRect.set(0,0,0,0),e.SetProgramParameters(this._GetBackTex(e),this._rcTexDest,this._rcTexOriginal,this._rcTexOriginal,this._layoutRect,s,n,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time),e.SetProgramCustomParameters(this._GetShaderParameters(0)),e.IsWebGPU()&&this._isAnyIsSrcTexRotated&&e.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated),e.SetBaseZ(0),this._DrawContent(e),r&&(e.SetDepthSamplingEnabled(!1),e.SetDepthEnabled(i))}_UseCopyTextureBackgroundSampling(){return this._useCopyTextureBackgroundSampling}_UseRenderTargetBackgroundSampling(){return!this._useCopyTextureBackgroundSampling}IsAnyShaderBackgroundBlending(){return this._isAnyShaderBackgroundBlending}CanSkipCalculatingDrawSurfaceRect(){return!(!this._canUseFastPath||this._UseCopyTextureBackgroundSampling())}UseFullSurface(){return this._useFullSurface}GetContentObject(){return this._contentObject}GetContextObject(){return this._contextObject}_GetBlendMode(){return this._blendMode}_UpdateOwnProjection(){return this._updateOwnProjection}DidChangeTransform(){return this._didChangeTransform}_GetDrawSurfaceRect(){return this._drawSurfaceRect}_GetRcTexBounce(){return this._rcTexBounce}_ShouldInvalidateRenderTargets(){return this._invalidateRenderTargets}async DebugLogRenderTargetContents(e,t,s){}},self.C3.Gfx.EffectChain.Step=class{constructor(e,t,s,i=-1){this._effectChain=e,this._srcTargetId=t,this._destTargetId=s,this._index=i}GetEffectChain(){return this._effectChain}GetSrcTargetId(){return this._srcTargetId}GetDestTargetId(){return this._destTargetId}GetIndex(){return this._index}GetShaderProgram(){return this.GetEffectChain()._GetShaderProgramAt(this.GetIndex())}Run_WebGL(e,t,s){}Run_WebGPU(e,t,s){}};const C3$jscomp$54=self.C3;C3$jscomp$54.Gfx.EffectChain.Step.PreDraw=class extends C3$jscomp$54.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,t,s){t=this.GetEffectChain(),e.SetAlphaBlend(),e.SetTextureFillMode(),e.SetRenderTarget(s,t._UpdateOwnProjection()),e.ClearRgba(0,0,0,0),t._DrawContent(e),t._ClampRcTexDest()}Run_WebGPU(e,t,s){t=this.GetEffectChain(),e.SetAlphaBlend(),e.SetTextureFillMode(),e.SetRenderTarget(s,!1),e.ClearRgba(0,0,0,0),t._DrawContent(e),t._ClampRcTexDest()}};const C3$jscomp$55=self.C3,tempRect$jscomp$1=C3$jscomp$55.New(C3$jscomp$55.Rect),tempQuad$jscomp$1=C3$jscomp$55.New(C3$jscomp$55.Quad);C3$jscomp$55.Gfx.EffectChain.Step.PostDraw=class extends C3$jscomp$55.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,t,s){const i=this.GetEffectChain();e.SetTextureFillMode(),e.SetRenderTarget(s),i._SetDeviceTransform(e,!0),e.SetBlendMode(i._GetBlendMode()),e.SetTexture(t.GetTexture()),tempQuad$jscomp$1.setFromRect(i._GetDrawSurfaceRect()),tempRect$jscomp$1.copy(i._GetRcTexBounce()),tempRect$jscomp$1.flipAround(1),e.Quad3(tempQuad$jscomp$1,tempRect$jscomp$1),i._ShouldInvalidateRenderTargets()&&e.InvalidateRenderTarget(t)}Run_WebGPU(e,t,s){const i=this.GetEffectChain();e.SetTextureFillMode(),e.SetRenderTarget(s,!1),i._IsRenderTargetSameSizeAndOffset(e)?tempQuad$jscomp$1.setFromRect(i._GetRcTexBounce()):(e.SetNormalizedCoordsProgramVariant(!1),i._SetDeviceTransform(e,!0),tempQuad$jscomp$1.setFromRect(i._GetDrawSurfaceRect())),e.SetBackTexture(null),e.SetBlendMode(i._GetBlendMode()),e.SetTexture(t.GetTexture()),i.UseFullSurface()?e.FullscreenQuad():e.Quad3(tempQuad$jscomp$1,i._GetRcTexBounce())}};const C3$jscomp$56=self.C3;C3$jscomp$56.Gfx.EffectChain.Step.FirstBounce=class extends C3$jscomp$56.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,t,s){t=this.GetEffectChain(),e.SetRenderTarget(s,t._UpdateOwnProjection()),e.ClearRgba(0,0,0,0),e.SetCopyBlend(),e.SetProgram(this.GetShaderProgram()),t._SetFirstBounceProgramParameters(e,this.GetIndex()),t._DrawContent(e),t._ClampRcTexDest()}Run_WebGPU(e,t,s){t=this.GetEffectChain(),e.SetRenderTarget(s,!1),e.ClearRgba(0,0,0,0),e.SetCopyBlend(),e.SetProgram(this.GetShaderProgram()),t._SetFirstBounceProgramParameters(e,this.GetIndex()),t._DrawContent(e),t._ClampRcTexDest()}};const C3$jscomp$57=self.C3,tempRect$jscomp$2=C3$jscomp$57.New(C3$jscomp$57.Rect),tempQuad$jscomp$2=C3$jscomp$57.New(C3$jscomp$57.Quad);C3$jscomp$57.Gfx.EffectChain.Step.Bounce=class extends C3$jscomp$57.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,t,s){const i=this.GetEffectChain();e.SetRenderTarget(s),(s=0===this.GetDestTargetId())?e.SetBlendMode(i._GetBlendMode()):(e.ClearRgba(0,0,0,0),e.SetCopyBlend()),e.SetProgram(this.GetShaderProgram()),i._SetProgramParameters(e,this.GetIndex()),e.SetTexture(t.GetTexture()),i._SetDeviceTransform(e,s),tempQuad$jscomp$2.setFromRect(i._GetDrawSurfaceRect()),tempRect$jscomp$2.copy(i._GetRcTexBounce()),tempRect$jscomp$2.flipAround(1),e.Quad3(tempQuad$jscomp$2,tempRect$jscomp$2),i._ShouldInvalidateRenderTargets()&&e.InvalidateRenderTarget(t)}Run_WebGPU(e,t,s){const i=this.GetEffectChain();e.SetRenderTarget(s,!1),0===this.GetDestTargetId()?(e.SetBlendMode(i._GetBlendMode()),e.SetBackTexture(null),i._IsRenderTargetSameSizeAndOffset(e)?tempQuad$jscomp$2.setFromRect(i._GetRcTexBounce()):(e.SetNormalizedCoordsProgramVariant(!1),i._SetDeviceTransform(e,!0),tempQuad$jscomp$2.setFromRect(i._GetDrawSurfaceRect()))):(e.ClearRgba(0,0,0,0),e.SetCopyBlend(),tempQuad$jscomp$2.setFromRect(i._GetRcTexBounce())),e.SetProgram(this.GetShaderProgram()),i._SetProgramParameters(e,this.GetIndex()),e.SetTexture(t.GetTexture()),i.UseFullSurface()?e.FullscreenQuad():e.Quad3(tempQuad$jscomp$2,i._GetRcTexBounce())}};const C3$jscomp$58=self.C3,C3X$jscomp$1=self.C3X;let runtime$jscomp$1=null;const keysDownByKey=new Set;function SortZOrderList(e,t){const s=e[0]-t[0];return 0!==s?s:e[1]-t[1]}const tempZOrderList=[],tempInstances=[];let didWarnInAlertPolyfill=!1;self.IRuntime=class{constructor(e,t){runtime$jscomp$1=e,Object.defineProperties(this,{assets:{value:runtime$jscomp$1.GetAssetManager().GetIAssetManager(),writable:!1},objects:{value:t,writable:!1},globalVars:{value:{},writable:!1},projectName:{value:runtime$jscomp$1.GetProjectName(),writable:!1},projectVersion:{value:runtime$jscomp$1.GetProjectVersion(),writable:!1},storage:{value:new self.IStorage(runtime$jscomp$1),writable:!1},isInWorker:{value:runtime$jscomp$1.IsInWorker(),writable:!1},viewportWidth:{value:runtime$jscomp$1.GetOriginalViewportWidth(),writable:!1},viewportHeight:{value:runtime$jscomp$1.GetOriginalViewportHeight(),writable:!1}}),runtime$jscomp$1.UserScriptDispatcher().addEventListener("keydown",(e=>{keysDownByKey.has(e.key)?e.stopPropagation():keysDownByKey.add(e.key)})),runtime$jscomp$1.UserScriptDispatcher().addEventListener("keyup",(e=>keysDownByKey.delete(e.key))),runtime$jscomp$1.Dispatcher().addEventListener("window-blur",(()=>keysDownByKey.clear())),runtime$jscomp$1.IsInWorker()&&(self.alert=e=>(didWarnInAlertPolyfill||(didWarnInAlertPolyfill=!0),this.alert(e)))}_InitGlobalVars(e){Object.defineProperties(this.globalVars,e)}addEventListener(e,t){runtime$jscomp$1.UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){runtime$jscomp$1.UserScriptDispatcher().removeEventListener(e,t)}callFunction(e,...t){C3X$jscomp$1.RequireString(e);const s=runtime$jscomp$1.GetEventSheetManager(),i=s.GetFunctionBlockByName(e);if(!i)throw Error(`cannot find function name '${e}'`);if(!i.IsEnabled())return i.GetDefaultReturnValue();if(t.length<i.GetFunctionParameterCount())throw Error(`not enough function parameters passed for '${e}' (${t.length} passed, ${i.GetFunctionParameterCount()} expected)`);const r=i.GetEventBlock();e=null;var n=s.GetCurrentEvent();return n&&(0<(n=n.GetSolModifiersIncludingParents()).length&&(e=n,i.IsCopyPicked()?s.PushCopySol(n):s.PushCleanSol(n))),t=r.RunAsExpressionFunctionCall(r.GetSolModifiersIncludingParents(),i.IsCopyPicked(),i.GetReturnType(),i.GetDefaultReturnValue(),...t),e&&s.PopSol(e),t}setReturnValue(e){const t=runtime$jscomp$1.GetEventStack().GetCurrentExpFuncStackFrame();if(!t)throw Error("not in a function which returns a value");switch(t.GetFunctionReturnType()){case 1:"number"==typeof e&&t.SetFunctionReturnValue(e);break;case 2:"string"==typeof e&&t.SetFunctionReturnValue(e);break;case 3:"number"!=typeof e&&"string"!=typeof e||t.SetFunctionReturnValue(e)}}getViewportSize(){return[runtime$jscomp$1.GetOriginalViewportWidth(),runtime$jscomp$1.GetOriginalViewportHeight()]}get dt(){return runtime$jscomp$1.GetDt()}get gameTime(){return runtime$jscomp$1.GetGameTime()}get wallTime(){return runtime$jscomp$1.GetWallTime()}get fps(){return runtime$jscomp$1.GetFPS()}get cpuUtilisation(){return runtime$jscomp$1.GetMainThreadTime()}get gpuUtilisation(){return runtime$jscomp$1.GetGPUUtilisation()}random(){return runtime$jscomp$1.Random()}get layout(){return runtime$jscomp$1.GetMainRunningLayout().GetILayout()}getLayout(e){const t=runtime$jscomp$1.GetLayoutManager();if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");if(!(e=t.GetLayout(e)))throw Error("invalid layout");return e.GetILayout()}getAllLayouts(){return runtime$jscomp$1.GetLayoutManager().GetAllLayouts().map((e=>e.GetILayout()))}goToLayout(e){const t=runtime$jscomp$1.GetLayoutManager();if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");if(!(e=t.GetLayout(e)))throw Error("invalid layout");t.IsPendingChangeMainLayout()||t.ChangeMainLayout(e)}get keyboard(){const e=runtime$jscomp$1._GetCommonScriptInterfaces().keyboard;if(!e)throw Error("runtime.keyboard used but Keyboard object missing - add it to your project first");return e}get mouse(){const e=runtime$jscomp$1._GetCommonScriptInterfaces().mouse;if(!e)throw Error("runtime.mouse used but Mouse object missing - add it to your project first");return e}get touch(){const e=runtime$jscomp$1._GetCommonScriptInterfaces().touch;if(!e)throw Error("runtime.touch used but Touch object missing - add it to your project first");return e}invokeDownload(e,t){C3X$jscomp$1.RequireString(e),C3X$jscomp$1.RequireString(t),runtime$jscomp$1.InvokeDownload(e,t)}getInstanceByUid(e){return C3X$jscomp$1.RequireFiniteNumber(e),(e=runtime$jscomp$1.GetInstanceByUID(e))?e.GetInterfaceClass():null}sortZOrder(e,t){C3X$jscomp$1.RequireFunction(t);const s=runtime$jscomp$1.GetCurrentLayout();for(var i of e){var r=(e=runtime$jscomp$1._UnwrapIWorldInstance(i)).GetWorldInfo();tempZOrderList.push([r.GetLayer().GetIndex(),r.GetZIndex()]),tempInstances.push(e)}if(0!==tempZOrderList.length){tempZOrderList.sort(SortZOrderList),tempInstances.sort(((e,s)=>t(e.GetInterfaceClass(),s.GetInterfaceClass()))),i=!1;for(let t=0,n=tempZOrderList.length;t<n;++t){e=tempInstances[t],r=s.GetLayerByIndex(tempZOrderList[t][0]);const n=tempZOrderList[t][1],a=r._GetInstances();a[n]!==e&&(a[n]=e,e.GetWorldInfo()._SetLayer(r),r.SetZIndicesChanged(),i=!0)}i&&runtime$jscomp$1.UpdateRender(),C3$jscomp$58.clearArray(tempZOrderList),C3$jscomp$58.clearArray(tempInstances)}}async createWorker(e,t){var s=new MessageChannel;const i=s.port1;return s=s.port2,await runtime$jscomp$1.PostComponentMessageToDOMAsync("runtime","script-create-worker",{url:e,opts:t,port2:s},[s]),i}alert(e){return runtime$jscomp$1.PostComponentMessageToDOMAsync("runtime","alert",{message:e+(runtime$jscomp$1.IsInWorker()?" [via Web Worker]":"")})}};const C3$jscomp$59=self.C3;let assetManager=null;self.IAssetManager=class{constructor(e){assetManager=e,Object.defineProperties(this,{isWebMOpusSupported:{value:assetManager.IsAudioFormatSupported("audio/webm; codecs=opus"),writable:!1}})}fetchText(e){return assetManager.FetchText(e)}fetchJson(e){return assetManager.FetchJson(e)}fetchBlob(e){return assetManager.FetchBlob(e)}fetchArrayBuffer(e){return assetManager.FetchArrayBuffer(e)}getProjectFileUrl(e){return assetManager.GetProjectFileUrl(e)}getMediaFileUrl(e){return"flat"===assetManager.GetFileStructure()&&C3$jscomp$59.IsRelativeURL(e)&&(e=e.toLowerCase()),assetManager.GetMediaFileUrl(e)}get mediaFolder(){return assetManager.GetMediaSubfolder()}async decodeWebMOpus(e,t){if(this.isWebMOpusSupported)throw Error("decodeWebMOpus(): not supported because WebM Opus is supported by the platform");return t=await assetManager.GetRuntime()._WasmDecodeWebMOpus(t),t=new Float32Array(t),(e=e.createBuffer(1,t.length,48e3)).getChannelData(0).set(t),e}loadScripts(...e){return assetManager.LoadScripts(...e)}compileWebAssembly(e){return assetManager.CompileWebAssembly(e)}loadStyleSheet(e){return assetManager.LoadStyleSheet(e)}};const C3X$jscomp$3=self.C3X;self.IStorage=class{constructor(e){this._storage=e._GetProjectStorage()}getItem(e){return C3X$jscomp$3.RequireString(e),this._storage.getItem(e)}setItem(e,t){return C3X$jscomp$3.RequireString(e),this._storage.setItem(e,t)}removeItem(e){return C3X$jscomp$3.RequireString(e),this._storage.removeItem(e)}clear(){return this._storage.clear()}keys(){return this._storage.keys()}};const C3$jscomp$61=self.C3,C3X$jscomp$4=self.C3X,map$jscomp$2=new WeakMap;self.IObjectClass=class{constructor(e){map$jscomp$2.set(this,e),Object.defineProperties(this,{name:{value:e.GetName(),writable:!1}}),e.GetRuntime()._MapScriptInterface(this,e)}addEventListener(e,t){C3X$jscomp$4.RequireString(e),C3X$jscomp$4.RequireFunction(t),map$jscomp$2.get(this).UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){C3X$jscomp$4.RequireString(e),C3X$jscomp$4.RequireFunction(t),map$jscomp$2.get(this).UserScriptDispatcher().removeEventListener(e,t)}getAllInstances(){return[...this.instances()]}getFirstInstance(){return C3$jscomp$61.first(this.instances())}getPickedInstances(){return[...this.pickedInstances()]}getFirstPickedInstance(){return C3$jscomp$61.first(this.pickedInstances())}*instances(){for(const e of map$jscomp$2.get(this).instancesIncludingPendingCreate())yield e.GetInterfaceClass()}*pickedInstances(){for(const e of map$jscomp$2.get(this).GetCurrentSol().GetInstances())yield e.GetInterfaceClass()}setInstanceClass(e){if(C3X$jscomp$4.RequireFunction(e),0<map$jscomp$2.get(this).GetInstanceCount())throw Error("setInstanceClass() called too late, because instances have already been created - call in runOnStartup");map$jscomp$2.get(this)._SetUserScriptInstanceClass(e)}createInstance(e,t,s,i,r){if(C3X$jscomp$4.RequireNumber(t),C3X$jscomp$4.RequireNumber(s),"number"!=typeof e&&"string"!=typeof e)throw new TypeError("invalid layer parameter");const n=map$jscomp$2.get(this),a=n.GetRuntime();if(!(e=a.GetMainRunningLayout().GetLayer(e)))throw Error("invalid layer");return t=a.CreateInstance(n,e,t,s,i,r),i&&e.SortAndAddInstancesByZIndex(t),(i=a.GetEventSheetManager()).BlockFlushingInstances(!0),t._TriggerOnCreatedOnSelfAndRelated(),i.BlockFlushingInstances(!1),i.IsInEventEngine()||a.FlushPendingInstances(),t.GetInterfaceClass()}};const C3X$jscomp$5=self.C3X,map$jscomp$3=new WeakMap;self.ILayout=class{constructor(e){map$jscomp$3.set(this,e);const t=[],s=e.GetEffectList(),i=s.GetAllEffectTypes().length;for(let e=0;e<i;++e)t.push(new self.IEffectInstance(s,e));Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},index:{value:e.GetIndex(),writable:!1},effects:{value:t,writable:!1}})}addEventListener(e,t){C3X$jscomp$5.RequireString(e),C3X$jscomp$5.RequireFunction(t),map$jscomp$3.get(this).UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){C3X$jscomp$5.RequireString(e),C3X$jscomp$5.RequireFunction(t),map$jscomp$3.get(this).UserScriptDispatcher().removeEventListener(e,t)}get width(){return map$jscomp$3.get(this).GetWidth()}set width(e){C3X$jscomp$5.RequireFiniteNumber(e),map$jscomp$3.get(this).SetWidth(e)}get height(){return map$jscomp$3.get(this).GetHeight()}set height(e){C3X$jscomp$5.RequireFiniteNumber(e),map$jscomp$3.get(this).SetHeight(e)}setSize(e,t){C3X$jscomp$5.RequireFiniteNumber(e),C3X$jscomp$5.RequireFiniteNumber(t);const s=map$jscomp$3.get(this);s.SetWidth(e),s.SetHeight(t)}getSize(){const e=map$jscomp$3.get(this);return[e.GetWidth(),e.GetHeight()]}set scale(e){C3X$jscomp$5.RequireFiniteNumber(e),map$jscomp$3.get(this).SetScale(e)}get scale(){return map$jscomp$3.get(this).GetScale()}set angle(e){C3X$jscomp$5.RequireFiniteNumber(e),map$jscomp$3.get(this).SetAngle(e)}get angle(){return map$jscomp$3.get(this).GetAngle()}set scrollX(e){C3X$jscomp$5.RequireNumber(e),map$jscomp$3.get(this).SetScrollX(e)}get scrollX(){return map$jscomp$3.get(this).GetScrollX()}set scrollY(e){C3X$jscomp$5.RequireNumber(e),map$jscomp$3.get(this).SetScrollY(e)}get scrollY(){return map$jscomp$3.get(this).GetScrollY()}scrollTo(e,t){C3X$jscomp$5.RequireNumber(e),C3X$jscomp$5.RequireNumber(t);const s=map$jscomp$3.get(this);s.SetScrollX(e),s.SetScrollY(t)}getScrollPosition(){const e=map$jscomp$3.get(this);return[e.GetScrollX(),e.GetScrollY()]}getLayer(e){const t=map$jscomp$3.get(this);if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");return(e=t.GetLayer(e))?e.GetILayer():null}getAllLayers(){return map$jscomp$3.get(this).GetLayers().map((e=>e.GetILayer()))}*allLayers(){for(const e of map$jscomp$3.get(this).allLayers())yield e.GetILayer()}setVanishingPoint(e,t){C3X$jscomp$5.RequireFiniteNumber(e),C3X$jscomp$5.RequireFiniteNumber(t),map$jscomp$3.get(this).SetVanishingPointXY(e,t)}getVanishingPoint(){return map$jscomp$3.get(this)._GetVanishingPoint()}set projection(e){C3X$jscomp$5.RequireString(e);const t=map$jscomp$3.get(this);if("perspective"===e)t.SetPerspectiveProjection();else{if("orthographic"!==e)throw Error("invalid projection");t.SetOrthographicProjection()}}get projection(){return map$jscomp$3.get(this).IsOrthographicProjection()?"orthographic":"perspective"}};const C3$jscomp$63=self.C3,C3X$jscomp$6=self.C3X,map$jscomp$4=new WeakMap,BLEND_MODE_TO_INDEX=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),INDEX_TO_BLEND_MODE=new Map([...BLEND_MODE_TO_INDEX.entries()].map((e=>[e[1],e[0]]))),tempColor$jscomp$1=C3$jscomp$63.New(C3$jscomp$63.Color);self.ILayer=class{constructor(e){map$jscomp$4.set(this,e);const t=[],s=e.GetEffectList(),i=s.GetAllEffectTypes().length;for(let e=0;e<i;++e)t.push(new self.IEffectInstance(s,e));Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},index:{value:e.GetIndex(),writable:!1},layout:{value:e.GetLayout().GetILayout(),writable:!1},effects:{value:t,writable:!1}})}static _Unwrap(e){return map$jscomp$4.get(e)}get parentLayer(){const e=map$jscomp$4.get(this).GetParentLayer();return e?e.GetILayer():null}*parentLayers(){for(const e of map$jscomp$4.get(this).parentLayers())yield e.GetILayer()}*subLayers(){for(const e of map$jscomp$4.get(this).GetSubLayers())yield e.GetILayer()}*allSubLayers(){for(const e of map$jscomp$4.get(this).GetSubLayers())for(const t of e.selfAndAllSubLayers())yield t.GetILayer()}get isVisible(){return map$jscomp$4.get(this)._IsVisibleFlagSet()}set isVisible(e){map$jscomp$4.get(this).SetVisible(e)}get isSelfAndParentsVisible(){return map$jscomp$4.get(this).IsVisible()}get isInteractive(){return map$jscomp$4.get(this).IsInteractive()}set isInteractive(e){map$jscomp$4.get(this).SetInteractive(e)}get isSelfAndParentsInteractive(){return map$jscomp$4.get(this).IsSelfAndParentsInteractive()}get opacity(){return map$jscomp$4.get(this).GetOpacity()}set opacity(e){e=C3$jscomp$63.clamp(+e,0,1),isNaN(e)||map$jscomp$4.get(this).SetOpacity(e)}set scale(e){C3X$jscomp$6.RequireFiniteNumber(e),map$jscomp$4.get(this).SetOwnScale(e)}get scale(){return map$jscomp$4.get(this).GetOwnScale()}set scaleRate(e){C3X$jscomp$6.RequireFiniteNumber(e),map$jscomp$4.get(this).SetScaleRate(e)}get scaleRate(){return map$jscomp$4.get(this).GetScaleRate()}set angle(e){C3X$jscomp$6.RequireFiniteNumber(e),map$jscomp$4.get(this).SetAngle(e)}get angle(){return map$jscomp$4.get(this).GetOwnAngle()}set parallaxX(e){C3X$jscomp$6.RequireFiniteNumber(e),map$jscomp$4.get(this).SetParallaxX(e)}get parallaxX(){return map$jscomp$4.get(this).GetParallaxX()}set parallaxY(e){C3X$jscomp$6.RequireFiniteNumber(e),map$jscomp$4.get(this).SetParallaxY(e)}get parallaxY(){return map$jscomp$4.get(this).GetParallaxY()}set zElevation(e){C3X$jscomp$6.RequireFiniteNumber(e),map$jscomp$4.get(this).SetZElevation(e)}get zElevation(){return map$jscomp$4.get(this).GetZElevation()}set isTransparent(e){map$jscomp$4.get(this).SetTransparent(e)}get isTransparent(){return map$jscomp$4.get(this).IsTransparent()}set isForceOwnTexture(e){map$jscomp$4.get(this).SetForceOwnTexture(e)}get isForceOwnTexture(){return map$jscomp$4.get(this).IsForceOwnTexture()}set blendMode(e){if(C3X$jscomp$6.RequireString(e),"number"!=typeof(e=BLEND_MODE_TO_INDEX.get(e)))throw Error("invalid blend mode");map$jscomp$4.get(this).SetBlendMode(e)}get blendMode(){return INDEX_TO_BLEND_MODE.get(map$jscomp$4.get(this).GetBlendMode())}set backgroundColor(e){if(C3X$jscomp$6.RequireArray(e),3>e.length)throw Error("expected 3 elements");tempColor$jscomp$1.setRgb(e[0],e[1],e[2]);const t=(e=map$jscomp$4.get(this)).GetBackgroundColor();t.equalsIgnoringAlpha(tempColor$jscomp$1)||(t.copyRgb(tempColor$jscomp$1),e.GetRuntime().UpdateRender())}get backgroundColor(){const e=map$jscomp$4.get(this).GetBackgroundColor();return[e.getR(),e.getG(),e.getB()]}set scrollX(e){C3X$jscomp$6.RequireNumber(e);const t=map$jscomp$4.get(this);t.SetOwnScrollPositionEnabled(!0),t.SetScrollX(e)}get scrollX(){return map$jscomp$4.get(this).GetScrollX()}set scrollY(e){C3X$jscomp$6.RequireNumber(e);const t=map$jscomp$4.get(this);t.SetOwnScrollPositionEnabled(!0),t.SetScrollY(e)}get scrollY(){return map$jscomp$4.get(this).GetScrollY()}scrollTo(e,t){C3X$jscomp$6.RequireNumber(e),C3X$jscomp$6.RequireNumber(t);const s=map$jscomp$4.get(this);s.SetOwnScrollPositionEnabled(!0),s.SetScrollX(e),s.SetScrollY(t)}getScrollPosition(){const e=map$jscomp$4.get(this);return[e.GetScrollX(),e.GetScrollY()]}restoreScrollPosition(){map$jscomp$4.get(this).SetOwnScrollPositionEnabled(!1)}getViewport(){return map$jscomp$4.get(this).GetViewport().toDOMRect()}cssPxToLayer(e,t,s=0){C3X$jscomp$6.RequireNumber(e),C3X$jscomp$6.RequireNumber(t),C3X$jscomp$6.RequireNumber(s);const i=map$jscomp$4.get(this),r=i.GetRuntime();return i.CanvasCssToLayer(e-r.GetCanvasClientX(),t-r.GetCanvasClientY(),s)}layerToCssPx(e,t,s=0){C3X$jscomp$6.RequireNumber(e),C3X$jscomp$6.RequireNumber(t),C3X$jscomp$6.RequireNumber(s);const i=map$jscomp$4.get(this),r=i.GetRuntime(),[n,a]=i.LayerToCanvasCss(e,t,s);return[n+r.GetCanvasClientX(),a+r.GetCanvasClientY()]}};const C3$jscomp$64=self.C3,C3X$jscomp$7=self.C3X,map$jscomp$5=new WeakMap,dispatchers=new WeakMap;function GetDispatcher(e){let t=dispatchers.get(e);return t||(t=C3$jscomp$64.New(C3$jscomp$64.Event.Dispatcher),dispatchers.set(e,t),t)}let initInst=null;self.IInstance=class{constructor(){map$jscomp$5.set(this,initInst);const e={runtime:{value:initInst.GetRuntime().GetIRuntime(),writable:!1},objectType:{value:initInst.GetObjectClass().GetIObjectClass(),writable:!1},uid:{value:initInst.GetUID(),writable:!1}};initInst._GetInstVarsScriptDescriptor(e),initInst._GetBehaviorsScriptDescriptor(e),Object.defineProperties(this,e),initInst.GetRuntime()._MapScriptInterface(this,initInst)}static _Init(e){initInst=e}static _GetInitInst(){return initInst}_Release(){const e=dispatchers.get(this);e&&(e.Release(),dispatchers.delete(this)),map$jscomp$5.delete(this)}addEventListener(e,t,s){C3X$jscomp$7.RequireString(e),C3X$jscomp$7.RequireFunction(t),GetDispatcher(this).addEventListener(e,t,s)}removeEventListener(e,t,s){C3X$jscomp$7.RequireString(e),C3X$jscomp$7.RequireFunction(t),GetDispatcher(this).removeEventListener(e,t,s)}dispatchEvent(e){GetDispatcher(this).dispatchEvent(e)}destroy(){const e=map$jscomp$5.get(this),t=e.GetRuntime();t.DestroyInstance(e),t.GetEventSheetManager().IsInEventEngine()||t.FlushPendingInstances()}getOtherContainerInstances(){const e=map$jscomp$5.get(this).GetSiblings();return e?e.map((e=>e.GetInterfaceClass())):[]}*otherContainerInstances(){const e=map$jscomp$5.get(this);if(e.IsInContainer())for(const t of e.siblings())yield t.GetInterfaceClass()}};const C3$jscomp$65=self.C3,C3X$jscomp$8=self.C3X,IInstance$jscomp$1=self.IInstance,ILayer$jscomp$1=self.ILayer,map$jscomp$6=new WeakMap,BLEND_MODE_TO_INDEX$jscomp$1=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),INDEX_TO_BLEND_MODE$jscomp$1=new Map([...BLEND_MODE_TO_INDEX$jscomp$1.entries()].map((e=>[e[1],e[0]]))),tempColor$jscomp$2=C3$jscomp$65.New(C3$jscomp$65.Color);self.IWorldInstance=class e extends IInstance$jscomp$1{constructor(){super();var e=IInstance$jscomp$1._GetInitInst();map$jscomp$6.set(this,e);const t=[];var s=e.GetWorldInfo();if(e=s.GetInstanceEffectList()){s=s.GetObjectClass().GetEffectList().GetAllEffectTypes().length;for(let i=0;i<s;++i)t.push(new self.IEffectInstance(e,i))}Object.defineProperties(this,{effects:{value:t,writable:!1}})}get layout(){return map$jscomp$6.get(this).GetWorldInfo().GetLayout().GetILayout()}get layer(){return map$jscomp$6.get(this).GetWorldInfo().GetLayer().GetILayer()}get x(){return map$jscomp$6.get(this).GetWorldInfo().GetX()}set x(e){e=+e;const t=map$jscomp$6.get(this).GetWorldInfo();isNaN(e)||t.GetX()===e||(t.SetX(e),t.SetBboxChanged())}get y(){return map$jscomp$6.get(this).GetWorldInfo().GetY()}set y(e){e=+e;const t=map$jscomp$6.get(this).GetWorldInfo();isNaN(e)||t.GetY()===e||(t.SetY(e),t.SetBboxChanged())}setPosition(e,t){e=+e,t=+t;const s=map$jscomp$6.get(this).GetWorldInfo();isNaN(e)||isNaN(t)||s.GetX()===e&&s.GetY()===t||(s.SetXY(e,t),s.SetBboxChanged())}getPosition(){const e=map$jscomp$6.get(this).GetWorldInfo();return[e.GetX(),e.GetY()]}offsetPosition(e,t){if(e=+e,t=+t,!(isNaN(e)||isNaN(t)||0===e&&0===t)){var s=map$jscomp$6.get(this).GetWorldInfo();s.OffsetXY(e,t),s.SetBboxChanged()}}get zElevation(){return map$jscomp$6.get(this).GetWorldInfo().GetZElevation()}set zElevation(e){e=+e;const t=map$jscomp$6.get(this),s=t.GetWorldInfo();isNaN(e)||s.GetZElevation()===e||(s.SetZElevation(e),t.GetRuntime().UpdateRender())}get totalZElevation(){return map$jscomp$6.get(this).GetWorldInfo().GetTotalZElevation()}get width(){return map$jscomp$6.get(this).GetWorldInfo().GetWidth()}set width(e){e=+e;const t=map$jscomp$6.get(this).GetWorldInfo();isNaN(e)||t.GetWidth()===e||(t.SetWidth(e),t.SetBboxChanged())}get height(){return map$jscomp$6.get(this).GetWorldInfo().GetHeight()}set height(e){e=+e;const t=map$jscomp$6.get(this).GetWorldInfo();isNaN(e)||t.GetHeight()===e||(t.SetHeight(e),t.SetBboxChanged())}setSize(e,t){e=+e,t=+t;const s=map$jscomp$6.get(this).GetWorldInfo();isNaN(e)||isNaN(t)||s.GetWidth()===e&&s.GetHeight()===t||(s.SetSize(e,t),s.SetBboxChanged())}getSize(){const e=map$jscomp$6.get(this).GetWorldInfo();return[e.GetWidth(),e.GetHeight()]}get angle(){return map$jscomp$6.get(this).GetWorldInfo().GetAngle()}set angle(e){e=C3$jscomp$65.clampAngle(+e);const t=map$jscomp$6.get(this).GetWorldInfo();isNaN(e)||t.GetAngle()===e||(t.SetAngle(e),t.SetBboxChanged())}get angleDegrees(){return C3$jscomp$65.toDegrees(this.angle)}set angleDegrees(e){this.angle=C3$jscomp$65.toRadians(e)}getBoundingBox(){return map$jscomp$6.get(this).GetWorldInfo().GetBoundingBox().toDOMRect()}getBoundingQuad(){return map$jscomp$6.get(this).GetWorldInfo().GetBoundingQuad().toDOMQuad()}get isVisible(){return map$jscomp$6.get(this).GetWorldInfo().IsVisible()}set isVisible(e){e=!!e;const t=map$jscomp$6.get(this),s=t.GetWorldInfo();s.IsVisible()!==e&&(s.SetVisible(e),t.GetRuntime().UpdateRender())}get opacity(){return map$jscomp$6.get(this).GetWorldInfo().GetOpacity()}set opacity(e){e=C3$jscomp$65.clamp(+e,0,1);const t=map$jscomp$6.get(this),s=t.GetWorldInfo();isNaN(e)||s.GetOpacity()===e||(s.SetOpacity(e),t.GetRuntime().UpdateRender())}set colorRgb(e){if(C3X$jscomp$8.RequireArray(e),3>e.length)throw Error("expected 3 elements");tempColor$jscomp$2.setRgb(e[0],e[1],e[2]);const t=(e=map$jscomp$6.get(this)).GetWorldInfo();t.GetUnpremultipliedColor().equalsIgnoringAlpha(tempColor$jscomp$2)||(t.SetUnpremultipliedColor(tempColor$jscomp$2),e.GetRuntime().UpdateRender())}get colorRgb(){const e=map$jscomp$6.get(this).GetWorldInfo().GetUnpremultipliedColor();return[e.getR(),e.getG(),e.getB()]}set blendMode(e){if(C3X$jscomp$8.RequireString(e),"number"!=typeof(e=BLEND_MODE_TO_INDEX$jscomp$1.get(e)))throw Error("invalid blend mode");const t=map$jscomp$6.get(this);t.GetWorldInfo().SetBlendMode(e),t.GetRuntime().UpdateRender()}get blendMode(){return INDEX_TO_BLEND_MODE$jscomp$1.get(map$jscomp$6.get(this).GetWorldInfo().GetBlendMode())}moveToTop(){map$jscomp$6.get(this).GetWorldInfo().ZOrderMoveToTop()}moveToBottom(){map$jscomp$6.get(this).GetWorldInfo().ZOrderMoveToBottom()}moveToLayer(e){if(C3X$jscomp$8.RequireInstanceOf(e,ILayer$jscomp$1),!(e=ILayer$jscomp$1._Unwrap(e)))throw Error("invalid layer");map$jscomp$6.get(this).GetWorldInfo().ZOrderMoveToLayer(e)}moveAdjacentToInstance(t,s){C3X$jscomp$8.RequireInstanceOf(t,e),map$jscomp$6.get(this).GetWorldInfo().ZOrderMoveAdjacentToInstance(map$jscomp$6.get(t),s)}get zIndex(){return map$jscomp$6.get(this).GetWorldInfo().GetZIndex()}containsPoint(e,t){return C3X$jscomp$8.RequireNumber(e),C3X$jscomp$8.RequireNumber(t),map$jscomp$6.get(this).GetWorldInfo().ContainsPoint(+e,+t)}testOverlap(t){C3X$jscomp$8.RequireInstanceOf(t,e);const s=map$jscomp$6.get(this);return t=map$jscomp$6.get(t),s.GetRuntime().GetCollisionEngine().TestOverlap(s,t)}testOverlapSolid(){var e=map$jscomp$6.get(this);return(e=e.GetRuntime().GetCollisionEngine().TestOverlapSolid(e))?e.GetInterfaceClass():null}getParent(){const e=map$jscomp$6.get(this).GetParent();return e?e.GetInterfaceClass():null}getTopParent(){const e=map$jscomp$6.get(this).GetTopParent();return e?e.GetInterfaceClass():null}*parents(){for(const e of map$jscomp$6.get(this).parents())yield e.GetInterfaceClass()}getChildCount(){return map$jscomp$6.get(this).GetChildCount()}getChildAt(e){return(e=map$jscomp$6.get(this).GetChildAt(e))?e.GetInterfaceClass():null}*children(){for(const e of map$jscomp$6.get(this).children())yield e.GetInterfaceClass()}*allChildren(){for(const e of map$jscomp$6.get(this).allChildren())yield e.GetInterfaceClass()}addChild(t,s){C3X$jscomp$8.RequireInstanceOf(t,e),C3X$jscomp$8.RequireOptionalObject(s),s||(s={});const i=map$jscomp$6.get(this);t=map$jscomp$6.get(t),i.AddChild(t,s)}removeChild(t){C3X$jscomp$8.RequireInstanceOf(t,e);const s=map$jscomp$6.get(this);t=map$jscomp$6.get(t),s.RemoveChild(t)}removeFromParent(){const e=map$jscomp$6.get(this);e.HasParent()&&e.GetParent().RemoveChild(e)}createMesh(e,t){C3X$jscomp$8.RequireFiniteNumber(e),C3X$jscomp$8.RequireFiniteNumber(t),map$jscomp$6.get(this).GetWorldInfo().CreateMesh(e,t)}releaseMesh(){const e=map$jscomp$6.get(this).GetWorldInfo();e.ReleaseMesh(),e.SetBboxChanged()}setMeshPoint(e,t,s){C3X$jscomp$8.RequireFiniteNumber(e),C3X$jscomp$8.RequireFiniteNumber(t),C3X$jscomp$8.RequireObject(s);const i=map$jscomp$6.get(this).GetWorldInfo();i.SetMeshPoint(e,t,s)&&i.SetBboxChanged()}getMeshSize(){var e=map$jscomp$6.get(this).GetWorldInfo();return e.HasMesh()?[(e=e.GetSourceMesh()).GetHSize(),e.GetVSize()]:[0,0]}};const C3X$jscomp$9=self.C3X,map$jscomp$7=new WeakMap;self.IDOMInstance=class extends self.IWorldInstance{constructor(){super(),map$jscomp$7.set(this,self.IInstance._GetInitInst())}getElement(){return map$jscomp$7.get(this).GetSdkInstance()._GetElementInDOMMode()}focus(){map$jscomp$7.get(this).GetSdkInstance().FocusElement()}blur(){map$jscomp$7.get(this).GetSdkInstance().BlurElement()}setCssStyle(e,t){C3X$jscomp$9.RequireString(e),map$jscomp$7.get(this).GetSdkInstance().SetElementCSSStyle(e,t)}};const C3$jscomp$67=self.C3,C3X$jscomp$10=self.C3X,map$jscomp$8=new WeakMap,dispatchers$jscomp$1=new WeakMap;function GetDispatcher$jscomp$1(e){let t=dispatchers$jscomp$1.get(e);return t||(t=C3$jscomp$67.New(C3$jscomp$67.Event.Dispatcher),dispatchers$jscomp$1.set(e,t),t)}let initBehInst=null;self.IBehaviorInstance=class{constructor(){map$jscomp$8.set(this,initBehInst);const e={runtime:{value:initBehInst.GetRuntime().GetIRuntime(),writable:!1},behavior:{value:initBehInst.GetBehavior().GetIBehavior(),writable:!1}};Object.defineProperties(this,e)}static _Init(e){initBehInst=e}static _GetInitInst(){return initBehInst}get instance(){return map$jscomp$8.get(this).GetObjectInstance().GetInterfaceClass()}_Release(){const e=dispatchers$jscomp$1.get(this);e&&(e.Release(),dispatchers$jscomp$1.delete(this)),map$jscomp$8.delete(this)}addEventListener(e,t,s){C3X$jscomp$10.RequireString(e),C3X$jscomp$10.RequireFunction(t),GetDispatcher$jscomp$1(this).addEventListener(e,t,s)}removeEventListener(e,t,s){C3X$jscomp$10.RequireString(e),C3X$jscomp$10.RequireFunction(t),GetDispatcher$jscomp$1(this).removeEventListener(e,t,s)}dispatchEvent(e){GetDispatcher$jscomp$1(this).dispatchEvent(e)}};const map$jscomp$9=new WeakMap;self.IBehavior=class{constructor(e){map$jscomp$9.set(this,e),e={runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1}},Object.defineProperties(this,e)}getAllInstances(){return map$jscomp$9.get(this).GetInstances().map((e=>e.GetInterfaceClass()))}};const C3$jscomp$69=self.C3,C3X$jscomp$12=self.C3X,map$jscomp$10=new WeakMap,tempColor$jscomp$3=C3$jscomp$69.New(C3$jscomp$69.Color);self.IEffectInstance=class{constructor(e,t){map$jscomp$10.set(this,e),Object.defineProperties(this,{index:{value:t,writable:!1}})}get name(){return map$jscomp$10.get(this).GetAllEffectTypes()[this.index].GetName()}get isActive(){return map$jscomp$10.get(this).IsEffectIndexActive(this.index)}set isActive(e){e=!!e;const t=map$jscomp$10.get(this);t.IsEffectIndexActive(this.index)!==e&&(t.SetEffectIndexActive(this.index,e),t.UpdateActiveEffects(),t.GetRuntime().UpdateRender())}setParameter(e,t){C3X$jscomp$12.RequireFiniteNumber(e),e=Math.floor(+e);const s=map$jscomp$10.get(this),i=s.GetEffectParameter(this.index,e);if(null===i)throw new RangeError("invalid index");if(i instanceof C3$jscomp$69.Color){if(!Array.isArray(t)||3>t.length)throw new TypeError("expected array with 3 elements");tempColor$jscomp$3.setRgb(t[0],t[1],t[2]),t=tempColor$jscomp$3}else if("number"!=typeof t)throw new TypeError("expected number");s.SetEffectParameter(this.index,e,t)&&s.IsEffectIndexActive(this.index)&&s.GetRuntime().UpdateRender()}getParameter(e){if(C3X$jscomp$12.RequireFiniteNumber(e),e=Math.floor(+e),null===(e=map$jscomp$10.get(this).GetEffectParameter(this.index,e)))throw new RangeError("invalid index");return e instanceof C3$jscomp$69.Color?[e.getR(),e.getG(),e.getB()]:e}};const map$jscomp$11=new WeakMap;self.IAnimation=class{constructor(e){map$jscomp$11.set(this,e),Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},speed:{value:e.GetSpeed(),writable:!1},isLooping:{value:e.IsLooping(),writable:!1},repeatCount:{value:e.GetRepeatCount(),writable:!1},repeatTo:{value:e.GetRepeatTo(),writable:!1},isPingPong:{value:e.IsPingPong(),writable:!1},frameCount:{value:e.GetFrameCount(),writable:!1}})}getFrames(){return map$jscomp$11.get(this).GetFrames().map((e=>e.GetIAnimationFrame()))}*frames(){for(const e of map$jscomp$11.get(this).GetFrames())yield e.GetIAnimationFrame()}};const map$jscomp$12=new WeakMap;self.IImageInfo=class{constructor(e){map$jscomp$12.set(this,e)}get width(){return map$jscomp$12.get(this).GetWidth()}get height(){return map$jscomp$12.get(this).GetHeight()}getSize(){const e=map$jscomp$12.get(this);return[e.GetWidth(),e.GetHeight()]}};const map$jscomp$13=new WeakMap;self.IAnimationFrame=class extends self.IImageInfo{constructor(e){super(e.GetImageInfo()),map$jscomp$13.set(this,e),Object.defineProperties(this,{duration:{value:e.GetDuration(),writable:!1},originX:{value:e.GetOriginX(),writable:!1},originY:{value:e.GetOriginY(),writable:!1}})}getOrigin(){const e=map$jscomp$13.get(this);return[e.GetOriginX(),e.GetOriginY()]}};const C3X$jscomp$16=self.C3X,map$jscomp$14=new WeakMap;function GetTimelineState(e){if((e=map$jscomp$14.get(e)).IsReleased())throw Error("timeline/tween was released and is no longer valid");return e}self.ITimelineState=class{constructor(e){map$jscomp$14.set(this,e)}pause(){GetTimelineState(this).Stop()}resume(){GetTimelineState(this).Resume()}hasTags(e){return GetTimelineState(this).HasTags(e)}set time(e){C3X$jscomp$16.RequireFiniteNumber(e),GetTimelineState(this).SetTime(e)}get time(){return GetTimelineState(this).GetTime()}set totalTime(e){C3X$jscomp$16.RequireFiniteNumber(e),GetTimelineState(this).SetTotalTime(e)}get totalTime(){return GetTimelineState(this).GetTotalTime()}set isLooping(e){GetTimelineState(this).SetLoop(!!e)}get isLooping(){return GetTimelineState(this).GetLoop()}set isPingPong(e){GetTimelineState(this).SetPingPong(!!e)}get isPingPong(){return GetTimelineState(this).GetPingPong()}set playbackRate(e){C3X$jscomp$16.RequireFiniteNumber(e),GetTimelineState(this).SetPlaybackRate(e)}get playbackRate(){return GetTimelineState(this).GetPlaybackRate()}get progress(){const e=GetTimelineState(this);return e.GetTime()/e.GetTotalTime()}get tags(){return GetTimelineState(this).GetTags()}get finished(){return GetTimelineState(this).GetPlayPromise()}get isPlaying(){return GetTimelineState(this).IsPlaying()}get isPaused(){return GetTimelineState(this).IsPaused()}get isReleased(){return map$jscomp$14.get(this).IsReleased()}};const C3X$jscomp$17=self.C3X,map$jscomp$15=new WeakMap,behInstMap=new WeakMap;let easeToIndexFunc=null;function GetTweenState(e){if((e=map$jscomp$15.get(e)).IsReleased())throw Error("timeline/tween was released and is no longer valid");return e}self.ITweenState=class extends self.ITimelineState{constructor(e,t,s){super(e),easeToIndexFunc||(easeToIndexFunc=s.easeToIndexFunc),map$jscomp$15.set(this,e),t&&behInstMap.set(this,t)}stop(){const e=GetTweenState(this);behInstMap.get(this).ReleaseTween(e)}setEase(e){C3X$jscomp$17.RequireString(e),e=self.Ease.GetEaseFromIndex(easeToIndexFunc(e)),GetTweenState(this).SetEase(e)}get instance(){const e=GetTweenState(this).GetInstance();return e?e.GetInterfaceClass():null}get isDestroyOnComplete(){return GetTweenState(this).GetDestroyInstanceOnComplete()}set isDestroyOnComplete(e){GetTweenState(this).SetDestroyInstanceOnComplete(!!e)}get value(){const e=GetTweenState(this);if("value"!==e.GetId())throw Error("not a value tween");return e.GetPropertyTrack("value").GetSourceAdapterValue()}};const C3$jscomp$75=self.C3,VALID_LOAD_POLICIES=new Set(["local","remote"]),EXT_TO_TYPE=new Map([["mp4","video/mp4"],["webm","video/webm"],["m4a","audio/mp4"],["mp3","audio/mpeg"],["js","application/javascript"],["wasm","application/wasm"],["svg","image/svg+xml"],["html","text/html"]]);function GetTypeFromFileExtension(e){return e?2>(e=e.split(".")).length?"":(e=e.at(-1).toLowerCase(),EXT_TO_TYPE.get(e)||""):""}function AddScript(e){return new Promise(((t,s)=>{const i=document.createElement("script");i.onload=t,i.onerror=s,i.async=!1,i.type="module",i.src=e,document.head.appendChild(i)}))}C3$jscomp$75.AssetManager=class extends C3$jscomp$75.DefendedBase{constructor(e,t){super();var s=t.exportType;if(this._runtime=e,this._fileStructure="folders",this._localUrlBlobs=new Map,this._localBlobUrlCache=new Map,this._localBlobSWUrls=new Map,this._isCordova="cordova"===s,this._isiOSCordova=!!t.isiOSCordova,this._isFileProtocol=!!t.isFileProtocol,this._swClientId=t.swClientId,this._supportedAudioFormats=t.supportedAudioFormats||{},this._audioFiles=new Map,this._preloadSounds=!1,this._iconsSubfolder=this._fontsSubfolder=this._mediaSubfolder="",this._defaultLoadPolicy="html5"===s||"scirra-arcade"===s||"instant-games"===s?"remote":"local",this._allAssets=[],this._assetsByUrl=new Map,this._webFonts=[],this._loadPromises=[],this._hasFinishedInitialLoad=!1,this._lastLoadProgress=this._assetSizeLoaded=this._totalAssetSizeToLoad=0,this._hasHadErrorLoading=!1,this._loadingRateLimiter=C3$jscomp$75.New(C3$jscomp$75.RateLimiter,(()=>this._FireLoadingProgressEvent()),50),this._promiseThrottle=new C3$jscomp$75.PromiseThrottle(Math.max(C3$jscomp$75.hardwareConcurrency,8)),e=t.previewImageBlobs){(s=t.previewProjectFileBlobs)&&Object.assign(e,s),(s=t.projectData)&&(e["data.json"]=s);for(const[t,s]of Object.entries(e))this._localUrlBlobs.set(t,s)}if(t=t.previewProjectFileSWUrls)for(const[e,s]of Object.entries(t))this._localBlobSWUrls.set(e,s);this._iAssetManager=new self.IAssetManager(this)}Release(){this._localUrlBlobs.clear();for(const e of this._localBlobUrlCache.values())e.startsWith("blob:")&&URL.revokeObjectURL(e);this._localBlobUrlCache.clear();for(const e of this._allAssets)e.Release();C3$jscomp$75.clearArray(this._allAssets),this._assetsByUrl.clear(),C3$jscomp$75.clearArray(this._loadPromises),this._runtime=null}GetRuntime(){return this._runtime}_SetFileStructure(e){if(this._fileStructure=e,"flat"===e){e=new Map;for(const[t,s]of this._localUrlBlobs.entries())e.set(t.toLowerCase(),s);this._localUrlBlobs=e}}GetFileStructure(){return this._fileStructure}_SetMediaSubfolder(e){this._mediaSubfolder=e}GetMediaSubfolder(){return this._mediaSubfolder}_SetFontsSubfolder(e){this._fontsSubfolder=e}GetFontsSubfolder(){return this._fontsSubfolder}_SetIconsSubfolder(e){this._iconsSubfolder=e}GetIconsSubfolder(){return this._iconsSubfolder}IsFileProtocol(){return this._isFileProtocol}_HasLocalUrlBlob(e){return"flat"===this._fileStructure&&(e=e.toLowerCase()),this._localUrlBlobs.has(e)}_GetLocalUrlBlob(e){return"flat"===this._fileStructure&&(e=e.toLowerCase()),this._localUrlBlobs.get(e)||null}GetLocalUrlAsBlobUrl(e){if("flat"===this._fileStructure&&(e=e.toLowerCase()),!this._HasLocalUrlBlob(e))return e;var t=this._localBlobUrlCache.get(e);return t||(t=this._GetLocalUrlBlob(e),t=URL.createObjectURL(t),this._localBlobUrlCache.set(e,t)),t}FetchBlob(e,t){t=t||this._defaultLoadPolicy;const s=this._GetLocalUrlBlob(e);return s?Promise.resolve(s):C3$jscomp$75.IsRelativeURL(e)?("flat"===this._fileStructure&&(e=e.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlob(e):"local"===t?this._promiseThrottle.Add((()=>C3$jscomp$75.FetchBlob(e))):C3$jscomp$75.FetchBlob(e)):C3$jscomp$75.FetchBlob(e)}FetchArrayBuffer(e){const t=this._GetLocalUrlBlob(e);return t?C3$jscomp$75.BlobToArrayBuffer(t):C3$jscomp$75.IsRelativeURL(e)?("flat"===this._fileStructure&&(e=e.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsArrayBuffer(e):"local"===this._defaultLoadPolicy?this._promiseThrottle.Add((()=>C3$jscomp$75.FetchArrayBuffer(e))):C3$jscomp$75.FetchArrayBuffer(e)):C3$jscomp$75.FetchArrayBuffer(e)}FetchText(e){const t=this._GetLocalUrlBlob(e);return t?C3$jscomp$75.BlobToString(t):C3$jscomp$75.IsRelativeURL(e)?("flat"===this._fileStructure&&(e=e.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsText(e):"local"===this._defaultLoadPolicy?this._promiseThrottle.Add((()=>C3$jscomp$75.FetchText(e))):C3$jscomp$75.FetchText(e)):C3$jscomp$75.FetchText(e)}async FetchJson(e){return e=await this.FetchText(e),JSON.parse(e)}_CordovaFetchLocalFileAs(e,t){return"flat"===this._fileStructure&&(e=e.toLowerCase()),this._runtime.PostComponentMessageToDOMAsync("runtime","cordova-fetch-local-file",{filename:e,as:t})}CordovaFetchLocalFileAsText(e){return this._CordovaFetchLocalFileAs(e,"text")}async CordovaFetchLocalFileAsBlob(e){const t=await this._CordovaFetchLocalFileAs(e,"buffer");return e=GetTypeFromFileExtension(e),new Blob([t],{type:e})}async CordovaFetchLocalFileAsBlobURL(e){"flat"===this._fileStructure&&(e=e.toLowerCase());var t=this._localBlobUrlCache.get(e);return t||(t=await this.CordovaFetchLocalFileAsBlob(e),t=URL.createObjectURL(t),this._localBlobUrlCache.set(e,t),t)}CordovaFetchLocalFileAsArrayBuffer(e){return this._CordovaFetchLocalFileAs(e,"buffer")}GetMediaFileUrl(e){return"flat"===this._fileStructure&&(e=e.toLowerCase()),e=this._mediaSubfolder+e,this._HasLocalUrlBlob(e)?this.GetLocalUrlAsBlobUrl(e):e}GetProjectFileUrl(e){return C3$jscomp$75.IsAbsoluteURL(e)?Promise.resolve(e):this._HasLocalUrlBlob(e)?Promise.resolve(this.GetLocalUrlAsBlobUrl(e)):this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlobURL(e):("flat"===this._fileStructure&&(e=e.toLowerCase()),Promise.resolve(e))}GetProjectFileIframeUrl(e){if(C3$jscomp$75.IsAbsoluteURL(e))return Promise.resolve(e);var t=e.indexOf("?"),s=-1===t?"":e.substr(t);return t=-1===t?e:e.substr(0,t),this._HasLocalUrlBlob(t)?(!(e=this._localBlobSWUrls.get(t)||this.GetLocalUrlAsBlobUrl(t)).startsWith("blob:")&&this._swClientId&&(e=new URL(e),(s=new URLSearchParams(s)).set("__c3_client_id",this._swClientId),e.search=s.toString(),e=e.toString()),Promise.resolve(e)):this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlobURL(t):("flat"===this._fileStructure&&(e=e.toLowerCase()),Promise.resolve(e))}LoadProjectFileUrl(e){return this.GetProjectFileUrl(e)}LoadImage(e){if(e.loadPolicy&&!VALID_LOAD_POLICIES.has(e.loadPolicy))throw Error("invalid load policy");let t=this._assetsByUrl.get(e.url);return t||(t=C3$jscomp$75.New(C3$jscomp$75.ImageAsset,this,{url:e.url,size:e.size||0,loadPolicy:e.loadPolicy||this._defaultLoadPolicy}),this._allAssets.push(t),this._assetsByUrl.set(t.GetURL(),t),this._hasFinishedInitialLoad||(this._totalAssetSizeToLoad+=t.GetSize(),this._loadPromises.push(t.Load().then((()=>this._AddLoadedSize(t.GetSize()))))),t)}async WaitForAllToLoad(){try{await Promise.all(this._loadPromises),this._lastLoadProgress=1}catch(e){this._hasHadErrorLoading=!0,this._FireLoadingProgressEvent()}}SetInitialLoadFinished(){this._hasFinishedInitialLoad=!0}HasHadErrorLoading(){return this._hasHadErrorLoading}_AddLoadedSize(e){this._assetSizeLoaded+=e,this._loadingRateLimiter.Call()}_FireLoadingProgressEvent(){const e=C3$jscomp$75.New(C3$jscomp$75.Event,"loadingprogress");this._lastLoadProgress=C3$jscomp$75.clamp(this._assetSizeLoaded/this._totalAssetSizeToLoad,0,1),e.progress=this._lastLoadProgress,this._runtime.Dispatcher().dispatchEvent(e)}GetLoadProgress(){return this._lastLoadProgress}_SetWebFonts(e){C3$jscomp$75.shallowAssignArray(this._webFonts,e),this._webFonts.length&&this._loadPromises.push(this._LoadWebFonts())}async _LoadWebFonts(){const e=[],t=[];for(const[s,i,r]of this._webFonts)this._totalAssetSizeToLoad+=r,e.push(this._LoadWebFont(s,i,t).then((()=>this._AddLoadedSize(r))));await Promise.all(e),this._runtime.IsInWorker()&&0<t.length&&await this._runtime.PostComponentMessageToDOMAsync("runtime","load-webfonts",{webfonts:t})}async _LoadWebFont(e,t,s){try{const i=await this.GetProjectFileUrl(t),r=new FontFace(e,`url('${i}')`);this._runtime.IsInWorker()?self.fonts.add(r):document.fonts.add(r),await r.load(),this._runtime.IsInWorker()&&s.push({name:e,url:i})}catch(e){}}IsAudioFormatSupported(e){return!!this._supportedAudioFormats[e]}_SetAudioFiles(e,t){this._preloadSounds=!!t;for(const[t,s,i]of e)this._audioFiles.set(t,{fileName:t,formats:s.map((e=>({type:e[0],fileExtension:e[1],fullName:t+e[1],fileSize:e[2]}))),isMusic:i})}GetPreferredAudioFile(e){if("flat"===this._fileStructure&&(e=e.toLowerCase()),!(e=this._audioFiles.get(e)))return null;let t=null;for(const s of e.formats)if(t||"audio/webm; codecs=opus"!==s.type||(t=s),this.IsAudioFormatSupported(s.type))return s;return t}GetProjectAudioFileUrl(e){return(e=this.GetPreferredAudioFile(e))?{url:this.GetMediaFileUrl(e.fullName),type:e.type}:null}GetAudioToPreload(){if(this._preloadSounds){const e=[];for(const t of this._audioFiles.values()){if(t.isMusic)continue;const s=this.GetPreferredAudioFile(t.fileName);s&&e.push({originalUrl:t.fileName,url:this.GetMediaFileUrl(s.fullName),type:s.type,fileSize:s.fileSize})}return e}return[]}GetIAssetManager(){return this._iAssetManager}async LoadScripts(...e){const t=await Promise.all(e.map((e=>this.GetProjectFileUrl(e))));this._runtime.IsInWorker()?1===e.length?(e=e[0],await self.c3_import((C3$jscomp$75.IsRelativeURL(e)?"./":"")+e)):(e=e.map((e=>`import "${C3$jscomp$75.IsRelativeURL(e)?"./":""}${e}";`)).join("\n"),e=URL.createObjectURL(new Blob([e],{type:"application/javascript"})),await self.c3_import(e)):await Promise.all(t.map((e=>AddScript(e))))}async CompileWebAssembly(e){return WebAssembly.compileStreaming?(e=await this.GetProjectFileUrl(e),await WebAssembly.compileStreaming(fetch(e))):(e=await C3$jscomp$75.FetchArrayBuffer(e),await WebAssembly.compile(e))}async LoadStyleSheet(e){return e=await this.GetProjectFileUrl(e),await this._runtime.PostComponentMessageToDOMAsync("runtime","add-stylesheet",{url:e})}};const C3$jscomp$76=self.C3;C3$jscomp$76.Asset=class extends C3$jscomp$76.DefendedBase{constructor(e,t){super(),this._assetManager=e,this._runtime=e.GetRuntime(),this._url=t.url,this._size=t.size,this._loadPolicy=t.loadPolicy,this._blob=null,this._isLoaded=!1,this._loadPromise=null}Release(){this._blob=this._runtime=this._assetManager=this._loadPromise=null}GetURL(){return this._url}GetSize(){return this._size}Load(){return"local"===this._loadPolicy||this._blob?(this._isLoaded=!0,Promise.resolve()):this._loadPromise?this._loadPromise:this._loadPromise=this._assetManager.FetchBlob(this._url,this._loadPolicy).then((e=>(this._isLoaded=!0,this._loadPromise=null,this._blob=e))).catch((e=>{}))}IsLoaded(){return this._isLoaded}GetBlob(){return this._blob?Promise.resolve(this._blob):this._loadPromise?this._loadPromise:this._assetManager.FetchBlob(this._url,this._loadPolicy)}};const C3$jscomp$77=self.C3,promiseThrottle=new C3$jscomp$77.PromiseThrottle,allImageAssets=new Set;C3$jscomp$77.ImageAsset=class extends C3$jscomp$77.Asset{constructor(e,t){super(e,t),this._webglTexture=this._texturePromise=null,this._refCount=0,this._imageHeight=this._imageWidth=-1,allImageAssets.add(this)}Release(){if(this.ReleaseTexture(),0!==this._refCount)throw Error("released image asset which still has texture references");this._texturePromise=null,allImageAssets.delete(this),super.Release()}static OnRendererContextLost(){for(const e of allImageAssets)e._texturePromise=null,e._webglTexture=null,e._refCount=0}LoadStaticTexture(e,t){return t=t||{},this._refCount++,this._webglTexture?Promise.resolve(this._webglTexture):this._texturePromise?this._texturePromise:(t.anisotropy=this._runtime.GetCanvasManager().GetTextureAnisotropy(),this._texturePromise=this.GetBlob().then((s=>promiseThrottle.Add((()=>e.CreateStaticTextureAsync(s,t).then((t=>(this._texturePromise=null,0===this._refCount?(e.DeleteTexture(t),null):(this._webglTexture=t,this._imageWidth=t.GetWidth(),this._imageHeight=t.GetHeight(),this._webglTexture)))))))).catch((e=>{throw e})))}ReleaseTexture(){if(0>=this._refCount)throw Error("texture released too many times");this._refCount--,0===this._refCount&&this._webglTexture&&(this._webglTexture.GetRenderer().DeleteTexture(this._webglTexture),this._webglTexture=null)}GetTexture(){return this._webglTexture}GetWidth(){return this._imageWidth}GetHeight(){return this._imageHeight}async LoadToDrawable(){const e=await this.GetBlob();return C3$jscomp$77.Supports.ImageBitmapOptions?await createImageBitmap(e,{premultiplyAlpha:"none"}):C3$jscomp$77.Supports.ImageBitmap?await createImageBitmap(e):await C3$jscomp$77.BlobToImage(e)}};const C3$jscomp$78=self.C3;function SortByInstLastCachedZIndex(e,t){return e.GetWorldInfo()._GetLastCachedZIndex()-t.GetWorldInfo()._GetLastCachedZIndex()}C3$jscomp$78.RenderCell=class extends C3$jscomp$78.DefendedBase{constructor(e,t,s){super(),this._grid=e,this._x=t,this._y=s,this._instances=[],this._isSorted=!0,this._pendingRemoval=new Set,this._isAnyPendingRemoval=!1}Release(){C3$jscomp$78.clearArray(this._instances),this._pendingRemoval.clear(),this._grid=null}Reset(){C3$jscomp$78.clearArray(this._instances),this._isSorted=!0,this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1}SetChanged(){this._isSorted=!1}IsEmpty(){return!this._instances.length||!(this._instances.length>this._pendingRemoval.size)&&(this._FlushPending(),!0)}Insert(e){this._pendingRemoval.has(e)?(this._pendingRemoval.delete(e),0===this._pendingRemoval.size&&(this._isAnyPendingRemoval=!1)):(this._instances.push(e),this._isSorted=1===this._instances.length)}Remove(e){this._pendingRemoval.add(e),this._isAnyPendingRemoval=!0,50<=this._pendingRemoval.size&&this._FlushPending()}_FlushPending(){this._isAnyPendingRemoval&&(this._instances.length===this._pendingRemoval.size?this.Reset():(C3$jscomp$78.arrayRemoveAllInSet(this._instances,this._pendingRemoval),this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1))}_EnsureSorted(){this._isSorted||(this._instances.sort(SortByInstLastCachedZIndex),this._isSorted=!0)}Dump(e){this._FlushPending(),this._EnsureSorted(),this._instances.length&&e.push(this._instances)}};const C3$jscomp$79=self.C3;C3$jscomp$79.RenderGrid=class extends C3$jscomp$79.DefendedBase{constructor(e,t){super(),this._cellWidth=e,this._cellHeight=t,this._cells=C3$jscomp$79.New(C3$jscomp$79.PairMap)}Release(){this._cells.Release(),this._cells=null}GetCell(e,t,s){let i=this._cells.Get(e,t);return i||(s?(i=C3$jscomp$79.New(C3$jscomp$79.RenderCell,this,e,t),this._cells.Set(e,t,i),i):null)}XToCell(e){return Math.floor(e/this._cellWidth)}YToCell(e){return Math.floor(e/this._cellHeight)}Update(e,t,s){if(t)for(let i=t.getLeft(),r=t.getRight();i<=r;++i)for(let r=t.getTop(),n=t.getBottom();r<=n;++r){if(s&&s.containsPoint(i,r))continue;const t=this.GetCell(i,r,!1);t&&(t.Remove(e),t.IsEmpty()&&this._cells.Delete(i,r))}if(s)for(let i=s.getLeft(),r=s.getRight();i<=r;++i)for(let r=s.getTop(),n=s.getBottom();r<=n;++r)t&&t.containsPoint(i,r)||this.GetCell(i,r,!0).Insert(e)}QueryRange(e,t){let s=this.XToCell(e.getLeft());const i=this.YToCell(e.getTop()),r=this.XToCell(e.getRight());for(e=this.YToCell(e.getBottom());s<=r;++s)for(let r=i;r<=e;++r){const e=this.GetCell(s,r,!1);e&&e.Dump(t)}}MarkRangeChanged(e){let t=e.getLeft();const s=e.getTop(),i=e.getRight();for(e=e.getBottom();t<=i;++t)for(let i=s;i<=e;++i){const e=this.GetCell(t,i,!1);e&&e.SetChanged()}}};const C3$jscomp$80=self.C3,tmpRect$jscomp$2=new C3$jscomp$80.Rect,tmpQuad$jscomp$2=new C3$jscomp$80.Quad,renderCellArr=[];new C3$jscomp$80.Rect,new C3$jscomp$80.Rect;const glMatrix$jscomp$8=self.glMatrix,vec3$jscomp$6=glMatrix$jscomp$8.vec3,vec4$jscomp$5=glMatrix$jscomp$8.vec4,mat4$jscomp$9=glMatrix$jscomp$8.mat4,tempMat4$jscomp$4=mat4$jscomp$9.create(),tempVec3=vec3$jscomp$6.create(),tempVec4$jscomp$1=vec4$jscomp$5.create(),camVector=vec3$jscomp$6.create(),lookVector=vec3$jscomp$6.create(),upVector=vec3$jscomp$6.create(),tempVec2=C3$jscomp$80.New(C3$jscomp$80.Vector2);function SortByInstLastCachedZIndex$jscomp$1(e,t){return e.GetWorldInfo()._GetLastCachedZIndex()-t.GetWorldInfo()._GetLastCachedZIndex()}function SortByInstZElevation(e,t){return e.GetWorldInfo().GetZElevation()-t.GetWorldInfo().GetZElevation()}C3$jscomp$80.New(C3$jscomp$80.Rect);const tempInstanceList1=[],tempInstanceList2=[],tempInstancesByCameraDist=[];C3$jscomp$80.Layer=class extends C3$jscomp$80.DefendedBase{constructor(e,t,s){super(),this._layout=e,this._runtime=e.GetRuntime(),this._parentLayer=t,this._name=s[0],this._index=-1,this._sid=s[2],this._isVisible=!!s[3],this._isInteractive=!!s[13],this._backgroundColor=C3$jscomp$80.New(C3$jscomp$80.Color),this._backgroundColor.setFromJSON(s[4].map((e=>e/255))),this._isTransparent=!!s[5],this._parallaxX=s[6],this._parallaxY=s[7],this._color=C3$jscomp$80.New(C3$jscomp$80.Color,1,1,1,s[8]),this._premultipliedColor=C3$jscomp$80.New(C3$jscomp$80.Color),this._isForceOwnTexture=s[9],this._renderAs3d=s[17],this._useCameraDistanceDrawOrder=s[18],this._useRenderCells=s[10],this._scaleRate=s[11],this._blendMode=s[12],this._curRenderTarget=null,this._scale=1,this._zElevation=s[16],this._scrollY=this._scrollX=this._angle=0,this._hasOwnScrollPosition=!1,this._viewport=C3$jscomp$80.New(C3$jscomp$80.Rect),this._viewportZ0=C3$jscomp$80.New(C3$jscomp$80.Rect),this._viewport3D=C3$jscomp$80.New(C3$jscomp$80.Rect),this._isViewportChanged=!0,this._projectionMatrix=mat4$jscomp$9.create(),this._isProjectionMatrixChanged=!0,this._modelViewMatrix=mat4$jscomp$9.create(),this._isMVMatrixChanged=!0,this._viewFrustum=C3$jscomp$80.New(C3$jscomp$80.Gfx.ViewFrustum),this._isViewFrustumChanged=!0,this._startupInitialInstances=[],this._initialInstancesData=s[14],this._initialInstances=[],this._createdGlobalUids=[],this._initialUIDsToInstanceData=new Map,this._instances=[],this._anyInstanceZElevated=this._zIndicesUpToDate=!1;const i=this._runtime.GetCanvasManager();this._effectList=C3$jscomp$80.New(C3$jscomp$80.EffectList,this,s[15]),this._effectChain=C3$jscomp$80.New(C3$jscomp$80.Gfx.EffectChain,i.GetEffectChainManager(),{drawContent:(e,t)=>{const s=(t=t.GetContentObject()).GetRenderTarget();e.SetColor(t.GetPremultipliedColor()),e.DrawRenderTarget(s),e.InvalidateRenderTarget(s),i.ReleaseAdditionalRenderTarget(s)},getShaderParameters:e=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(e)}),this._wasDefaultColor=this._needsRebuildEffectChainSteps=!0,this._renderGrid=null,this._lastRenderList=[],this._isRenderListUpToDate=!1,this._lastRenderCells=C3$jscomp$80.New(C3$jscomp$80.Rect,0,0,-1,-1),this._curRenderCells=C3$jscomp$80.New(C3$jscomp$80.Rect,0,0,-1,-1),this._iLayer=null,this._UpdatePremultipliedColor(),this.UsesRenderCells()&&(this._renderGrid=C3$jscomp$80.New(C3$jscomp$80.RenderGrid,this._runtime.GetOriginalViewportWidth(),this._runtime.GetOriginalViewportHeight())),this._subLayers=s[19].map((e=>C3$jscomp$80.New(C3$jscomp$80.Layer,this._layout,this,e)))}_Init(){for(const e of this._initialInstancesData){const t=this._runtime.GetObjectClassByIndex(e[1]);this._layout._AddInitialObjectClass(t),t.GetDefaultInstanceData()||(t.SetDefaultInstanceData(e),t._SetDefaultLayerIndex(this._index)),this._initialInstances.push(e),this._initialUIDsToInstanceData.set(e[2],e)}C3$jscomp$80.shallowAssignArray(this._startupInitialInstances,this._initialInstances),this._initialInstancesData=null,this._iLayer=new self.ILayer(this)}Release(){this._runtime=this._layout=null}GetInitialInstanceData(e){return this._initialUIDsToInstanceData.get(e)}CreateInitialInstances(e){const t=this._layout.IsFirstVisit();let s=0;const i=this._initialInstances;for(let n=0,a=i.length;n<a;++n){var r=i[n];const a=this._runtime.GetObjectClassByIndex(r[1]);let o=!0;a.HasPersistBehavior()&&!t||(r=this._runtime.CreateInstanceFromData(r,this,!0),e.push(r),a.IsGlobal()&&(o=!1,this._createdGlobalUids.push(r.GetUID()))),o&&(i[s]=i[n],++s)}C3$jscomp$80.truncateArray(i,s),this._runtime.FlushPendingInstances(),this.SetZIndicesChanged()}_AddInstance(e,t){if(!e.GetPlugin().IsWorldType())throw Error("instance is not of world type");const s=e.GetWorldInfo();if(s.GetLayer()!==this)throw Error("instance added to wrong layer");this._instances.push(e),0!==s.GetZElevation()&&(this._anyInstanceZElevated=!0),t&&this.UsesRenderCells()&&e.GetWorldInfo().SetBboxChanged(),this.SetZIndicesChanged()}_MaybeAddInstance(e){this._instances.includes(e)||(this._instances.push(e),0!==e.GetWorldInfo().GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged())}_PrependInstance(e,t){const s=e.GetWorldInfo();if(s.GetLayer()!==this)throw Error("instance added to wrong layer");this._instances.unshift(e),0!==s.GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged(),t&&this.UsesRenderCells()&&e.GetWorldInfo().SetBboxChanged()}_RemoveInstance(e,t){const s=this._instances.indexOf(e);0>s||(t&&this.UsesRenderCells()&&e.GetWorldInfo()._RemoveFromRenderCells(),this._instances.splice(s,1),this.SetZIndicesChanged(),this._MaybeResetAnyInstanceZElevatedFlag())}_SetAnyInstanceZElevated(){this._anyInstanceZElevated=!0}_MaybeResetAnyInstanceZElevatedFlag(){0===this._instances.length&&(this._anyInstanceZElevated=!1)}_SortInstancesByLastCachedZIndex(e){if(e){for(var t of(e=new Set,this._instances)){var s=t.GetWorldInfo()._GetLastCachedZIndex();0<=s&&e.add(s)}t=-1;for(const i of this._instances)if(!(0<=(s=i.GetWorldInfo())._GetLastCachedZIndex())){for(++t;e.has(t);)++t;s._SetZIndex(t)}}this._instances.sort(SortByInstLastCachedZIndex$jscomp$1)}_Start(){}_End(){for(const e of this._instances)e.GetObjectClass().IsGlobal()||this._runtime.DestroyInstance(e);this._runtime.FlushPendingInstances(),C3$jscomp$80.clearArray(this._instances),this._anyInstanceZElevated=!1,this.SetZIndicesChanged()}RecreateInitialObjects(e,t,s,i,r){const n=this._runtime.GetEventSheetManager(),a=this._runtime.GetAllObjectClasses(),o=e.IsFamily(),h=[];for(const u of this._initialInstances){var l=u[0];if(t.containsPoint(l[0],l[1])){if((l=a[u[1]])!==e){if(!o)continue;if(!e.FamilyHasMember(l))continue}l=this;var c=this._runtime.GetCurrentLayout();this.GetLayout()!==c&&((l=c.GetLayerByName(this.GetName()))||(l=c.GetLayerByIndex(this.GetIndex()))),c=this._runtime.CreateInstanceFromData(u,l,!1,void 0,void 0,!1,r),l.SortAndAddInstancesByZIndex(c),(l=c.GetWorldInfo()).OffsetXY(s,i),l.SetBboxChanged(),n.BlockFlushingInstances(!0),c._TriggerOnCreatedOnSelfAndRelated(),n.BlockFlushingInstances(!1),h.push(c)}}return h}GetInstanceCount(){return this._instances.length}GetLayout(){return this._layout}GetName(){return this._name}_SetIndex(e){this._index=e}GetIndex(){return this._index}GetSID(){return this._sid}GetRuntime(){return this._runtime}GetDevicePixelRatio(){return this._runtime.GetDevicePixelRatio()}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}_MaybeRebuildEffectChainSteps(){const e=this.HasDefaultColor();if(this._needsRebuildEffectChainSteps||e!==this._wasDefaultColor||this._effectChain.NeedsRebuild()){var t=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(t.map((e=>e.GetShaderProgram())),{indexMap:t.map((e=>e.GetIndex())),forcePreDraw:!e,useFullSurface:!0}),this._needsRebuildEffectChainSteps=!1,this._wasDefaultColor=e}}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects(),this._needsRebuildEffectChainSteps=!0}UsesRenderCells(){return this._useRenderCells&&!this._useCameraDistanceDrawOrder}GetRenderGrid(){return this._renderGrid}SetRenderListStale(){this._isRenderListUpToDate=!1}IsVisible(){for(const e of this.selfAndParentLayers())if(!e._IsVisibleFlagSet())return!1;return!0}_IsVisibleFlagSet(){return this._isVisible}SetVisible(e){e=!!e,this._isVisible!==e&&(this._isVisible=e,this._runtime.UpdateRender())}SetInteractive(e){this._isInteractive=!!e}IsInteractive(){return this._isInteractive}IsSelfAndParentsInteractive(){for(const e of this.selfAndParentLayers())if(!e.IsInteractive())return!1;return!0}SetOwnScrollPositionEnabled(e){e=!!e,this._hasOwnScrollPosition!==e&&((this._hasOwnScrollPosition=e)&&(e=this.GetLayout(),this._scrollX=e.GetScrollX(),this._scrollY=e.GetScrollY()),this._SetMVMatrixChanged(),this._runtime.UpdateRender())}IsOwnScrollPositionEnabled(){return this._hasOwnScrollPosition}SetScrollX(e){var t=this.GetLayout();const s=t.GetScrollLeftBound();e>(t=t.GetScrollRightBound())&&(e=t),e<s&&(e=s),this._scrollX!==e&&(this._scrollX=e,this.IsOwnScrollPositionEnabled()&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender()))}SetScrollY(e){var t=this.GetLayout();const s=t.GetScrollTopBound();e>(t=t.GetScrollBottomBound())&&(e=t),e<s&&(e=s),this._scrollY!==e&&(this._scrollY=e,this.IsOwnScrollPositionEnabled()&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender()))}GetScrollX(){return this.IsOwnScrollPositionEnabled()?this._scrollX:this.GetLayout().GetScrollX()}GetScrollY(){return this.IsOwnScrollPositionEnabled()?this._scrollY:this.GetLayout().GetScrollY()}GetViewport(){return this._MaybeUpdateViewport(),this._viewport}_GetViewportZ0(){return this._MaybeUpdateViewport(),this._viewportZ0}GetViewport3D(){return this._MaybeUpdateViewport(),this._viewport3D}_GetVanishingPoint(){const e=this.GetLayout();return[e.GetVanishingPointX(),e.GetVanishingPointY()]}GetDefaultCameraZ(e){return this._runtime.GetDefaultCameraZ(e)}GetViewportForZ(e,t){var s=this._GetViewportZ0();if(0===e)t.copy(s);else{let a=s.midX(),o=s.midY();var i=this.Get2DScaleFactorToZ(e);const h=s.width()/i;s=s.height()/i;const[l,c]=this._GetVanishingPoint();if(.5!==l||.5!==c){const t=this.GetCameraZ();var r=this._runtime,n=this.GetDefaultCameraZ()/t;i=(l-.5)*r.GetViewportWidth()/n,r=(c-.5)*r.GetViewportHeight()/n,0!==(n=this.GetAngle())&&(tempVec2.set(i,r),tempVec2.rotate(n),i=tempVec2.getX(),r=tempVec2.getY()),e=C3$jscomp$80.unlerp(t,0,e),a+=C3$jscomp$80.lerp(i,0,e),o+=C3$jscomp$80.lerp(r,0,e)}t.set(a-h/2,o-s/2,a+h/2,o+s/2)}}GetOpacity(){return this._color.getA()}SetOpacity(e){e=C3$jscomp$80.clamp(e,0,1),this._color.getA()!==e&&(this._color.setA(e),this._UpdatePremultipliedColor(),this._runtime.UpdateRender())}_UpdatePremultipliedColor(){this._premultipliedColor.copy(this._color),this._premultipliedColor.premultiply()}GetPremultipliedColor(){return this._premultipliedColor}HasDefaultColor(){return this._color.equalsRgba(1,1,1,1)}GetScaleRate(){return this._scaleRate}SetScaleRate(e){this._scaleRate!==e&&(this._scaleRate=e,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetParallaxX(){return this._parallaxX}GetParallaxY(){return this._parallaxY}SetParallax(e,t){if((this._parallaxX!==e||this._parallaxY!==t)&&(this._parallaxX=e,this._parallaxY=t,this._SetMVMatrixChanged(),this._runtime.UpdateRender(),1!==this._parallaxX||1!==this._parallaxY))for(const e of this._instances)e.GetObjectClass()._SetAnyInstanceParallaxed(!0)}SetParallaxX(e){this.SetParallax(e,this.GetParallaxY())}SetParallaxY(e){this.SetParallax(this.GetParallaxX(),e)}SetZElevation(e){this._zElevation!==e&&(this._zElevation=e,this._runtime.UpdateRender())}GetZElevation(){return this._zElevation}SetAngle(e){e=C3$jscomp$80.clampAngle(e),this._angle!==e&&(this._angle=e,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetAngle(){return C3$jscomp$80.clampAngle(this._layout.GetAngle()+this._angle)}GetOwnAngle(){return this._angle}HasInstances(){return 0<this._instances.length}_GetInstances(){return this._instances}_GetInstancesInDrawOrder(){return this.RendersIn3DMode()&&this._useCameraDistanceDrawOrder?(C3$jscomp$80.shallowAssignArray(tempInstancesByCameraDist,this._GetInstances()),tempInstancesByCameraDist.sort(((e,t)=>this._SortInstancesByCameraDistance(e,t))),tempInstancesByCameraDist):this._GetInstances()}_AppendAllInstancesIncludingSubLayersInDrawOrder(e){C3$jscomp$80.appendArray(e,this._GetInstancesInDrawOrder());for(const t of this._subLayers)t.IsVisible()&&0<t.GetOpacity()&&t._AppendAllInstancesIncludingSubLayersInDrawOrder(e)}_SortInstancesByCameraDistance(e,t){var s=this.GetLayout().Get3DCameraPosition(),i=s[0],r=s[1];s=s[2];var n=e.GetWorldInfo();const a=t.GetWorldInfo();return t=n.GetX()-i,e=n.GetY()-r,n=n.GetZElevation()-s,(i=a.GetX()-i)*i+(r=a.GetY()-r)*r+(s=a.GetZElevation()-s)*s-(t*t+e*e+n*n)}GetBackgroundColor(){return this._backgroundColor}IsTransparent(){return this._isTransparent}SetTransparent(e){e=!!e,this._isTransparent!==e&&(this._isTransparent=e,this._runtime.UpdateRender())}IsForceOwnTexture(){return this._isForceOwnTexture}SetForceOwnTexture(e){e=!!e,this._isForceOwnTexture!==e&&(this._isForceOwnTexture=e,this._runtime.UpdateRender())}RendersIn2DMode(){return!this.GetRuntime().Uses3DFeatures()||!this._renderAs3d}RendersIn3DMode(){return!this.RendersIn2DMode()}Has3DCamera(){return this.RendersIn3DMode()&&this.GetLayout().Is3DCameraEnabled()}SelfAndAllSubLayersHave3DCamera(){if(!this.Has3DCamera())return!1;for(const e of this._subLayers)if(!e.SelfAndAllSubLayersHave3DCamera())return!1;return!0}SetBlendMode(e){this._blendMode!==e&&(this._blendMode=e,this._runtime.UpdateRender())}GetBlendMode(){return this._blendMode}IsRootLayer(){return!this._parentLayer}GetParentLayer(){return this._parentLayer}GetSubLayers(){return this._subLayers}HasAnySubLayers(){return 0<this._subLayers.length}HasAnyVisibleSubLayer(){for(const e of this._subLayers)if(e.ShouldDraw())return!0;return!1}*selfAndAllSubLayers(){for(const e of this._subLayers)yield*e.selfAndAllSubLayers();yield this}*parentLayers(){let e=this.GetParentLayer();for(;e;)yield e,e=e.GetParentLayer()}*selfAndParentLayers(){yield this,yield*this.parentLayers()}IsTransformCompatibleWith(e){return this===e||this._parallaxX===e._parallaxX&&this._parallaxY===e._parallaxY&&this._scale===e._scale&&this._scaleRate===e._scaleRate&&this._angle===e._angle&&this.GetScrollX()===e.GetScrollX()&&this.GetScrollY()===e.GetScrollY()}SaveTransform(){return{parallaxX:this.GetParallaxX(),parallaxY:this.GetParallaxY(),scale:this.GetOwnScale(),scaleRate:this.GetScaleRate(),angle:this.GetOwnAngle(),hasOwnScroll:this.IsOwnScrollPositionEnabled(),scrollX:this.GetScrollX(),scrollY:this.GetScrollY()}}RestoreTransform(e){this.SetParallax(e.parallaxX,e.parallaxY),this.SetOwnScale(e.scale),this.SetScaleRate(e.scaleRate),this.SetAngle(e.angle),this.SetOwnScrollPositionEnabled(e.hasOwnScroll),this.SetScrollX(e.scrollX),this.SetScrollY(e.scrollY),this._MaybeUpdateViewport()}_RemoveAllInstancesInSet(e){0!==e.size&&0<C3$jscomp$80.arrayRemoveAllInSet(this._instances,e)&&(this._MaybeResetAnyInstanceZElevatedFlag(),this.SetZIndicesChanged())}SetZIndicesChanged(){this._isRenderListUpToDate=this._zIndicesUpToDate=!1}_UpdateZIndices(){if(!this._zIndicesUpToDate){if(this._instances.sort(SortByInstZElevation),this.UsesRenderCells())for(let e=0,t=this._instances.length;e<t;++e){const t=this._instances[e].GetWorldInfo();t._SetZIndex(e),this._renderGrid.MarkRangeChanged(t.GetRenderCellRange())}else for(let e=0,t=this._instances.length;e<t;++e)this._instances[e].GetWorldInfo()._SetZIndex(e);this._zIndicesUpToDate=!0}}MoveInstanceAdjacent(e,t,s){var i=e.GetWorldInfo();if(t=t.GetWorldInfo(),i.GetLayer()!==this||t.GetLayer()!==this)throw Error("can't arrange Z order unless both objects on this layer");return(i=i.GetZIndex())!==(t=t.GetZIndex())+(s?1:-1)&&(C3$jscomp$80.arrayRemove(this._instances,i),i<t&&t--,s&&t++,t===this._instances.length?this._instances.push(e):this._instances.splice(t,0,e),this.SetZIndicesChanged(),!0)}_MergeSortedZArrays(e,t){const s=[];let i=0,r=0,n=e.length,a=t.length;for(;i<n&&r<a;){const n=e[i],a=t[r];n.GetWorldInfo()._GetLastCachedZIndex()<a.GetWorldInfo()._GetLastCachedZIndex()?(s.push(n),++i):(s.push(a),++r)}for(;i<n;++i)s.push(e[i]);for(;r<a;++r)s.push(t[r]);return s}_MergeAllSortedZArrays_pass(e){const t=[],s=e.length;for(let i=0;i<s-1;i+=2)t.push(this._MergeSortedZArrays(e[i],e[i+1]));return 1==s%2&&t.push(e[s-1]),t}_MergeAllSortedZArrays(e){for(;1<e.length;)e=this._MergeAllSortedZArrays_pass(e);return e[0]}_GetRenderCellInstancesToDraw(){return this._UpdateZIndices(),C3$jscomp$80.clearArray(renderCellArr),this._renderGrid.QueryRange(this.GetViewport(),renderCellArr),renderCellArr.length?1===renderCellArr.length?renderCellArr[0]:this._MergeAllSortedZArrays(renderCellArr):[]}ShouldDraw(){return this.IsVisible()&&0<this.GetOpacity()&&this._DrawsAnyContentInSelfOrSubLayers()}_DrawsAnyContentInSelfOrSubLayers(){if(this.HasInstances()||!this.IsTransparent())return!0;for(const e of this._subLayers)if(e._DrawsAnyContentInSelfOrSubLayers())return!0;return!1}UsesOwnTexture(){return this.IsForceOwnTexture()||!this.HasDefaultColor()||0!==this.GetBlendMode()||this._effectList.HasAnyActiveEffect()}SelfOrAnySubLayerUsesOwnTexture(){if(this.UsesOwnTexture())return!0;for(const e of this._subLayers)if(e.SelfOrAnySubLayerUsesOwnTexture())return!0;return!1}GetRenderTarget(){return this._curRenderTarget}Get2DScaleFactorToZ(e){if(this._layout.IsOrthographicProjection())return 1;const t=this.GetCameraZ();return t/(t-e)}GetCameraZ(e){return this.GetDefaultCameraZ(e)/this.GetNormalScale()}_SetMVMatrixChanged(){this._isViewportChanged=this._isViewFrustumChanged=this._isMVMatrixChanged=!0}_GetModelViewMatrix(e){return this._isMVMatrixChanged&&(this._CalculateModelViewMatrix(e,this._modelViewMatrix,0,0,null),this._isMVMatrixChanged=!1),this._modelViewMatrix}GetCameraPosition(){if(this.Has3DCamera()){const e=this.GetLayout().Get3DCameraPosition();return[e[0],e[1],e[2]]}return this._Get2DCameraPosition()}_Get2DCameraPosition(e=0,t=0,s=0){var i=this._runtime,r=this.GetLayout(),n=i.GetParallaxXOrigin(),a=i.GetParallaxYOrigin();n=(this.GetScrollX()-n)*this._parallaxX+n,a=(this.GetScrollY()-a)*this._parallaxY+a,i.IsPixelRoundingEnabled()&&(n=Math.round(n),a=Math.round(a)),e=n+e,t=a+t,r=r.IsOrthographicProjection()?this.GetDefaultCameraZ(s):this.GetCameraZ(s);const[o,h]=this._GetVanishingPoint();return.5===o&&.5===h||(a=this.GetDefaultCameraZ(s)/r,s=(o-.5)*i.GetViewportWidth()/a,i=(h-.5)*i.GetViewportHeight()/a,0!==(a=this.GetAngle())&&(tempVec2.set(s,i),tempVec2.rotate(a),s=tempVec2.getX(),i=tempVec2.getY()),e+=s,t+=i),[e,t,r]}_CalculateModelViewMatrix(e,t,s,i,r){const n=this._runtime;var a=this.GetLayout();if(this.Has3DCamera()){vec3$jscomp$6.copy(camVector,a.Get3DCameraPosition()),vec3$jscomp$6.copy(lookVector,a.Get3DCameraLookAt()),vec3$jscomp$6.copy(upVector,a.Get3DCameraUpVector()),s=n.GetParallaxXOrigin(),i=n.GetParallaxYOrigin(),a=lookVector[0]-camVector[0];const e=lookVector[1]-camVector[1],t=lookVector[2]-camVector[2];camVector[0]=(camVector[0]-s)*this._parallaxX+s,camVector[1]=(camVector[1]-i)*this._parallaxY+i,camVector[2]*=Math.max(this._parallaxX,this._parallaxY),lookVector[0]=camVector[0]+a,lookVector[1]=camVector[1]+e,lookVector[2]=camVector[2]+t}else{const[e,t,n]=this._Get2DCameraPosition(s,i,r);vec3$jscomp$6.set(camVector,e,t,n),vec3$jscomp$6.set(lookVector,e,t,n-100),0===(s=this.GetAngle())?vec3$jscomp$6.set(upVector,0,1,0):vec3$jscomp$6.set(upVector,Math.sin(s),Math.cos(s),0)}e.CalculateLookAtModelView(t,camVector,lookVector,upVector,r||n.GetViewportHeight())}_SetProjectionMatrixChanged(){this._isViewportChanged=this._isViewFrustumChanged=this._isProjectionMatrixChanged=!0}_GetProjectionMatrix(e){return this._isProjectionMatrixChanged&&(this._CalculateProjectionMatrix(e),this._isProjectionMatrixChanged=!1),this._projectionMatrix}_CalculateProjectionMatrix(e){var t=this._runtime.GetCanvasManager();const[s,i]=this._GetVanishingPoint();if(this._layout.IsOrthographicProjection())e.CalculateOrthographicMatrix(this._projectionMatrix,t.GetDrawWidth(),t.GetDrawHeight());else if(.5===s&&.5===i)mat4$jscomp$9.copy(this._projectionMatrix,t.GetDefaultProjectionMatrix());else{const r=t.GetDrawWidth();t=t.GetDrawHeight(),e.CalculatePerspectiveMatrix(this._projectionMatrix,r/t,s,i)}}_SetTransform(e,t=!0,s=0,i=0,r=0){t&&e.SetProjectionMatrix(this._GetProjectionMatrix(e)),0===s&&0===i&&0===r?t=this._GetModelViewMatrix(e):(this._CalculateModelViewMatrix(e,tempMat4$jscomp$4,s,i,r),t=tempMat4$jscomp$4),e.SetModelViewMatrix(t)}PrepareForDraw(e){this._SetTransform(e),e.SetBaseZ(this.GetZElevation())}Draw(e,t,s){var i=this._runtime.GetCanvasManager();const r=this.UsesOwnTexture();var n=null;let a=null;if(this._runtime.IsGPUProfiling())if(e.IsWebGL()){const t=i.GetLayerTimingsBuffer(this);t&&(a=t.AddTimeElapsedQuery(),e.StartQuery(a))}else e.IsWebGPU()&&e.WriteTimestamp(2*(this.GetIndex()+1));r?(n={sampling:this._runtime.GetSampling(),isSampled:!0,canReadPixels:!!e.IsWebGPU()&&this._runtime.UsesAnyBackgroundBlending()},"low"===i.GetCurrentFullscreenScalingQuality()&&(n.width=i.GetDrawWidth(),n.height=i.GetDrawHeight()),this._curRenderTarget=n=this._runtime.GetAdditionalRenderTarget(n),e.SetRenderTarget(n),this.IsTransparent()&&e.ClearRgba(0,0,0,0)):(this._curRenderTarget=t,e.SetRenderTarget(t)),this.IsTransparent()||e.Clear(this._backgroundColor),this._layout._DrawLayerList(e,this._curRenderTarget,this._subLayers,r&&this.IsTransparent()),this._SetTransform(e),e.SetBaseZ(this.GetZElevation()),e.SetDepthEnabled(this.RendersIn3DMode()),this.GetNormalScale()>Number.EPSILON&&(this._UpdateZIndices(),i=this.UsesRenderCells()&&0===this.GetZElevation()&&!this._anyInstanceZElevated,this.Has3DCamera()?this._DrawInstances_3DCamera(e):i?this._DrawInstances_RenderCells(e):this._DrawInstances(e,this._GetInstancesInDrawOrder())),e.SetBaseZ(0),e.SetCurrentZ(0),r&&(e.SetDepthEnabled(!1),this._DrawLayerOwnTextureToRenderTarget(e,n,t,s)),a&&e.EndQuery(a),this._runtime.IsGPUProfiling()&&e.IsWebGPU()&&e.WriteTimestamp(2*(this.GetIndex()+1)+1),this._curRenderTarget=null}_DrawInstances(e,t){const s=this.GetViewport(),i=this._curRenderTarget,r=this.GetLayout().IsOrthographicProjection(),n=this.GetLayout().HasVanishingPointOutsideViewport();let a=null;for(let o=0,h=t.length;o<h;++o){const h=t[o];if(h===a)continue;a=h;const l=h.GetWorldInfo();l.IsVisible()&&l.IsInViewport(s,n,r)&&this._DrawInstanceMaybeWithEffects(h,l,e,i)}}_DrawInstances_3DCamera(e){const t=this._curRenderTarget,s=this._GetViewFrustum(),i=this._GetInstancesInDrawOrder();for(let o=0,h=i.length;o<h;){var r=i[o],n=r.GetWorldInfo();if(!n.IsVisible()||!n.IsInViewport3D(s)){++o;continue}(!r.RendersToOwnZPlane()||0<n.GetDepth())&&tempInstanceList2.push(r);var a=r.GetWorldInfo().GetTotalZElevation();tempInstanceList1.push(r);let l=o+1;for(;l<h;++l){const e=i[l],t=e.GetWorldInfo();if(t.IsVisible()&&t.IsInViewport3D(s)){if(t.GetTotalZElevation()!==a)break;e.RendersToOwnZPlane()?(0<t.GetDepth()&&tempInstanceList2.push(e),tempInstanceList1.push(e)):tempInstanceList2.push(e)}}if(1!==tempInstanceList1.length||tempInstanceList1[0].MustMitigateZFighting()){this._DrawCoplanarInstances_3DCamera(e,tempInstanceList1);for(let s=0,i=tempInstanceList2.length;s<i;++s)(n=(r=tempInstanceList2[s]).GetWorldInfo())._SetDrawNonBackFacesOnly(!0),this._DrawInstanceMaybeWithEffects(r,n,e,t),n._SetDrawNonBackFacesOnly(!1)}else{this._DrawInstanceMaybeWithEffects(r,n,e,t);for(let s=0,i=tempInstanceList2.length;s<i;++s)(n=tempInstanceList2[s])!==r&&(a=n.GetWorldInfo()).GetLayer()._DrawInstanceMaybeWithEffects(n,a,e,t)}o=l,C3$jscomp$80.clearArray(tempInstanceList1),C3$jscomp$80.clearArray(tempInstanceList2)}}_DrawCoplanarInstances_3DCamera(e,t){const s=this._curRenderTarget;e.CoplanarStartStencilPass();for(let s=0,n=t.length;s<n;++s){var i=t[s],r=i.GetWorldInfo();r._SetDrawBackFaceOnly(!0),this._DrawInstance(i,r,e)}e.CoplanarStartColorPass();for(let n=0,a=t.length;n<a;++n)r=(i=t[n]).GetWorldInfo(),this._DrawInstanceMaybeWithEffects(i,r,e,s),r._SetDrawBackFaceOnly(!1);e.CoplanarRestoreStandardRendering()}_DrawInstances_RenderCells(e){var t=this._renderGrid;const s=this._curRenderCells,i=this._lastRenderCells,r=this.GetViewport();s.set(t.XToCell(r.getLeft()),t.YToCell(r.getTop()),t.XToCell(r.getRight()),t.YToCell(r.getBottom())),this._isRenderListUpToDate&&s.equals(i)?t=this._lastRenderList:(t=this._GetRenderCellInstancesToDraw(),this._isRenderListUpToDate=!0,i.copy(s)),this._DrawInstances(e,t),t!==this._lastRenderList&&C3$jscomp$80.shallowAssignArray(this._lastRenderList,t)}_DrawInstanceMaybeWithEffects(e,t,s,i){t.HasAnyActiveEffect()?this._DrawInstanceWithEffectsAndRestore(e,t,s,i):this._DrawInstance(e,t,s)}_DrawInstance(e,t,s){t=t.GetRendererStateGroup(),s.GetCurrentStateGroup()!==t&&t.Apply(),e.Draw(s)}_DrawInstanceWithEffectsAndRestore(e,t,s,i){this._DrawInstanceWithEffects(e,t,s,i,null)&&this._SetTransform(s)}_DrawInstanceWithEffects(e,t,s,i,r){const n=t.GetInstanceEffectList().GetEffectChain();return n.Render(s,i,{contentObject:e,blendMode:t.GetBlendMode(),devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),time:e.GetInstanceGameTime(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:t.GetBoundingBox(),drawSurfaceRect:n.CanSkipCalculatingDrawSurfaceRect()?null:this._InstanceBoxToDrawSurface(t),drawContentHook:r&&r.drawContentHook,compositOffX:r&&r.compositOffX,compositOffY:r&&r.compositOffY,updateOwnProjection:r&&r.updateOwnProjection}),s.SetBaseZ(this.GetZElevation()),n.DidChangeTransform()}_DrawLayerOwnTextureToRenderTarget(e,t,s,i){const r=this._effectList.GetActiveEffectTypes(),n=this._runtime;0===r.length?(e.SetRenderTarget(s),e.SetTextureFillMode(),i&&0===this._blendMode&&this.HasDefaultColor()?e.CopyRenderTarget(t):(e.SetBlendMode(this._blendMode),e.SetColor(this._premultipliedColor),e.DrawRenderTarget(t)),e.InvalidateRenderTarget(t),n.ReleaseAdditionalRenderTarget(t)):this.GetEffectChain().Render(e,s,{contentObject:this,blendMode:this.GetBlendMode(),devicePixelRatio:n.GetEffectDevicePixelRatioParam(),layerScale:n.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:this.GetViewport(),drawSurfaceRect:null,invalidateRenderTargets:!0})}GetOwnScale(){return this._scale}SetOwnScale(e){this._scale!==e&&(this._scale=e,this._layout.BoundScrolling(),this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetRenderScale(){return this.GetNormalScale()*this._runtime.GetRenderScale()}GetDisplayScale(){return this.GetNormalScale()*this._runtime.GetDisplayScale()}GetNormalScale(){return(this._scale*this._layout.GetScale()-1)*this._scaleRate+1}_MaybeUpdateViewport(){if(this._isViewportChanged){this._isViewportChanged=!1;var e=this._runtime.GetParallaxXOrigin(),t=this._runtime.GetParallaxYOrigin(),s=(this.GetScrollX()-e)*this._parallaxX+e,i=(this.GetScrollY()-t)*this._parallaxY+t;e=this.GetNormalScale(),s-=(t=this._runtime.GetViewportWidth()/e)/2;var r=i-(e=this._runtime.GetViewportHeight()/e)/2;this._runtime.IsPixelRoundingEnabled()&&(s=Math.round(s),r=Math.round(r)),(i=this._viewportZ0).set(s,r,s+t,r+e),0!==(t=this.GetAngle())&&(tmpRect$jscomp$2.copy(i),tmpRect$jscomp$2.offset(-i.midX(),-i.midY()),tmpQuad$jscomp$2.setFromRotatedRect(tmpRect$jscomp$2,t),tmpQuad$jscomp$2.getBoundingBox(tmpRect$jscomp$2),tmpRect$jscomp$2.offset(i.midX(),i.midY()),i.copy(tmpRect$jscomp$2)),t=this._zElevation,this.GetViewportForZ(t,this._viewport),this.Has3DCamera()?this.CalculateViewport3D(t,this._viewport3D):this._viewport3D.copy(this._viewport)}}CalculateViewport3D(e,t){var s=this._runtime.GetCanvasManager(),i=s.GetCssWidth();s=s.GetCssHeight();const[r,n]=this.CanvasCssToLayer(0,0,e),[a,o]=this.CanvasCssToLayer(i,0,e),[h,l]=this.CanvasCssToLayer(i,s,e),[c,u]=this.CanvasCssToLayer(0,s,e);e=Math.min(r,a,h,c),i=Math.min(n,o,l,u),s=Math.max(r,a,h,c);let p=Math.max(n,o,l,u);isFinite(e)||(e=-1/0),isFinite(i)||(i=-1/0),isFinite(s)||(s=1/0),isFinite(p)||(p=1/0),t.set(e,i,s,p)}CanvasCssToLayer(e,t,s=0){return this._CanvasToLayer(e,t,s,this.GetDisplayScale())}DrawSurfaceToLayer(e,t,s=0){return this._CanvasToLayer(e,t,s,this.GetRenderScale()*this.GetDevicePixelRatio())}_CanvasToLayer(e,t,s,i){var r=this._runtime,n=r.GetRenderer(),a=this.GetNormalScale(),o=r.GetViewportWidth()/a;return a=r.GetViewportHeight()/a,r=tempVec4$jscomp$1,vec4$jscomp$5.set(r,0,0,o,a),e/=i,t=r[3]-t/i,i=this._GetProjectionMatrix(n),n=this._GetModelViewMatrix(n),o=tempVec3,C3$jscomp$80.Gfx.UnprojectScreenToWorldZ(e,t,s,n,i,r,o)?[o[0],o[1]]:[NaN,NaN]}CanvasCssToLayer_DefaultTransform(e,t){const s=this._scale,i=this._scaleRate,r=this._parallaxX,n=this._parallaxY,a=this._angle;return this._parallaxY=this._parallaxX=this._scaleRate=this._scale=1,this._angle=0,this._SetMVMatrixChanged(),e=this.CanvasCssToLayer(e,t),this._scale=s,this._scaleRate=i,this._parallaxX=r,this._parallaxY=n,this._angle=a,this._SetMVMatrixChanged(),e}LayerToCanvasCss(e,t,s=0){return this._LayerToCanvas(e,t,s,this.GetDisplayScale())}LayerToDrawSurface(e,t,s=0){return this._LayerToCanvas(e,t,s,this.GetRenderScale()*this.GetDevicePixelRatio())}_LayerToCanvas(e,t,s,i){var r=this._runtime,n=r.GetRenderer(),a=this.GetNormalScale(),o=r.GetViewportWidth()/a;return a=r.GetViewportHeight()/a,r=tempVec4$jscomp$1,vec4$jscomp$5.set(r,0,0,o,a),o=this._GetProjectionMatrix(n),n=this._GetModelViewMatrix(n),a=tempVec3,C3$jscomp$80.Gfx.Project(e,t,s,n,o,r,a)?[a[0]*i,(r[3]-a[1])*i]:[NaN,NaN]}_GetLayerToDrawSurfaceScale(e,t){return e*=this.GetRenderScale()*this.GetDevicePixelRatio(),0!==t&&(e*=this.Get2DScaleFactorToZ(t)),e}_InstanceBoxToDrawSurface(e){var t=e.GetBoundingBox(),s=e.GetTotalZElevation();const i=s+(e=e.GetDepth()),r=t.getLeft(),n=t.getTop(),a=t.getRight();if(t=t.getBottom(),this.Has3DCamera()){if(this._IsPointBehindNearPlane(r,n,s)||this._IsPointBehindNearPlane(a,n,s)||this._IsPointBehindNearPlane(a,t,s)||this._IsPointBehindNearPlane(r,t,s)||0<e&&(this._IsPointBehindNearPlane(r,n,i)||this._IsPointBehindNearPlane(a,n,i)||this._IsPointBehindNearPlane(a,t,i)||this._IsPointBehindNearPlane(r,t,i)))return null}else if(i>=this.GetCameraZ())return null;let[o,h]=this.LayerToDrawSurface(r,n,s),[l,c]=this.LayerToDrawSurface(a,t,s);if(0!==this.GetAngle()||0<e||this.Has3DCamera()){const[u,p]=this.LayerToDrawSurface(a,n,s),[_,m]=this.LayerToDrawSurface(r,t,s);if(0<e){const[e,d]=this.LayerToDrawSurface(r,n,i),[g,f]=this.LayerToDrawSurface(a,n,i),[C,S]=this.LayerToDrawSurface(a,t,i),[y,$]=this.LayerToDrawSurface(r,t,i);s=Math.min(o,l,u,_,e,g,C,y),l=Math.max(o,l,u,_,e,g,C,y),o=s,s=Math.min(h,c,p,m,d,f,S,$),c=Math.max(h,c,p,m,d,f,S,$),h=s}else s=Math.min(o,l,u,_),l=Math.max(o,l,u,_),o=s,s=Math.min(h,c,p,m),c=Math.max(h,c,p,m),h=s}return tmpRect$jscomp$2.set(o,h,l,c),tmpRect$jscomp$2}_GetViewFrustum(){return this._isViewFrustumChanged&&(this._UpdateViewFrustum(),this._isViewFrustumChanged=!1),this._viewFrustum}_UpdateViewFrustum(){var e=this._runtime.GetRenderer();const t=this._GetProjectionMatrix(e);e=this._GetModelViewMatrix(e),this._viewFrustum.CalculatePlanes(e,t)}_IsPointBehindNearPlane(e,t,s){return this._GetViewFrustum().IsBehindNearPlane(e,t,s)}_SaveToJson(){return{s:this.GetOwnScale(),a:this.GetOwnAngle(),v:this._IsVisibleFlagSet(),i:this.IsInteractive(),bc:this._backgroundColor.toJSON(),t:this.IsTransparent(),sx:this._scrollX,sy:this._scrollY,hosp:this._hasOwnScrollPosition,px:this.GetParallaxX(),py:this.GetParallaxY(),c:this._color.toJSON(),sr:this.GetScaleRate(),fx:this._effectList.SaveToJson(),cg:this._createdGlobalUids}}_LoadFromJson(e){this._scale=e.s,this._angle=e.a,this._isVisible=!!e.v,this._isInteractive=!e.hasOwnProperty("i")||e.i,this._backgroundColor.setFromJSON(e.bc),this._isTransparent=!!e.t,e.hasOwnProperty("sx")&&(this._scrollX=e.sx),e.hasOwnProperty("sy")&&(this._scrollY=e.sy),e.hasOwnProperty("hosp")&&(this._hasOwnScrollPosition=!!e.hosp),this._parallaxX=e.px,this._parallaxY=e.py,this._color.setFromJSON(e.c),this._scaleRate=e.sr,C3$jscomp$80.shallowAssignArray(this._createdGlobalUids,e.cg),C3$jscomp$80.shallowAssignArray(this._initialInstances,this._startupInitialInstances);const t=new Set(this._createdGlobalUids);let s=0;for(let e=0,i=this._initialInstances.length;e<i;++e)t.has(this._initialInstances[e][2])||(this._initialInstances[s]=this._initialInstances[e],++s);C3$jscomp$80.truncateArray(this._initialInstances,s),this._effectList.LoadFromJson(e.fx),this._needsRebuildEffectChainSteps=!0,this._SortInstancesByLastCachedZIndex(!1),this.SetZIndicesChanged(),this._SetMVMatrixChanged(),this._SetProjectionMatrixChanged()}GetILayer(){return this._iLayer}SortAndAddInstancesByZIndex(e,t=!1){if(this._instances.includes(e))t&&this._instances.sort(((e,t)=>(e=e.GetWorldInfo().GetSceneGraphZIndex())-(t=t.GetWorldInfo().GetSceneGraphZIndex())));else if(e.HasChildren()){var s=[...e.allChildren()];for(var i of(s.push(e),s.sort(((e,t)=>(e=e.GetWorldInfo().GetSceneGraphZIndex())-(t=t.GetWorldInfo().GetSceneGraphZIndex()))),s))if(i.IsInContainer())for(const t of i.siblings())s.includes(t)||((e=[...t.allChildren()]).push(t),e.sort(((e,t)=>(e=e.GetWorldInfo().GetSceneGraphZIndex())-(t=t.GetWorldInfo().GetSceneGraphZIndex()))),e&&e.length&&s.splice(s.length,0,...e));for(const e of s)e.GetPlugin().IsWorldType()&&this._AddInstance(e,!0)}else if(e.GetPlugin().IsWorldType()&&this._AddInstance(e,!0),e.IsInContainer())for(s of e.siblings())if((i=[...s.allChildren()]).push(s),i.sort(((e,t)=>(e=e.GetWorldInfo().GetSceneGraphZIndex())-(t=t.GetWorldInfo().GetSceneGraphZIndex()))),i&&i.length)for(const e of i)e.GetPlugin().IsWorldType()&&this._AddInstance(e,!0)}};const C3$jscomp$81=self.C3,C3Debugger=self.C3Debugger;C3$jscomp$81.New(C3$jscomp$81.Rect),C3$jscomp$81.New(C3$jscomp$81.Rect);const tempLayoutRect=C3$jscomp$81.New(C3$jscomp$81.Rect),tempColor$jscomp$4=C3$jscomp$81.New(C3$jscomp$81.Color),vec3$jscomp$7=self.glMatrix.vec3,tempRender3dList=[],tempInstanceList1$jscomp$1=[],tempInstanceList2$jscomp$1=[],tempInstanceList3=[];function vec3EqualsXYZ(e,t,s,i){return e[0]===Math.fround(t)&&e[1]===Math.fround(s)&&e[2]===Math.fround(i)}let lastLayerPreparedForDrawing=null;function MaybePrepareLayerDraw(e,t){lastLayerPreparedForDrawing!==e&&(e.PrepareForDraw(t),lastLayerPreparedForDrawing=e)}C3$jscomp$81.Layout=class extends C3$jscomp$81.DefendedBase{constructor(e,t,s){super(),this._layoutManager=e,this._runtime=e.GetRuntime(),this._name=s[0],this._originalWidth=s[1],this._originalHeight=s[2],this._width=s[1],this._height=s[2],this._isUnboundedScrolling=!!s[3],this._isOrthographicProjection=!!s[4],this._vanishingPointX=s[5],this._vanishingPointY=s[6],this._eventSheetName=s[7],this._eventSheet=null,this._sid=s[8],this._index=t,this._scrollY=this._scrollX=0,this._scale=1,this._angle=0,this._initialObjectClasses=new Set,this._textureLoadedTypes=new Set,this._textureLoadPendingPromises=new Set,this._createdInstances=[],this._createdPersistedInstances=[],this._createdPersistedInstancesToDataMap=new Map,this._createdPersistedIndexToInstanceMap=new Map,this._initialNonWorld=[],this._is3dCameraEnabled=!1,this._cam3dposition=vec3$jscomp$7.create(),this._cam3dlook=vec3$jscomp$7.create(),this._cam3dup=vec3$jscomp$7.create(),this._rootLayers=[],this._allLayersFlat=[],this._layersByName=new Map,this._layersBySid=new Map;const i=this._runtime.GetCanvasManager();this._effectList=C3$jscomp$81.New(C3$jscomp$81.EffectList,this,s[11]),this._effectChain=C3$jscomp$81.New(C3$jscomp$81.Gfx.EffectChain,i.GetEffectChainManager(),{drawContent:(e,t)=>{t=t.GetContentObject().GetRenderTarget(),e.ResetColor(),e.DrawRenderTarget(t),e.InvalidateRenderTarget(t),i.ReleaseAdditionalRenderTarget(t)},getShaderParameters:e=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(e)}),this._needsRebuildEffectChainSteps=!0,this._wasFullScreenQualityLow=!1,this._curRenderTarget=null,this._persistData={},this._persistedIntances=new Map,this._isFirstVisit=!0,this._iLayout=new self.ILayout(this),this._userScriptDispatcher=C3$jscomp$81.New(C3$jscomp$81.Event.Dispatcher);for(const e of s[9])this._rootLayers.push(C3$jscomp$81.New(C3$jscomp$81.Layer,this,null,e));this._allLayersFlat=[...this.allLayers()];for(let t=0,s=this._allLayersFlat.length;t<s;++t)(e=this._allLayersFlat[t])._SetIndex(t),e._Init(),this._layersByName.set(e.GetName().toLowerCase(),e),this._layersBySid.set(e.GetSID(),e);for(const e of s[10]){if(!(s=this._runtime.GetObjectClassByIndex(e[1])))throw Error("missing nonworld object class");s.GetDefaultInstanceData()||s.SetDefaultInstanceData(e),this._initialNonWorld.push(e),this._AddInitialObjectClass(s)}}Release(){for(const e of this._allLayersFlat)e.Release();C3$jscomp$81.clearArray(this._allLayersFlat),this._textureLoadPendingPromises.clear(),this._runtime=this._layoutManager=this._eventSheet=null}GetRuntime(){return this._runtime}GetName(){return this._name}GetSID(){return this._sid}GetIndex(){return this._index}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}_MaybeRebuildEffectChainSteps(){const e="low"===this._runtime.GetCanvasManager().GetCurrentFullscreenScalingQuality();if(this._needsRebuildEffectChainSteps||this._wasFullScreenQualityLow!==e||this._effectChain.NeedsRebuild()){var t=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(t.map((e=>e.GetShaderProgram())),{indexMap:t.map((e=>e.GetIndex())),forcePostDraw:e,useFullSurface:!0}),this._needsRebuildEffectChainSteps=!1,this._wasFullScreenQualityLow=e}}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects(),this._needsRebuildEffectChainSteps=!0}GetMinLayerScale(){let e=this._allLayersFlat[0].GetNormalScale();for(let t=1,s=this._allLayersFlat.length;t<s;++t){const s=this._allLayersFlat[t];0===s.GetParallaxX()&&0===s.GetParallaxY()||(e=Math.min(e,s.GetNormalScale()))}return e}_GetScrollBoundMarginHorizontal(){return.5*this._runtime.GetViewportWidth()/this.GetMinLayerScale()}_GetScrollBoundMarginVertical(){return.5*this._runtime.GetViewportHeight()/this.GetMinLayerScale()}GetScrollLeftBound(){return this.IsUnboundedScrolling()?-1/0:this._GetScrollBoundMarginHorizontal()}GetScrollRightBound(){return this.IsUnboundedScrolling()?1/0:this.GetWidth()-this._GetScrollBoundMarginHorizontal()}GetScrollTopBound(){return this.IsUnboundedScrolling()?-1/0:this._GetScrollBoundMarginVertical()}GetScrollBottomBound(){return this.IsUnboundedScrolling()?1/0:this.GetHeight()-this._GetScrollBoundMarginVertical()}SetScrollX(e){const t=this.GetScrollLeftBound(),s=this.GetScrollRightBound();e>s&&(e=s),e<t&&(e=t),this._scrollX!==e&&(this._scrollX=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollX(){return this._scrollX}SetScrollY(e){const t=this.GetScrollTopBound(),s=this.GetScrollBottomBound();e>s&&(e=s),e<t&&(e=t),this._scrollY!==e&&(this._scrollY=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollY(){return this._scrollY}IsUnboundedScrolling(){return this._isUnboundedScrolling}BoundScrolling(){this.SetScrollX(this.GetScrollX()),this.SetScrollY(this.GetScrollY());for(const e of this._allLayersFlat)e.IsOwnScrollPositionEnabled()&&(e.SetScrollX(e.GetScrollX()),e.SetScrollY(e.GetScrollY()))}SetVanishingPointXY(e,t){this._vanishingPointX===e&&this._vanishingPointY===t||(this._vanishingPointX=e,this._vanishingPointY=t,this.IsPerspectiveProjection()&&(this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender()))}GetVanishingPointX(){return this.IsOrthographicProjection()?.5:this._vanishingPointX}GetVanishingPointY(){return this.IsOrthographicProjection()?.5:this._vanishingPointY}HasVanishingPointOutsideViewport(){const e=this.GetVanishingPointX(),t=this.GetVanishingPointY();return 0>e||1<e||0>t||1<t}SetPerspectiveProjection(){this._isOrthographicProjection&&(this._isOrthographicProjection=!1,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}SetOrthographicProjection(){this._isOrthographicProjection||(this._isOrthographicProjection=!0,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}IsOrthographicProjection(){return this._isOrthographicProjection}IsPerspectiveProjection(){return!this.IsOrthographicProjection()}Set3DCameraEnabled(e){e=!!e,this._is3dCameraEnabled!==e&&(this._is3dCameraEnabled=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}Is3DCameraEnabled(){return this._is3dCameraEnabled}Set3DCameraOrientation(e,t,s,i,r,n,a,o,h){vec3EqualsXYZ(this._cam3dposition,e,t,s)&&vec3EqualsXYZ(this._cam3dlook,i,r,n)&&vec3EqualsXYZ(this._cam3dup,a,o,h)||(vec3$jscomp$7.set(this._cam3dposition,e,t,s),vec3$jscomp$7.set(this._cam3dlook,i,r,n),vec3$jscomp$7.set(this._cam3dup,a,o,h),this.Set3DCameraChanged())}Set3DCameraChanged(){this._SetAllLayersMVChanged(),this._runtime.UpdateRender()}Get3DCameraPosition(){return this._cam3dposition}Get3DCameraLookAt(){return this._cam3dlook}Get3DCameraUpVector(){return this._cam3dup}GetScale(){return this._scale}SetScale(e){this._scale!==e&&(this._scale=e,this._SetAllLayersMVChanged(),this.BoundScrolling(),this._runtime.UpdateRender())}SetAngle(e){e=C3$jscomp$81.clampAngle(e),this._angle!==e&&(this._angle=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetAngle(){return this._angle}GetWidth(){return this._width}SetWidth(e){!isFinite(e)||1>e||(this._width=e)}GetHeight(){return this._height}SetHeight(e){!isFinite(e)||1>e||(this._height=e)}GetEventSheet(){return this._eventSheet}*allLayers(){for(const e of this._rootLayers)yield*e.selfAndAllSubLayers()}GetLayers(){return this._allLayersFlat}GetLayerCount(){return this._allLayersFlat.length}GetLayer(e){return"number"==typeof e?this.GetLayerByIndex(e):this.GetLayerByName(e.toString())}GetLayerByIndex(e){return e=C3$jscomp$81.clamp(Math.floor(e),0,this._allLayersFlat.length-1),this._allLayersFlat[e]}GetLayerByName(e){return this._layersByName.get(e.toLowerCase())||null}GetLayerBySID(e){return this._layersBySid.get(e)||null}_SetAllLayersProjectionChanged(){for(const e of this._allLayersFlat)e._SetProjectionMatrixChanged()}_SetAllLayersMVChanged(){for(const e of this._allLayersFlat)e._SetMVMatrixChanged()}SaveTransform(){return{scrollX:this.GetScrollX(),scrollY:this.GetScrollY(),scale:this.GetScale(),angle:this.GetAngle(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY()}}RestoreTransform(e){this.SetScrollX(e.scrollX),this.SetScrollY(e.scrollY),this.SetScale(e.scale),this.SetAngle(e.angle),this.SetVanishingPointXY(e.vpX,e.vpY)}GetLayoutBackgroundColor(){let e=this._rootLayers.filter((e=>e.ShouldDraw()))[0];for(;e;){if(!e.IsTransparent())return tempColor$jscomp$4.copyRgb(e.GetBackgroundColor()),tempColor$jscomp$4.setA(1),tempColor$jscomp$4;if(e.UsesOwnTexture())return tempColor$jscomp$4.setRgba(0,0,0,0),tempColor$jscomp$4;e=e.GetSubLayers().filter((e=>e.ShouldDraw()))[0]}return tempColor$jscomp$4.setRgba(0,0,0,0),tempColor$jscomp$4}IsFirstVisit(){return this._isFirstVisit}_GetInitialObjectClasses(){return[...this._initialObjectClasses]}_AddInitialObjectClass(e){if(e.IsInContainer())for(const t of e.GetContainer().GetObjectTypes())this._initialObjectClasses.add(t);else this._initialObjectClasses.add(e)}_GetTextureLoadedObjectTypes(){return[...this._textureLoadedTypes]}_Load(e,t){if(e===this||!t)return Promise.resolve();e&&(C3$jscomp$81.CopySet(this._textureLoadedTypes,e._textureLoadedTypes),e._textureLoadedTypes.clear()),e=[];for(const s of this._initialObjectClasses)this._textureLoadedTypes.has(s)||(e.push(s.LoadTextures(t)),this._textureLoadedTypes.add(s));return Promise.all(e)}async MaybeLoadTexturesFor(e){if(e.IsFamily())throw Error("cannot load textures for family");var t=this._runtime.GetRenderer();!t||t.IsContextLost()||this._textureLoadedTypes.has(e)||(this._textureLoadedTypes.add(e),t=e.LoadTextures(t),this._AddPendingTextureLoadPromise(t),await t,e.OnDynamicTextureLoadComplete(),this._runtime.UpdateRender())}_AddPendingTextureLoadPromise(e){this._textureLoadPendingPromises.add(e),e.then((()=>this._textureLoadPendingPromises.delete(e))).catch((()=>this._textureLoadPendingPromises.delete(e)))}WaitForPendingTextureLoadsToComplete(){return Promise.all([...this._textureLoadPendingPromises])}MaybeUnloadTexturesFor(e){if(e.IsFamily()||0<e.GetInstanceCount())throw Error("cannot unload textures");const t=this._runtime.GetRenderer();t&&this._textureLoadedTypes.has(e)&&(this._textureLoadedTypes.delete(e),e.ReleaseTextures(t))}_Unload(e,t){if(e!==this&&t)for(const t of this._textureLoadedTypes)t.IsGlobal()||e._initialObjectClasses.has(t)||(t.ReleaseTextures(),this._textureLoadedTypes.delete(t))}_OnRendererContextLost(){this._textureLoadedTypes.clear()}async _StartRunning(e){const t=this._runtime,s=this._layoutManager,i=t.GetEventSheetManager();this._eventSheetName&&(this._eventSheet=i.GetEventSheetByName(this._eventSheetName),this._eventSheet._UpdateDeepIncludes()),s._SetMainRunningLayout(this),this._width=this._originalWidth,this._height=this._originalHeight,this._scrollX=t.GetOriginalViewportWidth()/2,this._scrollY=t.GetOriginalViewportHeight()/2,this.BoundScrolling(),this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._MoveGlobalObjectsToThisLayout(e),this._runtime.SetUsingCreatePromises(!0),this._CreateInitialInstances(),this._isFirstVisit||this._CreatePersistedInstances(),this._CreateAndLinkContainerInstances(this._createdInstances),this._CreateInitialNonWorldInstances(),s.ClearPendingChangeLayout(),t.FlushPendingInstances(),this._runtime.SetUsingCreatePromises(!1);var r=this._runtime.GetCreatePromises();if(await Promise.all(r),C3$jscomp$81.clearArray(r),!t.IsLoadingState()){for(const e of this._createdInstances)e.SetupInitialSceneGraphConnections();for(const e of this._createdPersistedInstances)e.SetupPersistedSceneGraphConnections(this._createdPersistedInstancesToDataMap,this._createdPersistedIndexToInstanceMap);for(const[e,t]of Object.entries(this._persistData))(r=this._runtime.GetObjectClassBySID(parseInt(e,10)))&&!r.IsFamily()&&r.HasPersistBehavior()&&C3$jscomp$81.clearArray(t);for(const e of this._createdInstances)e._TriggerOnCreated();for(const e of this._createdPersistedInstances)e._TriggerOnCreated()}C3$jscomp$81.clearArray(this._createdInstances),C3$jscomp$81.clearArray(this._createdPersistedInstances),this._createdPersistedInstancesToDataMap.clear(),this._createdPersistedIndexToInstanceMap.clear(),await Promise.all([...this._initialObjectClasses].map((e=>e.PreloadTexturesWithInstances(this._runtime.GetRenderer())))),e&&(t.Dispatcher().dispatchEvent(new C3$jscomp$81.Event("beforefirstlayoutstart")),await t.DispatchUserScriptEventAsyncWait(new C3$jscomp$81.Event("beforeprojectstart"))),await this.DispatchUserScriptEventAsyncWait(new C3$jscomp$81.Event("beforelayoutstart")),t.IsLoadingState()||await t.TriggerAsync(C3$jscomp$81.Plugins.System.Cnds.OnLayoutStart,null,null),t.Dispatcher().dispatchEvent(new C3$jscomp$81.Event("afterlayoutstart")),await this.DispatchUserScriptEventAsyncWait(new C3$jscomp$81.Event("afterlayoutstart")),e&&(t.Dispatcher().dispatchEvent(new C3$jscomp$81.Event("afterfirstlayoutstart")),await t.DispatchUserScriptEventAsyncWait(new C3$jscomp$81.Event("afterprojectstart"))),i._RunQueuedTriggers(s),await this.WaitForPendingTextureLoadsToComplete(),this._isFirstVisit=!1}_MoveGlobalObjectsToThisLayout(e){for(const e of this._runtime.GetAllObjectClasses())if(!e.IsFamily()&&e.IsWorldType())for(const s of e.GetInstances()){const e=s.GetWorldInfo();var t=e.GetLayer();t=C3$jscomp$81.clamp(t.GetIndex(),0,this._allLayersFlat.length-1),t=this._allLayersFlat[t],e._SetLayer(t),t._MaybeAddInstance(s)}if(!e)for(const e of this._allLayersFlat)e._SortInstancesByLastCachedZIndex(!1)}_CreateInitialInstances(){for(const e of this._allLayersFlat)e.CreateInitialInstances(this._createdInstances),e._Start()}_CreatePersistedInstances(){let e=!1;for(const[s,i]of Object.entries(this._persistData)){const r=this._runtime.GetObjectClassBySID(parseInt(s,10));if(r&&!r.IsFamily()&&r.HasPersistBehavior())for(const s of i){var t=null;r.IsWorldType()&&!(t=s.hasOwnProperty("instJson")?this.GetLayerBySID(s.instJson.w.l):this.GetLayerBySID(s.w.l))||(t=this._runtime.CreateInstanceFromData(r,t,!1,0,0,!0),s.hasOwnProperty("instJson")?t.LoadFromJson(s.instJson):t.LoadFromJson(s),e=!0,this._createdPersistedInstances.push(t),s.hasOwnProperty("instJson")&&(this._createdPersistedInstancesToDataMap.set(t,s),this._createdPersistedIndexToInstanceMap.set(s.index,t)))}}for(const e of this._allLayersFlat)e._SortInstancesByLastCachedZIndex(!0),e.SetZIndicesChanged();e&&(this._runtime.FlushPendingInstances(),this._runtime._RefreshUidMap())}_CreateAndLinkContainerInstances(e){for(const s of e){if(!s.IsInContainer())continue;const i=s.GetWorldInfo(),r=s.GetIID();for(const n of s.GetObjectClass().GetContainer().objectTypes())if(n!==s.GetObjectClass()){var t=n.GetInstances();t.length>r?s._AddSibling(t[r]):(t=i?this._runtime.CreateInstanceFromData(n,i.GetLayer(),!0,i.GetX(),i.GetY(),!0):this._runtime.CreateInstanceFromData(n,null,!0,0,0,!0),this._runtime.FlushPendingInstances(),n._UpdateIIDs(),s._AddSibling(t),e.push(t))}}}_CreateInitialNonWorldInstances(){for(const e of this._initialNonWorld)this._runtime.GetObjectClassByIndex(e[1]).IsInContainer()||this._runtime.CreateInstanceFromData(e,null,!0)}_CreateGlobalNonWorlds(){const e=[],t=this._initialNonWorld;let s=0;for(let i=0,r=t.length;i<r;++i){const r=t[i],n=this._runtime.GetObjectClassByIndex(r[1]);n.IsGlobal()?n.IsInContainer()&&n.GetContainer().HasAnyWorldType()||e.push(this._runtime.CreateInstanceFromData(r,null,!0)):(t[s]=r,++s)}C3$jscomp$81.truncateArray(t,s),this._runtime.FlushPendingInstances(),this._CreateAndLinkContainerInstances(e)}RecreateInitialObjects(e,t,s,i,r,n){if(s)return s.RecreateInitialObjects(e,t,i,r,n);s=[];for(const a of this._allLayersFlat)s.push(a.RecreateInitialObjects(e,t,i,r,n));return s.flat()}async _StopRunning(){const e=this._layoutManager;this._runtime.IsLoadingState()||(await this.DispatchUserScriptEventAsyncWait(new C3$jscomp$81.Event("beforelayoutend")),await this._runtime.TriggerAsync(C3$jscomp$81.Plugins.System.Cnds.OnLayoutEnd,null,null),await this.DispatchUserScriptEventAsyncWait(new C3$jscomp$81.Event("afterlayoutend"))),e.SetIsEndingLayout(!0),this._runtime.GetEventSheetManager().ClearAllScheduledWaits(),this._isFirstVisit||this._SavePersistData();for(const e of this._allLayersFlat)e._End();for(const e of this._runtime.GetAllObjectClasses())if(!(e.IsGlobal()||e.IsWorldType()||e.GetPlugin().IsSingleGlobal()||e.IsFamily())){for(const t of e.GetInstances())this._runtime.DestroyInstance(t);this._runtime.FlushPendingInstances()}e.SetIsEndingLayout(!1),e.GetMainRunningLayout()===this&&e._SetMainRunningLayout(null)}_SaveInstanceToPersist(e,t){var s=e.GetObjectClass().GetSID().toString();this._persistData.hasOwnProperty(s)||(this._persistData[s]=[]),s=this._persistData[s],t={index:t,instJson:e.SaveToJson(),sceneGraphJson:{children:[]}},s.push(t),this._persistedIntances.set(e,t)}_SaveSceneGraphInfoToPersist(e){const t=this._persistedIntances.get(e);for(const s of e.GetChildren())(e=this._persistedIntances.get(s))&&t.sceneGraphJson.children.push({index:e.index,flags:C3$jscomp$81.SceneGraphInfo._GetFlagsNumber(s.GetWorldInfo())})}_SavePersistData(){this._persistedIntances.clear();var e=0;for(const t of this._allLayersFlat){t._UpdateZIndices();for(const s of t._GetInstances()){const t=s.GetObjectClass();!t.IsGlobal()&&t.HasPersistBehavior()&&(this._SaveInstanceToPersist(s,e),e++)}}for(const t of this._allLayersFlat)for(const s of t._GetInstances())!(e=s.GetObjectClass()).IsGlobal()&&e.HasPersistBehavior()&&this._SaveSceneGraphInfoToPersist(s);this._persistedIntances.clear()}ResetPersistData(){this._persistData={},this._isFirstVisit=!0}GetRenderTarget(){return this._curRenderTarget}UsesOwnTexture(){const e=this._runtime,t=e.GetRenderer().IsWebGL();return"low"===e.GetCanvasManager().GetCurrentFullscreenScalingQuality()||t&&e.UsesAnyBackgroundBlending()||"low-latency"===e.GetCompositingMode()||this._effectList.HasAnyActiveEffect()||t&&e.Uses3DFeatures()}Draw(e){const t=this._runtime.GetCanvasManager(),s=this.UsesOwnTexture();if(s){"low-latency"!==this._runtime.GetCompositingMode()&&(e.SetRenderTarget(null),e.ClearRgba(0,0,0,0));const s={sampling:this._runtime.GetSampling(),isSampled:e.IsWebGPU()||this._runtime.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect(),canReadPixels:!!e.IsWebGPU()&&this._runtime.UsesAnyBackgroundBlending()};"low"===t.GetCurrentFullscreenScalingQuality()&&(s.width=t.GetDrawWidth(),s.height=t.GetDrawHeight()),this._curRenderTarget=this._runtime.GetAdditionalRenderTarget(s)}else this._curRenderTarget=null;e.SetRenderTarget(this._curRenderTarget),e.Clear(this.GetLayoutBackgroundColor()),this._runtime.Uses3DFeatures()&&e.ClearDepth(),this._DrawLayerList(e,this._curRenderTarget,this._rootLayers,!0),s&&(e.SetDepthEnabled(!1),this._DrawLayoutOwnTextureToRenderTarget(e,this._curRenderTarget)),this._curRenderTarget=null}_DrawLayerList(e,t,s,i){s=s.filter((e=>e.ShouldDraw()));for(let r=0,n=s.length;r<n;){const a=s[r];if(a.SelfAndAllSubLayersHave3DCamera()&&!a.SelfOrAnySubLayerUsesOwnTexture()){tempRender3dList.push(a);for(let e=r+1;e<n;++e){const t=s[e];if(!t.SelfAndAllSubLayersHave3DCamera()||t.SelfOrAnySubLayerUsesOwnTexture())break;tempRender3dList.push(s[e])}if(2<=tempRender3dList.length||1===tempRender3dList.length&&tempRender3dList[0].HasAnyVisibleSubLayer()){this._Draw3DLayers(e,t,tempRender3dList),r+=tempRender3dList.length,C3$jscomp$81.clearArray(tempRender3dList);continue}C3$jscomp$81.clearArray(tempRender3dList)}a.Draw(e,t,i&&0===r),++r}}_DrawLayoutOwnTextureToRenderTarget(e,t){const s=this._effectList.GetActiveEffectTypes(),i=this._runtime;0===s.length?(e.SetRenderTarget(null),e.SetTextureFillMode(),e.CopyRenderTarget(t),e.InvalidateRenderTarget(t),i.ReleaseAdditionalRenderTarget(t)):(tempLayoutRect.set(0,0,i.GetViewportWidth(),i.GetViewportHeight()),this.GetEffectChain().Render(e,null,{contentObject:this,blendMode:3,devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetScale(),layerAngle:this.GetAngle(),layoutRect:tempLayoutRect,drawSurfaceRect:null,invalidateRenderTargets:!0}))}_Draw3DLayers(e,t,s){s[0].IsTransparent()||(tempColor$jscomp$4.copyRgb(s[0].GetBackgroundColor()),tempColor$jscomp$4.setA(1),e.Clear(tempColor$jscomp$4));var i=this._runtime.GetCanvasManager();for(var r of(e.SetDepthEnabled(!0),s))r._UpdateZIndices(),r._AppendAllInstancesIncludingSubLayersInDrawOrder(tempInstanceList1$jscomp$1);s=s[0],r=null,this._runtime.IsGPUProfiling()&&(e.IsWebGL()?(i=i.GetLayerTimingsBuffer(s))&&(r=i.AddTimeElapsedQuery(),e.StartQuery(r)):e.IsWebGPU()&&e.WriteTimestamp(2*(s.GetIndex()+1)));for(let s=0,r=tempInstanceList1$jscomp$1.length;s<r;){var n=tempInstanceList1$jscomp$1[s],a=n.GetWorldInfo(),o=a.GetLayer();if(a.IsVisible()&&a.IsInViewport3D(o._GetViewFrustum())){(!n.RendersToOwnZPlane()||0<a.GetDepth())&&tempInstanceList3.push(n);var h=n.GetWorldInfo().GetTotalZElevation();for(tempInstanceList2$jscomp$1.push(n),i=s+1;i<r;++i){const e=tempInstanceList1$jscomp$1[i],t=e.GetWorldInfo();if(t.IsVisible()&&t.IsInViewport3D(t.GetLayer()._GetViewFrustum())){if(t.GetTotalZElevation()!==h)break;e.RendersToOwnZPlane()?(0<t.GetDepth()&&tempInstanceList3.push(e),tempInstanceList2$jscomp$1.push(e)):tempInstanceList3.push(e)}}if(1!==tempInstanceList2$jscomp$1.length||tempInstanceList2$jscomp$1[0].MustMitigateZFighting()){this._Draw3DLayersCoplanarInstances(e,t,tempInstanceList2$jscomp$1);for(let s=0,i=tempInstanceList3.length;s<i;++s)o=(a=(n=tempInstanceList3[s]).GetWorldInfo()).GetLayer(),a._SetDrawNonBackFacesOnly(!0),MaybePrepareLayerDraw(o,e),o._DrawInstanceMaybeWithEffects(n,a,e,t),a._SetDrawNonBackFacesOnly(!1)}else{MaybePrepareLayerDraw(o,e),o._DrawInstanceMaybeWithEffects(n,a,e,t);for(let s=0,i=tempInstanceList3.length;s<i;++s)(a=tempInstanceList3[s])!==n&&(MaybePrepareLayerDraw(h=(o=a.GetWorldInfo()).GetLayer(),e),h._DrawInstanceMaybeWithEffects(a,o,e,t))}s=i,C3$jscomp$81.clearArray(tempInstanceList2$jscomp$1),C3$jscomp$81.clearArray(tempInstanceList3)}else++s}r&&e.EndQuery(r),this._runtime.IsGPUProfiling()&&e.IsWebGPU()&&e.WriteTimestamp(2*(s.GetIndex()+1)+1),C3$jscomp$81.clearArray(tempInstanceList1$jscomp$1),lastLayerPreparedForDrawing=null}_Draw3DLayersCoplanarInstances(e,t,s){e.CoplanarStartStencilPass();for(let t=0,a=s.length;t<a;++t){var i=s[t],r=i.GetWorldInfo(),n=r.GetLayer();r._SetDrawBackFaceOnly(!0),MaybePrepareLayerDraw(n,e),n._DrawInstance(i,r,e)}e.CoplanarStartColorPass();for(let a=0,o=s.length;a<o;++a)MaybePrepareLayerDraw(n=(r=(i=s[a]).GetWorldInfo()).GetLayer(),e),n._DrawInstanceMaybeWithEffects(i,r,e,t),r._SetDrawBackFaceOnly(!1);e.CoplanarRestoreStandardRendering()}_SaveToJson(){const e={sx:this.GetScrollX(),sy:this.GetScrollY(),s:this.GetScale(),a:this.GetAngle(),w:this.GetWidth(),h:this.GetHeight(),ortho:this.IsOrthographicProjection(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY(),fv:this._isFirstVisit,persist:this._persistData,fx:this._effectList.SaveToJson(),layers:{}};for(const t of this._allLayersFlat)e.layers[t.GetSID().toString()]=t._SaveToJson();return e}_LoadFromJson(e){this._scrollX=e.sx,this._scrollY=e.sy,this._scale=e.s,this._angle=e.a,this._width=e.w,this._height=e.h,this._isOrthographicProjection=!!e.ortho,e.hasOwnProperty("vpX")&&(this._vanishingPointX=e.vpX),e.hasOwnProperty("vpY")&&(this._vanishingPointY=e.vpY),this._isFirstVisit=!!e.fv,this._persistData=e.persist,this._effectList.LoadFromJson(e.fx),this._needsRebuildEffectChainSteps=!0;for(const[t,s]of Object.entries(e.layers))e=parseInt(t,10),(e=this.GetLayerBySID(e))&&e._LoadFromJson(s);this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged()}GetILayout(){return this._iLayout}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.layout=this.GetILayout();var t=this._runtime;(t=t.IsDebug()&&!t.GetEventSheetManager().IsInEventEngine())&&C3Debugger.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),t&&C3Debugger.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){return e.layout=this.GetILayout(),this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}};const C3$jscomp$82=self.C3;C3$jscomp$82.LayoutManager=class extends C3$jscomp$82.DefendedBase{constructor(e){super(),this._runtime=e,this._allLayouts=[],this._layoutsByName=new Map,this._layoutsBySid=new Map,this._mainRunningLayout=null,this._runningSubLayouts=[],this._firstLayout=null,this._isEndingLayout=0,this._pendingChangeLayout=null}Release(){this._pendingChangeLayout=this._firstLayout=this._mainRunningLayout=this._runtime=null,C3$jscomp$82.clearArray(this._allLayouts),this._layoutsByName.clear(),this._layoutsBySid.clear(),C3$jscomp$82.clearArray(this._runningSubLayouts)}Create(e){e=C3$jscomp$82.New(C3$jscomp$82.Layout,this,this._allLayouts.length,e),this._allLayouts.push(e),this._layoutsByName.set(e.GetName().toLowerCase(),e),this._layoutsBySid.set(e.GetSID(),e)}GetRuntime(){return this._runtime}SetFirstLayout(e){this._firstLayout=e}GetFirstLayout(){if(this._firstLayout)return this._firstLayout;if(this._allLayouts.length)return this._allLayouts[0];throw Error("no first layout")}GetLayoutByName(e){return this._layoutsByName.get(e.toLowerCase())||null}GetLayoutBySID(e){return this._layoutsBySid.get(e)||null}GetLayoutByIndex(e){return e=C3$jscomp$82.clamp(Math.floor(e),0,this._allLayouts.length-1),this._allLayouts[e]}GetLayout(e){return"number"==typeof e?this.GetLayoutByIndex(e):this.GetLayoutByName(e.toString())}GetAllLayouts(){return this._allLayouts}_SetMainRunningLayout(e){this._mainRunningLayout=e}GetMainRunningLayout(){return this._mainRunningLayout}_AddRunningSubLayout(e){if(this._runningSubLayouts.includes(e))throw Error("layout already running");this._runningSubLayouts.push(e)}_RemoveRunningSubLayout(e){if(-1===(e=this._runningSubLayouts.indexOf(e)))throw Error("layout not running");this._runningSubLayouts.splice(e,1)}*runningLayouts(){this._mainRunningLayout&&(yield this._mainRunningLayout),this._runningSubLayouts.length&&(yield*this._runningSubLayouts)}IsLayoutRunning(e){return this._mainRunningLayout===e||this._runningSubLayouts.includes(e)}SetIsEndingLayout(e){if(e)this._isEndingLayout++;else{if(0>=this._isEndingLayout)throw Error("already unset");this._isEndingLayout--}}IsEndingLayout(){return 0<this._isEndingLayout}ChangeMainLayout(e){this._pendingChangeLayout=e}ClearPendingChangeLayout(){this._pendingChangeLayout=null}IsPendingChangeMainLayout(){return!!this._pendingChangeLayout}GetPendingChangeMainLayout(){return this._pendingChangeLayout}SetAllLayerProjectionChanged(){const e=this.GetMainRunningLayout();e&&e._SetAllLayersProjectionChanged()}SetAllLayerMVChanged(){const e=this.GetMainRunningLayout();e&&e._SetAllLayersMVChanged()}};const C3$jscomp$83=self.C3,NAMES_REGEXP=RegExp("<(.+?)>","g");C3$jscomp$83.TimelineManager=class extends C3$jscomp$83.DefendedBase{constructor(e){super(),this._runtime=e,this._timelineDataManager=C3$jscomp$83.New(C3$jscomp$83.TimelineDataManager),this._pluginInstance=null,this._timelines=[],this._timelinesByName=new Map,this._objectClassToTimelineMap=new Map,this._timelinesCreatedByTemplate=new Map,this._scheduledTimelines=[],this._playingTimelines=[],this._markedForRemovalTimelines=[],this._isTickingTimelines=this._changingLayout=this._hasRuntimeListeners=!1,this._tickFunc=()=>this._OnTick(),this._tick2Func=()=>this._OnTick2(),this._beforeLayoutChange=()=>this._OnBeforeChangeLayout(),this._layoutChange=()=>this._OnAfterChangeLayout(),this._instanceDestroy=e=>this._OnInstanceDestroy(e.instance),this._beforeLoad=e=>this._OnBeforeLoad(),this._afterLoad=e=>this._OnAfterLoad(),this._afterLayoutStart=e=>this._OnAfterLayoutStart(),this._destroyedWhileLoadingState=[],this._renderChange=0}Release(){this.RemoveRuntimeListeners(),this._afterLoad=this._instanceDestroy=this._layoutChange=this._beforeLayoutChange=this._tick2Func=this._tickFunc=null;for(const e of this._timelines)e.Stop(),e.Release();C3$jscomp$83.clearArray(this._timelines),this._timelines=null,this._timelineDataManager.Release(),this._timelineDataManager=null,C3$jscomp$83.clearArray(this._scheduledTimelines),this._scheduledTimelines=null,C3$jscomp$83.clearArray(this._playingTimelines),this._playingTimelines=null,C3$jscomp$83.clearArray(this._markedForRemovalTimelines),this._markedForRemovalTimelines=null,this._timelinesByName.clear(),this._timelinesByName=null,this._objectClassToTimelineMap.clear(),this._objectClassToTimelineMap=null,this._timelinesCreatedByTemplate.clear(),this._timelinesCreatedByTemplate=null,C3$jscomp$83.clearArray(this._destroyedWhileLoadingState),this._runtime=this._destroyedWhileLoadingState=null}AddRuntimeListeners(){const e=this._runtime.Dispatcher();e.addEventListener("pretick",this._tickFunc),e.addEventListener("tick2",this._tick2Func),e.addEventListener("beforelayoutchange",this._beforeLayoutChange),e.addEventListener("layoutchange",this._layoutChange),e.addEventListener("instancedestroy",this._instanceDestroy),e.addEventListener("beforeload",this._beforeLoad),e.addEventListener("afterload",this._afterLoad),e.addEventListener("afterlayoutstart",this._afterLayoutStart)}RemoveRuntimeListeners(){const e=this._runtime.Dispatcher();e.removeEventListener("pretick",this._tickFunc),e.removeEventListener("tick2",this._tick2Func),e.removeEventListener("beforelayoutchange",this._beforeLayoutChange),e.removeEventListener("layoutchange",this._layoutChange),e.removeEventListener("instancedestroy",this._instanceDestroy),e.removeEventListener("beforeload",this._beforeLoad),e.removeEventListener("afterload",this._afterLoad),e.removeEventListener("afterlayoutstart",this._afterLayoutStart)}Create(e){this._timelineDataManager.Add(e),e=C3$jscomp$83.TimelineState.CreateInitial(e,this),this.Add(e),this.SetTimelineObjectClassesToMap(e),this._timelinesCreatedByTemplate.set(e.GetName(),0)}CreateFromTemplate(e){var t=this.GetTimelineDataManager();return e=e.GetTemplateName(),t=t.Get(e),t=C3$jscomp$83.TimelineState.CreateFromTemplate(`${e}:${this._timelinesCreatedByTemplate.get(e)}`,t,this),this._IncreaseTemplateTimelinesCount(e),this.Add(t),t}_IncreaseTemplateTimelinesCount(e){this._timelinesCreatedByTemplate.set(e,this._timelinesCreatedByTemplate.get(e)+1)}_SetCreatedTemplateTimelinesCount(){for(const e of this._timelines){if(e.IsTemplate())continue;const t=e.GetTemplateName();this._IncreaseTemplateTimelinesCount(t)}}_ClearCreatedTemplateTimelinesCount(){for(const e of this._timelinesCreatedByTemplate.keys())this._timelinesCreatedByTemplate.set(e,0)}Add(e){this._timelines.push(e),this._timelinesByName.set(e.GetName().toLowerCase(),e)}Remove(e){e.Removed(),e.IsTemplate()||(C3$jscomp$83.arrayFindRemove(this._timelines,e),C3$jscomp$83.arrayFindRemove(this._scheduledTimelines,e),C3$jscomp$83.arrayFindRemove(this._playingTimelines,e),C3$jscomp$83.arrayFindRemove(this._markedForRemovalTimelines,e),this._timelinesByName.delete(e.GetName().toLowerCase()),this.RemoveTimelineFromObjectClassMap(e),e.IsReleased()||e.Release())}Trigger(e){this._runtime.Trigger(e,this._pluginInstance,null)}GetRuntime(){return this._runtime}GetTimelineDataManager(){return this._timelineDataManager}SetPluginInstance(e){this._pluginInstance=e}GetPluginInstance(){return this._pluginInstance}*GetTimelines(){for(const e of this._timelines)yield e}*GetPlayingTimelines(){for(const e of this._playingTimelines)yield e}SetTimelineObjectClassToMap(e,t){this._objectClassToTimelineMap.has(e)||this._objectClassToTimelineMap.set(e,new Set),this._objectClassToTimelineMap.get(e).add(t)}SetTimelineObjectClassesToMap(e){for(const t of e.GetObjectClasses())this.SetTimelineObjectClassToMap(t,e)}RemoveTimelineFromObjectClassMap(e){for(const[t,s]of this._objectClassToTimelineMap.entries())s.has(e)&&(s.delete(e),0===s.size&&this._objectClassToTimelineMap.delete(t))}GetTimelinesForObjectClass(e){if(this._objectClassToTimelineMap.has(e))return this._objectClassToTimelineMap.get(e)}GetTimelineOfTemplateForInstances(e,t){if(t)for(const s of this._timelines)if(t.every((e=>s.HasTrackInstance(e.instance,e.trackId)))&&s.GetName().includes(e.GetName()))return s}GetTimelineByName(e){return this._timelinesByName.get(e.toLowerCase())||null}GetScheduledOrPlayingTimelineByName(e){for(const t of this._scheduledTimelines)if(t.GetName()===e)return t;for(const t of this._playingTimelines)if(t.GetName()===e)return t;return null}*GetTimelinesByName(e){if(NAMES_REGEXP.test(e)){let s;NAMES_REGEXP.lastIndex=0;var t=new Set;do{if(s=NAMES_REGEXP.exec(e)){const e=s[1].split(",");for(const s of e)t.add(s)}}while(s);for(const s of t.values())(e=this.GetTimelineByName(s))&&(yield e);t.clear()}else(t=this.GetTimelineByName(e))&&(yield t)}*GetTimelinesByTags(e){for(const t of this._timelines)t.HasTags(e)&&(yield t)}AddScheduledTimeline(e){this._scheduledTimelines.includes(e)||this._scheduledTimelines.push(e),this._MaybeEnableRuntimeListeners()}RemovePlayingTimeline(e){C3$jscomp$83.arrayFindRemove(this._playingTimelines,e),this._MaybeDisableRuntimeListeners()}ScheduleTimeline(e){this._playingTimelines.includes(e)?(e.SetPlaying(!0),e.SetScheduled(!1),e.SetMarkedForRemoval(!1)):(e.SetPlaying(!1),e.SetScheduled(!0),e.SetMarkedForRemoval(!1),this._scheduledTimelines.includes(e)||this._scheduledTimelines.push(e)),this._MaybeEnableRuntimeListeners()}DeScheduleTimeline(e){e.SetPlaying(!1),e.SetScheduled(!1),e.ResolvePlayPromise(),C3$jscomp$83.arrayFindRemove(this._scheduledTimelines,e),this._MaybeDisableRuntimeListeners()}CompleteTimeline(e){e.SetPlaying(!1),e.SetScheduled(!1),this._playingTimelines.includes(e)&&(e.SetMarkedForRemoval(!0),this._markedForRemovalTimelines.push(e),C3$jscomp$83.arrayFindRemove(this._playingTimelines,e))}CompleteTimelineBeforeChangeOfLayout(e){e.SetPlaying(!1),e.SetScheduled(!1),e.SetMarkedForRemoval(!1),e.SetPlaybackRate(1),C3$jscomp$83.arrayFindRemove(this._playingTimelines,e)}CompleteTimelineAndResolve(e){this.CompleteTimeline(e),e.ResolvePlayPromise()}_OnTick(){if(!this.GetRuntime().IsLoadingState()&&this._hasRuntimeListeners&&!this._changingLayout){for(this._isTickingTimelines=!0;this._scheduledTimelines.length;){var e=this._scheduledTimelines.pop();e.SetInitialState(),0!==e.GetRenderChange()&&(this._renderChange=1),this._playingTimelines.push(e)}e=this._runtime._GetDtFast();var t=this._runtime.GetDt1(),s=this._runtime.GetTimeScale();for(let i=this._playingTimelines.length-1;0<=i;i--){const r=this._playingTimelines[i];r&&r.Tick(e,s,t)}this._isTickingTimelines=!1,0!==this._renderChange&&this.GetRuntime().UpdateRender()}}_OnTick2(){if(!this.GetRuntime().IsLoadingState()&&this._hasRuntimeListeners&&!this._changingLayout){var e;for(let t=0,s=this._markedForRemovalTimelines.length;t<s;t++){const s=this._markedForRemovalTimelines[t];e||(e=new Set),s.Removed(),this._MaybeExecuteTimelineFinishTriggers(s),e.add(s)}if(e){C3$jscomp$83.arrayRemoveAllInSet(this._markedForRemovalTimelines,e),this._renderChange=0;for(let e=0,t=this._playingTimelines.length;e<t;e++)if(0!==this._playingTimelines[e].GetRenderChange()){this._renderChange=1;break}}this._MaybeDisableRuntimeListeners()}}_MaybeExecuteTimelineFinishTriggers(e){e.IsReleased()||e.HasValidTracks()&&e.IsComplete()&&e.InitialStateSet()&&e.FinishTriggers()}_MaybeEnableRuntimeListeners(){this._hasRuntimeListeners||(this._hasRuntimeListeners=!0)}_MaybeDisableRuntimeListeners(){this._markedForRemovalTimelines.length||this._playingTimelines.length||this._scheduledTimelines.length||this._isTickingTimelines||(this._hasRuntimeListeners=!1)}_OnBeforeChangeLayout(){for(this._changingLayout=!0;this._scheduledTimelines.length;)this.DeScheduleTimeline(this._scheduledTimelines.pop());const e=new Set;for(const t of this._playingTimelines)t._OnBeforeChangeLayout()&&(t.Removed(),e.add(t));C3$jscomp$83.arrayRemoveAllInSet(this._playingTimelines,e),e.clear();for(const t of this._markedForRemovalTimelines)t._OnBeforeChangeLayout()&&(t.Removed(),e.add(t));C3$jscomp$83.arrayRemoveAllInSet(this._markedForRemovalTimelines,e),this._MaybeDisableRuntimeListeners();for(const e of this._timelines)e.CleanCaches()}_OnAfterChangeLayout(){this._changingLayout=!1}_OnInstanceDestroy(e){var t=e.GetObjectClass();if(t=this.GetTimelinesForObjectClass(t))if(this._runtime.IsLoadingState())this._destroyedWhileLoadingState.push(e);else for(const e of t)e.IsTemplate()||(e.IsReleased()?this.Remove(e):e.HasValidTracks()||(this._MaybeExecuteTimelineFinishTriggers(e),this.Remove(e)))}_OnBeforeLoad(){for(const e of this._scheduledTimelines.map((e=>e)))this._MaybeExecuteTimelineFinishTriggers(e),this.Remove(e);for(const e of this._playingTimelines.map((e=>e)))this._MaybeExecuteTimelineFinishTriggers(e),this.Remove(e)}_OnAfterLoad(){for(const e of this._destroyedWhileLoadingState)this._OnInstanceDestroy(e);C3$jscomp$83.clearArray(this._destroyedWhileLoadingState)}_OnAfterLayoutStart(){const e=this._runtime.GetLayoutManager().GetMainRunningLayout();if(e)for(const t of this._timelines){const s=t.GetStartOnLayout();s&&e.GetName()===s&&this.ScheduleTimeline(t)}}_SaveToJson(){return{timelinesJson:this._SaveTimelinesToJson(),scheduledTimelinesJson:this._SaveScheduledTimelinesToJson(),playingTimelinesJson:this._SavePlayingTimelinesToJson(),markedForRemovalTimelinesJson:this._SaveMarkedForRemovalTimelinesToJson(),hasRuntimeListeners:this._hasRuntimeListeners,changingLayout:this._changingLayout,isTickingTimelines:this._isTickingTimelines}}_LoadFromJson(e){e&&(this._ClearCreatedTemplateTimelinesCount(),this._LoadTimelinesFromJson(e.timelinesJson),this._LoadScheduledTimelinesFromJson(e.scheduledTimelinesJson),this._LoadPlayingTimelinesFromJson(e.playingTimelinesJson),this._LoadMarkedForRemovalTimelinesFromJson(e.markedForRemovalTimelinesJson),this._hasRuntimeListeners=!e.hasRuntimeListeners,this._changingLayout=!!e.changingLayout,this._isTickingTimelines=!!e.isTickingTimelines,this._SetCreatedTemplateTimelinesCount(),this._MaybeEnableRuntimeListeners(),this._MaybeDisableRuntimeListeners())}_SaveTimelinesToJson(){return this._timelines.map((e=>e._SaveToJson()))}_LoadTimelinesFromJson(e){for(const t of e){if(!(e=this.GetTimelineByName(t.name))){if(!(e=this._GetTemplateNameFromJson(t)))continue;e=this.GetTimelineByName(e),e=this.CreateFromTemplate(e)}e._LoadFromJson(t),e.HasTracks()||this.Remove(e)}}_GetTemplateNameFromJson(e){return(e=e.name.split(":"))&&2===e.length?e[0]:null}_SaveScheduledTimelinesToJson(){return this._SaveTimelines(this._scheduledTimelines)}_LoadScheduledTimelinesFromJson(e){this._LoadTimelines(e,this._scheduledTimelines)}_SavePlayingTimelinesToJson(){return this._SaveTimelines(this._playingTimelines)}_LoadPlayingTimelinesFromJson(e){this._LoadTimelines(e,this._playingTimelines)}_SaveMarkedForRemovalTimelinesToJson(){return this._SaveTimelines(this._markedForRemovalTimelines)}_LoadMarkedForRemovalTimelinesFromJson(e){this._LoadTimelines(e,this._markedForRemovalTimelines)}_IsTimelineInJson(e,t){if(!t)return!1;for(const s of t)if(s===e.GetName())return!0;return!1}_SaveTimelines(e){return e.map((e=>e.GetName()))}_LoadTimelines(e,t){var s=new Set;for(const i of t)this._IsTimelineInJson(i,e)||s.add(i);if(C3$jscomp$83.arrayRemoveAllInSet(t,s),e){s=e=>t=>t.GetName()===e;for(const i of e)(e=this.GetTimelineByName(i))&&(t.find(s(i))||t.push(e))}}};const C3$jscomp$84=self.C3;C3$jscomp$84.TimelineState=class extends C3$jscomp$84.DefendedBase{constructor(e,t,s){super(),this._runtime=s.GetRuntime(),this._timelineManager=s,this._timelineDataItem=t,this._name=e,this._tracks=[],this._tracksLength=0,this._beforeAndAfterTracks=null,this._beforeAndAfterTracksLength=0,this.CreateTrackStates(),this._playResolve=this._playPromise=null,this._playheadTime=0,this._playbackRate=1,this._pingPongState=0,this._currentRepeatCount=1,this._initialStateSet=this._isScheduled=this._isPlaying=!1,this._complete=!0,this._markedForRemoval=this._released=!1,this._completedTick=-1,this._firstTick=this._finishedTriggers=this._isTemplate=this._implicitPause=!1,this._lastDelta=NaN,this._tags=[""],this._stringTags="",this._tagsChanged=!1,this._hasNestedContent=this._renderChange=0,this._iTimelineState=null}static CreateInitial(e,t){var s=t.GetTimelineDataManager();const i=s.GetNameId();return s=s.Get(e[i]),(e=C3$jscomp$84.New(C3$jscomp$84.TimelineState,e[i],s,t)).SetIsTemplate(!0),e}static CreateFromTemplate(e,t,s){return C3$jscomp$84.New(C3$jscomp$84.TimelineState,e,t,s)}Release(){if(!this.IsReleased()){var e=this._runtime.Dispatcher();this._timelineManager.DeScheduleTimeline(this),this._timelineManager.CompleteTimelineAndResolve(this);for(const e of this._tracks)e.Release();C3$jscomp$84.clearArray(this._tracks),this._timelineDataItem=this._timelineManager=this._runtime=this._tracks=null,this._released=!0,this._playResolve=this._playPromise=null,this.FireReleaseEvent(e)}}FireReleaseEvent(e){const t=C3$jscomp$84.New(C3$jscomp$84.Event,"timelinestatereleased");t.timelineState=this,e.dispatchEvent(t)}GetType(){return 0}CreateTrackStates(){for(const e of this._timelineDataItem.GetTrackData().trackDataItems())this._tracksLength=this._tracks.push(C3$jscomp$84.TrackState.Create(this,e))}GetTimelineManager(){return this._timelineManager}GetRuntime(){return this._runtime}GetTracks(){return this._tracks}GetSimilarPropertyTracks(e,t,s){if(this._hasNestedContent){var i;for(let n=0;n<this._tracks.length;n++){var r=this._tracks[n];e===r.GetInstance()&&(r=r.GetPropertyTrack(s))&&t.constructor===r.GetSourceAdapter().constructor&&(i||(i=[]),i.push(r))}return i}}HasTracks(){return!!this._tracks.length}GetTrackById(e){for(const t of this._tracks)if(C3$jscomp$84.equalsNoCase(t.GetId(),e))return t;return null}GetTrackByName(e){for(const t of this._tracks)if(!t.IsInstanceTrack()&&C3$jscomp$84.equalsNoCase(t.GetName(),e))return t;return null}SetName(e){this._name=e}GetName(){return this._name}GetTimelineDataItem(){return this._timelineDataItem}GetTemplateName(){return this._timelineDataItem.GetName()}GetTotalTime(){return this._timelineDataItem.GetTotalTime()}SetTotalTime(e){this._timelineDataItem.SetTotalTime(e)}GetStep(){return this._timelineDataItem.GetStep()}SetStep(e){this._timelineDataItem.SetStep(e)}GetInterpolationMode(){return this._timelineDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._timelineDataItem.SetInterpolationMode(e)}GetResultMode(){return this._timelineDataItem.GetResultMode()}SetResultMode(e){this._timelineDataItem.GetResultMode(e)}SetEase(e){for(const t of this.GetTracks())t.SetEase(e)}GetLoop(){return this._timelineDataItem.GetLoop()}SetLoop(e){return this._timelineDataItem.SetLoop(e)}GetPingPong(){return this._timelineDataItem.GetPingPong()}SetPingPong(e){return this._timelineDataItem.SetPingPong(e)}GetRepeatCount(){return this._timelineDataItem.GetRepeatCount()}SetRepeatCount(e){return this._timelineDataItem.SetRepeatCount(e)}SetPlaybackRate(e){return this._playbackRate=e}GetPlaybackRate(){return this._playbackRate}GetStartOnLayout(){return this._timelineDataItem.GetStartOnLayout()}GetTransformWithSceneGraph(){return this._timelineDataItem.GetTransformWithSceneGraph()}GetUseSystemTimescale(){return this._timelineDataItem.GetUseSystemTimescale()}IsForwardPlayBack(){return!this.IsPlaying()||0<this._playbackRate}GetPlayPromise(){return this._playPromise?this._playPromise:this._playPromise=new Promise((e=>{this._playResolve=e}))}ResolvePlayPromise(){this._playPromise&&(this._playResolve(),this._playResolve=this._playPromise=null)}SetTags(e){this._tags=C3$jscomp$84.TimelineState._GetTagArray(e),this._tagsChanged=!0}GetTags(){return this._tags}GetStringTags(){return this._tagsChanged&&(this._stringTags=this._tags.join(" ")),this._tagsChanged=!1,this._stringTags}HasTags(e){return!(!this._tags||!this._tags.length)&&(!(!(e=C3$jscomp$84.TimelineState._GetTagArray(e))||!e.length)&&e.every(C3$jscomp$84.TimelineState._HasTag,this))}OnStarted(){C3$jscomp$84.Plugins.Timeline&&this.constructor===C3$jscomp$84.TimelineState&&(C3$jscomp$84.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnTimelineStarted),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnTimelineStartedByName),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnTimelineStartedByTags),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnAnyTimelineStarted),C3$jscomp$84.Plugins.Timeline.Cnds.PopTriggerTimeline())}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){this._finishedTriggers||(this._finishedTriggers=!0,C3$jscomp$84.Plugins.Timeline&&this.constructor===C3$jscomp$84.TimelineState&&(C3$jscomp$84.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnTimelineFinished),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnTimelineFinishedByName),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnTimelineFinishedByTags),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnAnyTimelineFinished),C3$jscomp$84.Plugins.Timeline.Cnds.PopTriggerTimeline()))}SetPlaying(e){this._isPlaying=e}IsCompletedTick(){return this._completedTick===this._runtime.GetTickCount()}IsPlaying(e=!1){return!!(this.IsCompletedTick()||this.IsScheduled()&&!e)||this._isPlaying}_IsPlaying(){return this.IsPlaying(!0)}IsPaused(){return this._IsPaused()}_IsPaused(){return!(this.IsReleased()||this.IsScheduled()||this._IsPlaying()||this.IsComplete())}SetScheduled(e){this._isScheduled=e}IsScheduled(){return this._isScheduled}SetComplete(e){this._complete=e,(0>=(e=this.GetTime())||e>=this.GetTotalTime())&&(this._complete=!0)}IsComplete(){return this._complete}IsReleased(){return this._released}SetMarkedForRemoval(e){this._markedForRemoval=e}IsMarkedForRemoval(){return this._markedForRemoval}SetImplicitPause(e){this._implicitPause=e}IsImplicitPause(){return this._implicitPause}SetIsTemplate(e){this._isTemplate=!!e}IsTemplate(){return this._isTemplate}InitialStateSet(){return this._initialStateSet}GetTime(){return this._playheadTime}SetTime(e){const t=this.GetTime();this._SetTime(e),this.SetComplete(!1),this.IsComplete()||this.SetImplicitPause(!0),(this._IsPlaying()||this.IsScheduled()||!this._initialStateSet)&&(this._IsPlaying()||this.IsScheduled()||this._initialStateSet?this._IsPlaying()?this.Stop():this.IsScheduled()&&(this._timelineManager.DeScheduleTimeline(this),this.SetInitialStateFromSetTime()):this.SetInitialStateFromSetTime()),this._SetUpdateStateBefore(),this._Interpolate(this.GetTime(),!1,!0,!0,t),this._SetUpdateStateAfter(),this._renderChange&&this.GetRuntime().UpdateRender(),this._OnSetTime()}_SetTime(e){C3$jscomp$84.IsFiniteNumber(e)||(e=this.GetTotalTime()),0>e?this._playheadTime=0:e>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=e}_SetTimeAndReset(e){C3$jscomp$84.IsFiniteNumber(e)||(e=this.GetTotalTime()),0>e?this._playheadTime=0:e>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=e;for(const e of this._tracks)e.SetResetState()}_OnSetTime(){C3$jscomp$84.Plugins.Timeline&&this.constructor===C3$jscomp$84.TimelineState&&(C3$jscomp$84.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnTimeSet),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnTimeSetByName),this._timelineManager.Trigger(C3$jscomp$84.Plugins.Timeline.Cnds.OnTimeSetByTags),C3$jscomp$84.Plugins.Timeline.Cnds.PopTriggerTimeline())}_CanResume(){if(!this.GetLoop())if(this.GetPingPong()&&1===this._pingPongState){if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(0>=this.GetTime())return!1}else if(!this.GetLoop()&&!this.GetPingPong())if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(0>=this.GetTime())return!1;return!0}Resume(){this.IsReleased()||this._CanResume()&&this.Play(!0)}Play(e=!1){return!this.IsReleased()&&!this.IsScheduled()&&(this._IsPlaying()&&this.IsCompletedTick()?this._SchedulePlayingTimeline():!(this._IsPlaying()||!(this.IsComplete()||e||this.IsImplicitPause()))&&this._ScheduleStoppedTimeline())}_SchedulePlayingTimeline(){return this.SetImplicitPause(!1),this._timelineManager.RemovePlayingTimeline(this),this._timelineManager.ScheduleTimeline(this),this.GetPlayPromise(),!0}_ScheduleStoppedTimeline(){return this.SetImplicitPause(!1),this._timelineManager.ScheduleTimeline(this),this.GetPlayPromise(),!0}Stop(e=!1){this.IsReleased()||(this.SetComplete(e),this._timelineManager.CompleteTimeline(this),this.IsComplete()&&this.ResolvePlayPromise())}Reset(e=!0,t=!1){if(!this.IsReleased()){if(!this._IsPlaying()&&this.IsScheduled())return this._timelineManager.DeScheduleTimeline(this);if(!this.IsComplete()){this.Stop(!0),this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime());var s=this.GetTime();this._SetUpdateStateBefore(),t?this._InterpolateBeforeChangeLayout(s):this._Interpolate(s,!1,!1,!0),e&&this._OnSetTime(),this._SetUpdateStateAfter(),this._renderChange&&e&&this.GetRuntime().UpdateRender()}}}ResetBeforeChangeLayout(){this.Reset(!1,!0)}_InterpolateBeforeChangeLayout(e){this._Interpolate(e,!1,!1,!0,NaN,!1,!0)}_OnBeforeChangeLayout(){return!!this.IsReleased()||!(!this.GetRuntime().IsLoadingState()&&this.HasValidGlobalTracks())&&(this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this),this.GetRuntime().IsLoadingState()||this.ResetBeforeChangeLayout(),!0)}SetInitialStateFromSetTime(){this.SetInitialState(!0)}SetInitialState(e){if(!this.IsMarkedForRemoval()){if(e){this._finishedTriggers=!1,this._firstTick=this._initialStateSet=!0,this._SetUpdateStateBefore();for(const e of this._tracks)e.SetInitialState()}else if(this.SetPlaying(!0),this.SetScheduled(!1),this.OnStarted(),this.IsComplete()){this._completedTick=-1,0!==this._pingPongState&&(this._playbackRate=Math.abs(this._playbackRate)),this._pingPongState=0,this._currentRepeatCount=1,this._finishedTriggers=this._complete=!1,this._firstTick=this._initialStateSet=!0,this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime()),this._SetUpdateStateBefore();for(const e of this._tracks)e.SetInitialState()}else{this._firstTick=!0,this._finishedTriggers=!1,this._SetUpdateStateBefore();for(const e of this._tracks)e.SetResumeState()}this._SetUpdateStateAfter()}}GetRenderChange(){return this._renderChange}_SetUpdateStateBefore(){this._hasNestedContent=0;for(const e of this._tracks)e.IsNested()&&(this._hasNestedContent=1)}_SetUpdateStateAfter(){this._renderChange=0;for(const e of this._tracks)e._SetUpdateState(),0===this._renderChange&&1===e.GetRenderChange()&&(this._renderChange=1),this._beforeAndAfterTracks||1!==e.GetNeedsBeforeAndAfter()||(this._beforeAndAfterTracks||(this._beforeAndAfterTracks=[]),this._beforeAndAfterTracksLength=this._beforeAndAfterTracks.push(e))}Tick(e,t,s){if(this.GetUseSystemTimescale()){if(0===e&&0===this._lastDelta)return;this._lastDelta=e}else{if(0===s&&0===this._lastDelta)return;e=this._lastDelta=s,t=1}t=(s=this._playheadTime)+e*t*this._playbackRate,e=this._timelineDataItem._totalTime,this._playheadTime=0>t?0:t>=e?e:t;var i=!1;t=!1;var r=this.GetLoop(),n=this.GetPingPong();if(r||n?r&&!n?0<this._playbackRate?this._playheadTime>=e&&(this._SetTimeAndReset(0),t=!0):0>=this._playheadTime&&(this._SetTimeAndReset(e),t=!0):!r&&n?0<this._playbackRate?this._playheadTime>=e&&(this._SetTime(e),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=0):i=!0:0===this._pingPongState&&(this._pingPongState=1)):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=0):i=!0:0===this._pingPongState&&(this._pingPongState=1)):r&&n&&(0<this._playbackRate?this._playheadTime>=e&&(this._SetTime(e),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState++,C3$jscomp$84.wrap(this._pingPongState,0,2)):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState++,C3$jscomp$84.wrap(this._pingPongState,0,2))):0<this._playbackRate?this._playheadTime>=e&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(0),t=!0):(this._SetTime(e),i=!0)):0>=this._playheadTime&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(e),t=!0):(this._SetTime(0),i=!0)),r=this._tracksLength,i){for(i=0;i<r;i++)this._tracks[i].SetEndState();this.Stop(!0),this.OnCompleted()}else{for(n=this._beforeAndAfterTracksLength,i=0;i<n;i++)this._beforeAndAfterTracks[i].BeforeInterpolate();if(1===this._hasNestedContent)for(i=0;i<r;i++){const r=this._tracks[i],n=r.GetStartOffset(),a=s-n;0>this._playheadTime-n&&0<a?(this._playheadTime=0>n?0:n>=e?e:n,r.Interpolate(n,!0,!1,t,this._firstTick,!1)):r.Interpolate(this._playheadTime,!0,!1,t,this._firstTick,!1)}else for(i=0;i<r;i++)this._tracks[i].Interpolate(this._playheadTime,!0,!1,t,this._firstTick,!1);for(i=0;i<n;i++)this._beforeAndAfterTracks[i].AfterInterpolate();this._firstTick&&(this._firstTick=!1)}}_Interpolate(e,t=!1,s=!1,i=!1,r=NaN,n=!1,a=!1){for(var o of this._tracks)o.BeforeInterpolate();for(const n of this._tracks){if(o=e,"number"==typeof r&&!isNaN(r)){const e=this.GetTime()-n.GetStartOffset(),t=r-n.GetStartOffset();0>e&&0<t&&(o=n.GetStartOffset(),this._SetTime(o))}n.Interpolate(o,t,s,i,this._firstTick,a)}for(const e of this._tracks)e.AfterInterpolate();this._firstTick&&n&&(this._firstTick=!1)}AddTrack(){var e=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem();return e=C3$jscomp$84.TrackState.Create(this,e),this._tracksLength=this._tracks.push(e),e}Removed(){if(!this.IsReleased())for(const e of this._tracks)e.TimelineRemoved()}CleanCaches(){for(const e of this._tracks)e.CleanCaches()}ClearTrackInstances(){for(const e of this._tracks)e.ClearInstance()}SetTrackInstance(e,t){if(t)for(const s of this._tracks)if(s.IsInstanceTrack()){if(e){if(s.GetId()!==e)continue}else if(s.HasInstance())continue;s.SetInstance(t),this._timelineManager.SetTimelineObjectClassToMap(t.GetObjectClass(),this);break}}HasTrackInstance(e,t){for(const s of this._tracks)if(s.IsInstanceTrack())if(t){if(t===s.GetId()&&e===s.GetInstance())return!0}else if(e===s.GetInstance())return!0;return!1}HasValidTracks(){return this._tracks.some((e=>!e.IsInstanceTrack()||e.CanInstanceBeValid()))}HasValidGlobalTracks(){return this._tracks.some((e=>!!e.IsInstanceTrack()&&(!!e.CanInstanceBeValid()&&(!!(e=e.GetObjectClass())&&e.IsGlobal()))))}GetPropertyTrack(e){for(const t of this.GetTracks())for(const s of t.GetPropertyTracks())if(s.GetPropertyName()===e)return s}GetTrackFromInstance(e){for(const t of this._tracks)if(e===t.GetInstance())return t;return null}GetKeyframeWithTags(e){e=e?e.split(" "):[],e=[...new Set(e.map((e=>e.toLowerCase().trim()))).values()];for(const t of this.GetTracks())for(const s of t.GetKeyframeDataItems())if(e.every((e=>s.HasTag(e))))return s}GetObjectClasses(){const e=[];for(const t of this.GetTracks())e.push(t.GetObjectClass());return e.filter((e=>e))}_SaveToJson(){return{tracksJson:this._SaveTracksToJson(),name:this._name,playheadTime:this.GetTime(),playbackRate:this._playbackRate,pingPongState:this._pingPongState,currentRepeatCount:this._currentRepeatCount,isPlaying:this._isPlaying,isScheduled:this._isScheduled,initialStateSet:this._initialStateSet,finishedTriggers:this._finishedTriggers,complete:this._complete,released:this._released,markedForRemoval:this._markedForRemoval,completedTick:this._completedTick,implicitPause:this._implicitPause,isTemplate:this._isTemplate,tags:this._tags.join(" "),stringTags:this._stringTags,tagsChanged:this._tagsChanged,firstTick:this._firstTick}}_LoadFromJson(e){e&&(this._LoadTracksFromJson(e.tracksJson),this._name=e.name,this._playheadTime=e.playheadTime,this._playbackRate=e.playbackRate,this._pingPongState=e.pingPongState,this._currentRepeatCount=e.currentRepeatCount,this._isPlaying=!!e.isPlaying,this._isScheduled=!!e.isScheduled,this._initialStateSet=!!e.initialStateSet,this._finishedTriggers=!!e.hasOwnProperty("finishedTriggers")&&!!e.finishedTriggers,this._complete=!!e.complete,this._released=!!e.released,this._markedForRemoval=!!e.markedForRemoval,this._completedTick=e.completedTick,this._implicitPause=!!e.implicitPause,this._isTemplate=!!e.isTemplate,this._tags=e.tags.split(" "),this._stringTags=e.stringTags,this._tagsChanged=!!e.tagsChanged,this._firstTick=!!e.firstTick)}_SaveTracksToJson(){return this._tracks.map((e=>e._SaveToJson()))}_LoadTracksFromJson(e){e.forEach(((e,t)=>{this._tracks[t]._LoadFromJson(e)})),this._tracks.filter((e=>e.CanInstanceBeValid()))}static _HasTag(e){const t=this.GetTags();return""===e?1===t.length&&""===t[0]:t.map((e=>e.toLowerCase())).includes(e.toLowerCase())}static _GetTagArray(e){if(C3$jscomp$84.IsArray(e))return e.slice(0);if(C3$jscomp$84.IsString(e))return e.split(" ");throw Error("invalid tags")}GetITimelineState(){return this._iTimelineState||(this._iTimelineState=C3$jscomp$84.New(self.ITimelineState,this)),this._iTimelineState}};const C3$jscomp$85=self.C3;C3$jscomp$85.TrackState=class extends C3$jscomp$85.DefendedBase{constructor(e,t){super(),this._timeline=e,this._trackDataItem=t,this._trackData=t.GetTrackData(),this._objectClassIndex=this._instanceUid=NaN,this._worldInfo=this._instance=null,this._isNested=0<t.GetStartOffset(),this._endStateOfNestedSet=this._initialStateOfNestedSet=!1,this._lastKeyframeDataItem=null,this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray(),this._propertyTracks=[],this.CreatePropertyTrackStates(),this._needsBeforeAndAfter=this._renderChange=this._worldInfoChange=0}static Create(e,t){return C3$jscomp$85.New(C3$jscomp$85.TrackState,e,t)}Release(){this._keyframeDataItems=null;for(const e of this._propertyTracks)e.Release();C3$jscomp$85.clearArray(this._propertyTracks),this._lastKeyframeDataItem=this._trackDataItem=this._worldInfo=this._instance=this._timeline=this._propertyTracks=null}CreatePropertyTrackStates(){for(const e of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(C3$jscomp$85.PropertyTrackState.Create(this,e))}TimelineRemoved(){for(const e of this._propertyTracks)e.TimelineRemoved()}CleanCaches(){for(const e of this._propertyTracks)e.CleanCaches();this._worldInfo=this._instance=null}GetTimeline(){return this._timeline}GetRuntime(){return this._timeline.GetRuntime()}GetKeyframeDataItems(){return this._keyframeDataItems?this._keyframeDataItems:this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray()}GetPropertyTracks(){return this._propertyTracks}GetPropertyTrack(e){for(let t=0;t<this._propertyTracks.length;t++){const s=this._propertyTracks[t];if(s.GetPropertyName()===e)return s}}MaybeGetInstance(){this._instance||this.GetInstance()}IsInstanceValid(){return!!this._instance&&!this._instance.IsDestroyed()}CanInstanceBeValid(){if(!this.IsInstanceTrack())return!1;var e=this.GetInstanceUID();return!!(e=this.GetRuntime().GetInstanceByUID(e))&&!e.IsDestroyed()}GetObjectClass(){if(this.IsInstanceTrack()){var e=this.GetObjectClassIndex();if(-1!==e)return this.GetRuntime().GetObjectClassByIndex(e)}}ClearInstance(){this._instance=null,this._instanceUid=-1,this._worldInfo=null,this._objectClassIndex=-1}HasInstance(){return!!this._instance}GetInstance(){if(this._instance&&this.IsInstanceValid())return this._instance;const e=this.GetInstanceUID();return this._instance=this.GetRuntime().GetInstanceByUID(e)}SetInstance(e){if(this._instance!==e){this.CleanCaches(),this._instance=e,this._objectClassIndex=e.GetObjectClass().GetIndex(),this._instanceUid=e.GetUID(),this._worldInfo=e.GetWorldInfo();for(const n of this.propertyTrackItems()){const a=n.sourceAdapter;switch(n.propertyTrack.GetSourceAdapterId()){case"instance-variable":a.GetEditorIndex();var t=e.GetObjectClass(),s=t.GetInstanceVariableIndexByName(n.name),i=t.GetInstanceVariableName(s);t=t.GetInstanceVariableType(s),i===n.name&&t===n.type&&a.UpdateInstanceVariableIndex(s);break;case"behavior":var r=n.behaviorType;s=this.GetObjectClass(),i=e.GetObjectClass(),t=a.GetBehaviorType(i),r&&t&&(r=r.GetName(),s.GetBehaviorIndexByName(r),i.GetBehaviorIndexByName(r),a.GetEditorIndex(),a.UpdateBehaviorTypeSid(t.GetSID()))}}}}*propertyTrackItems(){for(const s of this._propertyTracks){var e=s.GetSourceAdapter(),t=this.GetObjectClass();const i={propertyTrack:s,sourceAdapter:e};switch(s.GetSourceAdapterId()){case"world-instance":i.property=s.GetPropertyName();break;case"instance-variable":e=e.GetEditorIndex(),i.name=t.GetInstanceVariableName(e),i.type=t.GetInstanceVariableType(e);break;case"effect":t=t.GetEffectList(),e=e.GetEffectType(t),i.effectType=e;break;case"behavior":e=e.GetBehaviorType(t),i.behaviorType=e;break;case"plugin":i.plugin=t.GetPlugin()}yield i}}GetWorldInfo(){if(this._worldInfo&&this.IsInstanceValid())return this._worldInfo;const e=this.GetInstance();return e&&(this._worldInfo=e.GetWorldInfo()),this._worldInfo}GetTrackDataItem(){return this._trackDataItem}GetInstanceUID(){return this._instanceUid?this._instanceUid:this._trackDataItem.GetInstanceUID()}SetInstanceUID(e){this._trackDataItem.SetInstanceUID(e)}GetInterpolationMode(){return this._trackDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._trackDataItem.SetInterpolationMode(e)}GetResultMode(){return this._trackDataItem.GetResultMode()}GetId(){return this._trackDataItem.GetId()}GetStartOffset(){return this._trackDataItem.GetStartOffset()}GetLocalTotalTime(){return this._trackDataItem.GetLocalTotalTime()}SetLocalTotalTime(e){this._trackDataItem.SetLocalTotalTime(e)}SetResultMode(e){this._trackDataItem.SetResultMode(e)}SetEase(e){for(const t of this.GetKeyframeDataItems())t.SetEase(e);for(const t of this.GetPropertyTracks())t.SetEase(e)}GetEnable(){return this._trackDataItem.GetEnable()}SetEnable(e){this._trackDataItem.SetEnable(e)}GetObjectClassIndex(){return isNaN(this._objectClassIndex)?this._trackDataItem.GetObjectClassIndex():this._objectClassIndex}SetObjectClassIndex(e){this._trackDataItem.SetObjectClassIndex(e)}SetOriginalWidth(e){this._trackDataItem.SetOriginalWidth(e)}GetOriginalWidth(){const e=this.GetInstance();return e&&e.GetSdkInstance().IsOriginalSizeKnown()?e.GetSdkInstance().GetOriginalWidth():this._trackDataItem.GetOriginalWidth()}SetOriginalHeight(e){this._trackDataItem.SetOriginalHeight(e)}GetOriginalHeight(){const e=this.GetInstance();return e&&e.GetSdkInstance().IsOriginalSizeKnown()?e.GetSdkInstance().GetOriginalHeight():this._trackDataItem.GetOriginalHeight()}GetType(){return this._trackDataItem.GetType()}GetName(){return this._trackDataItem.GetName()}IsInstanceTrack(){return 0===this.GetType()}IsValueTrack(){return 1===this.GetType()}IsAudioTrack(){return 2===this.GetType()}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}IsNested(){return this._isNested}SetResetState(){for(const e of this._propertyTracks)e.SetResetState()}SetInitialState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){var e=this.GetTimeline().IsForwardPlayBack()?0:this.GetLocalTotalTime();for(const t of this._propertyTracks)t.SetInitialState(e),0===this._worldInfoChange&&1===t.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===t.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0,this._propertyTracks.some((e=>e.GetNeedsBeforeAndAfter()))&&(this._needsBeforeAndAfter=1),this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(e),this._endStateOfNestedSet=this._initialStateOfNestedSet=!1,this.Interpolate(e),this.OnKeyframeReached(this._GetLastKeyFrameBeforeTime(e))}}SetResumeState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){this._timeline.IsForwardPlayBack();var e=this._timeline.GetTime()-this.GetStartOffset();this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(e);for(const t of this._propertyTracks)t.SetResumeState(e)}}SetEndState(){if(!(this.GetTimeline().IsComplete()||(this.MaybeGetInstance(),!this.IsInstanceValid()&&this.IsInstanceTrack()||this._isNested))){const e=this._timeline.GetTime();e>=this.GetStartOffset()+this.GetLocalTotalTime()?this.Interpolate(this.GetLocalTotalTime(),!0,!1,!0,!1,!1,!0):0>=e&&this.Interpolate(0,!0,!1,!0,!1,!1,!0)}}_SetUpdateState(){for(let e=0,t=this._propertyTracks.length;e<t;e++){const t=this._propertyTracks[e];t._SetUpdateState(),0===this._worldInfoChange&&1===t.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===t.GetRenderChange()&&(this._renderChange=1)}}BeforeInterpolate(){const e=this._propertyTracks.length;for(let t=0;t<e;t++)this._propertyTracks[t].BeforeInterpolate()}Interpolate(e,t=!1,s=!1,i=!1,r=!1,n=!1,a=!1){this._instance||this.GetInstance();const o=this._instance&&!this._instance.IsDestroyed(),h=0===this._trackDataItem._type;if(!(!o&&h||n&&h&&this.GetObjectClass().IsGlobal()||(e-=this.GetStartOffset(),0>e))){this.MaybeSetInitialStateOfNestedTrack(e,t),this.MaybeTriggerKeyframeReachedConditions(e,t,r);for(let t=0,r=this._propertyTracks.length;t<r;t++)this._propertyTracks[t].Interpolate(e,s,i,a);this.MaybeSetEndStateOfNestedTrack(e,t),0!==this._worldInfoChange&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo&&this._worldInfo.SetBboxChanged())}}AfterInterpolate(){const e=this._propertyTracks.length;for(let t=0;t<e;t++)this._propertyTracks[t].AfterInterpolate()}MaybeSetInitialStateOfNestedTrack(e,t){if(t&&this._isNested&&!this._initialStateOfNestedSet){if(this.GetTimeline().IsForwardPlayBack()){if(0>e)return;for(const e of this._propertyTracks)e.Interpolate(0,!1,!0)}else{if(e>this.GetLocalTotalTime())return;for(const e of this._propertyTracks)e.Interpolate(this.GetLocalTotalTime(),!1,!0)}for(const e of this._propertyTracks)e.SetInitialState();this._initialStateOfNestedSet=!0}}MaybeSetEndStateOfNestedTrack(e,t){if(t&&this._isNested&&!this._endStateOfNestedSet)if(this.GetTimeline().IsForwardPlayBack()){if(e>=this.GetLocalTotalTime()){for(const e of this._propertyTracks)e.Interpolate(this.GetLocalTotalTime(),!1,!0);this._endStateOfNestedSet=!0}}else if(0>=e){for(const e of this._propertyTracks)e.Interpolate(0,!1,!0);this._endStateOfNestedSet=!0}}MaybeTriggerKeyframeReachedConditions(e,t,s){if(!s&&t&&C3$jscomp$85.Plugins.Timeline){t=this.GetTimeline(),s=this._lastKeyframeDataItem.GetNext();var i=this._lastKeyframeDataItem.GetTime(),r=s?s.GetTime():t.GetTotalTime();(e<=i||e>=r)&&(this._lastKeyframeDataItem=this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(e,this._trackDataItem),t.IsForwardPlayBack()?s&&this.OnKeyframeReached(this._lastKeyframeDataItem):(e=this._lastKeyframeDataItem.GetNext())&&this.OnKeyframeReached(e))}}_GetLastKeyFrameBeforeTime(e){const t=this._trackData.GetKeyFrameDataItemAtTime(e,this._trackDataItem);return t||this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(e,this._trackDataItem)}OnKeyframeReached(e){const t=this.GetTimeline(),s=t.GetTimelineManager();C3$jscomp$85.Plugins.Timeline.Cnds.PushTriggerTimeline(t),C3$jscomp$85.Plugins.Timeline.Cnds.PushTriggerKeyframe(e),s.Trigger(C3$jscomp$85.Plugins.Timeline.Cnds.OnAnyKeyframeReached),s.Trigger(C3$jscomp$85.Plugins.Timeline.Cnds.OnKeyframeReached),C3$jscomp$85.Plugins.Timeline.Cnds.PopTriggerTimeline(t),C3$jscomp$85.Plugins.Timeline.Cnds.PopTriggerKeyframe(e)}AddKeyframe(){return this._trackDataItem.GetKeyframeData().AddEmptyKeyframeDataItem()}AddPropertyTrack(){var e=this._trackDataItem.GetPropertyTrackData().AddEmptyPropertyTrackDataItem();return e=C3$jscomp$85.PropertyTrackState.Create(this,e),this._propertyTracks.push(e),e}DeleteKeyframes(e){this._trackDataItem.GetKeyframeData().DeleteKeyframeDataItems(e)}DeletePropertyKeyframes(e){for(const t of this._propertyTracks)t.DeletePropertyKeyframes(e)}SaveState(){for(const e of this._propertyTracks)e.SaveState()}CompareInitialStateWithCurrent(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack())for(const e of this._propertyTracks)e.CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){var e=!1;for(const t of this._propertyTracks){const s=t.CompareSaveStateWithCurrent();!e&&s&&(e=!0)}e&&((e=this.AddKeyframe()).SetTime(this.GetTimeline().GetTime()),e.SetEase("noease"),e.SetEnable(!0),e.SetTags(""))}}_SaveToJson(){var e=this.GetInstance();return e=e?e.GetUID():this.GetInstanceUID(),{propertyTracksJson:this._SavePropertyTracksToJson(),lastKeyframeDataItemJson:this._SaveLastKeyframeDataItemToJson(),initialStateOfNestedSet:this._initialStateOfNestedSet,endStateOfNestedSet:this._endStateOfNestedSet,instanceUid:e}}_LoadFromJson(e){if(e){this._LoadPropertyTracksFromJson(e.propertyTracksJson),this._LoadLastKeyframeDataItemFromJson(e.lastKeyframeDataItemJson),this._LoadInstanceFromJson(e.instanceUid),this._initialStateOfNestedSet=!1,e.hasOwnProperty.initialStateOfNestedSet&&(this._initialStateOfNestedSet=e.initialStateOfNestedSet),this._endStateOfNestedSet=!1,e.hasOwnProperty.endStateOfNestedSet&&(this._endStateOfNestedSet=e.endStateOfNestedSet);for(const e of this._propertyTracks)0===this._worldInfoChange&&1===e.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===e.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0,this._propertyTracks.some((e=>e.GetNeedsBeforeAndAfter()))&&(this._needsBeforeAndAfter=1)}}_SaveLastKeyframeDataItemToJson(){return this._trackDataItem.GetKeyframeData().GetKeyframeDataItemIndex(this._lastKeyframeDataItem)}_SavePropertyTracksToJson(){return this._propertyTracks.map((e=>e._SaveToJson()))}_LoadPropertyTracksFromJson(e){e.forEach(((e,t)=>{this._propertyTracks[t]._LoadFromJson(e)}))}_LoadInstanceFromJson(e){if(C3$jscomp$85.IsFiniteNumber(e)&&(e=this.GetRuntime().GetInstanceByUID(e))){var t=this.GetTimeline();t.ClearTrackInstances(),t.SetTrackInstance(this._trackDataItem.GetId(),e)}}_LoadLastKeyframeDataItemFromJson(e){this._lastKeyframeDataItem=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemFromIndex(e)}};const C3$jscomp$86=self.C3;C3$jscomp$86.PropertyTrackState=class extends C3$jscomp$86.DefendedBase{constructor(e,t){super(),this._track=e,this._propertyTrackDataItem=t,this._propertyTrackData=t.GetPropertyTrackData(),this._needsBeforeAndAfter=this._renderChange=this._worldInfoChange=0,this._sourceAdapter=this.GetSourceAdapter(),this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),this._absoluteValueObject=this._lastPropertyKeyframeDataItem=null}static Create(e,t){return C3$jscomp$86.New(C3$jscomp$86.PropertyTrackState,e,t)}Release(){this._track=null,this._sourceAdapter&&(this._sourceAdapter.Release(),this._sourceAdapter=null),this._propertyTrackData=this._propertyTrackDataItem=this._propertyKeyframeDataItems=null}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}HasAbsoluteValueObject(){return!!this._absoluteValueObject}SetAbsoluteValueObject(e){this._absoluteValueObject=e}GetAbsoluteValueObject(){return this._absoluteValueObject}GetTrack(){return this._track}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyTrackData(){return this._propertyTrackData}GetTimeline(){return this._track.GetTimeline()}GetRuntime(){return this._track.GetRuntime()}GetInstance(){return this._track.GetInstance()}GetSourceAdapter(){if(this._sourceAdapter)return this._sourceAdapter;let e;switch(this._propertyTrackDataItem.GetSourceAdapterId()){case"behavior":e=new C3$jscomp$86.PropertyTrackState.BehaviorSourceAdapter(this);break;case"effect":e=new C3$jscomp$86.PropertyTrackState.EffectSourceAdapter(this),this._renderChange=1;break;case"instance-variable":e=new C3$jscomp$86.PropertyTrackState.InstanceVariableSourceAdapter(this);break;case"plugin":e=new C3$jscomp$86.PropertyTrackState.PluginSourceAdapter(this),this._renderChange=1;break;case"world-instance":e=new C3$jscomp$86.PropertyTrackState.PropertySourceAdapter(this),this._worldInfoChange=this._renderChange=1;break;case"value":e=new C3$jscomp$86.PropertyTrackState.ValueSourceAdapter(this);break;case"audio":e=new C3$jscomp$86.PropertyTrackState.AudioSourceAdapter(this)}return this._sourceAdapter=e}GetSourceAdapterId(){return this._propertyTrackDataItem.GetSourceAdapterId()}SetSourceAdapterId(e){this._propertyTrackDataItem.SetSourceAdapterId(e)}GetSourceAdapterArgs(){return this._propertyTrackDataItem.GetSourceAdapterArguments()}SetSourceAdapterArgs(e){this._propertyTrackDataItem.SetSourceAdapterArguments(e)}GetSourceAdapterValue(){return this.GetSourceAdapter().GetValue()}GetPropertyName(){return this._propertyTrackDataItem.GetProperty()}SetPropertyName(e){this._propertyTrackDataItem.SetProperty(e)}GetPropertyType(){return this._propertyTrackDataItem.GetType()}SetPropertyType(e){this._propertyTrackDataItem.SetType(e)}GetPropertyKeyframeType(){return this.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem).GetType()}GetMin(){return this._propertyTrackDataItem.GetMin()}SetMin(e){this._propertyTrackDataItem.SetMin(e)}GetMax(){return this._propertyTrackDataItem.GetMax()}SetMax(e){this._propertyTrackDataItem.SetMax(e)}GetEnable(){return this._propertyTrackDataItem.GetEnable()}SetEnable(e){this._propertyTrackDataItem.SetEnable(e)}GetInterpolationMode(){return this._propertyTrackDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._propertyTrackDataItem.SetInterpolationMode(e)}GetResultMode(){return this._propertyTrackDataItem.GetResultMode()}SetResultMode(e){this._propertyTrackDataItem.SetResultMode(e)}SetEase(e){for(const t of this.GetPropertyKeyframeDataItems())t.SetEase(e)}CanHavePropertyKeyframes(){return this._propertyTrackDataItem.CanHavePropertyKeyframes()}GetPropertyKeyframeDataItems(){return this._propertyKeyframeDataItems?this._propertyKeyframeDataItems:this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()}GetPropertyKeyFrameDataItemAtTime(e){return this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem)}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e){return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem)}GetPropertyKeyframeDataItemPairForTime(e){let t=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem);return t?e=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherThan(e,this._propertyTrackDataItem):(t=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem),e=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,this._propertyTrackDataItem)),{start:t,end:e}}*GetPropertyKeyframeValues(){for(const e of this.GetPropertyKeyframeDataItems())yield e.GetValueWithResultMode()}*GetPropertyKeyframeTimes(){for(const e of this.GetPropertyKeyframeDataItems())yield e.GetTime()}TimelineRemoved(){this.GetSourceAdapter().TimelineRemoved()}CleanCaches(){this.GetSourceAdapter().CleanCaches()}GetCurrentState(){return this.GetSourceAdapter().GetCurrentState()}SetResetState(){this.GetSourceAdapter().SetResetState()}SetInitialState(e){this.GetSourceAdapter().SetInitialState(),this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(e),this._SetUpdateState()}SetResumeState(e){this.GetSourceAdapter().SetResumeState(),this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(e)}_SetUpdateState(){var e=this.GetTrack();if(this._needsBeforeAndAfter=0,e.IsInstanceTrack()){var t=this.GetTimeline();e=e.GetInstance();const s=this.GetSourceAdapter(),i=this.GetPropertyName();s.MayNeedBeforeAndAfterInterpolate()?(t=t.GetSimilarPropertyTracks(e,s,i))&&t.length&&(this._needsBeforeAndAfter=1):this._needsBeforeAndAfter=0}}_GetLastPropertyKeyFrameBeforeTime(e){const t=this.GetTimeline(),s=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem);return s||(t.IsForwardPlayBack()?this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem):this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,this._propertyTrackDataItem))}BeforeInterpolate(){this._sourceAdapter.BeforeInterpolate()}Interpolate(e,t=!1,s=!1,i=!1){let r;if(t)var n=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){var a=this.GetTimeline();const t=this._lastPropertyKeyframeDataItem.GetNext();n=this._lastPropertyKeyframeDataItem.GetTime(),a=t?t.GetTime():a.GetTotalTime(),(e<=n||e>=a)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);n=this._lastPropertyKeyframeDataItem}n&&(r=n.GetNext()),this._sourceAdapter.Interpolate(e,n,r,t,s,i)}GetInterpolatedValue(e){if(this._lastPropertyKeyframeDataItem){var t=this.GetTimeline();const i=this._lastPropertyKeyframeDataItem.GetNext();var s=this._lastPropertyKeyframeDataItem.GetTime();t=i?i.GetTime():t.GetTotalTime(),(e<=s||e>=t)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);return t=(s=this._lastPropertyKeyframeDataItem).GetNext(),this._sourceAdapter.GetInterpolatedValue(e,s,t)}GetInterpolatedValueFast(e,t,s){return this._sourceAdapter.GetInterpolatedValue(e,t,s)}AfterInterpolate(){this._sourceAdapter.AfterInterpolate()}static GetStartPropertyKeyframeForTime(e,t){const s=t.GetPropertyTrackDataItem();return t._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,s)}static GetEndPropertyKeyframeForTime(e,t){const s=t.GetPropertyTrackDataItem();return t._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,s)}AddPropertyKeyframe(){const e=this._propertyTrackDataItem.GetPropertyKeyframeData().AddEmptyPropertyKeyframeDataItem();return this._lastPropertyKeyframeDataItem=null,e}DeletePropertyKeyframes(e){this._lastPropertyKeyframeDataItem=null,this._propertyTrackDataItem.GetPropertyKeyframeData().DeletePropertyKeyframeDataItems(e)}SaveState(){this.GetSourceAdapter().SaveState()}CompareInitialStateWithCurrent(){if(this.GetSourceAdapter().CompareInitialStateWithCurrent()){const e=this._propertyTrackData.GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem),t=this.GetSourceAdapter().GetCurrentState();e.SetAbsoluteValue(t)}}CompareSaveStateWithCurrent(){const e=this.GetSourceAdapter().CompareSaveStateWithCurrent();return e&&this.AddPropertyKeyframeAtCurrentTime(),this.GetSourceAdapter().ClearSaveState(),e}AddPropertyKeyframeAtCurrentTime(){const e=this.GetTimeline().GetTime(),t=this.GetSourceAdapter(),s=C3$jscomp$86.PropertyTrackState.GetStartPropertyKeyframeForTime(e,this),i=this.AddPropertyKeyframe();i.SetType(s.GetType()),i.SetTime(e),i.SetEase(s.GetEase()),i.SetEnable(!0),i.SetValue(t.GetValueAtTime()),i.SetAbsoluteValue(t.GetCurrentState())}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson()}}_LoadFromJson(e){e&&this.GetSourceAdapter()._LoadFromJson(e.sourceAdapterJson)}};const NS=self.C3.PropertyTrackState;NS.PropertySourceAdapter=class{constructor(e){this._propertyTrack=e,this._propertyAdapter=null,this.GetPropertyAdapter()}Release(){this._propertyAdapter&&(this._propertyAdapter.Release(),this._propertyAdapter=null),this._propertyTrack=null}MayNeedBeforeAndAfterInterpolate(){return this._propertyAdapter.MayNeedBeforeAndAfterInterpolate()}GetPropertyTrack(){return this._propertyTrack}TimelineRemoved(){this._propertyAdapter&&this._propertyAdapter.TimelineRemoved()}CleanCaches(){this._propertyAdapter&&this._propertyAdapter.CleanCaches()}GetPropertyAdapter(){return this._propertyAdapter?this._propertyAdapter:this._propertyAdapter=this._CreatePropertyAdapter()}GetEditorIndex(){}GetIndex(){return this.GetEditorIndex()}GetTarget(){}SetResetState(){this.GetPropertyAdapter().SetResetState()}SetInitialState(){this.GetPropertyAdapter().SetInitialState()}SetResumeState(){this.GetPropertyAdapter().SetResumeState()}BeforeInterpolate(){this._propertyAdapter.BeforeChangeProperty()}Interpolate(e,t,s,i,r,n){let a;switch(this._propertyTrack.GetPropertyKeyframeType()){case"numeric":a=NS.NumericTypeAdapter.Interpolate(e,t,s,this._propertyTrack);break;case"angle":a=NS.AngleTypeAdapter.Interpolate(e,t,s,this._propertyTrack);break;case"boolean":a=NS.BooleanTypeAdapter.Interpolate(e,t,s,this._propertyTrack);break;case"color":a=NS.ColorTypeAdapter.Interpolate(e,t,s,this._propertyTrack);break;case"text":a=NS.TextTypeAdapter.Interpolate(e,t,s,this._propertyTrack)}this._propertyAdapter.ChangeProperty(e,a,t,s,i,r,n)}GetInterpolatedValue(e,t,s){switch(this._propertyTrack.GetPropertyKeyframeType()){case"numeric":return NS.NumericTypeAdapter.Interpolate(e,t,s,this._propertyTrack);case"angle":return NS.AngleTypeAdapter.Interpolate(e,t,s,this._propertyTrack);case"boolean":return NS.BooleanTypeAdapter.Interpolate(e,t,s,this._propertyTrack);case"color":return NS.ColorTypeAdapter.Interpolate(e,t,s,this._propertyTrack);case"text":return NS.TextTypeAdapter.Interpolate(e,t,s,this._propertyTrack)}}AfterInterpolate(){this._propertyAdapter.AfterChangeProperty()}SaveState(){this.GetPropertyAdapter().SetSaveState()}ClearSaveState(){this.GetPropertyAdapter().ClearSaveState()}GetCurrentState(){return this.GetPropertyAdapter().GetCurrentState()}CompareInitialStateWithCurrent(){return this.GetPropertyAdapter().CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){return this.GetPropertyAdapter().CompareSaveStateWithCurrent()}GetValueAtTime(){const e=this._propertyTrack,t=e.GetTrack().GetTimeline().GetTime(),s=NS.GetStartPropertyKeyframeForTime(t,e),i=s.GetNext();switch(e.GetPropertyKeyframeType()){case"numeric":return NS.NumericTypeAdapter.Interpolate(t,s,i,e);case"angle":return NS.AngleTypeAdapter.Interpolate(t,s,i,e);case"boolean":return NS.BooleanTypeAdapter.Interpolate(t,s,i,e);case"color":return NS.ColorTypeAdapter.Interpolate(t,s,i,e);case"text":return NS.TextTypeAdapter.Interpolate(t,s,i,e)}}_CreatePropertyAdapter(){const e=this._propertyTrack;switch(e.CanHavePropertyKeyframes()?e.GetPropertyKeyframeType():""){case"combo":case"boolean":case"text":case"string":return new NS.PropertyInterpolationAdapter.NoInterpolationAdapter(this);case"numeric":case"number":case"angle":return"combo"===this._propertyTrack.GetPropertyType()?new NS.PropertyInterpolationAdapter.NoInterpolationAdapter(this):new NS.PropertyInterpolationAdapter.NumericInterpolationAdapter(this);case"color":case"offsetColor":return new NS.PropertyInterpolationAdapter.ColorInterpolationAdapter(this);default:return new NS.PropertyInterpolationAdapter.NumericInterpolationAdapter(this)}}_SaveToJson(){return{propertyAdapterJson:this.GetPropertyAdapter()._SaveToJson()}}_LoadFromJson(e){e&&this.GetPropertyAdapter()._LoadFromJson(e.propertyAdapterJson)}};const C3$jscomp$88=self.C3,INDEX=0;class InstanceVariableSourceAdapter extends C3$jscomp$88.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._updatedIndex=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetIndex(){return this._updatedIndex?this._updatedIndex:super.GetIndex()}GetTarget(){return this._propertyTrack.GetTrack().GetInstance()}UpdateInstanceVariableIndex(e){this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]!==e&&(this._updatedIndex=e)}Interpolate(e,t,s,i,r){this.GetPropertyAdapter().CanChange(t.GetValue())&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){if(this.GetPropertyAdapter().CanChange(t.GetValue()))return super.GetInterpolatedValue(e,t,s)}_SaveToJson(){return Object.assign(super._SaveToJson(),{index:this._updatedIndex})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._updatedIndex=e.index)}}C3$jscomp$88.PropertyTrackState.InstanceVariableSourceAdapter=InstanceVariableSourceAdapter;const C3$jscomp$89=self.C3;class BehaviorSourceAdapter extends C3$jscomp$89.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._sid=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[1]}GetTarget(){var e=this._propertyTrack.GetPropertyTrackDataItem(),t=this._propertyTrack.GetTrack();return e=this._sid?this._sid:e.GetSourceAdapterArguments()[0],e=(t=t.GetInstance()).GetBehaviorIndexBySID(e),t.GetBehaviorInstances()[e].GetSdkInstance()}GetBehaviorType(e){const t=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[2];return e.GetBehaviorTypeByName(t)}UpdateBehaviorTypeSid(e){this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0]!==e&&(this._sid=e)}Interpolate(e,t,s,i,r){const n=this._propertyTrack.GetTrack().GetInstance();this.GetBehaviorType(n.GetObjectClass())&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){const i=this._propertyTrack.GetTrack().GetInstance();if(this.GetBehaviorType(i.GetObjectClass()))return super.GetInterpolatedValue(e,t,s)}_SaveToJson(){return Object.assign(super._SaveToJson(),{sid:this._sid})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._sid=e.sid)}}C3$jscomp$89.PropertyTrackState.BehaviorSourceAdapter=BehaviorSourceAdapter;const C3$jscomp$90=self.C3;class EffectSourceAdapter extends C3$jscomp$90.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[1]}GetTarget(){const e=this._propertyTrack.GetTrack().GetWorldInfo().GetInstanceEffectList();var t=e.GetEffectList();return t=this.GetEffectType(t).GetIndex(),e.IsEffectIndexActive(t)?e.GetEffectParametersForIndex(t):null}GetEffectType(e){const t=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0];return e.GetEffectTypeByName(t)}Interpolate(e,t,s,i,r){this._IsEffectActive()&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){if(this._IsEffectActive())return super.GetInterpolatedValue(e,t,s)}_IsEffectActive(){const e=this._propertyTrack.GetTrack().GetWorldInfo().GetInstanceEffectList();var t=e.GetEffectList();if(t=this.GetEffectType(t))return t=t.GetIndex(),e.IsEffectIndexActive(t)}}C3$jscomp$90.PropertyTrackState.EffectSourceAdapter=EffectSourceAdapter;const C3$jscomp$91=self.C3;class PluginSourceAdapter extends C3$jscomp$91.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0]}GetTarget(){return this._propertyTrack.GetTrack().GetInstance().GetSdkInstance()}Interpolate(e,t,s,i,r){var n=this._propertyTrack.GetTrack();n.GetObjectClass().GetPlugin()===(n=n.GetInstance().GetObjectClass().GetPlugin())&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){var i=this._propertyTrack.GetTrack();if(i.GetObjectClass().GetPlugin()===(i=i.GetInstance().GetObjectClass().GetPlugin()))return super.GetInterpolatedValue(e,t,s)}}C3$jscomp$91.PropertyTrackState.PluginSourceAdapter=PluginSourceAdapter;const C3$jscomp$92=self.C3;class ValueSourceAdapter extends C3$jscomp$92.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._value=0,this._init=!1}MayNeedBeforeAndAfterInterpolate(){return!1}SetInitialState(){const e=this._propertyTrack.GetPropertyTrackData();let t=this._propertyTrack.GetPropertyTrackDataItem();t=e.GetFirstPropertyKeyframeDataItem(t),this._value=t.GetValueWithResultMode()}SetResumeState(){}GetValue(){return this._init||this._propertyTrack.Interpolate(0),this._value}Interpolate(e,t,s,i,r){this._value=C3$jscomp$92.PropertyTrackState.NumericTypeAdapter.Interpolate(e,t,s,this._propertyTrack),this._init=!0}SaveState(){}ClearSaveState(){}GetCurrentState(){return this._value}CompareInitialStateWithCurrent(){return!1}CompareSaveStateWithCurrent(){return!1}_SaveToJson(){return{value:this._value,init:this._init}}_LoadFromJson(e){e&&(this._value=e.value,this._init=!e.hasOwnProperty("init")||e.init)}}C3$jscomp$92.PropertyTrackState.ValueSourceAdapter=ValueSourceAdapter;const C3$jscomp$93=self.C3;class AudioSourceAdapter extends C3$jscomp$93.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._audioPlaybackStarted=!1,this._expressions=this._actions=this._sdkInstance=null,this._timeline=this._propertyTrack.GetTimeline(),this._track=this._propertyTrack.GetTrack(),this._sourceAdapterArgs=this._propertyTrack.GetSourceAdapterArgs(),this._fileArgs=this._sourceAdapterArgs[0],this._startOffsetTime=this._sourceAdapterArgs[1],this._audioTag=this._sourceAdapterArgs[3]?this._sourceAdapterArgs[3]:Math.random().toString(36).slice(2),this._volume=this._pauseVolume=this._pauseTime=NaN,this._audioSource=null,this._Initialize()}Release(){super.Release(),this._audioSource=this._fileArgs=this._sourceAdapterArgs=this._track=this._timeline=this._expressions=this._actions=this._sdkInstance=null}_Initialize(){if(self.C3.Plugins.Audio){var e=this._propertyTrack.GetRuntime().GetObjectClassByName("audio");e&&(this._sdkInstance=e.GetSingleGlobalInstance().GetSdkInstance()),this._actions=self.C3.Plugins.Audio.Acts,this._expressions=self.C3.Plugins.Audio.Exps}}_MaybeSetAudioSource(){if(!this._audioSource){var e=this._propertyTrack.GetTrack().GetPropertyTrack("audioSource");e&&(this._audioSource=e.GetSourceAdapter())}}_GetPauseVolume(){const e=this._propertyTrack.GetTrack().GetPropertyTrack("volume");return e?e.GetSourceAdapter()._pauseVolume:this._pauseVolume}TimelineRemoved(){super.TimelineRemoved(),this._audioPlaybackStarted=!1,this._sdkInstance&&(this._expressions&&(this._pauseTime=this._expressions.PlaybackTime.call(this._sdkInstance,this._audioTag),this._pauseVolume=this._expressions.Volume.call(this._sdkInstance,this._audioTag)),this._actions&&this._actions.Stop.call(this._sdkInstance,this._audioTag))}GetAudioTag(){return this._audioTag}GetVolume(){return this._volume}SetVolume(e){this._volume=e}SetInitialState(){super.SetInitialState(),this._pauseTime=NaN,this._audioPlaybackStarted=!1}SetResumeState(){super.SetResumeState();const e=this._propertyTrack.GetTimeline().GetTime();switch(this._pauseTime=e-this._startOffsetTime,this._propertyTrack.GetPropertyName()){case"volume":this._pauseVolume=this._propertyTrack.GetInterpolatedValue(e)}this._audioPlaybackStarted=!1}Interpolate(e,t,s,i,r){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case"audioSource":if(!this._timeline.IsForwardPlayBack())break;if(i){this._actions&&this._actions.Stop.call(this._sdkInstance,this._audioTag);break}if(e<this._startOffsetTime){this._audioPlaybackStarted=!1;break}if(t=this._expressions.PlaybackRate.call(this._sdkInstance,this._audioTag),(s=this._timeline.GetPlaybackRate())!==t&&this._actions.SetPlaybackRate.call(this._sdkInstance,this._audioTag,s),this._audioPlaybackStarted)break;this._audioPlaybackStarted=!0,isNaN(this._pauseTime)?(t=self.performance.now(),e-=this._startOffsetTime,"suspended"===this._sdkInstance.GetAudioContextState()?this._audioPlaybackStarted=!1:(e+=t=(self.performance.now()-t)/1e3,this._actions&&(t=this.GetVolume(),isNaN(t)?(this.SetVolume(0),t=0):this.SetVolume(t),this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,t,this._audioTag,e)))):(e=this._pauseTime,this._pauseTime=NaN,t=this._GetPauseVolume(),this._pauseVolume=NaN,"suspended"===this._sdkInstance.GetAudioContextState()?this._audioPlaybackStarted=!1:this._actions&&(this.SetVolume(t),this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,t,this._audioTag,e)));break;case"volume":this._MaybeSetAudioSource(),super.Interpolate(e,t,s,i,r)}}GetInterpolatedValue(e,t,s){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case"volume":return this._MaybeSetAudioSource(),super.GetInterpolatedValue(e,t,s)}}Getter(e,t){return this._audioSource?this._audioSource.GetVolume():0}Setter(e,t,s,i){this._audioSource&&this._audioSource.SetVolume(this.Getter()+t),this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}AbsoluteSetter(e,t,s){this._audioSource&&this._audioSource.SetVolume(t),this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}DoesRounding(){return!0}_SaveToJson(){return{audioPlaybackStarted:this._audioPlaybackStarted,audioTag:this._audioTag,pauseTime:this._pauseTime,pauseVolume:this._pauseVolume,volume:this._volume}}_LoadFromJson(e){e&&(this._audioPlaybackStarted=e.audioPlaybackStarted,this._audioTag=e.audioTag,this._pauseTime=e.pauseTime,this._pauseVolume=e.pauseVolume,this._volume=e.volume,this._Initialize())}}C3$jscomp$93.PropertyTrackState.AudioSourceAdapter=AudioSourceAdapter,self.C3.PropertyTrackState.PropertyInterpolationAdapter=class{constructor(e){this._sourceAdapter=e,this._propertyTrack=e.GetPropertyTrack(),this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo(),this._property=this._propertyTrack.GetPropertyName(),this._firstAbsoluteUpdate=!1,this._target=this._saveState=null}Release(){this._target=this._saveState=this._worldInfo=this._propertyTrack=this._sourceAdapter=null}MayNeedBeforeAndAfterInterpolate(){return!1}TimelineRemoved(){}CleanCaches(){this._target=this._saveState=this._worldInfo=null}GetSourceAdapter(){return this._sourceAdapter}GetPropertyTrack(){return this._propertyTrack}GetWorldInfo(){return this._worldInfo?this._worldInfo:this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo()}SetFirstAbsoluteUpdate(e){this._firstAbsoluteUpdate=!!e}GetFirstAbsoluteUpdate(){return this._firstAbsoluteUpdate}SetResetState(){}SetInitialState(){}SetResumeState(){}SetSaveState(){this._saveState=this.GetCurrentState()}ClearSaveState(){this._saveState=null}GetCurrentState(){}CompareInitialStateWithCurrent(){}CompareSaveStateWithCurrent(){}CanChange(e){return typeof this._Getter()==typeof e}BeforeChangeProperty(){}ChangeProperty(e,t,s,i,r,n,a){}AfterChangeProperty(){}_FirstKeyframeGetter(){return this._PickTimelinePlaybackMode((()=>{const e=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(e)}),(()=>{const e=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e)})).GetAbsoluteValue()}_CurrentKeyframeGetter(){const e=this._propertyTrack.GetTimeline().GetTime()-this._propertyTrack.GetTrack().GetStartOffset();return this._PickTimelinePlaybackMode((()=>{const t=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,t)}),(()=>{const t=this._propertyTrack.GetPropertyTrackDataItem(),s=this._propertyTrack.GetPropertyTrackData(),i=s.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,t);return i||s.GetLastPropertyKeyframeDataItem(t)})).GetAbsoluteValue()}_PickTimelinePlaybackMode(e,t){return this._propertyTrack.GetTimeline().IsForwardPlayBack()?e():t()}_PickResultMode(e,t){return"relative"===this._propertyTrack.GetResultMode()?e():t()}_PickFirstAbsoluteUpdate(e,t){return this.GetFirstAbsoluteUpdate()?(this.SetFirstAbsoluteUpdate(!1),e()):t()}_GetAbsoluteInitialValue(e){}_GetIndex(){return this._sourceAdapter.GetIndex()}_GetTarget(){return this._target?this._target:this._target=this._sourceAdapter.GetTarget()}_PickSource(e,t,s,i,r,n){switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":return e();case"effect":return t();case"instance-variable":return s();case"plugin":return i();case"world-instance":return r();case"audio":return n()}}_SaveToJson(){return{firstAbsoluteUpdate:this._firstAbsoluteUpdate,saveState:this._saveState}}_LoadFromJson(e){e&&(this._firstAbsoluteUpdate=e.firstAbsoluteUpdate,this._saveState=e.saveState)}_GetPropertyKeyframeStubs(e,t=!1){const s=[];for(const i of e){e=i.GetTrack().GetStartOffset();for(const r of i.GetPropertyKeyframeDataItems())t&&0===r.GetTime()?s.push({time:e+r.GetTime(),value:r.GetAbsoluteValue()}):t||s.push({time:e+r.GetTime(),value:r.GetAbsoluteValue()})}return s.sort(((e,t)=>e.time-t.time))}_GetLastPropertyKeyframeStub(e,t,s){return this._GetPropertyKeyframeStubLowerThanPlayhead(t,s)}_GetPropertyKeyframeStubLowerThanPlayhead(e,t){for(let s=t.length-1;0<=s;s--)if(t[s].time<=e)return t[s];return null}};const C3$jscomp$95=self.C3,TMP_COLORS_MAP=new Map,TMP_COLOR=[0,0,0];class ColorInterpolationAdapter extends C3$jscomp$95.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return this._ToColorArray(t.GetPropertyValueByIndex(s));case"effect":return this._ToColorArray(t[s]);case"plugin":return this._ToColorArray(t.GetPropertyValueByIndex(s));case"world-instance":return this._ToColorArray(this._Getter())}}CompareInitialStateWithCurrent(){const e=this._FirstKeyframeGetter();return!this._CompareColors(e,this._Getter())}CompareSaveStateWithCurrent(){return!C3$jscomp$95.IsNullOrUndefined(this._saveState)&&!this._CompareColors(this._saveState,this._Getter())}_CompareColors(e,t){return e=this._GetColorFromArray(e),t=this._GetColorFromArray(t),e.equalsIgnoringAlpha(t)}_FirstKeyframeGetter(){const e=super._FirstKeyframeGetter();return this._GetColorFromArray(e)}_CurrentKeyframeGetter(){const e=super._CurrentKeyframeGetter();return this._GetColorFromArray(e)}_GetAbsoluteInitialValue(e){}_ToColorArray(e){return C3$jscomp$95.IsInstanceOf(e,C3$jscomp$95.Color)?e.toArray().slice(0,3):e.slice(0,3)}_GetColorFromArray(e){return C3$jscomp$95.IsInstanceOf(e,C3$jscomp$95.Color)?e:new C3$jscomp$95.Color(e[0],e[1],e[2],1)}CanChange(e){return!0}MayNeedBeforeAndAfterInterpolate(){return!0}BeforeChangeProperty(){var e=this._propertyTrack.GetTimeline(),t=this._propertyTrack.GetInstance();const s=this._propertyTrack.GetSourceAdapter();(e=e.GetSimilarPropertyTracks(t,s,this._property))&&1<e.length&&(TMP_COLORS_MAP.has(t)||TMP_COLORS_MAP.set(t,new Map),t=TMP_COLORS_MAP.get(t),e=this._propertyTrack.GetSourceAdapterId(),t.has(e)||t.set(e,new Map),(t=t.get(e)).has(this._property)||t.set(this._property,{used:!1,color:new C3$jscomp$95.Color(0,0,0,1)}))}_GetTmpColor(e,t,s){return(e=TMP_COLORS_MAP.get(e).get(t).get(s)).used=!0,e.color}ChangeProperty(e,t,s,i,r){r=this._propertyTrack.GetTimeline(),i=this._propertyTrack.GetTrack(),e=this._propertyTrack.GetInstance();var n=this._propertyTrack.GetSourceAdapter();s=this._propertyTrack.GetSourceAdapterId(),(n=r.GetSimilarPropertyTracks(e,n,this._property))&&1<n.length?(n=this._GetPropertyKeyframeStubs(n,!0),(r=this._GetLastPropertyKeyframeStub(r,r.GetTime(),n))&&(i=i.GetStartOffset(),0===(n=r.time-i)?this._GetTmpColor(e,s,this._property).addRgb(t[0],t[1],t[2]):0>n||(r=t[0],i=t[1],t=t[2],n=this._propertyTrack.Interpolate(n,!1,!0),r=C3$jscomp$95.Color.DiffChannel(r,n[0]),i=C3$jscomp$95.Color.DiffChannel(i,n[1]),t=C3$jscomp$95.Color.DiffChannel(t,n[2]),this._GetTmpColor(e,s,this._property).addRgb(r,i,t)))):this._Setter(t[0],t[1],t[2])}AfterChangeProperty(){const e=this._propertyTrack.GetInstance();if(TMP_COLORS_MAP.has(e)){var t=TMP_COLORS_MAP.get(e),s=this._propertyTrack.GetSourceAdapterId();if(t.has(s)){var i=t.get(s);if(i.has(this._property)){var r=i.get(this._property),n=r.color;r.used&&this._Setter(n.getR(),n.getG(),n.getB()),0===i.size&&t.delete(s),0===t.size&&TMP_COLORS_MAP.delete(e)}}}}_Getter(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return this._GetColorFromArray(t.GetPropertyValueByIndex(s));case"effect":return t[s].clone();case"plugin":return this._GetColorFromArray(t.GetPropertyValueByIndex(s));case"world-instance":return this.GetWorldInfo().GetUnpremultipliedColor().clone()}}_Setter(e,t,s){const i=this._propertyTrack.GetSourceAdapterId(),r=this._GetTarget(),n=this._GetIndex();switch(i){case"behavior":TMP_COLOR[0]=e,TMP_COLOR[1]=t,TMP_COLOR[2]=s,r.SetPropertyValueByIndex(n,TMP_COLOR);break;case"effect":r[n].setRgb(e,t,s);break;case"plugin":TMP_COLOR[0]=e,TMP_COLOR[1]=t,TMP_COLOR[2]=s,r.SetPropertyValueByIndex(n,TMP_COLOR);break;case"world-instance":this.GetWorldInfo().SetUnpremultipliedColorRGB(e,t,s)}}_SaveToJson(){}_LoadFromJson(e){}}C3$jscomp$95.PropertyTrackState.PropertyInterpolationAdapter.ColorInterpolationAdapter=ColorInterpolationAdapter;const C3$jscomp$96=self.C3,NS$jscomp$1=C3$jscomp$96.PropertyTrackState;class NoInterpolationAdapter extends C3$jscomp$96.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){return this._FirstKeyframeGetter()!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return!C3$jscomp$96.IsNullOrUndefined(this._saveState)&&this._saveState!==this.GetCurrentState()}MayNeedBeforeAndAfterInterpolate(){return!1}ChangeProperty(e,t,s,i,r){const n=(s=this._propertyTrack).GetTrack();i=s.GetSourceAdapterId(),r=s.GetTimeline();var a=n.GetInstance();const o=s.GetSourceAdapter();switch((a=r.GetSimilarPropertyTracks(a,o,this._property))&&1<a.length&&(a=this._GetPropertyKeyframeStubs(a),e+=n.GetStartOffset(),e=this._GetLastPropertyKeyframeStub(r,e,a))&&(t=e.value),s.GetPropertyKeyframeType()){case"numeric":if(!NS$jscomp$1.NumericTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,i))return;break;case"angle":if(!NS$jscomp$1.AngleTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,i))return;break;case"boolean":if(!NS$jscomp$1.BooleanTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,i))return;break;case"color":if(!NS$jscomp$1.ColorTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,i))return;break;case"text":if(!NS$jscomp$1.TextTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,i))return}this._Setter(t)}_Getter(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return t.GetPropertyValueByIndex(s);case"effect":return t[s];case"instance-variable":return t.GetInstanceVariableValue(s);case"plugin":return t.GetPropertyValueByIndex(s)}}_Setter(e){const t=this._propertyTrack.GetSourceAdapterId(),s=this._GetTarget(),i=this._GetIndex();switch(t){case"behavior":s.SetPropertyValueByIndex(i,e);break;case"effect":s[i]=e;break;case"instance-variable":s.SetInstanceVariableValue(i,e);break;case"plugin":s.SetPropertyValueByIndex(i,e)}}}C3$jscomp$96.PropertyTrackState.PropertyInterpolationAdapter.NoInterpolationAdapter=NoInterpolationAdapter;const C3$jscomp$97=self.C3,INSTANCE_FUNC_MAP=new Map,add$jscomp$1=(e,t,s,i,r,n=!1,a=null,o=null)=>{INSTANCE_FUNC_MAP.set(e,{setter:t,absolute_setter:s,getter:i,round:r,fRound:n,init:a,reset:o})};add$jscomp$1("offsetX",((e,t,s,i)=>{"relative"===i._propertyTrack.GetResultMode()?e.OffsetX(t,s.GetTimeline().GetTransformWithSceneGraph()):e.OffsetX(t)}),((e,t)=>e.SetX(t)),(e=>e.GetX()),!0),add$jscomp$1("offsetY",((e,t,s,i)=>{"relative"===i._propertyTrack.GetResultMode()?e.OffsetY(t,s.GetTimeline().GetTransformWithSceneGraph()):e.OffsetY(t)}),((e,t)=>e.SetY(t)),(e=>e.GetY()),!0),add$jscomp$1("offsetWidth",((e,t,s,i,r)=>{if(0!==t)if("relative"===i._propertyTrack.GetResultMode()&&e.HasParent()&&e.GetTransformWithParentWidth()){if(isNaN(i._absoluteToFactor)){const t=[];for(var n=e.GetParent();n;)t.push(n),n=n.GetParent();t.reverse(),n=(e,t)=>(t=t.GetTimeline().GetTrackFromInstance(e.GetInstance()))||(t=e.GetInstance().GetSdkInstance()).IsOriginalSizeKnown()?t.GetOriginalWidth():e._GetSceneGraphInfo()._GetStartWidth();const r=(e,t,s)=>(e=t.GetTimeline().GetTrackFromInstance(e.GetInstance()))&&(s=e.GetPropertyTrack(s))&&(s=s.GetPropertyTrackDataItem().GetPropertyKeyframeData())&&(s=s.GetLastPropertyKeyframeDataItem())?s.GetValue():0;let h=t[0];var a=h._GetSceneGraphInfo()._GetStartWidth(),o=h._GetSceneGraphInfo().GetStartScaleX();for(a*=o,a+=r(h,s,"offsetWidth"),a+=n(h,s)*r(h,s,"offsetScaleX"),o=1;o<t.length;o++)h=t[o],a*=h._GetSceneGraphInfo().GetStartScaleX(),a+=r(h,s,"offsetWidth"),a+=n(h,s)*r(h,s,"offsetScaleX");i._absoluteToFactor=0===a?Number.EPSILON:a}r||e.OffsetWidth(t/i._absoluteToFactor,!0)}else e.OffsetWidth(t)}),((e,t)=>e.SetWidth(t)),(e=>e.GetWidth()),!0),add$jscomp$1("offsetHeight",((e,t,s,i,r)=>{if(0!==t)if("relative"===i._propertyTrack.GetResultMode()&&e.HasParent()&&e.GetTransformWithParentHeight()){if(isNaN(i._absoluteToFactor)){const t=[];for(var n=e.GetParent();n;)t.push(n),n=n.GetParent();t.reverse(),n=(e,t)=>(t=t.GetTimeline().GetTrackFromInstance(e.GetInstance()))||(t=e.GetInstance().GetSdkInstance()).IsOriginalSizeKnown()?t.GetOriginalHeight():e._GetSceneGraphInfo()._GetStartHeight();const r=(e,t,s)=>(e=t.GetTimeline().GetTrackFromInstance(e.GetInstance()))&&(s=e.GetPropertyTrack(s))&&(s=s.GetPropertyTrackDataItem().GetPropertyKeyframeData())&&(s=s.GetLastPropertyKeyframeDataItem())?s.GetValue():0;let h=t[0];var a=h._GetSceneGraphInfo()._GetStartHeight(),o=h._GetSceneGraphInfo().GetStartScaleY();for(a*=o,a+=r(h,s,"offsetHeight"),a+=n(h,s)*r(h,s,"offsetScaleY"),o=1;o<t.length;o++)h=t[o],a*=h._GetSceneGraphInfo().GetStartScaleY(),a+=r(h,s),a+=n(h,s)*r(h,s,"offsetScaleY");i._absoluteToFactor=0===a?Number.EPSILON:a}r||e.OffsetHeight(t/i._absoluteToFactor,!0)}else e.OffsetHeight(t)}),((e,t)=>e.SetHeight(t)),(e=>e.GetHeight()),!0),add$jscomp$1("offsetAngle",((e,t)=>e.OffsetAngle(t)),((e,t)=>e.SetAngle(t)),(e=>e.GetAngle()),!1),add$jscomp$1("offsetOpacity",((e,t,s,i)=>{s=e.GetOpacity()+t,0===i._clampAccumulator?(1<s?i._clampAccumulator+=s-1:0>s&&(i._clampAccumulator+=s),e.OffsetOpacity(t)):(e=e.GetOpacity()+t,0<t&&0<i._clampAccumulator?1<e&&(i._clampAccumulator+=e-1):0<t&&0>i._clampAccumulator?(i._clampAccumulator+=t,0<i._clampAccumulator&&(i._clampAccumulator=0)):0>t&&0<i._clampAccumulator?(i._clampAccumulator+=t,0>i._clampAccumulator&&(i._clampAccumulator=0)):0>t&&0>i._clampAccumulator&&0>e&&(i._clampAccumulator+=e))}),((e,t)=>{e.SetOpacity(t)}),(e=>e.GetOpacity()),!1,!0,(e=>{switch(e._clampAccumulator=0,e._propertyTrack.GetResultMode()){case"relative":e._propertyTrack.GetPropertyTrackData();const r=e._propertyTrack.GetPropertyTrackDataItem().GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();var t=e.GetWorldInfo().GetOpacity(),s=t;for(var i of r)s=i.GetTime(),s=t+(s=e._propertyTrack.GetInterpolatedValue(s)),s=C3$jscomp$97.clamp(s,0,1);for(e._totalForewardOpacityDelta=t-s,e._totalForewardOpacityDelta=Math.round(100*(e._totalForewardOpacityDelta+Number.EPSILON))/100,s=t,t=r.length-1;0<=t;t--)i=r[t].GetTime(),s-=i=e._propertyTrack.GetInterpolatedValue(i),s=C3$jscomp$97.clamp(s,0,1);e._totalBackwardOpacityDelta=s,e._totalBackwardOpacityDelta=Math.round(100*(e._totalBackwardOpacityDelta+Number.EPSILON))/100}}),(e=>{switch(e._propertyTrack.GetResultMode()){case"relative":e._clampAccumulator=0;const t=e.GetWorldInfo();let s=t.GetOpacity();s=Math.round(100*(s+Number.EPSILON))/100,e._propertyTrack.GetTimeline().IsForwardPlayBack()?(t.SetOpacity(s+e._totalForewardOpacityDelta),e._lastValue=0):(t.SetOpacity(s-e._totalBackwardOpacityDelta),e._lastValue=e.GetSourceAdapter().GetValueAtTime())}})),add$jscomp$1("offsetOriginX",((e,t)=>e.OffsetOriginX(t)),((e,t)=>e.SetOriginX(t)),(e=>e.GetOriginX()),!1),add$jscomp$1("offsetOriginY",((e,t)=>e.OffsetOriginY(t)),((e,t)=>e.SetOriginY(t)),(e=>e.GetOriginY()),!1),add$jscomp$1("offsetZElevation",((e,t)=>e.OffsetZElevation(t)),((e,t)=>e.SetZElevation(t)),(e=>e.GetZElevation()),!0),add$jscomp$1("offsetScaleX",((e,t,s,i)=>{if(0!==t){var r=0>e.GetWidth()?-1:1;"relative"===i._propertyTrack.GetResultMode()&&e.HasParent()&&e.GetTransformWithParentWidth()?(t*=s.GetOriginalWidth()*r,isNaN(i._absoluteToFactor)&&INSTANCE_FUNC_MAP.get("offsetWidth").setter(e,1,s,i,!0),e.OffsetWidth(t/i._absoluteToFactor,!0)):e.OffsetWidth(s.GetOriginalWidth()*r*t)}}),((e,t,s)=>{e.SetWidth(s.GetOriginalWidth()*t)}),((e,t)=>{const s=0>e.GetWidth()?-1:1;if(e.GetTransformWithParentWidth()){var i=e.GetParent(),r=t.GetTimeline().GetTrackFromInstance(i.GetInstance());return r?i=i.GetWidth()/r.GetOriginalWidth():(r=i.GetInstance().GetSdkInstance(),i=r.IsOriginalSizeKnown()?i.GetWidth()/r.GetOriginalWidth():1),e.GetWidth()*s/(t.GetOriginalWidth()*i)}return e.GetWidth()*s/t.GetOriginalWidth()}),!1),add$jscomp$1("offsetScaleY",((e,t,s,i)=>{if(0!==t){var r=0>e.GetHeight()?-1:1;"relative"===i._propertyTrack.GetResultMode()&&e.HasParent()&&e.GetTransformWithParentHeight()?(t*=s.GetOriginalHeight()*r,isNaN(i._absoluteToFactor)&&INSTANCE_FUNC_MAP.get("offsetHeight").setter(e,1,s,i,!0),e.OffsetHeight(t/i._absoluteToFactor,!0)):e.OffsetHeight(s.GetOriginalHeight()*r*t)}}),((e,t,s)=>{e.SetHeight(s.GetOriginalHeight()*t)}),((e,t)=>{const s=0>e.GetHeight()?-1:1;if(e.GetTransformWithParentHeight()){var i=e.GetParent(),r=t.GetTimeline().GetTrackFromInstance(i.GetInstance());return r?i=i.GetHeight()/r.GetOriginalHeight():(r=i.GetInstance().GetSdkInstance(),i=r.IsOriginalSizeKnown()?i.GetHeight()/r.GetOriginalHeight():1),e.GetHeight()*s/(t.GetOriginalHeight()*i)}return e.GetHeight()*s/t.GetOriginalHeight()}),!1);class NumericInterpolationAdapter extends C3$jscomp$97.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e),this._totalBackwardOpacityDelta=this._totalForewardOpacityDelta=this._clampAccumulator=this._lastValue=0,this._absoluteToFactor=NaN,this._source_adapter_absolute_setter=this._source_adapter_setter=this._source_adapter_getter=this._init_action=this._reset_action=this._instance_absolute_setter=this._instance_setter=this._instance_getter=null,this._fRound=this._round=!1,C3$jscomp$97.IsInstanceOf(this._propertyTrack.GetTimeline(),C3$jscomp$97.TweenState)?this._typeAdapter=new C3$jscomp$97.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween(this):this._typeAdapter=new C3$jscomp$97.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline(this);const t=this._propertyTrack.GetPropertyName();switch(this._propertyTrack.GetSourceAdapterId()){case"world-instance":e=INSTANCE_FUNC_MAP.get(t),this._instance_getter=e.getter,this._instance_setter=e.setter,this._instance_absolute_setter=e.absolute_setter,this._round=e.round,this._fRound=e.fRound,this._init_action=e.init,this._reset_action=e.reset;break;case"audio":this._source_adapter_getter=e.Getter,this._source_adapter_setter=e.Setter,this._source_adapter_absolute_setter=e.AbsoluteSetter,this._round=!!e.DoesRounding(),this._fRound=!1}}Release(){this._instance_absolute_setter=this._instance_setter=this._instance_getter=this._typeAdapter=null,this._absoluteToFactor=NaN,super.Release()}MayNeedBeforeAndAfterInterpolate(){return this._typeAdapter.MayNeedBeforeAndAfterInterpolate()}GetLastValue(){return this._lastValue}SetLastValue(e){this._lastValue=e}SetResetState(){this._reset_action&&this._reset_action(this)}SetInitialState(){const e=this._typeAdapter.SetInitialState();"number"==typeof e&&(this._lastValue=e),this._init_action&&this._init_action(this)}SetResumeState(){const e=this._typeAdapter.SetResumeState();"number"==typeof e&&(this._lastValue=e)}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){return this._FirstKeyframeGetter()!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return!C3$jscomp$97.IsNullOrUndefined(this._saveState)&&this._saveState!==this.GetCurrentState()}BeforeChangeProperty(){this._typeAdapter.BeforeChangeProperty()}ChangeProperty(e,t,s,i,r,n,a){return this._typeAdapter.ChangeProperty(e,t,s,i,r,n,a)}AfterChangeProperty(){this._typeAdapter.AfterChangeProperty()}_Getter(){const e=this._GetTarget(),t=this._GetIndex(),s=this.GetWorldInfo(),i=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":return e.GetPropertyValueByIndex(t);case"effect":return e[t];case"instance-variable":return e.GetInstanceVariableValue(t);case"plugin":return e.GetPropertyValueByIndex(t);case"world-instance":return this._instance_getter(s,i);case"audio":return this._source_adapter_getter.call(this.GetSourceAdapter(),s,i)}}_Setter(e,t,s){t=this._GetTarget(),s=this._GetIndex();const i=this.GetWorldInfo(),r=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":t.OffsetPropertyValueByIndex(s,e);break;case"effect":t[s]+=e;break;case"instance-variable":t.SetInstanceVariableOffset(s,e);break;case"plugin":t.OffsetPropertyValueByIndex(s,e);break;case"world-instance":this._instance_setter(i,e,r,this);break;case"audio":this._source_adapter_setter.call(this.GetSourceAdapter(),i,e,r,this)}}_SetterAbsolute(e,t,s){t=this._GetTarget(),s=this._GetIndex();const i=this.GetWorldInfo(),r=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":t.SetPropertyValueByIndex(s,e);break;case"effect":t[s]=e;break;case"instance-variable":t.SetInstanceVariableValue(s,e);break;case"plugin":t.SetPropertyValueByIndex(s,e);break;case"world-instance":this._instance_absolute_setter(i,e,r);break;case"audio":this._source_adapter_absolute_setter.call(this.GetSourceAdapter(),i,e,r)}}_MaybeEnsureValue(e,t,s,i,r,n,a,o){this._typeAdapter._MaybeEnsureValue(e,t,s,i,r,n,a,o)}_AddDelta(e,t,s,i,r){const n=(e.toString().split(".")[1]||"").length;e=this._Getter(),i=0===n?this._round?Math.round(e):this._fRound?Math.round(100*(e+Number.EPSILON))/100:i?this._GetForceValue(t,s,r):e:this._round?Number(C3$jscomp$97.toFixed(e,n)):i?this._GetForceValue(t,s,r):e,this._Setter(i-e,t,s)}_GetForceValue(e,t,s){var i=this.GetPropertyTrack().GetTimeline();const r=i.IsForwardPlayBack(),n=i.GetLoop();return i=i.GetPingPong(),n||i?r?e.GetAbsoluteValue():t.GetAbsoluteValue():s?r?t.GetAbsoluteValue():e.GetAbsoluteValue():r?e.GetAbsoluteValue():t.GetAbsoluteValue()}_SaveToJson(){return Object.assign(super._SaveToJson(),{v:this._lastValue,a:this._clampAccumulator,fod:this._totalForewardOpacityDelta,bod:this._totalBackwardOpacityDelta})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._lastValue=e.v,this._clampAccumulator=e.a,this._totalForewardOpacityDelta=C3$jscomp$97.IsFiniteNumber(e.fod)?e.fod:0,this._totalBackwardOpacityDelta=C3$jscomp$97.IsFiniteNumber(e.bod)?e.bod:0)}}C3$jscomp$97.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapter=NumericInterpolationAdapter;class AbsoluteValueObject{constructor(e){this._used=!1,this._value=0,this._propertyTracks=e;for(let e=0,t=this._propertyTracks.length;e<t;e++)this._propertyTracks[e].SetAbsoluteValueObject(this)}GetPropertyTracks(){return this._propertyTracks}SetUsed(){this._used=!0}GetUsed(){return this._used}SetValue(e){this._value=e}GetValue(){return this._value}Reset(){this._used=!1,this._value=0}}class NumericInterpolationAdapterForTimeline{constructor(e){this._numericInterpolationAdapter=e}Release(){this._numericInterpolationAdapter=null}SetInitialState(){const e=this._numericInterpolationAdapter;return this._numericInterpolationAdapter.GetPropertyTrack(),e._PickResultMode((()=>e._PickTimelinePlaybackMode((()=>0),(()=>e.GetSourceAdapter().GetValueAtTime()))),(()=>{}))}SetResumeState(){}MayNeedBeforeAndAfterInterpolate(){switch(this._numericInterpolationAdapter.GetPropertyTrack().GetResultMode()){case"relative":return!1;case"absolute":return!0}}BeforeChangeProperty(){var e=this._numericInterpolationAdapter.GetPropertyTrack(),t=e.GetPropertyName();switch(e.GetResultMode()){case"absolute":if(e.HasAbsoluteValueObject())e.GetAbsoluteValueObject().Reset();else{const s=e.GetTimeline(),i=e.GetInstance();e=e.GetSourceAdapter(),(t=s.GetSimilarPropertyTracks(i,e,t))&&1<t.length&&new AbsoluteValueObject(t)}}}ChangeProperty(e,t,s,i,r,n,a){var o=this._numericInterpolationAdapter;switch((a=this._numericInterpolationAdapter.GetPropertyTrack()).GetResultMode()){case"relative":a=o.GetLastValue(),o._Setter(t-a,s,i),n&&this._MaybeEnsureValue(e,s,i,r,a,t),o.SetLastValue(t);break;case"absolute":i=a.GetTimeline(),s=a.GetTrack(),a.GetInstance(),a.GetSourceAdapter(),a.HasAbsoluteValueObject()?(r=(e=a.GetAbsoluteValueObject()).GetPropertyTracks(),r=o._GetPropertyKeyframeStubs(r,!0),(o=o._GetLastPropertyKeyframeStub(i,i.GetTime(),r))&&(s=s.GetStartOffset(),0===(o=o.time-s)?(e.SetUsed(),e.SetValue(e.GetValue()+t)):0>o||(a=a.GetInterpolatedValue(o),e.SetUsed(),e.SetValue(e.GetValue()+(t-a))))):o._SetterAbsolute(t)}}AfterChangeProperty(){const e=this._numericInterpolationAdapter;var t=this._numericInterpolationAdapter.GetPropertyTrack();switch(t.GetResultMode()){case"absolute":t.HasAbsoluteValueObject()&&((t=t.GetAbsoluteValueObject()).GetUsed()&&e._SetterAbsolute(t.GetValue()))}}_MaybeEnsureValue(e,t,s,i,r,n){const a=this._numericInterpolationAdapter;i||(t&&e===t.GetTime()?a._AddDelta(t.GetValueWithResultMode(),t,s):s&&e===s.GetTime()?a._AddDelta(s.GetValueWithResultMode(),t,s):0==n-r&&a._AddDelta(t.GetValueWithResultMode(),t,s))}}self.C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline=NumericInterpolationAdapterForTimeline;class NumericInterpolationAdapterForTween{constructor(e){this._numericInterpolationAdapter=e}Release(){this._numericInterpolationAdapter=null}SetInitialState(){const e=this._numericInterpolationAdapter;return e.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(e._FirstKeyframeGetter())}SetResumeState(){const e=this._numericInterpolationAdapter;if(e._FirstKeyframeGetter()!==e._CurrentKeyframeGetter())return e.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(e._CurrentKeyframeGetter())}MayNeedBeforeAndAfterInterpolate(){return!1}BeforeChangeProperty(){}ChangeProperty(e,t,s,i,r,n,a){const o=this._numericInterpolationAdapter,h=o.GetLastValue();switch(o.GetPropertyTrack().GetResultMode()){case"relative":o._Setter(t-h,s,i),n&&this._MaybeEnsureValue(e,s,i,r,h,t,!1,a);break;case"absolute":o.GetFirstAbsoluteUpdate()?(o.SetFirstAbsoluteUpdate(!1),o._Setter(h,s,i)):(o._Setter(t-h,s,i),n&&this._MaybeEnsureValue(e,s,i,r,h,t,this._ForceEndValue(),a))}o.SetLastValue(t)}AfterChangeProperty(){}_GetAbsoluteInitialValue(e){return e-this._numericInterpolationAdapter.GetCurrentState()}_ForceEndValue(){var e=this._numericInterpolationAdapter;const t=e.GetWorldInfo().GetInstance();e=e.GetPropertyTrack().GetRuntime().GetTimelineManager();let s=0;for(const i of e.GetPlayingTimelines())0===i.GetType()?i.HasTrackInstance(t)&&s++:1===i.GetType()&&i.GetInstance()===t&&s++;return 1>=s}_MaybeEnsureValue(e,t,s,i,r,n,a,o){const h=this._numericInterpolationAdapter;i?t&&e===t.GetTime()?h._AddDelta(t.GetValueWithResultMode(),t,s,a,o):s&&e===s.GetTime()?h._AddDelta(s.GetValueWithResultMode(),t,s,a,o):s||h._AddDelta(t.GetValueWithResultMode(),t,s,a,o):t&&e===t.GetTime()?h._AddDelta(t.GetValueWithResultMode(),t,s,a,o):s&&e===s.GetTime()?h._AddDelta(s.GetValueWithResultMode(),t,s,a,o):0==n-r&&h._AddDelta(t.GetValueWithResultMode(),t,s,a,o)}}self.C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween=NumericInterpolationAdapterForTween;const C3$jscomp$100=self.C3,Ease$jscomp$1=self.Ease;C3$jscomp$100.PropertyTrackState.NumericTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e)}return r!==s}static Interpolate(e,t,s,i){if(!s)return t=i.GetPropertyTrackDataItem(),(t=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(t)).GetValueWithResultMode();var r=i.GetInterpolationMode();if("default"===r&&(r="continuous"),"combo"===i.GetPropertyType()&&(r="discrete"),"discrete"===r)return t.GetValueWithResultMode();if("continuous"===r||"step"===r){"step"===r&&(0!==(r=i.GetTimeline().GetStep())&&(r=1/r,e=Math.floor(e*r)/r)),r=t.GetValueWithResultMode();const n=s.GetValueWithResultMode(),a=t.GetAddOn("cubic-bezier"),o=s.GetAddOn("cubic-bezier"),h=a&&a.GetStartEnable()&&o&&o.GetEndEnable();if(!h&&r===n)return r;const l=t.GetTime();return s=s.GetTime(),e=C3$jscomp$100.normalize(e,l,s),t=t.GetEase(),h?(s-=l,t=Ease$jscomp$1.GetRuntimeEase(t)(s*e,0,1,s),t=Ease$jscomp$1.GetRuntimeEase("cubicbezier")(t,r,r+a.GetStartAnchor(),n+o.GetEndAnchor(),n)):t=Ease$jscomp$1.GetRuntimeEase(t)((s-l)*e,r,n-r,s-l),"integer"===i.GetPropertyType()?Math.floor(t):t}}};const C3$jscomp$101=self.C3;C3$jscomp$101.PropertyTrackState.AngleTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e)}return r!==s}static Interpolate(e,t,s,i){if(!s)return t=i.GetPropertyTrackDataItem(),(t=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(t)).GetValueWithResultMode();var r=i.GetInterpolationMode();if("default"===r&&(r="continuous"),"combo"===i.GetPropertyType()&&(r="discrete"),"discrete"===r)return t.GetValueWithResultMode();if("continuous"===r||"step"===r){"step"===r&&(0!==(i=i.GetTimeline().GetStep())&&(i=1/i,e=Math.floor(e*i)/i));const n=t.GetTime(),a=s.GetTime();if(i=t.GetValueWithResultMode(),s=s.GetValueWithResultMode(),!(r=t.GetAddOn("angle")))return i===s?i:(e=C3$jscomp$101.normalize(e,n,a),t=self.Ease.GetRuntimeEase(t.GetEase()),C3$jscomp$101.angleLerp(i,s,t(e,0,1,1)));{const o=r.GetRevolutions();if(i===s&&0===o)return i;switch(e=C3$jscomp$101.normalize(e,n,a),t=self.Ease.GetRuntimeEase(t.GetEase())(e,0,1,1),r.GetDirection()){case"closest":return C3$jscomp$101.angleLerp(i,s,t,o);case"clockwise":return C3$jscomp$101.angleLerpClockwise(i,s,t,o);case"anti-clockwise":return C3$jscomp$101.angleLerpAntiClockwise(i,s,t,o)}}}}},self.C3.PropertyTrackState.BooleanTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e)}return!!r!=!!s}static Interpolate(e,t,s,i){return s?t.GetValueWithResultMode()?1:0:(e=i.GetPropertyTrackDataItem(),(e=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e)).GetValueWithResultMode()?1:0)}};const C3$jscomp$103=self.C3,TEMP_COLOR_ARRAY=[0,0,0],TEMP_COLOR_ARRAY_2=[0,0,0],TEMP_COLOR_ARRAY_3=[0,0,0];C3$jscomp$103.PropertyTrackState.ColorTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e)}return Array.isArray(s)?(TEMP_COLOR_ARRAY[0]=s[0],TEMP_COLOR_ARRAY[1]=s[1],TEMP_COLOR_ARRAY[2]=s[2]):(TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(s),TEMP_COLOR_ARRAY[0]=Math.floor(255*TEMP_COLOR_ARRAY_3.getR()),TEMP_COLOR_ARRAY[1]=Math.floor(255*TEMP_COLOR_ARRAY_3.getG()),TEMP_COLOR_ARRAY[2]=Math.floor(255*TEMP_COLOR_ARRAY_3.getB())),Array.isArray(r)?(TEMP_COLOR_ARRAY_2[0]=r[0],TEMP_COLOR_ARRAY_2[1]=r[1],TEMP_COLOR_ARRAY_2[2]=r[2]):(TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(r),TEMP_COLOR_ARRAY_2[0]=Math.floor(255*TEMP_COLOR_ARRAY_3.getR()),TEMP_COLOR_ARRAY_2[1]=Math.floor(255*TEMP_COLOR_ARRAY_3.getG()),TEMP_COLOR_ARRAY_2[2]=Math.floor(255*TEMP_COLOR_ARRAY_3.getB())),TEMP_COLOR_ARRAY[0]!==TEMP_COLOR_ARRAY_2[0]||TEMP_COLOR_ARRAY[1]!==TEMP_COLOR_ARRAY_2[1]||TEMP_COLOR_ARRAY[2]!==TEMP_COLOR_ARRAY_2[2]}static Interpolate(e,t,s,i){if(!s){var r=i.GetPropertyTrackDataItem();return r=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(r),i=r.GetValueWithResultMode(),TEMP_COLOR_ARRAY[0]=i[0],TEMP_COLOR_ARRAY[1]=i[1],TEMP_COLOR_ARRAY[2]=i[2],TEMP_COLOR_ARRAY}if("default"===(r=i.GetInterpolationMode())&&(r="continuous"),"discrete"===r)return i=t.GetValueWithResultMode(),TEMP_COLOR_ARRAY[0]=i[0],TEMP_COLOR_ARRAY[1]=i[1],TEMP_COLOR_ARRAY[2]=i[2],TEMP_COLOR_ARRAY;if("continuous"===r||"step"===r){"step"===r&&(0!==(i=i.GetTimeline().GetStep())&&(i=1/i,e=Math.floor(e*i)/i)),i=t.GetTime(),r=s.GetTime();var n=t.GetValueWithResultMode(),a=s.GetValueWithResultMode();e=C3$jscomp$103.normalize(e,i,r);var o=t.GetEase();t=n[0],s=n[1],n=n[2];const h=a[0],l=a[1];return a=a[2],o=self.Ease.GetRuntimeEase(o),r=(i=r-i)*e,TEMP_COLOR_ARRAY[0]=t===h?t:o(r,t,h-t,i),TEMP_COLOR_ARRAY[1]=s===l?s:o(r,s,l-s,i),TEMP_COLOR_ARRAY[2]=n===a?n:o(r,n,a-n,i),TEMP_COLOR_ARRAY}}},self.C3.PropertyTrackState.TextTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e)}return r!==s}static Interpolate(e,t,s,i){return s?t.GetValueWithResultMode():(e=i.GetPropertyTrackDataItem(),(e=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e)).GetValueWithResultMode())}};const C3$jscomp$105=self.C3;C3$jscomp$105.TimelineDataManager=class{constructor(){this._timelineDataItems=new Map}Release(){for(const e of this._timelineDataItems.values())e.Release();this._timelineDataItems.clear(),this._timelineDataItems=null}Add(e){const t=(e=new C3$jscomp$105.TimelineDataItem(e)).GetName();this._timelineDataItems.set(t,e)}Get(e){return this._timelineDataItems.get(e)}GetNameId(){return 0}static _CreateDataItems(e,t,s,i){if(t)for(const r of t)C3$jscomp$105.TimelineDataManager._CreateDataItem("create",r,e,s,i)}static _LoadDataItemsFromJson(e,t,s,i){e.length?t.forEach(((t,s)=>{e[s]._LoadFromJson(t)})):t.forEach((t=>{C3$jscomp$105.TimelineDataManager._CreateDataItem("load",t,e,s,i)}))}static _CreateDataItem(e,t,s,i,r){let n;if("function"==typeof i)switch(e){case"load":n=new i(null,r);break;case"create":n=new i(t,r)}else if("object"==typeof i)switch(i=i.map.get(t[i.prop]),e){case"load":n=new i(null,r);break;case"create":n=new i(t,r)}switch(e){case"load":n._LoadFromJson(t),s.push(n);break;case"create":if("function"==typeof n.GetEnable&&!n.GetEnable())return n.Release();s.push(n)}}};const C3$jscomp$106=self.C3;C3$jscomp$106.TimelineDataItem=class{constructor(e){this._name="",this._totalTime=NaN,this._step=0,this._resultMode=this._interpolationMode="default",this._pingPong=this._loop=!1,this._repeatCount=1,this._trackData=null,this._startOnLayout="",this._transformWithSceneGraph=!1,this._useSystemTimescale=!0,e&&(this._name=e[0],this._totalTime=e[1],this._step=e[2],this._interpolationMode=e[3],this._resultMode=e[4],this._loop=!!e[6],this._pingPong=!!e[7],this._repeatCount=e[8],this._startOnLayout=e[9],this._transformWithSceneGraph=!!e[10],this._useSystemTimescale=!!e[11],this._trackData=new C3$jscomp$106.TrackData(e[5],this))}Release(){this._trackData.Release(),this._trackData=null}GetTrackData(){return this._trackData||(this._trackData=new C3$jscomp$106.TrackData(null,this)),this._trackData}GetName(){return this._name}SetName(e){this._name=e}GetTotalTime(){return this._totalTime}SetTotalTime(e){this._totalTime=e}GetStep(){return this._step}SetStep(e){this._step=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetLoop(){return this._loop}SetLoop(e){this._loop=e}GetPingPong(){return this._pingPong}SetPingPong(e){this._pingPong=e}GetRepeatCount(){return this._repeatCount}SetRepeatCount(e){this._repeatCount=e}GetStartOnLayout(){return this._startOnLayout}GetTransformWithSceneGraph(){return this._transformWithSceneGraph}GetUseSystemTimescale(){return this._useSystemTimescale}_SaveToJson(){return{trackDataJson:this._trackData._SaveToJson(),name:this._name,totalTime:this._totalTime,step:this._step,interpolationMode:this._interpolationMode,resultMode:this._resultMode,loop:this._loop,pingPong:this._pingPong,repeatCount:this._repeatCount,startOnLayout:this._startOnLayout,transformWithSceneGraph:!!this._transformWithSceneGraph,useSystemTimescale:this._useSystemTimescale}}_LoadFromJson(e){e&&(this.GetTrackData()._LoadFromJson(e.trackDataJson),this._name=e.name,this._totalTime=e.totalTime,this._step=e.step,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._loop=e.loop,this._pingPong=e.pingPong,this._repeatCount=e.repeatCount,this._startOnLayout=e.startOnLayout,this._transformWithSceneGraph=!!e.transformWithSceneGraph,this._useSystemTimescale=!!e.useSystemTimescale)}};const C3$jscomp$107=self.C3;class TrackDataItem{constructor(e,t){this._trackData=t,this._additionalInstanceData=this._instanceData=null,this._objectClassIndex=this._instanceUid=NaN,this._resultMode=this._interpolationMode="default",this._enabled=!1,this._propertyTrackData=this._keyframeData=null,this._id="",this._nestedData=null,this._startOffset=0,this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),this._type=0,this._name="",e&&(e[0]&&(this._instanceData=e[0],this._instanceUid=e[0][2],this._objectClassIndex=e[0][1]),this._interpolationMode=e[1],this._resultMode=e[2],this._enabled=!!e[3],e[6]&&(this._id=e[6]),e[7]&&(this._nestedData=e[7],this._startOffset=e[7][0],this._localTotalTime=e[7][1]),e[8]&&(this._additionalInstanceData=e[8]),e[8]&&(this._additionalInstanceData=e[8]),e[9]&&(this._type=e[9]),e[10]&&(this._name=e[10]),this._keyframeData=new C3$jscomp$107.KeyframeData(e[4],this),this._propertyTrackData=new C3$jscomp$107.PropertyTrackData(e[5],this))}Release(){this._trackData=this._instanceData=null,this._keyframeData&&(this._keyframeData.Release(),this._keyframeData=null),this._propertyTrackData&&(this._propertyTrackData.Release(),this._propertyTrackData=null),this._nestedData=null}GetTrackData(){return this._trackData}GetKeyframeData(){return this._keyframeData||(this._keyframeData=new C3$jscomp$107.KeyframeData(null,this)),this._keyframeData}GetPropertyTrackData(){return this._propertyTrackData||(this._propertyTrackData=new C3$jscomp$107.PropertyTrackData(null,this)),this._propertyTrackData}GetInstanceData(){return this._instanceData}GetObjectClassIndex(){return this._objectClassIndex}SetObjectClassIndex(e){this._objectClassIndex=e}GetInstanceUID(){return this._instanceUid}SetInstanceUID(e){this._instanceUid=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}GetId(){return this._id}GetStartOffset(){return this._startOffset}GetLocalTotalTime(){return this._localTotalTime}SetLocalTotalTime(e){this._localTotalTime=e}GetOriginalWidth(){return this._additionalInstanceData[0]}SetOriginalWidth(e){this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[0]=e}GetOriginalHeight(){return this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[1]}SetOriginalHeight(e){this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[1]=e}GetType(){return this._type}GetName(){return this._name}_SaveToJson(){return{keyframeDataJson:this._keyframeData._SaveToJson(),propertyTrackDataJson:this._propertyTrackData._SaveToJson(),instanceData:this._instanceData,additionalInstanceData:this._additionalInstanceData,instanceUid:this._instanceUid,objectClassIndex:this._objectClassIndex,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,id:this._id,nestedData:this._nestedData,type:this._type,name:this._name}}_LoadFromJson(e){e&&(this._instanceData=e.instanceData,this._instanceUid=e.instanceUid,this._objectClassIndex=e.objectClassIndex,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._enabled=e.enabled,this._id=e.id,this._type=e.type?e.type:0,this._name=e.name?e.name:"",this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),e.nestedData&&(this._nestedData=e.nestedData,this._startOffset=this._nestedData[0],this._localTotalTime=this._nestedData[1]),e.additionalInstanceData&&(this._additionalInstanceData=e.additionalInstanceData),this.GetKeyframeData()._LoadFromJson(e.keyframeDataJson),this.GetPropertyTrackData()._LoadFromJson(e.propertyTrackDataJson))}}C3$jscomp$107.TrackData=class{constructor(e,t){this._timelineDataItem=t,this._trackDataItems=[],C3$jscomp$107.TimelineDataManager._CreateDataItems(this._trackDataItems,e,TrackDataItem,this)}Release(){this._timelineDataItem=null;for(const e of this._trackDataItems)e.Release();C3$jscomp$107.clearArray(this._trackDataItems),this._trackDataItems=null}GetTimelineDataItem(){return this._timelineDataItem}AddEmptyTrackDataItem(){const e=new TrackDataItem(null,this);return this._trackDataItems.push(e),e}GetFirstKeyframeDataItem(e){return e.GetKeyframeData().GetKeyframeDataItemArray()[0]}GetLastKeyframeDataItem(e){return e.GetKeyframeData().GetKeyframeDataItemArray().at(-1)}GetKeyFrameDataItemAtTime(e,t){const s=(t=t.GetKeyframeData().GetKeyframeDataItemArray()).length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()===e)return s}}GetFirstKeyFrameDataItemHigherThan(e,t){const s=(t=t.GetKeyframeData().GetKeyframeDataItemArray()).length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()>e)return s}}GetFirstKeyFrameDataItemHigherOrEqualThan(e,t){const s=(t=t.GetKeyframeData().GetKeyframeDataItemArray()).length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()>=e)return s}}GetFirstKeyFrameDataItemLowerOrEqualThan(e,t){for(let s=(t=t.GetKeyframeData().GetKeyframeDataItemArray()).length-1;0<=s;s--){const i=t[s];if(i.GetTime()<=e)return i}}*trackDataItems(){for(const e of this._trackDataItems)yield e}_SaveToJson(){return{trackDataItemsJson:this._trackDataItems.map((e=>e._SaveToJson()))}}_LoadFromJson(e){e&&C3$jscomp$107.TimelineDataManager._LoadDataItemsFromJson(this._trackDataItems,e.trackDataItemsJson,TrackDataItem,this)}};const C3$jscomp$108=self.C3;class PropertyTrackDataItem{constructor(e,t){this._propertyTrackData=t,this._sourceAdapterId="",this._type=this._property=this._sourceAdapterArguments=null,this._max=this._min=NaN,this._resultMode=this._interpolationMode="default",this._enabled=!1,this._propertyKeyframeData=null,this._canHavePropertyKeyframes=!0,e&&(this._sourceAdapterId=e[0][0],this._sourceAdapterArguments=e[0].slice(1),this._property=e[1],this._type=e[2],this._min=e[3],this._max=e[4],this._interpolationMode=e[5],this._resultMode=e[6],this._enabled=!!e[7],this._propertyKeyframeData=new C3$jscomp$108.PropertyKeyframeData(e[8],this),this._canHavePropertyKeyframes=e[9])}Release(){this._propertyKeyframeData.Release(),this._sourceAdapterArguments=this._propertyTrackData=this._propertyKeyframeData=null}GetPropertyTrackData(){return this._propertyTrackData}GetPropertyKeyframeData(){return this._propertyKeyframeData||(this._propertyKeyframeData=new C3$jscomp$108.PropertyKeyframeData(null,this)),this._propertyKeyframeData}GetSourceAdapterId(){return this._sourceAdapterId}SetSourceAdapterId(e){this._sourceAdapterId=e}GetSourceAdapterArguments(){return this._sourceAdapterArguments}SetSourceAdapterArguments(e){this._sourceAdapterArguments=e}GetProperty(){return this._property}SetProperty(e){this._property=e}GetType(){return this._type}SetType(e){this._type=e}GetMin(){return this._min}SetMin(e){this._min=e}GetMax(){return this._max}SetMax(e){this._max=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}CanHavePropertyKeyframes(){return!!this._canHavePropertyKeyframes}_SaveToJson(){return{propertyKeyframeDataJson:this._propertyKeyframeData._SaveToJson(),sourceAdapterId:this._sourceAdapterId,sourceAdapterArguments:this._sourceAdapterArguments,property:this._property,type:this._type,min:this._min,max:this._max,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,canHavePropertyKeyframes:this._canHavePropertyKeyframes}}_LoadFromJson(e){e&&(this._sourceAdapterId=e.sourceAdapterId,this._sourceAdapterArguments=e.sourceAdapterArguments,this._property=e.property,this._type=e.type,this._min=e.min,this._max=e.max,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._enabled=e.enabled,this._canHavePropertyKeyframes=e.canHavePropertyKeyframes,this.GetPropertyKeyframeData()._LoadFromJson(e.propertyKeyframeDataJson))}}C3$jscomp$108.PropertyTrackData=class{constructor(e,t){this._trackDataItem=t,this._propertyTrackDataItems=[],C3$jscomp$108.TimelineDataManager._CreateDataItems(this._propertyTrackDataItems,e,PropertyTrackDataItem,this)}Release(){this._trackDataItem=null;for(const e of this._propertyTrackDataItems)e.Release();C3$jscomp$108.clearArray(this._propertyTrackDataItems),this._propertyTrackDataItems=null}GetTrackDataItem(){return this._trackDataItem}AddEmptyPropertyTrackDataItem(){const e=new PropertyTrackDataItem(null,this);return this._propertyTrackDataItems.push(e),e}GetFirstPropertyKeyframeDataItem(e){return e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()[0]}GetLastPropertyKeyframeDataItem(e){return e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray().at(-1)}GetPropertyKeyFrameDataItemAtTime(e,t){const s=(t=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()).length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()===e)return s}}GetFirstPropertyKeyFrameDataItemHigherThan(e,t){const s=(t=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()).length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()>e)return s}}GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,t){const s=(t=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()).length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()>=e)return s}}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,t){for(let s=(t=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()).length-1;0<=s;s--){const i=t[s];if(i.GetTime()<=e)return i}}*propertyTrackDataItems(){for(const e of this._propertyTrackDataItems)yield e}_SaveToJson(){return{propertyTrackDataItemsJson:this._propertyTrackDataItems.map((e=>e._SaveToJson()))}}_LoadFromJson(e){e&&C3$jscomp$108.TimelineDataManager._LoadDataItemsFromJson(this._propertyTrackDataItems,e.propertyTrackDataItemsJson,PropertyTrackDataItem,this)}};const C3$jscomp$109=self.C3;class KeyframeDataItem{constructor(e,t){this._keyframeData=t,this._time=-1,this._ease="noease",this._enable=!1,this._lowerTags=this._tags=null,e&&(this._time=e[0],this._ease=e[1],this._enable=!!e[2],this._tags=(e=e[3])?e.split(" "):[],this._lowerTags=new Set(this._tags.map((e=>e.toLowerCase()))),this._next=null)}Release(){this._keyframeData=null,C3$jscomp$109.clearArray(this._tags),this._tags=null,this._lowerTags.clear(),this._lowerTags=null}GetKeyframeData(){return this._keyframeData}GetNext(){return this._next}SetNext(e){this._next=e}GetTime(){return this._time}SetTime(e){this._time=e,this._keyframeData._LinkKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetTags(){return this._tags}SetTags(e){this._tags=e?e.split(" "):[],this._lowerTags=new Set(this._tags.map((e=>e.toLowerCase())))}GetLowerTags(){return this._lowerTags}HasTag(e){return this._lowerTags.has(e.toLowerCase())}_SaveToJson(){return{time:this._time,ease:this._ease,enable:this._enable,tags:this._tags}}_LoadFromJson(e){e&&(this._time=e.time,this._ease=e.ease,this._enable=e.enable,this._tags=e.tags,this._lowerTags=new Set(this._tags.map((e=>e.toLowerCase()))))}}C3$jscomp$109.KeyframeData=class{constructor(e,t){this._trackDataItem=t,this._keyframeDataItems=[],C3$jscomp$109.TimelineDataManager._CreateDataItems(this._keyframeDataItems,e,KeyframeDataItem,this),this._LinkKeyframeDataItems()}Release(){this._trackDataItem=null;for(const e of this._keyframeDataItems)e.Release();C3$jscomp$109.clearArray(this._keyframeDataItems),this._keyframeDataItems=null}_LinkKeyframeDataItems(){this._keyframeDataItems.sort(((e,t)=>e.GetTime()-t.GetTime()));for(let e=0;e<this._keyframeDataItems.length;e++)this._keyframeDataItems[e].SetNext(this._keyframeDataItems[e+1])}GetTrackDataItem(){return this._trackDataItem}GetKeyframeDataItemCount(){return this._keyframeDataItems.length}GetKeyframeDataItemArray(){return this._keyframeDataItems}AddEmptyKeyframeDataItem(){const e=new KeyframeDataItem(null,this);return this._keyframeDataItems.push(e),this._LinkKeyframeDataItems(),e}DeleteKeyframeDataItems(e){for(const t of this._keyframeDataItems){if(!e(t))continue;const s=this._keyframeDataItems.indexOf(t);-1!==s&&(t.Release(),this._keyframeDataItems.splice(s,1))}this.SortKeyframeDataItems(),this._LinkKeyframeDataItems()}SortKeyframeDataItems(){this._keyframeDataItems.sort(((e,t)=>e.GetTime()-t.GetTime()))}GetKeyframeDataItemIndex(e){return this._keyframeDataItems.indexOf(e)}GetKeyframeDataItemFromIndex(e){return this._keyframeDataItems[e]}*keyframeDataItems(){for(const e of this._keyframeDataItems)yield e}*keyframeDataItemsReverse(){for(let e=this._keyframeDataItems.length-1;0<=e;e--)yield this._keyframeDataItems[e]}_SaveToJson(){return{keyframeDataItemsJson:this._keyframeDataItems.map((e=>e._SaveToJson()))}}_LoadFromJson(e){e&&(C3$jscomp$109.TimelineDataManager._LoadDataItemsFromJson(this._keyframeDataItems,e.keyframeDataItemsJson,KeyframeDataItem,this),this._LinkKeyframeDataItems())}};const C3$jscomp$110=self.C3;class PropertyKeyframeDataItem{constructor(e,t){this._propertyKeyframeData=t,this._aValue=this._value=null,this._type="",this._time=NaN,this._ease="noease",this._enable=!1,this._addonData=null,this._addonInstance=void 0,e&&(this._value=e[0][0],this._aValue=e[0][1],this._type=e[0][2],this._time=e[1],this._ease=e[2],this._enable=!!e[3],this._addonData=null,e[4]&&(this._addonData=new C3$jscomp$110.AddonData(e[4],this)),this._next=null)}Release(){this._propertyKeyframeData=null,this._addonData&&(this._addonData.Release(),this._addonData=null)}GetAddonData(){return this._addonData}SetNext(e){this._next=e}GetNext(){return this._next}GetValue(){return this._value}SetValue(e){"color"===this._type&&C3$jscomp$110.IsFiniteNumber(e)?(this._value[0]=C3$jscomp$110.GetRValue(e),this._value[1]=C3$jscomp$110.GetGValue(e),this._value[2]=C3$jscomp$110.GetBValue(e)):this._value=e}GetAbsoluteValue(){return this._aValue}SetAbsoluteValue(e){"color"===this._type&&C3$jscomp$110.IsFiniteNumber(e)?(this._aValue[0]=C3$jscomp$110.GetRValue(e),this._aValue[1]=C3$jscomp$110.GetGValue(e),this._aValue[2]=C3$jscomp$110.GetBValue(e)):this._aValue=e}GetValueWithResultMode(){const e=this._propertyKeyframeData.GetPropertyTrackDataItem().GetResultMode();return"relative"===e?this.GetValue():"absolute"===e?this.GetAbsoluteValue():void 0}GetType(){return this._type}SetType(e){this._type=e}GetTime(){return this._time}SetTime(e){this._time=e,this._propertyKeyframeData._LinkPropertyKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetAddOn(e){if(this._addonData){if(this._addonInstance||null===this._addonInstance)return this._addonInstance;var t=this._addonData.GetAddDataItemArray();if(!t)return this._addonInstance=null;var s=t.length;for(let i=0;i<s;i++){const s=t[i];if(s.GetId()===e)return this._addonInstance=s}return this._addonInstance=null}}_SaveToJson(){const e=this._addonData;return{addonDataJson:e?e._SaveToJson():e,value:this._value,aValue:this._aValue,type:this._type,time:this._time,ease:this._ease,enable:this._enable}}_LoadFromJson(e){e&&(e.addonDataJson&&this._addonData._SetFromJson(e.addonDataJson),this._value=e.value,this._aValue=e.aValue,this._type=e.type,this._time=e.time,this._ease=e.ease,this._enable=e.enable)}}C3$jscomp$110.PropertyKeyframeData=class{constructor(e,t){this._propertyTrackDataItem=t,this._propertyKeyframeDataItems=[],C3$jscomp$110.TimelineDataManager._CreateDataItems(this._propertyKeyframeDataItems,e,PropertyKeyframeDataItem,this),this._LinkPropertyKeyframeDataItems()}Release(){this._propertyTrackDataItem=null;for(const e of this._propertyKeyframeDataItems)e.Release();C3$jscomp$110.clearArray(this._propertyKeyframeDataItems),this._propertyKeyframeDataItems=null}_LinkPropertyKeyframeDataItems(){this._propertyKeyframeDataItems.sort(((e,t)=>e.GetTime()-t.GetTime()));for(let e=0;e<this._propertyKeyframeDataItems.length;e++)this._propertyKeyframeDataItems[e].SetNext(this._propertyKeyframeDataItems[e+1])}AddEmptyPropertyKeyframeDataItem(){const e=new PropertyKeyframeDataItem(null,this);return this._propertyKeyframeDataItems.push(e),this._LinkPropertyKeyframeDataItems(),e}DeletePropertyKeyframeDataItems(e){for(const t of this._propertyKeyframeDataItems){if(!e(t))continue;const s=this._propertyKeyframeDataItems.indexOf(t);-1!==s&&(t.Release(),this._propertyKeyframeDataItems.splice(s,1))}this.SortPropertyKeyFrameDataItems(),this._LinkPropertyKeyframeDataItems()}SortPropertyKeyFrameDataItems(){this._propertyKeyframeDataItems.sort(((e,t)=>e.GetTime()-t.GetTime()))}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyKeyframeDataItemCount(){return this._propertyKeyframeDataItems.length}GetLastPropertyKeyframeDataItem(){return this._propertyKeyframeDataItems[this._propertyKeyframeDataItems.length-1]}GetPropertyKeyframeDataItemArray(){return this._propertyKeyframeDataItems}*propertyKeyframeDataItems(){for(const e of this._propertyKeyframeDataItems)yield e}*propertyKeyframeDataItemsReverse(){for(let e=this._propertyKeyframeDataItems.length-1;0<=e;e--)yield this._propertyKeyframeDataItems[e]}_SaveToJson(){return{propertyKeyframeDataItemsJson:this._propertyKeyframeDataItems.map((e=>e._SaveToJson()))}}_LoadFromJson(e){e&&(C3$jscomp$110.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItems,e.propertyKeyframeDataItemsJson,PropertyKeyframeDataItem,this),this._LinkPropertyKeyframeDataItems())}};const C3$jscomp$111=self.C3;class AddonDataItem{constructor(e,t){this._addonData=t,this._id=e[0],this._data=e[1]}Release(){this._data=this._addonData=null}GetAddonData(){return this._addonData}GetId(){return this._id}_SaveToJson(){return{id:this._id,data:this._data}}_LoadFromJson(e){e&&(this._id=e.id,this._data=e.data)}}class AddonDataCubicBezierItem extends AddonDataItem{constructor(e,t){super(e,t),this._startAnchor=this._data[0],this._startEnable=!!this._data[1],this._endAnchor=this._data[2],this._endEnable=!!this._data[3]}Release(){super.Release()}GetStartAnchor(){return this._startAnchor}GetStartEnable(){return this._startEnable}GetEndAnchor(){return this._endAnchor}GetEndEnable(){return this._endEnable}_SaveToJson(){return Object.assign(super._SaveToJson(),{startAnchor:this._startAnchor,startEnable:!!this._startEnable,endAnchor:this._endAnchor,endEnable:!!this._endEnable})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._startAnchor=e.startAnchor,this._startEnable=!!e.startEnable,this._endAnchor=e.endAnchor,this._endEnable=!!e.endEnable)}}class AddonDataAngleItem extends AddonDataItem{constructor(e,t){super(e,t),this._direction=this._data[0],this._revolutions=this._data[1]}Release(){super.Release()}GetDirection(){return this._direction}GetRevolutions(){return this._revolutions}_SaveToJson(){return Object.assign(super._SaveToJson(),{direction:this._direction,revolutions:this._revolutions})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._direction=e.direction,this._revolutions=e.revolutions)}}C3$jscomp$111.AddonData=class{constructor(e,t){this._propertyKeyframeDataItem=t,this._addonDataItems=[],C3$jscomp$111.TimelineDataManager._CreateDataItems(this._addonDataItems,e,{prop:0,map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this)}Release(){this._propertyKeyframeDataItem=null;for(const e of this._addonDataItems)e.Release();C3$jscomp$111.clearArray(this._addonDataItems),this._addonDataItems=null}GetPropertyKeyframeDataItem(){return this._propertyKeyframeDataItem}GetAddDataItemArray(){return this._addonDataItems}*addonDataItems(){for(const e of this._addonDataItems)yield e}_SaveToJson(){return{addonDataItemsJson:this._addonDataItems.map((e=>e._SaveToJson()))}}_LoadFromJson(e){e&&C3$jscomp$111.TimelineDataManager._LoadDataItemsFromJson(this._addonDataItems,e.addonDataItemsJson,{prop:"id",map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this)}};const C3$jscomp$112=self.C3;let createdTweens=0;C3$jscomp$112.TweenState=class extends C3$jscomp$112.TimelineState{constructor(e,t){super("tween-"+createdTweens++,e,t),this._id="",this._destroyInstanceOnComplete=!1,this._initialValueMode="start-value",this._iTweenState=this._track=this._on_started_callbacks=this._on_completed_callbacks=this._instance=null}FireReleaseEvent(e){const t=C3$jscomp$112.New(C3$jscomp$112.Event,"tweenstatereleased");t.tweenState=this,e.dispatchEvent(t)}GetType(){return 1}CreateTrackStates(){for(const e of this._timelineDataItem.GetTrackData().trackDataItems())this._tracks.push(C3$jscomp$112.TweenTrackState.Create(this,e));this._track=this._tracks[0]}AddTrack(){var e=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem();return e=C3$jscomp$112.TweenTrackState.Create(this,e),this._tracks.push(e),this._track=this._tracks[0],e}GetPropertyTrack(e){return this._track.GetPropertyTracks()[0]}SetPropertyType(e){this._propertyType=e}GetInstance(){var e=this.GetTracks();if(e&&e.length&&(this._track=e=e[0])){var t=e.GetInstance();return e.IsInstanceValid()?t:void 0}}AddStartedCallback(e){this._on_started_callbacks||(this._on_started_callbacks=[]),this._on_started_callbacks.push(e)}AddCompletedCallback(e){this._on_completed_callbacks||(this._on_completed_callbacks=[]),this._on_completed_callbacks.push(e)}RemoveStartedCallback(e){this._on_started_callbacks&&(-1!==(e=this._on_started_callbacks.indexOf(e))&&this._on_started_callbacks.splice(e,1))}RemoveCompletedCallback(e){this._on_completed_callbacks&&(-1!==(e=this._on_completed_callbacks.indexOf(e))&&this._on_completed_callbacks.splice(e,1))}SetStartValue(e,t){for(const i of this._tracks)for(const r of i._propertyTracks){if(r.GetPropertyName()!==t)continue;var s=r.GetPropertyTrackData();const i=r.GetPropertyTrackDataItem();(s=s.GetFirstPropertyKeyframeDataItem(i)).SetValue(e),s.SetAbsoluteValue(e)}}_GetPropertyTrackState(e){for(const t of this._tracks)for(const s of t._propertyTracks)if(s.GetPropertyName()===e)return s}BeforeSetEndValues(e){for(const t of e)e=this._GetPropertyTrackState(t),this.SetStartValue(e.GetCurrentState(),t);if(this.IsForwardPlayBack()){var t=this.GetTotalTime()-this.GetTime();for(var s of(this.SetTotalTime(t),this._tracks))s.SetLocalTotalTime(t);this._SetTime(0)}else{for(t of(s=this.GetTime(),this.SetTotalTime(s),this._tracks))t.SetLocalTotalTime(s);this._SetTime(s)}this.SetInitialStateFromSetTime()}SetEndValue(e,t){var s=this._GetPropertyTrackState(t);t=s.GetPropertyTrackData(),s=s.GetPropertyTrackDataItem(),(t=t.GetLastPropertyKeyframeDataItem(s)).SetTime(this.GetTotalTime()),t.SetValue(e),t.SetAbsoluteValue(e)}SetId(e){this._id=e}GetId(){return this._id}SetInitialValueMode(e){this._initialValueMode=e}GetInitialValueMode(){return this._initialValueMode}SetDestroyInstanceOnComplete(e){this._destroyInstanceOnComplete=e}GetDestroyInstanceOnComplete(){return this._destroyInstanceOnComplete}OnStarted(){if(this._on_started_callbacks)for(const e of this._on_started_callbacks)e(this);if(!this.IsComplete())for(const e of this._tracks)e.CompareSaveStateWithCurrent()}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){if(!this._finishedTriggers&&(this._finishedTriggers=!0,this._on_completed_callbacks))for(const e of this._on_completed_callbacks)e(this)}SetTime(e){this._DeleteIntermediateKeyframes(),super.SetTime(e)}_SetTimeAndReset(e){C3$jscomp$112.IsFiniteNumber(e)||(e=this.GetTotalTime()),0>e?this._playheadTime=0:e>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=e,this._track.SetResetState()}SetInitialState(e){if(!this.InitialStateSet()&&"current-state"===this.GetInitialValueMode())for(const e of this._tracks)e.CompareInitialStateWithCurrent();super.SetInitialState(e)}Stop(e=!1){if(super.Stop(e),!this.IsComplete())for(const e of this._tracks)e.SaveState()}Reset(e=!0,t=!1){this._DeleteIntermediateKeyframes(),super.Reset(e,t)}_DeleteIntermediateKeyframes(){for(const e of this._tracks){const t=e=>{e=e.GetTime();const t=this.GetTotalTime();return 0!==e&&e!==t};e.DeleteKeyframes(t),e.DeletePropertyKeyframes(t)}}_OnBeforeChangeLayout(){if(this.IsReleased())return!0;const e=this.GetInstance();return(!e||!e.GetObjectClass().IsGlobal())&&(this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this),this.ResetBeforeChangeLayout(),!0)}Tick(e,t,s){if(this._instance||(this._instance=this.GetInstance()),!this._instance||this._instance.IsDestroyed())this.Stop(!0),this.OnCompleted();else if(-1!==(t=this._instance.GetTimeScale())&&(e=s*t),0!==e||0!==this._lastDelta){this._lastDelta=e,s=this._playheadTime+e*this._playbackRate,e=this._timelineDataItem._totalTime,this._playheadTime=0>s?0:s>=e?e:s,t=s=!1;var i=this.GetLoop(),r=this.GetPingPong();i||r?i&&!r?0<this._playbackRate?this._playheadTime>=e&&(this._SetTimeAndReset(0),t=!0):0>=this._playheadTime&&(this._SetTimeAndReset(e),t=!0):!i&&r?0<this._playbackRate?this._playheadTime>=e&&(this._SetTime(e),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=0):s=!0:0===this._pingPongState&&(this._pingPongState=1)):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=0):s=!0:0===this._pingPongState&&(this._pingPongState=1)):i&&r&&(0<this._playbackRate?this._playheadTime>=e&&(this._SetTime(e),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState++,C3$jscomp$112.wrap(this._pingPongState,0,2)):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState++,C3$jscomp$112.wrap(this._pingPongState,0,2))):0<this._playbackRate?this._playheadTime>=e&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(0),t=!0):(this._SetTime(e),s=!0)):0>=this._playheadTime&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(e),t=!0):(this._SetTime(0),s=!0)),s?(this._track.SetEndState(),this.Stop(!0),this.OnCompleted()):(this._track.Interpolate(this._playheadTime,!0,!1,t,this._firstTick,!1),this._firstTick&&(this._firstTick=!1))}}_SaveToJson(){const e=super._SaveToJson(),t=this.GetTimelineDataItem();return Object.assign(e,{tweenDataItemJson:t._SaveToJson(),id:this._id,destroyInstanceOnComplete:this._destroyInstanceOnComplete,initialValueMode:this._initialValueMode})}_LoadFromJson(e){e&&(this.GetTimelineDataItem()._LoadFromJson(e.tweenDataItemJson),super._LoadFromJson(e),this._id=e.id,this._destroyInstanceOnComplete=e.destroyInstanceOnComplete,this._initialValueMode=e.initialValueMode)}static IsPlaying(e){return e.IsPlaying()}static IsPaused(e){return e.IsPaused()}static Build(e){var t=e.runtime.GetTimelineManager(),s=new C3$jscomp$112.TimelineDataItem;if(e.json){s._LoadFromJson(e.json.tweenDataItemJson);var i=new C3$jscomp$112.TweenState(s,t);return i._LoadFromJson(e.json),i}t=new C3$jscomp$112.TweenState(s,t),C3$jscomp$112.IsArray(e.propertyTracksConfig)||(e.propertyTracksConfig=[e.propertyTracksConfig]),t.SetId(e.id),t.SetTags(e.tags),t.SetInitialValueMode(e.initialValueMode),t.SetDestroyInstanceOnComplete(e.releaseOnComplete),t.SetLoop(e.loop),t.SetPingPong(e.pingPong),t.SetTotalTime(e.time),t.SetStep(0),t.SetInterpolationMode("default"),t.SetResultMode(e.propertyTracksConfig[0].resultMode),t.SetRepeatCount(e.repeatCount),(s=t.AddTrack()).SetInstanceUID(e.instance.GetUID()),s.SetInterpolationMode("default"),s.SetResultMode(e.propertyTracksConfig[0].resultMode),s.SetEnable(!0),s.SetObjectClassIndex(e.instance.GetObjectClass().GetIndex());var r=e.instance.GetSdkInstance(),n=r.IsOriginalSizeKnown()?r.GetOriginalWidth():e.instance.GetWorldInfo().GetWidth();for(i of(r=r.IsOriginalSizeKnown()?r.GetOriginalHeight():e.instance.GetWorldInfo().GetHeight(),s.SetOriginalWidth(n),s.SetOriginalHeight(r),(n=s.AddKeyframe()).SetTime(0),n.SetEase("noease"),n.SetEnable(!0),n.SetTags(""),(n=s.AddKeyframe()).SetTime(e.time),n.SetEase("noease"),n.SetEnable(!0),n.SetTags(""),e.propertyTracksConfig))(n=s.AddPropertyTrack()).SetSourceAdapterId(i.sourceId),n.SetSourceAdapterArgs(i.sourceArgs),n.SetPropertyName(i.property),n.SetPropertyType(i.type),n.SetMin(NaN),n.SetMax(NaN),n.SetInterpolationMode("default"),n.SetResultMode(i.resultMode),n.SetEnable(!0),(r=n.AddPropertyKeyframe()).SetType(i.valueType),r.SetTime(0),r.SetEase(i.ease),r.SetEnable(!0),r.SetValue(i.startValue),r.SetAbsoluteValue(i.startValue),(r=n.AddPropertyKeyframe()).SetType(i.valueType),r.SetTime(e.time),r.SetEase(i.ease),r.SetEnable(!0),r.SetValue(i.endValue),r.SetAbsoluteValue(i.endValue),n.GetSourceAdapter();return t}GetITweenState(e,t){return this._iTweenState||(this._iTweenState=C3$jscomp$112.New(self.ITweenState,this,e,t)),this._iTweenState}};const C3$jscomp$113=self.C3;C3$jscomp$113.TweenTrackState=class extends C3$jscomp$113.TrackState{constructor(e,t){super(e,t),this._secondPropertyTrack=this._firstPropertyTrack=null}static Create(e,t){return C3$jscomp$113.New(C3$jscomp$113.TweenTrackState,e,t)}_CachePropertyTracks(){1===this._propertyTracks.length?this._firstPropertyTrack=this._propertyTracks[0]:(this._firstPropertyTrack=this._propertyTracks[0],this._secondPropertyTrack=this._propertyTracks[1])}CreatePropertyTrackStates(){for(const e of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(C3$jscomp$113.TweenPropertyTrackState.Create(this,e));this._CachePropertyTracks()}AddPropertyTrack(){var e=this._trackDataItem.GetPropertyTrackData().AddEmptyPropertyTrackDataItem();return e=C3$jscomp$113.TweenPropertyTrackState.Create(this,e),this._propertyTracks.push(e),this._CachePropertyTracks(),e}SetInitialState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){var e=this.GetTimeline().IsForwardPlayBack()?0:this.GetLocalTotalTime();for(const t of this._propertyTracks)t.SetInitialState(e),0===this._worldInfoChange&&1===t.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===t.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0,this._propertyTracks.some((e=>e.GetNeedsBeforeAndAfter()))&&(this._needsBeforeAndAfter=1),this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(e),this._endStateOfNestedSet=this._initialStateOfNestedSet=!1,this.Interpolate(e)}}BeforeInterpolate(){}Interpolate(e,t,s=!1,i=!1,r,n=!1,a=!1){if(this._instance||this.GetInstance(),this._instance){if(this._instance.IsDestroyed()||n&&this.GetObjectClass().IsGlobal())return!1;this._secondPropertyTrack?(this._firstPropertyTrack.Interpolate(e,s,i,a),this._secondPropertyTrack.Interpolate(e,s,i,a)):this._firstPropertyTrack.Interpolate(e,s,i,a),0!==this._firstPropertyTrack.GetWorldInfoChange()&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo&&this._worldInfo.SetBboxChanged())}}AfterInterpolate(){}_LoadFromJson(e){super._LoadFromJson(e),this._CachePropertyTracks()}};const C3$jscomp$114=self.C3;C3$jscomp$114.TweenPropertyTrackState=class extends C3$jscomp$114.PropertyTrackState{constructor(e,t){super(e,t),this._basic=!1}static Create(e,t){return C3$jscomp$114.New(C3$jscomp$114.TweenPropertyTrackState,e,t)}Interpolate(e,t=!1,s=!1,i=!1){if(this._basic)var r=this._propertyKeyframeDataItems[0],n=this._propertyKeyframeDataItems[1];else{if(t)r=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){n=this.GetTimeline();const t=this._lastPropertyKeyframeDataItem.GetNext();r=this._lastPropertyKeyframeDataItem.GetTime(),n=t?t.GetTime():n.GetTotalTime(),(e<=r||e>=n)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);r=this._lastPropertyKeyframeDataItem}n=r.GetNext()}this._sourceAdapter.Interpolate(e,r,n,t,s,i)}AddPropertyKeyframe(){const e=this._propertyTrackDataItem.GetPropertyKeyframeData().AddEmptyPropertyKeyframeDataItem();return this._lastPropertyKeyframeDataItem=null,this._basic=2>=this.GetPropertyKeyframeDataItems().length,e}DeletePropertyKeyframes(e){this._lastPropertyKeyframeDataItem=null,this._propertyTrackDataItem.GetPropertyKeyframeData().DeletePropertyKeyframeDataItems(e),this._basic=2>=this.GetPropertyKeyframeDataItems().length}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson(),basic:this._basic}}_LoadFromJson(e){e&&(this.GetSourceAdapter()._LoadFromJson(e.sourceAdapterJson),this._basic=e.basic)}};const C3$jscomp$115=self.C3,Ease$jscomp$2=self.Ease;C3$jscomp$115.Transition=class extends C3$jscomp$115.DefendedBase{constructor(e,t=!0){for(var s of(super(),this._name=e[0],this._linear=!1,this._transitionKeyframes=[],e[1]))e=C3$jscomp$115.TransitionKeyframe.Create(this,s),this._transitionKeyframes.push(e);for(s=0;s<this._transitionKeyframes.length;s++)this._transitionKeyframes[s].SetNext(this._transitionKeyframes[s+1]);this._precalculatedSamples=new Map,this._transitionKeyframeCache=new Map,this._PreCalcSamples(),t&&Ease$jscomp$2.AddCustomEase(this._name,((e,t,s,i)=>this.Interpolate(e,t,s,i)))}static Create(e){return C3$jscomp$115.New(C3$jscomp$115.Transition,e)}Release(){for(const e of this._transitionKeyframes)e.Release();C3$jscomp$115.clearArray(this._transitionKeyframes),this._transitionKeyframes=null,this._precalculatedSamples.clear(),this._precalculatedSamples=null,this._transitionKeyframeCache.clear(),this._transitionKeyframeCache=null}MakeLinear(e){this._linear=!!e}GetTransitionKeyFrameAt(e){const t=this._transitionKeyframeCache.get(e);if(t)return t;for(const t of this._transitionKeyframes)if(t.GetValueX()===e)return this._transitionKeyframeCache.set(e,t),t}GetFirstTransitionKeyFrameHigherThan(e){for(const t of this._transitionKeyframes)if(t.GetValueX()>e)return t}GetFirstTransitionKeyFrameHigherOrEqualThan(e){for(const t of this._transitionKeyframes)if(t.GetValueX()>=e)return t}GetFirstTransitionKeyFrameLowerThan(e){for(let t=this._transitionKeyframes.length-1;0<=t;t--){const s=this._transitionKeyframes[t];if(s.GetValueX()<e)return s}}GetFirstTransitionKeyFrameLowerOrEqualThan(e){for(let t=this._transitionKeyframes.length-1;0<=t;t--){const s=this._transitionKeyframes[t];if(s.GetValueX()<=e)return s}}Interpolate(e,t,s,i){if(this._linear)return Ease$jscomp$2.NoEase(e,t,s,i);var r=e/i;(i=(e=this.GetFirstTransitionKeyFrameLowerOrEqualThan(r)).GetNext())||(i=(e=this.GetFirstTransitionKeyFrameLowerThan(r)).GetNext());var n=i.GetValueX()-e.GetValueX();r=C3$jscomp$115.mapToRange(r,e.GetValueX(),i.GetValueX(),0,n),n=e.GetValueX();const a=e.GetValueY(),o=e.GetValueX()+e.GetStartAnchorX(),h=e.GetValueY()+e.GetStartAnchorY(),l=i.GetValueX()+i.GetEndAnchorX(),c=i.GetValueY()+i.GetEndAnchorY(),u=i.GetValueX();return i=i.GetValueY(),i=Ease$jscomp$2.GetRuntimeEase("spline")(r,n,a,o,h,l,c,u,i,this._precalculatedSamples.get(e)),(1-(i+=e.GetValueY()))*t+i*(t+s)}_PreCalcSamples(){this._precalculatedSamples.clear();for(let s=0;s<this._transitionKeyframes.length-1;s++){var e=this._transitionKeyframes[s];if(!e.GetStartEnable())continue;var t=this._transitionKeyframes[s+1];const i=e.GetValueX(),r=e.GetValueX()+e.GetStartAnchorX(),n=t.GetValueX()+t.GetEndAnchorX();t=t.GetValueX(),this._precalculatedSamples.set(e,Ease$jscomp$2.GetBezierSamples(i,r,n,t))}}};const C3$jscomp$116=self.C3;C3$jscomp$116.TransitionKeyframe=class extends C3$jscomp$116.DefendedBase{constructor(e,t){super(),this._transition=e,this._valueX=t[0],this._valueY=t[1],this._startAnchorX=t[2],this._startAnchorY=t[3],this._endAnchorX=t[4],this._endAnchorY=t[5],this._startEnable=t[6],this._endEnable=t[7],this._next=null}Release(){this._transition=null}static Create(e,t){return C3$jscomp$116.New(C3$jscomp$116.TransitionKeyframe,e,t)}SetNext(e){this._next=e}GetNext(){return this._next}GetValueX(){return this._valueX}GetValueY(){return this._valueY}GetStartAnchorX(){return this._startAnchorX}GetStartAnchorY(){return this._startAnchorY}GetEndAnchorX(){return this._endAnchorX}GetEndAnchorY(){return this._endAnchorY}GetStartEnable(){return this._startEnable}GetEndEnable(){return this._endEnable}};const C3$jscomp$117=self.C3;C3$jscomp$117.TransitionManager=class extends C3$jscomp$117.DefendedBase{constructor(e){super(),this._runtime=e,this._transitions=[]}Release(){for(const e of this._transitions)e.Release();C3$jscomp$117.clearArray(this._transitions),this._transitions=null}Create(e){this._transitions.push(C3$jscomp$117.Transition.Create(e))}};const C3$jscomp$118=self.C3;C3$jscomp$118.TemplateManager=class extends C3$jscomp$118.DefendedBase{constructor(e){super(),this._runtime=e,this._instanceToTemplateNameMap=this._templateDataMap=null,this._instanceDestroy=e=>this._OnInstanceDestroy(e.instance)}Release(){if(this.RemoveRuntimeListeners(),this._templateDataMap){for(const e of this._templateDataMap.values())e.clear();this._templateDataMap.clear()}this._runtime=this._templateDataMap=null}Create(e){if(this._templateDataMap||(this._templateDataMap=new Map),e){var t=e[0][16][0],s=e[1];this._templateDataMap.has(s)||this._templateDataMap.set(s,new Map),this._templateDataMap.get(s).set(t,e)}}AddRuntimeListeners(){const e=this._runtime.Dispatcher();e&&e.addEventListener("instancedestroy",this._instanceDestroy)}RemoveRuntimeListeners(){const e=this._runtime.Dispatcher();e&&e.removeEventListener("instancedestroy",this._instanceDestroy)}HasTemplates(){return!!this._templateDataMap&&0!==this._templateDataMap.size}GetTemplateData(e,t){if(e=e instanceof C3$jscomp$118.ObjectClass?e.GetIndex():e,this._templateDataMap.has(e)&&(t=this._templateDataMap.get(e).get(t)))return JSON.parse(JSON.stringify(t))}MapInstanceToTemplateName(e,t){this._instanceToTemplateNameMap||(this._instanceToTemplateNameMap=new WeakMap),this._instanceToTemplateNameMap.has(e)||this._instanceToTemplateNameMap.set(e,t)}GetInstanceTemplateName(e){return this._instanceToTemplateNameMap&&(e=this._instanceToTemplateNameMap.get(e))?e:""}_OnInstanceDestroy(e){this._instanceToTemplateNameMap&&this._instanceToTemplateNameMap.has(e)&&this._instanceToTemplateNameMap.delete(e)}};const C3$jscomp$119=self.C3;C3$jscomp$119.SolStack=class extends C3$jscomp$119.DefendedBase{constructor(e){super(),this._objectClass=e,this._stack=[],this._stack.push(C3$jscomp$119.New(C3$jscomp$119.Sol,this)),this._index=0,this._current=this._stack[0]}Release(){for(const e of this._stack)e.Release();C3$jscomp$119.clearArray(this._stack),this._objectClass=this._current=null}GetObjectClass(){return this._objectClass}GetCurrentSol(){return this._current}Clear(){this.GetCurrentSol().Clear()}PushClean(){var e=this._stack,t=++this._index;t===e.length?(t=C3$jscomp$119.New(C3$jscomp$119.Sol,this),e.push(t),this._current=t):((e=e[t]).Reset(),this._current=e)}PushCopy(){const e=this._stack,t=++this._index;t===e.length&&e.push(C3$jscomp$119.New(C3$jscomp$119.Sol,this));const s=e[t];s.Copy(e[t-1]),this._current=s}Pop(){this._current=this._stack[--this._index]}RemoveInstances(e){const t=this._stack;for(let s=0,i=t.length;s<i;++s)t[s].RemoveInstances(e)}};const C3$jscomp$120=self.C3;C3$jscomp$120.Sol=class extends C3$jscomp$120.DefendedBase{constructor(e){super(),this._stack=e,this._objectClass=this._stack.GetObjectClass(),this._eventStack=this._objectClass.GetRuntime().GetEventStack(),this._selectAll=!0,this._instances=[],this._elseInstances=[]}Release(){this.ClearArrays(),this._eventStack=this._objectClass=this._stack=null}ClearArrays(){C3$jscomp$120.clearArray(this._instances),C3$jscomp$120.clearArray(this._elseInstances)}GetObjectClass(){return this._objectClass}IsSelectAll(){return this._selectAll}HasAnyInstances(){return this._selectAll?!!this._objectClass.GetInstanceCount():!!this._instances.length}GetInstances(){return this._selectAll?this._objectClass.GetInstances():this._instances}HasAnyElseInstances(){return!!this._elseInstances.length}GetElseInstances(){return this._elseInstances}GetExpressionInstances(){const e=this.GetInstances();return e.length?e:this._elseInstances}Reset(){this._selectAll=!0,C3$jscomp$120.clearArray(this._elseInstances)}Clear(){this._selectAll=!0}Copy(e){e.IsSelectAll()?this.Reset():(this._selectAll=!1,C3$jscomp$120.shallowAssignArray(this._instances,e._instances),C3$jscomp$120.clearArray(this._elseInstances))}_PushInstance(e){this._instances.push(e)}_PushElseInstance(e){this._elseInstances.push(e)}_SetSelectAll(e){this._selectAll=!!e}_GetOwnInstances(){return this._instances}_GetOwnElseInstances(){return this._elseInstances}SetSinglePicked(e){this._selectAll=!1,C3$jscomp$120.clearArray(this._instances),this._instances.push(e)}SetArrayPicked(e){this._selectAll=!1,C3$jscomp$120.shallowAssignArray(this._instances,e)}SetSetPicked(e){this._selectAll=!1,C3$jscomp$120.clearArray(this._instances);for(const t of e)this._instances.push(t)}AddElseInstances(e,t){for(const s of t)e.has(s)||this._elseInstances.push(s)}TransferElseInstancesToOwn(e){for(const t of e)this._instances.push(t);C3$jscomp$120.arrayRemoveAllInSet(this._elseInstances,e)}PickOne(e){e&&(this._eventStack.GetCurrentStackFrame().GetCurrentEvent().IsOrBlock()?(this.IsSelectAll()&&(C3$jscomp$120.clearArray(this._instances),C3$jscomp$120.shallowAssignArray(this._elseInstances,e.GetObjectClass().GetInstances()),this._selectAll=!1),-1!==(e=this._elseInstances.indexOf(e))&&(this._instances.push(this._elseInstances[e]),this._elseInstances.splice(e,1))):this.SetSinglePicked(e))}RemoveInstances(e){C3$jscomp$120.arrayRemoveAllInSet(this._instances,e),C3$jscomp$120.arrayRemoveAllInSet(this._elseInstances,e)}};const C3$jscomp$121=self.C3;C3$jscomp$121.EventStack=class extends C3$jscomp$121.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._stack.push(C3$jscomp$121.New(C3$jscomp$121.EventStackFrame,this,null)),this._index=0,this._expFuncStack=[]}Release(){for(const e of this._stack)e.Release();C3$jscomp$121.clearArray(this._stack),C3$jscomp$121.clearArray(this._expFuncStack),this._runtime=this._eventSheetManager=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrentStackFrame(){return this._stack[this._index]}Push(e){var t=this._stack;const s=++this._index;return s===t.length?(e=C3$jscomp$121.New(C3$jscomp$121.EventStackFrame,this,e),t.push(e),e):((t=t[s]).Reset(e),t)}Pop(){--this._index}PushExpFunc(e){this._expFuncStack.push(e)}PopExpFunc(){this._expFuncStack.pop()}GetCurrentExpFuncStackFrame(){const e=this._expFuncStack;return 0===e.length?null:e.at(-1)}};const C3$jscomp$122=self.C3;C3$jscomp$122.EventStackFrame=class extends C3$jscomp$122.DefendedBase{constructor(e,t){super(),this._stack=e,this._runtime=this._stack.GetRuntime(),this._currentEvent=t,this._actIndex=this._cndIndex=0,this._elseBranchRan=this._lastEventTrue=!1,this._expressionObjectClass=null,this._functionReturnValue=this._functionReturnType=0}Release(){this.Reset(null),this._runtime=this._stack=null}Reset(e){this._currentEvent=e,this._actIndex=this._cndIndex=0,this._elseBranchRan=this._lastEventTrue=!1}_Restore(e,t){this._currentEvent=e,this._cndIndex=0,this._actIndex=t}ResetQuick(){this._actIndex=this._cndIndex=0}GetCurrentEvent(){return this._currentEvent}SetCurrentEvent(e){this._currentEvent=e}GetConditionIndex(){return this._cndIndex}SetConditionIndex(e){this._cndIndex=e}GetActionIndex(){return this._actIndex}SetActionIndex(e){this._actIndex=e}SetLastEventTrue(e){this._lastEventTrue=!!e}GetLastEventTrue(){return this._lastEventTrue}SetElseBranchRan(e){this._elseBranchRan=!!e}GetElseBranchRan(){return this._elseBranchRan}SetExpressionObjectClass(e){this._expressionObjectClass=e}GetExpressionObjectClass(){return this._expressionObjectClass}InitCallFunctionExpression(e,t){this._functionReturnType=e,this._functionReturnValue=t}GetFunctionReturnType(){return this._functionReturnType}SetFunctionReturnValue(e){this._functionReturnValue=e}GetFunctionReturnValue(){return this._functionReturnValue}IsSolModifierAfterCnds(){const e=this._currentEvent;return!!e.IsSolWriterAfterCnds()||this._cndIndex<e.GetConditionCount()-1&&!!e.GetSolModifiers().length}};const C3$jscomp$123=self.C3;C3$jscomp$123.LocalVarStack=class extends C3$jscomp$123.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._index=-1,this._current=null,this._initialValues=[]}Release(){C3$jscomp$123.clearArray(this._stack),this._runtime=this._eventSheetManager=null}_SetInitialValues(e){this._initialValues=e,e=this._initialValues.slice(0),this._stack.push(e),this._index=0,this._current=e}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrent(){return this._current}Push(){const e=++this._index,t=this._stack;e===t.length?t.push(this._initialValues.slice(0)):C3$jscomp$123.shallowAssignArray(t[e],this._initialValues),this._current=t[e]}Pop(){this._current=this._stack[--this._index]}};const C3$jscomp$124=self.C3;C3$jscomp$124.LoopStack=class extends C3$jscomp$124.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._index=-1}Release(){C3$jscomp$124.clearArray(this._stack),this._runtime=this._eventSheetManager=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}IsInLoop(){return 0<=this._index}GetCurrent(){return this._stack[this._index]}Push(){if(++this._index,this._index===this._stack.length){var e=C3$jscomp$124.New(C3$jscomp$124.Loop,this);return this._stack.push(e),e}return(e=this._stack[this._index]).Reset(),e}Pop(){--this._index}FindByName(e){const t=this._stack;for(let s=this._index;0<=s;--s){const i=t[s];if(i.GetName()===e)return i}return null}_GetStack(){return this._stack.slice(0,this._index+1)}};const C3$jscomp$125=self.C3;C3$jscomp$125.Loop=class extends C3$jscomp$125.DefendedBase{constructor(e){super(),this._loopStack=e,this._name="",this._index=0,this._isStopped=!1,this._end=NaN}Reset(){this._name="",this._index=0,this._isStopped=!1,this._end=NaN}SetName(e){this._name=e}GetName(){return this._name}SetIndex(e){this._index=e}GetIndex(){return this._index}Stop(){this._isStopped=!0}IsStopped(){return this._isStopped}SetEnd(e){this._end=e}GetEnd(){return this._end}};const C3$jscomp$126=self.C3;C3$jscomp$126.ArrayStack=class extends C3$jscomp$126.DefendedBase{constructor(){super(),this._stack=[],this._index=-1}Release(){C3$jscomp$126.clearArray(this._stack)}GetCurrent(){return this._stack[this._index]}Push(){if(++this._index,this._index===this._stack.length){const e=[];return this._stack.push(e),e}return this._stack[this._index]}Pop(){--this._index}};const C3$jscomp$127=self.C3;function SortSolArray(e,t){return e.GetIndex()-t.GetIndex()}function IsSolArrayIdentical(e,t){for(let s=0,i=e.length;s<i;++s)if(e[s]!==t[s])return!1;return!0}C3$jscomp$127.EventSheetManager=class extends C3$jscomp$127.DefendedBase{constructor(e){super(),this._runtime=e,this._allSheets=[],this._sheetsByName=new Map,this._allGroups=[],this._groupsByName=new Map,this._blocksBySid=new Map,this._cndsBySid=new Map,this._actsBySid=new Map,this._allUniqueSolModifiers=new Map,this._eventVarsBySid=new Map,this._nextLocalVarIndex=0,this._allGlobalVars=[],this._allLocalVars=[],this._localVarInitialValues=[],this._functionBlocksByName=new Map,this._eventStack=C3$jscomp$127.New(C3$jscomp$127.EventStack,this),this._localVarStack=C3$jscomp$127.New(C3$jscomp$127.LocalVarStack,this),this._loopStack=C3$jscomp$127.New(C3$jscomp$127.LoopStack,this),this._triggersToPostInit=[],this._queuedTriggers=[],this._queuedDebugTriggers=[],this._blockFlushingDepth=this._executingTriggerDepth=this._runningEventsDepth=0,this._scheduledWaits=[],this._asyncActionPromises=[],self.c3_callFunction=(e,t)=>this._InvokeFunctionFromJS(e,t)}Release(){this.ClearAllScheduledWaits(),this._eventStack.Release(),this._eventStack=null,this._localVarStack.Release(),this._localVarStack=null,C3$jscomp$127.clearArray(this._queuedTriggers),C3$jscomp$127.clearArray(this._queuedDebugTriggers),this._runtime=null,C3$jscomp$127.clearArray(this._allSheets),this._sheetsByName.clear()}Create(e){e=C3$jscomp$127.New(C3$jscomp$127.EventSheet,this,e),this._allSheets.push(e),this._sheetsByName.set(e.GetName().toLowerCase(),e)}_AddTriggerToPostInit(e){this._triggersToPostInit.push(e)}_PostInit(){for(const e of this._functionBlocksByName.values())e._PostInit(!1);for(const e of this._allSheets)e._PostInit();for(const e of this._allSheets)e._UpdateDeepIncludes();for(const e of this._triggersToPostInit)e._PostInit(!1);C3$jscomp$127.clearArray(this._triggersToPostInit),this._localVarStack._SetInitialValues(this._localVarInitialValues)}GetRuntime(){return this._runtime}GetEventSheetByName(e){return this._sheetsByName.get(e.toLowerCase())||null}_RegisterGroup(e){this._allGroups.push(e),this._groupsByName.set(e.GetGroupName(),e)}_RegisterEventBlock(e){this._blocksBySid.set(e.GetSID(),e)}_RegisterCondition(e){this._cndsBySid.set(e.GetSID(),e)}_RegisterAction(e){this._actsBySid.set(e.GetSID(),e)}_RegisterFunctionBlock(e){this._functionBlocksByName.set(e.GetFunctionName().toLowerCase(),e)}_RegisterEventVariable(e){this._eventVarsBySid.set(e.GetSID(),e),e.IsGlobal()?this._allGlobalVars.push(e):this._allLocalVars.push(e)}_DeduplicateSolModifierList(e){2<=e.length&&e.sort(SortSolArray);let t=this._allUniqueSolModifiers.get(e.length);t||(t=[],this._allUniqueSolModifiers.set(e.length,t));for(let s=0,i=t.length;s<i;++s){const i=t[s];if(IsSolArrayIdentical(e,i))return i}return t.push(e),e}_GetNextLocalVarIndex(e){return this._localVarInitialValues.push(e.GetInitialValue()),this._nextLocalVarIndex++}GetEventStack(){return this._eventStack}GetCurrentEventStackFrame(){return this.GetEventStack().GetCurrentStackFrame()}GetCurrentEvent(){return this.GetCurrentEventStackFrame().GetCurrentEvent()}GetCurrentCondition(){const e=this.GetCurrentEventStackFrame();return e.GetCurrentEvent().GetConditionAt(e.GetConditionIndex())}GetCurrentAction(){const e=this.GetCurrentEventStackFrame();return e.GetCurrentEvent().GetActionAt(e.GetActionIndex())}GetLocalVarStack(){return this._localVarStack}GetLoopStack(){return this._loopStack}GetAllLocalVariablesInScope(e){const t=[];for(e=e.GetScopeParent();e;)C3$jscomp$127.appendArray(t,e._GetAllLocalVariablesInScope()),e=e.GetScopeParent();return t}_GetLocalVariablesScriptInterface(e){const t={};for(const s of this.GetAllLocalVariablesInScope(e))t[s.GetJsPropName()]=s._GetScriptInterfaceDescriptor();return Object.create(Object.prototype,t)}GetEventVariableBySID(e){return this._eventVarsBySid.get(e)||null}GetEventBlockBySID(e){return this._blocksBySid.get(e)||null}GetConditionBySID(e){return this._cndsBySid.get(e)||null}GetActionBySID(e){return this._actsBySid.get(e)||null}GetFunctionBlockByName(e){return this._functionBlocksByName.get(e.toLowerCase())||null}GetAllGlobalVariables(){return this._allGlobalVars}GetAllLocalVariables(){return this._allLocalVars}ResetAllGlobalsToInitialValue(){for(const e of this._allGlobalVars)e.ResetToInitialValue()}GetEventGroupByName(e){return this._groupsByName.get(e.toLowerCase())||null}GetEventGroupBySID(e){return(e=this._blocksBySid.get(e))&&e.IsGroup()?e:null}GetAllGroups(){return this._allGroups}ResetAllGroupsInitialActivation(){for(const e of this._allGroups)e.ResetInitialActivation()}_ResetAllHasRunFlags(){for(const e of this._allSheets)e._ResetHasRunFlag()}RunEvents(e){this._ResetAllHasRunFlags(),this._runningEventsDepth++;for(const t of e.runningLayouts())(e=t.GetEventSheet())&&(this._runtime.PushCurrentLayout(t),e.Run(),this._runtime.PopCurrentLayout());this._runningEventsDepth--}async DebugRunEvents(e){this._ResetAllHasRunFlags(),this._runningEventsDepth++;for(const t of this._DebugRunEventsGen(e))await this._runtime.DebugBreak(t);this._runningEventsDepth--}*_DebugRunEventsGen(e){for(const t of e.runningLayouts())(e=t.GetEventSheet())&&(this._runtime.PushCurrentLayout(t),yield*e.DebugRun(),this._runtime.PopCurrentLayout())}_Trigger(e,t,s,i){let r=!1;if(!e.GetMainRunningLayout())return this.QueueTrigger(t,s,i);this._executingTriggerDepth++;for(const n of e.runningLayouts())if(e=n.GetEventSheet()){this._runtime.PushCurrentLayout(n);for(const n of e.deepIncludes()){const e=n._Trigger(t,s,i);r=r||e}e=e._Trigger(t,s,i),r=r||e,this._runtime.PopCurrentLayout()}return this._executingTriggerDepth--,r}*_DebugTrigger(e,t,s,i){let r=!1;if(!e.GetMainRunningLayout())return this.QueueTrigger(t,s,i);this._executingTriggerDepth++;for(const n of e.runningLayouts())if(e=n.GetEventSheet()){this._runtime.PushCurrentLayout(n);for(const n of e.deepIncludes()){const e=yield*n._DebugTrigger(t,s,i);r=r||e}e=yield*e._DebugTrigger(t,s,i),r=r||e,this._runtime.PopCurrentLayout()}return this._executingTriggerDepth--,r}QueueTrigger(e,t,s){return this._queuedTriggers.push([e,t,s]),!1}QueueDebugTrigger(e,t,s){let i=null;const r=new Promise((e=>i=e));return this._queuedDebugTriggers.push([e,t,s,i]),r}*_RunQueuedDebugTriggersGen(){if(this._runtime.HitBreakpoint())throw Error("should not be in breakpoint");const e=this._runtime.GetLayoutManager();for(;this._queuedDebugTriggers.length;){const[t,s,i,r]=this._queuedDebugTriggers.shift();r(yield*this._DebugTrigger(e,t,s,i))}}async RunQueuedDebugTriggersAsync(){for(const e of this._RunQueuedDebugTriggersGen())await this._runtime.DebugBreak(e)}_FastTrigger(e,t,s,i){let r=!1;var n=e.GetMainRunningLayout();if(e=n.GetEventSheet()){this._executingTriggerDepth++,this._runtime.PushCurrentLayout(n);for(let a=0,o=(n=e.deepIncludes()).length;a<o;++a){const e=n[a]._FastTrigger(t,s,i);r=r||e}return t=e._FastTrigger(t,s,i),r=r||t,this._runtime.PopCurrentLayout(),this._executingTriggerDepth--,r}}*_DebugFastTrigger(e,t,s,i){let r=!1;var n=e.GetMainRunningLayout();if(e=n.GetEventSheet()){this._executingTriggerDepth++,this._runtime.PushCurrentLayout(n);for(let a=0,o=(n=e.deepIncludes()).length;a<o;++a){const e=yield*n[a]._DebugFastTrigger(t,s,i);r=r||e}return t=yield*e._DebugFastTrigger(t,s,i),r=r||t,this._runtime.PopCurrentLayout(),this._executingTriggerDepth--,r}}GetTriggerDepth(){return this._executingTriggerDepth}IsInTrigger(){return 0<this.GetTriggerDepth()}_IncTriggerDepth(){return++this._executingTriggerDepth}_DecTriggerDepth(){--this._executingTriggerDepth}IsRunningEvents(){return 0<this._runningEventsDepth}IsInEventEngine(){return this.IsRunningEvents()||this.IsInTrigger()}_RunQueuedTriggers(e){for(const[t,s,i]of this._queuedTriggers)this._Trigger(e,t,s,i);C3$jscomp$127.clearArray(this._queuedTriggers)}BlockFlushingInstances(e){e?this._blockFlushingDepth++:this._blockFlushingDepth--}IsFlushingBlocked(){return 0<this._blockFlushingDepth}ClearSol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().Clear()}PushCleanSol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().PushClean()}PushCopySol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().PushCopy()}PopSol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().Pop()}AddScheduledWait(){const e=C3$jscomp$127.New(C3$jscomp$127.ScheduledWait,this);return this._scheduledWaits.push(e),e}scheduledWaits(){return this._scheduledWaits}RunScheduledWaits(){if(this._scheduledWaits.length){var e=this.GetCurrentEventStackFrame(),t=!1;this._runningEventsDepth++;for(let s=0,i=this._scheduledWaits.length;s<i;++s){const i=this._scheduledWaits[s];i._ShouldRun()&&i._Run(e),i.ShouldRelease()&&(t=!0)}t&&(this._FilterScheduledWaitsToRelease(),e.Reset(null)),this._runningEventsDepth--}}async DebugRunScheduledWaits(){if(this._scheduledWaits.length){var e=this.GetCurrentEventStackFrame(),t=!1;this._runningEventsDepth++;for(let s=0,i=this._scheduledWaits.length;s<i;++s){const i=this._scheduledWaits[s];i._ShouldRun()&&await i._DebugRun(e),i.ShouldRelease()&&(t=!0)}t&&(this._FilterScheduledWaitsToRelease(),e.Reset(null)),this._runningEventsDepth--}}_FilterScheduledWaitsToRelease(){const e=C3$jscomp$127.arrayFilterOut(this._scheduledWaits,(e=>e.ShouldRelease()));for(const t of e)t.Release()}ClearAllScheduledWaits(){for(const e of this._scheduledWaits)e.Release();C3$jscomp$127.clearArray(this._scheduledWaits)}RemoveInstancesFromScheduledWaits(e){for(const t of this._scheduledWaits)t.RemoveInstances(e)}AddAsyncActionPromise(e){this._asyncActionPromises.push(e)}ClearAsyncActionPromises(){C3$jscomp$127.clearArray(this._asyncActionPromises)}GetPromiseForAllAsyncActions(){const e=Promise.all(this._asyncActionPromises);return this._asyncActionPromises=[],e}_SaveToJson(){return{groups:this._SaveGroupsToJson(),cnds:this._SaveCndsToJson(),acts:this._SaveActsToJson(),vars:this._SaveVarsToJson(),waits:this._SaveScheduledWaitsToJson()}}_LoadFromJson(e){this._LoadGroupsFromJson(e.groups),this._LoadCndsFromJson(e.cnds),this._LoadActsFromJson(e.acts),this._LoadVarsFromJson(e.vars),this._LoadScheduledWaitsFromJson(e.waits)}_SaveGroupsToJson(){const e={};for(const t of this.GetAllGroups())e[t.GetSID().toString()]=t.IsGroupActive();return e}_LoadGroupsFromJson(e){for(const[t,s]of Object.entries(e))e=parseInt(t,10),(e=this.GetEventGroupBySID(e))&&e.SetGroupActive(s)}_SaveCndsToJson(){const e={};for(const[t,s]of this._cndsBySid){const i=s._SaveToJson();i&&(e[t.toString()]=i)}return e}_LoadCndsFromJson(e){const t=new Map;for(const[s,i]of Object.entries(e))t.set(parseInt(s,10),i);for(const[e,s]of this._cndsBySid)s._LoadFromJson(t.get(e)||null)}_SaveActsToJson(){const e={};for(const[t,s]of this._actsBySid){const i=s._SaveToJson();i&&(e[t.toString()]=i)}return e}_LoadActsFromJson(e){const t=new Map;for(const[s,i]of Object.entries(e))t.set(parseInt(s,10),i);for(const[e,s]of this._actsBySid)s._LoadFromJson(t.get(e)||null)}_SaveVarsToJson(){const e={};for(const[t,s]of this._eventVarsBySid)s.IsConstant()||!s.IsGlobal()&&!s.IsStatic()||(e[t.toString()]=s.GetValue());return e}_LoadVarsFromJson(e){for(const[t,s]of Object.entries(e))e=parseInt(t,10),(e=this.GetEventVariableBySID(e))&&e.SetValue(s)}_SaveScheduledWaitsToJson(){return this._scheduledWaits.filter((e=>!e.IsPromise())).map((e=>e._SaveToJson()))}_LoadScheduledWaitsFromJson(e){this.ClearAllScheduledWaits();for(const t of e)(e=C3$jscomp$127.ScheduledWait._CreateFromJson(this,t))&&this._scheduledWaits.push(e)}_GetPerfRecords(){return[...this._runtime.GetLayoutManager().runningLayouts()].map((e=>e.GetEventSheet())).filter((e=>e)).map((e=>e._GetPerfRecord()))}FindFirstFunctionBlockParent(e){for(;e;)if((e=e.GetScopeParent())instanceof C3$jscomp$127.FunctionBlock)return e;return null}_InvokeFunctionFromJS(e,t){if(Array.isArray(t)||(t=[]),!(e=this.GetFunctionBlockByName(e.toLowerCase())))return null;if(!e.IsEnabled())return e.GetDefaultReturnValue();var s=e.GetFunctionParameters();if(t.length<s.length){t=t.slice(0);do{t.push(s[t.length].GetInitialValue())}while(t.length<s.length)}return(s=e.GetEventBlock()).RunAsExpressionFunctionCall(s.GetSolModifiersIncludingParents(),!1,e.GetReturnType(),e.GetDefaultReturnValue(),...t)}};const C3$jscomp$128=self.C3;C3$jscomp$128.EventSheet=class extends C3$jscomp$128.DefendedBase{constructor(e,t){super(),this._eventSheetManager=e,this._runtime=e.GetRuntime(),this._name=t[0],this._events=[],this._triggers=new Map,this._fastTriggers=new Map,this._eventsByDisplayNumber=new Map,this._hasRun=!1,this._shallowIncludes=[],this._deepIncludes=[],this._alreadyIncludedSheets=new Set;for(const e of t[1])this._CreateEvent(e,null,this._events);this._perfRecord=this._runtime.IsDebug()?{type:"sheet",name:this._name,totalTimeCounter:0,children:[]}:null}Release(){this._runtime=this._eventSheetManager=null}_CreateEvent(e,t,s){switch(e[0]){case 0:case 3:this._CreateEventBlock(e,t,s);break;case 1:this._CreateEventVariable(e,t,s);break;case 2:this._CreateInclude(e,t,s);break;case 4:this._CreateFunctionBlock(e,t);break;case 5:this._CreateScriptBlock(e,t,s);break;default:throw Error("invalid event type")}}_CreateEventBlock(e,t,s){if((e=C3$jscomp$128.EventBlock.Create(this,t,e)).IsOrBlock()){s.push(e);for(let t=0,i=(s=e.GetConditions()).length;t<i;++t)s[t].IsTrigger()&&this._InitTrigger(e,t)}else e.IsTrigger()?this._InitTrigger(e,0):s.push(e)}_CreateFunctionBlock(e,t){e=C3$jscomp$128.FunctionBlock.Create(this,t,e),this._eventSheetManager._RegisterFunctionBlock(e)}_CreateEventVariable(e,t,s){e=C3$jscomp$128.EventVariable.Create(this,t,e),s.push(e)}_CreateInclude(e,t,s){e=C3$jscomp$128.EventInclude.Create(this,t,e),s.push(e)}_CreateScriptBlock(e,t,s){e=C3$jscomp$128.EventScript.Create(this,t,e),s.push(e)}_InitTrigger(e,t){e.IsOrBlock()||this._eventSheetManager._AddTriggerToPostInit(e);var s=e.GetConditionAt(t),i=s._GetFunc(),r=s.GetObjectClass();if(s.IsFastTrigger()){var n=this._fastTriggers.get(r);n||(n=new Map,this._fastTriggers.set(r,n)),s=s.GetFastTriggerValue().toLowerCase(),(r=n.get(i))||(r=new Map,n.set(i,r)),(i=r.get(s))||(i=[],r.set(s,i)),i.push([e,t])}else(n=this._triggers.get(r))||(n={methodMap:new Map,behaviors:new Map},this._triggers.set(r,n)),(r=s.GetBehaviorType())?(s=n.behaviors.get(r))||(s=new Map,n.behaviors.set(r,s)):s=n.methodMap,(n=s.get(i))||(n=[],s.set(i,n)),n.push([e,t])}_PostInit(){const e=this._events;for(let t=0,s=e.length;t<s;++t){const i=t<s-1&&e[t+1]instanceof C3$jscomp$128.EventBlock&&e[t+1].IsElseBlock();e[t]._PostInit(i)}}_AddShallowInclude(e){this._shallowIncludes.push(e)}_UpdateDeepIncludes(){C3$jscomp$128.clearArray(this._deepIncludes),this._AddDeepIncludes(this),this._alreadyIncludedSheets.clear()}_AddDeepIncludes(e){const t=e._deepIncludes,s=e._alreadyIncludedSheets;for(const i of this._shallowIncludes){const r=i.GetIncludeSheet();i.IsActive()&&e!==r&&!s.has(r)&&(s.add(r),r._AddDeepIncludes(e),t.push(r))}}deepIncludes(){return this._deepIncludes}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetName(){return this._name}_RegisterEventByDisplayNumber(e,t){this._eventsByDisplayNumber.set(t,e)}_GetEventByDisplayNumber(e){return this._eventsByDisplayNumber.get(e)||null}_ResetHasRunFlag(){this._hasRun=!1}Run(){if(!this._hasRun){var e=this._runtime,t=e.IsCPUProfiling(),s=t?performance.now():0;this._hasRun=!0;var i=this.GetEventSheetManager(),r=i.GetCurrentEventStackFrame();for(const t of this._events)t.Run(r),i.ClearSol(t.GetSolModifiers()),i.ClearAsyncActionPromises(),e.FlushPendingInstances();r.Reset(null),t&&(this._perfRecord.totalTimeCounter+=performance.now()-s)}}*DebugRun(){if(!this._hasRun){this._hasRun=!0;var e=this._runtime,t=this.GetEventSheetManager(),s=t.GetCurrentEventStackFrame();for(const i of this._events)yield*i.DebugRun(s),t.ClearSol(i.GetSolModifiers()),t.ClearAsyncActionPromises(),e.FlushPendingInstances();s.Reset(null)}}_Trigger(e,t,s){if(!t)return this._TriggerForClass(e,t,null,null);{const i=t.GetObjectClass();this._TriggerForClass(e,t,i,s);for(const r of i.GetFamilies())this._TriggerForClass(e,t,r,s)}}_TriggerForClass(e,t,s,i){if(!(s=this._triggers.get(s)))return!1;if(!(i=i?s.behaviors.get(i):s.methodMap))return!1;if(!(i=i.get(e)))return!1;e=!1;for(const[s,r]of i)i=this._ExecuteTrigger(t,s,r),e=e||i;return e}*_DebugTrigger(e,t,s){if(!t)return yield*this._DebugTriggerForClass(e,t,null,null);{const i=t.GetObjectClass();yield*this._DebugTriggerForClass(e,t,i,s);for(const r of i.GetFamilies())yield*this._DebugTriggerForClass(e,t,r,s)}}*_DebugTriggerForClass(e,t,s,i){if(!(s=this._triggers.get(s)))return!1;if(!(i=i?s.behaviors.get(i):s.methodMap))return!1;if(!(i=i.get(e)))return!1;e=!1;for(const[s,r]of i)i=s.DebugCanRunFast()?this._ExecuteTrigger(t,s,r):yield*this._DebugExecuteTrigger(t,s,r),e=e||i;return e}_FastTrigger(e,t,s){if(t=t.GetObjectClass(),!(t=this._fastTriggers.get(t)))return!1;if(!(e=t.get(e)))return!1;if(!(s=e.get(s)))return!1;e=!1;for(let i=0,r=s.length;i<r;++i)t=s[i],t=this._ExecuteTrigger(null,t[0],t[1]),e=e||t;return e}*_DebugFastTrigger(e,t,s){if(t=t.GetObjectClass(),!(t=this._fastTriggers.get(t)))return!1;if(!(e=t.get(e)))return!1;if(!(s=e.get(s)))return!1;e=!1;for(let r=0,n=s.length;r<n;++r){var i=s[r];t=i[0],i=i[1],t=t.DebugCanRunFast()?this._ExecuteTrigger(null,t,i):yield*this._DebugExecuteTrigger(null,t,i),e=e||t}return e}_ExecuteTrigger(e,t,s){const i=this._runtime,r=this._eventSheetManager,n=r.GetCurrentEvent(),a=r.GetEventStack(),o=r.GetTriggerDepth();let h=!1;n&&r.PushCleanSol(n.GetSolModifiersIncludingParents()),r.PushCleanSol(t.GetSolModifiersIncludingParents());const l=1<o;l&&r.GetLocalVarStack().Push();const c=a.Push(t);if(e&&(t.GetConditions()[s].GetObjectClass().GetCurrentSol().SetSinglePicked(e),e.IsInContainer()&&e.SetSiblingsSinglePicked()),e=!0,t.GetParent()){const s=t.GetTriggerParents();for(let t=0,i=s.length;t<i;++t)if(!s[t].RunPreTrigger(c)){e=!1;break}}return e&&(t.IsOrBlock()?t.RunOrBlockTrigger(c,s):t.Run(c),h=c.GetLastEventTrue()),a.Pop(),l&&r.GetLocalVarStack().Pop(),r.PopSol(t.GetSolModifiersIncludingParents()),n&&r.PopSol(n.GetSolModifiersIncludingParents()),n||1!==o||(r.ClearAsyncActionPromises(),r.IsFlushingBlocked()||i.FlushPendingInstances()),h}*_DebugExecuteTrigger(e,t,s){const i=this._runtime,r=this._eventSheetManager,n=r.GetCurrentEvent(),a=r.GetEventStack(),o=r.GetTriggerDepth();let h=!1;n&&r.PushCleanSol(n.GetSolModifiersIncludingParents()),r.PushCleanSol(t.GetSolModifiersIncludingParents());const l=1<o;l&&r.GetLocalVarStack().Push();const c=a.Push(t);if(e&&(t.GetConditions()[s].GetObjectClass().GetCurrentSol().SetSinglePicked(e),e.IsInContainer()&&e.SetSiblingsSinglePicked()),e=!0,t.GetParent()){const s=t.GetTriggerParents();for(let t=0,i=s.length;t<i;++t)if(!(yield*s[t].DebugRunPreTrigger(c))){e=!1;break}}return e&&(t.IsOrBlock()?yield*t.DebugRunOrBlockTrigger(c,s):yield*t.DebugRun(c),h=c.GetLastEventTrue()),a.Pop(),l&&r.GetLocalVarStack().Pop(),r.PopSol(t.GetSolModifiersIncludingParents()),n&&r.PopSol(n.GetSolModifiersIncludingParents()),n||1!==o||(r.ClearAsyncActionPromises(),r.IsFlushingBlocked()||i.FlushPendingInstances()),h}_GetPerfRecord(){return this._perfRecord}};const C3$jscomp$129=self.C3,EMPTY_ARRAY=[];function NoActions(e,t){return!0}function*DebugNoActions(e,t){return!0}C3$jscomp$129.EventBlock=class extends C3$jscomp$129.DefendedBase{constructor(e,t,s){for(var i of(super(),this._eventSheet=e,this._runtime=e.GetRuntime(),this._parent=t,this._scopeParent=null,this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._solModifiers=[],this._solModifiersIncludingParents=[],this._hasElseBlock=this._isTopLevelGroup=this._isSolWriterAfterCnds=this._hasGotSolModifiersIncludingParents=!1,this._isOrBlock=!!s[2],this._isElseBlock=!1,this._triggerParents=null,this._conditions=[],this._actions=[],this._subEvents=[],this._RunActions=NoActions,this._DebugRunActions=DebugNoActions,this._isInitiallyActive=this._isGroup=!1,this._groupName="",this._isGroupActive=!1,this._perfRecord=this._containedIncludes=null,this._sid=s[4],this._displayNumber=s[5],this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber),this._debugData=this._runtime.IsDebug()?{isBreakpoint:s[3][0],isBreakable:s[3][1],canRunAllConditionsFast:!1,canRunAllActionsFast:!1,canRunAllSubEventsFast:!1,canRunSelfFast:!1}:null,this.GetEventSheetManager()._RegisterEventBlock(this),3===s[0]&&this._InitGroup(s[1]),e=0,s[6]))t=C3$jscomp$129.Condition.Create(this,i,e++),this._conditions.push(t),this._AddSolModifier(t.GetObjectClass());e=0;for(const t of s[7])i=C3$jscomp$129.Action.Create(this,t,e++),this._actions.push(i);if(9===s.length){s=s[8];for(const e of s)this._eventSheet._CreateEvent(e,this,this._subEvents)}this._conditions.length&&(this._isElseBlock=null===this._conditions[0].GetObjectClass()&&this._conditions[0]._GetFunc()===C3$jscomp$129.Plugins.System.Cnds.Else),0===this._conditions.length&&(this._conditions=EMPTY_ARRAY),0===this._actions.length&&(this._actions=EMPTY_ARRAY),0===this._subEvents.length&&(this._subEvents=EMPTY_ARRAY)}static Create(e,t,s){return C3$jscomp$129.New(C3$jscomp$129.EventBlock,e,t,s)}_InitGroup(e){this._isGroup=!0,this._isGroupActive=this._isInitiallyActive=!!e[0],this._groupName=e[1].toLowerCase(),this._containedIncludes=[],this.GetEventSheetManager()._RegisterGroup(this),this._runtime.IsDebug()&&(this._perfRecord={type:"group",name:e[1],totalTimeCounter:0,children:[]})}_AddContainedInclude(e){this._containedIncludes.push(e)}_AddContainerSolModifierToList(e,t){for(const s of e.GetContainer().objectTypes())t.includes(s)||t.push(s)}_AddSolModifierToList(e,t){if(e)if(t.includes(e)||t.push(e),e.IsFamily())for(const s of e.GetFamilyMembers())s.IsInContainer()&&this._AddContainerSolModifierToList(s,t);else e.IsInContainer()&&this._AddContainerSolModifierToList(e,t)}_AddSolModifier(e){this._AddSolModifierToList(e,this._solModifiers)}_AddParentSolModifier(e){this._AddSolModifierToList(e,this._solModifiersIncludingParents)}SetAllSolModifiers(){this._solModifiers=this._runtime.GetAllObjectClasses()}_PostInit(e){this._hasElseBlock=!!e,this._IdentifyTopLevelGroup(),this._IdentifyTriggerParents();for(const e of this._conditions)e._PostInit();if(0<this._actions.length){for(var t of(e=!1,this._actions))t._PostInit(),t.HasReturnType()&&(e=!0);e?(this._RunActions=this._RunActions_ReturnValue,this._DebugRunActions=this._DebugRunActions_ReturnValue):(this._RunActions=this._RunActions_Fast,this._DebugRunActions=this._DebugRunActions_Fast)}for(let s=0,i=(t=this._subEvents).length;s<i;++s)e=s<i-1&&t[s+1]instanceof C3$jscomp$129.EventBlock&&t[s+1].IsElseBlock(),t[s]._PostInit(e);this._debugData&&this._UpdateCanRunFast(),this._perfRecord&&this._GetPerfRecordParent()._GetPerfRecord().children.push(this._perfRecord)}_GetPerfRecord(){return this._perfRecord}_GetPerfRecordParent(){let e=this.GetParent();for(;e;){if(e.IsGroup())return e;e=e.GetParent()}return this._eventSheet}_UpdateCanRunFast(){const e=this._debugData;e.canRunAllConditionsFast=this._conditions.every((e=>e.DebugCanRunFast())),e.canRunAllActionsFast=this._actions.every((e=>e.DebugCanRunFast())),e.canRunAllSubEventsFast=this._subEvents.every((e=>e.DebugCanRunFast())),e.canRunSelfFast=e.canRunAllConditionsFast&&e.canRunAllActionsFast&&e.canRunAllSubEventsFast}_UpdateCanRunFastRecursive(){let e=this;do{e._UpdateCanRunFast(),e=e.GetParent()}while(e)}_IdentifyTopLevelGroup(){if(this.IsGroup()){var e=this.GetParent();for(this._isTopLevelGroup=!0;e;){if(!e.IsGroup()){this._isTopLevelGroup=!1;break}e=e.GetParent()}}}_IdentifySolModifiersIncludingParents(){var e=this._runtime.GetAllObjectClasses();if(this._solModifiers===e)this._solModifiersIncludingParents=e;else{for(this._solModifiersIncludingParents=C3$jscomp$129.cloneArray(this._solModifiers),e=this.GetParent();e;){for(var t of e._solModifiers)this._AddParentSolModifier(t);e=e.GetParent()}t=this.GetEventSheetManager(),this._solModifiers=t._DeduplicateSolModifierList(this._solModifiers),this._solModifiersIncludingParents=t._DeduplicateSolModifierList(this._solModifiersIncludingParents)}}_IdentifyTriggerParents(){if(this.HasAnyTriggeredCondition()){this._triggerParents=[];for(var e=this.GetParent();e;)this._triggerParents.push(e),e=e.GetParent();this._triggerParents.reverse()}}SetSolWriterAfterCnds(){this._isSolWriterAfterCnds=!0,this._parent&&this._parent.SetSolWriterAfterCnds()}IsSolWriterAfterCnds(){return this._isSolWriterAfterCnds}GetSolModifiers(){return this._solModifiers}GetSolModifiersIncludingParents(){return this._hasGotSolModifiersIncludingParents||(this._hasGotSolModifiersIncludingParents=!0,this._IdentifySolModifiersIncludingParents()),this._solModifiersIncludingParents}HasSolModifier(e){return this._solModifiers.includes(e)}GetTriggerParents(){return this._triggerParents}GetEventSheet(){return this._eventSheet}GetEventSheetManager(){return this._eventSheet.GetEventSheetManager()}GetRuntime(){return this._runtime}GetParent(){return this._parent}_SetScopeParent(e){this._scopeParent=e}GetScopeParent(){return this._scopeParent||this._parent}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(e){this._debugData.isBreakpoint=!!e,this._UpdateCanRunFastRecursive()}IsGroup(){return this._isGroup}IsTopLevelGroup(){return this._isTopLevelGroup}IsElseBlock(){return this._isElseBlock}HasElseBlock(){return this._hasElseBlock}GetGroupName(){return this._groupName}IsGroupActive(){return this._isGroupActive}ResetInitialActivation(){this.SetGroupActive(this._isInitiallyActive)}SetGroupActive(e){if(e=!!e,!this._isGroup)throw Error("not a group");if(this._isGroupActive!==e){this._isGroupActive=e;for(const e of this._containedIncludes)e.UpdateActive();this._containedIncludes.length&&(e=this._runtime.GetCurrentLayout().GetEventSheet())&&e._UpdateDeepIncludes()}}GetSID(){return this._sid}IsOrBlock(){return this._isOrBlock}IsTrigger(){return this._conditions.length&&this._conditions[0].IsTrigger()}IsForFunctionBlock(){return this._scopeParent&&this._scopeParent instanceof C3$jscomp$129.FunctionBlock}HasAnyTriggeredCondition(){return this.IsForFunctionBlock()||this._conditions.some((e=>e.IsTrigger()))}GetConditions(){return this._conditions}GetConditionCount(){return this._conditions.length}GetConditionAt(e){if(0>(e=Math.floor(e))||e>=this._conditions.length)throw new RangeError("invalid condition index");return this._conditions[e]}GetConditionByDebugIndex(e){return this.GetConditionAt(e)}IsFirstConditionOfType(e){let t=e.GetIndex();if(0===t)return!0;for(--t;0<=t;--t)if(this._conditions[t].GetObjectClass()===e.GetObjectClass())return!1;return!0}GetActions(){return this._actions}GetActionCount(){return this._actions.length}GetActionAt(e){if(0>(e=Math.floor(e))||e>=this._actions.length)throw new RangeError("invalid action index");return this._actions[e]}GetActionByDebugIndex(e){e=Math.floor(e);const t=this._actions.find((t=>t.GetDebugIndex()===e));if(!t)throw new RangeError("invalid action debug index");return t}_HasActionIndex(e){return 0<=(e=Math.floor(e))&&e<this._actions.length}GetSubEvents(){return this._subEvents}_GetAllLocalVariablesInScope(){return this._subEvents.filter((e=>e instanceof C3$jscomp$129.EventVariable))}RunPreTrigger(e){e.SetCurrentEvent(this);let t=!1;const s=this._conditions;for(let i=0,r=s.length;i<r;++i){const r=s[i];if(e.SetConditionIndex(i),r.IsLooping())throw Error("trigger cannot be used as sub-event to a loop");if(r.Run())t=!0;else if(!this._isOrBlock)return!1}return!this._isOrBlock||t}RunOrBlockTrigger(e,t){e.SetCurrentEvent(this),this._conditions[t].Run()&&(this._RunActions(e,0)&&this._RunSubEvents(e),e.SetLastEventTrue(!0))}*DebugRunPreTrigger(e){e.SetCurrentEvent(this);let t=!1;const s=this._conditions;for(let i=0,r=s.length;i<r;++i){const r=s[i];if(e.SetConditionIndex(i),r.IsLooping())throw Error("trigger cannot be used as sub-event to a loop");if(r.DebugCanRunFast()?r.Run():yield*r.DebugRun())t=!0;else if(!this._isOrBlock)return!1}return!this._isOrBlock||t}*DebugRunOrBlockTrigger(e,t){e.SetCurrentEvent(this),((t=this._conditions[t]).DebugCanRunFast()?t.Run():yield*t.DebugRun())&&((this.DebugCanRunActionsFast()?this._RunActions(e,0):yield*this._DebugRunActions(e,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),e.SetLastEventTrue(!0))}Run(e){e.SetCurrentEvent(this),this._isElseBlock||e.SetElseBranchRan(!1),this._isOrBlock?this._RunOrBlock(e):this._RunAndBlock(e)}*DebugRun(e){(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),e.SetCurrentEvent(this),this._isElseBlock||e.SetElseBranchRan(!1),this._isOrBlock?yield*this._DebugRunOrBlock(e):yield*this._DebugRunAndBlock(e)}_RunOrBlock(e){const t=this._conditions;let s=0===t.length;for(let r=0,n=t.length;r<n;++r){var i=t[r];i.IsTrigger()||(e.SetConditionIndex(r),i=i.Run(),s=s||i)}e.SetLastEventTrue(s),s&&(this._RunActions(e,0)&&this._RunSubEvents(e),this._hasElseBlock&&e.SetElseBranchRan(!0))}*_DebugRunOrBlock(e){const t=this._conditions;let s=0===t.length;for(let r=0,n=t.length;r<n;++r){var i=t[r];i.IsTrigger()||(e.SetConditionIndex(r),i=i.DebugCanRunFast()?i.Run():yield*i.DebugRun(),s=s||i)}e.SetLastEventTrue(s),s&&((this.DebugCanRunActionsFast()?this._RunActions(e,0):yield*this._DebugRunActions(e,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),this._hasElseBlock&&e.SetElseBranchRan(!0))}_RunAndBlock(e){const t=this._conditions;for(let s=0,i=t.length;s<i;++s){const i=t[s];if(e.SetConditionIndex(s),!i.Run())return void e.SetLastEventTrue(!1)}e.SetLastEventTrue(!0),this._RunActions(e,0)&&this._RunSubEvents(e),e.GetLastEventTrue()&&this._hasElseBlock&&e.SetElseBranchRan(!0)}*_DebugRunAndBlock(e){const t=this._conditions;for(let s=0,i=t.length;s<i;++s){const i=t[s];if(e.SetConditionIndex(s),i.DebugCanRunFast()?!i.Run():!(yield*i.DebugRun()))return void e.SetLastEventTrue(!1)}e.SetLastEventTrue(!0),(this.DebugCanRunActionsFast()?this._RunActions(e,0):yield*this._DebugRunActions(e,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),e.GetLastEventTrue()&&this._hasElseBlock&&e.SetElseBranchRan(!0)}_RunActions_Fast(e,t){const s=this._actions;for(let i=t,r=s.length;i<r;++i)t=s[i],e.SetActionIndex(i),t.Run();return!0}*_DebugRunActions_Fast(e,t){const s=this._actions;for(let i=t,r=s.length;i<r;++i)t=s[i],e.SetActionIndex(i),t.DebugCanRunFast()?t.Run():yield*t.DebugRun();return!0}_RunActions_ReturnValue(e,t){const s=this.GetEventSheetManager(),i=this._actions;for(let r=t,n=i.length;r<n;++r){t=i[r],e.SetActionIndex(r);const n=t.Run();if(t.CanBailOut()&&!0===n)return!1;t.IsAsync()&&n instanceof Promise&&s.AddAsyncActionPromise(n)}return!0}*_DebugRunActions_ReturnValue(e,t){const s=this.GetEventSheetManager(),i=this._actions;for(let r=t,n=i.length;r<n;++r){let n;if(t=i[r],e.SetActionIndex(r),n=t.DebugCanRunFast()?t.Run():yield*t.DebugRun(),t.CanBailOut()&&!0===n)return!1;t.IsAsync()&&n instanceof Promise&&s.AddAsyncActionPromise(n)}return!0}_ResumeActionsAndSubEvents(e){this._RunActions(e,e.GetActionIndex())&&this._RunSubEvents()}*_DebugResumeActionsAndSubEvents(e){(yield*this._DebugRunActions(e,e.GetActionIndex()))&&(yield*this._DebugRunSubEvents())}_RunSubEvents(){if(this._subEvents.length){var e=this.IsGroup()&&this._runtime.IsCPUProfiling(),t=e?performance.now():0,s=this._eventStack,i=s.Push(this);this._isSolWriterAfterCnds?this._RunSubEvents_SolWriterAfterCnds(i):this._RunSubEvents_Fast(i),s.Pop(),e&&(this._perfRecord.totalTimeCounter+=performance.now()-t)}}_RunSubEvents_SolWriterAfterCnds(e){const t=this._isGroup,s=this._isTopLevelGroup,i=this.GetEventSheetManager(),r=this._subEvents;for(let n=0,a=r.length,o=a-1;n<a;++n){const a=r[n],h=a.GetSolModifiers(),l=!s||!t&&n<o;l&&i.PushCopySol(h),a.Run(e),l?i.PopSol(h):i.ClearSol(h)}}_RunSubEvents_Fast(e){const t=this._subEvents;for(let s=0,i=t.length;s<i;++s)t[s].Run(e)}*_DebugRunSubEvents(){if(this._subEvents.length){var e=this._eventStack,t=e.Push(this);this._isSolWriterAfterCnds?yield*this._DebugRunSubEvents_SolWriterAfterCnds(t):yield*this._DebugRunSubEvents_Fast(t),e.Pop()}}*_DebugRunSubEvents_SolWriterAfterCnds(e){const t=this._isGroup,s=this._isTopLevelGroup,i=this.GetEventSheetManager(),r=this._subEvents;for(let n=0,a=r.length,o=a-1;n<a;++n){const a=r[n],h=a.GetSolModifiers(),l=!s||!t&&n<o;l&&i.PushCopySol(h),yield*a.DebugRun(e),l?i.PopSol(h):i.ClearSol(h)}}*_DebugRunSubEvents_Fast(e){const t=this._subEvents;for(let s=0,i=t.length;s<i;++s)yield*t[s].DebugRun(e)}Retrigger(e,t){t.ResetQuick();const s=this._conditions;if(!this.IsOrBlock())for(let i=e.GetConditionIndex()+1,r=s.length;i<r;++i)if(e=s[i],t.SetConditionIndex(i),!e.Run())return!1;return this._RunActions(t,0)&&this._RunSubEvents(t),!0}*DebugRetrigger(e,t){t.ResetQuick();const s=this._conditions;if(!this.IsOrBlock())for(let i=e.GetConditionIndex()+1,r=s.length;i<r;++i)if(e=s[i],t.SetConditionIndex(i),e.DebugCanRunFast()?!e.Run():!(yield*e.DebugRun()))return!1;return(this.DebugCanRunActionsFast()?this._RunActions(t,0):yield*this._DebugRunActions(t,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),!0}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()&&this._debugData.canRunSelfFast}DebugCanRunActionsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllActionsFast}DebugCanRunSubEventsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllSubEventsFast}_CheckParentsOKToRun(e){if(this.GetParent()){const t=this.GetTriggerParents();for(let s=0,i=t.length;s<i;++s)if(!t[s].RunPreTrigger(e))return!1}return!0}*_DebugCheckParentsOKToRun(e){if(this.GetParent()){const t=this.GetTriggerParents();for(let s=0,i=t.length;s<i;++s)if(!(yield*t[s].DebugRunPreTrigger(e)))return!1}return!0}_EvaluateFunctionCallParameters(e,t,s){0<t.length?s?(t=t.map((e=>e.Get(0))),e.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(t)):this._scopeParent.EvaluateFunctionParameters(t):s&&e.GetLocalVarStack().Push()}RunAsFunctionCall(e,t,s){let i,r;const n=0<e.length,a=this._eventStack,o=this._runtime.GetEventSheetManager(),h=1<o._IncTriggerDepth();return this._EvaluateFunctionCallParameters(o,t,h),n&&(s?o.PushCopySol(e):o.PushCleanSol(e)),t=a.Push(this),this._CheckParentsOKToRun(t)&&(t.SetCurrentEvent(this),(s=this._scopeParent.IsAsync())&&([r,i]=this._scopeParent.StartAsyncFunctionCall()),this._RunAndBlock(t),s&&this._scopeParent.MaybeFinishAsyncFunctionCall(r)),a.Pop(),h&&o.GetLocalVarStack().Pop(),n&&o.PopSol(e),o._DecTriggerDepth(),i}*DebugRunAsFunctionCall(e,t,s){let i,r;(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this);const n=0<e.length,a=this._eventStack,o=this._runtime.GetEventSheetManager(),h=1<o._IncTriggerDepth();return this._EvaluateFunctionCallParameters(o,t,h),n&&(s?o.PushCopySol(e):o.PushCleanSol(e)),t=a.Push(this),(yield*this._DebugCheckParentsOKToRun(t))&&(t.SetCurrentEvent(this),(s=this._scopeParent.IsAsync())&&([r,i]=this._scopeParent.StartAsyncFunctionCall()),yield*this._DebugRunAndBlock(t),s&&this._scopeParent.MaybeFinishAsyncFunctionCall(r)),a.Pop(),h&&o.GetLocalVarStack().Pop(),n&&o.PopSol(e),o._DecTriggerDepth(),i}RunAsMappedFunctionCall(e,t){const s=this.GetSolModifiersIncludingParents(),i=0<s.length,r=this._eventStack,n=this._runtime.GetEventSheetManager(),a=1<n._IncTriggerDepth();a&&n.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(e),i&&(t?n.PushCopySol(s):n.PushCleanSol(s)),e=r.Push(this),this._CheckParentsOKToRun(e)&&(e.SetCurrentEvent(this),this._RunAndBlock(e)),r.Pop(),a&&n.GetLocalVarStack().Pop(),i&&n.PopSol(s),n._DecTriggerDepth()}*DebugRunAsMappedFunctionCall(e,t){(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this);const s=this.GetSolModifiersIncludingParents(),i=0<s.length,r=this._eventStack,n=this._runtime.GetEventSheetManager(),a=1<n._IncTriggerDepth();a&&n.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(e),i&&(t?n.PushCopySol(s):n.PushCleanSol(s)),e=r.Push(this),(yield*this._DebugCheckParentsOKToRun(e))&&(e.SetCurrentEvent(this),yield*this._DebugRunAndBlock(e)),r.Pop(),a&&n.GetLocalVarStack().Pop(),i&&n.PopSol(s),n._DecTriggerDepth()}RunAsExpressionFunctionCall(e,t,s,i,...r){let n,a;const o=0<e.length,h=this._runtime,l=this._eventStack,c=h.GetEventSheetManager(),u=1<c._IncTriggerDepth();return u&&c.GetLocalVarStack().Push(),0<r.length&&this._scopeParent.SetFunctionParameters(r),o&&(t?c.PushCopySol(e):c.PushCleanSol(e)),(t=l.Push(this)).InitCallFunctionExpression(s,i),l.PushExpFunc(t),h.SetDebuggingEnabled(!1),this._CheckParentsOKToRun(t)&&(t.SetCurrentEvent(this),(s=this._scopeParent.IsAsync())&&([a,n]=this._scopeParent.StartAsyncFunctionCall()),this._RunAndBlock(t),s&&this._scopeParent.MaybeFinishAsyncFunctionCall(a)),h.SetDebuggingEnabled(!0),l.Pop(),l.PopExpFunc(),u&&c.GetLocalVarStack().Pop(),o&&c.PopSol(e),c._DecTriggerDepth(),n||t.GetFunctionReturnValue()}};const C3$jscomp$130=self.C3,EMPTY_SOL_MODIFIERS=[];let hadUserScriptException=!1;C3$jscomp$130.EventScript=class extends C3$jscomp$130.DefendedBase{constructor(e,t,s){super();const i=e.GetRuntime(),r=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=r,this._runtime=e.GetRuntime(),this._parent=t,this._func=i.GetObjectReference(s[1]),this._displayNumber=s[2],this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber),this._debugData=i.IsDebug()?{isBreakpoint:s[3][0],isBreakable:s[3][1]}:null}static Create(e,t,s){return C3$jscomp$130.New(C3$jscomp$130.EventScript,e,t,s)}_PostInit(){const e=this._func,t=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this);this._func=e.bind(null,this._runtime.GetIRuntime(),t)}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetEventSheet(){return this._eventSheet}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(e){this._debugData.isBreakpoint=!!e}IsElseBlock(){return!1}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}GetSolModifiersIncludingParents(){return this._parent?this._parent.GetSolModifiersIncludingParents():EMPTY_SOL_MODIFIERS}Run(e){e.SetCurrentEvent(this),this._eventSheetManager.AddAsyncActionPromise(this._RunUserScript())}async _RunUserScript(){try{await this._func()}catch(e){self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),hadUserScriptException||(hadUserScriptException=!0)}}*DebugRun(e){e.SetCurrentEvent(this),(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this.Run(e)}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()}static HadUserScriptException(){return hadUserScriptException}static SetHadUserScriptException(){hadUserScriptException=!0}};const C3$jscomp$131=self.C3;C3$jscomp$131.FunctionBlock=class extends C3$jscomp$131.DefendedBase{constructor(e,t,s){super(),this._eventSheet=e,this._runtime=e.GetRuntime(),this._parent=t;const i=s[1];this._functionName=i[0],this._returnType=i[1],this._functionParameters=i[2].map((t=>C3$jscomp$131.EventVariable.Create(e,this,t))),this._isEnabled=i[3],this._innerLocalVariables=[],this._isCopyPicked=i[5],this._isAsync=i[4],this._nextAsyncId=0,this._currentAsyncId=-1,this._asyncMap=new Map,this._eventBlock=C3$jscomp$131.EventBlock.Create(e,t,s),this._eventBlock._SetScopeParent(this)}static Create(e,t,s){return C3$jscomp$131.New(C3$jscomp$131.FunctionBlock,e,t,s)}_PostInit(){for(const e of this._functionParameters)e._PostInit();this._eventBlock._PostInit(!1)}_GetAllLocalVariablesInScope(){return this._functionParameters}GetFunctionParameters(){return this._functionParameters}GetFunctionParameterCount(){return this._functionParameters.length}_RegisterLocalVariable(e){this._innerLocalVariables.push(e)}_GetAllInnerLocalVariables(){return this._innerLocalVariables}EvaluateFunctionParameters(e){const t=this._functionParameters;for(let s=0,i=t.length;s<i;++s)t[s].SetValue(e[s].Get(0))}SetFunctionParameters(e){const t=this._functionParameters;for(let s=0,i=t.length;s<i;++s)t[s].SetValue(e[s])}CaptureFunctionParameters(){return this._functionParameters.map((e=>e.GetValue()))}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetFunctionName(){return this._functionName}GetReturnType(){return this._returnType}IsEnabled(){return this._isEnabled}GetDefaultReturnValue(){switch(this._returnType){case 0:return null;case 2:return"";default:return 0}}GetEventBlock(){return this._eventBlock}IsCopyPicked(){return this._isCopyPicked}IsAsync(){return this._isAsync}StartAsyncFunctionCall(){const e=this._nextAsyncId++;let t;this._currentAsyncId=e;const s=new Promise((e=>t=e));return this._asyncMap.set(e,{resolve:t,pauseCount:0}),[e,s]}MaybeFinishAsyncFunctionCall(e){const t=this._asyncMap.get(e);0===t.pauseCount&&(t.resolve(),this._asyncMap.delete(e)),this._currentAsyncId=-1}PauseCurrentAsyncFunction(){return this._asyncMap.get(this._currentAsyncId).pauseCount++,this._currentAsyncId}ResumeAsyncFunction(e){this._currentAsyncId=e,this._asyncMap.get(e).pauseCount--}};const C3$jscomp$132=self.C3,EMPTY_SOL_MODIFIERS$jscomp$1=[];C3$jscomp$132.EventVariable=class extends C3$jscomp$132.DefendedBase{constructor(e,t,s){super();const i=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=i,this._runtime=e.GetRuntime(),this._parent=t,this._localVarStack=i.GetLocalVarStack(),this._name=s[1],this._type=s[2],this._initialValue=s[3],this._isStatic=!!s[4],this._isConstant=!!s[5],this._isFunctionParameter=t instanceof C3$jscomp$132.FunctionBlock,this._sid=s[6],this._jsPropName=this._runtime.GetJsPropName(s[8]),this._scriptSetter=e=>this.SetValue(e),this._scriptGetter=()=>this.GetValue(),this._hasSingleValue=!this._parent||this._isStatic||this._isConstant,this._value=this._initialValue,this._localIndex=-1,this.IsBoolean()&&(this._value=this._value?1:0),!this.IsLocal()||this.IsStatic()||this.IsConstant()||(this._localIndex=i._GetNextLocalVarIndex(this)),i._RegisterEventVariable(this)}static Create(e,t,s){return C3$jscomp$132.New(C3$jscomp$132.EventVariable,e,t,s)}_PostInit(){if(this.IsLocal()&&!this.IsStatic()&&!this.IsConstant()&&!this.IsFunctionParameter()){const e=this._eventSheetManager.FindFirstFunctionBlockParent(this);e&&e._RegisterLocalVariable(this)}}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetParent(){return this._parent}GetScopeParent(){return this.GetParent()}IsGlobal(){return!this.GetParent()}IsLocal(){return!this.IsGlobal()}IsFunctionParameter(){return this._isFunctionParameter}IsStatic(){return this._isStatic}IsConstant(){return this._isConstant}IsNumber(){return 0===this._type}IsString(){return 1===this._type}IsBoolean(){return 2===this._type}IsElseBlock(){return!1}GetSID(){return this._sid}GetInitialValue(){return this._initialValue}GetSolModifiers(){return EMPTY_SOL_MODIFIERS$jscomp$1}Run(e){!this.IsLocal()||this.IsStatic()||this.IsConstant()||this.SetValue(this.GetInitialValue())}DebugCanRunFast(){return!0}*DebugRun(e){this.Run(e)}SetValue(e){this.IsNumber()?"number"!=typeof e&&(e=parseFloat(e)):this.IsString()?"string"!=typeof e&&(e=e.toString()):this.IsBoolean()&&(e=e?1:0),this._hasSingleValue?this._value=e:this._localVarStack.GetCurrent()[this._localIndex]=e}GetValue(){return this._hasSingleValue?this._value:this._localVarStack.GetCurrent()[this._localIndex]}GetTypedValue(){let e=this.GetValue();return this.IsBoolean()&&(e=!!e),e}ResetToInitialValue(){this._value=this._initialValue}_GetScriptInterfaceDescriptor(){return{configurable:!1,enumerable:!0,get:this._scriptGetter,set:this._scriptSetter}}};const C3$jscomp$133=self.C3,EMPTY_SOL_MODIFIERS$jscomp$2=[];C3$jscomp$133.EventInclude=class extends C3$jscomp$133.DefendedBase{constructor(e,t,s){super();const i=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=i,this._runtime=e.GetRuntime(),this._parent=t,this._includeSheet=null,this._includeSheetName=s[1],this._isActive=!0}static Create(e,t,s){return C3$jscomp$133.New(C3$jscomp$133.EventInclude,e,t,s)}_PostInit(){this._includeSheet=this._eventSheetManager.GetEventSheetByName(this._includeSheetName),this._eventSheet._AddShallowInclude(this);let e=this.GetParent();for(;e;)e instanceof C3$jscomp$133.EventBlock&&e.IsGroup()&&e._AddContainedInclude(this),e=e.GetParent();this.UpdateActive(),this._runtime.IsDebug()&&this._eventSheet._GetPerfRecord().children.push(this._includeSheet._GetPerfRecord())}GetParent(){return this._parent}GetSolModifiers(){return EMPTY_SOL_MODIFIERS$jscomp$2}GetIncludeSheet(){return this._includeSheet}Run(e){e=!!this.GetParent();const t=this._runtime.GetAllObjectClasses();e&&this._eventSheetManager.PushCleanSol(t),this._includeSheet.Run(),e&&this._eventSheetManager.PopSol(t)}*DebugRun(e){e=!!this.GetParent();const t=this._runtime.GetAllObjectClasses();e&&this._eventSheetManager.PushCleanSol(t),yield*this._includeSheet.DebugRun(),e&&this._eventSheetManager.PopSol(t)}DebugCanRunFast(){return!1}IsActive(){return this._isActive}UpdateActive(){let e=this.GetParent();for(;e;){if(e instanceof C3$jscomp$133.EventBlock&&e.IsGroup()&&!e.IsGroupActive())return void(this._isActive=!1);e=e.GetParent()}this._isActive=!0}};const C3$jscomp$134=self.C3;C3$jscomp$134.ExpNode=class extends C3$jscomp$134.DefendedBase{constructor(e){super(),this._owner=e,this._runtime=e.GetRuntime()}_PostInit(){}static CreateNode(e,t){return C3$jscomp$134.New([BehaviorExpressionNode,ObjectExpressionNode,InstVarExpressionNode,EventVarExpNode,SystemExpressionExpNode,CallFunctionExpressionExpNode][t[0]],e,t)}};class SystemExpressionExpNode extends C3$jscomp$134.ExpNode{constructor(e,t){super(e),this._systemPlugin=this._runtime.GetSystemPlugin(),this._func=this._runtime.GetObjectReference(t[1]),this._func!==C3$jscomp$134.Plugins.System.Exps.random&&this._func!==C3$jscomp$134.Plugins.System.Exps.choose||this._owner.SetVariesPerInstance()}GetBoundMethod(){return this._systemPlugin._GetBoundACEMethod(this._func,this._systemPlugin)}}class CallFunctionExpressionExpNode extends C3$jscomp$134.ExpNode{constructor(e,t){super(e),this._functionBlock=null,this._functionName=t[1],this._owner.SetVariesPerInstance()}_PostInit(){const e=this._runtime.GetEventSheetManager();this._functionBlock=e.GetFunctionBlockByName(this._functionName),this._functionName=null;const t=this._owner.GetEventBlock(),s=this._functionBlock.GetEventBlock();this._combinedSolModifiers=[...new Set([...t.GetSolModifiersIncludingParents(),...s.GetSolModifiersIncludingParents()])],this._combinedSolModifiers=e._DeduplicateSolModifierList(this._combinedSolModifiers)}GetBoundMethod(){const e=this._functionBlock;if(e.IsEnabled()){const t=e.GetEventBlock();return C3$jscomp$134.EventBlock.prototype.RunAsExpressionFunctionCall.bind(t,this._combinedSolModifiers,e.IsCopyPicked(),e.GetReturnType(),e.GetDefaultReturnValue())}const t=e.GetDefaultReturnValue();return()=>t}}function WrapIndex(e,t){return e>=t?e%t:(0>e&&(e<=-t&&(e%=t),0>e&&(e+=t)),e)}class ObjectExpressionNode extends C3$jscomp$134.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._func=this._runtime.GetObjectReference(t[2]),this._returnsString=!!t[3],this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._owner._MaybeVaryFor(this._objectClass)}GetBoundMethod(){return this._objectClass.GetPlugin()._GetBoundACEMethod(this._func,this._objectClass.GetSingleGlobalInstance().GetSdkInstance())}ExpObject(...e){const t=this._objectClass,s=t.GetCurrentSol().GetExpressionInstances();var i=s.length;return 0===i?this._returnsString?"":0:(i=WrapIndex(this._owner.GetSolIndex(),i),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(t),this._func.apply(s[i].GetSdkInstance(),e))}ExpObject_InstExpr(e,...t){const s=this._objectClass,i=s.GetInstances(),r=i.length;return 0===r?this._returnsString?"":0:(e=WrapIndex(e,r),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(s),this._func.apply(i[e].GetSdkInstance(),t))}}class InstVarExpressionNode extends C3$jscomp$134.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._varIndex=t[3],this._returnsString=!!t[2],this._owner._MaybeVaryFor(this._objectClass)}ExpInstVar(){const e=this._objectClass.GetCurrentSol().GetExpressionInstances();var t=e.length;return 0===t?this._returnsString?"":0:e[t=WrapIndex(this._owner.GetSolIndex(),t)]._GetInstanceVariableValueUnchecked(this._varIndex)}ExpInstVar_Family(){var e=this._objectClass,t=e.GetCurrentSol().GetExpressionInstances(),s=t.length;return 0===s?this._returnsString?"":0:(e=(t=t[s=WrapIndex(this._owner.GetSolIndex(),s)]).GetObjectClass().GetFamilyInstanceVariableOffset(e.GetFamilyIndex()),t._GetInstanceVariableValueUnchecked(this._varIndex+e))}ExpInstVar_InstExpr(e){const t=this._objectClass;var s=t.GetInstances();const i=s.length;return 0===i?this._returnsString?"":0:(s=s[e=WrapIndex(e,i)],e=0,t.IsFamily()&&(e=s.GetObjectClass().GetFamilyInstanceVariableOffset(t.GetFamilyIndex())),s._GetInstanceVariableValueUnchecked(this._varIndex+e))}}class BehaviorExpressionNode extends C3$jscomp$134.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._behaviorType=this._objectClass.GetBehaviorTypeByName(t[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(t[2]),this._func=this._runtime.GetObjectReference(t[3]),this._returnsString=!!t[4],this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._owner._MaybeVaryFor(this._objectClass)}ExpBehavior(...e){const t=this._objectClass;var s=t.GetCurrentSol().GetExpressionInstances(),i=s.length;return 0===i?this._returnsString?"":0:(i=WrapIndex(this._owner.GetSolIndex(),i),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(t),s=s[i],i=0,t.IsFamily()&&(i=s.GetObjectClass().GetFamilyBehaviorOffset(t.GetFamilyIndex())),this._func.apply(s.GetBehaviorInstances()[this._behaviorIndex+i].GetSdkInstance(),e))}ExpBehavior_InstExpr(e,...t){const s=this._objectClass;var i=s.GetInstances();const r=i.length;return 0===r?this._returnsString?"":0:(e=WrapIndex(e,r),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(s),i=i[e],e=0,s.IsFamily()&&(e=i.GetObjectClass().GetFamilyBehaviorOffset(s.GetFamilyIndex())),this._func.apply(i.GetBehaviorInstances()[this._behaviorIndex+e].GetSdkInstance(),t))}}class EventVarExpNode extends C3$jscomp$134.ExpNode{constructor(e,t){super(e),this._eventVar=null,this._eventVarSid=t[1]}_PostInit(){this._eventVar=this._runtime.GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetVar(){return this._eventVar}}const C3$jscomp$135=self.C3;function GetExpressionFunc(e){if(!(e=self.C3_ExpressionFuncs[e]))throw Error("invalid expression number");return e}C3$jscomp$135.Parameter=class extends C3$jscomp$135.DefendedBase{constructor(e,t,s){super(),this._owner=e,this._index=s,this._type=t,this.Get=null,this._isConstant=this._variesPerInstance=!1}static Create(e,t,s){const i=t[0];return C3$jscomp$135.New([ExpressionParameter,StringExpressionParameter,FileParameter,ComboParameter,ObjectParameter,LayerExpressionParameter,LayoutParameter,ExpressionParameter,ComboParameter,ComboParameter,InstVarParameter,EventVarParameter,FileParameter,VariadicParameter,StringExpressionParameter,TimelineParameter,BooleanParameter,FunctionParameter,EaseParameter,TilemapBrushParameter,TemplateExpressionParameter][i],e,i,s,t)}_PostInit(){}SetVariesPerInstance(){this._variesPerInstance=!0}_MaybeVaryFor(e){this._variesPerInstance||!e||e.GetPlugin().IsSingleGlobal()||(this._variesPerInstance=!0)}VariesPerInstance(){return this._variesPerInstance}GetIndex(){return this._index}GetRuntime(){return this._owner.GetRuntime()}GetEventBlock(){return this._owner.GetEventBlock()}IsConstant(){return this._isConstant}};class ExpressionParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._solIndex=0,e=i[1],this._expressionNumber=e[0],this._numberedNodes=[],this._expressionFunc=null;for(let t=1,s=e.length;t<s;++t)this._numberedNodes.push(C3$jscomp$135.ExpNode.CreateNode(this,e[t]));this._numberedNodes.length?this.Get=this.GetExpression:(this.Get=GetExpressionFunc(this._expressionNumber),this._isConstant=!0)}_GetNode(e){if(0>e||e>=this._numberedNodes.length)throw new RangeError("invalid numbered node");return this._numberedNodes[e]}_PostInit(){for(var e of this._numberedNodes)e._PostInit();e=GetExpressionFunc(this._expressionNumber),this._expressionFunc=this._numberedNodes.length?e(this):e}GetSolIndex(){return this._solIndex}GetExpression(e){return this._solIndex=e,this._expressionFunc()}}class StringExpressionParameter extends ExpressionParameter{constructor(e,t,s,i){super(e,t,s,i),this.Get=this.GetStringExpression,14===t&&(this.GetEventBlock().SetAllSolModifiers(),this._owner instanceof C3$jscomp$135.Action&&this.GetEventBlock().SetSolWriterAfterCnds())}GetStringExpression(e){return this._solIndex=e,"string"==typeof(e=this._expressionFunc())?e:""}_GetFastTriggerValue(){return GetExpressionFunc(this._expressionNumber)()}}class LayerExpressionParameter extends ExpressionParameter{constructor(e,t,s,i){super(e,t,s,i),this.Get=this.GetLayer,this._isConstant=!1}GetLayer(e){return this._solIndex=e,e=this._expressionFunc(),this.GetRuntime().GetCurrentLayout().GetLayer(e)}}class ComboParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._combo=i[1],this.Get=this.GetCombo,this._isConstant=!0}GetCombo(){return this._combo}}class BooleanParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._bool=i[1],this.Get=this.GetBoolean,this._isConstant=!0}GetBoolean(){return this._bool}}class ObjectParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._objectClass=this.GetRuntime().GetObjectClassByIndex(i[1]),this.Get=this.GetObjectClass,(e=this.GetEventBlock())._AddSolModifier(this._objectClass),this._owner instanceof C3$jscomp$135.Action?e.SetSolWriterAfterCnds():e.GetParent()&&e.GetParent().SetSolWriterAfterCnds(),this._isConstant=!0}GetObjectClass(){return this._objectClass}}class LayoutParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._layout=this.GetRuntime().GetLayoutManager().GetLayoutByName(i[1]),this.Get=this.GetLayout,this._isConstant=!0}GetLayout(){return this._layout}}class TimelineParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._timeline=this.GetRuntime().GetTimelineManager().GetTimelineByName(i[1]),this.Get=this.GetTimeline,this._isConstant=!0}GetTimeline(){return this._timeline}}class FileParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._fileInfo=i[1],this.Get=this.GetFile,this._isConstant=!0}GetFile(){return this._fileInfo}}class InstVarParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._instVarIndex=i[1],e=this._owner.GetObjectClass(),this._owner instanceof C3$jscomp$135.Condition&&this._owner.IsStatic()?(this.Get=this.GetInstanceVariable,this._isConstant=!0):e&&e.IsFamily()?(this.Get=this.GetFamilyInstanceVariable,this.SetVariesPerInstance()):(this.Get=this.GetInstanceVariable,this._isConstant=!0)}GetInstanceVariable(){return this._instVarIndex}GetFamilyInstanceVariable(e){e=e||0;const t=this._owner.GetObjectClass();var s=t.GetCurrentSol();const i=s.GetInstances();if(i.length)e=i[e%i.length].GetObjectClass();else if(s.HasAnyElseInstances())e=(s=s.GetElseInstances())[e%s.length].GetObjectClass();else{if(!(0<t.GetInstanceCount()))return 0;e=(s=t.GetInstances())[e%s.length].GetObjectClass()}return this._instVarIndex+e.GetFamilyInstanceVariableOffset(t.GetFamilyIndex())}}class EventVarParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._eventVarSid=i[1],this._eventVar=null,this.Get=this.GetEventVariable,this._isConstant=!0}_PostInit(){this._eventVar=this.GetRuntime().GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetEventVariable(){return this._eventVar}}class FunctionParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._functionBlockName=i[1],this._functionBlock=null,this.Get=this.GetFunction,this._isConstant=!0}_PostInit(){this._functionBlock=this.GetRuntime().GetEventSheetManager().GetFunctionBlockByName(this._functionBlockName),this._functionBlockName=null}GetFunction(){return this._functionBlock}}class VariadicParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._subParams=[],this._variadicRet=[],this._isConstant=!0;for(let t=1,s=i.length;t<s;++t)e=C3$jscomp$135.Parameter.Create(this._owner,i[t],0),this._subParams.push(e),this._variadicRet.push(0),e.IsConstant()||(this._isConstant=!1);this.Get=this.GetVariadic}_PostInit(){for(const e of this._subParams)e._PostInit()}GetVariadic(){const e=this._subParams,t=this._variadicRet;for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(0);return t}}class EaseParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._easeIndex=i[1],this.Get=this.GetEase,this._isConstant=!0}GetEase(){return this._easeIndex}}class TilemapBrushParameter extends C3$jscomp$135.Parameter{constructor(e,t,s,i){super(e,t,s),this._brushIndex=i[1],this.Get=this.GetTilemapBrush,this._isConstant=!0}GetTilemapBrush(){return this._brushIndex}}class TemplateExpressionParameter extends ExpressionParameter{constructor(e,t,s,i){super(e,t,s,i),this.Get=this.GetTemplateName,this._isConstant=!1}GetTemplateName(){return this._expressionFunc()}}const C3$jscomp$136=self.C3;function EvalParams(e,t){for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(0)}const EMPTY_PARAMS_ARRAY=[],noop$jscomp$1=function(){};C3$jscomp$136.Condition=class extends C3$jscomp$136.DefendedBase{constructor(e,t,s){if(super(),this._eventBlock=e,this._runtime=e.GetRuntime(),this._index=s,this._func=this._runtime.GetObjectReference(t[1]),this._isTrigger=0<t[3],this._isFastTrigger=2===t[3],this._isLooping=!!t[4],this._isInverted=!!t[5],this._isStatic=!!t[6],this._sid=t[7],this._isInOrBlock=this._eventBlock.IsOrBlock(),this._behaviorType=this._objectClass=null,this._behaviorIndex=-1,this._systemPlugin=null,this.DebugRun=this.Run=noop$jscomp$1,this._parameters=[],this._results=[],this._anyParamVariesPerInstance=!1,this._unsavedData=this._savedData=null,this._debugData=this._runtime.IsDebug()?{isBreakpoint:t[8][0],canDebug:t[8][1]}:null,-1===t[0]?this._systemPlugin=this._runtime.GetSystemPlugin():(this._objectClass=this._runtime.GetObjectClassByIndex(t[0]),t[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(t[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(t[2])),this._eventBlock.GetParent()&&this._eventBlock.GetParent().SetSolWriterAfterCnds()),10===t.length){e=t[9];for(let t of e)this._parameters.push(C3$jscomp$136.Parameter.Create(this,t,this._parameters.length)),this._results.push(0)}0===this._parameters.length&&(this._results=this._parameters=EMPTY_PARAMS_ARRAY),this._eventBlock.GetEventSheetManager()._RegisterCondition(this)}static Create(e,t,s){return C3$jscomp$136.New(C3$jscomp$136.Condition,e,t,s)}_PostInit(){for(const e of this._parameters)e._PostInit(),e.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);this._isFastTrigger?(this.Run=this._RunFastTrigger,this.DebugRun=this._DebugRunFastTrigger):this._systemPlugin?(this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this._isStatic?(this.Run=this._RunStatic,this.DebugRun=this._DebugRunStatic):(this.Run=this._RunObject,this.DebugRun=this._DebugRunObject)}_SetSystemRunMethod(){this._SetRunMethodForBoundFunc(this._systemPlugin,this._systemPlugin,this._RunSystem)}_SetSingleGlobalRunMethod(){const e=this._objectClass.GetPlugin(),t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(e,t,this._RunSingleGlobal)}_SetRunMethodForBoundFunc(e,t,s){const i=this._func,r=this._isInverted,n=this._parameters;if(0===n.length){const s=e._GetBoundACEMethod(i,t);this.Run=r?function(){return C3$jscomp$136.xor(s(),r)}:s}else if(1===n.length){const s=n[0];if(!r&&s.IsConstant())this.Run=e._GetBoundACEMethod_1param(i,t,s.Get(0));else{const n=e._GetBoundACEMethod(i,t);this.Run=function(){return C3$jscomp$136.xor(n(s.Get(0)),r)}}}else if(2===n.length){const s=n[0],a=n[1];if(!r&&s.IsConstant()&&a.IsConstant())this.Run=e._GetBoundACEMethod_2params(i,t,s.Get(0),a.Get(0));else{const n=e._GetBoundACEMethod(i,t);this.Run=function(){return C3$jscomp$136.xor(n(s.Get(0),a.Get(0)),r)}}}else if(3===n.length){const s=n[0],a=n[1],o=n[2];if(!r&&s.IsConstant()&&a.IsConstant()&&o.IsConstant())this.Run=e._GetBoundACEMethod_3params(i,t,s.Get(0),a.Get(0),o.Get(0));else{const n=e._GetBoundACEMethod(i,t);this.Run=function(){return C3$jscomp$136.xor(n(s.Get(0),a.Get(0),o.Get(0)),r)}}}else this.Run=s}GetSID(){return this._sid}_GetFunc(){return this._func}GetObjectClass(){return this._objectClass}GetBehaviorType(){return this._behaviorType}GetEventBlock(){return this._eventBlock}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this.GetIndex()}IsTrigger(){return this._isTrigger}IsFastTrigger(){return this._isFastTrigger}IsInverted(){return this._isInverted}IsLooping(){return this._isLooping}IsStatic(){return this._isStatic}IsBreakpoint(){return this._debugData.isBreakpoint}_SetBreakpoint(e){this._debugData.isBreakpoint=!!e,this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}_RunSystem(){const e=this._results;return EvalParams(this._parameters,e),C3$jscomp$136.xor(this._func.apply(this._systemPlugin,e),this._isInverted)}*_DebugRunSystem(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var e=this._results;return EvalParams(this._parameters,e),e=this._func.apply(this._systemPlugin,e),C3$jscomp$136.IsIterator(e)&&(e=yield*e),C3$jscomp$136.xor(e,this._isInverted)}return this.Run()}_RunSingleGlobal(){const e=this._results;EvalParams(this._parameters,e);const t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();return C3$jscomp$136.xor(this._func.apply(t,e),this._isInverted)}*_DebugRunSingleGlobal(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var e=this._results;EvalParams(this._parameters,e);const t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();return e=this._func.apply(t,e),C3$jscomp$136.IsIterator(e)&&(e=yield*e),C3$jscomp$136.xor(e,this._isInverted)}return this.Run()}_RunFastTrigger(){return!0}*_DebugRunFastTrigger(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),!0}_RunStatic(){var e=this._results;return EvalParams(this._parameters,e),e=this._func.apply(this._behaviorType||this._objectClass,e),this._objectClass.ApplySolToContainer(),e}*_DebugRunStatic(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var e=this._results;return EvalParams(this._parameters,e),e=this._func.apply(this._behaviorType||this._objectClass,e),C3$jscomp$136.IsIterator(e)&&(e=yield*e),this._objectClass.ApplySolToContainer(),e}return this.Run()}_RunObject(){const e=this._parameters,t=this._results,s=this._objectClass.GetCurrentSol();for(let s=0,i=e.length;s<i;++s){const i=e[s];i.VariesPerInstance()||(t[s]=i.Get(0))}return s.IsSelectAll()?this._RunObject_FirstFilter(s):this._RunObject_NextFilter(s)}*_DebugRunObject(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._RunObject()}_EvaluateVaryingParameters(e){const t=this._parameters,s=this._results;for(let i=0,r=t.length;i<r;++i){const r=t[i];r.VariesPerInstance()&&(s[i]=r.Get(e))}}_RunObject_FirstFilter(e){const t=this._objectClass,s=t.IsFamily(),i=t.GetFamilyIndex(),r=this._behaviorIndex,n=0<=r,a=t.GetInstances(),o=this._anyParamVariesPerInstance,h=this._results,l=this._func,c=this._isInverted,u=this._isInOrBlock&&!this._isTrigger;e.ClearArrays();for(let t=0,_=a.length;t<_;++t){const _=a[t];o&&this._EvaluateVaryingParameters(t);var p=void 0;n?(p=s?_.GetObjectClass().GetFamilyBehaviorOffset(i):0,p=l.apply(_.GetBehaviorInstances()[r+p].GetSdkInstance(),h)):p=l.apply(_.GetSdkInstance(),h),C3$jscomp$136.xor(p,c)?e._PushInstance(_):u&&e._PushElseInstance(_)}return t.FinishCondition(!0),e._SetSelectAll(!1),t.ApplySolToContainer(),e.HasAnyInstances()}_RunObject_NextFilter(e){const t=this._objectClass;var s=t.IsFamily();const i=t.GetFamilyIndex(),r=t.IsInContainer(),n=this._behaviorIndex,a=0<=n,o=this._anyParamVariesPerInstance,h=this._results,l=this._func,c=this._isInverted,u=this._isInOrBlock&&!this._isTrigger,p=e._GetOwnInstances(),_=e._GetOwnElseInstances(),m=u&&!this._eventBlock.IsFirstConditionOfType(this),d=m?_:p;let g=0,f=!1;for(let e=0,t=d.length;e<t;++e){const t=d[e];o&&this._EvaluateVaryingParameters(e);var C=void 0;a?(C=s?t.GetObjectClass().GetFamilyBehaviorOffset(i):0,C=l.apply(t.GetBehaviorInstances()[n+C].GetSdkInstance(),h)):C=l.apply(t.GetSdkInstance(),h),C3$jscomp$136.xor(C,c)?(f=!0,m?(p.push(t),r&&t._PushSiblingsToSolInstances()):(d[g]=t,r&&t._SetSiblingsToSolInstancesIndex(g),++g)):m?(d[g]=t,r&&t._SetSiblingsToSolElseInstancesIndex(g),++g):u&&(_.push(t),r&&t._PushSiblingsToSolElseInstances())}return C3$jscomp$136.truncateArray(d,g),r&&t._TruncateContainerSols(m,g),s=f,m&&!f&&(f=this._OrBlockCheckInstances(p)),t.FinishCondition(s||u),u?f:e.HasAnyInstances()}_OrBlockCheckInstances(e){var t=this._objectClass;const s=t.IsFamily();t=t.GetFamilyIndex();const i=this._anyParamVariesPerInstance,r=this._behaviorIndex,n=0<=r,a=this._results,o=this._func,h=this._isInverted;for(let c=0,u=e.length;c<u;++c){var l=e[c];if(i&&this._EvaluateVaryingParameters(c),n){const e=s?l.GetObjectClass().GetFamilyBehaviorOffset(t):0;l=o.apply(l.GetBehaviorInstances()[r+e].GetSdkInstance(),a)}else l=o.apply(l.GetSdkInstance(),a);if(C3$jscomp$136.xor(l,h))return!0}return!1}ReevaluateParameter(e,t){return this._parameters[e].Get(t)}GetFastTriggerValue(){const e=this._parameters;if(!e.length)throw Error("no parameters");return e[0]._GetFastTriggerValue()}_SaveToJson(){if(!this._savedData||!this._savedData.size)return null;const e={};for(const[t,s]of this._savedData.entries()){let i=s;"collmemory"===t&&(i=[...s.entries()].map((e=>[e[0].GetUID(),e[1].GetUID(),e[2]]))),e[t]=i}return{ex:e}}_LoadFromJson(e){if(this._savedData&&(this._savedData.clear(),this._savedData=null),e){var t=this._runtime,s=e.ex;if(s){(e=this.GetSavedDataMap()).clear();for(const[i,r]of Object.entries(s))s=r,"collmemory"===i&&(s=C3$jscomp$136.New(C3$jscomp$136.PairMap,r.map((e=>[t.GetInstanceByUID(e[0]),t.GetInstanceByUID(e[1]),e[2]])).filter((e=>e[0]&&e[1])))),e.set(i,s)}}}};const C3$jscomp$137=self.C3;function EvalParams$jscomp$1(e,t){for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(0)}const EMPTY_PARAMS_ARRAY$jscomp$1=[],noop$jscomp$2=function(){},noopGenerator=function*(){};C3$jscomp$137.Action=class extends C3$jscomp$137.DefendedBase{constructor(e,t,s){super(),this._eventBlock=e,this._runtime=e=e.GetRuntime(),this._index=s,this._sid=4<=t.length?t[3]:-1,this._actionType=5<=t.length?255&t[4]:0,this._flags=5<=t.length?t[4]>>8:0,this._behaviorType=this._objectClass=this._func=null,this._behaviorIndex=-1,this._systemPlugin=null,this._callFunctionName="",this._callEventBlock=null,this.DebugRun=this.Run=noop$jscomp$2,this._parameters=[],this._results=[],this._anyParamVariesPerInstance=!1,this._unsavedData=this._savedData=null;const i=(s=-3===t[0])?t[2]:t[5];if(this._debugData=e.IsDebug()||s?{isBreakpoint:i[0],canDebug:i[1],index:i[2]}:null,-1===t[0]?(this._systemPlugin=e.GetSystemPlugin(),this._func=e.GetObjectReference(t[1])):-2===t[0]?this._callFunctionName=t[1]:s?(this._func=e.GetObjectReference(t[1]),this.Run=this.RunUserScript,this.DebugRun=this.DebugRunUserScript,this._actionType=1):(this._func=e.GetObjectReference(t[1]),this._objectClass=e.GetObjectClassByIndex(t[0]),t[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(t[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(t[2]))),7===t.length){t=t[6];for(const e of t)this._parameters.push(C3$jscomp$137.Parameter.Create(this,e,this._parameters.length)),this._results.push(0)}0===this._parameters.length&&(this._results=this._parameters=EMPTY_PARAMS_ARRAY$jscomp$1),this.CanPickAnyObjectClass()&&(this._eventBlock.SetAllSolModifiers(),this._eventBlock.SetSolWriterAfterCnds()),this._eventBlock.GetEventSheetManager()._RegisterAction(this)}static Create(e,t,s){return C3$jscomp$137.New(C3$jscomp$137.Action,e,t,s)}_PostInit(){for(var e of this._parameters)e._PostInit(),e.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);if(this._systemPlugin)this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem;else if(this._callFunctionName)this._SetCallFunctionRunMethod(),this._callFunctionName="";else if(this.Run===this.RunUserScript){e=this._func;const t=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this._eventBlock);this._func=e.bind(null,this._runtime.GetIRuntime(),t)}else this._behaviorType?this.IsAsync()?(this.Run=this._RunBehavior_Async,this.DebugRun=this._DebugRunBehavior_Async):(this.Run=this._RunBehavior,this.DebugRun=this._DebugRunBehavior):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this.IsAsync()?(this.Run=this._RunObject_Async,this.DebugRun=this._DebugRunObject_Async):this.CallBeforeAfterHooks()?(this.Run=this._RunObject_BeforeAfterHooks,this.DebugRun=this._DebugRunObject_BeforeAfterHooks):this._parameters.length?this._parameters.every((e=>e.VariesPerInstance()))?(this.Run=this._RunObject_AllParamsVary,this.DebugRun=this._DebugRunObject_AllParamsVary):this._anyParamVariesPerInstance?(this.Run=this._RunObject_SomeParamsVary,this.DebugRun=this._DebugRunObject_SomeParamsVary):this._parameters.every((e=>e.IsConstant()))?(EvalParams$jscomp$1(this._parameters,this._results),this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst):(this.Run=this._RunObject_ParamsDontVary,this.DebugRun=this._DebugRunObject_ParamsDontVary):(this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst)}_SetSystemRunMethod(){this._SetRunMethodForBoundFunc(this._systemPlugin,this._systemPlugin,this._RunSystem)}_SetSingleGlobalRunMethod(){const e=this._objectClass.GetPlugin(),t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(e,t,this._RunSingleGlobal)}_SetCallFunctionRunMethod(){const e=this._eventBlock.GetEventSheetManager(),t=e.GetFunctionBlockByName(this._callFunctionName);if(t.IsEnabled()){const s=0!=(2&this._flags);this._callEventBlock=t.GetEventBlock();let i=[...new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents()])];if(i=e._DeduplicateSolModifierList(i),this.Run=C3$jscomp$137.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,i,this._parameters,s),this._runtime.IsDebug()){const e=this;this.DebugRun=function*(){return(e.IsBreakpoint()||e._runtime.DebugBreakNext())&&(yield e),yield*e._callEventBlock.DebugRunAsFunctionCall(i,e._parameters,s)}}else this.DebugRun=noopGenerator}else this.Run=noop$jscomp$2,this.DebugRun=noopGenerator}_SetRunMethodForBoundFunc(e,t,s){const i=this._func,r=this._parameters;if(0===r.length)this.Run=e._GetBoundACEMethod(i,t);else if(1===r.length){const s=r[0];if(s.IsConstant())this.Run=e._GetBoundACEMethod_1param(i,t,s.Get(0));else{const r=e._GetBoundACEMethod(i,t);this.Run=function(){return r(s.Get(0))}}}else if(2===r.length){const s=r[0],n=r[1];if(s.IsConstant()&&n.IsConstant())this.Run=e._GetBoundACEMethod_2params(i,t,s.Get(0),n.Get(0));else{const r=e._GetBoundACEMethod(i,t);this.Run=function(){return r(s.Get(0),n.Get(0))}}}else if(3===r.length){const s=r[0],n=r[1],a=r[2];if(s.IsConstant()&&n.IsConstant()&&a.IsConstant())this.Run=e._GetBoundACEMethod_3params(i,t,s.Get(0),n.Get(0),a.Get(0));else{const r=e._GetBoundACEMethod(i,t);this.Run=function(){return r(s.Get(0),n.Get(0),a.Get(0))}}}else this.Run=s}GetSID(){return this._sid}IsAsync(){return 1===this._actionType}CanBailOut(){return 2===this._actionType}CallBeforeAfterHooks(){return 3===this._actionType}CanPickAnyObjectClass(){return 0!=(1&this._flags)}HasReturnType(){return this.IsAsync()||this.CanBailOut()}GetObjectClass(){return this._objectClass}GetEventBlock(){return this._eventBlock}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this._debugData.index}IsBreakpoint(){return this._debugData.isBreakpoint}_SetBreakpoint(e){this._debugData.isBreakpoint=!!e,this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}_RunSystem(){const e=this._results;return EvalParams$jscomp$1(this._parameters,e),this._func.apply(this._systemPlugin,e)}*_DebugRunSystem(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results;return EvalParams$jscomp$1(this._parameters,e),yield*this._func.apply(this._systemPlugin,e)}return this.Run()}_RunSingleGlobal(){const e=this._results;return EvalParams$jscomp$1(this._parameters,e),this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),e)}*_DebugRunSingleGlobal(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results;return EvalParams$jscomp$1(this._parameters,e),yield*this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),e)}return this.Run()}_RunObject_ParamsConst(){const e=this._results,t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)this._func.apply(t[s].GetSdkInstance(),e)}*_DebugRunObject_ParamsConst(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results,t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)yield*this._func.apply(t[s].GetSdkInstance(),e)}else this._RunObject_ParamsConst()}_RunObject_ParamsDontVary(){const e=this._results;EvalParams$jscomp$1(this._parameters,e);const t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)this._func.apply(t[s].GetSdkInstance(),e)}*_DebugRunObject_ParamsDontVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results;EvalParams$jscomp$1(this._parameters,e);const t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)yield*this._func.apply(t[s].GetSdkInstance(),e)}else this._RunObject_ParamsDontVary()}_RunObject_AllParamsVary(){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances();for(let r=0,n=i.length;r<n;++r){const n=i[r];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(r);s.apply(n.GetSdkInstance(),t)}}*_DebugRunObject_AllParamsVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances();for(let r=0,n=i.length;r<n;++r){const n=i[r];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(r);yield*s.apply(n.GetSdkInstance(),t)}}else this._RunObject_AllParamsVary()}_RunObject_SomeParamsVary(){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=e.length;s<i;++s){var r=e[s];r.VariesPerInstance()||(t[s]=r.Get(0))}for(let n=0,a=i.length;n<a;++n){r=i[n];for(let s=0,i=e.length;s<i;++s){const i=e[s];i.VariesPerInstance()&&(t[s]=i.Get(n))}s.apply(r.GetSdkInstance(),t)}}*_DebugRunObject_SomeParamsVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const t=this._parameters,s=this._results,i=this._func,r=this._objectClass.GetCurrentSol().GetInstances();for(let i=0,r=t.length;i<r;++i){var e=t[i];e.VariesPerInstance()||(s[i]=e.Get(0))}for(let n=0,a=r.length;n<a;++n){e=r[n];for(let e=0,i=t.length;e<i;++e){const i=t[e];i.VariesPerInstance()&&(s[e]=i.Get(n))}yield*i.apply(e.GetSdkInstance(),s)}}else this._RunObject_SomeParamsVary()}_RunObject_BeforeAfterHooks(){const e=this._parameters,t=this._results,s=this._func;var i=this._objectClass;const r=i.GetSdkType();i=i.GetCurrentSol().GetInstances(),r.BeforeRunAction(s);for(let r=0,n=i.length;r<n;++r){const n=i[r];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(r);s.apply(n.GetSdkInstance(),t)}r.AfterRunAction(s)}*_DebugRunObject_BeforeAfterHooks(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const t=this._parameters,s=this._results,i=this._func;var e=this._objectClass;const r=e.GetSdkType();e=e.GetCurrentSol().GetInstances(),r.BeforeRunAction(i);for(let r=0,n=e.length;r<n;++r){const n=e[r];for(let e=0,i=t.length;e<i;++e)s[e]=t[e].Get(r);yield*i.apply(n.GetSdkInstance(),s)}r.AfterRunAction(i)}else this._RunObject_BeforeAfterHooks()}_RunBehavior(){var e=this._objectClass;const t=e.IsFamily(),s=e.GetFamilyIndex(),i=this._parameters,r=this._anyParamVariesPerInstance,n=this._results,a=this._func,o=this._behaviorIndex;e=e.GetCurrentSol().GetInstances();for(let e=0,t=i.length;e<t;++e){var h=i[e];h.VariesPerInstance()||(n[e]=h.Get(0))}for(let c=0,u=e.length;c<u;++c){if(h=e[c],r)for(let e=0,t=i.length;e<t;++e){var l=i[e];l.VariesPerInstance()&&(n[e]=l.Get(c))}l=t?h.GetObjectClass().GetFamilyBehaviorOffset(s):0,a.apply(h.GetBehaviorInstances()[o+l].GetSdkInstance(),n)}}*_DebugRunBehavior(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var e=this._objectClass;const i=e.IsFamily(),r=e.GetFamilyIndex(),n=this._parameters,a=this._anyParamVariesPerInstance,o=this._results,h=this._func,l=this._behaviorIndex;e=e.GetCurrentSol().GetInstances();for(let e=0,s=n.length;e<s;++e){var t=n[e];t.VariesPerInstance()||(o[e]=t.Get(0))}for(let c=0,u=e.length;c<u;++c){if(t=e[c],a)for(let e=0,t=n.length;e<t;++e){var s=n[e];s.VariesPerInstance()&&(o[e]=s.Get(c))}s=i?t.GetObjectClass().GetFamilyBehaviorOffset(r):0,yield*h.apply(t.GetBehaviorInstances()[l+s].GetSdkInstance(),o)}}else this._RunBehavior()}_RunObject_Async(){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances(),r=[];for(let n=0,a=i.length;n<a;++n){const a=i[n];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(n);r.push(s.apply(a.GetSdkInstance(),t))}return Promise.all(r)}*_DebugRunObject_Async(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances(),r=[];for(let n=0,a=i.length;n<a;++n){const a=i[n];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(n);r.push(yield*s.apply(a.GetSdkInstance(),t))}return Promise.all(r)}return this._RunObject_Async()}_RunBehavior_Async(){var e=this._objectClass;const t=e.IsFamily(),s=e.GetFamilyIndex(),i=this._parameters,r=this._results,n=this._func,a=this._behaviorIndex,o=[];for(let h=0,l=(e=e.GetCurrentSol().GetInstances()).length;h<l;++h){const l=e[h];for(let e=0,t=i.length;e<t;++e)r[e]=i[e].Get(h);const c=t?l.GetObjectClass().GetFamilyBehaviorOffset(s):0;o.push(n.apply(l.GetBehaviorInstances()[a+c].GetSdkInstance(),r))}return Promise.all(o)}*_DebugRunBehavior_Async(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var e=this._objectClass;const t=e.IsFamily(),s=e.GetFamilyIndex(),i=this._parameters,r=this._results,n=this._func,a=this._behaviorIndex,o=[];for(let h=0,l=(e=e.GetCurrentSol().GetInstances()).length;h<l;++h){const l=e[h];for(let e=0,t=i.length;e<t;++e)r[e]=i[e].Get(h);const c=t?l.GetObjectClass().GetFamilyBehaviorOffset(s):0;o.push(yield*n.apply(l.GetBehaviorInstances()[a+c].GetSdkInstance(),r))}return Promise.all(o)}return this._RunBehavior_Async()}async RunUserScript(){try{await this._func()}catch(e){self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),C3$jscomp$137.EventScript.HadUserScriptException()||C3$jscomp$137.EventScript.SetHadUserScriptException()}}*DebugRunUserScript(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this.RunUserScript()}_SaveToJson(){return this._savedData&&this._savedData.size?{ex:C3$jscomp$137.ToSuperJSON(this._savedData)}:null}_LoadFromJson(e){this._savedData&&(this._savedData.clear(),this._savedData=null),e&&(e=e.ex)&&(this._savedData=C3$jscomp$137.FromSuperJSON(e))}};const C3$jscomp$138=self.C3,tempColor$jscomp$5=new C3$jscomp$138.Color;function CompareX(e,t){return C3$jscomp$138.compare(this.GetWorldInfo().GetX(),e,t)}function CompareY(e,t){return C3$jscomp$138.compare(this.GetWorldInfo().GetY(),e,t)}function IsOnScreen(){return this.GetWorldInfo().IsInViewport2()}function IsOutsideLayout(){var e=this.GetWorldInfo();const t=e.GetLayout();return 0>(e=e.GetBoundingBox()).getRight()||0>e.getBottom()||e.getLeft()>t.GetWidth()||e.getTop()>t.GetHeight()}function PickDistance(e,t,s){const i=this.GetCurrentSol(),r=i.GetInstances();if(!r.length)return!1;let n=r[0];var a=n.GetWorldInfo();let o=n,h=C3$jscomp$138.distanceSquared(a.GetX(),a.GetY(),t,s);for(let i=1,l=r.length;i<l;++i)n=r[i],a=n.GetWorldInfo(),a=C3$jscomp$138.distanceSquared(a.GetX(),a.GetY(),t,s),(0===e&&a<h||1===e&&a>h)&&(h=a,o=n);return i.PickOne(o),!0}function SetX(e){const t=this.GetWorldInfo();t.GetX()!==e&&(t.SetX(e),t.SetBboxChanged())}function SetY(e){const t=this.GetWorldInfo();t.GetY()!==e&&(t.SetY(e),t.SetBboxChanged())}function SetPos(e,t){const s=this.GetWorldInfo();s.EqualsXY(e,t)||(s.SetXY(e,t),s.SetBboxChanged())}function SetPosToObject(e,t){if(e&&(e=e.GetPairedInstance(this._inst))){var[s,i]=e.GetImagePoint(t);(t=this.GetWorldInfo()).GetX()===s&&t.GetY()===i||(t.SetXY(s,i),t.SetBboxChanged())}}function MoveForward(e){if(0!==e){var t=this.GetWorldInfo();t.OffsetXY(t.GetCosAngle()*e,t.GetSinAngle()*e),t.SetBboxChanged()}}function MoveAtAngle(e,t){if(0!==t){var s=this.GetWorldInfo();e=C3$jscomp$138.toRadians(e),s.OffsetXY(Math.cos(e)*t,Math.sin(e)*t),s.SetBboxChanged()}}function GetX(){return this.GetWorldInfo().GetX()}function GetY(){return this.GetWorldInfo().GetY()}function GetDt(){return this._runtime.GetDt(this._inst)}function CompareWidth(e,t){return C3$jscomp$138.compare(this.GetWorldInfo().GetWidth(),e,t)}function CompareHeight(e,t){return C3$jscomp$138.compare(this.GetWorldInfo().GetHeight(),e,t)}function SetWidth(e){const t=this.GetWorldInfo();t.GetWidth()!==e&&(t.SetWidth(e),t.SetBboxChanged())}function SetHeight(e){const t=this.GetWorldInfo();t.GetHeight()!==e&&(t.SetHeight(e),t.SetBboxChanged())}function SetSize(e,t){const s=this.GetWorldInfo();s.GetWidth()===e&&s.GetHeight()===t||(s.SetSize(e,t),s.SetBboxChanged())}function GetWidth(){return this.GetWorldInfo().GetWidth()}function GetHeight(){return this.GetWorldInfo().GetHeight()}function GetBboxLeft(){return this.GetWorldInfo().GetBoundingBox().getLeft()}function GetBboxTop(){return this.GetWorldInfo().GetBoundingBox().getTop()}function GetBboxRight(){return this.GetWorldInfo().GetBoundingBox().getRight()}function GetBboxBottom(){return this.GetWorldInfo().GetBoundingBox().getBottom()}function IsAngleWithin(e,t){return C3$jscomp$138.angleDiff(this.GetWorldInfo().GetAngle(),C3$jscomp$138.toRadians(t))<=C3$jscomp$138.toRadians(e)}function IsAngleClockwiseFrom(e){return C3$jscomp$138.angleClockwise(this.GetWorldInfo().GetAngle(),C3$jscomp$138.toRadians(e))}function IsBetweenAngles(e,t){e=C3$jscomp$138.toRadians(e),t=C3$jscomp$138.toRadians(t);const s=this.GetWorldInfo().GetAngle();return C3$jscomp$138.angleClockwise(t,e)?C3$jscomp$138.angleClockwise(s,e)&&!C3$jscomp$138.angleClockwise(s,t):!(!C3$jscomp$138.angleClockwise(s,e)&&C3$jscomp$138.angleClockwise(s,t))}function SetAngle(e){const t=this.GetWorldInfo();e=C3$jscomp$138.clampAngle(C3$jscomp$138.toRadians(e)),isNaN(e)||t.GetAngle()===e||(t.SetAngle(e),t.SetBboxChanged())}function RotateClockwise(e){if(!isNaN(e)&&0!==e){var t=this.GetWorldInfo();t.SetAngle(t.GetAngle()+C3$jscomp$138.toRadians(e)),t.SetBboxChanged()}}function RotateCounterclockwise(e){if(!isNaN(e)&&0!==e){var t=this.GetWorldInfo();t.SetAngle(t.GetAngle()-C3$jscomp$138.toRadians(e)),t.SetBboxChanged()}}function RotateTowardAngle(e,t){const s=this.GetWorldInfo(),i=s.GetAngle();e=C3$jscomp$138.angleRotate(i,C3$jscomp$138.toRadians(t),C3$jscomp$138.toRadians(e)),isNaN(e)||i===e||(s.SetAngle(e),s.SetBboxChanged())}function RotateTowardPosition(e,t,s){const i=this.GetWorldInfo(),r=i.GetAngle();t-=i.GetX(),s-=i.GetY(),e=C3$jscomp$138.angleRotate(r,Math.atan2(s,t),C3$jscomp$138.toRadians(e)),isNaN(e)||r===e||(i.SetAngle(e),i.SetBboxChanged())}function SetTowardPosition(e,t){const s=this.GetWorldInfo(),i=s.GetAngle();e-=s.GetX(),t-=s.GetY(),t=Math.atan2(t,e),isNaN(t)||i===t||(s.SetAngle(t),s.SetBboxChanged())}function GetAngle(){return C3$jscomp$138.toDegrees(this.GetWorldInfo().GetAngle())}function CompareOpacity(e,t){return C3$jscomp$138.compare(C3$jscomp$138.round6dp(100*this.GetWorldInfo().GetOpacity()),e,t)}function IsVisible(){return this.GetWorldInfo().IsVisible()}function SetVisible(e){const t=this.GetWorldInfo();e=2===e?!t.IsVisible():0!==e,t.IsVisible()!==e&&(t.SetVisible(e),this._runtime.UpdateRender())}function SetOpacity(e){e=C3$jscomp$138.clamp(e/100,0,1);const t=this.GetWorldInfo();t.GetOpacity()!==e&&(t.SetOpacity(e),this._runtime.UpdateRender())}function SetDefaultColor(e){tempColor$jscomp$5.setFromRgbValue(e),(e=this.GetWorldInfo()).GetUnpremultipliedColor().equalsIgnoringAlpha(tempColor$jscomp$5)||(e.SetUnpremultipliedColor(tempColor$jscomp$5),this._runtime.UpdateRender())}function GetColor(){const e=this.GetWorldInfo().GetUnpremultipliedColor();return C3$jscomp$138.PackRGBAEx(e.getR(),e.getG(),e.getB(),e.getA())}function GetOpacity(){return C3$jscomp$138.round6dp(100*this.GetWorldInfo().GetOpacity())}function IsOnLayer(e){return!!e&&this.GetWorldInfo().GetLayer()===e}function PickTopBottom(e){const t=this.GetCurrentSol(),s=t.GetInstances();if(!s.length)return!1;let i=s[0];for(let t=1,r=s.length;t<r;++t){const r=s[t],n=r.GetWorldInfo(),a=i.GetWorldInfo(),o=n.GetLayer().GetIndex(),h=a.GetLayer().GetIndex();0===e?(o>h||o===h&&n.GetZIndex()>a.GetZIndex())&&(i=r):(o<h||o===h&&n.GetZIndex()<a.GetZIndex())&&(i=r)}return t.PickOne(i),!0}function CompareZElevation(e,t,s){const i=this.GetWorldInfo();return e=0===e?i.GetZElevation():i.GetTotalZElevation(),C3$jscomp$138.compare(e,t,s)}function MoveToTop(){this.GetWorldInfo().ZOrderMoveToTop()}function MoveToBottom(){this.GetWorldInfo().ZOrderMoveToBottom()}function MoveToLayer(e){e&&this.GetWorldInfo().ZOrderMoveToLayer(e)}function ZMoveToObject(e,t){e=0===e,t&&(t=t.GetFirstPicked(this.GetInstance()))&&this.GetWorldInfo().ZOrderMoveAdjacentToInstance(t,e)}function SetZElevation(e){const t=this.GetWorldInfo();t.GetZElevation()!==e&&(t.SetZElevation(e),this._runtime.UpdateRender())}function LayerNumber(){return this.GetWorldInfo().GetLayer().GetIndex()}function LayerName(){return this.GetWorldInfo().GetLayer().GetName()}function ZIndex(){return this.GetWorldInfo().GetZIndex()}function ZElevation(){return this.GetWorldInfo().GetZElevation()}function TotalZElevation(){return this.GetWorldInfo().GetTotalZElevation()}function IsEffectEnabled(e){if(e=this.GetObjectClass().GetEffectList().GetEffectTypeByName(e))return e=e.GetIndex(),this.GetWorldInfo().GetInstanceEffectList().IsEffectIndexActive(e)}function SetEffectEnabled(e,t){if(t=this.GetObjectClass().GetEffectList().GetEffectTypeByName(t)){t=t.GetIndex(),e=1===e;var s=this.GetWorldInfo().GetInstanceEffectList();s.IsEffectIndexActive(t)!==e&&(s.SetEffectIndexActive(t,e),s.UpdateActiveEffects(),this._runtime.UpdateRender())}}function SetEffectParam(e,t,s){if(e=this.GetObjectClass().GetEffectList().GetEffectTypeByName(e)){t=Math.floor(t);var i=e.GetShaderProgram().GetParameterType(t);i&&("color"===i?(tempColor$jscomp$5.setFromRgbValue(s),s=tempColor$jscomp$5):"percent"===i&&(s/=100),e=e.GetIndex(),(i=this.GetWorldInfo().GetInstanceEffectList()).SetEffectParameter(e,t,s)&&i.IsEffectIndexActive(e)&&this._runtime.UpdateRender())}}const tempRect$jscomp$4=C3$jscomp$138.New(C3$jscomp$138.Rect),tempCandidates1=[],tempCandidates2=[];let needsCollisionFinish=!1,rPickType=null,rPickFromElseInstances=!1;const rToPick=new Set;function CollMemory_Add(e,t,s,i){t.GetUID()<s.GetUID()?e.Set(t,s,i):e.Set(s,t,i)}function CollMemory_Remove(e,t,s){t.GetUID()<s.GetUID()?e.Delete(t,s):e.Delete(s,t)}function CollMemory_RemoveInstance(e,t){e.DeleteEither(t)}function CollMemory_Get(e,t,s){return t.GetUID()<s.GetUID()?e.Get(t,s):e.Get(s,t)}function DoOverlapCondition(e,t,s,i){if(!t)return!1;const r=0!==s||0!==i,n=(e=e.GetInstance()).GetWorldInfo(),a=e.GetRuntime(),o=a.GetCollisionEngine();var h=a.GetCurrentCondition();const l=h.GetEventBlock().IsOrBlock();var c=h.GetObjectClass();h=h.IsInverted();const u=t.GetCurrentSol();rPickType=t,needsCollisionFinish=(c=c!==t)&&!h,rPickFromElseInstances=!1;let p=0,_=0,m=!1;u.IsSelectAll()?(tempRect$jscomp$4.copy(n.GetBoundingBox()),tempRect$jscomp$4.offset(s,i),o.GetCollisionCandidates(n.GetLayer(),t,tempRect$jscomp$4,tempCandidates2),t=tempCandidates2):l?a.IsCurrentConditionFirst()&&!u._GetOwnElseInstances().length&&u._GetOwnInstances().length?t=u._GetOwnInstances():(t=u._GetOwnElseInstances(),rPickFromElseInstances=!0):t=u._GetOwnInstances(),r&&(p=n.GetX(),_=n.GetY(),n.OffsetXY(s,i),n.SetBboxChanged());for(const s of t)if(o.TestOverlap(e,s)){if(m=!0,h)break;c&&rToPick.add(s)}return r&&(n.SetXY(p,_),n.SetBboxChanged()),C3$jscomp$138.clearArray(tempCandidates2),m}function FinishCollisionConditionPicking(e){e=e.GetRuntime().GetCurrentEvent().IsOrBlock();const t=rPickType.GetCurrentSol(),s=t._GetOwnInstances(),i=t._GetOwnElseInstances();t.IsSelectAll()?(t.SetSetPicked(rToPick),e&&(C3$jscomp$138.clearArray(i),t.AddElseInstances(rToPick,rPickType.GetInstances()))):e?rPickFromElseInstances?t.TransferElseInstancesToOwn(rToPick):(t.AddElseInstances(rToPick,s),t.SetSetPicked(rToPick)):t.SetSetPicked(rToPick),rPickType.ApplySolToContainer()}function FinishCollisionCondition(e,t){needsCollisionFinish&&(t&&FinishCollisionConditionPicking(e),rToPick.clear(),rPickType=null,needsCollisionFinish=!1)}function OnCollision(e){if(this._runtime.IsDebugging())return DebugOnCollision.call(this,e);if(!e)return!1;var t=this._runtime;const s=t.GetCollisionEngine(),i=t.GetEventSheetManager(),r=i.GetEventStack();var n=i.GetCurrentCondition();const a=n.GetObjectClass();var o=n.GetSavedDataMap(),h=n.GetUnsavedDataMap();n=r.GetCurrentStackFrame();const l=t.GetTickCount(),c=l-1,u=n.GetCurrentEvent(),p=r.Push(u);let _=o.get("collmemory");_||(_=C3$jscomp$138.New(C3$jscomp$138.PairMap),o.set("collmemory",_)),h.get("collisionCreatedDestroyCallback")||(h.set("collisionCreatedDestroyCallback",!0),t.Dispatcher().addEventListener("instancedestroy",(e=>CollMemory_RemoveInstance(_,e.instance)))),o=a.GetCurrentSol(),t=e.GetCurrentSol(),o=o.GetInstances(),h=null;for(let r=0;r<o.length;++r){const f=o[r];t.IsSelectAll()?(s.GetCollisionCandidates(f.GetWorldInfo().GetLayer(),e,f.GetWorldInfo().GetBoundingBox(),tempCandidates1),h=tempCandidates1,s.AddRegisteredCollisionCandidates(f,e,h)):h=t.GetInstances();for(let t=0;t<h.length;++t){const r=h[t];if(s.TestOverlap(f,r)||s.CheckRegisteredCollision(f,r)){var m=CollMemory_Get(_,f,r),d=!1,g=-2;"number"==typeof m&&(d=!0,g=m),m=!d||g<c,CollMemory_Add(_,f,r,l),m&&(m=u.GetSolModifiers(),i.PushCopySol(m),g=a.GetCurrentSol(),d=e.GetCurrentSol(),g._SetSelectAll(!1),d._SetSelectAll(!1),a===e?(d=g._GetOwnInstances(),C3$jscomp$138.clearArray(d),d.push(f),d.push(r),a.ApplySolToContainer()):(g=g._GetOwnInstances(),d=d._GetOwnInstances(),C3$jscomp$138.clearArray(g),C3$jscomp$138.clearArray(d),g.push(f),d.push(r),a.ApplySolToContainer(),e.ApplySolToContainer()),u.Retrigger(n,p),i.PopSol(m))}else CollMemory_Remove(_,f,r)}C3$jscomp$138.clearArray(tempCandidates1)}return r.Pop(),!1}function*DebugOnCollision(e){if(!e)return!1;var t=this._runtime;const s=t.GetCollisionEngine(),i=t.GetEventSheetManager(),r=i.GetEventStack();var n=i.GetCurrentCondition();const a=n.GetObjectClass();var o=n.GetSavedDataMap(),h=n.GetUnsavedDataMap();n=r.GetCurrentStackFrame();const l=t.GetTickCount(),c=l-1,u=n.GetCurrentEvent(),p=r.Push(u);let _=o.get("collmemory");_||(_=C3$jscomp$138.New(C3$jscomp$138.PairMap),o.set("collmemory",_)),h.get("collisionCreatedDestroyCallback")||(h.set("collisionCreatedDestroyCallback",!0),t.Dispatcher().addEventListener("instancedestroy",(e=>CollMemory_RemoveInstance(_,e.instance)))),o=a.GetCurrentSol(),t=e.GetCurrentSol(),o=o.GetInstances(),h=null;for(let r=0;r<o.length;++r){const f=o[r];t.IsSelectAll()?(s.GetCollisionCandidates(f.GetWorldInfo().GetLayer(),e,f.GetWorldInfo().GetBoundingBox(),tempCandidates1),h=tempCandidates1,s.AddRegisteredCollisionCandidates(f,e,h)):h=t.GetInstances();for(let t=0;t<h.length;++t){const r=h[t];if(s.TestOverlap(f,r)||s.CheckRegisteredCollision(f,r)){var m=CollMemory_Get(_,f,r),d=!1,g=-2;"number"==typeof m&&(d=!0,g=m),m=!d||g<c,CollMemory_Add(_,f,r,l),m&&(m=u.GetSolModifiers(),i.PushCopySol(m),g=a.GetCurrentSol(),d=e.GetCurrentSol(),g._SetSelectAll(!1),d._SetSelectAll(!1),a===e?(d=g._GetOwnInstances(),C3$jscomp$138.clearArray(d),d.push(f),d.push(r),a.ApplySolToContainer()):(g=g._GetOwnInstances(),d=d._GetOwnInstances(),C3$jscomp$138.clearArray(g),C3$jscomp$138.clearArray(d),g.push(f),d.push(r),a.ApplySolToContainer(),e.ApplySolToContainer()),yield*u.DebugRetrigger(n,p),i.PopSol(m))}else CollMemory_Remove(_,f,r)}C3$jscomp$138.clearArray(tempCandidates1)}return r.Pop(),!1}function IsOverlapping(e){return DoOverlapCondition(this,e,0,0)}function IsOverlappingOffset(e,t,s){return DoOverlapCondition(this,e,t,s)}function HasParent(){return this.GetWorldInfo().HasParent()}function HasChildren(){return this.GetWorldInfo().HasChildren()}function PickParent(e,t){const s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;const i=e.GetCurrentSol();var r=i.GetInstances();if(0===r.length)return!1;r=new Set(r);const n=new Set;for(let i=0,o=s.length;i<o;++i){var a=s[i];if(1===t)for(const t of a.parents())t.BelongsToObjectClass(e)&&r.has(t)&&n.add(t);else{if(0===t){if(null===(a=a.GetParent()))continue}else a=a.GetTopParent();a.BelongsToObjectClass(e)&&r.has(a)&&n.add(a)}}return 0!==n.size&&(i.SetSetPicked(n),e.ApplySolToContainer(),!0)}function PickChildren(e,t){const s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;const i=e.GetCurrentSol();var r=i.GetInstances();if(i.IsSelectAll()){var n=[...this._runtime.instancesPendingCreateForObjectClass(e)];0<n.length&&(r=r.concat(n))}if(0===r.length)return!1;r=new Set(r),n=new Set;for(let i=0,a=s.length;i<a;++i){const a=s[i];2===t&&!a.HasChildren()&&a.BelongsToObjectClass(e)&&r.has(a)&&n.add(a);for(const s of 0===t?a.children():a.allChildren())2===t&&s.HasChildren()||s.BelongsToObjectClass(e)&&r.has(s)&&n.add(s)}return 0!==n.size&&(i.SetSetPicked(n),e.ApplySolToContainer(),!0)}function PickNthChild(e,t){const s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;const i=e.GetCurrentSol();var r=i.GetInstances();if(i.IsSelectAll()){var n=[...this._runtime.instancesPendingCreateForObjectClass(e)];0<n.length&&(r=r.concat(n))}if(0===r.length)return!1;r=new Set(r),n=[];for(let i=0,a=s.length;i<a;++i){const a=s[i].GetChildAt(t);null!==a&&a.BelongsToObjectClass(e)&&r.has(a)&&n.push(a)}return 0!==n.length&&(i.SetArrayPicked(n),e.ApplySolToContainer(),!0)}function CompareChildCount(e,t,s){switch(e){default:return C3$jscomp$138.compare(this._inst.GetChildCount(),t,s);case 1:return C3$jscomp$138.compare(this._inst.GetAllChildCount(),t,s)}}function AddChild(e,t,s,i,r,n,a,o){const h=this._inst,l=this._runtime.GetCurrentAction().GetObjectClass();for(const c of e.allCorrespondingInstances(h,l)){if(!c.GetPlugin().SupportsSceneGraph())break;h.AddChild(c,{transformX:t,transformY:s,transformWidth:i,transformHeight:r,transformAngle:n,transformZElevation:a,destroyWithParent:o})}}function RemoveChild(e){const t=this._inst,s=this._runtime.GetCurrentAction().GetObjectClass();for(const i of e.allCorrespondingInstances(t,s))t.RemoveChild(i)}function RemoveFromParent(){this._inst.HasParent()&&this._inst.GetParent().RemoveChild(this._inst)}function ChildCount(){return this._inst.GetChildCount()}function AllChildCount(){return this._inst.GetAllChildCount()}function SetMeshSize(e,t){e=Math.floor(e),t=Math.floor(t);const s=this.GetWorldInfo();2>e||2>t||!isFinite(e)||!isFinite(t)?(s.ReleaseMesh(),s.SetBboxChanged()):s.CreateMesh(e,t)}function SetMeshPoint(e,t,s,i,r,n,a,o){const h=this.GetWorldInfo();h.SetMeshPoint(e,t,{mode:0===s?"absolute":"relative",x:i,y:r,zElevation:n,u:a,v:o})&&h.SetBboxChanged()}function MeshColumns(){const e=this.GetWorldInfo();return e.HasMesh()?e.GetSourceMesh().GetHSize():0}function MeshRows(){const e=this.GetWorldInfo();return e.HasMesh()?e.GetSourceMesh().GetVSize():0}function SetElementVisible(e){const t=this.GetWorldInfo();e=2===e?!t.IsVisible():0!==e,t.IsVisible()!==e&&t.SetVisible(e)}function SetElementCSSStyle(e,t){this.SetElementCSSStyle(e,t)}function SetElementAttribute(e,t){this.SetElementAttribute(e,""+t)}function RemoveElementAttribute(e){this.RemoveElementAttribute(e)}function SetElementFocus(){this.FocusElement()}function SetElementBlur(){this.BlurElement()}function IsElementFocused(){return this.IsElementFocused()}function SetElementEnabled(e){this._SetEnabled(0!==e)}function IsElementEnabled(){return this._IsEnabled()}function CompareInstanceVar(e,t,s){return C3$jscomp$138.compare(this.GetInstance().GetInstanceVariableValue(e),t,s)}function IsBoolInstanceVarSet(e){return!!this.GetInstance().GetInstanceVariableValue(e)}function TemplateName(){const e=this._runtime.GetTemplateManager();return e?e.GetInstanceTemplateName(this.GetInstance()):""}function PickInstVarHiLow(e,t){const s=this.GetCurrentSol(),i=s.GetInstances();if(!i.length)return!1;const r=this.IsFamily();let n=null,a=0;for(let s=0,h=i.length;s<h;++s){const h=i[s];var o=r?h.GetObjectClass().GetFamilyInstanceVariableOffset(this.GetFamilyIndex()):0;o=h.GetInstanceVariableValue(o+t),(null===n||0===e&&o<a||1===e&&o>a)&&(a=o,n=h)}return s.PickOne(n),!0}function PickByUID(e){return this._runtime.GetCurrentCondition().IsInverted()?PickByUID_Inverted(this,e):PickByUID_Normal(this,e)}function PickByUID_Normal(e,t){if(!(t=e.GetRuntime().GetInstanceByUID(t)))return!1;const s=e.GetCurrentSol();if(!s.IsSelectAll()&&!s._GetOwnInstances().includes(t))return!1;if(e.IsFamily()){if(t.GetObjectClass().BelongsToFamily(e))return s.PickOne(t),e.ApplySolToContainer(),!0}else if(t.GetObjectClass()===e)return s.PickOne(t),e.ApplySolToContainer(),!0;return!1}function PickByUID_Inverted(e,t){const s=e.GetCurrentSol();if(s.IsSelectAll()){s._SetSelectAll(!1),s.ClearArrays();var i=e.GetInstances();for(let e=0,n=i.length;e<n;++e){var r=i[e];r.GetUID()===t?s._PushElseInstance(r):s._PushInstance(r)}return e.ApplySolToContainer(),!!s._GetOwnInstances().length}r=0;for(let e=0,n=(i=s._GetOwnInstances()).length;e<n;++e){const n=i[e];i[r]=n,n.GetUID()===t?s._PushElseInstance(n):++r}return C3$jscomp$138.truncateArray(i,r),e.ApplySolToContainer(),!!i.length}function Destroy(){this._runtime.DestroyInstance(this._inst)}function OnCreated(){return!0}function OnDestroyed(){return!0}function SetInstanceVar(e,t){this.GetInstance().SetInstanceVariableValue(e,t)}function AddInstanceVar(e,t){const s=this.GetInstance(),i=s.GetInstanceVariableValue(e);"number"==typeof i&&"number"!=typeof t?t=parseFloat(t):"string"==typeof i&&"string"!=typeof t&&(t=t.toString()),s.SetInstanceVariableValue(e,i+t)}function SubInstanceVar(e,t){const s=this.GetInstance(),i=s.GetInstanceVariableValue(e);"number"==typeof i&&("number"!=typeof t&&(t=parseFloat(t)),s.SetInstanceVariableValue(e,i-t))}function SetBoolInstanceVar(e,t){this.GetInstance().SetInstanceVariableValue(e,t?1:0)}function ToggleBoolInstanceVar(e){const t=this.GetInstance();t.SetInstanceVariableValue(e,0===t.GetInstanceVariableValue(e)?1:0)}function LoadFromJsonString(e){try{var t=JSON.parse(e)}catch(e){return}(e=this.GetInstance())._OnBeforeLoad("state"),e.LoadFromJson(t,"state"),(t=C3$jscomp$138.New(C3$jscomp$138.Event,"afterloadinstance")).instance=e,this._runtime.Dispatcher().dispatchEvent(t)}function AsJSON(){return JSON.stringify(this.GetInstance().SaveToJson("state"))}function ObjectTypeName(){return this.GetInstance().GetObjectClass().GetName()}function Count(){const e=this._runtime.GetCurrentEventStackFrame().GetExpressionObjectClass();let t=e.GetInstanceCount();for(const s of this._runtime.instancesPendingCreateForObjectClass(e))++t;return t}function PickedCount(){return this._runtime.GetCurrentEventStackFrame().GetExpressionObjectClass().GetCurrentSol().GetInstances().length}function GetIID(){return this._inst.GetIID()}function GetUID(){return this._inst.GetUID()}C3$jscomp$138.AddCommonACEs=function(e,t){const s=e[1],i=e[4],r=e[5],n=e[6],a=e[7],o=e[8],h=e[10],l=e[11],c=e[12],u=e[13],p=e[14],_=e[15],m=e[16],d=t.Cnds,g=t.Acts,f=t.Exps;e[3]&&(d.CompareX=CompareX,d.CompareY=CompareY,d.IsOnScreen=IsOnScreen,d.IsOutsideLayout=IsOutsideLayout,d.PickDistance=PickDistance,g.SetX=SetX,g.SetY=SetY,g.SetPos=SetPos,g.SetPosToObject=SetPosToObject,g.MoveForward=MoveForward,g.MoveAtAngle=MoveAtAngle,f.X=GetX,f.Y=GetY,f.dt=GetDt),i&&(d.CompareWidth=CompareWidth,d.CompareHeight=CompareHeight,g.SetWidth=SetWidth,g.SetHeight=SetHeight,g.SetSize=SetSize,f.Width=GetWidth,f.Height=GetHeight,f.BBoxLeft=GetBboxLeft,f.BBoxTop=GetBboxTop,f.BBoxRight=GetBboxRight,f.BBoxBottom=GetBboxBottom),r&&(d.AngleWithin=IsAngleWithin,d.IsClockwiseFrom=IsAngleClockwiseFrom,d.IsBetweenAngles=IsBetweenAngles,g.SetAngle=SetAngle,g.RotateClockwise=RotateClockwise,g.RotateCounterclockwise=RotateCounterclockwise,g.RotateTowardAngle=RotateTowardAngle,g.RotateTowardPosition=RotateTowardPosition,g.SetTowardPosition=SetTowardPosition,f.Angle=GetAngle),n&&(d.IsVisible=IsVisible,d.CompareOpacity=CompareOpacity,g.SetVisible=SetVisible,g.SetOpacity=SetOpacity,g.SetDefaultColor=SetDefaultColor,f.Opacity=GetOpacity,f.ColorValue=GetColor),a&&(d.IsOnLayer=IsOnLayer,d.PickTopBottom=PickTopBottom,d.CompareZElevation=CompareZElevation,g.MoveToTop=MoveToTop,g.MoveToBottom=MoveToBottom,g.MoveToLayer=MoveToLayer,g.ZMoveToObject=ZMoveToObject,g.SetZElevation=SetZElevation,f.LayerNumber=LayerNumber,f.LayerName=LayerName,f.ZIndex=ZIndex,f.ZElevation=ZElevation,f.TotalZElevation=TotalZElevation),o&&(d.IsEffectEnabled=IsEffectEnabled,g.SetEffectEnabled=SetEffectEnabled,g.SetEffectParam=SetEffectParam),u&&(d.HasParent=HasParent,d.HasChildren=HasChildren,d.PickParent=PickParent,d.PickChildren=PickChildren,d.PickNthChild=PickNthChild,d.CompareChildCount=CompareChildCount,g.AddChild=AddChild,g.RemoveChild=RemoveChild,g.RemoveFromParent=RemoveFromParent,f.ChildCount=ChildCount,f.AllChildCount=AllChildCount),p&&(g.SetMeshSize=SetMeshSize,g.SetMeshPoint=SetMeshPoint,f.MeshColumns=MeshColumns,f.MeshRows=MeshRows),h&&(d.IsVisible=IsVisible,g.SetVisible=SetElementVisible,g.SetCSSStyle=SetElementCSSStyle,g.SetElemAttribute=SetElementAttribute,g.RemoveElemAttribute=RemoveElementAttribute),l&&(d.IsFocused=IsElementFocused,g.SetFocus=SetElementFocus,g.SetBlur=SetElementBlur),c&&(d.IsEnabled=IsElementEnabled,g.SetEnabled=SetElementEnabled),_&&(d.OnCollision=OnCollision,d.IsOverlapping=IsOverlapping,d.IsOverlappingOffset=IsOverlappingOffset,t.FinishCollisionCondition=FinishCollisionCondition),s||(d.CompareInstanceVar=CompareInstanceVar,d.IsBoolInstanceVarSet=IsBoolInstanceVarSet,d.PickInstVarHiLow=PickInstVarHiLow,d.PickByUID=PickByUID,g.SetInstanceVar=SetInstanceVar,g.AddInstanceVar=AddInstanceVar,g.SubInstanceVar=SubInstanceVar,g.SetBoolInstanceVar=SetBoolInstanceVar,g.ToggleBoolInstanceVar=ToggleBoolInstanceVar,d.OnCreated=OnCreated,d.OnDestroyed=OnDestroyed,g.Destroy=Destroy,g.LoadFromJsonString||(g.LoadFromJsonString=LoadFromJsonString),f.AsJSON||(f.AsJSON=AsJSON),f.Count=Count,f.PickedCount=PickedCount,f.IID=GetIID,f.UID=GetUID,f.ObjectTypeName=ObjectTypeName),m&&(f.TemplateName=TemplateName)};const C3$jscomp$139=self.C3;C3$jscomp$139.ScheduledWait=class extends C3$jscomp$139.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._type="",this._time=-1,this._signalTag="",this._isSignalled=!1,this._event=null,this._actIndex=0,this._solModifiers=[],this._sols=new Map,this._callingFunctionBlock=null,this._asyncId=-1,this._functionInnerLocalVars=this._functionParameters=null,this._shouldRelease=!1}Release(){this._type="",this._time=-1,this._signalTag="",this._functionInnerLocalVars=this._functionParameters=this._callingFunctionBlock=this._event=null,this._asyncId=-1,C3$jscomp$139.clearArray(this._solModifiers);for(const e of this._sols.values())e.Release();this._sols.clear()}_Init(){var e=this._eventSheetManager,t=e.GetRuntime().GetAllObjectClasses();const s=e.GetCurrentEventStackFrame();this._event=s.GetCurrentEvent(),this._actIndex=s.GetActionIndex()+1,(e=e.FindFirstFunctionBlockParent(this._event))&&(this._callingFunctionBlock=e,this._functionParameters=e.CaptureFunctionParameters(),this._functionInnerLocalVars=e._GetAllInnerLocalVariables().map((e=>e.GetValue())),e.IsAsync()&&(this._asyncId=e.PauseCurrentAsyncFunction()));for(const e of t)(!(t=e.GetCurrentSol()).IsSelectAll()||this._event.HasSolModifier(e))&&(this._solModifiers.push(e),this._sols.set(e,C3$jscomp$139.New(C3$jscomp$139.SolState,t)))}InitTimer(e){this._type="timer",this._Init(),this._time=this._eventSheetManager.GetRuntime().GetGameTime()+e}InitSignal(e){this._type="signal",this._Init(),this._signalTag=e.toLowerCase()}InitPromise(e){this._type="promise",this._Init(),e.then((()=>this.SetSignalled())).catch((e=>{this.SetSignalled()}))}IsTimer(){return"timer"===this._type}IsSignal(){return"signal"===this._type}IsPromise(){return"promise"===this._type}GetSignalTag(){return this._signalTag}IsSignalled(){return this._isSignalled}SetSignalled(){this._isSignalled=!0}_ShouldRun(){return this.IsTimer()?this._time<=this._eventSheetManager.GetRuntime().GetGameTime():this.IsSignalled()}_RestoreState(e){e._Restore(this._event,this._actIndex);for(const[t,s]of this._sols.entries())e=t.GetCurrentSol(),s._Restore(e);(e=this._callingFunctionBlock)&&(e.SetFunctionParameters(this._functionParameters),e._GetAllInnerLocalVariables().map(((e,t)=>e.SetValue(this._functionInnerLocalVars[t]))),e.IsAsync()&&e.ResumeAsyncFunction(this._asyncId))}_Run(e){this._RestoreState(e),this._event._ResumeActionsAndSubEvents(e),this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId),this._eventSheetManager.ClearSol(this._solModifiers),this._shouldRelease=!0}async _DebugRun(e){this._RestoreState(e);for(const t of this._event._DebugResumeActionsAndSubEvents(e))await this._eventSheetManager.GetRuntime().DebugBreak(t);this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId),this._eventSheetManager.ClearSol(this._solModifiers),this._shouldRelease=!0}ShouldRelease(){return this._shouldRelease}RemoveInstances(e){for(const t of this._sols.values())t.RemoveInstances(e)}_SaveToJson(){const e={},t={t:this._time,st:this._signalTag,s:this._isSignalled,ev:this._event.GetSID(),sm:this._solModifiers.map((e=>e.GetSID())),sols:e};this._event._HasActionIndex(this._actIndex)&&(t.act=this._event.GetActionAt(this._actIndex).GetSID());for(const[t,s]of this._sols)e[t.GetSID().toString()]=s._SaveToJson();return t}static _CreateFromJson(e,t){const s=e.GetRuntime();var i=e.GetEventBlockBySID(t.ev);if(!i)return null;let r=0;if(t.hasOwnProperty("act")){var n=e.GetActionBySID(t.act);if(!n)return null;r=n.GetIndex()}for(var a of((n=C3$jscomp$139.New(C3$jscomp$139.ScheduledWait,e))._time=t.t,n._type=-1===n._time?"signal":"timer",n._signalTag=t.st,n._isSignalled=t.s,n._event=i,n._actIndex=r,t.sm))(i=s.GetObjectClassBySID(a))&&n._solModifiers.push(i);for(const[i,r]of Object.entries(t.sols))t=parseInt(i,10),(t=s.GetObjectClassBySID(t))&&((a=C3$jscomp$139.New(C3$jscomp$139.SolState,null))._LoadFromJson(e,r),n._sols.set(t,a));return n}};const C3$jscomp$140=self.C3;C3$jscomp$140.SolState=class extends C3$jscomp$140.DefendedBase{constructor(e){super(),this._objectClass=null,this._isSelectAll=!0,this._instances=[],e&&(this._objectClass=e.GetObjectClass(),this._isSelectAll=e.IsSelectAll(),C3$jscomp$140.shallowAssignArray(this._instances,e._GetOwnInstances()))}Release(){this._objectClass=null,C3$jscomp$140.clearArray(this._instances)}_Restore(e){e._SetSelectAll(this._isSelectAll),C3$jscomp$140.shallowAssignArray(e._GetOwnInstances(),this._instances)}RemoveInstances(e){C3$jscomp$140.arrayRemoveAllInSet(this._instances,e)}_SaveToJson(){return{sa:this._isSelectAll,insts:this._instances.map((e=>e.GetUID()))}}_LoadFromJson(e,t){e=e.GetRuntime(),this._isSelectAll=!!t.sa,C3$jscomp$140.clearArray(this._instances);for(const s of t.insts)(t=e.GetInstanceByUID(s))&&this._instances.push(t)}};const C3$jscomp$141=self.C3;function GetNextParamMap(e,t){let s=e.get(t);return s||(s=new Map,e.set(t,s)),s}C3$jscomp$141.SDKPluginBase=class extends C3$jscomp$141.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._isSingleGlobal=!!e.isSingleGlobal,this._isWorldType=!!e.isWorld,this._isRotatable=!!e.isRotatable,this._mustPredraw=!!e.mustPredraw,this._hasEffects=!!e.hasEffects,this._supportsSceneGraph=!!e.supportsSceneGraph,this._supportsMesh=!!e.supportsMesh,this._singleGlobalObjectClass=null,this._boundACEMethodCache=new Map,this._boundACEMethodCache_1param=new Map,this._boundACEMethodCache_2params=new Map,this._boundACEMethodCache_3params=new Map}Release(){this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}IsSingleGlobal(){return this._isSingleGlobal}IsWorldType(){return this._isWorldType}IsRotatable(){return this._isRotatable}MustPreDraw(){return this._mustPredraw}HasEffects(){return this._hasEffects}SupportsSceneGraph(){return this._supportsSceneGraph}SupportsMesh(){return this._supportsMesh}_GetBoundACEMethod(e,t){if(!t)throw Error("missing 'this' binding");let s=this._boundACEMethodCache.get(e);return s||(s=e.bind(t),this._boundACEMethodCache.set(e,s),s)}_GetBoundACEMethod_1param(e,t,s){if(!t)throw Error("missing 'this' binding");const i=GetNextParamMap(this._boundACEMethodCache_1param,e);let r=i.get(s);return r||(r=e.bind(t,s),i.set(s,r),r)}_GetBoundACEMethod_2params(e,t,s,i){if(!t)throw Error("missing 'this' binding");var r=GetNextParamMap(this._boundACEMethodCache_2params,e);let n=(r=GetNextParamMap(r,s)).get(i);return n||(n=e.bind(t,s,i),r.set(i,n),n)}_GetBoundACEMethod_3params(e,t,s,i,r){if(!t)throw Error("missing 'this' binding");var n=GetNextParamMap(this._boundACEMethodCache_3params,e);n=GetNextParamMap(n,s);let a=(n=GetNextParamMap(n,i)).get(r);return a||(a=e.bind(t,s,i,r),n.set(r,a),a)}_SetSingleGlobalObjectClass(e){if(!this.IsSingleGlobal())throw Error("must be single-global plugin");this._singleGlobalObjectClass=e}GetSingleGlobalObjectClass(){if(!this.IsSingleGlobal())throw Error("must be single-global plugin");return this._singleGlobalObjectClass}GetSingleGlobalInstance(){if(!this.IsSingleGlobal())throw Error("must be single-global plugin");return this._singleGlobalObjectClass.GetSingleGlobalInstance()}};const C3$jscomp$142=self.C3;C3$jscomp$142.SDKDOMPluginBase=class extends C3$jscomp$142.SDKPluginBase{constructor(e,t){super(e),this._domComponentId=t,this._nextElementId=0,this._instMap=new Map,this.AddElementMessageHandler("elem-focused",(e=>e._OnElemFocused())),this.AddElementMessageHandler("elem-blurred",(e=>{e&&e._OnElemBlurred()}))}Release(){super.Release()}_AddElement(e){const t=this._nextElementId++;return this._instMap.set(t,e),t}_RemoveElement(e){this._instMap.delete(e)}AddElementMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,(e=>{const s=this._instMap.get(e.elementId);t(s,e)}))}};const C3$jscomp$143=self.C3;C3$jscomp$143.SDKTypeBase=class extends C3$jscomp$143.DefendedBase{constructor(e){super(),this._objectClass=e,this._runtime=e.GetRuntime(),this._plugin=e.GetPlugin()}Release(){this._plugin=this._runtime=this._objectClass=null}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetImageInfo(){return this._objectClass.GetImageInfo()}OnCreate(){}FinishCondition(e){}BeforeRunAction(e){}AfterRunAction(e){}LoadTextures(e){}ReleaseTextures(){}OnDynamicTextureLoadComplete(){}PreloadTexturesWithInstances(e){}LoadTilemapData(){}GetScriptInterfaceClass(){return null}DispatchScriptEvent(e,t,s){(e=C3$jscomp$143.New(C3$jscomp$143.Event,e,t)).objectClass=this,s&&Object.assign(e,s),this.GetObjectClass().DispatchUserScriptEvent(e)}};const C3$jscomp$144=self.C3;C3$jscomp$144.SDKInstanceBase=class extends C3$jscomp$144.DefendedBase{constructor(e,t){super(),this._inst=e,this._domComponentId=t,this._runtime=e.GetRuntime(),this._objectClass=this._inst.GetObjectClass(),this._sdkType=this._objectClass.GetSdkType(),this._tick2Func=this._tickFunc=null,this._isTicking2=this._isTicking=!1,this._disposables=null,this._wasReleased=!1}Release(){this._wasReleased=!0,this._StopTicking(),this._StopTicking2(),this._tick2Func=this._tickFunc=null,this._disposables&&(this._disposables.Release(),this._disposables=null),this._sdkType=this._objectClass=this._runtime=this._inst=null}WasReleased(){return this._wasReleased}GetInstance(){return this._inst}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetPlugin(){return this._sdkType.GetPlugin()}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._inst.GetInterfaceClass()}Trigger(e){return this._runtime.Trigger(e,this._inst,null)}DebugTrigger(e){return this._runtime.DebugTrigger(e,this._inst,null)}TriggerAsync(e){return this._runtime.TriggerAsync(e,this._inst,null)}FastTrigger(e,t){return this._runtime.FastTrigger(e,this._inst,t)}DebugFastTrigger(e,t){return this._runtime.DebugFastTrigger(e,this._inst,t)}ScheduleTriggers(e){return this._runtime.ScheduleTriggers(e)}AddDOMMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,t)}AddDOMMessageHandlers(e){for(const[t,s]of e)this.AddDOMMessageHandler(t,s)}PostToDOM(e,t){this._runtime.PostComponentMessageToDOM(this._domComponentId,e,t)}PostToDOMAsync(e,t){return this._runtime.PostComponentMessageToDOMAsync(this._domComponentId,e,t)}_PostToDOMMaybeSync(e,t){if(!this._runtime.IsInWorker())return window.c3_runtimeInterface._OnMessageFromRuntime({type:"event",component:this._domComponentId,handler:e,data:t,responseId:null});this.PostToDOM(e,t)}Tick(){}Tick2(){}_StartTicking(){this._isTicking||(this._tickFunc||(this._tickFunc=()=>this.Tick()),this._runtime.Dispatcher().addEventListener("tick",this._tickFunc),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime.Dispatcher().removeEventListener("tick",this._tickFunc),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._tick2Func||(this._tick2Func=()=>this.Tick2()),this._runtime.Dispatcher().addEventListener("tick2",this._tick2Func),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime.Dispatcher().removeEventListener("tick2",this._tick2Func),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}GetDebuggerProperties(){return[]}SaveToJson(){return null}LoadFromJson(e){}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}OffsetPropertyValueByIndex(e,t){if(0!==t){var s=this.GetPropertyValueByIndex(e);if("number"!=typeof s)throw Error("expected number");this.SetPropertyValueByIndex(e,s+t)}}SetPropertyColorOffsetValueByIndex(e,t,s,i){}CallAction(e,...t){e.call(this,...t)}CallExpression(e,...t){return e.call(this,...t)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(e,t,s){if(this._inst.HasScriptInterface()){var i=this.GetScriptInterface();(e=C3$jscomp$144.New(C3$jscomp$144.Event,e,t)).instance=i,s&&Object.assign(e,s),i.dispatchEvent(e)}}};const C3$jscomp$145=self.C3;C3$jscomp$145.SDKWorldInstanceBase=class extends C3$jscomp$145.SDKInstanceBase{constructor(e,t){super(e,t),this._worldInfo=e.GetWorldInfo(),this._renderercontextrestored_handler=this._renderercontextlost_handler=null}Release(){if(this._renderercontextlost_handler){const e=this._runtime.Dispatcher();e.removeEventListener("renderercontextlost",this._renderercontextlost_handler),e.removeEventListener("renderercontextrestored",this._renderercontextrestored_handler),this._renderercontextrestored_handler=this._renderercontextlost_handler=null}this._worldInfo=null,super.Release()}HandleWebGLContextLoss(){this.HandleRendererContextLoss()}OnWebGLContextLost(){}OnWebGLContextRestored(){}HandleRendererContextLoss(){if(!this._renderercontextlost_handler){this._renderercontextlost_handler=()=>this.OnRendererContextLost(),this._renderercontextrestored_handler=()=>this.OnRendererContextRestored();var e=this._runtime.Dispatcher();e.addEventListener("rendererontextlost",this._renderercontextlost_handler),e.addEventListener("renderercontextrestored",this._renderercontextrestored_handler)}}OnRendererContextLost(){this.OnWebGLContextLost()}OnRendererContextRestored(){this.OnWebGLContextRestored()}GetWorldInfo(){return this._worldInfo}IsOriginalSizeKnown(){return!1}GetOriginalWidth(){if(!this.IsOriginalSizeKnown())throw Error("original size not known");const e=this.GetCurrentImageInfo();if(e)return e.GetWidth()}GetOriginalHeight(){if(!this.IsOriginalSizeKnown())throw Error("original size not known");const e=this.GetCurrentImageInfo();if(e)return e.GetHeight()}GetCurrentImageInfo(){return null}GetCurrentSurfaceSize(){var e=this.GetCurrentImageInfo();return e&&(e=e.GetTexture())?[e.GetWidth(),e.GetHeight()]:[100,100]}GetCurrentTexRect(){const e=this.GetCurrentImageInfo();return e?e.GetTexRect():null}GetCurrentTexQuad(){const e=this.GetCurrentImageInfo();return e?e.GetTexQuad():null}IsCurrentTexRotated(){const e=this.GetCurrentImageInfo();return!!e&&e.IsRotated()}GetImagePoint(e){return[(e=this._inst.GetWorldInfo()).GetX(),e.GetY()]}LoadTilemapData(e,t,s){}TestPointOverlapTile(e,t){}RendersToOwnZPlane(){return!0}};const C3$jscomp$146=self.C3,tempRect$jscomp$5=C3$jscomp$146.New(C3$jscomp$146.Rect);C3$jscomp$146.SDKDOMInstanceBase=class extends C3$jscomp$146.SDKWorldInstanceBase{constructor(e,t){super(e,t),this._elementId=this.GetPlugin()._AddElement(this),this._isElementShowing=!0,this._autoFontSize=this._elemHasFocus=!1,this._autoFontSizeOffset=-.2,this._lastRect=C3$jscomp$146.New(C3$jscomp$146.Rect,0,0,-1,-1),e=this._runtime.GetCanvasManager(),this._lastWindowWidth=e.GetLastWidth(),this._lastWindowHeight=e.GetLastHeight(),this._isPendingUpdateState=!1,this._StartTicking()}Release(){this.GetPlugin()._RemoveElement(this._elementId),this.PostToDOMElement("destroy"),this._elementId=-1,super.Release()}_GetElementInDOMMode(){if(this._runtime.IsInWorker())throw Error("not valid in worker mode");return this._PostToDOMElementMaybeSync("get-element")}PostToDOMElement(e,t){t||(t={}),t.elementId=this._elementId,this.PostToDOM(e,t)}_PostToDOMElementMaybeSync(e,t){return t||(t={}),t.elementId=this._elementId,this._PostToDOMMaybeSync(e,t)}PostToDOMElementAsync(e,t){return t||(t={}),t.elementId=this._elementId,this.PostToDOMAsync(e,t)}CreateElement(e){e||(e={});const t=this.GetWorldInfo().IsVisible();e.elementId=this._elementId,e.isVisible=t,Object.assign(e,this.GetElementState()),this._isElementShowing=!!e.isVisible,this._PostToDOMMaybeSync("create",e),this._UpdatePosition(!0)}SetElementVisible(e){e=!!e,this._isElementShowing!==e&&(this._isElementShowing=e,this.PostToDOMElement("set-visible",{isVisible:e}))}Tick(){this._UpdatePosition(!1)}_ShouldPreserveElement(){const e=this._runtime.GetCanvasManager().GetFullscreenMode();return"Android"===C3$jscomp$146.Platform.OS&&("scale-inner"===e||"scale-outer"===e||"crop"===e)}_UpdatePosition(e){var t=this.GetWorldInfo();const s=t.GetLayer();var i=t.GetBoundingBox();let[r,n]=s.LayerToCanvasCss(i.getLeft(),i.getTop()),[a,o]=s.LayerToCanvasCss(i.getRight(),i.getBottom());var h=(i=this._runtime.GetCanvasManager()).GetCssWidth();const l=i.GetCssHeight();if(t.IsVisible()&&s.IsVisible()){if(!this._ShouldPreserveElement()){if(0>=a||0>=o||r>=h||n>=l)return void this.SetElementVisible(!1);1>r&&(r=1),1>n&&(n=1),a>=h&&(a=h-1),o>=l&&(o=l-1)}tempRect$jscomp$5.set(r,n,a,o),t=i.GetLastWidth(),h=i.GetLastHeight(),!e&&tempRect$jscomp$5.equals(this._lastRect)&&this._lastWindowWidth===t&&this._lastWindowHeight===h?this.SetElementVisible(!0):(this._lastRect.copy(tempRect$jscomp$5),this._lastWindowWidth=t,this._lastWindowHeight=h,this.SetElementVisible(!0),e=null,this._autoFontSize&&(e=s.GetDisplayScale()+this._autoFontSizeOffset),this.PostToDOMElement("update-position",{left:Math.round(this._lastRect.getLeft())+i.GetCanvasClientX(),top:Math.round(this._lastRect.getTop())+i.GetCanvasClientY(),width:Math.round(this._lastRect.width()),height:Math.round(this._lastRect.height()),fontSize:e}))}else this.SetElementVisible(!1)}FocusElement(){this._PostToDOMElementMaybeSync("focus",{focus:!0})}BlurElement(){this._PostToDOMElementMaybeSync("focus",{focus:!1})}_OnElemFocused(){this._elemHasFocus=!0}_OnElemBlurred(){this._elemHasFocus=!1}IsElementFocused(){return this._elemHasFocus}SetElementCSSStyle(e,t){this.PostToDOMElement("set-css-style",{prop:C3$jscomp$146.CSSToCamelCase(e),val:t})}SetElementAttribute(e,t){this.PostToDOMElement("set-attribute",{name:e,val:t})}RemoveElementAttribute(e){this.PostToDOMElement("remove-attribute",{name:e})}UpdateElementState(){this._isPendingUpdateState||(this._isPendingUpdateState=!0,Promise.resolve().then((()=>{this._isPendingUpdateState=!1,this.PostToDOMElement("update-state",this.GetElementState())})))}GetElementState(){}GetElementId(){return this._elementId}};const C3$jscomp$147=self.C3,IBehavior$jscomp$1=self.IBehavior;C3$jscomp$147.SDKBehaviorBase=class extends C3$jscomp$147.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._myObjectClasses=C3$jscomp$147.New(C3$jscomp$147.ArraySet),this._myInstances=C3$jscomp$147.New(C3$jscomp$147.ArraySet),this._iBehavior=null,this._scriptInterfaceClass=e.scriptInterfaceClass||null}Release(){this._myInstances.Release(),this._myObjectClasses.Release(),this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}_AddObjectClass(e){this._myObjectClasses.Add(e)}GetObjectClasses(){return this._myObjectClasses.GetArray()}_AddInstance(e){this._myInstances.Add(e)}_RemoveInstance(e){this._myInstances.Delete(e)}GetInstances(){return this._myInstances.GetArray()}GetIBehavior(){if(null===this._iBehavior){const e=this._scriptInterfaceClass;if(e){if(this._iBehavior=new e(this),!(this._iBehavior instanceof IBehavior$jscomp$1))throw new TypeError("script interface class must derive from IBehavior")}else this._iBehavior=new IBehavior$jscomp$1(this)}return this._iBehavior}};const C3$jscomp$148=self.C3;C3$jscomp$148.SDKBehaviorTypeBase=class extends C3$jscomp$148.DefendedBase{constructor(e){super(),this._runtime=e.GetRuntime(),this._behaviorType=e,this._objectClass=e.GetObjectClass(),this._behavior=e.GetBehavior(),this._behavior._AddObjectClass(this._objectClass)}Release(){this._behavior=this._objectClass=this._behaviorType=this._runtime=null}OnCreate(){}GetBehaviorType(){return this._behaviorType}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetBehavior(){return this._behavior}};const C3$jscomp$149=self.C3;C3$jscomp$149.SDKBehaviorInstanceBase=class extends C3$jscomp$149.DefendedBase{constructor(e,t){super(),this._behInst=e,this._domComponentId=t,this._inst=e.GetObjectInstance(),this._runtime=e.GetRuntime(),this._behaviorType=e.GetBehaviorType(),this._sdkType=this._behaviorType.GetSdkType(),this._isPostTicking=this._isTicking2=this._isTicking=!1,this._disposables=null}Release(){this._StopTicking(),this._StopTicking2(),this._StopPostTicking(),this._disposables&&(this._disposables.Release(),this._disposables=null),this._sdkType=this._behaviorType=this._runtime=this._inst=this._behInst=null}GetBehavior(){return this._behaviorType.GetBehavior()}GetBehaviorInstance(){return this._behInst}GetObjectInstance(){return this._inst}GetObjectClass(){return this._inst.GetObjectClass()}GetWorldInfo(){return this._inst.GetWorldInfo()}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._behInst.GetScriptInterface()}Trigger(e){return this._runtime.Trigger(e,this._inst,this._behaviorType)}DebugTrigger(e){return this._runtime.DebugTrigger(e,this._inst,this._behaviorType)}TriggerAsync(e){return this._runtime.TriggerAsync(e,this._inst,this._behaviorType)}PostCreate(){}Tick(){}Tick2(){}PostTick(){}_StartTicking(){this._isTicking||(this._runtime._AddBehInstToTick(this),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime._RemoveBehInstToTick(this),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._runtime._AddBehInstToTick2(this),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime._RemoveBehInstToTick2(this),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}_StartPostTicking(){this._isPostTicking||(this._runtime._AddBehInstToPostTick(this),this._isPostTicking=!0)}_StopPostTicking(){this._isPostTicking&&(this._runtime._RemoveBehInstToPostTick(this),this._isPostTicking=!1)}IsPostTicking(){return this._isPostTicking}GetDebuggerProperties(){return[]}AddDOMMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,t)}OnSpriteFrameChanged(e,t){}SaveToJson(){return null}LoadFromJson(e){}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}OffsetPropertyValueByIndex(e,t){if(0!==t){var s=this.GetPropertyValueByIndex(e);if("number"!=typeof s)throw Error("expected number");this.SetPropertyValueByIndex(e,s+t)}}SetPropertyColorOffsetValueByIndex(e,t,s,i){}CallAction(e,...t){e.call(this,...t)}CallExpression(e,...t){return e.call(this,...t)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(e,t,s){if(this._behInst.HasScriptInterface()){var i=this.GetScriptInterface();(e=C3$jscomp$149.New(C3$jscomp$149.Event,e,t)).behaviorInstance=i,e.instance=i.instance,s&&Object.assign(e,s),i.dispatchEvent(e)}}};const C3$jscomp$150=self.C3;C3$jscomp$150.Plugins={},C3$jscomp$150.Behaviors={},C3$jscomp$150.PluginManager=class extends C3$jscomp$150.DefendedBase{constructor(e){super(),this._runtime=e,this._allPlugins=[],this._pluginsByCtor=new Map,this._systemPlugin=null,this._allBehaviors=[],this._behaviorsByCtor=new Map,this._jumpthruBehavior=this._solidBehavior=null}CreatePlugin(e){const t=this._runtime.GetObjectReference(e[0]);if(!t)throw Error("missing plugin");C3$jscomp$150.AddCommonACEs(e,t),(e=C3$jscomp$150.New(t,{runtime:this._runtime,isSingleGlobal:e[1],isWorld:e[2],isRotatable:e[5],hasEffects:e[8],mustPredraw:e[9],supportsSceneGraph:e[13],supportsMesh:e[14]})).OnCreate(),this._allPlugins.push(e),this._pluginsByCtor.set(t,e)}CreateSystemPlugin(){this._systemPlugin=C3$jscomp$150.New(C3$jscomp$150.Plugins.System,{runtime:this._runtime,isSingleGlobal:!0}),this._systemPlugin.OnCreate()}CreateBehavior(e){if(!(e=this._runtime.GetObjectReference(e[1])))throw Error("missing behavior");const t=C3$jscomp$150.New(e,{runtime:this._runtime});t.OnCreate(),this._allBehaviors.push(t),this._behaviorsByCtor.set(e,t),!this._solidBehavior&&C3$jscomp$150.Behaviors.solid&&t instanceof C3$jscomp$150.Behaviors.solid?this._solidBehavior=t:!this._jumpthruBehavior&&C3$jscomp$150.Behaviors.jumpthru&&t instanceof C3$jscomp$150.Behaviors.jumpthru&&(this._jumpthruBehavior=t)}GetPluginByConstructorFunction(e){return this._pluginsByCtor.get(e)||null}HasBehaviorByConstructorFunction(e){return this._behaviorsByCtor.has(e)}GetBehaviorByConstructorFunction(e){return this._behaviorsByCtor.get(e)||null}GetSystemPlugin(){return this._systemPlugin}GetSolidBehavior(){return this._solidBehavior}GetJumpthruBehavior(){return this._jumpthruBehavior}};const C3$jscomp$151=self.C3,allImageInfos=new Set;C3$jscomp$151.ImageInfo=class extends C3$jscomp$151.DefendedBase{constructor(){super(),this._generation=0,this._url="",this._height=this._width=this._offsetY=this._offsetX=this._size=0,this._hasMetaData=this._isRotated=!1,this._imageAsset=null,this._textureState="",this._rcTex=C3$jscomp$151.New(C3$jscomp$151.Rect),this._quadTex=C3$jscomp$151.New(C3$jscomp$151.Quad),this._blobUrl="",this._iImageInfo=new self.IImageInfo(this),allImageInfos.add(this)}Release(){this.ReleaseTexture(),this._imageAsset=null,allImageInfos.delete(this),this.ReleaseBlobURL()}static OnRendererContextLost(){for(const e of allImageInfos)e._textureState="",e._rcTex.set(0,0,0,0),e._quadTex.setFromRect(e._rcTex)}LoadData(e){this._url=e[0],this._size=e[1],this._offsetX=e[2],this._offsetY=e[3],this._width=e[4],this._height=e[5],this._isRotated=e[6],this._hasMetaData=!0}LoadDynamicAsset(e,t){if(this._imageAsset)throw Error("already loaded asset");this._url=t;const s={};return C3$jscomp$151.IsAbsoluteURL(t)&&(s.loadPolicy="remote"),this.LoadAsset(e,s),this._imageAsset.Load()}ReplaceWith(e){if(e===this)throw Error("cannot replace with self");this._generation++,this.ReleaseTexture(),this._url=e._url,this._size=e._size,this._offsetX=e._offsetX,this._offsetY=e._offsetY,this._width=e._width,this._height=e._height,this._isRotated=e._isRotated,this._hasMetaData=e._hasMetaData,this._imageAsset=e._imageAsset,this._textureState=e._textureState,this._rcTex=e._rcTex,this._quadTex=e._quadTex,this.ReleaseBlobURL()}GetURL(){return this._url}GetSize(){return this._size}GetOffsetX(){return this._offsetX}GetOffsetY(){return this._offsetY}IsRotated(){return this._isRotated}GetWidth(){return this._width}GetHeight(){return this._height}GetSheetWidth(){return this._imageAsset.GetWidth()}GetSheetHeight(){return this._imageAsset.GetHeight()}LoadAsset(e,t){if(this._imageAsset)throw Error("already got asset");t=Object.assign({},t,{url:this.GetURL(),size:this.GetSize()}),this._imageAsset=e.LoadImage(t)}IsLoaded(){return this._imageAsset&&this._imageAsset.IsLoaded()}async LoadStaticTexture(e,t){if(!this._imageAsset)throw Error("no asset");if(this._textureState)throw Error("already loaded texture");const s=this._generation;this._textureState="loading";const i=this._imageAsset;return e=await i.LoadStaticTexture(e,t),this._generation!==s?(i.ReleaseTexture(),null):e?(this._textureState="loaded",this._hasMetaData||(this._width=e.GetWidth(),this._height=e.GetHeight(),this._hasMetaData=!0),this._rcTex.set(this._offsetX,this._offsetY,this._offsetX+(this._isRotated?this._height:this._width),this._offsetY+(this._isRotated?this._width:this._height)),this._rcTex.divide(e.GetWidth(),e.GetHeight()),this._quadTex.setFromRect(this._rcTex),this._isRotated&&this._quadTex.rotatePointsAnticlockwise(),e):(this._textureState="",null)}ReleaseTexture(){this._textureState&&(this._imageAsset&&this._imageAsset.ReleaseTexture(),this._textureState="",this._rcTex.set(0,0,0,0),this._quadTex.setFromRect(this._rcTex))}GetTexture(){return this._imageAsset?this._imageAsset.GetTexture():null}GetTexRect(){return this._rcTex}GetTexQuad(){return this._quadTex}GetIImageInfo(){return this._iImageInfo}async ExtractImageToCanvas(){const e=await this._imageAsset.LoadToDrawable(),t=C3$jscomp$151.CreateCanvas(this._width,this._height),s=t.getContext("2d");return this._isRotated?(s.rotate(Math.PI/-2),s.translate(-this._height,0),s.drawImage(e,this._offsetX,this._offsetY,this._height,this._width,0,0,this._height,this._width)):s.drawImage(e,this._offsetX,this._offsetY,this._width,this._height,0,0,this._width,this._height),t}async ExtractImageToBlobURL(){if(this._blobUrl)return this._blobUrl;var e=await this.ExtractImageToCanvas();return e=await C3$jscomp$151.CanvasToBlob(e),this._blobUrl=URL.createObjectURL(e)}ReleaseBlobURL(){this._blobUrl&&(URL.revokeObjectURL(this._blobUrl),this._blobUrl="")}};const C3$jscomp$152=self.C3;C3$jscomp$152.AnimationInfo=class extends C3$jscomp$152.DefendedBase{constructor(e){super(),this._name=e[0],this._speed=e[1],this._isLooping=!!e[2],this._repeatCount=e[3],this._repeatTo=e[4],this._isPingPong=!!e[5],this._sid=e[6],this._frames=e[7].map((e=>C3$jscomp$152.New(C3$jscomp$152.AnimationFrameInfo,e))),this._iAnimation=new self.IAnimation(this)}Release(){for(const e of this._frames)e.Release();C3$jscomp$152.clearArray(this._frames)}LoadAllAssets(e){for(const t of this._frames)t.GetImageInfo().LoadAsset(e)}LoadAllTextures(e,t){return Promise.all(this._frames.map((s=>s.GetImageInfo().LoadStaticTexture(e,t))))}ReleaseAllTextures(){for(const e of this._frames)e.GetImageInfo().ReleaseTexture()}GetName(){return this._name}GetSID(){return this._sid}GetFrameCount(){return this._frames.length}GetFrames(){return this._frames}GetFrameAt(e){if(0>(e=Math.floor(e))||e>=this._frames.length)throw new RangeError("invalid frame");return this._frames[e]}GetSpeed(){return this._speed}IsLooping(){return this._isLooping}GetRepeatCount(){return this._repeatCount}GetRepeatTo(){return this._repeatTo}IsPingPong(){return this._isPingPong}GetIAnimation(){return this._iAnimation}};const C3$jscomp$153=self.C3;C3$jscomp$153.AnimationFrameInfo=class extends C3$jscomp$153.DefendedBase{constructor(e){super(),this._imageInfo=C3$jscomp$153.New(C3$jscomp$153.ImageInfo),this._imageInfo.LoadData(e),this._duration=e[7],this._origin=C3$jscomp$153.New(C3$jscomp$153.Vector2,e[8],e[9]),this._imagePoints=e[10].map((e=>C3$jscomp$153.New(C3$jscomp$153.ImagePoint,this,e))),this._imagePointsByName=new Map;for(const e of this._imagePoints)this._imagePointsByName.set(e.GetName().toLowerCase(),e);this._collisionPoly=null,6<=(e=e[11]).length&&(this._collisionPoly=C3$jscomp$153.New(C3$jscomp$153.CollisionPoly,e)),this._iAnimationFrame=new self.IAnimationFrame(this)}Release(){this._collisionPoly&&(this._collisionPoly.Release(),this._collisionPoly=null),this._imageInfo.Release(),this._imageInfo=null}GetImageInfo(){return this._imageInfo}GetDuration(){return this._duration}GetOriginX(){return this._origin.getX()}GetOriginY(){return this._origin.getY()}GetCollisionPoly(){return this._collisionPoly}GetImagePointByName(e){return this._imagePointsByName.get(e.toLowerCase())||null}GetImagePointByIndex(e){return 0>(e=Math.floor(e))||e>=this._imagePoints.length?null:this._imagePoints[e]}GetImagePointCount(){return this._imagePoints.length}GetIAnimationFrame(){return this._iAnimationFrame}};const C3$jscomp$154=self.C3;C3$jscomp$154.ImagePoint=class extends C3$jscomp$154.DefendedBase{constructor(e,t){super(),this._afi=e,this._name=t[0],this._pos=C3$jscomp$154.New(C3$jscomp$154.Vector2,t[1],t[2])}Release(){}GetName(){return this._name}GetX(){return this._pos.getX()}GetY(){return this._pos.getY()}GetVec2(){return this._pos}};const C3$jscomp$155=self.C3,C3Debugger$jscomp$1=self.C3Debugger,IObjectClass$jscomp$1=self.IObjectClass;C3$jscomp$155.ObjectClass=class extends C3$jscomp$155.DefendedBase{constructor(e,t,s){super();const i=e.GetObjectReference(s[1]);if(this._runtime=e,this._plugin=e.GetPluginManager().GetPluginByConstructorFunction(i),this._sdkType=null,this._instSdkCtor=i.Instance,this._index=t,this._sid=s[11],this._name=s[0],this._jsPropName=this._runtime.GetJsPropName(s[14]),this._isGlobal=!!s[9],this._isFamily=!!s[2],this._isOnLoaderLayout=!!s[10],this._instVars=s[3].map((t=>({sid:t[0],type:t[1],name:t[2],jsPropName:e.GetJsPropName(t[3])}))),this._behaviorsCount=s[4],this._effectsCount=s[5],this._isWorldType=this._plugin.IsWorldType(),this._effectList=null,this._collisionGrid=C3$jscomp$155.New(C3$jscomp$155.SparseGrid,e.GetOriginalViewportWidth(),e.GetOriginalViewportHeight()),this._anyCollisionCellChanged=!0,this._anyInstanceParallaxed=!1,this._familyMembersSet=this._familyMembers=null,this._familyIndex=-1,this._familyEffectMap=this._familyBehaviorMap=this._familyInstVarMap=this._familiesSet=this._families=null,this._isInContainer=!1,this._container=null,this._behaviorTypes=s[8].map((e=>C3$jscomp$155.BehaviorType.Create(this,e))),this._behaviorTypesIncludingInherited=[],this._behaviorsByName=new Map,this._behaviorNameToIndex=new Map,this._usedBehaviorCtors=new Set,this._solStack=C3$jscomp$155.New(C3$jscomp$155.SolStack,this),this._defaultInstanceData=null,this._defaultLayerIndex=0,this._isContained=!1,this._animationsBySid=this._animationsByName=this._animations=this._imageInfo=this._container=null,this._textureRefCount=0,this._savedData=new Map,this._unsavedData=new Map,this._instances=[],this._iidsStale=!0,this._plugin.HasEffects()&&(this._effectList=C3$jscomp$155.New(C3$jscomp$155.EffectList,this,s[12])),s[6]&&(this._imageInfo=C3$jscomp$155.New(C3$jscomp$155.ImageInfo),this._imageInfo.LoadData(s[6])),s[7]){this._animations=s[7].map((e=>C3$jscomp$155.New(C3$jscomp$155.AnimationInfo,e))),this._animationsByName=new Map,this._animationsBySid=new Map;for(const e of this._animations)this._animationsByName.set(e.GetName().toLowerCase(),e),this._animationsBySid.set(e.GetSID(),e)}if(this._isFamily?(this._familyMembers=[],this._familyMembersSet=new Set,this._familyIndex=this._runtime._GetNextFamilyIndex()):(this._families=[],this._familiesSet=new Set,this._familyInstVarMap=[],this._familyBehaviorMap=[],this._familyEffectMap=[]),this._sdkType=C3$jscomp$155.New(i.Type,this,s[15]),this._instanceUserScriptClass=this._iObjectClass=null,this._userScriptDispatcher=C3$jscomp$155.New(C3$jscomp$155.Event.Dispatcher),t=this._sdkType.GetScriptInterfaceClass()){if(this._iObjectClass=new t(this),!(this._iObjectClass instanceof IObjectClass$jscomp$1))throw new TypeError("script interface class must derive from IObjectClass")}else this._iObjectClass=new IObjectClass$jscomp$1(this);s[13]&&(t=s[13])&&this._sdkType.LoadTilemapData(t[0],t[1],t[2]),this._runtime.UsesLoaderLayout()&&!this._isFamily&&!this._isOnLoaderLayout&&this._isWorldType||this.OnCreate(),this._plugin.IsSingleGlobal()&&(this._plugin._SetSingleGlobalObjectClass(this),this._CreateSingleGlobalInstance(s)),this._loadInstancesJson=null}static Create(e,t,s){return C3$jscomp$155.New(C3$jscomp$155.ObjectClass,e,t,s)}Release(){if(this._imageInfo&&(this._imageInfo.Release(),this._imageInfo=null),this._animations){for(const e of this._animations)e.Release();C3$jscomp$155.clearArray(this._animations),this._animationsByName.clear(),this._animationsBySid.clear()}this._loadInstancesJson=null,this._solStack.Release(),this._solStack=null,this._savedData.clear(),this._unsavedData.clear(),this._runtime=this._container=null}_LoadFamily(e){for(let t=1,s=e.length;t<s;++t){const s=this._runtime.GetObjectClassByIndex(e[t]);this._familyMembers.push(s),this._familyMembersSet.add(s),s._families.push(this),s._familiesSet.add(this)}}_SetContainer(e){this._isInContainer=!0,this._container=e}IsInContainer(){return this._isInContainer}GetContainer(){return this._container}_OnAfterCreate(){var e=0;if(!this._isFamily)for(var t of this._families)for(var s of t.GetBehaviorTypes()){const t=s.GetName().toLowerCase();this._behaviorsByName.set(t,s),this._behaviorNameToIndex.set(t,e),this._behaviorTypesIncludingInherited.push(s),++e}for(var i of this.GetBehaviorTypes())t=i.GetName().toLowerCase(),this._behaviorsByName.set(t,i),this._behaviorNameToIndex.set(t,e),this._behaviorTypesIncludingInherited.push(i),++e;for(var r of this._behaviorTypesIncludingInherited)this._usedBehaviorCtors.add(r.GetBehavior().constructor);if(!this._isFamily&&this._families.length){e=this._runtime.GetFamilyCount(),C3$jscomp$155.extendArray(this._familyInstVarMap,e,0),C3$jscomp$155.extendArray(this._familyBehaviorMap,e,0),C3$jscomp$155.extendArray(this._familyEffectMap,e,0),e=[],t=r=i=0;for(const n of this._families)if(s=n.GetFamilyIndex(),this._familyInstVarMap[s]=i,i+=n.GetInstanceVariablesCount(),this._familyBehaviorMap[s]=r,r+=n.GetBehaviorTypesCount(),this._familyEffectMap[s]=t,t+=n.GetEffectTypesCount(),(s=n.GetEffectList())&&this._effectList)for(const t of s.GetAllEffectTypes())e.push(t.Clone(this._effectList));this._effectList&&this._effectList.PrependEffectTypes(e)}}_CreateSingleGlobalInstance(e){const t=this._runtime._GetNewUID(),s=C3$jscomp$155.New(C3$jscomp$155.Instance,{runtime:this._runtime,objectType:this,uid:t});s._CreateSdkInstance(e[16],[]),this._runtime._MapInstanceByUID(t,s),this._instances.push(s)}GetSdkType(){return this._sdkType}IsOnLoaderLayout(){return this._isOnLoaderLayout}OnCreate(){this._isFamily||this._sdkType.OnCreate()}HasLoadedTextures(){return 0<this._textureRefCount}LoadTextures(e){return this._isFamily?Promise.resolve():(this._textureRefCount++,1===this._textureRefCount&&this._sdkType.LoadTextures(e)||Promise.resolve())}ReleaseTextures(){if(!this._isFamily){if(this._textureRefCount--,0>this._textureRefCount)throw Error("released textures too many times");0===this._textureRefCount&&this._sdkType.ReleaseTextures()}}OnDynamicTextureLoadComplete(){if(this._isFamily)throw Error("not applicable to family");this._sdkType.OnDynamicTextureLoadComplete()}PreloadTexturesWithInstances(e){return this._isFamily?Promise.resolve():this._sdkType.PreloadTexturesWithInstances(e)}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetIndex(){return this._index}GetSID(){return this._sid}IsFamily(){return this._isFamily}IsGlobal(){return this._isGlobal}IsWorldType(){return this._isWorldType}GetFamilyIndex(){return this._familyIndex}GetBehaviorTypes(){return this._behaviorTypes}GetBehaviorTypesCount(){return this._behaviorsCount}UsesBehaviorByCtor(e){return e&&this._usedBehaviorCtors.has(e)}GetInstanceVariablesCount(){return this._instVars.length}GetInstanceVariableSIDs(){return this._instVars.map((e=>e.sid))}GetInstanceVariableIndexBySID(e){return this._instVars.findIndex((t=>t.sid===e))}GetInstanceVariableIndexByName(e){return this._instVars.findIndex((t=>t.name===e))}_GetAllInstanceVariableNames(){return this._instVars.map((e=>e.name))}_GetAllInstanceVariableJsPropNames(){return this._instVars.map((e=>e.jsPropName))}GetInstanceVariableType(e){if(0>(e=Math.floor(e))||e>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[e].type}GetInstanceVariableName(e){if(0>(e=Math.floor(e))||e>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[e].name}GetEffectTypesCount(){return this._effectsCount}GetBehaviorTypesIncludingInherited(){return this._behaviorTypesIncludingInherited}GetBehaviorTypeByName(e){return this._behaviorsByName.get(e.toLowerCase())||null}GetBehaviorIndexByName(e){return void 0===(e=this._behaviorNameToIndex.get(e.toLowerCase()))?-1:e}GetEffectList(){return this._effectList}HasEffects(){return this._plugin.HasEffects()}UsesEffects(){return this._effectList&&this._effectList.HasAnyEffectType()}GetSolStack(){return this._solStack}GetCurrentSol(){return this._solStack.GetCurrentSol()}GetImageInfo(){return this._imageInfo}SetDefaultInstanceData(e){this._defaultInstanceData=e}GetDefaultInstanceData(){return this._defaultInstanceData}_SetDefaultLayerIndex(e){this._defaultLayerIndex=e}GetDefaultLayerIndex(){return this._defaultLayerIndex}GetAnimations(){return this._animations}GetAnimationCount(){return this._animations.length}GetFamilies(){return this._families}BelongsToFamily(e){return this._familiesSet.has(e)}GetFamilyMembers(){return this._familyMembers}FamilyHasMember(e){return this._familyMembersSet.has(e)}GetFamilyBehaviorOffset(e){return this._familyBehaviorMap[e]}GetFamilyInstanceVariableOffset(e){return this._familyInstVarMap[e]}GetAnimationByName(e){if(!this._animations)throw Error("no animations");return this._animationsByName.get(e.toLowerCase())||null}GetAnimationBySID(e){if(!this._animations)throw Error("no animations");return this._animationsBySid.get(e)||null}GetFirstAnimationFrame(){if(!this._animations)throw Error("no animations");return this._animations[0].GetFrameAt(0)}GetDefaultInstanceSize(){if(this._animations){const e=this.GetFirstAnimationFrame().GetImageInfo();return[e.GetWidth(),e.GetHeight()]}return this._imageInfo?[this._imageInfo.GetWidth(),this._imageInfo.GetHeight()]:[100,100]}GetSingleGlobalInstance(){if(!this._plugin.IsSingleGlobal())throw Error("not a single-global plugin");return this._instances[0]}GetInstances(){return this._instances}*instances(){yield*this._instances}*instancesIncludingPendingCreate(){yield*this._instances,yield*this._runtime.instancesPendingCreateForObjectClass(this)}GetInstanceCount(){return this._instances.length}_AddInstance(e){this._instances.push(e)}_SetIIDsStale(){this._iidsStale=!0}_UpdateIIDs(){if(this._iidsStale&&!this._isFamily){var e=this._instances,t=0;for(let s=e.length;t<s;++t)e[t]._SetIID(t);e=this._runtime._GetInstancesPendingCreate();for(const s of e)s.GetObjectClass()===this&&s._SetIID(t++);this._iidsStale=!1}}GetInstanceByIID(e){var t=this._instances;if(e<t.length)return t[e];e-=t.length,t=this._runtime._GetInstancesPendingCreate();for(const s of t)if(s.GetObjectClass()===this){if(0===e)return s;--e}return null}GetFirstPicked(e){if(e&&e.IsInContainer()&&e.GetObjectClass()!==this)for(const t of e.siblings())if(t.GetObjectClass()===this)return t;return(e=this.GetCurrentSol().GetInstances()).length?e[0]:null}GetPairedInstance(e){const t=this.GetCurrentSol().GetInstances();return 0<t.length?t[e.GetIID()%t.length]:null}*allCorrespondingInstances(e,t){const s=this.GetCurrentSol().GetInstances();var i=s.length;const r=t.GetCurrentSol(),n=t.GetCurrentSol().GetInstances(),a=n.length;var o=e.GetIID();!t.IsFamily()&&r.IsSelectAll()||(o=n.indexOf(e)),e=Math.ceil(i/a),0===(i%=a)||o<i?(o*=e,i=e):(o=i*e+(o-i)*(e-1),i=e-1);for(let e=o,t=o+i;e<t;++e)yield s[e]}FinishCondition(e){this._sdkType.FinishCondition(e)}ApplySolToContainer(){if(this._isInContainer&&!this._isFamily){this._UpdateIIDs();var e=this.GetCurrentSol(),t=e._GetOwnInstances(),s=e.IsSelectAll(),i=this._runtime.GetCurrentEventStackFrame();i=i&&i.GetCurrentEvent()&&i.GetCurrentEvent().IsOrBlock();for(const a of this._container.objectTypes())if(a!==this){a._UpdateIIDs();var r=a.GetCurrentSol();if(r._SetSelectAll(s),!s){var n=r._GetOwnInstances();C3$jscomp$155.clearArray(n);for(const e of t)n.push(a.GetInstanceByIID(e.GetIID()));if(i){n=e._GetOwnElseInstances(),r=r._GetOwnElseInstances(),C3$jscomp$155.clearArray(r);for(const e of n)r.push(a.GetInstanceByIID(e.GetIID()))}}}}}_TruncateContainerSols(e,t){for(const s of this.GetContainer().objectTypes()){const i=s.GetCurrentSol();e?C3$jscomp$155.truncateArray(i._GetOwnElseInstances(),t):C3$jscomp$155.truncateArray(i._GetOwnInstances(),t)}}_GetCollisionCellGrid(){return this._collisionGrid}_SetAnyCollisionCellChanged(e){this._anyCollisionCellChanged=!!e}_SetAnyInstanceParallaxed(e){this._anyInstanceParallaxed=!!e}IsAnyInstanceParallaxed(){return this._anyInstanceParallaxed}_UpdateAllCollisionCells(){if(this._anyCollisionCellChanged&&this._isWorldType){for(const e of this._instances)e.GetWorldInfo()._UpdateCollisionCell();for(const e of this._runtime._GetInstancesPendingCreate())e.GetObjectClass()===this&&e.GetWorldInfo()._UpdateCollisionCell();this._anyCollisionCellChanged=!1}}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}HasSolidBehavior(){return this.UsesBehaviorByCtor(C3$jscomp$155.Behaviors.solid)}HasJumpthruBehavior(){return this.UsesBehaviorByCtor(C3$jscomp$155.Behaviors.jumpthru)}HasNoSaveBehavior(){return this.UsesBehaviorByCtor(C3$jscomp$155.Behaviors.NoSave)}HasPersistBehavior(){return this.UsesBehaviorByCtor(C3$jscomp$155.Behaviors.Persist)}_SaveToJson(){const e={instances:this._instances.map((e=>e.SaveToJson()))};return this._savedData&&this._savedData.size&&(e.ex=C3$jscomp$155.ToSuperJSON(this._savedData)),e}_LoadFromJson(e){this._savedData&&(this._savedData.clear(),this._savedData=null);var t=e.ex;t&&(this._savedData=C3$jscomp$155.FromSuperJSON(t)),t=this._instances,e=e.instances;for(let s=0,i=Math.min(t.length,e.length);s<i;++s)t[s].LoadFromJson(e[s]);for(let s=e.length,i=t.length;s<i;++s)this._runtime.DestroyInstance(t[s]);for(let s=t.length,i=e.length;s<i;++s){t=e[s];let i=null;this.IsWorldType()&&(i=this._runtime.GetMainRunningLayout().GetLayerBySID(t.w.l),!i)||this._runtime.CreateInstanceFromData(this._defaultInstanceData||this,i,!1,0,0,!0).LoadFromJson(t)}this._loadInstancesJson=e,this._SetIIDsStale()}_GetLoadInstancesJson(){return this._loadInstancesJson}_ClearLoadInstancesJson(){this._loadInstancesJson=null}_SetupSceneGraphConnectionsOnChangeOfLayout(){for(let e=0,t=this._instances;e<t;++e)this._instances[e]._SetupSceneGraphConnectionsOnChangeOfLayout()}GetIObjectClass(){return this._iObjectClass}UserScriptDispatcher(){return this._userScriptDispatcher}_GetUserScriptInstanceClass(){return this._instanceUserScriptClass}_SetUserScriptInstanceClass(e){this._instanceUserScriptClass=e}DispatchUserScriptEvent(e){var t=this._runtime;(t=t.IsDebug()&&!t.GetEventSheetManager().IsInEventEngine())&&C3Debugger$jscomp$1.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),t&&C3Debugger$jscomp$1.AddScriptTime()}};const C3$jscomp$156=self.C3;C3$jscomp$156.Container=class extends C3$jscomp$156.DefendedBase{constructor(e,t){super(),this._runtime=e,this._objectTypes=t;for(const e of this._objectTypes)e._SetContainer(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetObjectTypes(){return this._objectTypes}objectTypes(){return this._objectTypes}HasAnyWorldType(){return this._objectTypes.some((e=>e.IsWorldType()))}};const C3$jscomp$157=self.C3,C3Debugger$jscomp$2=self.C3Debugger,IInstance$jscomp$2=self.IInstance,EMPTY_ARRAY$jscomp$1=[];let nextPuid=0;const savedDataMaps=new WeakMap,unsavedDataMaps=new WeakMap,FLAG_DESTROYED=1,FLAG_TILEMAP=2,FLAG_MUST_PREDRAW=4,FLAG_SOLID_ENABLED=8,FLAG_JUMPTHRU_ENABLED=16,FLAG_MUST_MITIGATE_Z_FIGHTING=32,FLAG_IS_DRAWING_WITH_EFFECTS=64;C3$jscomp$157.Instance=class extends C3$jscomp$157.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._objectType=e.objectType,this._iScriptInterface=this._sdkInst=this._worldInfo=null,this._iid=0,this._uid=e.uid,this._puid=nextPuid++,this._flags=0,this._behaviorInstances=this._instVarValues=EMPTY_ARRAY$jscomp$1;var t=this._objectType.GetBehaviorTypesIncludingInherited();if(0<t.length&&(this._behaviorInstances=t.map(((e,t)=>C3$jscomp$157.New(C3$jscomp$157.BehaviorInstance,{runtime:this._runtime,behaviorType:e,instance:this,index:t})))),this._siblings=this._objectType.IsInContainer()?[]:null,this._timeScale=-1,this._dispatcher=null,(t=this.GetPlugin()).MustPreDraw()&&(this._flags|=FLAG_MUST_PREDRAW),t.IsWorldType())if(this._worldInfo=C3$jscomp$157.New(C3$jscomp$157.WorldInfo,this,e.layer),e.worldData)this._worldInfo.Init(e.worldData);else{this._worldInfo.InitNoData();const[e,t]=this._objectType.GetDefaultInstanceSize();this._worldInfo.SetSize(e,t),this.GetObjectClass().UsesEffects()&&this._worldInfo.GetInstanceEffectList().LoadDefaultEffectParameters()}e.instVarData?this._LoadInstanceVariableData(e.instVarData):this._LoadDefaultInstanceVariables()}Release(){if(this._iScriptInterface&&(this._iScriptInterface._Release(),this._iScriptInterface=null),0<this._behaviorInstances.length){for(var e of this._behaviorInstances)e.Release();C3$jscomp$157.clearArray(this._behaviorInstances)}this._sdkInst.Release(),this._sdkInst=null,(e=savedDataMaps.get(this))&&(e.clear(),savedDataMaps.delete(this)),(e=unsavedDataMaps.get(this))&&(e.clear(),unsavedDataMaps.delete(this)),this._siblings&&C3$jscomp$157.clearArray(this._siblings),this._dispatcher&&(this._dispatcher.Release(),this._dispatcher=null),this._objectType=this._runtime=null,0<this._instVarValues.length&&C3$jscomp$157.clearArray(this._instVarValues),this._worldInfo&&(this._worldInfo.Release(),this._worldInfo=null)}_LoadInstanceVariableData(e){0<e.length&&(this._instVarValues=[],C3$jscomp$157.shallowAssignArray(this._instVarValues,e))}_LoadDefaultInstanceVariables(){const e=this._objectType.GetInstanceVariablesCount();if(0!==e){this._instVarValues=[];var t=[0,0,""];for(let s=0;s<e;++s)this._instVarValues.push(t[this._objectType.GetInstanceVariableType(s)])}}_CreateSdkInstance(e,t){if(this._sdkInst)throw Error("already got sdk instance");for(let e=0,s=this._behaviorInstances.length;e<s;++e)this._behaviorInstances[e]._CreateSdkInstance(t?t[e]:null);if(this._sdkInst=C3$jscomp$157.New(this._objectType.GetInstanceSdkCtor(),this,e),!(this._sdkInst instanceof C3$jscomp$157.SDKInstanceBase))throw Error("sdk type must derive from SDKInstanceBase");for(let e=0,t=this._behaviorInstances.length;e<t;++e)this._behaviorInstances[e].PostCreate();this._objectType._GetUserScriptInstanceClass()&&this._InitUserScriptInterface()}GetSdkInstance(){return this._sdkInst}GetWorldInfo(){return this._worldInfo}GetRuntime(){return this._runtime}GetTimeScale(){return this._timeScale}GetActiveTimeScale(){const e=this._timeScale;return-1===e?this.GetRuntime().GetTimeScale():e}SetTimeScale(e){(0>(e=+e)||!isFinite(e))&&(e=0),this._timeScale=e,this.GetObjectClass().UsesEffects()&&this._runtime._SetTrackingInstanceTime(this,!0)}RestoreTimeScale(){this._timeScale=-1,this.GetObjectClass().UsesEffects()&&this._runtime._SetTrackingInstanceTime(this,!1)}GetInstanceGameTime(){return this._runtime._GetInstanceGameTime(this)}Dispatcher(){return this._dispatcher||(this._dispatcher=C3$jscomp$157.New(C3$jscomp$157.Event.Dispatcher)),this._dispatcher}Draw(e){this._sdkInst.Draw(e)}OnCreate(e){this._sdkInst.OnCreate(e)}_SetHasTilemap(){this._flags|=FLAG_TILEMAP}HasTilemap(){return 0!=(this._flags&FLAG_TILEMAP)}_MarkDestroyed(){this._flags|=FLAG_DESTROYED}IsDestroyed(){return 0!=(this._flags&FLAG_DESTROYED)}MustPreDraw(){return 0!=(this._flags&FLAG_MUST_PREDRAW)}SetMustMitigateZFighting(){this._flags|=FLAG_MUST_MITIGATE_Z_FIGHTING}MustMitigateZFighting(){return 0!=(this._flags&FLAG_MUST_MITIGATE_Z_FIGHTING)}_IsSolidEnabled(){return 0!=(this._flags&FLAG_SOLID_ENABLED)}_SetSolidEnabled(e){this._flags=e?this._flags|FLAG_SOLID_ENABLED:this._flags&~FLAG_SOLID_ENABLED}_IsJumpthruEnabled(){return 0!=(this._flags&FLAG_JUMPTHRU_ENABLED)}_SetJumpthruEnabled(e){this._flags=e?this._flags|FLAG_JUMPTHRU_ENABLED:this._flags&~FLAG_JUMPTHRU_ENABLED}_IsDrawingWithEffects(){return 0!=(this._flags&FLAG_IS_DRAWING_WITH_EFFECTS)}_SetIsDrawingWithEffects(e){this._flags=e?this._flags|FLAG_IS_DRAWING_WITH_EFFECTS:this._flags&~FLAG_IS_DRAWING_WITH_EFFECTS}SetFlag(e,t){e<<=16,this._flags=t?this._flags|e:this._flags&~e}GetFlag(e){return 0!=(this._flags&e<<16)}GetCurrentImageInfo(){return this._sdkInst.GetCurrentImageInfo()}GetCurrentSurfaceSize(){return this._sdkInst.GetCurrentSurfaceSize()}GetCurrentTexRect(){return this._sdkInst.GetCurrentTexRect()}GetCurrentTexQuad(){return this._sdkInst.GetCurrentTexQuad()}IsCurrentTexRotated(){return this._sdkInst.IsCurrentTexRotated()}GetImagePoint(e){return this._sdkInst.GetImagePoint(e)}GetObjectClass(){return this._objectType}RendersToOwnZPlane(){return this._sdkInst.RendersToOwnZPlane()}BelongsToObjectClass(e){return e.IsFamily()?e.FamilyHasMember(this.GetObjectClass()):this.GetObjectClass()===e}CollectInstancesToPick(e,t,s){const i=(t,s)=>{s=s||t.GetObjectClass();const i=e.get(s);i?i.add(t):e.set(s,new Set([t]))};if(i(this,t),this.IsInContainer())for(const e of this.siblings())i(e);if(s)for(const e of this.allChildren())i(e)}VerifySupportsSceneGraph(){if(!this.GetPlugin().SupportsSceneGraph())throw Error("object does not support scene graph")}HasParent(){return null!==this.GetParent()}GetParent(){var e=this.GetWorldInfo();return e&&(e=e.GetParent())?e.GetInstance():null}GetTopParent(){var e=this.GetWorldInfo();return e&&(e=e.GetTopParent())?e.GetInstance():null}*parents(){const e=this.GetWorldInfo();if(e)for(const t of e.parents())yield t.GetInstance()}HasChild(e){if(!e)return!1;for(const t of this.children())if(t===e)return!0;return!1}HasChildren(){const e=this.GetWorldInfo();return!!e&&e.HasChildren()}GetChildrenOfObjectClass(e){const t=this.GetWorldInfo();if(!t)return[];const s=e.GetName();return t.GetChildren().map((e=>e.GetInstance())).filter((e=>e.GetObjectClass().GetName()===s))}GetChildren(){const e=this.GetWorldInfo();return e?e.GetChildren().map((e=>e.GetInstance())):[]}*children(){const e=this.GetWorldInfo();if(e)for(const t of e.children())yield t.GetInstance()}*allChildren(){const e=this.GetWorldInfo();if(e)for(const t of e.allChildren())yield t.GetInstance()}GetChildCount(){const e=this.GetWorldInfo();return e?e.GetChildCount():0}GetParentCount(){return[...this.parents()].length}GetAllChildCount(){const e=this.GetWorldInfo();return e?e.GetAllChildCount():0}GetChildAt(e){const t=this.GetWorldInfo();return t&&(e=t.GetChildAt(e))?e.GetInstance():null}AddChild(e,t){this.VerifySupportsSceneGraph(),e.VerifySupportsSceneGraph(),this.GetWorldInfo().AddChild(e.GetWorldInfo(),t||{})}RemoveChild(e){const t=this.GetWorldInfo();t&&t.RemoveChild(e.GetWorldInfo())}GetDestroyWithParent(){const e=this.GetWorldInfo();return!!e&&e.GetDestroyWithParent()}SetupInitialSceneGraphConnections(){var e=this.GetWorldInfo();if(e&&(e=e.GetSceneGraphChildrenExportData()))for(const t of e)if(e=this._runtime.GetInstanceByUID(t[2])){const s=t[3];this.AddChild(e,{transformX:!!(s>>0&1),transformY:!!(s>>1&1),transformWidth:!!(s>>2&1),transformHeight:!!(s>>3&1),transformAngle:!!(s>>4&1),destroyWithParent:!!(s>>5&1),transformZElevation:!!(s>>6&1)})}}SetupPersistedSceneGraphConnections(e,t){if(e=e.get(this))for(const s of e.sceneGraphJson.children){if(!(e=t.get(s.index)))continue;const i=s.flags;this.AddChild(e,{transformX:!!(i>>0&1),transformY:!!(i>>1&1),transformWidth:!!(i>>2&1),transformHeight:!!(i>>3&1),transformAngle:!!(i>>4&1),destroyWithParent:!!(i>>5&1),transformZElevation:!!(i>>6&1)})}}IsInContainer(){return null!==this._siblings}_AddSibling(e){this._siblings.push(e)}GetSiblings(){return this._siblings}HasSibling(e){return!!this.GetSibling(e)}GetSibling(e){const t=this.siblings();if(null===t||0===t.length)return!1;for(const s of t)if(s.GetObjectClass()===e)return s;return null}siblings(){return this._siblings}SetSiblingsSinglePicked(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol().SetSinglePicked(e)}_PushSiblingsToSolInstances(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol()._PushInstance(e)}_SetSiblingsToSolInstancesIndex(e){for(const t of this.siblings())t.GetObjectClass().GetCurrentSol()._GetOwnInstances()[e]=t}_PushSiblingsToSolElseInstances(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol()._PushElseInstance(e)}_SetSiblingsToSolElseInstancesIndex(e){for(const t of this.siblings())t.GetObjectClass().GetCurrentSol()._GetOwnElseInstances()[e]=t}GetPlugin(){return this._objectType.GetPlugin()}_SetIID(e){this._iid=e}GetIID(){return this._objectType._UpdateIIDs(),this._iid}GetUID(){return this._uid}GetPUID(){return this._puid}GetBehaviorInstances(){return this._behaviorInstances}GetBehaviorInstanceFromCtor(e){if(!e)return null;for(const t of this._behaviorInstances)if(t.GetBehavior()instanceof e)return t;return null}GetBehaviorSdkInstanceFromCtor(e){return e&&(e=this.GetBehaviorInstanceFromCtor(e))?e.GetSdkInstance():null}GetBehaviorIndexBySID(e){const t=this._behaviorInstances;for(let s=0,i=t.length;s<i;++s)if(t[s].GetBehaviorType().GetSID()===e)return s;return-1}GetAllInstanceVariableValues(){return this._instVarValues}_GetAllInstanceVariableNames(){return this._objectType._GetAllInstanceVariableNames()}GetInstanceVariableCount(){return this._instVarValues.length}GetInstanceVariableValue(e){e|=0;const t=this._instVarValues;if(0>e||e>=t.length)throw new RangeError("invalid instance variable");return t[e]}_GetInstanceVariableValueUnchecked(e){return this._instVarValues[e]}_GetInstanceVariableTypedValue(e){const t=this._instVarValues[e];return 0===this._objectType.GetInstanceVariableType(e)?!!t:t}SetInstanceVariableValue(e,t){e|=0;const s=this._instVarValues;if(0>e||e>=s.length)throw new RangeError("invalid instance variable");switch(this._objectType.GetInstanceVariableType(e)){case 0:s[e]=t?1:0;break;case 1:s[e]="number"==typeof t?t:parseFloat(t);break;case 2:s[e]="string"==typeof t?t:t.toString();break;default:throw Error("unknown instance variable type")}}SetInstanceVariableOffset(e,t){if(0!==t){e|=0;var s=this._instVarValues;if(0>e||e>=s.length)throw new RangeError("invalid instance variable");var i=s[e];if("number"!=typeof i){if("boolean"==typeof i)throw Error("can not set offset of boolean variable");if("string"==typeof i)throw Error("can not set offset of string variable");throw Error("unknown instance variable type")}s[e]="number"==typeof t?s[e]+t:s[e]+parseFloat(t)}}GetSavedDataMap(){let e=savedDataMaps.get(this);return e||(e=new Map,savedDataMaps.set(this,e),e)}GetUnsavedDataMap(){let e=unsavedDataMaps.get(this);return e||(e=new Map,unsavedDataMaps.set(this,e),e)}_HasAnyCreateDestroyHandler(e){const t=this.GetObjectClass();if(t.UserScriptDispatcher().HasAnyHandlerFor(e))return!0;for(const s of t.GetFamilies())if(s.UserScriptDispatcher().HasAnyHandlerFor(e))return!0;return!!this._runtime.UserScriptDispatcher().HasAnyHandlerFor(e)}_TriggerOnCreatedOnSelfAndRelated(){const e=new Set;e.add(this);const t=this.GetWorldInfo();if(t&&t.HasChildren())for(const t of this.allChildren())if(e.add(t),t.IsInContainer())for(const s of t.siblings())e.add(s);if(this.IsInContainer())for(const t of this.siblings())e.add(t);for(const t of e.values())t._TriggerOnCreated()}_TriggerOnCreated(){if(this._HasAnyCreateDestroyHandler("instancecreate")){const e=this.GetObjectClass(),t=new C3$jscomp$157.Event("instancecreate");t.instance=this.GetInterfaceClass(),e.DispatchUserScriptEvent(t);for(const s of e.GetFamilies())s.DispatchUserScriptEvent(t);this._runtime.DispatchUserScriptEvent(t)}this._runtime.Trigger(this.GetPlugin().constructor.Cnds.OnCreated,this,null)}_TriggerOnDestroyed(){this._runtime.Trigger(this.GetPlugin().constructor.Cnds.OnDestroyed,this,null)}_FireDestroyedScriptEvents(e){if(this._iScriptInterface){var t=new C3$jscomp$157.Event("destroy");t.isEndingLayout=e,this.DispatchUserScriptEvent(t)}if(this._HasAnyCreateDestroyHandler("instancedestroy")){t=this.GetObjectClass();var s=new C3$jscomp$157.Event("instancedestroy");s.instance=this.GetInterfaceClass(),s.isEndingLayout=e,t.DispatchUserScriptEvent(s);for(const e of t.GetFamilies())e.DispatchUserScriptEvent(s);this._runtime.DispatchUserScriptEvent(s)}}_GetDebuggerProperties(){return this._sdkInst.GetDebuggerProperties()}SaveToJson(e="full"){const t={};if("full"===e?t.uid=this.GetUID():t.c3=!0,"visual-state"!==e){var s=savedDataMaps.get(this);if(s&&s.size&&(t.ex=C3$jscomp$157.ToSuperJSON(s)),-1!==this.GetTimeScale()&&(t.mts=this.GetTimeScale()),0<this._objectType.GetInstanceVariablesCount()){s={};var i=this._objectType.GetInstanceVariableSIDs();for(let e=0,t=this._instVarValues.length;e<t;++e)s[i[e].toString()]=this._instVarValues[e];t.ivs=s}if(this._behaviorInstances.length){s={};for(const e of this._behaviorInstances)(i=e.SaveToJson())&&(s[e.GetBehaviorType().GetSID().toString()]=i);t.behs=s}}return this._worldInfo&&(t.w=this._worldInfo._SaveToJson(e)),(e=this._sdkInst.SaveToJson())&&(t.data=e),t}_OnBeforeLoad(e="full"){this._worldInfo&&this._worldInfo._OnBeforeLoad(e)}_SetupSceneGraphConnectionsOnChangeOfLayout(){this.GetPlugin().IsWorldType()&&this._worldInfo._SetupSceneGraphConnectionsOnChangeOfLayout()}LoadFromJson(e,t="full"){if("full"===t)this._uid=e.uid;else if(!e.c3)return;if("visual-state"!==t){var s=savedDataMaps.get(this);if(s&&(s.clear(),savedDataMaps.delete(this)),(s=e.ex)&&(s=C3$jscomp$157.FromSuperJSON(s),savedDataMaps.set(this,s)),this._timeScale=e.hasOwnProperty("mts")?e.mts:-1,s=e.ivs)for(const[e,t]of Object.entries(s))if(s=parseInt(e,10),!(0>(s=this._objectType.GetInstanceVariableIndexBySID(s))||s>=this._instVarValues.length)){var i=t;null===i&&(i=NaN),this._instVarValues[s]=i}}if(this.GetPlugin().IsWorldType()){var r=(s=e.w).l;this._worldInfo.GetLayer().GetSID()!==r&&((r=(i=this._worldInfo.GetLayer()).GetLayout().GetLayerBySID(r))?(this._worldInfo._SetLayer(r),i._RemoveInstance(this,!0),r._AddInstance(this,!0),r.SetZIndicesChanged(),this._worldInfo.SetBboxChanged()):"full"===t&&this._runtime.DestroyInstance(this)),this._worldInfo._LoadFromJson(s,t)}if("visual-state"!==t&&(s=e.behs))for(const[e,t]of Object.entries(s))s=parseInt(e,10),0>(s=this.GetBehaviorIndexBySID(s))||s>=this._behaviorInstances.length||this._behaviorInstances[s].LoadFromJson(t);(e=e.data)&&this._sdkInst.LoadFromJson(e,t)}GetInterfaceClass(){return this._iScriptInterface||this._InitUserScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}_InitUserScriptInterface(){var e=this._worldInfo?self.IWorldInstance:IInstance$jscomp$2;const t=this._sdkInst.GetScriptInterfaceClass(),s=this._objectType._GetUserScriptInstanceClass(),i=s||t||e;if(IInstance$jscomp$2._Init(this),this._iScriptInterface=new i,IInstance$jscomp$2._Init(null),t&&!(this._iScriptInterface instanceof e))throw new TypeError(`script interface class '${t.name}' does not extend the right base class '${e.name}'`);if(s&&(e=t||e,!(this._iScriptInterface instanceof e)))throw new TypeError(`setInstanceClass(): class '${s.name}' does not extend the right base class '${e.name}'`);return this._iScriptInterface}_GetInstVarsScriptDescriptor(e){if(0!==this._instVarValues.length){var t={},s=this._objectType._GetAllInstanceVariableJsPropNames();for(let e=0,i=s.length;e<i;++e)t[s[e]]={configurable:!1,enumerable:!0,get:C3$jscomp$157.Instance.prototype._GetInstanceVariableTypedValue.bind(this,e),set:C3$jscomp$157.Instance.prototype.SetInstanceVariableValue.bind(this,e)};t=Object.create(Object.prototype,t),e.instVars={value:t,writable:!1}}}_GetBehaviorsScriptDescriptor(e){var t=this._behaviorInstances;if(0!==t.length){var s={};for(const e of t)s[e.GetBehaviorType().GetJsPropName()]={value:e.GetScriptInterface(),writable:!1};t=Object.create(Object.prototype,s),e.behaviors={value:t,writable:!1}}}DispatchUserScriptEvent(e){if(this.HasScriptInterface()){var t=this.GetInterfaceClass();e.instance=t;var s=this._runtime;(s=s.IsDebug()&&!s.GetEventSheetManager().IsInEventEngine())&&C3Debugger$jscomp$2.StartMeasuringScriptTime(),t.dispatchEvent(e),s&&C3Debugger$jscomp$2.AddScriptTime()}}};const C3$jscomp$158=self.C3;C3$jscomp$158.SceneGraphInfo=class extends C3$jscomp$158.DefendedBase{constructor(e){super(),this._owner=e,this._parent=null,this._children=[],this._startWidth=e.GetWidth(),this._startHeight=e.GetHeight(),this._startScaleY=this._startScaleX=1,this._parentStartAngle=0,this._tmpSceneGraphChildrenIndexes=this._tmpSceneGraphChildren=null}Release(){this._tmpSceneGraphChildrenIndexes=this._tmpSceneGraphChildren=this._parent=null,C3$jscomp$158.clearArray(this._children)}SetParent(e){this._parentStartAngle=(this._parent=e)?e.GetAngle():0}GetParent(){return this._parent}HasChildren(){return 0<this._children.length}GetChildren(){return this._children}_MaybeSortChildren(){this.HasChildren()&&this._tmpSceneGraphChildrenIndexes&&1!==this._children.length&&this._children.sort(((e,t)=>(e=this._tmpSceneGraphChildrenIndexes.get(e.GetInstance()),t=this._tmpSceneGraphChildrenIndexes.get(t.GetInstance()),C3$jscomp$158.IsFiniteNumber(e)&&C3$jscomp$158.IsFiniteNumber(t)?e-t:0)))}GetStartScaleX(){return this._startScaleX}SetStartScaleX(e){this._startScaleX=e}GetStartScaleY(){return this._startScaleY}SetStartScaleY(e){this._startScaleY=e}_GetStartWidth(){return 0===this._startWidth?Number.EPSILON:this._startWidth}_GetStartHeight(){return 0===this._startHeight?Number.EPSILON:this._startHeight}GetParentScaleX(){if(this._owner.GetTransformWithParentWidth()){var e=this._parent;let t=e.GetWidth(),s=e._GetSceneGraphInfo()._GetStartWidth();return 0===t&&(t=Number.EPSILON),s===Number.EPSILON&&t===Number.EPSILON?1:s===Number.EPSILON&&t!==Number.EPSILON&&(e=e.GetInstance().GetSdkInstance()).IsOriginalSizeKnown()?1+t/e.GetOriginalWidth():t/s}return 1}GetParentScaleY(){if(this._owner.GetTransformWithParentHeight()){var e=this._parent;let t=e.GetHeight(),s=e._GetSceneGraphInfo()._GetStartHeight();return 0===t&&(t=Number.EPSILON),s===Number.EPSILON&&t===Number.EPSILON?1:s===Number.EPSILON&&t!==Number.EPSILON&&(e=e.GetInstance().GetSdkInstance()).IsOriginalSizeKnown()?1+t/e.GetOriginalHeight():t/s}return 1}GetParentStartAngle(){return this._parentStartAngle}_SaveToJson(e){return{sw:this._startWidth,sh:this._startHeight,sx:this._startScaleX,sy:this._startScaleY,psa:this._parentStartAngle,p:this._GetParentJson(e),c:this._GetChildrenJson(e)}}_GetFlagsString(e){let t="";return e.GetTransformWithParentX()&&(t+="x"),e.GetTransformWithParentY()&&(t+="y"),e.GetTransformWithParentWidth()&&(t+="w"),e.GetTransformWithParentHeight()&&(t+="h"),e.GetTransformWithParentAngle()&&(t+="a"),e.GetTransformWithParentZElevation()&&(t+="z"),e.GetDestroyWithParent()&&(t+="d"),t}_GetParentJson(e){return this._parent&&this._parent.GetInstance()&&!this._parent.GetInstance().IsDestroyed()?this._GetInstanceJson(this._parent,this._owner,e):null}_GetChildrenJson(e){return this._children.map((t=>this._GetInstanceJson(t,t,e)))}_GetInstanceJson(e,t,s){e=e.GetInstance();const i={};return i.uid=e.GetUID(),i.f=this._GetFlagsString(t),i.offsets=t._SaveSceneGraphPropertiesToJson(),i.data=C3$jscomp$158.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(e),i.oci=e.GetObjectClass().GetIndex(),"state"===s?(i.inst=e.SaveToJson(),i.instIndex=NaN):(i.instIndex=e.GetObjectClass().GetInstances().indexOf(e),i.inst=null),i}_LoadFromJson(e){this._startWidth=e.sw,this._startHeight=e.sh,this._startScaleX=e.sx,this._startScaleY=e.sy,this._parentStartAngle=e.psa}_SetTmpSceneGraphChildren(e,t){this._tmpSceneGraphChildren=e,this._tmpSceneGraphChildrenIndexes=t}_OnAfterLoad(e,t){const s=this._owner,i=s.GetRuntime(),r=new Set;if(e.p&&!this._parent){var n=i.GetInstanceByUID(e.p.uid);if(n){var a=n.GetWorldInfo();n.HasChild(this._owner.GetInstance())?this._parent=a:(n.AddChild(this._owner.GetInstance(),this._GetFlagsObj(e.p.f)),r.has(this._owner)||this._owner._LoadSceneGraphPropertiesFromJson(e.p.offsets),r.add(this._owner),n.GetWorldInfo()._GetSceneGraphInfo()._MaybeSortChildren())}else C3$jscomp$158.IsFiniteNumber(e.p.oci)&&(n=i.GetObjectClassByIndex(e.p.oci),i.GetSystemPlugin(),n=i.CreateInstance(n,s.GetLayer(),0,0,!0))&&(a=this._GetInstanceData(e.p,i),n.LoadFromJson(a),n.GetWorldInfo().GetLayer().SortAndAddInstancesByZIndex(n),n.AddChild(s.GetInstance(),this._GetFlagsObj(e.p.f)),n.GetWorldInfo()._GetSceneGraphInfo()._MaybeSortChildren())}for(var o of(n=[],e.c))(a=i.GetInstanceByUID(o.uid))&&n.push(a);o=0;for(const c of e.c){if(a=i.GetInstanceByUID(c.uid)){if(this._tmpSceneGraphChildren&&this._tmpSceneGraphChildren[o]){var h=this._tmpSceneGraphChildren[o];if(h.GetObjectClass()!==a.GetObjectClass()){o++;continue}if(h.IsDestroyed()){o++;continue}a=e.c[o],this._AddAndSetChildInstance(h.GetWorldInfo(),a,r,!1),o++;continue}var l=a.GetObjectClass();if((h=this._GetInstancesOfObjectClassCount(n,l))===(l=s.GetInstance().GetChildrenOfObjectClass(l).length)){(a=s.GetInstance().GetChildAt(o).GetWorldInfo())&&(r.has(a)||a._LoadSceneGraphPropertiesFromJson(c.offsets),r.add(a)),o++;continue}if(a.HasParent()){a=this._CreateNewChildInstance(c,t),this._AddAndSetChildInstance(a,c,r),o++;continue}this._AddAndSetChildInstance(a.GetWorldInfo(),c,r)}else a=this._CreateNewChildInstance(c,t),this._AddAndSetChildInstance(a,c,r);o++}}_GetFlagsObj(e){const t={};return t.transformX=e.includes("x"),t.transformY=e.includes("y"),t.transformWidth=e.includes("w"),t.transformHeight=e.includes("h"),t.transformAngle=e.includes("a"),t.transformZElevation=e.includes("z"),t.destroyWithParent=e.includes("d"),t}_CreateNewChildInstance(e,t){if(C3$jscomp$158.IsFiniteNumber(e.oci)){var s=this._owner;if(t=s.GetRuntime(),e.data)s=t.CreateInstanceFromData(e.data,s.GetLayer(),!1,0,0,!1,!0);else{const i=t.GetObjectClassByIndex(e.oci);s=t.CreateInstance(i,s.GetLayer(),0,0,!0)}if(s)return e=this._GetInstanceData(e,t),s.LoadFromJson(e),(e=s.GetWorldInfo()).GetLayer().SortAndAddInstancesByZIndex(s,!0),e}}_AddAndSetChildInstance(e,t,s,i=!0){this._owner.AddChild(e,this._GetFlagsObj(t.f)),i&&(s.has(e)||e._LoadSceneGraphPropertiesFromJson(t.offsets),s.add(e)),this._MaybeSortChildren()}_GetInstancesOfObjectClassCount(e,t){return e.filter((e=>e.GetObjectClass().GetName()===t.GetName())).length}_GetInstanceData(e,t){return C3$jscomp$158.IsFiniteNumber(e.instIndex)?t.GetObjectClassByIndex(e.oci)._GetLoadInstancesJson()[e.instIndex]:C3$jscomp$158.IsString(e.inst)?JSON.parse(e.inst):e.inst?e.inst:void 0}static GetSceneGraphInstanceDataFromInstance(e){let t=e.GetWorldInfo().GetLayer().GetInitialInstanceData(e.GetUID());if(!t)return null;t=JSON.parse(JSON.stringify(t));const s=[];for(const t of[...e.GetChildren()]){const e=t.GetWorldInfo();s.push([e.GetLayout().GetSID(),e.GetLayer().GetIndex(),t.GetUID(),C3$jscomp$158.SceneGraphInfo._GetFlagsNumber(e),t.GetObjectClass().IsInContainer()?1:0,e.GetZIndex(),C3$jscomp$158.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(t)])}return C3$jscomp$158.IsArray(t[0][14])?t[0][14][1]=s:(t[0][14]=[],t[0][14][0]=C3$jscomp$158.SceneGraphInfo._GetDefaultFlagsNumber(),t[0][14][1]=s,t[0][14][2]=e.GetWorldInfo().GetZIndex()),t}static _GetFlagsNumber(e){let t;return t=0|Number(e.GetTransformWithParentZElevation())<<6,t|=Number(e.GetDestroyWithParent())<<5,t|=Number(e.GetTransformWithParentAngle())<<4,t|=Number(e.GetTransformWithParentHeight())<<3,t|=Number(e.GetTransformWithParentWidth())<<2,t|=Number(e.GetTransformWithParentY())<<1,t|=Number(e.GetTransformWithParentX())<<0}static _GetDefaultFlagsNumber(e){return 127}};const C3$jscomp$159=self.C3,tempRect$jscomp$6=C3$jscomp$159.New(C3$jscomp$159.Rect),tempQuad$jscomp$3=C3$jscomp$159.New(C3$jscomp$159.Quad),bboxChangeEvent=C3$jscomp$159.New(C3$jscomp$159.Event,"bboxchange",!1),tempColor$jscomp$6=C3$jscomp$159.New(C3$jscomp$159.Color,0,0,0,0),tempCollisionPoly=C3$jscomp$159.New(C3$jscomp$159.CollisionPoly),DEFAULT_COLOR=C3$jscomp$159.New(C3$jscomp$159.Color,1,1,1,1),DEFAULT_RENDER_CELLS=C3$jscomp$159.New(C3$jscomp$159.Rect,0,0,-1,-1),DEFAULT_COLLISION_CELLS=C3$jscomp$159.New(C3$jscomp$159.Rect,0,0,-1,-1),VALID_SET_MESH_POINT_MODES=new Set(["absolute","relative"]),EMPTY_ARRAY$jscomp$2=[];let enableUpdateRendererStateGroup=!0;const FLAG_IS_VISIBLE=1,FLAG_BBOX_CHANGED=2,FLAG_ENABLE_BBOX_CHANGED_EVENT=4,FLAG_COLLISION_ENABLED=8,FLAG_COLLISION_CELL_CHANGED=16,FLAG_SOLID_FILTER_INCLUSIVE=32,FLAG_HAS_ANY_ACTIVE_EFFECT=64,FLAG_IS_ROTATABLE=128,FLAG_DESTROYED$jscomp$1=256,FLAG_DESTROY_WITH_PARENT=512,FLAG_TRANSFORM_WITH_PARENT_X=1024,FLAG_TRANSFORM_WITH_PARENT_Y=2048,FLAG_TRANSFORM_WITH_PARENT_W=4096,FLAG_TRANSFORM_WITH_PARENT_H=8192,FLAG_TRANSFORM_WITH_PARENT_A=16384,FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION=32768,MASK_ALL_SCENE_GRAPH_FLAGS=FLAG_DESTROY_WITH_PARENT|FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y|FLAG_TRANSFORM_WITH_PARENT_W|FLAG_TRANSFORM_WITH_PARENT_H|FLAG_TRANSFORM_WITH_PARENT_A|FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION,FLAG_MESH_CHANGED=65536,FLAG_PHYSICS_BODY_CHANGED=131072,FLAG_SIN_COS_ANGLE_CHANGED=262144,FLAG_USE_POINTS_SHADER_PROGRAM=524288,FLAG_DRAW_BACK_FACE_ONLY=1048576,FLAG_DRAW_NON_BACK_FACES_ONLY=2097152,FLAG_BLEND_MODE_MASK=2080374784,sceneGraphExportDataMap=new WeakMap,sceneGraphZIndexMap=new WeakMap,needsSceneGraphAfterLoad=new WeakMap;C3$jscomp$159.WorldInfo=class extends C3$jscomp$159.DefendedBase{constructor(e,t){super(),this._inst=e,this._objectClass=e.GetObjectClass(),this._runtime=e.GetRuntime(),this._layer=t,this._zIndex=-1,this._flags=FLAG_IS_VISIBLE|FLAG_BBOX_CHANGED|FLAG_COLLISION_ENABLED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED|FLAG_PHYSICS_BODY_CHANGED,this._objectClass.GetPlugin().IsRotatable()&&(this._flags|=FLAG_IS_ROTATABLE),this._oy=this._ox=this._cosA=this._sinA=this._a=this._depth=this._h=this._w=this._zElevation=this._y=this._x=NaN,this._boundingBox=C3$jscomp$159.New(C3$jscomp$159.Rect),this._boundingQuad=C3$jscomp$159.New(C3$jscomp$159.Quad),this._collisionCells=DEFAULT_COLLISION_CELLS,this._renderCells=DEFAULT_RENDER_CELLS,this._solidFilterTags=this._transformedPolyInfo=this._sourceCollisionPoly=null,this._colorPremultiplied=this._color=DEFAULT_COLOR,this._instanceEffectList=this._stateGroup=null,this._inst.GetObjectClass().UsesEffects()&&(this._instanceEffectList=C3$jscomp$159.New(C3$jscomp$159.InstanceEffectList,this._inst,this)),this._meshInfo=this._after_load_instance=this._after_load=this._tmpSceneGraphChildrenIndexes=this._tmpSceneGraphChildren=this._sceneGraphInfo=null}_MarkDestroyed(){this._flags|=FLAG_DESTROYED$jscomp$1}Release(){if(this._stateGroup&&(this._runtime.GetRenderer().ReleaseStateGroup(this._stateGroup),this._stateGroup=null),this._sourceCollisionPoly=null,this._transformedPolyInfo&&(this._transformedPolyInfo.poly.Release(),this._transformedPolyInfo=null),this._solidFilterTags&&(this._solidFilterTags.clear(),this._solidFilterTags=null),this.ReleaseMesh(),this._instanceEffectList&&this._instanceEffectList.Release(),this.HasParent()&&this.GetParent().RemoveChild(this),this.HasChildren()){const e=[...this.GetChildren()];for(const t of e)this.RemoveChild(t)}this._ReleaseSceneGraphInfo(),this._ReleaseTmpSceneGraphInfo(),sceneGraphExportDataMap.delete(this),sceneGraphZIndexMap.delete(this),this._after_load&&(this.GetRuntime().Dispatcher().removeEventListener("afterload",this._after_load),this._after_load=null),this._after_load_instance&&(this.GetRuntime().Dispatcher().removeEventListener("afterloadinstance",this._after_load_instance),this._after_load_instance=null),this._layer=this._runtime=this._objectClass=this._inst=null}Init(e){if(enableUpdateRendererStateGroup=!1,this.SetXY(e[0],e[1]),this.SetZElevation(e[2]),this.SetSize(e[3],e[4]),this._depth=0,this.IsRotatable()?this.SetAngle(e[6]):this._a=0,tempColor$jscomp$6.setFromJSON(e[7]),this._SetColor(tempColor$jscomp$6),this.SetOriginX(e[8]),this.SetOriginY(e[9]),this.SetBlendMode(e[10]),this._instanceEffectList&&this._instanceEffectList._LoadEffectParameters(e[12]),e[14]&&sceneGraphExportDataMap.set(this,{childrenData:e[14][1],zIndexData:e[14][2]}),e[15]){var t=e[15];this.CreateMesh(t[0],t[1]);var s=this.GetSourceMesh();for(let e=0,n=(t=t[2]).length;e<n;++e){var i=t[e];for(let t=0,n=i.length;t<n;++t){var r=i[t];const n=s.GetMeshPointAt(t,e);n.SetX(r[0]),n.SetY(r[1]),n.SetZElevation(r[2]),n.SetU(r[3]),n.SetV(r[4])}}}e[16]&&(s=e[16][0],i=!(t=!!(e=e[16][1])),r=this._runtime.GetTemplateManager(),t&&r&&r.MapInstanceToTemplateName(this.GetInstance(),e),i&&r&&r.MapInstanceToTemplateName(this.GetInstance(),s)),enableUpdateRendererStateGroup=!0,this._UpdateRendererStateGroup()}InitNoData(){this._sinA=this._a=this._depth=this._h=this._w=this._zElevation=this._y=this._x=0,this._cosA=1,this._oy=this._ox=0,this._UpdateRendererStateGroup()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetInstance(){return this._inst}_GetParentOffsetAngle(){return this.GetTransformWithParentAngle()?this.GetParent().GetAngle()-this._sceneGraphInfo.GetParentStartAngle():0}SetX(e){if(e=+e,this.GetTransformWithParentX()){const t=this._sceneGraphInfo;e-=this.GetX();const s=-this._GetParentOffsetAngle();0===s?this._x+=e/t.GetParentScaleX():(this._x+=Math.cos(s)*e/t.GetParentScaleX(),this.GetTransformWithParentY()&&(this._y+=Math.sin(s)*e/t.GetParentScaleY()))}else this._x=e}OffsetX(e,t=!1){e=+e,t?this._x+=e:this.GetTransformWithParentX()?this.SetX(this.GetX()+e):this._x+=e}GetX(){if(this.GetTransformWithParentX()){let e=this._x;const t=this._sceneGraphInfo,s=this.GetParent(),i=this._GetParentOffsetAngle();return 0===i?e*=t.GetParentScaleX():(e=e*t.GetParentScaleX()*Math.cos(i),this.GetTransformWithParentY()&&(e-=this._y*t.GetParentScaleY()*Math.sin(i))),s.GetX()+e}return this._x}SetY(e){if(e=+e,this.GetTransformWithParentY()){const t=this._sceneGraphInfo;e-=this.GetY();const s=-this._GetParentOffsetAngle();0===s?this._y+=e/t.GetParentScaleY():(this.GetTransformWithParentX()&&(this._x-=Math.sin(s)*e/t.GetParentScaleX()),this._y+=Math.cos(s)*e/t.GetParentScaleY())}else this._y=e}OffsetY(e,t=!1){e=+e,t?this._y+=e:this.GetTransformWithParentY()?this.SetY(this.GetY()+e):this._y+=e}GetY(){if(this.GetTransformWithParentY()){let e=this._y;const t=this._sceneGraphInfo,s=this.GetParent(),i=this._GetParentOffsetAngle();return 0===i?e*=t.GetParentScaleY():(e=e*t.GetParentScaleY()*Math.cos(i),this.GetTransformWithParentX()&&(e+=this._x*t.GetParentScaleX()*Math.sin(i))),s.GetY()+e}return this._y}SetXY(e,t){if(e=+e,t=+t,this.GetTransformWithParentXOrY()){const i=this.GetTransformWithParentX(),r=this.GetTransformWithParentY(),n=this._sceneGraphInfo,a=e-this.GetX(),o=t-this.GetY();var s=-this._GetParentOffsetAngle();if(0===s)this._x=i?this._x+a/n.GetParentScaleX():e,this._y=r?this._y+o/n.GetParentScaleY():t;else{const h=Math.sin(s);s=Math.cos(s),this._x=i?r?this._x+(s*a-h*o)/n.GetParentScaleX():this._x+s*a/n.GetParentScaleX():e,this._y=r?i?this._y+(h*a+s*o)/n.GetParentScaleY():this._y+s*o/n.GetParentScaleY():t}}else this._x=e,this._y=t}OffsetXY(e,t){e=+e,t=+t,this.GetTransformWithParentXOrY()?this.SetXY(this.GetX()+e,this.GetY()+t):(this._x+=e,this._y+=t)}EqualsXY(e,t){return this.GetX()===e&&this.GetY()===t}SetZElevation(e){e=+e,this.GetTransformWithParentZElevation()&&(e-=this.GetParent().GetZElevation()),this._zElevation!==e&&(this._zElevation=e,this._UpdateZElevation(),e=this.GetLayer(),0!==this._zElevation&&e._SetAnyInstanceZElevated(),e.SetZIndicesChanged())}_UpdateZElevation(){if(this._UpdateRendererStateGroup(),this.HasChildren()){const e=this.GetChildren();for(let t=0,s=e.length;t<s;t++){const s=e[t];s.GetTransformWithParentZElevation()&&s._UpdateZElevation()}}}OffsetZElevation(e){this.SetZElevation(this.GetZElevation()+e)}GetZElevation(){return this.GetTransformWithParentZElevation()?this.GetParent().GetZElevation()+this._zElevation:this._zElevation}GetTotalZElevation(){return this.GetLayer().GetZElevation()+this.GetZElevation()}SetWidth(e){if(e=+e,this.GetTransformWithParentWidth()){const t=this.GetWidth();this._w=0===t?Number.EPSILON:e/t*this._w}else this._w=e}OffsetWidth(e,t){e=+e,t?this._w+=e:this.GetTransformWithParentWidth()?this.SetWidth(this.GetWidth()+e):this._w+=e}GetWidth(){if(this.GetTransformWithParentWidth()){const e=this.GetParent(),t=e.GetWidth();return e._GetSceneGraphInfo()._GetStartWidth()===Number.EPSILON?(this._GetSceneGraphInfo()._GetStartWidth()+t)*this._w:t*this._w}return this._w}SetHeight(e){if(e=+e,this.GetTransformWithParentHeight()){const t=this.GetHeight();this._h=0===t?Number.EPSILON:e/t*this._h}else this._h=e}OffsetHeight(e,t){e=+e,t?this._h+=e:this.GetTransformWithParentHeight()?this.SetHeight(this.GetHeight()+e):this._h+=e}GetHeight(){if(this.GetTransformWithParentHeight()){const e=this.GetParent(),t=e.GetHeight();return e._GetSceneGraphInfo()._GetStartHeight()===Number.EPSILON?(this._GetSceneGraphInfo()._GetStartHeight()+t)*this._h:t*this._h}return this._h}SetSize(e,t){if(e=+e,t=+t,this.GetTransformWithParentWidth()){const t=this.GetWidth();this._w=0===t?Number.EPSILON:e/t*this._w}else this._w=e;this.GetTransformWithParentHeight()?(e=this.GetHeight(),this._h=0===e?Number.EPSILON:t/e*this._h):this._h=t}GetDepth(){return this._depth}SetDepth(e){if(0>e)throw new RangeError("invalid depth");this._depth=e}GetSceneGraphScale(){if(this.HasParent()){const e=this._sceneGraphInfo;return Math.min(e.GetParentScaleX(),e.GetParentScaleY())}return 1}IsRotatable(){return 0!=(this._flags&FLAG_IS_ROTATABLE)}SetAngle(e){e=+e,this.IsRotatable()&&(this.GetTransformWithParentAngle()&&(e-=this.GetParent().GetAngle()),e=C3$jscomp$159.clampAngle(e),this._a!==e&&(this._a=e,this._MarkSinCosAngleChanged()))}OffsetAngle(e){0!==(e=+e)&&this.IsRotatable()&&(this._a=C3$jscomp$159.clampAngle(this._a+e),this._MarkSinCosAngleChanged())}_MarkSinCosAngleChanged(){if(this._flags|=FLAG_SIN_COS_ANGLE_CHANGED,this.HasChildren()){const e=this.GetChildren();for(let t=0,s=e.length;t<s;t++)e[t]._MarkSinCosAngleChanged()}}GetAngle(){return this.GetTransformWithParentAngle()?C3$jscomp$159.clampAngle(this.GetParent().GetAngle()+this._a):this._a}_MaybeUpdateSinCosAngle(){const e=this._flags;if(0!=(e&FLAG_SIN_COS_ANGLE_CHANGED)){var t=this.GetAngle();this._sinA=Math.sin(t),this._cosA=Math.cos(t),this._flags=e&~FLAG_SIN_COS_ANGLE_CHANGED}}GetSinAngle(){return this._MaybeUpdateSinCosAngle(),this._sinA}GetCosAngle(){return this._MaybeUpdateSinCosAngle(),this._cosA}SetOriginX(e){this._ox=+e}OffsetOriginX(e){this._ox+=+e}GetOriginX(){return this._ox}SetOriginY(e){this._oy=+e}OffsetOriginY(e){this._oy+=+e}GetOriginY(){return this._oy}_SetColor(e){this._color.equals(e)||(this._color===DEFAULT_COLOR?(this._color=C3$jscomp$159.New(C3$jscomp$159.Color,e),this._colorPremultiplied=C3$jscomp$159.New(C3$jscomp$159.Color,e),this._colorPremultiplied.premultiply()):e.equalsRgba(1,1,1,1)?this._colorPremultiplied=this._color=DEFAULT_COLOR:(this._color.set(e),this._colorPremultiplied.set(e),this._colorPremultiplied.premultiply()),this._UpdateRendererStateGroup())}SetOpacity(e){e=C3$jscomp$159.clamp(+e,0,1),this._color.a!==e&&(tempColor$jscomp$6.copyRgb(this._color),tempColor$jscomp$6.a=e,this._SetColor(tempColor$jscomp$6))}OffsetOpacity(e){this.SetOpacity(this.GetOpacity()+e)}GetOpacity(){return this._color.a}SetUnpremultipliedColor(e){this._color.equalsIgnoringAlpha(e)||(tempColor$jscomp$6.copyRgb(e),tempColor$jscomp$6.a=this._color.a,this._SetColor(tempColor$jscomp$6))}SetUnpremultipliedColorRGB(e,t,s){tempColor$jscomp$6.setRgb(e,t,s),this.SetUnpremultipliedColor(tempColor$jscomp$6)}OffsetUnpremultipliedColorRGB(e,t,s){0===e&&0===t&&0===s||(tempColor$jscomp$6.copyRgb(this._color),tempColor$jscomp$6.r+=e,tempColor$jscomp$6.g+=t,tempColor$jscomp$6.b+=s,this.SetUnpremultipliedColor(tempColor$jscomp$6))}GetUnpremultipliedColor(){return this._color}GetPremultipliedColor(){return this._colorPremultiplied}GetDestroyWithParent(){return 0!=(this._flags&FLAG_DESTROY_WITH_PARENT)}SetDestroyWithParent(e){this._SetFlag(FLAG_DESTROY_WITH_PARENT,e)}GetTransformWithParentX(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_X)}SetTransformWithParentX(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_X,e)}GetTransformWithParentY(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_Y)}GetTransformWithParentXOrY(){return 0!=(this._flags&(FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y))}SetTransformWithParentY(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Y,e)}GetTransformWithParentWidth(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_W)}SetTransformWithParentWidth(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_W,e)}GetTransformWithParentHeight(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_H)}SetTransformWithParentHeight(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_H,e)}GetTransformWithParentAngle(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_A)}SetTransformWithParentAngle(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_A,e)}GetTransformWithParentZElevation(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION)}SetTransformWithParentZElevation(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION,e)}_ClearAllSceneGraphFlags(){this._flags&=~MASK_ALL_SCENE_GRAPH_FLAGS}AddChild(e,t){if(e!==this&&!e.HasParent()&&!this._HasChildRecursive(e)&&!this._HasAnyParent(e)){var s=e.GetX(),i=e.GetY(),r=e.GetWidth(),n=e.GetHeight(),a=e.GetAngle(),o=e.GetZElevation();e._SetParent(this),e.SetTransformWithParentX(t.transformX),e.SetTransformWithParentY(t.transformY),e.SetTransformWithParentWidth(t.transformWidth),e.SetTransformWithParentHeight(t.transformHeight),e.SetTransformWithParentAngle(t.transformAngle),e.SetTransformWithParentZElevation(t.transformZElevation),e.SetDestroyWithParent(t.destroyWithParent),t.transformX&&(e._x=s-this.GetX(),t.transformWidth&&(e._x/=this.GetWidth()/this._sceneGraphInfo._GetStartWidth())),t.transformY&&(e._y=i-this.GetY(),t.transformHeight&&(e._y/=this.GetHeight()/this._sceneGraphInfo._GetStartHeight())),t.transformWidth&&(0===(s=this.GetWidth())||s===Number.EPSILON?(e._w=1,e._sceneGraphInfo.SetStartScaleX(1)):(e._w=r/this.GetWidth(),e._sceneGraphInfo.SetStartScaleX(e._w))),t.transformHeight&&(0===(r=this.GetHeight())||r===Number.EPSILON?(e._h=1,e._sceneGraphInfo.SetStartScaleY(1)):(e._h=n/this.GetHeight(),e._sceneGraphInfo.SetStartScaleY(e._h))),t.transformAngle&&(e._a=a-this.GetAngle()),t.transformZElevation&&(e._zElevation=o-this.GetZElevation()),this._AddChildToSceneGraphInfo(e),this.SetBboxChanged()}}RemoveChild(e){if(e.GetParent()===this){var t=e.GetX(),s=e.GetY(),i=e.GetWidth(),r=e.GetHeight(),n=e.GetAngle(),a=e.GetZElevation();e._SetParent(null),e._ClearAllSceneGraphFlags(),e.SetXY(t,s),e.SetSize(i,r),e.SetAngle(n),e.SetZElevation(a),this._RemoveChildFromSceneGraphInfo(e),this.SetBboxChanged()}}_ResetAllSceneGraphState(){this._BuildTmpSceneGraphChildren();var e=[...this.children()];for(const t of e)this.RemoveChild(t);(e=this.GetParent())&&e.RemoveChild(this),this._ClearAllSceneGraphFlags()}_BuildTmpSceneGraphChildren(){if(!this._tmpSceneGraphChildren){var e=[...this.children()];e.length&&(this._tmpSceneGraphChildren=[],this._tmpSceneGraphChildrenIndexes=new WeakMap);var t=0;for(const s of e)e=s.GetInstance(),this._tmpSceneGraphChildren.push(e),this._tmpSceneGraphChildrenIndexes.set(e,t),t++}(t=this.GetParent())&&t._BuildTmpSceneGraphChildren()}_ReleaseTmpSceneGraphInfo(){this._tmpSceneGraphChildren&&(this._tmpSceneGraphChildren.length=0),this._tmpSceneGraphChildrenIndexes=this._tmpSceneGraphChildren=null,needsSceneGraphAfterLoad.delete(this);const e=this.GetParent();e&&!needsSceneGraphAfterLoad.has(e)&&e._ReleaseTmpSceneGraphInfo()}HasParent(){return null!==this.GetParent()}GetParent(){const e=this._sceneGraphInfo;return null!==e?e.GetParent():null}GetTopParent(){let e=this;for(;e.HasParent();)e=e.GetParent();return e}*parents(){let e=this.GetParent();for(;e;)yield e,e=e.GetParent()}HasChild(e){return this.GetChildren().includes(e)}HasChildren(){const e=this._sceneGraphInfo;return null!==e&&e.HasChildren()}GetChildren(){const e=this._sceneGraphInfo;return null!==e?e.GetChildren():EMPTY_ARRAY$jscomp$2}children(){return this.GetChildren()}*allChildren(){for(const e of this.children())yield e,yield*e.allChildren()}GetChildCount(){return this.GetChildren().length}GetAllChildCount(){return[...this.allChildren()].length}GetChildAt(e){const t=this.GetChildren();return 0>(e=Math.floor(+e))||e>=t.length?null:t[e]}_CreateSceneGraphInfo(e){this._sceneGraphInfo||(this._sceneGraphInfo=C3$jscomp$159.New(C3$jscomp$159.SceneGraphInfo,this)),e&&this._sceneGraphInfo.SetParent(e)}_GetSceneGraphInfo(){return this._sceneGraphInfo}_ReleaseSceneGraphInfo(){this._sceneGraphInfo&&(this._sceneGraphInfo.Release(),this._sceneGraphInfo=null)}_SetParent(e){e?(e._CreateSceneGraphInfo(null),this._CreateSceneGraphInfo(e)):(this._sceneGraphInfo&&this._sceneGraphInfo.SetParent(null),this.HasChildren()||this._ReleaseSceneGraphInfo())}_HasAnyParent(e){if(!this.HasParent())return!1;const t=this.GetParent();return t===e||t._HasAnyParent(e)}_HasChildRecursive(e){if(this.HasChild(e))return!0;for(const t of this.GetChildren())if(t._HasChildRecursive(e))return!0;return!1}_AddChildToSceneGraphInfo(e){this._sceneGraphInfo.GetChildren().push(e)}_RemoveChildFromSceneGraphInfo(e){const t=this._sceneGraphInfo.GetChildren(),s=t.indexOf(e);-1!==s&&t.splice(s,1),0!==t.length||this.HasParent()||this._ReleaseSceneGraphInfo(),e.HasChildren()||e._ReleaseSceneGraphInfo()}GetSceneGraphChildrenExportData(){const e=sceneGraphExportDataMap.get(this);return e?e.childrenData:null}GetSceneGraphZIndexExportData(){const e=sceneGraphExportDataMap.get(this);return e?e.zIndexData:NaN}GetSceneGraphZIndex(){const e=sceneGraphZIndexMap.get(this);return C3$jscomp$159.IsFiniteNumber(e)?e:NaN}SetSceneGraphZIndex(e){sceneGraphZIndexMap.set(this,e)}SetUsePointsShaderProgram(){this._SetFlag(FLAG_USE_POINTS_SHADER_PROGRAM,!0),this._UpdateRendererStateGroup()}_UpdateRendererStateGroup(){if(enableUpdateRendererStateGroup){var e=this._runtime.GetRenderer();this._stateGroup&&e.ReleaseStateGroup(this._stateGroup);var t=0!=(this._flags&FLAG_USE_POINTS_SHADER_PROGRAM)?e.GetPointsRenderingProgram()||"<point>":e.GetTextureFillShaderProgram()||"<default>";this._stateGroup=e.AcquireStateGroup(t,this.GetBlendMode(),this._colorPremultiplied,this.GetZElevation())}}GetRendererStateGroup(){return this._stateGroup}HasDefaultColor(){return this._color===DEFAULT_COLOR}SetBlendMode(e){if(0>(e|=0)||31<e)throw new RangeError("invalid blend mode");this.GetBlendMode()!==e&&(this._flags=this._flags&~FLAG_BLEND_MODE_MASK|e<<26,this._UpdateRendererStateGroup())}GetBlendMode(){return(this._flags&FLAG_BLEND_MODE_MASK)>>26}_SetLayer(e){this._layer=e,0!==this.GetZElevation()&&this._layer._SetAnyInstanceZElevated()}GetLayer(){return this._layer}GetLayout(){return this.GetLayer().GetLayout()}_SetZIndex(e){this._zIndex=0|e}GetZIndex(){return this._layer._UpdateZIndices(),this._zIndex}_GetLastCachedZIndex(){return this._zIndex}_SetFlag(e,t){this._flags=t?this._flags|e:this._flags&~e}IsVisible(){return 0!=(this._flags&FLAG_IS_VISIBLE)}SetVisible(e){this._SetFlag(FLAG_IS_VISIBLE,e)}IsCollisionEnabled(){return 0!=(this._flags&FLAG_COLLISION_ENABLED)}SetCollisionEnabled(e){e=!!e,this.IsCollisionEnabled()!==e&&(this._SetFlag(FLAG_COLLISION_ENABLED,e),e?this.SetBboxChanged():this._RemoveFromCollisionCells())}SetSolidCollisionFilter(e,t){if(this._SetFlag(FLAG_SOLID_FILTER_INCLUSIVE,e),this._solidFilterTags&&this._solidFilterTags.clear(),t.trim()){this._solidFilterTags||(this._solidFilterTags=new Set);for(const e of t.split(" "))e&&this._solidFilterTags.add(e.toLowerCase())}else this._solidFilterTags=null}IsSolidCollisionAllowed(e){const t=0!=(this._flags&FLAG_SOLID_FILTER_INCLUSIVE),s=this._solidFilterTags;if(!e||!s)return!t;for(const i of s)if(e.has(i))return t;return!t}SetBboxChanged(){if(this._flags=this._flags|FLAG_BBOX_CHANGED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED,this._objectClass._SetAnyCollisionCellChanged(!0),this._runtime.UpdateRender(),this._layer.UsesRenderCells()&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags&=~FLAG_BBOX_CHANGED,this._UpdateRenderCell()),0!=(this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)&&this._inst.Dispatcher().dispatchEvent(bboxChangeEvent),null!==this._sceneGraphInfo){const e=this._sceneGraphInfo.GetChildren();for(let t=0,s=e.length;t<s;++t)e[t].SetBboxChanged()}}CalculateBbox(e,t,s){const i=this.GetX(),r=this.GetY(),n=this.GetWidth(),a=this.GetHeight(),o=this.GetAngle();e.setWH(i-this._ox*n,r-this._oy*a,n,a),s&&this.HasMesh()&&this._ExpandBboxForMesh(e),0===o?t.setFromRect(e):(e.offset(-i,-r),t.setFromRotatedRectPrecalc(e,this.GetSinAngle(),this.GetCosAngle()),t.offset(i,r),t.getBoundingBox(e)),e.normalize()}_UpdateBbox(){const e=this._flags;0!=(e&FLAG_BBOX_CHANGED)&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags=e&~FLAG_BBOX_CHANGED)}GetBoundingBox(){return this._UpdateBbox(),this._boundingBox}GetBoundingQuad(){return this._UpdateBbox(),this._boundingQuad}PixelRoundQuad(e){var t=this.GetX(),s=this.GetY();return t=Math.round(t)-t,s=Math.round(s)-s,0===t&&0===s?e:(tempQuad$jscomp$3.copy(e),tempQuad$jscomp$3.offset(t,s),tempQuad$jscomp$3)}OverwriteBoundingBox(e){this._boundingBox.copy(e),this._boundingQuad.setFromRect(this._boundingBox),this._flags&=~FLAG_BBOX_CHANGED,this._UpdateCollisionCell(),this._UpdateRenderCell()}SetBboxChangeEventEnabled(e){this._SetFlag(FLAG_ENABLE_BBOX_CHANGED_EVENT,e)}IsBboxChangeEventEnabled(){return 0!=(this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)}IsInViewport(e,t,s){return t&&0!==this.GetDepth()?this.IsInViewport3D(this.GetLayer()._GetViewFrustum()):0===this.GetZElevation()||s?e.intersectsRect(this.GetBoundingBox()):this._IsInViewport_ZElevated()}_IsInViewport_ZElevated(){const e=this.GetLayer(),t=this.GetTotalZElevation();return!(t>=e.GetCameraZ())&&(e.GetViewportForZ(t,tempRect$jscomp$6),tempRect$jscomp$6.intersectsRect(this.GetBoundingBox()))}IsInViewport3D(e){var t=this.GetBoundingBox();const s=t.getLeft(),i=t.getRight(),r=t.getTop();t=t.getBottom();const n=this.GetTotalZElevation(),a=n+this.GetDepth();return e.ContainsAABB(s,r,n,i,t,a)}IsInViewport2(){const e=this.GetLayer();if(e.Has3DCamera())return this.IsInViewport3D(e._GetViewFrustum());const t=e.GetLayout();return this.IsInViewport(e.GetViewport(),t.HasVanishingPointOutsideViewport(),t.IsOrthographicProjection())}_SetDrawBackFaceOnly(e){this._SetFlag(FLAG_DRAW_BACK_FACE_ONLY,e)}_SetDrawNonBackFacesOnly(e){this._SetFlag(FLAG_DRAW_NON_BACK_FACES_ONLY,e)}IsDrawBackFaceOnly(){return 0!=(this._flags&FLAG_DRAW_BACK_FACE_ONLY)}IsDrawNonBackFacesOnly(){return 0!=(this._flags&FLAG_DRAW_NON_BACK_FACES_ONLY)}SetSourceCollisionPoly(e){this._sourceCollisionPoly=e,this._DiscardTransformedCollisionPoly(),this.HasMesh()&&(this._meshInfo.meshPoly=null)}GetSourceCollisionPoly(){return this._sourceCollisionPoly}HasOwnCollisionPoly(){return null!==this._sourceCollisionPoly||this.HasMesh()}GetTransformedCollisionPoly(){return this._GetCustomTransformedCollisionPolyPrecalc(this.GetWidth(),this.GetHeight(),this.GetAngle(),this.GetSinAngle(),this.GetCosAngle())}GetCustomTransformedCollisionPoly(e,t,s){let i=0,r=1;return 0!==s&&(i=Math.sin(s),r=Math.cos(s)),this._GetCustomTransformedCollisionPolyPrecalc(e,t,s,i,r)}_GetCustomTransformedCollisionPolyPrecalc(e,t,s,i,r){let n=this._transformedPolyInfo;null===n&&(this._transformedPolyInfo=n={poly:C3$jscomp$159.New(C3$jscomp$159.CollisionPoly),width:NaN,height:NaN,angle:NaN});const a=n.poly;if(n.width===e&&n.height===t&&n.angle===s)return a;const o=this._sourceCollisionPoly;if(this.HasMesh()){const s=this.GetOriginX(),n=this.GetOriginY(),h=this.GetSourceMesh();let l=this._meshInfo.meshPoly;l||(o?(tempCollisionPoly.copy(o),tempCollisionPoly.offset(s,n)):tempCollisionPoly.setDefaultPoints(),l=h.InsertPolyMeshVertices(tempCollisionPoly),this._meshInfo.meshPoly=l),h.TransformCollisionPoly(l,a),a.offset(-s,-n),a.transformPrecalc(e,t,i,r)}else o?(a.copy(o),a.transformPrecalc(e,t,i,r)):a.setFromQuad(this.GetBoundingQuad(),-this.GetX(),-this.GetY());return n.width=e,n.height=t,n.angle=s,a}_DiscardTransformedCollisionPoly(){this.SetPhysicsBodyChanged(!0);const e=this._transformedPolyInfo;null!==e&&(e.width=NaN)}CreateMesh(e,t){if(e=Math.floor(e),t=Math.floor(t),!this.GetInstance().GetPlugin().SupportsMesh())throw Error("object does not support mesh");this.ReleaseMesh(),this._meshInfo={sourceMesh:C3$jscomp$159.New(C3$jscomp$159.Gfx.Mesh,e,t),transformedMesh:C3$jscomp$159.New(C3$jscomp$159.Gfx.Mesh,e,t),meshPoly:null}}HasMesh(){return null!==this._meshInfo}GetSourceMesh(){if(!this.HasMesh())throw Error("no mesh");return this._meshInfo.sourceMesh}GetTransformedMesh(){if(!this.HasMesh())throw Error("no mesh");return this._meshInfo.transformedMesh}SetMeshChanged(e){this._SetFlag(FLAG_MESH_CHANGED,e)}IsMeshChanged(){return 0!=(this._flags&FLAG_MESH_CHANGED)}SetPhysicsBodyChanged(e){this._SetFlag(FLAG_PHYSICS_BODY_CHANGED,e)}IsPhysicsBodyChanged(){return 0!=(this._flags&FLAG_PHYSICS_BODY_CHANGED)}_ExpandBboxForMesh(e){const t=this._meshInfo.sourceMesh,s=Math.min(t.GetMinX(),0),i=Math.min(t.GetMinY(),0),r=Math.max(t.GetMaxX(),1),n=Math.max(t.GetMaxY(),1),a=e.width(),o=e.height();e.offsetLeft(s*a),e.offsetTop(i*o),e.offsetRight((r-1)*a),e.offsetBottom((n-1)*o),this._depth=t.GetMaxZ()}ReleaseMesh(){this._meshInfo&&(this._meshInfo.sourceMesh.Release(),this._meshInfo.transformedMesh.Release(),this._meshInfo=null,this._DiscardTransformedCollisionPoly())}SetMeshPoint(e,t,s){e=Math.floor(e),t=Math.floor(t);var i=s.mode||"absolute";if(!VALID_SET_MESH_POINT_MODES.has(i))throw Error("invalid mode");i="relative"===i;let r=s.x,n=s.y;const a=s.zElevation;let o="number"==typeof s.u?s.u:i?0:-1;if(s="number"==typeof s.v?s.v:i?0:-1,!this.HasMesh())return!1;const h=this.GetSourceMesh(),l=h.GetMeshPointAt(e,t);if(null===l)return!1;let c=!1;return"number"==typeof a&&l.GetZElevation()!==a&&(l.SetZElevation(a),c=!0),i&&(r+=e/(h.GetHSize()-1),n+=t/(h.GetVSize()-1)),-1!==o||i?(i&&(o+=e/(h.GetHSize()-1)),o=C3$jscomp$159.clamp(o,0,1)):o=l.GetU(),-1!==s||i?(i&&(s+=t/(h.GetVSize()-1)),s=C3$jscomp$159.clamp(s,0,1)):s=l.GetV(),l.GetX()===r&&l.GetY()===n&&l.GetU()===o&&l.GetV()===s?c:(l.SetX(r),l.SetY(n),l.SetU(o),l.SetV(s),this._DiscardTransformedCollisionPoly(),!0)}HasTilemap(){return this._inst.HasTilemap()}ContainsPoint(e,t){return!(!this.GetBoundingBox().containsPoint(e,t)||!this.GetBoundingQuad().containsPoint(e,t))&&(this.HasTilemap()?this._inst.GetSdkInstance().TestPointOverlapTile(e,t):!this.HasOwnCollisionPoly()||this.GetTransformedCollisionPoly().containsPoint(e-this.GetX(),t-this.GetY()))}_IsCollisionCellChanged(){return 0!=(this._flags&FLAG_COLLISION_CELL_CHANGED)}_UpdateCollisionCell(){if(this._IsCollisionCellChanged()&&this.IsCollisionEnabled()&&0==(this._flags&FLAG_DESTROYED$jscomp$1)){var e=this.GetBoundingBox(),t=this._objectClass._GetCollisionCellGrid(),s=this._collisionCells;tempRect$jscomp$6.set(t.XToCell(e.getLeft()),t.YToCell(e.getTop()),t.XToCell(e.getRight()),t.YToCell(e.getBottom())),s.equals(tempRect$jscomp$6)||(e=this._inst,s===DEFAULT_COLLISION_CELLS?(t.Update(e,null,tempRect$jscomp$6),this._collisionCells=C3$jscomp$159.New(C3$jscomp$159.Rect,tempRect$jscomp$6)):(t.Update(e,s,tempRect$jscomp$6),s.copy(tempRect$jscomp$6)),this._flags&=~FLAG_COLLISION_CELL_CHANGED)}}_RemoveFromCollisionCells(){const e=this._collisionCells;e!==DEFAULT_COLLISION_CELLS&&(this._objectClass._GetCollisionCellGrid().Update(this._inst,e,null),this._collisionCells=DEFAULT_COLLISION_CELLS)}_UpdateRenderCell(){const e=this.GetLayer();if(e.UsesRenderCells()&&0==(this._flags&FLAG_DESTROYED$jscomp$1)){var t=e.GetRenderGrid(),s=this.GetBoundingBox(),i=this._renderCells;tempRect$jscomp$6.set(t.XToCell(s.getLeft()),t.YToCell(s.getTop()),t.XToCell(s.getRight()),t.YToCell(s.getBottom())),i.equals(tempRect$jscomp$6)||(s=this._inst,i===DEFAULT_RENDER_CELLS?(t.Update(s,null,tempRect$jscomp$6),this._renderCells=C3$jscomp$159.New(C3$jscomp$159.Rect,tempRect$jscomp$6)):(t.Update(s,i,tempRect$jscomp$6),i.copy(tempRect$jscomp$6)),e.SetRenderListStale())}}_RemoveFromRenderCells(){const e=this._renderCells;e!==DEFAULT_RENDER_CELLS&&(this.GetLayer().GetRenderGrid().Update(this._inst,e,null),this._renderCells=DEFAULT_RENDER_CELLS)}GetRenderCellRange(){return this._renderCells}ZOrderMoveToTop(){const e=this._inst,t=this._layer,s=t._GetInstances();s.length&&s.at(-1)===e||(t._RemoveInstance(e,!1),t._AddInstance(e,!1),this._runtime.UpdateRender())}ZOrderMoveToBottom(){const e=this._inst,t=this._layer,s=t._GetInstances();s.length&&s[0]===e||(t._RemoveInstance(e,!1),t._PrependInstance(e,!1),this._runtime.UpdateRender())}ZOrderMoveToLayer(e){const t=this._inst,s=this._layer;if(s.GetLayout()!==e.GetLayout())throw Error("layer from different layout");e!==s&&(s._RemoveInstance(t,!0),this._SetLayer(e),e._AddInstance(t,!0),this._runtime.UpdateRender())}ZOrderMoveAdjacentToInstance(e,t){const s=this._inst;let i=!1;const r=this._layer;if(e.GetUID()!==s.GetUID()){var n=e.GetWorldInfo();if(!n)throw Error("expected world instance");n=n.GetLayer(),r.GetIndex()!==n.GetIndex()&&(r._RemoveInstance(s,!0),this._SetLayer(n),n._AddInstance(s,!0),i=!0),e=n.MoveInstanceAdjacent(s,e,!!t),(i||e)&&this._runtime.UpdateRender()}}GetInstanceEffectList(){return this._instanceEffectList}_SetHasAnyActiveEffect(e){this._SetFlag(FLAG_HAS_ANY_ACTIVE_EFFECT,e)}HasAnyActiveEffect(){return 0!=(this._flags&FLAG_HAS_ANY_ACTIVE_EFFECT)}_SaveToJson(e){const t={x:this.GetX(),y:this.GetY(),w:this.GetWidth(),h:this.GetHeight(),l:this.GetLayer().GetSID(),zi:this.GetZIndex()};0!==this.GetZElevation()&&(t.ze=this.GetZElevation()),0!==this.GetAngle()&&(t.a=this.GetAngle()),this.HasDefaultColor()||(t.c=this._color.toJSON()),.5!==this.GetOriginX()&&(t.oX=this.GetOriginX()),.5!==this.GetOriginY()&&(t.oY=this.GetOriginY()),0!==this.GetBlendMode()&&(t.bm=this.GetBlendMode()),this.IsVisible()||(t.v=this.IsVisible()),this.IsCollisionEnabled()||(t.ce=this.IsCollisionEnabled()),this.IsBboxChangeEventEnabled()&&(t.be=this.IsBboxChangeEventEnabled()),this._instanceEffectList&&(t.fx=this._instanceEffectList._SaveToJson());const s=0!=(this._flags&FLAG_SOLID_FILTER_INCLUSIVE);return s&&(t.sfi=s),this._solidFilterTags&&(t.sft=[...this._solidFilterTags].join(" ")),this._sceneGraphInfo&&"visual-state"!==e&&(t.sgi=this._sceneGraphInfo._SaveToJson(e),sceneGraphExportDataMap.has(this)&&(t.sgcd=sceneGraphExportDataMap.get(this).childrenData,t.sgzid=sceneGraphExportDataMap.get(this).zIndexData)),this.HasMesh()&&(t.mesh=this.GetSourceMesh().SaveToJson()),t}_SaveSceneGraphPropertiesToJson(){return{x:this._x,y:this._y,z:this._zElevation,w:this._w,h:this._h,a:this._a}}_LoadSceneGraphPropertiesFromJson(e){e&&(this._x=e.x,this._y=e.y,this._zElevation=e.z,this._w=e.w,this._h=e.h,this._a=e.a,this._MarkSinCosAngleChanged(),this.SetBboxChanged())}_SetupSceneGraphConnectionsOnChangeOfLayout(){this._ReleaseTmpSceneGraphInfo(),this._ResetAllSceneGraphState(),this._CreateSceneGraphInfo(null),this._sceneGraphInfo&&this._sceneGraphInfo._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes)}_OnBeforeLoad(e){"visual-state"!==e&&this._ResetAllSceneGraphState()}_LoadFromJson(e,t){if(enableUpdateRendererStateGroup=!1,this.SetX(e.x),this.SetY(e.y),this.SetWidth(e.w),this.SetHeight(e.h),this._SetZIndex(e.zi),this.SetZElevation(e.hasOwnProperty("ze")?e.ze:0),this.SetAngle(e.hasOwnProperty("a")?e.a:0),e.hasOwnProperty("c")?tempColor$jscomp$6.setFromJSON(e.c):e.hasOwnProperty("o")?(tempColor$jscomp$6.copyRgb(this._color),tempColor$jscomp$6.a=e.o):tempColor$jscomp$6.setRgba(1,1,1,1),this._SetColor(tempColor$jscomp$6),this.SetOriginX(e.hasOwnProperty("oX")?e.oX:.5),this.SetOriginY(e.hasOwnProperty("oY")?e.oY:.5),this.SetBlendMode(e.hasOwnProperty("bm")?e.bm:0),this.SetVisible(!e.hasOwnProperty("v")||e.v),this.SetCollisionEnabled(!e.hasOwnProperty("ce")||e.ce),this.SetBboxChangeEventEnabled(!!e.hasOwnProperty("be")&&e.be),this.SetSolidCollisionFilter(!!e.hasOwnProperty("sfi")&&e.sfi,e.hasOwnProperty("sft")?e.sft:""),this._instanceEffectList&&e.hasOwnProperty("fx")&&this._instanceEffectList._LoadFromJson(e.fx),!e.hasOwnProperty("sgi")&&"visual-state"!==t&&this._tmpSceneGraphChildren)for(const e of this._tmpSceneGraphChildren)e.IsDestroyed()||this._runtime.DestroyInstance(e);if(e.hasOwnProperty("sgi")&&"visual-state"!==t){this._CreateSceneGraphInfo(null);const t=this._sceneGraphInfo,s=e.sgi;t._LoadFromJson(s),t._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes),needsSceneGraphAfterLoad.set(this,!0);const i=this.GetRuntime().Dispatcher();this._after_load&&i.removeEventListener("afterload",this._after_load),this._after_load_instance&&i.removeEventListener("afterloadinstance",this._after_load_instance),this._after_load_instance=this._after_load=null,this._after_load=(e,r)=>{this._after_load&&i.removeEventListener("afterload",this._after_load),this._after_load_instance&&i.removeEventListener("afterloadinstance",this._after_load_instance),this._after_load=this._after_load_instance=null,0==(this._flags&FLAG_DESTROYED$jscomp$1)&&(t._OnAfterLoad(s,r),t._SetTmpSceneGraphChildren(null,null),this._ReleaseTmpSceneGraphInfo(),this.SetBboxChanged())},this._after_load_instance=e=>{e.instance===this.GetInstance()&&this._after_load(e,{ignoreMissingInstances:!0})},i.addEventListener("afterload",this._after_load),i.addEventListener("afterloadinstance",this._after_load_instance),e.sgcd&&C3$jscomp$159.IsFiniteNumber(e.sgzid)&&sceneGraphExportDataMap.set(this,{childrenData:e.sgcd,zIndexData:e.sgzid})}e.hasOwnProperty("mesh")?(e=e.mesh,this.CreateMesh(e.cols,e.rows),this.GetSourceMesh().LoadFromJson(e)):this.ReleaseMesh(),this.SetBboxChanged(),enableUpdateRendererStateGroup=!0,this._UpdateRendererStateGroup()}};const C3$jscomp$160=self.C3;C3$jscomp$160.BehaviorType=class extends C3$jscomp$160.DefendedBase{constructor(e,t){super();const s=e.GetRuntime(),i=s.GetPluginManager(),r=s.GetObjectReference(t[1]);i.HasBehaviorByConstructorFunction(r)||i.CreateBehavior(t),this._runtime=s,this._objectClass=e,this._behavior=i.GetBehaviorByConstructorFunction(r),this._sdkType=null,this._instSdkCtor=r.Instance,this._sid=t[2],this._name=t[0],this._jsPropName=this._runtime.GetJsPropName(t[3]),this._sdkType=C3$jscomp$160.New(r.Type,this),this.OnCreate()}static Create(e,t){return C3$jscomp$160.New(C3$jscomp$160.BehaviorType,e,t)}Release(){this._behavior=this._runtime=null,this._sdkType.Release(),this._instSdkCtor=this._sdkType=null}GetSdkType(){return this._sdkType}OnCreate(){this._sdkType.OnCreate()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetBehavior(){return this._behavior}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetSID(){return this._sid}GetJsPropName(){return this._jsPropName}};const C3$jscomp$161=self.C3,IBehaviorInstance$jscomp$1=self.IBehaviorInstance;C3$jscomp$161.BehaviorInstance=class extends C3$jscomp$161.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._behaviorType=e.behaviorType,this._behavior=this._behaviorType.GetBehavior(),this._inst=e.instance,this._index=e.index,this._iScriptInterface=this._sdkInst=null,this._behavior._AddInstance(this._inst)}Release(){this._iScriptInterface&&(this._iScriptInterface._Release(),this._iScriptInterface=null),this._behavior._RemoveInstance(this._inst),this._sdkInst.Release(),this._inst=this._behavior=this._behaviorType=this._runtime=this._sdkInst=null}_CreateSdkInstance(e){if(this._sdkInst)throw Error("already got sdk instance");this._sdkInst=C3$jscomp$161.New(this._behaviorType.GetInstanceSdkCtor(),this,e)}GetSdkInstance(){return this._sdkInst}GetObjectInstance(){return this._inst}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetBehavior(){return this._behavior}_GetIndex(){return this._index}PostCreate(){this._sdkInst.PostCreate()}OnSpriteFrameChanged(e,t){this._sdkInst.OnSpriteFrameChanged(e,t)}_GetDebuggerProperties(){return this._sdkInst.GetDebuggerProperties()}SaveToJson(){return this._sdkInst.SaveToJson()}LoadFromJson(e){return this._sdkInst.LoadFromJson(e)}static SortByTickSequence(e,t){var s=e.GetObjectInstance(),i=t.GetObjectInstance();const r=s.GetObjectClass().GetIndex(),n=i.GetObjectClass().GetIndex();return r!==n?r-n:(s=s.GetPUID())!==(i=i.GetPUID())?s-i:e.GetBehaviorInstance()._GetIndex()-t.GetBehaviorInstance()._GetIndex()}_InitScriptInterface(){const e=this._sdkInst.GetScriptInterfaceClass(),t=e||IBehaviorInstance$jscomp$1;if(IBehaviorInstance$jscomp$1._Init(this),this._iScriptInterface=new t,IBehaviorInstance$jscomp$1._Init(null),e&&!(this._iScriptInterface instanceof IBehaviorInstance$jscomp$1))throw new TypeError(`script interface class '${e.name}' does not extend the right base class '${IBehaviorInstance$jscomp$1.name}'`);return this._iScriptInterface}GetScriptInterface(){return this._iScriptInterface||this._InitScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}};const C3$jscomp$162=self.C3;C3$jscomp$162.EffectList=class extends C3$jscomp$162.DefendedBase{constructor(e,t){super(),this._owner=e,this._allEffectTypes=[],this._activeEffectTypes=[],this._effectTypesByName=new Map,this._effectParams=[],this._effectParamBuffers=[],this._allInstanceEffectLists=new Set,this._preservesOpaqueness=!0;for(const s of t)e=C3$jscomp$162.New(C3$jscomp$162.EffectType,this,s,this._allEffectTypes.length),this._allEffectTypes.push(e),this._effectTypesByName.set(e.GetName().toLowerCase(),e),3<=s.length&&this._effectParams.push(this._LoadSingleEffectParameters(e,s[2]));this.GetRuntime()._AddEffectList(this)}Release(){for(const e of this._effectParamBuffers)e.Release();C3$jscomp$162.clearArray(this._effectParamBuffers),C3$jscomp$162.clearArray(this._allEffectTypes),C3$jscomp$162.clearArray(this._activeEffectTypes),this._effectTypesByName.clear(),C3$jscomp$162.clearArray(this._effectParams),this._owner=null}_AddInstanceEffectList(e){this._allInstanceEffectLists.add(e)}_RemoveInstanceEffectList(e){this._allInstanceEffectLists.delete(e)}_InitRenderer(e){e.IsWebGPU()&&(this._effectParamBuffers=this._allEffectTypes.map((e=>0<(e=e.GetShaderProgram()).GetCustomParametersByteSize()?C3$jscomp$162.New(C3$jscomp$162.Gfx.WebGPUEffectCustomParamsBuffer,e):null)),this._UpdateAllEffectParamBuffers());for(const t of this._allInstanceEffectLists)t._InitRenderer(e)}PrependEffectTypes(e){if(e.length){this._allEffectTypes=e.concat(this._allEffectTypes);for(const t of e)this._effectTypesByName.set(t.GetName().toLowerCase(),t);for(let e=0,t=this._allEffectTypes.length;e<t;++e)this._allEffectTypes[e]._SetIndex(e)}}_LoadSingleEffectParameters(e,t){e.SetActive(t[0]);for(let s=0,i=(e=t.slice(1)).length;s<i;++s)if(t=e[s],Array.isArray(t)){const i=C3$jscomp$162.New(C3$jscomp$162.Color);i.setFromJSON(t),e[s]=i}return e}GetOwner(){return this._owner}GetRuntime(){return this._owner.GetRuntime()}UpdateActiveEffects(){C3$jscomp$162.clearArray(this._activeEffectTypes);let e=!0;for(const t of this._allEffectTypes)t.IsActive()&&(this._activeEffectTypes.push(t),t.GetShaderProgram().PreservesOpaqueness()||(e=!1));this._preservesOpaqueness=e}GetAllEffectTypes(){return this._allEffectTypes}HasAnyEffectType(){return 0<this._allEffectTypes.length}GetEffectTypeByName(e){return this._effectTypesByName.get(e.toLowerCase())||null}GetEffectTypeByIndex(e){if(0>(e=Math.floor(+e))||e>=this._allEffectTypes.length)throw new RangeError("invalid effect type index");return this._allEffectTypes[e]}IsEffectIndexActive(e){return this.GetEffectTypeByIndex(e).IsActive()}SetEffectIndexActive(e,t){this.GetEffectTypeByIndex(e).SetActive(t)}GetActiveEffectTypes(){return this._activeEffectTypes}HasAnyActiveEffect(){return 0<this._activeEffectTypes.length}PreservesOpaqueness(){return this._preservesOpaqueness}GetEffectParametersForIndex(e){return this._effectParams[e]}_GetEffectChainShaderParametersForIndex(e){return e<this._effectParamBuffers.length?this._effectParamBuffers[e]:this._effectParams[e]}GetEffectParameter(e,t){return 0>e||e>=this._effectParams.length?null:(e=this._effectParams[e],0>t||t>=e.length?null:e[t])}SetEffectParameter(e,t,s){if(0>e||e>=this._effectParams.length)return!1;const i=this._effectParams[e];if(0>t||t>=i.length)return!1;const r=i[t];if(r instanceof C3$jscomp$162.Color){if(r.equalsIgnoringAlpha(s))return!1;r.copyRgb(s)}else{if(r===s)return!1;i[t]=s}return e<this._effectParamBuffers.length&&this._effectParamBuffers[e].SetParameterValue(t,s),!0}_UpdateAllEffectParamBuffers(){const e=this._effectParams,t=this._effectParamBuffers;for(let s=0,i=Math.min(e.length,t.length);s<i;++s){const i=t[s],r=e[s];for(let e=0,t=r.length;e<t;++e)i.SetParameterValue(e,r[e])}}static SaveFxParamToJson(e){return e&&e instanceof C3$jscomp$162.Color?{t:"color",v:e.toJSON()}:e}static LoadFxParamFromJson(e){if(null===e)return NaN;if("object"==typeof e){if("color"===e.t){const t=C3$jscomp$162.New(C3$jscomp$162.Color);return t.setFromJSON(e.v),t}throw Error("invalid effect parameter type")}return e}static SaveFxParamsToJson(e){return e.map(C3$jscomp$162.EffectList.SaveFxParamToJson)}static LoadFxParamsFromJson(e){return e.map(C3$jscomp$162.EffectList.LoadFxParamFromJson)}SaveToJson(){return this._allEffectTypes.map((e=>({name:e.GetName(),active:e.IsActive(),params:C3$jscomp$162.EffectList.SaveFxParamsToJson(this._effectParams[e.GetIndex()])})))}LoadFromJson(e){for(const t of e)(e=this.GetEffectTypeByName(t.name))&&(e.SetActive(t.active),this._effectParams[e.GetIndex()]=C3$jscomp$162.EffectList.LoadFxParamsFromJson(t.params));this.UpdateActiveEffects(),this._UpdateAllEffectParamBuffers()}};const C3$jscomp$163=self.C3;C3$jscomp$163.EffectType=class extends C3$jscomp$163.DefendedBase{constructor(e,t,s){super(),this._effectList=e,this._id=t[0],this._name=t[1],this._index=s,this._shaderProgram=null,this._isActive=!0}Release(){this._shaderProgram=this._effectList=null}Clone(e){return(e=C3$jscomp$163.New(C3$jscomp$163.EffectType,e,[this._id,this._name],-1))._shaderProgram=this._shaderProgram,e._isActive=this._isActive,e}_InitRenderer(e){if(!(e=e.GetShaderProgramByName(this._id)))throw Error("failed to find shader program '"+this._id+"'");this._shaderProgram=e}GetEffectList(){return this._effectList}GetName(){return this._name}_SetIndex(e){this._index=e}GetIndex(){return this._index}GetOwner(){return this._effectList.GetOwner()}GetRuntime(){return this._effectList.GetRuntime()}SetActive(e){this._isActive=!!e}IsActive(){return this._isActive}GetShaderProgram(){return this._shaderProgram}GetDefaultParameterValues(){const e=[];for(let t=0,s=this._shaderProgram.GetParameterCount();t<s;++t){const s=this._shaderProgram.GetParameterType(t);if("float"===s||"percent"===s)e.push(0);else{if("color"!==s)throw new TypeError("unknown effect parameter type");e.push(C3$jscomp$163.New(C3$jscomp$163.Color,1,1,1,1))}}return e}};const C3$jscomp$164=self.C3;C3$jscomp$164.InstanceEffectList=class extends C3$jscomp$164.DefendedBase{constructor(e,t){super(),this._inst=e,this._wi=t,this._effectList=e.GetObjectClass().GetEffectList(),this._wasDefaultColor=this._needsRebuildSteps=!0,this._wasTexRotated=this._wasRotatedOrNegativeSize=this._was3D=!1,this._effectChain=C3$jscomp$164.New(C3$jscomp$164.Gfx.EffectChain,e.GetRuntime().GetCanvasManager().GetEffectChainManager(),{drawContent:(e,t)=>{const s=(t=t.GetContentObject()).GetWorldInfo();e.SetColor(s.GetPremultipliedColor()),e.SetCurrentZ(s.GetTotalZElevation()),t.Draw(e),e.SetCurrentZ(0)},getSourceTextureInfo:e=>{const t=e.GetCurrentTexRect(),[s,i]=e.GetCurrentSurfaceSize();return{srcTexRect:t,srcWidth:s,srcHeight:i}},getShaderParameters:e=>this._GetEffectChainShaderParametersForIndex(e)}),this._activeEffectFlags=[],this._activeEffectTypes=[],this._preservesOpaqueness=!0,this._effectParams=[],this._effectParamBuffers=[],this._InitRenderer(e.GetRuntime().GetRenderer());for(let e=0,t=this._effectList.GetAllEffectTypes().length;e<t;++e)this._activeEffectFlags.push(!0);this.UpdateActiveEffects(),this._effectList._AddInstanceEffectList(this)}Release(){this._effectList._RemoveInstanceEffectList(this);for(const e of this._effectParamBuffers)e.Release();C3$jscomp$164.clearArray(this._effectParamBuffers),this._effectChain.Release(),this._effectChain=null,C3$jscomp$164.clearArray(this._activeEffectFlags),C3$jscomp$164.clearArray(this._activeEffectTypes),C3$jscomp$164.clearArray(this._effectParams),this._effectList=this._inst=null}_InitRenderer(e){e.IsWebGPU()&&(this._effectParamBuffers=this._effectList.GetAllEffectTypes().map((e=>0<(e=e.GetShaderProgram()).GetCustomParametersByteSize()?C3$jscomp$164.New(C3$jscomp$164.Gfx.WebGPUEffectCustomParamsBuffer,e):null)))}_LoadEffectParameters(e){let t=0;for(const s of e)this._effectParams.push(this._LoadSingleEffectParameters(t,s)),++t;this._UpdateAllEffectParamBuffers(),this.UpdateActiveEffects()}_LoadSingleEffectParameters(e,t){this._activeEffectFlags[e]=t[0];for(let s=0,i=(e=t.slice(1)).length;s<i;++s)if(t=e[s],Array.isArray(t)){const i=C3$jscomp$164.New(C3$jscomp$164.Color);i.setFromJSON(t),e[s]=i}return e}LoadDefaultEffectParameters(){for(const e of this._effectList.GetAllEffectTypes())this._effectParams.push(e.GetDefaultParameterValues());this._UpdateAllEffectParamBuffers()}GetOwner(){return this._owner}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}GetRuntime(){return this._inst.GetRuntime()}UpdateActiveEffects(){C3$jscomp$164.clearArray(this._activeEffectTypes);const e=this._wi,t=this._effectList.GetAllEffectTypes(),s=this._activeEffectTypes,i=this._activeEffectFlags;let r=!0;for(let e=0,n=t.length;e<n;++e)if(i[e]){const i=t[e];s.push(i),i.GetShaderProgram().PreservesOpaqueness()||(r=!1)}this._preservesOpaqueness=r,e._SetHasAnyActiveEffect(!!s.length),this._needsRebuildSteps=!0}_MaybeRebuildEffectChainSteps(){const e=this._inst;var t=this._wi;const s=t.HasDefaultColor(),i=0<t.GetDepth();t=0!==t.GetAngle()||0>t.GetWidth()||0>t.GetHeight();const r=e.IsCurrentTexRotated();(this._needsRebuildSteps||s!==this._wasDefaultColor||i!==this._was3D||t!==this._wasRotatedOrNegativeSize||r!==this._wasTexRotated||this._effectChain.NeedsRebuild())&&(this._effectChain.BuildSteps(this._activeEffectTypes.map((e=>e.GetShaderProgram())),{indexMap:this._activeEffectTypes.map((e=>e.GetIndex())),forcePreDraw:!s||e.MustPreDraw(),is3D:i,isSourceTextureRotated:r,isRotatedOrNegativeSizeInstance:t}),this._needsRebuildSteps=!1,this._wasDefaultColor=s,this._was3D=i,this._wasRotatedOrNegativeSize=t,this._wasTexRotated=r)}GetActiveEffectTypes(){return this._activeEffectTypes}GetEffectParametersForIndex(e){return this._effectParams[e]}_GetEffectChainShaderParametersForIndex(e){return e<this._effectParamBuffers.length?this._effectParamBuffers[e]:this._effectParams[e]}GetEffectParameter(e,t){return 0>e||e>=this._effectParams.length?null:(e=this._effectParams[e],0>t||t>=e.length?null:e[t])}SetEffectParameter(e,t,s){if(0>e||e>=this._effectParams.length)return!1;const i=this._effectParams[e];if(0>t||t>=i.length)return!1;const r=i[t];if(r instanceof C3$jscomp$164.Color){if(r.equalsIgnoringAlpha(s))return!1;r.copyRgb(s)}else{if(r===s)return!1;i[t]=s}return e<this._effectParamBuffers.length&&this._effectParamBuffers[e].SetParameterValue(t,s),!0}_UpdateAllEffectParamBuffers(){const e=this._effectParams,t=this._effectParamBuffers;for(let s=0,i=t.length;s<i;++s){const i=t[s],r=e[s];for(let e=0,t=r.length;e<t;++e)i.SetParameterValue(e,r[e])}}PreservesOpaqueness(){return this._preservesOpaqueness}HasAnyActiveBackgroundBlendingEffect(){return this._activeEffectTypes.some((e=>e.GetShaderProgram().BlendsBackground()))}IsEffectIndexActive(e){return this._activeEffectFlags[e]}SetEffectIndexActive(e,t){this._activeEffectFlags[e]=!!t}GetAllEffectTypes(){return this._effectList.GetAllEffectTypes()}_SaveToJson(){return this._effectList.GetAllEffectTypes().map((e=>({name:e.GetName(),active:this._activeEffectFlags[e.GetIndex()],params:C3$jscomp$164.EffectList.SaveFxParamsToJson(this._effectParams[e.GetIndex()])})))}_LoadFromJson(e){for(const t of e)(e=this._effectList.GetEffectTypeByName(t.name))&&(this._activeEffectFlags[e.GetIndex()]=t.active,this._effectParams[e.GetIndex()]=C3$jscomp$164.EffectList.LoadFxParamsFromJson(t.params));this.UpdateActiveEffects(),this._UpdateAllEffectParamBuffers()}};const C3$jscomp$165=self.C3,tempCandidates=[],tileCollRectCandidates=[],tempJumpthruRet=[],tempPolyA=C3$jscomp$165.New(C3$jscomp$165.CollisionPoly),tempPolyB=C3$jscomp$165.New(C3$jscomp$165.CollisionPoly),tempQuad$jscomp$4=C3$jscomp$165.New(C3$jscomp$165.Quad),tempRect$jscomp$7=C3$jscomp$165.New(C3$jscomp$165.Rect),tempRect2$jscomp$1=C3$jscomp$165.New(C3$jscomp$165.Rect);let tempPolyC=null,tempRect3$jscomp$1=null,tempQuadB=null;C3$jscomp$165.CollisionEngine=class extends C3$jscomp$165.DefendedBase{constructor(e){super(),this._runtime=e,this._registeredCollisions=[],this._polyCheckSec=this._polyCheckCount=this._collisionCheckSec=this._collisionCheckCount=0}Release(){this._runtime=null}_Update1sStats(){this._collisionCheckSec=this._collisionCheckCount,this._collisionCheckCount=0,this._polyCheckSec=this._polyCheckCount,this._polyCheckCount=0}Get1secCollisionChecks(){return this._collisionCheckSec}Get1secPolyChecks(){return this._polyCheckSec}RegisterCollision(e,t){const s=e.GetWorldInfo(),i=t.GetWorldInfo();s&&i&&s.IsCollisionEnabled()&&i.IsCollisionEnabled()&&this._registeredCollisions.push([e,t])}AddRegisteredCollisionCandidates(e,t,s){for(const[i,r]of this._registeredCollisions){let n;if(e===i)n=r;else{if(e!==r)continue;n=i}n.BelongsToObjectClass(t)&&(s.includes(n)||s.push(n))}}CheckRegisteredCollision(e,t){if(!this._registeredCollisions.length)return!1;for(const[s,i]of this._registeredCollisions)if(e===s&&t===i||e===i&&t===s)return!0;return!1}ClearRegisteredCollisions(){C3$jscomp$165.clearArray(this._registeredCollisions)}TestOverlap(e,t){if(!e||!t||e===t)return!1;if(e=e.GetWorldInfo(),t=t.GetWorldInfo(),!e.IsCollisionEnabled()||!t.IsCollisionEnabled())return!1;this._collisionCheckCount++;const s=e.GetLayer(),i=t.GetLayer();return s.IsTransformCompatibleWith(i)?this._TestOverlap_SameLayers(e,t):this._TestOverlap_DifferentLayers(e,t)}_TestOverlap_SameLayers(e,t){if(!e.GetBoundingBox().intersectsRect(t.GetBoundingBox()))return!1;if(this._polyCheckCount++,!e.GetBoundingQuad().intersectsQuad(t.GetBoundingQuad())||e.HasTilemap()&&t.HasTilemap())return!1;if(e.HasTilemap())return this.TestTilemapOverlap(e,t);if(t.HasTilemap())return this.TestTilemapOverlap(t,e);if(!e.HasOwnCollisionPoly()&&!t.HasOwnCollisionPoly())return!0;const s=e.GetTransformedCollisionPoly(),i=t.GetTransformedCollisionPoly();return s.intersectsPoly(i,t.GetX()-e.GetX(),t.GetY()-e.GetY())}_TestOverlap_DifferentLayers(e,t){var s=e.HasTilemap(),i=t.HasTilemap();if(s&&!i)return this.TestTilemapOverlapDifferentLayers(e,t);if(i&&!s)return this.TestTilemapOverlapDifferentLayers(t,e);if(i||s)return!1;i=e.GetLayer(),s=t.GetLayer(),tempPolyA.copy(e.GetTransformedCollisionPoly()),tempPolyB.copy(t.GetTransformedCollisionPoly());var r=tempPolyA.pointsArr();for(let t=0,s=r.length;t<s;t+=2){const s=t+1,n=r[s],[a,o]=i.LayerToCanvasCss(r[t]+e.GetX(),n+e.GetY());r[t]=a,r[s]=o}for(let n=0,a=(e=tempPolyB.pointsArr()).length;n<a;n+=2){r=e[i=n+1];const[a,o]=s.LayerToCanvasCss(e[n]+t.GetX(),r+t.GetY());e[n]=a,e[i]=o}return tempPolyA.setBboxChanged(),tempPolyB.setBboxChanged(),this._polyCheckCount++,tempPolyA.intersectsPoly(tempPolyB,0,0)}TestTilemapOverlapDifferentLayers(e,t){var s=e.GetLayer(),i=t.GetLayer();tempPolyC||(tempPolyC=C3$jscomp$165.New(C3$jscomp$165.CollisionPoly)),tempRect3$jscomp$1||(tempRect3$jscomp$1=C3$jscomp$165.New(C3$jscomp$165.Rect)),tempQuadB||(tempQuadB=C3$jscomp$165.New(C3$jscomp$165.Quad));var r=t.GetX(),n=t.GetY();const[a,o]=i.LayerToCanvasCss(r,n),[h,l]=s.CanvasCssToLayer(a,o);if(s=h-r,n=l-n,tempRect3$jscomp$1.copy(t.GetBoundingBox()),tempRect3$jscomp$1.offset(s,n),!e.GetBoundingBox().intersectsRect(tempRect3$jscomp$1))return!1;if(tempQuadB.copy(t.GetBoundingQuad()),tempQuadB.offset(s,n),this._polyCheckCount++,!e.GetBoundingQuad().intersectsQuad(tempQuadB))return!1;tempPolyC.copy(t.GetTransformedCollisionPoly());for(let e=0,t=(i=tempPolyC.pointsArr()).length;e<t;e+=2)r=e+1,i[e]+=s,i[r]+=n;return tempPolyC.setBboxChanged(),this.TestTilemapOverlap(e,t,h,l,tempPolyC,tempRect3$jscomp$1,tempQuadB)}TestTilemapOverlap(e,t,s,i,r,n,a){n=void 0!==n?n:t.GetBoundingBox();const o=e.GetX(),h=e.GetY();var l=e.GetInstance().GetSdkInstance();s=void 0!==s?s:t.GetX(),i=void 0!==i?i:t.GetY(),e=t.HasOwnCollisionPoly(),a=void 0!==a?a:t.GetBoundingQuad(),l.GetCollisionRectCandidates(n,tileCollRectCandidates);for(let p=0,_=tileCollRectCandidates.length;p<_;++p){var c=tileCollRectCandidates[p];if(l=c.GetRect(),this._collisionCheckCount++,n.intersectsRectOffset(l,o,h)&&(tempQuad$jscomp$4.setFromRect(l),tempQuad$jscomp$4.offset(o,h),tempQuad$jscomp$4.intersectsQuad(a)))if(e){var u=void 0!==r?r:t.GetTransformedCollisionPoly();if(c=c.GetPoly()){if(this._polyCheckCount++,c.intersectsPoly(u,s-(o+l.getLeft()),i-(h+l.getTop())))return C3$jscomp$165.clearArray(tileCollRectCandidates),!0}else if(tempPolyA.setFromQuad(tempQuad$jscomp$4,0,0),tempPolyA.intersectsPoly(u,s,i))return C3$jscomp$165.clearArray(tileCollRectCandidates),!0}else{if(!(u=c.GetPoly()))return C3$jscomp$165.clearArray(tileCollRectCandidates),!0;if(tempPolyA.setFromQuad(a,0,0),u.intersectsPoly(tempPolyA,-(o+l.getLeft()),-(h+l.getTop())))return C3$jscomp$165.clearArray(tileCollRectCandidates),!0}}return C3$jscomp$165.clearArray(tileCollRectCandidates),!1}TestAndSelectCanvasPointOverlap(e,t,s,i){const r=e.GetCurrentSol();var n=this._runtime.GetCurrentEvent();if(!n)throw Error("cannot call outside event");n=n.IsOrBlock();const a=new Map,o=e=>{let t=a.get(e);return void 0===t&&(t=e.IsSelfAndParentsInteractive(),a.set(e,t)),t};if(r.IsSelectAll())for(var h of(i||(r._SetSelectAll(!1),C3$jscomp$165.clearArray(r._GetOwnInstances())),e.GetInstances())){var l=h.GetWorldInfo(),c=l.GetLayer(),u=!1;if(o(c)&&l.IsInViewport2()){const[e,i]=c.CanvasCssToLayer(t,s,l.GetTotalZElevation());u=l.ContainsPoint(e,i)}if(u){if(i)return!1;r._PushInstance(h)}else n&&r._PushElseInstance(h)}else{l=!1,n?this._runtime.IsCurrentConditionFirst()&&!r._GetOwnElseInstances().length&&r._GetOwnInstances().length?h=r._GetOwnInstances():(h=r._GetOwnElseInstances(),l=!0):h=r._GetOwnInstances(),c=0;for(let e=0,a=h.length;e<a;++e){const a=(u=h[e]).GetWorldInfo(),p=a.GetLayer();let _=!1;if(o(p)&&a.IsInViewport2()){const[e,i]=p.CanvasCssToLayer(t,s,a.GetTotalZElevation());_=a.ContainsPoint(e,i)}if(_){if(i)return!1;l?r._PushInstance(u):h[c++]=u}else l?h[c++]=u:n&&r._PushElseInstance(u)}i||(h.length=c)}return e.ApplySolToContainer(),a.clear(),!!i||r.HasAnyInstances()}GetCollisionCandidates(e,t,s,i){if(e=!!e&&(1!==e.GetParallaxX()||1!==e.GetParallaxY()),t.IsFamily())for(const r of t.GetFamilyMembers())e||r.IsAnyInstanceParallaxed()?C3$jscomp$165.appendArray(i,r.GetInstances()):(r._UpdateAllCollisionCells(),r._GetCollisionCellGrid().QueryRange(s,i));else e||t.IsAnyInstanceParallaxed()?C3$jscomp$165.appendArray(i,t.GetInstances()):(t._UpdateAllCollisionCells(),t._GetCollisionCellGrid().QueryRange(s,i))}GetObjectClassesCollisionCandidates(e,t,s,i){for(const r of t)this.GetCollisionCandidates(e,r,s,i)}GetSolidCollisionCandidates(e,t,s){const i=this._runtime.GetSolidBehavior();i&&this.GetObjectClassesCollisionCandidates(e,i.GetObjectClasses(),t,s)}GetJumpthruCollisionCandidates(e,t,s){const i=this._runtime.GetJumpthruBehavior();i&&this.GetObjectClassesCollisionCandidates(e,i.GetObjectClasses(),t,s)}IsSolidCollisionAllowed(e,t){return e._IsSolidEnabled()&&(!t||t.GetWorldInfo().IsSolidCollisionAllowed(e.GetSavedDataMap().get("solidTags")))}TestOverlapSolid(e){const t=e.GetWorldInfo();this.GetSolidCollisionCandidates(t.GetLayer(),t.GetBoundingBox(),tempCandidates);for(const t of tempCandidates)if(this.IsSolidCollisionAllowed(t,e)&&this.TestOverlap(e,t))return C3$jscomp$165.clearArray(tempCandidates),t;return C3$jscomp$165.clearArray(tempCandidates),null}TestRectOverlapSolid(e,t){this.GetSolidCollisionCandidates(null,e,tempCandidates);for(const s of tempCandidates)if(this.IsSolidCollisionAllowed(s,t)&&this.TestRectOverlap(e,s))return C3$jscomp$165.clearArray(tempCandidates),s;return C3$jscomp$165.clearArray(tempCandidates),null}TestOverlapJumpthru(e,t){let s=null;t&&(s=tempJumpthruRet,C3$jscomp$165.clearArray(s));const i=e.GetWorldInfo();this.GetJumpthruCollisionCandidates(i.GetLayer(),i.GetBoundingBox(),tempCandidates);for(const i of tempCandidates)if(i._IsJumpthruEnabled()&&this.TestOverlap(e,i)){if(!t)return C3$jscomp$165.clearArray(tempCandidates),i;s.push(i)}return C3$jscomp$165.clearArray(tempCandidates),s}PushOut(e,t,s,i,r){i=i||50;const n=e.GetWorldInfo(),a=n.GetX(),o=n.GetY();for(let h=0;h<i;++h)if(n.SetXY(a+t*h,o+s*h),n.SetBboxChanged(),!this.TestOverlap(e,r))return!0;return n.SetXY(a,o),n.SetBboxChanged(),!1}PushOutSolid(e,t,s,i,r,n){i=i||50;const a=e.GetWorldInfo(),o=a.GetX(),h=a.GetY();let l=null,c=null;for(let u=0;u<i;++u)if(a.SetXY(o+t*u,h+s*u),a.SetBboxChanged(),!this.TestOverlap(e,l))if(l=this.TestOverlapSolid(e))c=l;else if(r&&(l=n?this.TestOverlap(e,n)?n:null:this.TestOverlapJumpthru(e))&&(c=l),!l)return c&&this.PushInFractional(e,t,s,c,16,!0),!0;return a.SetXY(o,h),a.SetBboxChanged(),!1}PushOutSolidAxis(e,t,s,i){i=i||50;const r=e.GetWorldInfo(),n=r.GetX(),a=r.GetY();let o=null,h=null;for(let l=0;l<i;++l)for(let i=0;2>i;++i){const c=2*i-1;if(r.SetXY(n+t*l*c,a+s*l*c),r.SetBboxChanged(),!this.TestOverlap(e,o)){if(!(o=this.TestOverlapSolid(e)))return h&&this.PushInFractional(e,t*c,s*c,h,16,!0),!0;h=o}}return r.SetXY(n,a),r.SetBboxChanged(),!1}PushInFractional(e,t,s,i,r,n){let a=2,o=!1;var h=!1;const l=e.GetWorldInfo();let c=l.GetX(),u=l.GetY();for(;a<=r;)h=1/a,a*=2,l.OffsetXY(t*h*(o?1:-1),s*h*(o?1:-1)),l.SetBboxChanged(),this.TestOverlap(e,i)||n&&this.TestOverlapSolid(e)?h=o=!0:(h=o=!1,c=l.GetX(),u=l.GetY());h&&(l.SetXY(c,u),l.SetBboxChanged())}PushOutSolidNearest(e,t=100){let s=0;const i=e.GetWorldInfo(),r=i.GetX(),n=i.GetY();let a=0,o=this.TestOverlapSolid(e);if(!o)return!0;for(;s<=t;){let t=0,h=0;switch(a){case 0:t=0,h=-1,s++;break;case 1:t=1,h=-1;break;case 2:t=1,h=0;break;case 3:h=t=1;break;case 4:t=0,h=1;break;case 5:t=-1,h=1;break;case 6:t=-1,h=0;break;case 7:h=t=-1}if(a=(a+1)%8,i.SetXY(Math.floor(r+t*s),Math.floor(n+h*s)),i.SetBboxChanged(),!this.TestOverlap(e,o)&&(o=this.TestOverlapSolid(e),!o))return!0}return i.SetXY(r,n),i.SetBboxChanged(),!1}CalculateBounceAngle(e,t,s,i){const r=e.GetWorldInfo(),n=r.GetX(),a=r.GetY(),o=Math.max(10,C3$jscomp$165.distanceTo(t,s,n,a));var h=C3$jscomp$165.angleTo(t,s,n,a),l=i||this.TestOverlapSolid(e);if(!l)return C3$jscomp$165.clampAngle(h+Math.PI);let c=l;var u=0,p=0;const _=C3$jscomp$165.toRadians(5);let m;for(m=1;36>m;++m){const n=h-m*_;if(r.SetXY(t+Math.cos(n)*o,s+Math.sin(n)*o),r.SetBboxChanged(),!this.TestOverlap(e,c)&&(c=i?null:this.TestOverlapSolid(e),!c)){u=n;break}}for(36===m&&(u=C3$jscomp$165.clampAngle(h+Math.PI)),c=l,m=1;36>m;++m)if(l=h+m*_,r.SetXY(t+Math.cos(l)*o,s+Math.sin(l)*o),r.SetBboxChanged(),!this.TestOverlap(e,c)&&(c=i?null:this.TestOverlapSolid(e),!c)){p=l;break}return 36===m&&(p=C3$jscomp$165.clampAngle(h+Math.PI)),r.SetXY(n,a),r.SetBboxChanged(),p===u?p:(e=C3$jscomp$165.angleDiff(p,u)/2,e=C3$jscomp$165.angleClockwise(p,u)?C3$jscomp$165.clampAngle(u+e+Math.PI):C3$jscomp$165.clampAngle(p+e),u=Math.cos(h),h=Math.sin(h),t=u*(p=Math.cos(e))+h*(e=Math.sin(e)),C3$jscomp$165.angleTo(0,0,u-2*t*p,h-2*t*e))}TestSegmentOverlap(e,t,s,i,r){if(!r)return!1;const n=r.GetWorldInfo();return!!n.IsCollisionEnabled()&&(this._collisionCheckCount++,tempRect$jscomp$7.set(Math.min(e,s),Math.min(t,i),Math.max(e,s),Math.max(t,i)),!!n.GetBoundingBox().intersectsRect(tempRect$jscomp$7)&&(r.HasTilemap()?this._TestSegmentOverlapTilemap(e,t,s,i,r,n):(this._polyCheckCount++,!!n.GetBoundingQuad().intersectsSegment(e,t,s,i)&&(!n.HasOwnCollisionPoly()||n.GetTransformedCollisionPoly().intersectsSegment(n.GetX(),n.GetY(),e,t,s,i)))))}_TestSegmentOverlapTilemap(e,t,s,i,r,n){const a=n.GetX();n=n.GetY(),r=r.GetSdkInstance(),tempRect2$jscomp$1.set(e,t,s,i),tempRect2$jscomp$1.normalize(),r.GetCollisionRectCandidates(tempRect2$jscomp$1,tileCollRectCandidates);for(let h=0,l=tileCollRectCandidates.length;h<l;++h){var o=tileCollRectCandidates[h];if(r=o.GetRect(),this._collisionCheckCount++,tempRect$jscomp$7.intersectsRectOffset(r,a,n)&&(tempQuad$jscomp$4.setFromRect(r),tempQuad$jscomp$4.offset(a,n),tempQuad$jscomp$4.intersectsSegment(e,t,s,i))){if(!(o=o.GetPoly()))return C3$jscomp$165.clearArray(tileCollRectCandidates),!0;if(this._polyCheckCount++,o.intersectsSegment(a+r.getLeft(),n+r.getTop(),e,t,s,i))return C3$jscomp$165.clearArray(tileCollRectCandidates),!0}}return C3$jscomp$165.clearArray(tileCollRectCandidates),!1}TestRectOverlap(e,t){if(!t)return!1;const s=t.GetWorldInfo();return!!s.IsCollisionEnabled()&&(this._collisionCheckCount++,!!s.GetBoundingBox().intersectsRect(e)&&(t.HasTilemap()?this._TestRectOverlapTilemap(e,t,s):(this._polyCheckCount++,tempQuad$jscomp$4.setFromRect(e),!!s.GetBoundingQuad().intersectsQuad(tempQuad$jscomp$4)&&(!s.HasOwnCollisionPoly()||(tempPolyA.setFromRect(e,s.GetX(),s.GetY()),e=s.GetTransformedCollisionPoly(),tempPolyA.intersectsPoly(e,0,0))))))}_TestRectOverlapTilemap(e,t,s){const i=s.GetX();s=s.GetY(),t.GetSdkInstance().GetCollisionRectCandidates(e,tileCollRectCandidates);for(let n=0,a=tileCollRectCandidates.length;n<a;++n){var r=tileCollRectCandidates[n];if(t=r.GetRect(),this._collisionCheckCount++,e.intersectsRectOffset(t,i,s)){if(!(r=r.GetPoly()))return C3$jscomp$165.clearArray(tileCollRectCandidates),!0;if(this._polyCheckCount++,tempPolyA.setFromRect(e,0,0),r.intersectsPoly(tempPolyA,-(i+t.getLeft()),-(s+t.getTop())))return C3$jscomp$165.clearArray(tileCollRectCandidates),!0}}return C3$jscomp$165.clearArray(tileCollRectCandidates),!1}TestRayIntersectsInstance(e,t){if(e){var s=e.GetWorldInfo();s.IsCollisionEnabled()&&(this._collisionCheckCount++,s.GetBoundingBox().intersectsRect(t.rect)&&(e.HasTilemap()?this._TestRayIntersectsTilemap(e,s,t):(this._polyCheckCount++,s.HasOwnCollisionPoly()?t.TestInstancePoly(e,s.GetX(),s.GetY(),s.GetTransformedCollisionPoly()):t.TestInstanceQuad(e,s.GetBoundingQuad()))))}}_TestRayIntersectsTilemap(e,t,s){const i=t.GetX(),r=t.GetY();e.GetSdkInstance().GetCollisionRectCandidates(s.rect,tileCollRectCandidates);for(let a=0,o=tileCollRectCandidates.length;a<o;a++){var n=tileCollRectCandidates[a];const o=n.GetRect();this._collisionCheckCount++,s.rect.intersectsRectOffset(o,i,r)&&(n=n.GetPoly(),this._polyCheckCount++,n?s.TestInstancePoly(e,i+o.getLeft(),r+o.getTop(),n):s.TestInstanceRect(e,t.GetX(),t.GetY(),o))}C3$jscomp$165.clearArray(tileCollRectCandidates)}};const C3$jscomp$166=self.C3;C3$jscomp$166.SparseGrid=class extends C3$jscomp$166.DefendedBase{constructor(e,t){super(),this._cellWidth=e,this._cellHeight=t,this._cells=C3$jscomp$166.New(C3$jscomp$166.PairMap)}Release(){this._cells.Release(),this._cells=null}GetCell(e,t,s){let i=this._cells.Get(e,t);return i||(s?(i=C3$jscomp$166.New(C3$jscomp$166.GridCell,this,e,t),this._cells.Set(e,t,i),i):null)}XToCell(e){return e=Math.floor(e/this._cellWidth),isFinite(e)?e:0}YToCell(e){return e=Math.floor(e/this._cellHeight),isFinite(e)?e:0}Update(e,t,s){if(t)for(let i=t.getLeft(),r=t.getRight();i<=r;++i)for(let r=t.getTop(),n=t.getBottom();r<=n;++r){if(s&&s.containsPoint(i,r))continue;const t=this.GetCell(i,r,!1);t&&(t.Remove(e),t.IsEmpty()&&this._cells.Delete(i,r))}if(s)for(let i=s.getLeft(),r=s.getRight();i<=r;++i)for(let r=s.getTop(),n=s.getBottom();r<=n;++r)t&&t.containsPoint(i,r)||this.GetCell(i,r,!0).Insert(e)}QueryRange(e,t){let s=this.XToCell(e.getLeft());const i=this.YToCell(e.getTop()),r=this.XToCell(e.getRight());if(e=this.YToCell(e.getBottom()),isFinite(r)&&isFinite(e))for(;s<=r;++s)for(let r=i;r<=e;++r){const e=this.GetCell(s,r,!1);e&&e.Dump(t)}}};const C3$jscomp$167=self.C3;C3$jscomp$167.GridCell=class extends C3$jscomp$167.DefendedBase{constructor(e,t,s){super(),this._grid=e,this._x=t,this._y=s,this._instances=C3$jscomp$167.New(C3$jscomp$167.ArraySet)}Release(){this._instances.Release(),this._grid=this._instances=null}IsEmpty(){return this._instances.IsEmpty()}Insert(e){this._instances.Add(e)}Remove(e){this._instances.Delete(e)}Dump(e){C3$jscomp$167.appendArray(e,this._instances.GetArray())}};const C3$jscomp$168=self.C3;C3$jscomp$168.Ray=class{constructor(){this.dy=this.dx=this.y2=this.x2=this.y1=this.x1=0,this.rect=new C3$jscomp$168.Rect,this.hitFraction=2,this.hitUid=null,this.distance=this.hitY=this.hitX=this.hitNormalDy=this.hitNormalDx=this.hitNormal=0,this.normalX=1,this.normalY=0,this.reflectionX=1,this.reflectionY=0}DidCollide(){return 1.000001>this.hitFraction}Set(e,t,s,i){return this.x1=e,this.y1=t,this.x2=s,this.y2=i,this.dx=s-e,this.dy=i-t,this.rect.set(e,t,s,i),this.rect.normalize(),this.hitFraction=2,this.hitUid=null,this.distance=this.hitY=this.hitX=this.hitNormalDy=this.hitNormalDx=this.hitNormal=0,this.normalX=1,this.normalY=0,this.reflectionX=1,this.reflectionY=0,this}Complete(){if(!1!==this.DidCollide()){var e=this.dx*this.hitFraction,t=this.dy*this.hitFraction,s=Math.hypot(e,t);e/=s,t/=s,this.distance=s-1e-6,this.hitX=this.x1+e*this.distance,this.hitY=this.y1+t*this.distance,this.hitNormal=Math.atan2(this.hitNormalDy,this.hitNormalDx)+Math.PI/2,this.normalX=Math.cos(this.hitNormal),this.normalY=Math.sin(this.hitNormal),s=e*this.normalX+t*this.normalY,this.reflectionX=e-2*this.normalX*s,this.reflectionY=t-2*this.normalY*s,0<s&&(this.hitNormal=C3$jscomp$168.clampAngle(this.hitNormal+Math.PI),this.normalX=-this.normalX,this.normalY=-this.normalY)}}TestInstanceSegment(e,t,s,i,r){const n=C3$jscomp$168.rayIntersect(this.x1,this.y1,this.x2,this.y2,t,s,i,r);0<=n&&n<this.hitFraction&&(this.hitFraction=n,this.hitUid=e.GetUID(),this.hitNormalDx=t-i,this.hitNormalDy=s-r)}TestInstanceRect(e,t,s,i){const r=t+i.getLeft();t+=i.getRight();const n=s+i.getTop();s+=i.getBottom(),this.TestInstanceSegment(e,r,n,t,n),this.TestInstanceSegment(e,t,n,t,s),this.TestInstanceSegment(e,t,s,r,s),this.TestInstanceSegment(e,r,s,r,n)}TestInstanceQuad(e,t){const s=t.getTlx(),i=t.getTly(),r=t.getTrx(),n=t.getTry(),a=t.getBrx(),o=t.getBry(),h=t.getBlx();t=t.getBly(),this.TestInstanceSegment(e,s,i,r,n),this.TestInstanceSegment(e,r,n,a,o),this.TestInstanceSegment(e,a,o,h,t),this.TestInstanceSegment(e,h,t,s,i)}TestInstancePoly(e,t,s,i){for(let r=0,n=(i=i.pointsArr()).length;r<n;r+=2){const a=(r+2)%n;this.TestInstanceSegment(e,i[r]+t,i[r+1]+s,i[a]+t,i[a+1]+s)}}};const C3$jscomp$169=self.C3,VALID_FULLSCREEN_MODES=new Set("off crop scale-inner scale-outer letterbox-scale letterbox-integer-scale".split(" ")),VALID_FULLSCREEN_SCALING_QUALITIES=new Set(["high","low"]),glMatrix$jscomp$11=self.glMatrix,mat4$jscomp$10=glMatrix$jscomp$11.mat4,tempProjection=mat4$jscomp$10.create(),tempQuad$jscomp$5=C3$jscomp$169.New(C3$jscomp$169.Quad),tempRect$jscomp$8=C3$jscomp$169.New(C3$jscomp$169.Rect);C3$jscomp$169.CanvasManager=class extends C3$jscomp$169.DefendedBase{constructor(e){super(),this._runtime=e,this._canvas=null,this._isWebGPUEnabled=!1,this._webgpuRenderer=this._webglRenderer=null,this._gpuPreference="high-performance",this._isLimitedToWebGL1=!1,this._canvasCssOffsetY=this._canvasCssOffsetX=this._canvasDeviceHeight=this._canvasDeviceWidth=this._canvasCssHeight=this._canvasCssWidth=this._windowInnerHeight=this._windowInnerWidth=0,this._zAxisScale="normalized",this._fieldOfView=0,this._zNear=1,this._zFar=1e4,this._enableMipmaps=!0,this._drawHeight=this._drawWidth=this._textureAnisotropy=0,this._documentFullscreenMode=this._fullscreenMode="letterbox-scale",this._deviceTransformOffY=this._deviceTransformOffX=0,this._defaultProjectionMatrix=mat4$jscomp$10.create(),this._fullscreenScalingQuality=this._wantFullscreenScalingQuality="high",this._isDocumentFullscreen=!1,this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets=new Set,this._shaderData=self.C3_Shaders,this._effectChainManager=C3$jscomp$169.New(C3$jscomp$169.Gfx.EffectChainManager,{getDrawSize:()=>[this.GetDrawWidth(),this.GetDrawHeight()],getRenderTarget:()=>this.GetEffectCompositorRenderTarget(),releaseRenderTarget:e=>this.ReleaseEffectCompositorRenderTarget(e),getTime:()=>this.GetRuntime().GetGameTime(),redraw:()=>this.GetRuntime().UpdateRender()}),this._gpuTimeEndFrame=this._gpuTimeStartFrame=0,this._gpuLastUtilisation=NaN,this._gpuFrameTimingsBuffer=null,this._layersGpuProfile=new Map,this._gpuCurUtilisation=NaN,this._webgpuFrameTimings=new Map,this._snapshotFormat="",this._snapshotQuality=1,this._snapshotArea=C3$jscomp$169.New(C3$jscomp$169.Rect),this._snapshotUrl="",this._snapshotResolve=this._snapshotPromise=null,this._loaderStartTime=this._isPastingToDrawingCanvas=0,this._rafId=-1,this._loadingProgress=0,this._loadingprogress_handler=e=>this._loadingProgress=e.progress,this._percentText=null,this._splashTextures={logo:null,powered:null,website:null},this._splashFadeOutStartTime=this._splashFadeInFinishTime=this._splashFrameNumber=0,this._splashState="fade-in",this._splashDoneResolve=null,this._splashDonePromise=new Promise((e=>this._splashDoneResolve=e))}_SetGPUPowerPreference(e){this._gpuPreference=e}_SetWebGPUEnabled(e){this._isWebGPUEnabled=!!e}_SetZAxisScale(e){this._zAxisScale=e}_SetFieldOfView(e){this._fieldOfView=e}_SetZDistances(e,t){this._zNear=e,this._zFar=t}_SetLimitedToWebGL1(e){this._isLimitedToWebGL1=!!e}async CreateCanvas(e){this._canvas=e.canvas,this._runtime.AddDOMComponentMessageHandler("runtime","window-resize",(e=>this._OnWindowResize(e))),this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenchange",(e=>this._OnFullscreenChange(e))),this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenerror",(e=>this._OnFullscreenError(e))),this._canvas.addEventListener("webglcontextlost",(e=>this._OnWebGLContextLost(e))),this._canvas.addEventListener("webglcontextrestored",(e=>this._OnWebGLContextRestored(e))),this._isDocumentFullscreen=!!e.isFullscreen;var t=navigator.gpu&&this._isWebGPUEnabled;let s=!1;if(t)try{await this._InitWebGPUContext(!0)}catch(e){this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!0)}catch(e){this._webglRenderer=null}if(this.GetRenderer()||(s=!0),!this.GetRenderer()&&t)try{await this._InitWebGPUContext(!1)}catch(e){this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!1)}catch(e){this._webglRenderer=null}if(!(t=this.GetRenderer()))throw Error("failed to acquire a renderer - check WebGL or WebGPU is supported");t.SetHasMajorPerformanceCaveat(s),this._webgpuRenderer&&(this._webgpuRenderer.ondevicelost=()=>this._OnWebGPUDeviceLost(),this._webgpuRenderer.ondevicerestored=()=>this._OnWebGPUDeviceRestored()),"normalized"===this._zAxisScale?t.SetZAxisScaleNormalized():(t.SetZAxisScaleRegular(),t.SetFovY(this._fieldOfView)),this.SetSize(e.windowInnerWidth,e.windowInnerHeight,!0),await this._InitRenderer()}async _InitWebGPUContext(e){e={powerPreference:this._gpuPreference,depth:this._runtime.Uses3DFeatures(),failIfMajorPerformanceCaveat:e,usesBackgroundBlending:this._runtime.UsesAnyBackgroundBlending(),canSampleBackbuffer:this._runtime.UsesAnyCrossSampling(),canSampleDepth:this._runtime.UsesAnyDepthSampling(),nearZ:this._zNear,farZ:this._zFar},this._webgpuRenderer=C3$jscomp$169.New(C3$jscomp$169.Gfx.WebGPURenderer),await this._webgpuRenderer.Create(this._canvas,e)}async _InitWebGLContext(e){e={powerPreference:this._gpuPreference,enableGpuProfiling:!0,depth:this._runtime.Uses3DFeatures(),canSampleDepth:this._runtime.UsesAnyDepthSampling(),failIfMajorPerformanceCaveat:e,nearZ:this._zNear,farZ:this._zFar},this._isLimitedToWebGL1&&(e.maxWebGLVersion=1),"Android"===C3$jscomp$169.Platform.OS&&"Chromium"===C3$jscomp$169.Platform.BrowserEngine&&75>C3$jscomp$169.Platform.BrowserVersionNumber&&(e.maxWebGLVersion=1),"standard"===this._runtime.GetCompositingMode()?e.alpha=!0:(e.alpha=!1,e.lowLatency=!0),this._webglRenderer=C3$jscomp$169.New(C3$jscomp$169.Gfx.WebGLRenderer,this._canvas,e),await this._webglRenderer.InitState()}async _InitWebGPU(){if(this._shaderData){const e=[];for(const[t,s]of Object.entries(this._shaderData)){s.src=s.wgsl;const i=C3$jscomp$169.Gfx.WebGPUShaderProgram.GetDefaultVertexShaderSource();e.push(this._webgpuRenderer.CreateShaderProgram(s,i,t))}await Promise.all(e)}}async _InitWebGL(){if(this._shaderData){const e=[];for(const[t,s]of Object.entries(this._shaderData)){let i;if(s.glslWebGL2&&2<=this._webglRenderer.GetWebGLVersionNumber())s.src=s.glslWebGL2,i=C3$jscomp$169.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2();else{if(!s.glsl)throw Error(`shader '${t}' does not support WebGL 1`);s.src=s.glsl,i=C3$jscomp$169.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource()}e.push(this._webglRenderer.CreateShaderProgram(s,i,t))}await Promise.all(e),this._webglRenderer.ResetLastProgram(),this._webglRenderer.SetTextureFillMode()}this._webglRenderer.SupportsGPUProfiling()&&(this._gpuFrameTimingsBuffer=C3$jscomp$169.New(C3$jscomp$169.Gfx.WebGLQueryResultBuffer,this._webglRenderer))}async _InitRenderer(){this._webgpuRenderer?await this._InitWebGPU():this._webglRenderer&&await this._InitWebGL();const e=this.GetRenderer();e.SetMipmapsEnabled(this._enableMipmaps),e.SupportsGPUProfiling()&&(this._gpuLastUtilisation=0);for(const t of this._runtime._GetAllEffectLists()){for(const s of t.GetAllEffectTypes())s._InitRenderer(e);t._InitRenderer(e),t.UpdateActiveEffects()}}Release(){this._canvas=this._webglRenderer=this._runtime=null}_OnWindowResize(e){const t=this._runtime;if(!t.IsExportToVideo()){var s=e.devicePixelRatio;t.IsInWorker()&&(self.devicePixelRatio=s),t._SetDevicePixelRatio(s),this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight),t.UpdateRender(),(s=new C3$jscomp$169.Event("window-resize")).data=e,t.Dispatcher().dispatchEventAndWaitAsyncSequential(s),(e=new C3$jscomp$169.Event("resize")).cssWidth=this.GetCssWidth(),e.cssHeight=this.GetCssHeight(),e.deviceWidth=this.GetDeviceWidth(),e.deviceHeight=this.GetDeviceHeight(),t.DispatchUserScriptEvent(e),t.IsDebug()&&(t.HitBreakpoint()||self.C3Debugger.IsDebuggerPaused())&&t.Render()}}_OnFullscreenChange(e){this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight,!0),this._runtime.UpdateRender()}_OnFullscreenError(e){this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight,!0),this._runtime.UpdateRender()}SetSize(e,t,s=!1){if(e=Math.floor(e),t=Math.floor(t),0>=e||0>=t)throw Error("invalid size");if(this._windowInnerWidth!==e||this._windowInnerHeight!==t||s){for(var i of(this._windowInnerWidth=e,this._windowInnerHeight=t,"letterbox-scale"===(s=this.GetCurrentFullscreenMode())?this._CalculateLetterboxScale(e,t):"letterbox-integer-scale"===s?this._CalculateLetterboxIntegerScale(e,t):"off"===s?this._CalculateFixedSizeCanvas(e,t):this._CalculateFullsizeCanvas(e,t),this._UpdateFullscreenScalingQuality(s),this._canvas.width=this._canvasDeviceWidth,this._canvas.height=this._canvasDeviceHeight,this._runtime.PostComponentMessageToDOM("canvas","update-size",{marginLeft:this._canvasCssOffsetX,marginTop:this._canvasCssOffsetY,styleWidth:this._canvasCssWidth,styleHeight:this._canvasCssHeight,displayScale:this.GetDisplayScale()}),(e=this.GetRenderer()).SetSize(this._canvasDeviceWidth,this._canvasDeviceHeight,!0),this._availableAdditionalRenderTargets))e.DeleteRenderTarget(i);C3$jscomp$169.clearArray(this._availableAdditionalRenderTargets),e.CalculatePerspectiveMatrix(this._defaultProjectionMatrix,this.GetDrawWidth()/this.GetDrawHeight()),(i=this._runtime.GetLayoutManager()).SetAllLayerProjectionChanged(),i.SetAllLayerMVChanged()}}GetDefaultProjectionMatrix(){return this._defaultProjectionMatrix}_CalculateLetterboxScale(e,t){const s=this._runtime.GetDevicePixelRatio(),i=this._runtime.GetOriginalViewportWidth(),r=this._runtime.GetOriginalViewportHeight(),n=i/r;e/t>n?(this._canvasCssWidth=Math.round(t*n),this._canvasCssHeight=t,this._canvasCssOffsetX=Math.floor((e-this._canvasCssWidth)/2),this._canvasCssOffsetY=0):(this._canvasCssWidth=e,this._canvasCssHeight=Math.round(e/n),this._canvasCssOffsetX=0,this._canvasCssOffsetY=Math.floor((t-this._canvasCssHeight)/2)),this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this._runtime.SetViewportSize(i,r)}_CalculateLetterboxIntegerScale(e,t){const s=this._runtime.GetDevicePixelRatio();1!==s&&(e+=1,t+=1);const i=this._runtime.GetOriginalViewportWidth(),r=this._runtime.GetOriginalViewportHeight();var n=i/r;1<(n=e/t>n?t*n*s/i:e/n*s/r)?n=Math.floor(n):1>n&&(n=1/Math.ceil(1/n)),this._canvasDeviceWidth=Math.round(i*n),this._canvasDeviceHeight=Math.round(r*n),this._canvasCssWidth=this._canvasDeviceWidth/s,this._canvasCssHeight=this._canvasDeviceHeight/s,this._canvasCssOffsetX=Math.max(Math.floor((e-this._canvasCssWidth)/2),0),this._canvasCssOffsetY=Math.max(Math.floor((t-this._canvasCssHeight)/2),0),this._runtime.SetViewportSize(i,r)}_CalculateFullsizeCanvas(e,t){const s=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=e,this._canvasCssHeight=t,this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this._canvasCssOffsetY=this._canvasCssOffsetX=0,e=this.GetDisplayScale(),this._runtime.SetViewportSize(this._canvasCssWidth/e,this._canvasCssHeight/e)}_CalculateFixedSizeCanvas(e,t){const s=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=this._runtime.GetViewportWidth(),this._canvasCssHeight=this._runtime.GetViewportHeight(),this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this.IsDocumentFullscreen()?(this._canvasCssOffsetX=Math.floor((e-this._canvasCssWidth)/2),this._canvasCssOffsetY=Math.floor((t-this._canvasCssHeight)/2)):this._canvasCssOffsetY=this._canvasCssOffsetX=0,this._runtime.SetViewportSize(this._runtime.GetViewportWidth(),this._runtime.GetViewportHeight())}_UpdateFullscreenScalingQuality(e){if("high"===this._wantFullscreenScalingQuality)this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high";else{let s;if("off"===this.GetCurrentFullscreenMode()){var t=this._runtime.GetViewportWidth();s=this._runtime.GetViewportHeight()}else t=this._runtime.GetOriginalViewportWidth(),s=this._runtime.GetOriginalViewportHeight();this._canvasDeviceWidth<t||this._canvasDeviceHeight<s?(this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high"):(this._drawWidth=t,this._drawHeight=s,this._fullscreenScalingQuality="low","scale-inner"===e?(e=t/s,(t=this._windowInnerWidth/this._windowInnerHeight)<e?this._drawWidth=this._drawHeight*t:t>e&&(this._drawHeight=this._drawWidth/t)):"scale-outer"===e&&(e=t/s,(t=this._windowInnerWidth/this._windowInnerHeight)>e?this._drawWidth=this._drawHeight*t:t<e&&(this._drawHeight=this._drawWidth/t)))}}GetRuntime(){return this._runtime}GetCanvas(){return this._canvas}GetEffectChainManager(){return this._effectChainManager}IsDocumentFullscreen(){return this._isDocumentFullscreen}SetFullscreenMode(e){if(!VALID_FULLSCREEN_MODES.has(e))throw Error("invalid fullscreen mode");this._fullscreenMode=e,(e=this._runtime.GetLayoutManager()).SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged()}GetFullscreenMode(){return this._fullscreenMode}SetDocumentFullscreenMode(e){if(!VALID_FULLSCREEN_MODES.has(e))throw Error("invalid fullscreen mode");this._documentFullscreenMode=e,(e=this._runtime.GetLayoutManager()).SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged()}GetDocumentFullscreenMode(){return this._documentFullscreenMode}GetCurrentFullscreenMode(){return this.IsDocumentFullscreen()?this.GetDocumentFullscreenMode():this.GetFullscreenMode()}SetFullscreenScalingQuality(e){if(!VALID_FULLSCREEN_SCALING_QUALITIES.has(e))throw Error("invalid fullscreen scaling quality");this._wantFullscreenScalingQuality=e,this._runtime.GetLayoutManager().SetAllLayerProjectionChanged()}GetSetFullscreenScalingQuality(){return this._wantFullscreenScalingQuality}GetCurrentFullscreenScalingQuality(){return this._fullscreenScalingQuality}static _FullscreenModeNumberToString(e){switch(e){case 0:return"off";case 1:return"crop";case 2:return"scale-inner";case 3:return"scale-outer";case 4:return"letterbox-scale";case 5:return"letterbox-integer-scale";default:throw Error("invalid fullscreen mode")}}GetLastWidth(){return this._windowInnerWidth}GetLastHeight(){return this._windowInnerHeight}GetDrawWidth(){return this._drawWidth}GetDrawHeight(){return this._drawHeight}SetMipmapsEnabled(e){this._enableMipmaps=!!e}_SetTextureAnisotropy(e){this._textureAnisotropy=e}GetTextureAnisotropy(){return this._textureAnisotropy}IsRendererContextLost(){return this.GetRenderer().IsContextLost()}_OnWebGLContextLost(e){e.preventDefault(),this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets.clear(),this._effectChainManager.OnContextLost(),this._webglRenderer.OnContextLost(),this._runtime._OnRendererContextLost()}_OnWebGPUDeviceLost(){this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets.clear(),this._effectChainManager.OnContextLost(),this._runtime._OnRendererContextLost()}async _OnWebGLContextRestored(e){await this._webglRenderer.OnContextRestored(),await this._InitRenderer(),await this._runtime._OnRendererContextRestored()}async _OnWebGPUDeviceRestored(){await this._InitRenderer(),await this._runtime._OnRendererContextRestored()}GetWebGLRenderer(){return this._webglRenderer}GetWebGPURenderer(){return this._webgpuRenderer}GetRenderer(){return this._webgpuRenderer||this._webglRenderer}GetRenderScale(){return"low"===this._fullscreenScalingQuality?1/this._runtime.GetDevicePixelRatio():this.GetDisplayScale()}GetDisplayScale(){const e=this.GetCurrentFullscreenMode();if("off"===e||"crop"===e)return 1;const t=this._runtime.GetOriginalViewportWidth(),s=this._runtime.GetOriginalViewportHeight(),i=t/s,r=this._canvasDeviceWidth/this._canvasDeviceHeight;return"scale-inner"!==e&&r>i||"scale-inner"===e&&r<i?this._canvasCssHeight/s:this._canvasCssWidth/t}GetEffectLayerScaleParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this.GetDisplayScale()}GetEffectDevicePixelRatioParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this._runtime.GetDevicePixelRatio()}SetDeviceTransformOffset(e,t){this._deviceTransformOffX=e,this._deviceTransformOffY=t}SetDeviceTransform(e,t,s,i=!0){t=t||this._drawWidth,s=s||this._drawHeight;const r=t/2+this._deviceTransformOffX,n=s/2+this._deviceTransformOffY;i&&(i=this.GetDefaultProjectionMatrix(),t===this._drawWidth&&s===this._drawHeight||(e.CalculatePerspectiveMatrix(tempProjection,t/s),i=tempProjection),e.SetProjectionMatrix(i)),t=e.CalculateLookAtModelView2(r,n,e.GetDefaultCameraZ(s),r,n,0,s),e.SetModelViewMatrix(t)}SetCssTransform(e,t=!0){var s=this.GetCssWidth();const i=this.GetCssHeight();s/=2;const r=i/2;t&&e.SetProjectionMatrix(this.GetDefaultProjectionMatrix()),t=e.CalculateLookAtModelView2(s,r,e.GetDefaultCameraZ(i),s,r,0,i),e.SetModelViewMatrix(t)}GetDeviceWidth(){return this._canvasDeviceWidth}GetDeviceHeight(){return this._canvasDeviceHeight}GetCssWidth(){return this._canvasCssWidth}GetCssHeight(){return this._canvasCssHeight}GetCanvasClientX(){return this._canvasCssOffsetX}GetCanvasClientY(){return this._canvasCssOffsetY}GetAdditionalRenderTarget(e){e.depth=this._runtime.Uses3DFeatures();const t=this._availableAdditionalRenderTargets,s=t.findIndex((t=>t.IsCompatibleWithOptions(e)));let i;return-1!==s?(i=t[s],t.splice(s,1)):i=this.GetRenderer().CreateRenderTarget(e),this._usedAdditionalRenderTargets.add(i),i}ReleaseAdditionalRenderTarget(e){if(!this._usedAdditionalRenderTargets.has(e))throw Error("render target not in use");this._usedAdditionalRenderTargets.delete(e),this._availableAdditionalRenderTargets.push(e)}GetEffectCompositorRenderTarget(){const e={sampling:this._runtime.GetSampling()};return"low"===this.GetCurrentFullscreenScalingQuality()&&(e.width=this.GetDrawWidth(),e.height=this.GetDrawHeight()),this.GetAdditionalRenderTarget(e)}ReleaseEffectCompositorRenderTarget(e){this.ReleaseAdditionalRenderTarget(e)}*activeLayersGpuProfiles(){for(const e of this._runtime.GetLayoutManager().runningLayouts())for(const t of e.GetLayers()){const e=this._layersGpuProfile.get(t);e&&(yield e)}}GetLayerTimingsBuffer(e){if(!this.GetRenderer().SupportsGPUProfiling())return null;let t=this._layersGpuProfile.get(e);return t||(t={name:e.GetName(),timingsBuffer:C3$jscomp$169.New(C3$jscomp$169.Gfx.WebGLQueryResultBuffer,this._webglRenderer),curUtilisation:0,lastUtilisation:0},this._layersGpuProfile.set(e,t)),t.timingsBuffer}_Update1sFrameRange(){const e=this.GetRenderer();if(e.SupportsGPUProfiling()&&0===this._gpuTimeEndFrame){this._gpuTimeEndFrame=e.GetFrameNumber(),this._gpuCurUtilisation=NaN;for(const e of this.activeLayersGpuProfiles())e.curUtilisation=NaN}}_UpdateTick(){this._webglRenderer&&this._webglRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGL(),this._webgpuRenderer&&this._webgpuRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGPU()}_UpdateTick_WebGL(){if(isNaN(this._gpuCurUtilisation)&&(this._gpuCurUtilisation=this._gpuFrameTimingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),!isNaN(this._gpuCurUtilisation))){if(this._runtime.IsDebug())for(const e of this.activeLayersGpuProfiles())if(e.curUtilisation=e.timingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),isNaN(e.curUtilisation))return;if(this._gpuFrameTimingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),this._gpuLastUtilisation=Math.min(this._gpuCurUtilisation,1),this._runtime.IsDebug()){for(const e of this.activeLayersGpuProfiles())e.timingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),e.lastUtilisation=Math.min(e.curUtilisation,1);self.C3Debugger.UpdateGPUProfile(this._gpuLastUtilisation,[...this.activeLayersGpuProfiles()])}this._gpuTimeStartFrame=this._gpuTimeEndFrame,this._gpuTimeEndFrame=0}}GetGPUFrameTimingsBuffer(){return this._gpuFrameTimingsBuffer}_UpdateTick_WebGPU(){if(0!==this._gpuTimeEndFrame){for(var e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e){var t=this._webgpuFrameTimings.get(e);if(t&&!t.HasResult())return}t=this._runtime.GetMainRunningLayout(),e=C3$jscomp$169.MakeFilledArray(t.GetLayerCount()+1,0);for(var s=this._gpuTimeStartFrame;s<this._gpuTimeEndFrame;++s){var i=this._webgpuFrameTimings.get(s);if(i){i=i.GetResult();for(let t=0,s=Math.min(e.length,i.length/2);t<s;++t){const s=i[2*t],r=i[2*t+1];e[t]=0===Number(s)||0===Number(r)?NaN:e[t]+Number(r-s)/1e9}}}if(this._gpuLastUtilisation=C3$jscomp$169.clamp(e[0],0,1),this._runtime.IsDebug()){s=[],t=t.GetLayers();for(let i=0,r=Math.min(t.length,e.length-1);i<r;++i)s.push({name:t[i].GetName(),lastUtilisation:C3$jscomp$169.clamp(e[i+1],0,1)});self.C3Debugger.UpdateGPUProfile(this._gpuLastUtilisation,s)}for(e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e)this._webgpuFrameTimings.delete(e);this._gpuTimeStartFrame=this._gpuTimeEndFrame,this._gpuTimeEndFrame=0}}_AddWebGPUFrameTiming(e){this._webgpuFrameTimings.set(this._webgpuRenderer.GetFrameNumber(),e)}GetGPUUtilisation(){return this._gpuLastUtilisation}SnapshotCanvas(e,t,s,i,r,n){return this._snapshotFormat=e,this._snapshotQuality=t,this._snapshotArea.setWH(s,i,r,n),this._snapshotPromise?this._snapshotPromise:this._snapshotPromise=new Promise((e=>{this._snapshotResolve=e}))}_MaybeTakeSnapshot(){if(this._snapshotFormat){var e=this._canvas,t=this._snapshotArea,s=C3$jscomp$169.clamp(Math.floor(t.getLeft()),0,e.width),i=C3$jscomp$169.clamp(Math.floor(t.getTop()),0,e.height),r=t.width();r=0===r?e.width-s:C3$jscomp$169.clamp(Math.floor(r),0,e.width-s),t=0===(t=t.height())?e.height-i:C3$jscomp$169.clamp(Math.floor(t),0,e.height-i),(0!==s||0!==i||r!==e.width||t!==e.height)&&0<r&&0<t&&(e=C3$jscomp$169.CreateCanvas(r,t)).getContext("2d").drawImage(this._canvas,s,i,r,t,0,0,r,t),C3$jscomp$169.CanvasToBlob(e,this._snapshotFormat,this._snapshotQuality).then((e=>{this._snapshotUrl&&URL.revokeObjectURL(this._snapshotUrl),this._snapshotUrl=URL.createObjectURL(e),this._snapshotPromise=null,this._snapshotResolve(this._snapshotUrl)})),this._snapshotFormat="",this._snapshotQuality=1}}GetCanvasSnapshotUrl(){return this._snapshotUrl}SetIsPastingToDrawingCanvas(e){e?this._isPastingToDrawingCanvas++:this._isPastingToDrawingCanvas--}IsPastingToDrawingCanvas(){return 0<this._isPastingToDrawingCanvas}InitLoadingScreen(e){const t=this.GetRenderer();2===e?(this._percentText=C3$jscomp$169.New(C3$jscomp$169.Gfx.RendererText,this.GetRenderer()),this._percentText.SetIsAsync(!1),this._percentText.SetFontName("Arial"),this._percentText.SetFontSize(16),this._percentText.SetHorizontalAlignment("center"),this._percentText.SetVerticalAlignment("center"),this._percentText.SetSize(300,200)):0===e?(e=this._runtime.GetLoadingLogoAsset())&&e.LoadStaticTexture(t).catch((e=>{})):4===e&&(this._LoadSvgSplashImage("splash-images/splash-logo.svg").then((e=>{"done"===this._splashState?t.DeleteTexture(e):this._splashTextures.logo=e})).catch((e=>{})),this._LoadBitmapSplashImage("splash-images/splash-poweredby-512.png").then((e=>{"done"===this._splashState?t.DeleteTexture(e):this._splashTextures.powered=e})).catch((e=>{})),this._LoadBitmapSplashImage("splash-images/splash-website-512.png").then((e=>{"done"===this._splashState?t.DeleteTexture(e):this._splashTextures.website=e})).catch((e=>{})))}async _LoadSvgSplashImage(e){return e=new URL(e,this._runtime.GetRuntimeBaseURL()).toString(),e=await C3$jscomp$169.FetchBlob(e),e=await this._runtime.RasterSvgImage(e,2048,2048),await this.GetRenderer().CreateStaticTextureAsync(e,{mipMapQuality:"high"})}async _LoadBitmapSplashImage(e){return e=new URL(e,this._runtime.GetRuntimeBaseURL()).toString(),e=await C3$jscomp$169.FetchBlob(e),await this.GetRenderer().CreateStaticTextureAsync(e,{mipMapQuality:"high"})}HideCordovaSplashScreen(){this._runtime.PostComponentMessageToDOM("runtime","hide-cordova-splash")}StartLoadingScreen(){this._loaderStartTime=Date.now(),this._runtime.Dispatcher().addEventListener("loadingprogress",this._loadingprogress_handler),this._rafId=requestAnimationFrame((()=>this._DrawLoadingScreen())),3!==this._runtime.GetLoaderStyle()&&this.HideCordovaSplashScreen()}async EndLoadingScreen(){const e=this.GetRenderer();this._loadingProgress=1;const t=this._runtime.GetLoaderStyle();4===t&&await this._splashDonePromise,this._splashDonePromise=this._splashDoneResolve=null,-1!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=-1),this._runtime.Dispatcher().removeEventListener("loadingprogress",this._loadingprogress_handler),this._loadingprogress_handler=null,this._percentText&&(this._percentText.Release(),this._percentText=null),this._runtime.ReleaseLoadingLogoAsset(),e.Start(),this._splashTextures.logo&&(e.DeleteTexture(this._splashTextures.logo),this._splashTextures.logo=null),this._splashTextures.powered&&(e.DeleteTexture(this._splashTextures.powered),this._splashTextures.powered=null),this._splashTextures.website&&(e.DeleteTexture(this._splashTextures.website),this._splashTextures.website=null),e.ClearRgba(0,0,0,0),e.Finish(),this._splashState="done",this._gpuTimeStartFrame=e.GetFrameNumber(),3===t&&this.HideCordovaSplashScreen()}_DrawLoadingScreen(){if(-1!==this._rafId){var e=this.GetRenderer();e.Start(),this._rafId=-1;var t=this._runtime.GetAssetManager().HasHadErrorLoading(),s=this._runtime.GetLoaderStyle();if(3!==s&&(this.SetCssTransform(e),e.ClearRgba(0,0,0,0),e.ResetColor(),e.SetTextureFillMode(),e.SetTexture(null)),0===s)this._DrawProgressBarAndLogoLoadingScreen(t);else if(1===s)this._DrawProgressBarLoadingScreen(t,120,0);else if(2===s)this._DrawPercentTextLoadingScreen(t);else if(3===s)C3$jscomp$169.noop();else{if(4!==s)throw Error("invalid loader style");this._DrawSplashLoadingScreen(t)}e.Finish(),this._rafId=requestAnimationFrame((()=>this._DrawLoadingScreen()))}}_DrawPercentTextLoadingScreen(e){e?this._percentText.SetColorRgb(1,0,0):this._percentText.SetColorRgb(.6,.6,.6),this._percentText.SetText(Math.round(100*this._loadingProgress)+"%"),e=this._canvasCssWidth/2;const t=this._canvasCssHeight/2;tempQuad$jscomp$5.setRect(e-150,t-100,e+150,t+100),(e=this.GetRenderer()).SetTexture(this._percentText.GetTexture()),e.Quad3(tempQuad$jscomp$5,this._percentText.GetTexRect())}_DrawProgressBarLoadingScreen(e,t,s){const i=this.GetRenderer();i.SetColorFillMode(),e?i.SetColorRgba(1,0,0,1):i.SetColorRgba(.118,.565,1,1),e=this._canvasCssWidth/2;const r=this._canvasCssHeight/2,n=t/2;tempRect$jscomp$8.setWH(e-n,r-4+s,Math.floor(t*this._loadingProgress),8),i.Rect(tempRect$jscomp$8),tempRect$jscomp$8.setWH(e-n,r-4+s,t,8),tempRect$jscomp$8.offset(-.5,-.5),tempRect$jscomp$8.inflate(.5,.5),i.SetColorRgba(0,0,0,1),i.LineRect2(tempRect$jscomp$8),tempRect$jscomp$8.inflate(1,1),i.SetColorRgba(1,1,1,1),i.LineRect2(tempRect$jscomp$8)}_DrawProgressBarAndLogoLoadingScreen(e){const t=this.GetRenderer();var s=this._runtime.GetLoadingLogoAsset();if(s)if(s=s.GetTexture()){var i=s.GetWidth(),r=s.GetHeight(),n=this._canvasCssWidth/2,a=this._canvasCssHeight/2,o=i/2;r/=2,tempQuad$jscomp$5.setRect(n-o,a-r,n+o,a+r),t.SetTexture(s),t.Quad(tempQuad$jscomp$5),this._DrawProgressBarLoadingScreen(e,i,r+16)}else this._DrawProgressBarLoadingScreen(e,120,0);else this._DrawProgressBarLoadingScreen(e,120,0)}_DrawSplashLoadingScreen(e){const t=this.GetRenderer(),s=this._splashTextures.logo,i=this._splashTextures.powered,r=this._splashTextures.website,n=Date.now();0===this._splashFrameNumber&&(this._loaderStartTime=n);const a=this._runtime.IsPreview()||this._runtime.IsFBInstantAvailable()&&!this._runtime.IsCordova(),o=a?0:200,h=a?0:3e3;let l=1;"fade-in"===this._splashState?l=Math.min((n-this._loaderStartTime)/300,1):"fade-out"===this._splashState&&(l=Math.max(1-(n-this._splashFadeOutStartTime)/300,0)),t.SetColorFillMode(),t.SetColorRgba(.231*l,.251*l,.271*l,l),tempRect$jscomp$8.set(0,0,this._canvasCssWidth,this._canvasCssHeight),t.Rect(tempRect$jscomp$8);const c=Math.ceil(this._canvasCssWidth),u=Math.ceil(this._canvasCssHeight);let p;256<this._canvasCssHeight?(t.SetColorRgba(.302*l,.334*l,.365*l,l),p=Math.max(.005*u,2),tempRect$jscomp$8.setWH(0,.8*u-p/2,c,p),t.Rect(tempRect$jscomp$8),e?t.SetColorRgba(l,0,0,l):t.SetColorRgba(.161*l,.953*l,.816*l,l),e=c*this._loadingProgress,tempRect$jscomp$8.setWH(.5*c-e/2,.8*u-p/2,e,p),t.Rect(tempRect$jscomp$8),t.SetColorRgba(l,l,l,l),t.SetTextureFillMode(),i&&(p=(e=1.5*C3$jscomp$169.clamp(.22*u,105,.6*c))/8,tempRect$jscomp$8.setWH(.5*c-e/2,.2*u-p/2,e,p),t.SetTexture(i),t.Rect(tempRect$jscomp$8)),s&&(p=e=Math.min(.395*u,.95*c),tempRect$jscomp$8.setWH(.5*c-e/2,.485*u-p/2,e,p),t.SetTexture(s),t.Rect(tempRect$jscomp$8)),r&&(p=(e=1.5*C3$jscomp$169.clamp(.22*u,105,.6*c))/8,tempRect$jscomp$8.setWH(.5*c-e/2,.868*u-p/2,e,p),t.SetTexture(r),t.Rect(tempRect$jscomp$8))):(t.SetColorRgba(.302*l,.334*l,.365*l,l),p=Math.max(.005*u,2),tempRect$jscomp$8.setWH(0,.85*u-p/2,c,p),t.Rect(tempRect$jscomp$8),e?t.SetColorRgba(l,0,0,l):t.SetColorRgba(.161*l,.953*l,.816*l,l),e=c*this._loadingProgress,tempRect$jscomp$8.setWH(.5*c-e/2,.85*u-p/2,e,p),t.Rect(tempRect$jscomp$8),t.SetColorRgba(l,l,l,l),t.SetTextureFillMode(),s&&(p=e=.55*u,tempRect$jscomp$8.setWH(.5*c-e/2,.45*u-p/2,e,p),t.SetTexture(s),t.Rect(tempRect$jscomp$8))),this._splashFrameNumber++,"fade-in"===this._splashState&&300<=n-this._loaderStartTime&&2<=this._splashFrameNumber&&(this._splashState="wait",this._splashFadeInFinishTime=n),"wait"===this._splashState&&n-this._splashFadeInFinishTime>=h&&1<=this._loadingProgress&&(this._splashState="fade-out",this._splashFadeOutStartTime=n),("fade-out"===this._splashState&&n-this._splashFadeOutStartTime>=300+o||a&&1<=this._loadingProgress&&500>n-this._loaderStartTime)&&this._splashDoneResolve()}};const C3$jscomp$170=self.C3,C3Debugger$jscomp$3=self.C3Debugger,DEFAULT_RUNTIME_OPTS={messagePort:null,runtimeBaseUrl:"",headless:!1,hasDom:!0,isInWorker:!1,useAudio:!0,projectData:"",exportType:""};let ife=!0;C3$jscomp$170.Runtime=class extends C3$jscomp$170.DefendedBase{constructor(e){e=Object.assign({},DEFAULT_RUNTIME_OPTS,e),super(),this._messagePort=e.messagePort,this._runtimeBaseUrl=e.runtimeBaseUrl,this._previewUrl=e.previewUrl,this._isHeadless=!!e.headless,this._hasDom=!!e.hasDom,this._isInWorker=!!e.isInWorker,ife=e.ife,this._useAudio=!!e.useAudio,this._exportType=e.exportType,this._isiOSCordova=!!e.isiOSCordova,this._isiOSWebView=!!e.isiOSWebView,this._isFBInstantAvailable=!!e.isFBInstantAvailable,this._opusWasmScriptUrl=e.opusWasmScriptUrl,this._opusWasmBinaryUrl=e.opusWasmBinaryUrl,this._isDebugging=this._breakpointsEnabled=this._isDebug=!("preview"!==this._exportType||!e.isDebug),this._debuggingDisabled=0,this._additionalLoadPromises=[],this._additionalCreatePromises=[],this._isUsingCreatePromises=!1,this._appId=this._projectUniqueId=this._projectVersion=this._projectName="",this._originalViewportHeight=this._originalViewportWidth=0,this._devicePixelRatio=self.devicePixelRatio,this._loaderStyle=this._viewportHeight=this._viewportWidth=this._parallaxYorigin=this._parallaxXorigin=0,this._usesLoaderLayout=!1,this._isLoading=!0,this._usesAnyDepthSampling=this._usesAnyCrossSampling=this._usesAnyBackgroundBlending=!1,this._loadingLogoAsset=null,this._assetManager=C3$jscomp$170.New(C3$jscomp$170.AssetManager,this,e),this._layoutManager=C3$jscomp$170.New(C3$jscomp$170.LayoutManager,this),this._eventSheetManager=C3$jscomp$170.New(C3$jscomp$170.EventSheetManager,this),this._pluginManager=C3$jscomp$170.New(C3$jscomp$170.PluginManager,this),this._collisionEngine=C3$jscomp$170.New(C3$jscomp$170.CollisionEngine,this),this._timelineManager=C3$jscomp$170.New(C3$jscomp$170.TimelineManager,this),this._transitionManager=C3$jscomp$170.New(C3$jscomp$170.TransitionManager,this),this._templateManager=C3$jscomp$170.New(C3$jscomp$170.TemplateManager,this),this._allObjectClasses=[],this._objectClassesByName=new Map,this._objectClassesBySid=new Map,this._familyCount=0,this._allContainers=[],this._allEffectLists=[],this._currentLayoutStack=[],this._instancesPendingCreate=[],this._instancesPendingDestroy=new Map,this._isFlushingPendingInstances=this._hasPendingInstances=!1,this._nextUid=this._objectCount=0,this._instancesByUid=new Map,this._instancesToReleaseAtEndOfTick=new Set,this._instancesToReleaseAffectedObjectClasses=new Set,this._objectReferenceTable=[],this._jsPropNameTable=[],this._canvasManager=null,this._uses3dFeatures=!1,this._framerateMode="vsync",this._compositingMode="standard",this._sampling="trilinear",this._isPixelRoundingEnabled=!1,this._needRender=!0,this._isPausedOnBlur=this._pauseOnBlur=!1,this._exportToVideo=null,this._tickCallbacks={normal:e=>{this._ruafId=this._rafId=-1,this.Tick(e)},tickOnly:e=>{this._ruafId=-1,this.Tick(e,!1,"skip-render")},renderOnly:()=>{this._rafId=-1,this.Render()}},this._ruafId=this._rafId=-1,this._tickCountNoSave=this._tickCount=0,this._hasStartedTicking=this._isInTick=this._hasStarted=!1,this._isLayoutFirstTick=!0,this._suspendCount=0,this._scheduleTriggersThrottle=new C3$jscomp$170.PromiseThrottle(1),this._randomNumberCallback=()=>Math.random(),this._dt=this._dt1=this._lastTickTime=this._startTime=0,this._timeScale=1,this._minimumFramerate=30,this._gameTime=C3$jscomp$170.New(C3$jscomp$170.KahanSum),this._gameTimeRaw=C3$jscomp$170.New(C3$jscomp$170.KahanSum),this._wallTime=C3$jscomp$170.New(C3$jscomp$170.KahanSum),this._instanceTimes=new Map,this._fpsFrameCount=-1,this._mainThreadTime=this._mainThreadTimeCounter=this._fps=this._fpsLastTime=0,this._isLoadingState=!1,this._loadFromSlotName=this._saveToSlotName="",this._loadFromJson=null,this._lastSaveJson="",this._savegamesStorage=this._projectStorage=null,this._dispatcher=C3$jscomp$170.New(C3$jscomp$170.Event.Dispatcher),this._domEventHandlers=new Map,this._pendingResponsePromises=new Map,this._nextDomResponseId=0,this._isReadyToHandleEvents=this._didRequestDeviceMotionEvent=this._didRequestDeviceOrientationEvent=!1,this._waitingToHandleEvents=[],this._eventObjects={pretick:C3$jscomp$170.New(C3$jscomp$170.Event,"pretick",!1),tick:C3$jscomp$170.New(C3$jscomp$170.Event,"tick",!1),tick2:C3$jscomp$170.New(C3$jscomp$170.Event,"tick2",!1),instancedestroy:C3$jscomp$170.New(C3$jscomp$170.Event,"instancedestroy",!1),beforelayoutchange:C3$jscomp$170.New(C3$jscomp$170.Event,"beforelayoutchange",!1),layoutchange:C3$jscomp$170.New(C3$jscomp$170.Event,"layoutchange",!1)},this._eventObjects.instancedestroy.instance=null,this._userScriptDispatcher=C3$jscomp$170.New(C3$jscomp$170.Event.Dispatcher),this._userScriptEventObjects=null,this._behInstsToTick=C3$jscomp$170.New(C3$jscomp$170.RedBlackSet,C3$jscomp$170.BehaviorInstance.SortByTickSequence),this._behInstsToPostTick=C3$jscomp$170.New(C3$jscomp$170.RedBlackSet,C3$jscomp$170.BehaviorInstance.SortByTickSequence),this._behInstsToTick2=C3$jscomp$170.New(C3$jscomp$170.RedBlackSet,C3$jscomp$170.BehaviorInstance.SortByTickSequence),this._jobScheduler=C3$jscomp$170.New(C3$jscomp$170.JobSchedulerRuntime,this,e.jobScheduler),e.canvas&&(this._canvasManager=C3$jscomp$170.New(C3$jscomp$170.CanvasManager,this)),this._messagePort.onmessage=e=>this._OnMessageFromDOM(e.data),this.AddDOMComponentMessageHandler("runtime","visibilitychange",(e=>this._OnVisibilityChange(e))),this.AddDOMComponentMessageHandler("runtime","opus-decode",(e=>this._WasmDecodeWebMOpus(e.arrayBuffer))),this.AddDOMComponentMessageHandler("runtime","get-remote-preview-status-info",(()=>this._GetRemotePreviewStatusInfo())),this.AddDOMComponentMessageHandler("runtime","js-invoke-function",(e=>this._InvokeFunctionFromJS(e))),this.AddDOMComponentMessageHandler("runtime","go-to-last-error-script",self.goToLastErrorScript),this.AddDOMComponentMessageHandler("runtime","offline-audio-render-completed",(e=>this._OnOfflineAudioRenderCompleted(e))),this._dispatcher.addEventListener("window-blur",(e=>this._OnWindowBlur(e))),this._dispatcher.addEventListener("window-focus",(()=>this._OnWindowFocus())),this._timelineManager.AddRuntimeListeners(),this._templateManager.AddRuntimeListeners(),this._iRuntime=null,this._interfaceMap=new WeakMap,this._commonScriptInterfaces={keyboard:null,mouse:null,touch:null}}static Create(e){return C3$jscomp$170.New(C3$jscomp$170.Runtime,e)}Release(){C3$jscomp$170.clearArray(this._allObjectClasses),this._objectClassesByName.clear(),this._objectClassesBySid.clear(),this._layoutManager.Release(),this._layoutManager=null,this._eventSheetManager.Release(),this._eventSheetManager=null,this._pluginManager.Release(),this._pluginManager=null,this._assetManager.Release(),this._assetManager=null,this._collisionEngine.Release(),this._collisionEngine=null,this._timelineManager.Release(),this._timelineManager=null,this._transitionManager.Release(),this._transitionManager=null,this._templateManager.Release(),this._templateManager=null,this._canvasManager&&(this._canvasManager.Release(),this._canvasManager=null),this._dispatcher.Release(),this._tickEvent=this._dispatcher=null}_OnMessageFromDOM(e){const t=e.type;if("event"===t)this._OnEventFromDOM(e);else{if("result"!==t)throw Error(`unknown message '${t}'`);this._OnResultFromDOM(e)}}_OnEventFromDOM(e){if(this._isReadyToHandleEvents){var t=e.component,s=e.handler,i=e.data,r=e.dispatchOpts,n=!(!r||!r.dispatchRuntimeEvent);r=!(!r||!r.dispatchUserScriptEvent);var a=e.responseId;if("runtime"===t&&(n&&((e=new C3$jscomp$170.Event(s)).data=i,this._dispatcher.dispatchEventAndWaitAsyncSequential(e)),r)){e=new C3$jscomp$170.Event(s,!0);for(const[t,s]of Object.entries(i))e[t]=s;this.DispatchUserScriptEvent(e)}if((e=this._domEventHandlers.get(t))&&(e=e.get(s))){n=null;try{n=e(i)}catch(e){return void(null!==a&&this._PostResultToDOM(a,!1,""+e))}null!==a&&(n&&n.then?n.then((e=>this._PostResultToDOM(a,!0,e))).catch((e=>{this._PostResultToDOM(a,!1,""+e)})):this._PostResultToDOM(a,!0,n))}}else this._waitingToHandleEvents.push(e)}_PostResultToDOM(e,t,s){this._messagePort.postMessage({type:"result",responseId:e,isOk:t,result:s})}_OnResultFromDOM(e){const t=e.responseId,s=e.isOk;e=e.result;const i=this._pendingResponsePromises.get(t);s?i.resolve(e):i.reject(e),this._pendingResponsePromises.delete(t)}AddDOMComponentMessageHandler(e,t,s){let i=this._domEventHandlers.get(e);if(i||(i=new Map,this._domEventHandlers.set(e,i)),i.has(t))throw Error(`[Runtime] Component '${e}' already has handler '${t}'`);i.set(t,s)}PostComponentMessageToDOM(e,t,s,i){this._messagePort.postMessage({type:"event",component:e,handler:t,data:s,responseId:null},i)}PostComponentMessageToDOMAsync(e,t,s,i){const r=this._nextDomResponseId++,n=new Promise(((e,t)=>{this._pendingResponsePromises.set(r,{resolve:e,reject:t})}));return this._messagePort.postMessage({type:"event",component:e,handler:t,data:s,responseId:r},i),n}PostToDebugger(e){if(!this.IsDebug())throw Error("not in debug mode");this.PostComponentMessageToDOM("runtime","post-to-debugger",e)}async Init(e){this.IsDebug()?await C3Debugger$jscomp$3.Init(this):self.C3Debugger&&self.C3Debugger.InitPreview(this);var[t]=await Promise.all([this._assetManager.FetchJson("data.json"),this._MaybeLoadOpusDecoder(),this._jobScheduler.Init()]);await this._LoadDataJson(t),await this._InitialiseCanvas(e),this.IsPreview(),this.GetWebGLRenderer()?t=this.GetWebGLRenderer():this.GetWebGPURenderer(),this.GetRenderer().HasMajorPerformanceCaveat(),this._isReadyToHandleEvents=!0;for(const e of this._waitingToHandleEvents)this._OnEventFromDOM(e);C3$jscomp$170.clearArray(this._waitingToHandleEvents),this._canvasManager&&this._canvasManager.StartLoadingScreen();for(const t of e.runOnStartupFunctions)this._additionalLoadPromises.push(this._RunOnStartupFunction(t));if(await Promise.all([this._assetManager.WaitForAllToLoad(),...this._additionalLoadPromises]),C3$jscomp$170.clearArray(this._additionalLoadPromises),!this._assetManager.HasHadErrorLoading())return this._canvasManager&&await this._canvasManager.EndLoadingScreen(),await this._dispatcher.dispatchEventAndWaitAsync(new C3$jscomp$170.Event("beforeruntimestart")),await this.Start(),this._messagePort.postMessage({type:"runtime-ready"}),this;this._canvasManager&&this._canvasManager.HideCordovaSplashScreen()}async _RunOnStartupFunction(e){try{await e(this._iRuntime)}catch(e){}}async _LoadDataJson(e){e=e.project,this._projectName=e[0],this._projectVersion=e[16],this._projectUniqueId=e[31],this._appId=e[38];var t=e[39]||"loading-logo.png";this._isPixelRoundingEnabled=!!e[9],this._originalViewportWidth=this._viewportWidth=e[10],this._originalViewportHeight=this._viewportHeight=e[11],this._parallaxXorigin=this._originalViewportWidth/2,this._parallaxYorigin=this._originalViewportHeight/2,this._compositingMode=e[36],this._framerateMode=e[37],"low-latency"===this._compositingMode&&this.IsAndroidWebView()&&77>=C3$jscomp$170.Platform.BrowserVersionNumber&&(this._compositingMode="standard"),this._uses3dFeatures=!!e[40],this._sampling=e[14],this._usesAnyBackgroundBlending=e[15],this._usesAnyCrossSampling=e[42],this._usesAnyDepthSampling=e[17],this._usesLoaderLayout=!!e[18],this._loaderStyle=e[19],this._nextUid=e[21],this._pauseOnBlur=e[22];const s=this._assetManager;if(s._SetFileStructure(e[45]),s._SetAudioFiles(e[7],e[25]),s._SetMediaSubfolder(e[8]),s._SetFontsSubfolder(e[32]),s._SetIconsSubfolder(e[28]),s._SetWebFonts(e[29]),0===this._loaderStyle){let e="";this.IsPreview()?s._HasLocalUrlBlob(t)&&(e=s.GetLocalUrlAsBlobUrl(t)):e="flat"===s.GetFileStructure()?s.GetIconsSubfolder()+t:t,e&&(this._loadingLogoAsset=s.LoadImage({url:e}))}for(var i of(this._canvasManager&&(this._canvasManager.SetFullscreenMode(C3$jscomp$170.CanvasManager._FullscreenModeNumberToString(e[12])),this._canvasManager.SetFullscreenScalingQuality(e[23]?"high":"low"),this._canvasManager.SetMipmapsEnabled(0!==e[24]),this._canvasManager._SetGPUPowerPreference(e[34]),this._canvasManager._SetTextureAnisotropy(e[41]),this._canvasManager._SetWebGPUEnabled(e[13]),this._canvasManager._SetZAxisScale(e[30]),this._canvasManager._SetZDistances(e[46],e[47]),this._canvasManager._SetFieldOfView(e[26]),this._canvasManager._SetLimitedToWebGL1(e[48])),(t=e[43])&&await this._LoadExportToVideoData(t),this._pluginManager.CreateSystemPlugin(),this._objectReferenceTable=self.C3_GetObjectRefTable(),e[2]))this._pluginManager.CreatePlugin(i);for(var r of(this._objectReferenceTable=self.C3_GetObjectRefTable(),this._LoadJsPropNameTable(),e[3]))i=C3$jscomp$170.ObjectClass.Create(this,this._allObjectClasses.length,r),this._allObjectClasses.push(i),this._objectClassesByName.set(i.GetName().toLowerCase(),i),this._objectClassesBySid.set(i.GetSID(),i);for(const t of e[4])this._allObjectClasses[t[0]]._LoadFamily(t);for(var n of e[27])r=n.map((e=>this._allObjectClasses[e])),this._allContainers.push(C3$jscomp$170.New(C3$jscomp$170.Container,this,r));for(const e of this._allObjectClasses)e._OnAfterCreate();for(const t of e[5])this._layoutManager.Create(t);for(var a of((n=e[1])&&(n=this._layoutManager.GetLayoutByName(n))&&this._layoutManager.SetFirstLayout(n),e[33]))this._timelineManager.Create(a);for(const t of e[35])this._transitionManager.Create(t);for(const t of e[44])this._templateManager.Create(t);this._templateManager.HasTemplates()||(this._templateManager.Release(),this._templateManager=null),this._InitScriptInterfaces();for(const t of e[6])this._eventSheetManager.Create(t);this._eventSheetManager._PostInit(),this._InitGlobalVariableScriptInterface(),C3$jscomp$170.clearArray(this._objectReferenceTable),this.FlushPendingInstances(),a="any",1===(e=e[20])?a="portrait":2===e&&(a="landscape"),this.PostComponentMessageToDOM("runtime","set-target-orientation",{targetOrientation:a})}async _LoadExportToVideoData(e){const t=e.format;"image-sequence"===t?this._exportToVideo=new self.C3ExportToImageSequence(this,e):"image-sequence-gif"===t?this._exportToVideo=new self.C3ExportToGIF(this,e):"webm"===t?this._exportToVideo=new self.C3ExportToWebMVideo(this,e):"mp4"===t&&(this._exportToVideo=new self.C3ExportToMP4Video(this,e)),this._framerateMode="unlimited-frame",this._canvasManager.SetFullscreenMode("off"),this._devicePixelRatio=1,self.devicePixelRatio=1,await this.PostComponentMessageToDOMAsync("runtime","set-exporting-to-video",{message:this._exportToVideo.GetExportingMessageForPercent(0),duration:this._exportToVideo.GetDuration()})}GetLoaderStyle(){return this._loaderStyle}IsExportToVideo(){return null!==this._exportToVideo}GetExportVideoDuration(){return this._exportToVideo.GetDuration()}GetExportVideoFramerate(){return this._exportToVideo.GetFramerate()}_InitExportToVideo(){return this._exportToVideo.Init({width:this._canvasManager.GetDeviceWidth(),height:this._canvasManager.GetDeviceHeight()})}_ExportToVideoAddFrame(){const e=this._tickCount/this.GetExportVideoFramerate();return this._exportToVideo.AddFrame(this._canvasManager.GetCanvas(),e)}_ExportToVideoAddKeyframe(){this._exportToVideo&&this._exportToVideo.AddKeyframe()}_OnOfflineAudioRenderCompleted(e){this._exportToVideo.OnOfflineAudioRenderCompleted(e)}_ExportToVideoFinish(){return this._exportToVideo.Finish()}IsFBInstantAvailable(){return this._isFBInstantAvailable}IsLoading(){return this._isLoading}AddLoadPromise(e){this._additionalLoadPromises.push(e)}SetUsingCreatePromises(e){this._isUsingCreatePromises=!!e}AddCreatePromise(e){this._isUsingCreatePromises&&this._additionalCreatePromises.push(e)}GetCreatePromises(){return this._additionalCreatePromises}_GetNextFamilyIndex(){return this._familyCount++}GetFamilyCount(){return this._familyCount}_AddEffectList(e){this._allEffectLists.push(e)}_GetAllEffectLists(){return this._allEffectLists}async _InitialiseCanvas(e){this._canvasManager&&(await this._canvasManager.CreateCanvas(e),this._canvasManager.InitLoadingScreen(this._loaderStyle))}async _MaybeLoadOpusDecoder(){if(!this._assetManager.IsAudioFormatSupported("audio/webm; codecs=opus")){var e=null;try{e=this.IsiOSCordova()&&this._assetManager.IsFileProtocol()?await this._assetManager.CordovaFetchLocalFileAsArrayBuffer(this._opusWasmBinaryUrl):await this._assetManager.FetchArrayBuffer(this._opusWasmBinaryUrl)}catch(e){return}e?this.AddJobWorkerBuffer(e,"opus-decoder-wasm"):this.AddJobWorkerBlob(null,"opus-decoder-wasm"),await this.AddJobWorkerScripts([this._opusWasmScriptUrl])}}async _WasmDecodeWebMOpus(e){return await this.AddJob("OpusDecode",{arrayBuffer:e},[e])}async Start(){if(this._hasStarted=!0,this._startTime=Date.now(),this._usesLoaderLayout){for(var e of this._allObjectClasses)e.IsFamily()||e.IsOnLoaderLayout()||!e.IsWorldType()||e.OnCreate();this._assetManager.WaitForAllToLoad().then((()=>{this._isLoading=!1,this._OnLoadFinished()}))}else this._isLoading=!1;this._assetManager.SetInitialLoadFinished(),this.IsDebug()&&C3Debugger$jscomp$3.RuntimeInit(ife);for(const e of this._layoutManager.GetAllLayouts())e._CreateGlobalNonWorlds();this.IsExportToVideo()&&await this._InitExportToVideo(),e=this._layoutManager.GetFirstLayout(),await e._Load(null,this.GetRenderer()),await e._StartRunning(!0),this._fpsLastTime=performance.now(),this._usesLoaderLayout||this._OnLoadFinished(),(await this.PostComponentMessageToDOMAsync("runtime","before-start-ticking")).isSuspended&&!this.IsExportToVideo()?this._suspendCount++:this.Tick()}_OnLoadFinished(){this.Trigger(C3$jscomp$170.Plugins.System.Cnds.OnLoadFinished,null,null),this.PostComponentMessageToDOM("runtime","register-sw")}GetObjectReference(e){e=Math.floor(e);const t=this._objectReferenceTable;if(0>e||e>=t.length)throw Error("invalid object reference");return t[e]}_LoadJsPropNameTable(){for(const e of self.C3_JsPropNameTable){const t=C3$jscomp$170.first(Object.keys(e));this._jsPropNameTable.push(t)}}GetJsPropName(e){e=Math.floor(e);const t=this._jsPropNameTable;if(0>e||e>=t.length)throw Error("invalid prop reference");return t[e]}HasDOM(){return this._hasDom}IsHeadless(){return this._isHeadless}IsInWorker(){return this._isInWorker}GetRuntimeBaseURL(){return this._runtimeBaseUrl}GetPreviewURL(){return this._previewUrl}GetEventSheetManager(){return this._eventSheetManager}GetEventStack(){return this._eventSheetManager.GetEventStack()}GetCurrentEventStackFrame(){return this._eventSheetManager.GetCurrentEventStackFrame()}GetCurrentEvent(){return this._eventSheetManager.GetCurrentEvent()}GetCurrentCondition(){return this._eventSheetManager.GetCurrentCondition()}IsCurrentConditionFirst(){return 0===this.GetCurrentEventStackFrame().GetConditionIndex()}GetCurrentAction(){return this._eventSheetManager.GetCurrentAction()}GetPluginManager(){return this._pluginManager}GetSystemPlugin(){return this._pluginManager.GetSystemPlugin()}GetObjectClassByIndex(e){if(0>(e=Math.floor(e))||e>=this._allObjectClasses.length)throw new RangeError("invalid index");return this._allObjectClasses[e]}GetObjectClassByName(e){return this._objectClassesByName.get(e.toLowerCase())||null}GetObjectClassBySID(e){return this._objectClassesBySid.get(e)||null}GetSingleGlobalObjectClassByCtor(e){return(e=this._pluginManager.GetPluginByConstructorFunction(e))?e.GetSingleGlobalObjectClass():null}GetAllObjectClasses(){return this._allObjectClasses}*allInstances(){for(const e of this._allObjectClasses)e.IsFamily()||(yield*e.instances())}Dispatcher(){return this._dispatcher}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.runtime=this.GetIRuntime();const t=this.IsDebug()&&!this._eventSheetManager.IsInEventEngine();t&&C3Debugger$jscomp$3.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),t&&C3Debugger$jscomp$3.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){return e.runtime=this.GetIRuntime(),this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}GetOriginalViewportWidth(){return this._originalViewportWidth}GetOriginalViewportHeight(){return this._originalViewportHeight}SetOriginalViewportSize(e,t){this._originalViewportWidth===e&&this._originalViewportHeight===t||(this._originalViewportWidth=e,this._originalViewportHeight=t,(e=this.GetLayoutManager()).SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged())}GetViewportWidth(){return this._viewportWidth}GetViewportHeight(){return this._viewportHeight}SetViewportSize(e,t){this._viewportWidth===e&&this._viewportHeight===t||(this._viewportWidth=e,this._viewportHeight=t,(e=this.GetLayoutManager()).SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged())}_SetDevicePixelRatio(e){this.IsExportToVideo()||(this._devicePixelRatio=e)}GetDevicePixelRatio(){return this._devicePixelRatio}GetParallaxXOrigin(){return this._parallaxXorigin}GetParallaxYOrigin(){return this._parallaxYorigin}GetCanvasManager(){return this._canvasManager}GetDrawWidth(){return this._canvasManager?this._canvasManager.GetDrawWidth():this._viewportWidth}GetDrawHeight(){return this._canvasManager?this._canvasManager.GetDrawHeight():this._viewportHeight}GetRenderScale(){return this._canvasManager?this._canvasManager.GetRenderScale():1}GetDisplayScale(){return this._canvasManager?this._canvasManager.GetDisplayScale():1}GetEffectLayerScaleParam(){return this._canvasManager?this._canvasManager.GetEffectLayerScaleParam():1}GetEffectDevicePixelRatioParam(){return this._canvasManager?this._canvasManager.GetEffectDevicePixelRatioParam():1}GetCanvasClientX(){return this._canvasManager?this._canvasManager.GetCanvasClientX():0}GetCanvasClientY(){return this._canvasManager?this._canvasManager.GetCanvasClientY():0}GetCanvasCssWidth(){return this._canvasManager?this._canvasManager.GetCssWidth():0}GetCanvasCssHeight(){return this._canvasManager?this._canvasManager.GetCssHeight():0}GetFullscreenMode(){return this._canvasManager?this._canvasManager.GetFullscreenMode():"off"}GetAdditionalRenderTarget(e){return this._canvasManager?this._canvasManager.GetAdditionalRenderTarget(e):null}ReleaseAdditionalRenderTarget(e){this._canvasManager&&this._canvasManager.ReleaseAdditionalRenderTarget(e)}UsesAnyBackgroundBlending(){return this._usesAnyBackgroundBlending}UsesAnyCrossSampling(){return this._usesAnyCrossSampling}UsesAnyDepthSampling(){return this._usesAnyDepthSampling}GetGPUUtilisation(){return this._canvasManager?this._canvasManager.GetGPUUtilisation():NaN}IsLinearSampling(){return"nearest"!==this.GetSampling()}GetFramerateMode(){return this._framerateMode}GetCompositingMode(){return this._compositingMode}GetSampling(){return this._sampling}UsesLoaderLayout(){return this._usesLoaderLayout}GetLoadingLogoAsset(){return this._loadingLogoAsset}ReleaseLoadingLogoAsset(){this._loadingLogoAsset&&(this._loadingLogoAsset.Release(),this._loadingLogoAsset=null)}GetLayoutManager(){return this._layoutManager}GetMainRunningLayout(){return this._layoutManager.GetMainRunningLayout()}GetTimelineManager(){return this._timelineManager}GetTransitionManager(){return this._transitionManager}GetTemplateManager(){return this._templateManager}GetAssetManager(){return this._assetManager}LoadImage(e){return this._assetManager.LoadImage(e)}CreateInstance(e,t,s,i,r,n){if(n&&this._templateManager){const a=this._templateManager.GetTemplateData(e,n);if(a)return e=this.CreateInstanceFromData(a,t,!1,s,i,!1,r,void 0,r),this._templateManager.MapInstanceToTemplateName(e,n),e}return this.CreateInstanceFromData(e,t,!1,s,i,!1,r,void 0,r)}CreateInstanceFromData(e,t,s,i,r,n,a,o,h){var l=null;let c=null;if(e instanceof C3$jscomp$170.ObjectClass){if(c=e,c.IsFamily()){e=c.GetFamilyMembers();var u=Math.floor(this.Random()*e.length);c=e[u]}l=c.GetDefaultInstanceData()}else l=e,c=this.GetObjectClassByIndex(l[1]);var p=c.GetPlugin().IsWorldType();if(this._isLoading&&p&&!c.IsOnLoaderLayout())return null;const _=t;p||(t=null);var m=s&&!n&&l&&!this._instancesByUid.has(l[2])?l[2]:this._nextUid++;u=l?l[0]:null,e=C3$jscomp$170.New(C3$jscomp$170.Instance,{runtime:this,objectType:c,layer:t,worldData:u,instVarData:l?l[3]:null,uid:m}),this._instancesByUid.set(m,e),m=null,p&&(m=e.GetWorldInfo(),void 0!==i&&void 0!==r&&(m.SetX(i),m.SetY(r)),c._SetAnyCollisionCellChanged(!0)),t&&(h||t._AddInstance(e,!0),1===t.GetParallaxX()&&1===t.GetParallaxY()||c._SetAnyInstanceParallaxed(!0),t.GetLayout().MaybeLoadTexturesFor(c)),this._objectCount++;let d=!0;if(o){var g=o.GetObjectClass();g.IsInContainer()&&c.IsInContainer()&&((o=c.GetContainer())===(g=g.GetContainer())&&(d=!1))}if(c.IsInContainer()&&!s&&!n&&d){for(var f of c.GetContainer().objectTypes())f!==c&&(o=this.CreateInstanceFromData(f,_,!1,m?m.GetX():i,m?m.GetY():r,!0,!1,void 0,h),e._AddSibling(o));for(var C of e.siblings()){C._AddSibling(e);for(const t of e.siblings())C!==t&&C._AddSibling(t)}}if(p&&!s&&a&&this._CreateChildInstancesFromData(e,u,m,t,i,r,h),c.IsInContainer()&&!s&&!n&&a)for(const i of e.siblings())(s=i.GetWorldInfo())&&(f=i.GetPlugin(),C=i.GetObjectClass().GetDefaultInstanceData()[0],f.IsWorldType()?this._CreateChildInstancesFromData(i,C,s,t,s.GetX(),s.GetY(),h):this._CreateChildInstancesFromData(i,C,s,t,void 0,void 0,h));return!n&&a&&(void 0===i&&(i=u[0]),void 0===r&&(r=u[1]),t=m.GetTopParent(),i=i-m.GetX()+t.GetX(),r=r-m.GetY()+t.GetY(),t.SetXY(i,r)),c._SetIIDsStale(),r=l?C3$jscomp$170.cloneArray(l[5]):null,l=l?l[4].map((e=>C3$jscomp$170.cloneArray(e))):null,(p=p&&u&&u[13])&&e._SetHasTilemap(),e._CreateSdkInstance(r,l),p&&(u=u[13],e.GetSdkInstance().LoadTilemapData(u[2],u[0],u[1])),this._instancesPendingCreate.push(e),this._hasPendingInstances=!0,this.IsDebug()&&C3Debugger$jscomp$3.InstanceCreated(e),e}_CreateChildInstancesFromData(e,t,s,i,r,n,a){var o=s.GetSceneGraphZIndexExportData(),h=s.GetSceneGraphChildrenExportData();if(e.GetWorldInfo().SetSceneGraphZIndex(o),h){void 0===r&&(r=t[0]),void 0===n&&(n=t[1]),o=new Set,s=t[0],t=t[1];for(const m of h){var l=m[0],c=m[1],u=m[2];h=m[3];var p=!!m[4];const d=m[5];var _=m[6];c=_||this._layoutManager.GetLayoutBySID(l).GetLayer(c).GetInitialInstanceData(u),l=this.GetObjectClassByIndex(c[1]),u=e.HasSibling(l),_=o.has(l),u&&!_&&p?(p=e.GetSibling(l),u=r+c[0][0]-s,c=n+c[0][1]-t,p.GetWorldInfo().SetXY(u,c),p.GetWorldInfo().SetSceneGraphZIndex(d),e.AddChild(p,{transformX:!!(h>>0&1),transformY:!!(h>>1&1),transformWidth:!!(h>>2&1),transformHeight:!!(h>>3&1),transformAngle:!!(h>>4&1),destroyWithParent:!!(h>>5&1),transformZElevation:!!(h>>6&1)}),o.add(l)):((p=this.CreateInstanceFromData(c,i,!1,r+c[0][0]-s,n+c[0][1]-t,!1,!0,e,a)).GetWorldInfo().SetSceneGraphZIndex(d),e.AddChild(p,{transformX:!!(h>>0&1),transformY:!!(h>>1&1),transformWidth:!!(h>>2&1),transformHeight:!!(h>>3&1),transformAngle:!!(h>>4&1),destroyWithParent:!!(h>>5&1),transformZElevation:!!(h>>6&1)}))}}}DestroyInstance(e){if(!this._instancesToReleaseAtEndOfTick.has(e)){var t=e.GetObjectClass(),s=this._instancesPendingDestroy.get(t);if(s){if(s.has(e))return;s.add(e)}else(s=new Set).add(e),this._instancesPendingDestroy.set(t,s);if(this.IsDebug()&&C3Debugger$jscomp$3.InstanceDestroyed(e),e._MarkDestroyed(),this._hasPendingInstances=!0,e.IsInContainer())for(const t of e.siblings())this.DestroyInstance(t);for(const t of e.children())t.GetDestroyWithParent()&&this.DestroyInstance(t);this._layoutManager.IsEndingLayout()||this._isLoadingState||((t=this.GetEventSheetManager()).BlockFlushingInstances(!0),e._TriggerOnDestroyed(),t.BlockFlushingInstances(!1)),e._FireDestroyedScriptEvents(this._layoutManager.IsEndingLayout())}}FlushPendingInstances(){this._hasPendingInstances&&(this._isFlushingPendingInstances=!0,this._FlushInstancesPendingCreate(),this._FlushInstancesPendingDestroy(),this._hasPendingInstances=this._isFlushingPendingInstances=!1,this.UpdateRender())}_FlushInstancesPendingCreate(){for(const e of this._instancesPendingCreate){const t=e.GetObjectClass();t._AddInstance(e);for(const s of t.GetFamilies())s._AddInstance(e),s._SetIIDsStale()}C3$jscomp$170.clearArray(this._instancesPendingCreate)}_FlushInstancesPendingDestroy(){this._dispatcher.SetDelayRemoveEventsEnabled(!0);for(const[e,t]of this._instancesPendingDestroy.entries())this._FlushInstancesPendingDestroyForObjectClass(e,t),t.clear();this._instancesPendingDestroy.clear(),this._dispatcher.SetDelayRemoveEventsEnabled(!1)}_FlushInstancesPendingDestroyForObjectClass(e,t){for(const e of t){var s=this._eventObjects.instancedestroy;s.instance=e,this._dispatcher.dispatchEvent(s),this._instancesByUid.delete(e.GetUID()),this._instanceTimes.delete(e),(s=e.GetWorldInfo())&&(s._RemoveFromCollisionCells(),s._RemoveFromRenderCells(),s._MarkDestroyed()),this._instancesToReleaseAtEndOfTick.add(e),this._objectCount--}C3$jscomp$170.arrayRemoveAllInSet(e.GetInstances(),t),e._SetIIDsStale(),this._instancesToReleaseAffectedObjectClasses.add(e),0===e.GetInstances().length&&e._SetAnyInstanceParallaxed(!1);for(const s of e.GetFamilies())C3$jscomp$170.arrayRemoveAllInSet(s.GetInstances(),t),s._SetIIDsStale(),this._instancesToReleaseAffectedObjectClasses.add(s);if(e.GetPlugin().IsWorldType()){e=new Set([...t].map((e=>e.GetWorldInfo().GetLayer())));for(const s of e)s._RemoveAllInstancesInSet(t)}}_GetInstancesPendingCreate(){return this._instancesPendingCreate}*instancesPendingCreateForObjectClass(e){for(const t of this._GetInstancesPendingCreate())e.IsFamily()?t.GetObjectClass().BelongsToFamily(e)&&(yield t):t.GetObjectClass()===e&&(yield t)}_GetNewUID(){return this._nextUid++}_MapInstanceByUID(e,t){this._instancesByUid.set(e,t)}_OnRendererContextLost(){for(var e of(this._dispatcher.dispatchEvent(C3$jscomp$170.New(C3$jscomp$170.Event,"renderercontextlost")),this.SetSuspended(!0),this._allObjectClasses))!e.IsFamily()&&e.HasLoadedTextures()&&e.ReleaseTextures();(e=this.GetMainRunningLayout())&&e._OnRendererContextLost(),C3$jscomp$170.ImageInfo.OnRendererContextLost(),C3$jscomp$170.ImageAsset.OnRendererContextLost()}async _OnRendererContextRestored(){await this.GetMainRunningLayout()._Load(null,this.GetRenderer()),this._dispatcher.dispatchEvent(C3$jscomp$170.New(C3$jscomp$170.Event,"renderercontextrestored")),this.SetSuspended(!1),this.UpdateRender()}_OnVisibilityChange(e){this.SetSuspended(e.hidden)}_OnWindowBlur(e){this.IsPreview()&&this._pauseOnBlur&&!C3$jscomp$170.Platform.IsMobile&&!e.data.parentHasFocus&&(this.SetSuspended(!0),this._isPausedOnBlur=!0)}_OnWindowFocus(){this._isPausedOnBlur&&(this.SetSuspended(!1),this._isPausedOnBlur=!1)}_RequestAnimationFrame(){const e=this._tickCallbacks;"vsync"===this._framerateMode?-1===this._rafId&&(this._rafId=self.requestAnimationFrame(e.normal)):"unlimited-tick"===this._framerateMode?(-1===this._ruafId&&(this._ruafId=C3$jscomp$170.RequestUnlimitedAnimationFrame(e.tickOnly)),-1===this._rafId&&(this._rafId=self.requestAnimationFrame(e.renderOnly))):-1===this._ruafId&&(this._ruafId=C3$jscomp$170.RequestUnlimitedAnimationFrame(e.normal))}_CancelAnimationFrame(){-1!==this._rafId&&(self.cancelAnimationFrame(this._rafId),this._rafId=-1),-1!==this._ruafId&&(C3$jscomp$170.CancelUnlimitedAnimationFrame(this._ruafId),this._ruafId=-1)}IsSuspended(){return 0<this._suspendCount}SetSuspended(e){if(!this.IsExportToVideo()){var t=this.IsSuspended();this._suspendCount+=e?1:-1,0>this._suspendCount&&(this._suspendCount=0),e=this.IsSuspended(),!t&&e?(this._CancelAnimationFrame(),this._dispatcher.dispatchEvent(C3$jscomp$170.New(C3$jscomp$170.Event,"suspend")),this.Trigger(C3$jscomp$170.Plugins.System.Cnds.OnSuspend,null,null)):t&&!e&&(this._fpsLastTime=this._lastTickTime=t=performance.now(),this._mainThreadTimeCounter=this._mainThreadTime=this._fps=this._fpsFrameCount=0,this._dispatcher.dispatchEvent(C3$jscomp$170.New(C3$jscomp$170.Event,"resume")),this.Trigger(C3$jscomp$170.Plugins.System.Cnds.OnResume,null,null),this.HitBreakpoint()||this.Tick(t))}}_AddBehInstToTick(e){this._behInstsToTick.Add(e)}_AddBehInstToPostTick(e){this._behInstsToPostTick.Add(e)}_AddBehInstToTick2(e){this._behInstsToTick2.Add(e)}_RemoveBehInstToTick(e){this._behInstsToTick.Remove(e)}_RemoveBehInstToPostTick(e){this._behInstsToPostTick.Remove(e)}_RemoveBehInstToTick2(e){this._behInstsToTick2.Remove(e)}_BehaviorTick(){this._behInstsToTick.SetQueueingEnabled(!0);for(const e of this._behInstsToTick)e.Tick();this._behInstsToTick.SetQueueingEnabled(!1)}_BehaviorPostTick(){this._behInstsToPostTick.SetQueueingEnabled(!0);for(const e of this._behInstsToPostTick)e.PostTick();this._behInstsToPostTick.SetQueueingEnabled(!1)}_BehaviorTick2(){this._behInstsToTick2.SetQueueingEnabled(!0);for(const e of this._behInstsToTick2)e.Tick2();this._behInstsToTick2.SetQueueingEnabled(!1)}*_DebugBehaviorTick(){this._behInstsToTick.SetQueueingEnabled(!0);for(const e of this._behInstsToTick){const t=e.Tick();C3$jscomp$170.IsIterator(t)&&(yield*t)}this._behInstsToTick.SetQueueingEnabled(!1)}*_DebugBehaviorPostTick(){this._behInstsToPostTick.SetQueueingEnabled(!0);for(const e of this._behInstsToPostTick){const t=e.PostTick();C3$jscomp$170.IsIterator(t)&&(yield*t)}this._behInstsToPostTick.SetQueueingEnabled(!1)}*_DebugBehaviorTick2(){this._behInstsToTick2.SetQueueingEnabled(!0);for(const e of this._behInstsToTick2){const t=e.Tick2();C3$jscomp$170.IsIterator(t)&&(yield*t)}this._behInstsToTick2.SetQueueingEnabled(!1)}async Tick(e,t,s){this._hasStartedTicking=!0;const i="background-wake"===s;if(s="background-wake"!==s&&"skip-render"!==s,this._hasStarted&&(!this.IsSuspended()||t||i)){if(t=performance.now(),this._isInTick=!0,this._MeasureDt(e||0),e=this.Step_BeforePreTick(),this.IsDebugging()&&await e,(e=this._dispatcher.dispatchEventAndWait_AsyncOptional(this._eventObjects.pretick))instanceof Promise&&await e,e=this.Step_AfterPreTick(),this.IsDebugging()&&await e,this._NeedsHandleSaveOrLoad()&&await this._HandleSaveOrLoad(),this.GetLayoutManager().IsPendingChangeMainLayout()&&await this._MaybeChangeLayout(),e=this.Step_RunEventsEtc(),this.IsDebugging()&&await e,s&&this.Render(),this.IsExportToVideo()&&(await this._ExportToVideoAddFrame(),this.GetGameTime()>=this.GetExportVideoDuration()))return void this._ExportToVideoFinish();this.IsSuspended()||i||this._RequestAnimationFrame(),this._tickCount++,this._tickCountNoSave++,this._isInTick=!1,this._mainThreadTimeCounter+=performance.now()-t}}async Step_BeforePreTick(){const e=this._eventSheetManager,t=this.IsDebug();this.FlushPendingInstances(),e.BlockFlushingInstances(!0),this.PushCurrentLayout(this.GetMainRunningLayout()),t&&C3Debugger$jscomp$3.StartMeasuringTime(),this.IsDebugging()?await e.DebugRunScheduledWaits():e.RunScheduledWaits(),t&&C3Debugger$jscomp$3.AddEventsTime(),this.PopCurrentLayout(),e.BlockFlushingInstances(!1),this.FlushPendingInstances(),e.BlockFlushingInstances(!0)}async Step_AfterPreTick(){const e=this.IsDebug(),t=this.IsDebugging(),s=this._dispatcher,i=this._eventObjects,r=this._userScriptEventObjects;e&&C3Debugger$jscomp$3.StartMeasuringTime(),t?await this.DebugIterateAndBreak(this._DebugBehaviorTick()):this._BehaviorTick(),t?await this.DebugIterateAndBreak(this._DebugBehaviorPostTick()):this._BehaviorPostTick(),e&&C3Debugger$jscomp$3.AddBehaviorTickTime(),e&&C3Debugger$jscomp$3.StartMeasuringTime(),t?await this.DebugFireGeneratorEventAndBreak(i.tick):s.dispatchEvent(i.tick),e&&C3Debugger$jscomp$3.AddPluginTickTime(),this._eventSheetManager.BlockFlushingInstances(!1),this.DispatchUserScriptEvent(r.tick)}async Step_RunEventsEtc(){const e=this._eventSheetManager,t=this._dispatcher,s=this._eventObjects,i=this.IsDebug(),r=this.IsDebugging();i&&C3Debugger$jscomp$3.StartMeasuringTime(),r?await e.DebugRunEvents(this._layoutManager):e.RunEvents(this._layoutManager),i&&C3Debugger$jscomp$3.AddEventsTime(),this._collisionEngine.ClearRegisteredCollisions(),this._ReleaseInstancesAtEndOfTick(),this._isLayoutFirstTick=!1,e.BlockFlushingInstances(!0),i&&C3Debugger$jscomp$3.StartMeasuringTime(),r?await this.DebugIterateAndBreak(this._DebugBehaviorTick2()):this._BehaviorTick2(),i&&C3Debugger$jscomp$3.AddBehaviorTickTime(),i&&C3Debugger$jscomp$3.StartMeasuringTime(),r?await this.DebugFireGeneratorEventAndBreak(s.tick2):t.dispatchEvent(s.tick2),i&&C3Debugger$jscomp$3.AddPluginTickTime(),e.BlockFlushingInstances(!1),r&&await e.RunQueuedDebugTriggersAsync()}_ReleaseInstancesAtEndOfTick(){if(0!==this._instancesToReleaseAtEndOfTick.size){var e=this._dispatcher;e.SetDelayRemoveEventsEnabled(!0);for(const e of this._instancesToReleaseAffectedObjectClasses)e.GetSolStack().RemoveInstances(this._instancesToReleaseAtEndOfTick);this._instancesToReleaseAffectedObjectClasses.clear(),this._eventSheetManager.RemoveInstancesFromScheduledWaits(this._instancesToReleaseAtEndOfTick);for(const e of this._instancesToReleaseAtEndOfTick)e.Release();this._instancesToReleaseAtEndOfTick.clear(),e.SetDelayRemoveEventsEnabled(!1)}}async _MaybeChangeLayout(){const e=this.GetLayoutManager();let t=0;for(;e.IsPendingChangeMainLayout()&&10>t++;)await this._DoChangeLayout(e.GetPendingChangeMainLayout())}_MeasureDt(e){let t=0;this.IsExportToVideo()?this._dt1=t=1/this.GetExportVideoFramerate():0!==this._lastTickTime&&(t=Math.max(e-this._lastTickTime,0)/1e3,.5<t&&(t=0),this._dt1=Math.min(t,1/this._minimumFramerate)),this._lastTickTime=e,this._dt=this._dt1*this._timeScale,this._gameTime.Add(this._dt),this._gameTimeRaw.Add(t*this._timeScale),this._wallTime.Add(this._dt1);for(const[e,t]of this._instanceTimes)t.Add(this._dt1*e.GetTimeScale());this._canvasManager&&this._canvasManager._UpdateTick(),1e3<=e-this._fpsLastTime&&(this._fpsLastTime+=1e3,1e3<=e-this._fpsLastTime&&(this._fpsLastTime=e),this._fps=this._fpsFrameCount,this._fpsFrameCount=0,this._mainThreadTime=Math.min(this._mainThreadTimeCounter/1e3,1),this._mainThreadTimeCounter=0,this._canvasManager&&this._canvasManager._Update1sFrameRange(),this._collisionEngine._Update1sStats(),this.IsDebug()&&C3Debugger$jscomp$3.Update1sPerfStats()),this._fpsFrameCount++}_SetTrackingInstanceTime(e,t){t?this._instanceTimes.has(e)||((t=C3$jscomp$170.New(C3$jscomp$170.KahanSum)).Copy(this._gameTime),this._instanceTimes.set(e,t)):this._instanceTimes.delete(e)}_GetInstanceGameTime(e){return(e=this._instanceTimes.get(e))?e.Get():this.GetGameTime()}async _DoChangeLayout(e){const t=this._dispatcher,s=this.GetLayoutManager().GetMainRunningLayout();await s._StopRunning(),s._Unload(e,this.GetRenderer()),s===e&&this._eventSheetManager.ClearAllScheduledWaits(),this._collisionEngine.ClearRegisteredCollisions(),this._ReleaseInstancesAtEndOfTick(),t.dispatchEvent(this._eventObjects.beforelayoutchange),C3$jscomp$170.Asyncify.SetHighThroughputMode(!0),await e._Load(s,this.GetRenderer()),C3$jscomp$170.Asyncify.SetHighThroughputMode(!1),await e._StartRunning(!1),t.dispatchEvent(this._eventObjects.layoutchange),this.UpdateRender(),this._isLayoutFirstTick=!0,this.FlushPendingInstances(),this._ExportToVideoAddKeyframe()}UpdateRender(){this._needRender=!0}GetWebGLRenderer(){return this._canvasManager?this._canvasManager.GetWebGLRenderer():null}GetWebGPURenderer(){return this._canvasManager?this._canvasManager.GetWebGPURenderer():null}GetRenderer(){return this._canvasManager?this._canvasManager.GetRenderer():null}Render(){const e=this._canvasManager;if(e&&!e.IsRendererContextLost()){var t=this.GetRenderer(),s=t.SupportsGPUProfiling(),i=s&&t.IsWebGL();if(s=s&&t.IsWebGPU(),i&&t.CheckForQueryResults(),this._needRender||this.IsExportToVideo()){var r=this._layoutManager.GetMainRunningLayout();t.Start();var n=this.IsDebug();n&&C3Debugger$jscomp$3.StartMeasuringTime(),this._needRender=!1;var a=null;i&&(a=e.GetGPUFrameTimingsBuffer().AddTimeElapsedQuery(),t.StartQuery(a)),i=null,s&&(i=t.StartFrameTiming(2*(1+r.GetLayerCount())),t.WriteTimestamp(0)),this.Uses3DFeatures()&&"low"===e.GetCurrentFullscreenScalingQuality()?t.SetFixedSizeDepthBuffer(e.GetDrawWidth(),e.GetDrawHeight()):t.SetAutoSizeDepthBuffer(),this._Render(this.GetRenderer(),r),a&&t.EndQuery(a),s&&(t.WriteTimestamp(1),this._canvasManager._AddWebGPUFrameTiming(i)),t.Finish(),n&&(C3Debugger$jscomp$3.AddDrawCallsTime(),C3Debugger$jscomp$3.UpdateInspectHighlight()),e&&e._MaybeTakeSnapshot()}else t.IncrementFrameNumber()}}_Render(e,t){e.SetTextureFillMode(),e.SetAlphaBlend(),e.SetColorRgba(1,1,1,1),e.SetRenderTarget(null),e.SetTexture(null),e.SetDepthEnabled(this.Uses3DFeatures()),t.Draw(e)}Trigger(e,t,s){if(!this._hasStarted)return!1;var i=!this._isInTick&&!this._eventSheetManager.IsInTrigger();let r=0;i&&(r=performance.now());const n=this.IsDebug();return n&&this.SetDebuggingEnabled(!1),e=this._eventSheetManager._Trigger(this._layoutManager,e,t,s),i&&(i=performance.now()-r,this._mainThreadTimeCounter+=i,n&&C3Debugger$jscomp$3.AddTriggersTime(i)),n&&this.SetDebuggingEnabled(!0),e}DebugTrigger(e,t,s){if(!this.IsDebug())return this.Trigger(e,t,s);if(this.HitBreakpoint())throw Error("called DebugTrigger() while stopped on breakpoint");if(!this._isInTick&&!this._eventSheetManager.IsInTrigger())throw Error("called DebugTrigger() outside of event code - use TriggerAsync() instead");return this._eventSheetManager._DebugTrigger(this._layoutManager,e,t,s)}async TriggerAsync(e,t,s){if(!this.IsDebugging())return this.Trigger(e,t,s);if(!this._hasStarted)return!1;if(this.HitBreakpoint())return this._eventSheetManager.QueueDebugTrigger(e,t,s);if(!this.GetMainRunningLayout())return this._eventSheetManager.QueueTrigger(e,t,s);const i=performance.now();for(t=(e=this._eventSheetManager._DebugTrigger(this._layoutManager,e,t,s)).next();!t.done;)await this.DebugBreak(t.value),t=e.next();return this.IsSuspended()||this._eventSheetManager.IsInTrigger()||(await this._eventSheetManager.RunQueuedDebugTriggersAsync(),this._hasStartedTicking&&!this._isInTick&&this._RequestAnimationFrame()),this._mainThreadTimeCounter+=performance.now()-i,t.value}FastTrigger(e,t,s){const i=this.IsDebug();return i&&this.SetDebuggingEnabled(!1),e=this._eventSheetManager._FastTrigger(this._layoutManager,e,t,s),i&&this.SetDebuggingEnabled(!0),e}DebugFastTrigger(e,t,s){return this._eventSheetManager._DebugFastTrigger(this._layoutManager,e,t,s)}ScheduleTriggers(e){return this._scheduleTriggersThrottle.Add(e)}PushCurrentLayout(e){this._currentLayoutStack.push(e)}PopCurrentLayout(){if(!this._currentLayoutStack.length)throw Error("layout stack empty");this._currentLayoutStack.pop()}GetCurrentLayout(){return this._currentLayoutStack.length?this._currentLayoutStack.at(-1):this.GetMainRunningLayout()}GetDt(e){return e&&-1!==e.GetTimeScale()?this._dt1*e.GetTimeScale():this._dt}_GetDtFast(){return this._dt}GetDt1(){return this._dt1}GetTimeScale(){return this._timeScale}SetTimeScale(e){(isNaN(e)||0>e)&&(e=0),this._timeScale=e}SetMinimumFramerate(e){this._minimumFramerate=C3$jscomp$170.clamp(e,1,120)}GetMinimumFramerate(){return this._minimumFramerate}GetFPS(){return this._fps}GetMainThreadTime(){return this._mainThreadTime}GetStartTime(){return this._startTime}GetGameTime(){return this._gameTime.Get()}GetGameTimeRaw(){return this._gameTimeRaw.Get()}GetWallTime(){return this._wallTime.Get()}GetTickCount(){return this._tickCount}GetTickCountNoSave(){return this._tickCountNoSave}GetObjectCount(){return this._objectCount}GetProjectName(){return this._projectName}GetProjectVersion(){return this._projectVersion}GetProjectUniqueId(){return this._projectUniqueId}GetAppId(){return this._appId}GetInstanceByUID(e){if(this._isLoadingState)throw Error("cannot call while loading state - wait until afterload event");return this._instancesByUid.get(e)||null}_RefreshUidMap(){this._instancesByUid.clear();for(const e of this._allObjectClasses)if(!e.IsFamily())for(const t of e.GetInstances())this._instancesByUid.set(t.GetUID(),t)}IsPreview(){return"preview"===this._exportType}IsDebug(){return this._isDebug}GetExportType(){return this._exportType}IsCordova(){return"cordova"===this._exportType}IsAndroidWebView(){return"Android"===C3$jscomp$170.Platform.OS&&("cordova"===this._exportType||"playable-ad"===this._exportType||"instant-games"===this._exportType)}IsiOSCordova(){return this._isiOSCordova}IsiOSWebView(){return this._isiOSWebView}GetCollisionEngine(){return this._collisionEngine}GetSolidBehavior(){return this._pluginManager.GetSolidBehavior()}GetJumpthruBehavior(){return this._pluginManager.GetJumpthruBehavior()}Uses3DFeatures(){return this._uses3dFeatures}GetZScaleFactor(){return this.GetRenderer().GetZAxisScaleFactor(this.GetViewportHeight())}GetDefaultCameraZ(e){return this.GetRenderer().GetDefaultCameraZ(e||this.GetViewportHeight())}IsLayoutFirstTick(){return this._isLayoutFirstTick}SetPixelRoundingEnabled(e){e=!!e,this._isPixelRoundingEnabled!==e&&(this._isPixelRoundingEnabled=e,this.GetLayoutManager().SetAllLayerMVChanged(),this.UpdateRender())}IsPixelRoundingEnabled(){return this._isPixelRoundingEnabled}SaveToSlot(e){this._saveToSlotName=e}LoadFromSlot(e){this._loadFromSlotName=e}LoadFromJsonString(e){this._loadFromJson=e}GetLastSaveJsonString(){return this._lastSaveJson}_NeedsHandleSaveOrLoad(){return!(!this._saveToSlotName&&!this._loadFromSlotName&&null===this._loadFromJson)}async _HandleSaveOrLoad(){if(this._saveToSlotName&&(this.FlushPendingInstances(),await this._DoSaveToSlot(this._saveToSlotName),this._ClearSaveOrLoad()),this._loadFromSlotName&&(await this._DoLoadFromSlot(this._loadFromSlotName),this._ClearSaveOrLoad(),this.IsDebug()&&C3Debugger$jscomp$3.StepIfPausedInDebugger()),null!==this._loadFromJson){this.FlushPendingInstances();try{await this._DoLoadFromJsonString(this._loadFromJson),this._lastSaveJson=this._loadFromJson,await this.TriggerAsync(C3$jscomp$170.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(e){await this.TriggerAsync(C3$jscomp$170.Plugins.System.Cnds.OnLoadFailed,null)}this._ClearSaveOrLoad()}}_ClearSaveOrLoad(){this._loadFromSlotName=this._saveToSlotName="",this._loadFromJson=null}_GetProjectStorage(){return this._projectStorage||(this._projectStorage=localforage.createInstance({name:"c3-localstorage-"+this.GetProjectUniqueId(),description:this.GetProjectName()})),this._projectStorage}_GetSavegamesStorage(){return this._savegamesStorage||(this._savegamesStorage=localforage.createInstance({name:"c3-savegames-"+this.GetProjectUniqueId(),description:this.GetProjectName()})),this._savegamesStorage}async _DoSaveToSlot(e){const t=await this._SaveToJsonString();try{await this._GetSavegamesStorage().setItem(e,t),this._lastSaveJson=t,await this.TriggerAsync(C3$jscomp$170.Plugins.System.Cnds.OnSaveComplete,null),this._lastSaveJson=""}catch(e){await this.TriggerAsync(C3$jscomp$170.Plugins.System.Cnds.OnSaveFailed,null)}}async _DoLoadFromSlot(e){try{const t=await this._GetSavegamesStorage().getItem(e);if(!t)throw Error("empty slot");await this._DoLoadFromJsonString(t),this._lastSaveJson=t,await this.TriggerAsync(C3$jscomp$170.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(e){await this.TriggerAsync(C3$jscomp$170.Plugins.System.Cnds.OnLoadFailed,null)}}async _SaveToJsonString(){const e={c3save:!0,version:1,rt:{time:this.GetGameTime(),timeRaw:this.GetGameTimeRaw(),walltime:this.GetWallTime(),timescale:this.GetTimeScale(),tickcount:this.GetTickCount(),next_uid:this._nextUid,running_layout:this.GetMainRunningLayout().GetSID(),start_time_offset:Date.now()-this._startTime},types:{},layouts:{},events:this._eventSheetManager._SaveToJson(),timelines:this._timelineManager._SaveToJson(),user_script_data:null};for(var t of this._allObjectClasses)t.IsFamily()||t.HasNoSaveBehavior()||(e.types[t.GetSID().toString()]=t._SaveToJson());for(const t of this._layoutManager.GetAllLayouts())e.layouts[t.GetSID().toString()]=t._SaveToJson();return(t=this._CreateUserScriptEvent("save")).saveData=null,await this.DispatchUserScriptEventAsyncWait(t),e.user_script_data=t.saveData,JSON.stringify(e)}IsLoadingState(){return this._isLoadingState}async _DoLoadFromJsonString(e){var t=this.GetLayoutManager();if((e=JSON.parse(e)).c2save)throw Error("C2 saves are incompatible with C3 runtime");if(!e.c3save)throw Error("not valid C3 save data");if(1<e.version)throw Error("C3 save data from future version");for(var s of(this._dispatcher.dispatchEvent(C3$jscomp$170.New(C3$jscomp$170.Event,"beforeload")),this.allInstances()))s.GetObjectClass().HasNoSaveBehavior()||s._OnBeforeLoad();s=e.rt,this._gameTime.Set(s.time),s.hasOwnProperty("timeRaw")&&this._gameTimeRaw.Set(s.timeRaw),this._wallTime.Set(s.walltime),this._timeScale=s.timescale,this._tickCount=s.tickcount,this._startTime=Date.now()-s.start_time_offset;var i=s.running_layout;this._isLoadingState=!0;var r=!1;if(i!==this.GetMainRunningLayout().GetSID()){if(!(r=t.GetLayoutBySID(i)))return;await this._DoChangeLayout(r),r=!0}for(const[t,s]of Object.entries(e.types))i=parseInt(t,10),!(i=this.GetObjectClassBySID(i))||i.IsFamily()||i.HasNoSaveBehavior()||i._LoadFromJson(s);if(this.FlushPendingInstances(),this._RefreshUidMap(),this._isLoadingState=!1,r){for(var n of this.allInstances())n.SetupInitialSceneGraphConnections();for(const[t,s]of Object.entries(e.types))n=parseInt(t,10),!(n=this.GetObjectClassBySID(n))||n.IsFamily()||n.HasNoSaveBehavior()||n._SetupSceneGraphConnectionsOnChangeOfLayout(s)}this._nextUid=s.next_uid;for(const[i,r]of Object.entries(e.layouts))s=parseInt(i,10),(s=t.GetLayoutBySID(s))&&s._LoadFromJson(r);this._eventSheetManager._LoadFromJson(e.events);for(const e of this._allObjectClasses)if(!e.IsFamily()&&e.IsInContainer())for(const t of e.GetInstances()){s=t.GetIID();for(const i of e.GetContainer().objectTypes())if(i!==e){if(n=i.GetInstances(),0>s||s>=n.length)throw Error("missing sibling instance");t._AddSibling(n[s])}}for(var[a]of(this._timelineManager._LoadFromJson(e.timelines),t.SetAllLayerProjectionChanged(),t.SetAllLayerMVChanged(),this._dispatcher.dispatchEvent(C3$jscomp$170.New(C3$jscomp$170.Event,"afterload")),Object.entries(e.types)))t=parseInt(a,10),(t=this.GetObjectClassBySID(t))&&t._ClearLoadInstancesJson();(a=this._CreateUserScriptEvent("load")).saveData=e.user_script_data,await this.DispatchUserScriptEventAsyncWait(a),this.UpdateRender()}async AddJobWorkerScripts(e){e=await Promise.all(e.map((async e=>{const t=C3$jscomp$170.IsAbsoluteURL(e)&&new URL(e).origin!==location.origin,s=this.IsCordova()&&this._assetManager.IsFileProtocol();return t||s||this.IsPreview()||"playable-ad"===this.GetExportType()?(e=await this._assetManager.FetchBlob(e),URL.createObjectURL(e)):C3$jscomp$170.IsRelativeURL(e)?new URL(e,this._runtimeBaseUrl).toString():e}))),this._jobScheduler.ImportScriptsToJobWorkers(e)}AddJobWorkerBlob(e,t){this._jobScheduler.SendBlobToJobWorkers(e,t)}AddJobWorkerBuffer(e,t){this._jobScheduler.SendBufferToJobWorkers(e,t)}AddJob(e,t,s){return this._jobScheduler.AddJob(e,t,s)}BroadcastJob(e,t,s){return this._jobScheduler.BroadcastJob(e,t,s)}InvokeDownload(e,t){this.PostComponentMessageToDOM("runtime","invoke-download",{url:e,filename:t})}async RasterSvgImage(e,t,s,i,r,n){return i=i||t,r=r||s,this.IsInWorker()?(await this.PostComponentMessageToDOMAsync("runtime","raster-svg-image",{blob:e,imageWidth:t,imageHeight:s,surfaceWidth:i,surfaceHeight:r,imageBitmapOpts:n})).imageBitmap:(e=await self.C3_RasterSvgImageBlob(e,t,s,i,r),n?await self.createImageBitmap(e,n):e)}async GetSvgImageSize(e){return this.IsInWorker()?await this.PostComponentMessageToDOMAsync("runtime","get-svg-image-size",{blob:e}):await self.C3_GetSvgImageSize(e)}RequestDeviceOrientationEvent(){this._didRequestDeviceOrientationEvent||(this._didRequestDeviceOrientationEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-orientation"))}RequestDeviceMotionEvent(){this._didRequestDeviceMotionEvent||(this._didRequestDeviceMotionEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-motion"))}Random(){return this._randomNumberCallback()}SetRandomNumberGeneratorCallback(e){this._randomNumberCallback=e}_GetRemotePreviewStatusInfo(){const e=this.GetWebGLRenderer();return{fps:this.GetFPS(),cpu:this.GetMainThreadTime(),gpu:this.GetGPUUtilisation(),layout:this.GetMainRunningLayout()?this.GetMainRunningLayout().GetName():"",renderer:e?e.GetUnmaskedRenderer():"<unavailable>"}}HitBreakpoint(){return!!this.IsDebug()&&C3Debugger$jscomp$3.HitBreakpoint()}DebugBreak(e){return this.IsDebugging()?C3Debugger$jscomp$3.DebugBreak(e):Promise.resolve()}DebugBreakNext(){return!!this.IsDebugging()&&C3Debugger$jscomp$3.BreakNext()}SetDebugBreakpointsEnabled(e){this._breakpointsEnabled=!!e,this._UpdateDebuggingFlag()}AreDebugBreakpointsEnabled(){return this._breakpointsEnabled}IsDebugging(){return this._isDebugging}SetDebuggingEnabled(e){e?this._debuggingDisabled--:this._debuggingDisabled++,this._UpdateDebuggingFlag()}_UpdateDebuggingFlag(){this._isDebugging=this.IsDebug()&&this._breakpointsEnabled&&0===this._debuggingDisabled}IsCPUProfiling(){return this.IsDebug()&&C3Debugger$jscomp$3.IsCPUProfiling()}IsGPUProfiling(){return this.IsDebug()&&this.GetRenderer().SupportsGPUProfiling()&&C3Debugger$jscomp$3.IsGPUProfiling()}async DebugIterateAndBreak(e){if(e)for(const t of e)await this.DebugBreak(t)}DebugFireGeneratorEventAndBreak(e){return this.DebugIterateAndBreak(this._dispatcher.dispatchGeneratorEvent(e))}_InvokeFunctionFromJS(e){return this._eventSheetManager._InvokeFunctionFromJS(e.name,e.params)}GetIRuntime(){return this._iRuntime}_CreateUserScriptEvent(e){return(e=C3$jscomp$170.New(C3$jscomp$170.Event,e,!1)).runtime=this._iRuntime,e}_InitScriptInterfaces(){var e={};for(const t of this._allObjectClasses)e[t.GetJsPropName()]={value:t.GetIObjectClass(),enumerable:!0,writable:!1};e=Object.create(Object.prototype,e),this._iRuntime=new self.IRuntime(this,e),this._userScriptEventObjects={tick:this._CreateUserScriptEvent("tick")}}_InitGlobalVariableScriptInterface(){const e={};for(const t of this.GetEventSheetManager().GetAllGlobalVariables())e[t.GetJsPropName()]=t._GetScriptInterfaceDescriptor();this._iRuntime._InitGlobalVars(e)}_GetCommonScriptInterfaces(){return this._commonScriptInterfaces}_MapScriptInterface(e,t){this._interfaceMap.set(e,t)}_UnwrapScriptInterface(e){return this._interfaceMap.get(e)}_UnwrapIObjectClass(e){if(!(e instanceof self.IObjectClass))throw new TypeError("expected IObjectClass");if(!((e=this._UnwrapScriptInterface(e))&&e instanceof C3$jscomp$170.ObjectClass))throw Error("invalid IObjectClass");return e}_UnwrapIWorldInstance(e){if(!(e instanceof self.IWorldInstance))throw new TypeError("expected IWorldInstance");if(!((e=this._UnwrapScriptInterface(e))&&e instanceof C3$jscomp$170.Instance))throw Error("invalid IInstance");return e}},self.C3_CreateRuntime=C3$jscomp$170.Runtime.Create,self.C3_InitRuntime=(e,t)=>e.Init(t);const C3$jscomp$171=self.C3;C3$jscomp$171.JobSchedulerRuntime=class extends C3$jscomp$171.DefendedBase{constructor(e,t){super(),this._runtime=e,this._jobPromises=new Map,this._nextJobId=0,this._inputPort=t.inputPort,t.outputPort.onmessage=e=>this._OnJobWorkerMessage(e),this._maxNumWorkers=t.maxNumWorkers,this._jobWorkerCount=1,this._hadErrorCreatingWorker=this._isCreatingWorker=!1}async Init(){}ImportScriptsToJobWorkers(e){this._inputPort.postMessage({type:"_import_scripts",scripts:e})}SendBlobToJobWorkers(e,t){this._inputPort.postMessage({type:"_send_blob",blob:e,id:t})}SendBufferToJobWorkers(e,t){this._inputPort.postMessage({type:"_send_buffer",buffer:e,id:t},[e])}AddJob(e,t,s,i,r){s||(s=[]);const n=this._nextJobId++;return e={type:e,isBroadcast:!1,jobId:n,params:t,transferables:s},t=new Promise(((e,t)=>{this._jobPromises.set(n,{resolve:e,progress:i,reject:t,cancelled:!1})})),r&&r.SetAction((()=>this._CancelJob(n))),this._inputPort.postMessage(e,s),this._MaybeCreateExtraWorker(),t}BroadcastJob(e,t,s){s||(s=[]);const i=this._nextJobId++;this._inputPort.postMessage({type:e,isBroadcast:!0,jobId:i,params:t,transferables:s},s)}_CancelJob(e){const t=this._jobPromises.get(e);t&&(t.cancelled=!0,t.resolve=null,t.progress=null,t.reject=null,this._inputPort.postMessage({type:"_cancel",jobId:e}))}_OnJobWorkerMessage(e){const t=(e=e.data).type,s=e.jobId;switch(t){case"result":this._OnJobResult(s,e.result);break;case"progress":this._OnJobProgress(s,e.progress);break;case"error":this._OnJobError(s,e.error);break;case"ready":this._OnJobWorkerReady();break;default:throw Error(`unknown message from worker '${t}'`)}}_OnJobResult(e,t){const s=this._jobPromises.get(e);if(!s)throw Error("invalid job ID");s.cancelled||s.resolve(t),this._jobPromises.delete(e)}_OnJobProgress(e,t){if(!(e=this._jobPromises.get(e)))throw Error("invalid job ID");!e.cancelled&&e.progress&&e.progress(t)}_OnJobError(e,t){const s=this._jobPromises.get(e);if(!s)throw Error("invalid job ID");s.cancelled||s.reject(t),this._jobPromises.delete(e)}_OnJobWorkerReady(){this._isCreatingWorker&&(this._isCreatingWorker=!1,this._jobWorkerCount++,this._jobWorkerCount<this._maxNumWorkers?this._MaybeCreateExtraWorker():this._inputPort.postMessage({type:"_no_more_workers"}))}async _MaybeCreateExtraWorker(){if(!(this._jobWorkerCount>=this._maxNumWorkers||this._isCreatingWorker||this._hadErrorCreatingWorker||this._jobPromises.size<=this._jobWorkerCount))try{this._isCreatingWorker=!0,(await this._runtime.PostComponentMessageToDOMAsync("runtime","create-job-worker")).outputPort.onmessage=e=>this._OnJobWorkerMessage(e)}catch(e){this._hadErrorCreatingWorker=!0,this._isCreatingWorker=!1}}},self.C3_Shaders={},self.C3_Shaders.skymen_DropShadow={glsl:"uniform lowp vec3 shadowcolor;\nuniform lowp float shadowopacity;\nuniform lowp float shadowdistance;\nuniform lowp float shadowangle;\nvarying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform mediump vec2 srcStart;\nuniform mediump vec2 srcEnd;\nuniform mediump vec2 srcOriginStart;\nuniform mediump vec2 srcOriginEnd;\nuniform mediump vec2 layoutStart;\nuniform mediump vec2 layoutEnd;\nuniform lowp sampler2D samplerBack;\nuniform mediump vec2 destStart;\nuniform mediump vec2 destEnd;\nuniform mediump float seconds;\nuniform mediump vec2 pixelSize;\nuniform mediump float layerScale;\nuniform mediump float layerAngle;\n#define PI 3.14159265359\n#define  clampX(x,a,b)  min(max(x,min(a,b)),max(a,b))\nvoid main(void)\n{\nmediump float angle = (180.0 - shadowangle)/180.0 * PI;\nmediump vec2 layoutSize = abs(vec2(layoutEnd.x-layoutStart.x,(layoutEnd.y-layoutStart.y)));\nmediump vec2 texelSize = abs(srcOriginEnd-srcOriginStart)/layoutSize;\nmediump vec2 actualWidth = shadowdistance * texelSize;\nmediump vec2 testPoint = vTex + actualWidth * vec2(cos(angle), sin(angle));\ntestPoint = clampX( testPoint, srcOriginStart, srcOriginEnd );\nmediump vec4 testPointTex = texture2D(samplerFront, testPoint);\nlowp float a = testPointTex.a;\nmediump vec4 tex0 = texture2D( samplerFront, vTex );\nmediump vec4 color = vec4(shadowcolor.x, shadowcolor.y, shadowcolor.z, shadowopacity);\ngl_FragColor = mix(mix(tex0, mix(tex0, color, color.a), testPointTex.a), tex0, tex0.a);\n}",glslWebGL2:"",wgsl:"",blendsBackground:!0,usesDepth:!1,extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!1,animated:!1,parameters:[["shadowcolor",0,"color"],["shadowopacity",0,"percent"],["shadowdistance",0,"float"],["shadowangle",0,"float"]]};const C3$jscomp$172=self.C3;let cacheRegex=null,lastRegex="",lastFlags="",regexMatches=[],lastMatchesStr="",lastMatchesRegex="",lastMatchesFlags="";const forEachStack=C3$jscomp$172.New(C3$jscomp$172.ArrayStack);function ForEachOrdered_SortInstances(e,t){return e=e[1],t=t[1],"number"==typeof e&&"number"==typeof t?e-t:(e=""+e)<(t=""+t)?-1:e>t?1:0}C3$jscomp$172.Plugins.System=class extends C3$jscomp$172.SDKPluginBase{constructor(e){super(e),this._loopStack=this._runtime.GetEventSheetManager().GetLoopStack(),this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._imagesLoadingComplete=this._imagesLoadingTotal=0,this._functionMaps=new Map}Release(){super.Release()}UpdateRender(){this._runtime.UpdateRender()}Trigger(e){this._runtime.Trigger(e,null,null)}GetRegex(e,t){return cacheRegex&&e===lastRegex&&t===lastFlags||(cacheRegex=new RegExp(e,t),lastRegex=e,lastFlags=t),cacheRegex.lastIndex=0,cacheRegex}GetRegexMatches(e,t,s){if(e===lastMatchesStr&&t===lastMatchesRegex&&s===lastMatchesFlags)return regexMatches;const i=this.GetRegex(t,s);return regexMatches=e.match(i),lastMatchesStr=e,lastMatchesRegex=t,lastMatchesFlags=s,regexMatches}async _LoadTexturesForObjectClasses(e,t){if(t.length){this._imagesLoadingTotal+=t.length;var s=[];for(const i of t)s.push(e.MaybeLoadTexturesFor(i));await C3$jscomp$172.PromiseAllWithProgress(s,(()=>{this._imagesLoadingComplete++})),this._imagesLoadingComplete++,this._imagesLoadingComplete===this._imagesLoadingTotal&&(this._imagesLoadingTotal=this._imagesLoadingComplete=0,this._runtime.Trigger(C3$jscomp$172.Plugins.System.Cnds.OnImageLoadingComplete,null,null))}}_UnloadTexturesForObjectClasses(e,t){for(const s of t)0===s.GetInstanceCount()&&e.MaybeUnloadTexturesFor(s)}_GetForEachStack(){return forEachStack}_Repeat(e){var t=this._runtime.GetEventSheetManager();const s=t.GetEventStack(),i=s.GetCurrentStackFrame(),r=i.GetCurrentEvent(),n=r.GetSolModifiers();var a=i.IsSolModifierAfterCnds();const o=s.Push(r),h=t.GetLoopStack(),l=h.Push();if(l.SetEnd(e),a)for(a=0;a<e&&!l.IsStopped();++a)t.PushCopySol(n),l.SetIndex(a),r.Retrigger(i,o),t.PopSol(n);else for(t=0;t<e&&!l.IsStopped();++t)l.SetIndex(t),r.Retrigger(i,o);return s.Pop(),h.Pop(),!1}*_DebugRepeat(e){var t=this._runtime.GetEventSheetManager();const s=t.GetEventStack(),i=s.GetCurrentStackFrame(),r=i.GetCurrentEvent(),n=r.GetSolModifiers();var a=i.IsSolModifierAfterCnds();const o=s.Push(r),h=t.GetLoopStack(),l=h.Push();if(l.SetEnd(e),a)for(a=0;a<e&&!l.IsStopped();++a)t.PushCopySol(n),l.SetIndex(a),yield*r.DebugRetrigger(i,o),t.PopSol(n);else for(t=0;t<e&&!l.IsStopped();++t)l.SetIndex(t),yield*r.DebugRetrigger(i,o);return s.Pop(),h.Pop(),!1}_While(){var e=this._runtime.GetEventSheetManager();const t=e.GetEventStack(),s=t.GetCurrentStackFrame(),i=s.GetCurrentEvent(),r=i.GetSolModifiers();var n=s.IsSolModifierAfterCnds();const a=t.Push(i),o=e.GetLoopStack(),h=o.Push();if(n)for(n=0;!h.IsStopped();++n)e.PushCopySol(r),h.SetIndex(n),i.Retrigger(s,a)||h.Stop(),e.PopSol(r);else for(e=0;!h.IsStopped();++e)h.SetIndex(e),i.Retrigger(s,a)||h.Stop();return t.Pop(),o.Pop(),!1}*_DebugWhile(){var e=this._runtime.GetEventSheetManager();const t=e.GetEventStack(),s=t.GetCurrentStackFrame(),i=s.GetCurrentEvent(),r=i.GetSolModifiers();var n=s.IsSolModifierAfterCnds();const a=t.Push(i),o=e.GetLoopStack(),h=o.Push();if(n)for(n=0;!h.IsStopped();++n)e.PushCopySol(r),h.SetIndex(n),(yield*i.DebugRetrigger(s,a))||h.Stop(),e.PopSol(r);else for(e=0;!h.IsStopped();++e)h.SetIndex(e),(yield*i.DebugRetrigger(s,a))||h.Stop();return t.Pop(),o.Pop(),!1}_For(e,t,s){var i=this._runtime.GetEventSheetManager();const r=i.GetEventStack(),n=r.GetCurrentStackFrame(),a=n.GetCurrentEvent(),o=a.GetSolModifiers(),h=n.IsSolModifierAfterCnds(),l=r.Push(a),c=i.GetLoopStack(),u=c.Push();if(u.SetName(e),u.SetEnd(s),s<t)if(h)for(e=t;e>=s&&!u.IsStopped();--e)i.PushCopySol(o),u.SetIndex(e),a.Retrigger(n,l),i.PopSol(o);else for(i=t;i>=s&&!u.IsStopped();--i)u.SetIndex(i),a.Retrigger(n,l);else if(h)for(e=t;e<=s&&!u.IsStopped();++e)i.PushCopySol(o),u.SetIndex(e),a.Retrigger(n,l),i.PopSol(o);else for(i=t;i<=s&&!u.IsStopped();++i)u.SetIndex(i),a.Retrigger(n,l);return r.Pop(),c.Pop(),!1}*_DebugFor(e,t,s){var i=this._runtime.GetEventSheetManager();const r=i.GetEventStack(),n=r.GetCurrentStackFrame(),a=n.GetCurrentEvent(),o=a.GetSolModifiers(),h=n.IsSolModifierAfterCnds(),l=r.Push(a),c=i.GetLoopStack(),u=c.Push();if(u.SetName(e),u.SetEnd(s),s<t)if(h)for(e=t;e>=s&&!u.IsStopped();--e)i.PushCopySol(o),u.SetIndex(e),yield*a.DebugRetrigger(n,l),i.PopSol(o);else for(i=t;i>=s&&!u.IsStopped();--i)u.SetIndex(i),yield*a.DebugRetrigger(n,l);else if(h)for(e=t;e<=s&&!u.IsStopped();++e)i.PushCopySol(o),u.SetIndex(e),yield*a.DebugRetrigger(n,l),i.PopSol(o);else for(i=t;i<=s&&!u.IsStopped();++i)u.SetIndex(i),yield*a.DebugRetrigger(n,l);return r.Pop(),c.Pop(),!1}_ForEach(e){var t=this._runtime.GetEventSheetManager();const s=t.GetEventStack(),i=s.GetCurrentStackFrame(),r=i.GetCurrentEvent(),n=r.GetSolModifiers();var a=i.IsSolModifierAfterCnds();const o=s.Push(r),h=t.GetLoopStack(),l=h.Push(),c=e.IsInContainer(),u=e.GetCurrentSol(),p=forEachStack.Push();if(C3$jscomp$172.shallowAssignArray(p,u.GetInstances()),l.SetEnd(p.length),a)for(let s=0,h=p.length;s<h&&!l.IsStopped();++s)t.PushCopySol(n),a=p[s],e.GetCurrentSol().SetSinglePicked(a),c&&a.SetSiblingsSinglePicked(),l.SetIndex(s),r.Retrigger(i,o),t.PopSol(n);else{u._SetSelectAll(!1),e=u._GetOwnInstances(),C3$jscomp$172.clearArray(e),e.push(null);for(let s=0,n=p.length;s<n&&!l.IsStopped();++s)t=p[s],e[0]=t,c&&t.SetSiblingsSinglePicked(),l.SetIndex(s),r.Retrigger(i,o)}return s.Pop(),h.Pop(),C3$jscomp$172.clearArray(p),forEachStack.Pop(),!1}*_DebugForEach(e){var t=this._runtime.GetEventSheetManager();const s=t.GetEventStack(),i=s.GetCurrentStackFrame(),r=i.GetCurrentEvent(),n=r.GetSolModifiers();var a=i.IsSolModifierAfterCnds();const o=s.Push(r),h=t.GetLoopStack(),l=h.Push(),c=e.IsInContainer(),u=e.GetCurrentSol(),p=forEachStack.Push();if(C3$jscomp$172.shallowAssignArray(p,u.GetInstances()),l.SetEnd(p.length),a)for(let s=0,h=p.length;s<h&&!l.IsStopped();++s)t.PushCopySol(n),a=p[s],e.GetCurrentSol().SetSinglePicked(a),c&&a.SetSiblingsSinglePicked(),l.SetIndex(s),yield*r.DebugRetrigger(i,o),t.PopSol(n);else{u._SetSelectAll(!1),e=u._GetOwnInstances(),C3$jscomp$172.clearArray(e),e.push(null);for(let s=0,n=p.length;s<n&&!l.IsStopped();++s)t=p[s],e[0]=t,c&&t.SetSiblingsSinglePicked(),l.SetIndex(s),yield*r.DebugRetrigger(i,o)}return s.Pop(),h.Pop(),C3$jscomp$172.clearArray(p),forEachStack.Pop(),!1}_ForEachOrdered(e,t){var s=this._runtime.GetEventSheetManager();const i=s.GetEventStack(),r=s.GetCurrentCondition(),n=i.GetCurrentStackFrame(),a=n.GetCurrentEvent(),o=a.GetSolModifiers(),h=n.IsSolModifierAfterCnds(),l=i.Push(a),c=s.GetLoopStack(),u=c.Push(),p=e.IsInContainer(),_=e.GetCurrentSol(),m=forEachStack.Push();C3$jscomp$172.clearArray(m);const d=_.GetInstances();u.SetEnd(d.length);for(let e=0,t=d.length;e<t;++e)m.push([d[e],r.ReevaluateParameter(1,e)]);if(m.sort(ForEachOrdered_SortInstances),1===t&&m.reverse(),h)for(let i=0,r=m.length;i<r&&!u.IsStopped();++i)s.PushCopySol(o),t=m[i][0],e.GetCurrentSol().SetSinglePicked(t),p&&t.SetSiblingsSinglePicked(),u.SetIndex(i),a.Retrigger(n,l),s.PopSol(o);else{_._SetSelectAll(!1),e=_._GetOwnInstances(),C3$jscomp$172.clearArray(e),e.push(null);for(let t=0,i=m.length;t<i&&!u.IsStopped();++t)s=m[t][0],e[0]=s,p&&s.SetSiblingsSinglePicked(),u.SetIndex(t),a.Retrigger(n,l)}return i.Pop(),c.Pop(),C3$jscomp$172.clearArray(m),forEachStack.Pop(),!1}*_DebugForEachOrdered(e,t){var s=this._runtime.GetEventSheetManager();const i=s.GetEventStack(),r=s.GetCurrentCondition(),n=i.GetCurrentStackFrame(),a=n.GetCurrentEvent(),o=a.GetSolModifiers(),h=n.IsSolModifierAfterCnds(),l=i.Push(a),c=s.GetLoopStack(),u=c.Push(),p=e.IsInContainer(),_=e.GetCurrentSol(),m=forEachStack.Push();C3$jscomp$172.clearArray(m);const d=_.GetInstances();u.SetEnd(d.length);for(let e=0,t=d.length;e<t;++e)m.push([d[e],r.ReevaluateParameter(1,e)]);if(m.sort(ForEachOrdered_SortInstances),1===t&&m.reverse(),h)for(let i=0,r=m.length;i<r&&!u.IsStopped();++i)s.PushCopySol(o),t=m[i][0],e.GetCurrentSol().SetSinglePicked(t),p&&t.SetSiblingsSinglePicked(),u.SetIndex(i),yield*a.DebugRetrigger(n,l),s.PopSol(o);else{_._SetSelectAll(!1),e=_._GetOwnInstances(),C3$jscomp$172.clearArray(e),e.push(null);for(let t=0,i=m.length;t<i&&!u.IsStopped();++t)s=m[t][0],e[0]=s,p&&s.SetSiblingsSinglePicked(),u.SetIndex(t),yield*a.DebugRetrigger(n,l)}return i.Pop(),c.Pop(),C3$jscomp$172.clearArray(m),forEachStack.Pop(),!1}_GetFunctionMap(e,t){let s=this._functionMaps.get(e);return s||(t?(s={defaultFunc:null,strMap:new Map},this._functionMaps.set(e,s),s):null)}_DoCallMappedFunction(e,t,s,i,r){t.GetEventBlock().RunAsMappedFunctionCall(s,t.IsCopyPicked()),i&&e.PopSol(r)}*_DebugDoCallMappedFunction(e,t,s,i,r){yield*t.GetEventBlock().DebugRunAsMappedFunctionCall(s,t.IsCopyPicked()),i&&e.PopSol(r)}};const C3$jscomp$173=self.C3;C3$jscomp$173.Plugins.System.Type=class extends C3$jscomp$173.DefendedBase{constructor(e){super(),this._objectClass=e,this._runtime=e.GetRuntime(),this._plugin=e.GetPlugin()}OnCreate(){}Release(){this._plugin=this._runtime=this._objectClass=null}};const C3$jscomp$174=self.C3;C3$jscomp$174.Plugins.System.Instance=class extends C3$jscomp$174.DefendedBase{constructor(e,t){super(),this._inst=e,this._objectClass=this._inst.GetObjectClass(),this._sdkType=this._objectClass.GetSdkType(),this._runtime=this._inst.GetRuntime()}Release(){this._runtime=this._sdkType=this._objectClass=this._inst=null}};const C3$jscomp$175=self.C3,tmpPickArray=[];C3$jscomp$175.Plugins.System.Cnds={EveryTick:()=>!0,OnLayoutStart:()=>!0,OnLayoutEnd:()=>!0,OnSuspend:()=>!0,OnResume:()=>!0,IsSuspended(){return this._runtime.IsSuspended()},Else(){const e=this._runtime.GetCurrentEventStackFrame();return!e.GetElseBranchRan()&&!e.GetLastEventTrue()},TriggerOnce(){const e=this._runtime.GetCurrentCondition().GetSavedDataMap();let t=e.get("TriggerOnce_lastTick");void 0===t&&(t=-1,e.set("TriggerOnce_lastTick",-1));const s=this._runtime.GetTickCount();return e.set("TriggerOnce_lastTick",s),this._runtime.IsLayoutFirstTick()||t!==s-1},Every(e){const t=this._runtime.GetCurrentCondition().GetSavedDataMap(),s=t.get("Every_lastTime")||0,i=this._runtime.GetGameTime();t.has("Every_seconds")||t.set("Every_seconds",e);const r=t.get("Every_seconds");return i>=s+r?(t.set("Every_lastTime",s+r),i>=t.get("Every_lastTime")+.04&&t.set("Every_lastTime",i),t.set("Every_seconds",e),!0):(i<s-.1&&t.set("Every_lastTime",i),!1)},IsGroupActive(e){return(e=this._runtime.GetEventSheetManager().GetEventGroupByName(e))&&e.IsGroupActive()},IsPreview(){return this._runtime.IsPreview()},IsMobile:()=>C3$jscomp$175.Platform.IsMobile,OnLoadFinished:()=>!0,OnCanvasSnapshot:()=>!0,EffectsSupported:()=>!0,OnSaveComplete:()=>!0,OnSaveFailed:()=>!0,OnLoadComplete:()=>!0,OnLoadFailed:()=>!0,ObjectUIDExists(e){return!!this._runtime.GetInstanceByUID(e)},IsOnPlatform(e){switch(e){case 0:return"browser"===C3$jscomp$175.Platform.Context;case 1:return"iOS"===C3$jscomp$175.Platform.OS;case 2:return"Android"===C3$jscomp$175.Platform.OS;case 8:return"cordova"===C3$jscomp$175.Platform.Context;case 9:return"scirra-arcade"===this._runtime.GetExportType();case 10:return"nwjs"===C3$jscomp$175.Platform.Context;case 13:return"windows-uwp"===this._runtime.GetExportType();default:return!1}},RegexTest(e,t,s){return this.GetRegex(t,s).test(e)},Compare:(e,t,s)=>C3$jscomp$175.compare(e,t,s),CompareBetween:(e,t,s)=>e>=t&&e<=s,CompareVar:(e,t,s)=>C3$jscomp$175.compare(e.GetValue(),t,s),CompareBoolVar:e=>!!e.GetValue(),CompareTime(e,t){const s=this._runtime.GetGameTime();return 0===e?!(e=this._runtime.GetCurrentCondition().GetSavedDataMap()).get("CompareTime_executed")&&s>=t&&(e.set("CompareTime_executed",!0),!0):C3$jscomp$175.compare(s,e,t)},IsNaN:e=>isNaN(e),AngleWithin:(e,t,s)=>C3$jscomp$175.angleDiff(C3$jscomp$175.toRadians(e),C3$jscomp$175.toRadians(s))<=C3$jscomp$175.toRadians(t),IsClockwiseFrom:(e,t)=>C3$jscomp$175.angleClockwise(C3$jscomp$175.toRadians(e),C3$jscomp$175.toRadians(t)),IsBetweenAngles:(e,t,s)=>(e=C3$jscomp$175.toRadians(e),t=C3$jscomp$175.toRadians(t),s=C3$jscomp$175.toRadians(s),C3$jscomp$175.angleClockwise(s,t)?C3$jscomp$175.angleClockwise(e,t)&&!C3$jscomp$175.angleClockwise(e,s):!(!C3$jscomp$175.angleClockwise(e,t)&&C3$jscomp$175.angleClockwise(e,s))),IsValueType:(e,t)=>"number"==typeof e?0===t:1===t,EvaluateExpression:e=>!!e,PickByComparison(e,t,s,i){if(!e)return!1;const r=this._GetForEachStack(),n=r.Push(),a=e.GetCurrentSol();C3$jscomp$175.shallowAssignArray(n,a.GetInstances()),a.IsSelectAll()&&C3$jscomp$175.clearArray(a._GetOwnElseInstances());const o=this._runtime.GetCurrentCondition();let h=0;for(let e=0,r=n.length;e<r;++e){const r=n[e];n[h]=r,t=o.ReevaluateParameter(1,e),i=o.ReevaluateParameter(3,e),C3$jscomp$175.compare(t,s,i)?++h:a._PushElseInstance(r)}return C3$jscomp$175.truncateArray(n,h),a.SetArrayPicked(n),t=!!n.length,C3$jscomp$175.clearArray(n),r.Pop(),e.ApplySolToContainer(),t},PickByEvaluate(e,t){if(!e)return!1;const s=this._GetForEachStack(),i=s.Push(),r=e.GetCurrentSol();C3$jscomp$175.shallowAssignArray(i,r.GetInstances()),r.IsSelectAll()&&C3$jscomp$175.clearArray(r._GetOwnElseInstances());const n=this._runtime.GetCurrentCondition();let a=0;for(let e=0,s=i.length;e<s;++e){const s=i[e];i[a]=s,(t=n.ReevaluateParameter(1,e))?++a:r._PushElseInstance(s)}return C3$jscomp$175.truncateArray(i,a),r.SetArrayPicked(i),t=!!i.length,C3$jscomp$175.clearArray(i),s.Pop(),e.ApplySolToContainer(),t},PickNth(e,t){if(!e)return!1;const s=e.GetCurrentSol(),i=s.GetInstances();return!((t=Math.floor(t))>=i.length)&&(s.PickOne(i[t]),e.ApplySolToContainer(),!0)},PickRandom(e){if(!e)return!1;const t=e.GetCurrentSol(),s=t.GetInstances(),i=Math.floor(this._runtime.Random()*s.length);return!(i>=s.length)&&(t.PickOne(s[i]),e.ApplySolToContainer(),!0)},PickAll:e=>!(!e||!e.GetInstanceCount())&&(e.GetCurrentSol()._SetSelectAll(!0),e.ApplySolToContainer(),!0),PickOverlappingPoint(e,t,s){if(!e)return!1;const i=e.GetCurrentSol();var r=i.GetInstances();const n=this._runtime.GetCurrentEvent().IsOrBlock(),a=this._runtime.GetCurrentCondition().IsInverted();i.IsSelectAll()?(C3$jscomp$175.shallowAssignArray(tmpPickArray,r),i.ClearArrays(),i._SetSelectAll(!1)):n?(C3$jscomp$175.shallowAssignArray(tmpPickArray,i._GetOwnElseInstances()),C3$jscomp$175.clearArray(i._GetOwnElseInstances())):(C3$jscomp$175.shallowAssignArray(tmpPickArray,i._GetOwnInstances()),C3$jscomp$175.clearArray(i._GetOwnInstances()));for(let e=0,n=tmpPickArray.length;e<n;++e)r=tmpPickArray[e],C3$jscomp$175.xor(r.GetWorldInfo().ContainsPoint(t,s),a)?i._PushInstance(r):i._PushElseInstance(r);return e.ApplySolToContainer(),C3$jscomp$175.xor(!!i._GetOwnInstances().length,a)},PickLastCreated(e){if(!e)return!1;var t=e.IsFamily();let s=null;const i=this._runtime._GetInstancesPendingCreate();for(let r=i.length-1;0<=r;--r){const n=i[r];if(t){if(n.GetObjectClass().BelongsToFamily(e)){s=n;break}}else if(n.GetObjectClass()===e){s=n;break}}return s||(t=e.GetInstances()).length&&(s=t.at(-1)),!!s&&(e.GetCurrentSol().PickOne(s),e.ApplySolToContainer(),!0)},Repeat(e){return this._runtime.IsDebugging()?this._DebugRepeat(e):this._Repeat(e)},While(){return this._runtime.IsDebugging()?this._DebugWhile():this._While()},For(e,t,s){return this._runtime.IsDebugging()?this._DebugFor(e,t,s):this._For(e,t,s)},ForEach(e){return this._runtime.IsDebugging()?this._DebugForEach(e):this._ForEach(e)},ForEachOrdered(e,t,s){return this._runtime.IsDebugging()?this._DebugForEachOrdered(e,s):this._ForEachOrdered(e,s)},LayerVisible:e=>!!e&&e.IsVisible(),LayerInteractive:e=>!!e&&e.IsSelfAndParentsInteractive(),LayerEmpty:e=>!!e&&!e.GetInstanceCount(),LayerCmpOpacity:(e,t,s)=>!!e&&C3$jscomp$175.compare(100*e.GetOpacity(),t,s),OnImageLoadingComplete:()=>!0,IsLoadingImages(){return 0<this._imagesLoadingTotal},TemplateExists(e,t){const s=this._runtime.GetTemplateManager();return!(!s||!t)&&!!s.GetTemplateData(e,t)}};const C3$jscomp$176=self.C3;function SortZOrderList$jscomp$1(e,t){const s=e[0]-t[0];return 0!==s?s:e[1]-t[1]}function SortInstancesByValue(e,t){return e[1]-t[1]}const tempZOrderList$jscomp$1=[],tempInstValues=[],tempRect$jscomp$9=C3$jscomp$176.New(C3$jscomp$176.Rect),tempColor$jscomp$7=C3$jscomp$176.New(C3$jscomp$176.Color);C3$jscomp$176.Plugins.System.Acts={SetVar(e,t){e.SetValue(t)},AddVar(e,t){e.IsNumber()&&"number"!=typeof t&&(t=parseFloat(t)),e.SetValue(e.GetValue()+t)},SubVar(e,t){e.IsNumber()&&e.SetValue(e.GetValue()-t)},SetBoolVar(e,t){e.SetValue(!!t)},ToggleBoolVar(e){e.SetValue(!e.GetValue())},ResetGlobals(){this._runtime.GetEventSheetManager().ResetAllGlobalsToInitialValue()},CreateObject(e,t,s,i,r,n){if(e&&t&&(s=this._runtime.CreateInstance(e,t,s,i,r,n))){r&&t.SortAndAddInstancesByZIndex(s),(t=this._runtime.GetEventSheetManager()).BlockFlushingInstances(!0),s._TriggerOnCreatedOnSelfAndRelated(),t.BlockFlushingInstances(!1),t=new Map,s.CollectInstancesToPick(t,e,r);for(const[e,s]of t)e.GetCurrentSol().SetSetPicked(s)}},CreateObjectByName(e,t,s,i,r,n){e&&t&&(e=this._runtime.GetObjectClassByName(e))&&C3$jscomp$176.Plugins.System.Acts.CreateObject.call(this,e,t,s,i,r,n)},RecreateInitialObjects(e,t,s,i,r,n,a,o,h,l){if(e){var c=this._runtime.GetCurrentLayout();if(n&&!(c=this._runtime.GetLayoutManager().GetLayoutByName(n)))return;if(n=null,("number"!=typeof a||0<=a)&&!(n=c.GetLayer(a)))return;tempRect$jscomp$9.set(t,s,i,r),t=c.RecreateInitialObjects(e,tempRect$jscomp$9,n,o,h,l),e.GetCurrentSol().SetArrayPicked(t),e.ApplySolToContainer()}},StopLoop(){const e=this._loopStack;e.IsInLoop()&&e.GetCurrent().Stop()},SetGroupActive(e,t){(e=this._runtime.GetEventSheetManager().GetEventGroupByName(e))&&(0===t?e.SetGroupActive(!1):1===t?e.SetGroupActive(!0):e.SetGroupActive(!e.IsGroupActive()))},SetTimescale(e){this._runtime.SetTimeScale(e)},SetObjectTimescale(e,t){if(0>t&&(t=0),e){e=e.GetCurrentSol().GetInstances();for(const s of e)s.SetTimeScale(t)}},RestoreObjectTimescale(e){if(e){e=e.GetCurrentSol().GetInstances();for(const t of e)t.RestoreTimeScale()}},Wait(e){if(!(0>e))return this._runtime.GetEventSheetManager().AddScheduledWait().InitTimer(e),!0},WaitForSignal(e){return this._runtime.GetEventSheetManager().AddScheduledWait().InitSignal(e),!0},WaitForPreviousActions(){const e=this._runtime.GetEventSheetManager();return e.AddScheduledWait().InitPromise(e.GetPromiseForAllAsyncActions()),!0},Signal(e){e=e.toLowerCase();for(const t of this._runtime.GetEventSheetManager().scheduledWaits())t.IsSignal()&&t.GetSignalTag()===e&&t.SetSignalled()},async SnapshotCanvas(e,t,s,i,r,n){const a=this._runtime.GetCanvasManager();a&&(this.UpdateRender(),await a.SnapshotCanvas(0===e?"image/png":"image/jpeg",t/100,s,i,r,n),await this._runtime.TriggerAsync(C3$jscomp$176.Plugins.System.Cnds.OnCanvasSnapshot,null))},SetCanvasSize(e,t){if(!(0>=e||0>=t)){this._runtime.SetViewportSize(e,t),this._runtime.GetCurrentLayout().BoundScrolling();var s=this._runtime.GetCanvasManager();s&&("off"!==s.GetCurrentFullscreenMode()&&this._runtime.SetOriginalViewportSize(e,t),s.SetSize(s.GetLastWidth(),s.GetLastHeight(),!0),this._runtime.UpdateRender())}},SetFullscreenQuality(e){const t=this._runtime.GetCanvasManager();t&&"off"!==t.GetCurrentFullscreenMode()&&(t.SetFullscreenScalingQuality(0!==e?"high":"low"),t.SetSize(t.GetLastWidth(),t.GetLastHeight(),!0))},SaveState(e){this._runtime.SaveToSlot(e)},LoadState(e){this._runtime.LoadFromSlot(e)},LoadStateJSON(e){this._runtime.LoadFromJsonString(e)},SetHalfFramerateMode(e){},ResetPersisted(){for(const e of this._runtime.GetLayoutManager().GetAllLayouts())e.ResetPersistData()},SetPixelRounding(e){this._runtime.SetPixelRoundingEnabled(0!==e)},SetMinimumFramerate(e){this._runtime.SetMinimumFramerate(e)},SortZOrderByInstVar(e,t){if(e){var s=e.GetCurrentSol().GetInstances(),i=this._runtime.GetCurrentLayout(),r=e.IsFamily();e=e.GetFamilyIndex();for(let i=0,a=s.length;i<a;++i){var n=s[i];const a=n.GetWorldInfo();if(!a)continue;let o;o=r?n.GetInstanceVariableValue(t+n.GetObjectClass().GetFamilyInstanceVariableOffset(e)):n.GetInstanceVariableValue(t),tempZOrderList$jscomp$1.push([a.GetLayer().GetIndex(),a.GetZIndex()]),tempInstValues.push([n,o])}if(tempZOrderList$jscomp$1.length){tempZOrderList$jscomp$1.sort(SortZOrderList$jscomp$1),tempInstValues.sort(SortInstancesByValue),t=!1;for(let a=0,o=tempZOrderList$jscomp$1.length;a<o;++a)s=tempInstValues[a][0],r=i.GetLayerByIndex(tempZOrderList$jscomp$1[a][0]),e=tempZOrderList$jscomp$1[a][1],(n=r._GetInstances())[e]!==s&&(n[e]=s,s.GetWorldInfo()._SetLayer(r),r.SetZIndicesChanged(),t=!0);t&&this._runtime.UpdateRender(),C3$jscomp$176.clearArray(tempZOrderList$jscomp$1),C3$jscomp$176.clearArray(tempInstValues)}}},GoToLayout(e){if(!this._runtime.IsLoading()){var t=this._runtime.GetLayoutManager();t.IsPendingChangeMainLayout()||t.ChangeMainLayout(e)}},GoToLayoutByName(e){if(!this._runtime.IsLoading()){var t=this._runtime.GetLayoutManager();t.IsPendingChangeMainLayout()||(e=t.GetLayoutByName(e))&&t.ChangeMainLayout(e)}},NextPrevLayout(e){if(!this._runtime.IsLoading()){var t=this._runtime.GetLayoutManager();if(!t.IsPendingChangeMainLayout()){var s=t.GetAllLayouts(),i=s.indexOf(t.GetMainRunningLayout());e&&0===i||(e||i!==s.length-1)&&t.ChangeMainLayout(s[i+(e?-1:1)])}}},RestartLayout(){if(!this._runtime.IsLoading()){var e=this._runtime.GetLayoutManager();e.IsPendingChangeMainLayout()||(e.ChangeMainLayout(e.GetMainRunningLayout()),this._runtime.GetEventSheetManager().ResetAllGroupsInitialActivation())}},SetLayerVisible(e,t){e&&e.SetVisible(t)},SetLayerInteractive(e,t){e&&e.SetInteractive(t)},SetLayerOpacity(e,t){e&&e.SetOpacity(t/100)},SetLayerScale(e,t){e&&e.SetOwnScale(t)},SetLayerScaleRate(e,t){e&&e.SetScaleRate(t)},SetLayerAngle(e,t){e&&e.SetAngle(C3$jscomp$176.toRadians(+t))},SetLayerScroll(e,t,s){e&&(e.SetOwnScrollPositionEnabled(!0),e.SetScrollX(t),e.SetScrollY(s))},RestoreLayerScroll(e){e&&e.SetOwnScrollPositionEnabled(!1)},SetLayerParallax(e,t,s){e&&e.SetParallax(t/100,s/100)},SetLayerZElevation(e,t){e&&e.SetZElevation(+t)},SetLayerBackground(e,t){e&&(tempColor$jscomp$7.setFromRgbValue(t),tempColor$jscomp$7.clamp(),(e=e.GetBackgroundColor()).equalsIgnoringAlpha(tempColor$jscomp$7)||(e.copyRgb(tempColor$jscomp$7),this.UpdateRender()))},SetLayerTransparent(e,t){e&&e.SetTransparent(t)},SetLayerBlendMode(e,t){e&&e.SetBlendMode(t)},SetLayerEffectEnabled(e,t,s){e&&(s=e.GetEffectList().GetEffectTypeByName(s))&&(t=1===t,s.IsActive()!==t&&(s.SetActive(t),e.UpdateActiveEffects(),this._runtime.UpdateRender()))},SetLayerEffectParam(e,t,s,i){if(e&&(t=(e=e.GetEffectList()).GetEffectTypeByName(t))){s=Math.floor(s);var r=t.GetShaderProgram().GetParameterType(s);r&&("color"===r?(tempColor$jscomp$7.setFromRgbValue(i),i=tempColor$jscomp$7):"percent"===r&&(i/=100),e.SetEffectParameter(t.GetIndex(),s,i)&&t.IsActive()&&this._runtime.UpdateRender())}},SetLayerForceOwnTexture(e,t){e&&e.SetForceOwnTexture(t)},SetLayoutScale(e){this._runtime.GetCurrentLayout().SetScale(+e)},SetLayoutAngle(e){this._runtime.GetCurrentLayout().SetAngle(C3$jscomp$176.toRadians(+e))},SetLayoutEffectEnabled(e,t){const s=this._runtime.GetCurrentLayout();(t=s.GetEffectList().GetEffectTypeByName(t))&&(e=1===e,t.IsActive()!==e&&(t.SetActive(e),s.UpdateActiveEffects(),this._runtime.UpdateRender()))},SetLayoutEffectParam(e,t,s){const i=this._runtime.GetCurrentLayout().GetEffectList();if(e=i.GetEffectTypeByName(e)){t=Math.floor(t);var r=e.GetShaderProgram().GetParameterType(t);r&&("color"===r?(tempColor$jscomp$7.setFromRgbValue(s),s=tempColor$jscomp$7):"percent"===r&&(s/=100),i.SetEffectParameter(e.GetIndex(),t,s)&&e.IsActive()&&this._runtime.UpdateRender())}},SetLayoutVanishingPoint(e,t){this._runtime.GetCurrentLayout().SetVanishingPointXY(e/100,t/100)},SetLayoutProjection(e){const t=this._runtime.GetCurrentLayout();0===e?t.SetPerspectiveProjection():t.SetOrthographicProjection()},ScrollX(e){this._runtime.GetCurrentLayout().SetScrollX(e)},ScrollY(e){this._runtime.GetCurrentLayout().SetScrollY(e)},Scroll(e,t){const s=this._runtime.GetCurrentLayout();s.SetScrollX(e),s.SetScrollY(t)},ScrollToObject(e){if(e&&(e=e.GetFirstPicked())&&(e=e.GetWorldInfo())){var t=this._runtime.GetCurrentLayout();t.SetScrollX(e.GetX()),t.SetScrollY(e.GetY())}},async LoadObjectTextures(e){const t=this._runtime.GetMainRunningLayout();t&&e&&!this._runtime.IsLoading()&&(e=e.IsFamily()?e.GetFamilyMembers():[e],await this._LoadTexturesForObjectClasses(t,e))},async LoadObjectTexturesByName(e){await C3$jscomp$176.Plugins.System.Acts.LoadObjectTextures.call(this,this._runtime.GetObjectClassByName(e))},UnloadObjectTextures(e){const t=this._runtime.GetMainRunningLayout();t&&e&&(e=e.IsFamily()?e.GetFamilyMembers():[e],this._UnloadTexturesForObjectClasses(t,e))},UnloadObjectTexturesByName(e){C3$jscomp$176.Plugins.System.Acts.UnloadObjectTextures.call(this,this._runtime.GetObjectClassByName(e))},UnloadUnusedTextures(){const e=this._runtime.GetMainRunningLayout();if(e){var t=e._GetTextureLoadedObjectTypes();this._UnloadTexturesForObjectClasses(e,t)}},async LoadLayoutTextures(e){const t=this._runtime.GetMainRunningLayout();e&&t&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(t,e._GetInitialObjectClasses())},async LoadLayoutTexturesByName(e){const t=this._runtime.GetMainRunningLayout();(e=this._runtime.GetLayoutManager().GetLayoutByName(e))&&t&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(t,e._GetInitialObjectClasses())},SetFunctionReturnValue(e){const t=this._eventStack.GetCurrentExpFuncStackFrame();if(t)switch(t.GetFunctionReturnType()){case 1:"number"==typeof e&&t.SetFunctionReturnValue(e);break;case 2:"string"==typeof e&&t.SetFunctionReturnValue(e);break;case 3:t.SetFunctionReturnValue(e)}},MapFunction(e,t,s){var i=this._GetFunctionMap(e.toLowerCase(),!0);const r=i.strMap,n=t.toLowerCase();if(r.has(n),i=C3$jscomp$176.first(r.values())||i.defaultFunc){if((i=0!==i.GetReturnType())!==(0!==s.GetReturnType()))return}r.set(n,s)},MapFunctionDefault(e,t){const s=this._GetFunctionMap(e.toLowerCase(),!0);s.defaultFunc;var i=C3$jscomp$176.first(s.strMap.values())||s.defaultFunc;if(i){if((i=0!==i.GetReturnType())!==(0!==t.GetReturnType()))return}s.defaultFunc=t},CallMappedFunction(e,t,s){s=Math.floor(s);var i=this._GetFunctionMap(e.toLowerCase(),!1);if(i){var r=i.strMap.get(t.toLowerCase());if(!r){if(!i.defaultFunc)return;r=i.defaultFunc,s=0}if(r.IsEnabled()&&0===r.GetReturnType()){var n=(t=(e=this._runtime).GetEventSheetManager()).GetCurrentEvent(),a=0<(i=n.GetSolModifiersIncludingParents()).length;a&&(r.IsCopyPicked()?t.PushCopySol(i):t.PushCleanSol(i));var o=[];if(n=t.FindFirstFunctionBlockParent(n))for(let e=s,t=(n=n.GetFunctionParameters()).length;e<t;++e)o.push(n[e].GetValue());s=r.GetFunctionParameters();for(let e=o.length,t=s.length;e<t;++e)o.push(s[e].GetInitialValue());return e.IsDebugging()?this._DebugDoCallMappedFunction(t,r,o,a,i):this._DoCallMappedFunction(t,r,o,a,i)}}}};const C3$jscomp$177=self.C3;C3$jscomp$177.Plugins.System.Exps={int:function(e){return"string"==typeof e&&(e=parseInt(e,10),isNaN(e)&&(e=0)),Math.floor(e)},float:function(e){return"string"==typeof e&&(e=parseFloat(e),isNaN(e)&&(e=0)),e},str:e=>e.toString(),len:e=>"string"==typeof e?e.length:0,random(e,t){return void 0===t?this._runtime.Random()*e:this._runtime.Random()*(t-e)+e},choose(...e){return e[Math.floor(this._runtime.Random()*e.length)]},chooseindex:(e,...t)=>("number"!=typeof e&&(e=0),t[e=C3$jscomp$177.clamp(Math.floor(e),0,t.length-1)]),pi:()=>Math.PI,infinity:()=>1/0,sqrt:e=>Math.sqrt(e),abs:e=>Math.abs(e),round:e=>Math.round(e),roundtodp:(e,t)=>(t=Math.max(Math.floor(t),0),t=Math.pow(10,t),Math.round((e+Number.EPSILON)*t)/t),floor:e=>Math.floor(e),ceil:e=>Math.ceil(e),sign:e=>Math.sign(e),sin:e=>Math.sin(C3$jscomp$177.toRadians(e)),cos:e=>Math.cos(C3$jscomp$177.toRadians(e)),tan:e=>Math.tan(C3$jscomp$177.toRadians(e)),asin:e=>C3$jscomp$177.toDegrees(Math.asin(e)),acos:e=>C3$jscomp$177.toDegrees(Math.acos(e)),atan:e=>C3$jscomp$177.toDegrees(Math.atan(e)),exp:e=>Math.exp(e),ln:e=>Math.log(e),log10:e=>Math.log(e)/Math.LN10,max(...e){let t=e[0];"number"!=typeof t&&(t=0);for(let s=1,i=e.length;s<i;++s){let i=e[s];"number"==typeof i&&t<i&&(t=i)}return t},min(...e){let t=e[0];"number"!=typeof t&&(t=0);for(let s=1,i=e.length;s<i;++s){let i=e[s];"number"==typeof i&&t>i&&(t=i)}return t},clamp:(e,t,s)=>C3$jscomp$177.clamp(e,t,s),distance:(e,t,s,i)=>C3$jscomp$177.distanceTo(e,t,s,i),angle:(e,t,s,i)=>C3$jscomp$177.toDegrees(C3$jscomp$177.angleTo(e,t,s,i)),lerp:(e,t,s)=>C3$jscomp$177.lerp(e,t,s),unlerp:(e,t,s)=>C3$jscomp$177.unlerp(e,t,s),qarp:(e,t,s,i)=>C3$jscomp$177.qarp(e,t,s,i),cubic:(e,t,s,i,r)=>C3$jscomp$177.cubic(e,t,s,i,r),cosp:(e,t,s)=>C3$jscomp$177.cosp(e,t,s),anglediff:(e,t)=>C3$jscomp$177.toDegrees(C3$jscomp$177.angleDiff(C3$jscomp$177.toRadians(e),C3$jscomp$177.toRadians(t))),anglelerp:(e,t,s)=>C3$jscomp$177.toDegrees(C3$jscomp$177.angleLerp(C3$jscomp$177.toRadians(e),C3$jscomp$177.toRadians(t),s)),anglerotate:(e,t,s)=>C3$jscomp$177.toDegrees(C3$jscomp$177.angleRotate(C3$jscomp$177.toRadians(e),C3$jscomp$177.toRadians(t),C3$jscomp$177.toRadians(s))),setbit:(e,t,s)=>(0|e)&~(1<<(t|=0))|(0!==s?1:0)<<t,togglebit:(e,t)=>(0|e)^1<<(0|t),getbit:(e,t)=>(0|e)&1<<(0|t)?1:0,newline:()=>"\n",uppercase:e=>"string"==typeof e?e.toUpperCase():"",lowercase:e=>"string"==typeof e?e.toLowerCase():"",left:(e,t)=>"string"==typeof e?e.substr(0,t):"",mid:(e,t,s)=>"string"!=typeof e?"":0>s?e.substr(t):e.substr(t,s),right:(e,t)=>"string"==typeof e?e.substr(Math.max(e.length-t,0)):"",trim:e=>"string"==typeof e?e.trim():"",tokenat:(e,t,s)=>"string"!=typeof e||"string"!=typeof s?"":(e=e.split(s),0>(t=Math.floor(t))||t>=e.length?"":e[t]),tokencount:(e,t)=>"string"==typeof e&&"string"==typeof t&&e.length?e.split(t).length:0,find:(e,t)=>"string"==typeof e&&"string"==typeof t?e.search(new RegExp(C3$jscomp$177.EscapeRegex(t),"i")):-1,findcase:(e,t)=>"string"==typeof e&&"string"==typeof t?e.search(new RegExp(C3$jscomp$177.EscapeRegex(t),"")):-1,replace:(e,t,s)=>"string"==typeof e&&"string"==typeof t&&"string"==typeof s?e.replace(new RegExp(C3$jscomp$177.EscapeRegex(t),"gi"),s):"string"==typeof e?e:"",regexsearch(e,t,s){return t=this.GetRegex(t,s),e?e.search(t):-1},regexreplace(e,t,s,i){return t=this.GetRegex(t,s),e?e.replace(t,i):""},regexmatchcount(e,t,s){return(e=this.GetRegexMatches(e.toString(),t,s))?e.length:0},regexmatchat(e,t,s,i){return i=Math.floor(i),!(e=this.GetRegexMatches(e.toString(),t,s))||0>i||i>=e.length?"":e[i]},zeropad(e,t){let s=0>e?"-":"";return 0>e&&(e=-e),s+="0".repeat(Math.max(t-e.toString().length,0)),s+e.toString()},urlencode:e=>encodeURIComponent(e),urldecode:e=>decodeURIComponent(e),dt(){return this._runtime._GetDtFast()},timescale(){return this._runtime.GetTimeScale()},wallclocktime(){return(Date.now()-this._runtime.GetStartTime())/1e3},unixtime:()=>Date.now(),time(){return this._runtime.GetGameTime()},tickcount(){return this._runtime.GetTickCount()},objectcount(){return this._runtime.GetObjectCount()},fps(){return this._runtime.GetFPS()},cpuutilisation(){return this._runtime.GetMainThreadTime()},gpuutilisation(){return this._runtime.GetGPUUtilisation()},windowwidth(){return this._runtime.GetCanvasManager().GetDeviceWidth()},windowheight(){return this._runtime.GetCanvasManager().GetDeviceHeight()},originalwindowwidth(){return this._runtime.GetOriginalViewportWidth()},originalwindowheight(){return this._runtime.GetOriginalViewportHeight()},originalviewportwidth(){return this._runtime.GetOriginalViewportWidth()},originalviewportheight(){return this._runtime.GetOriginalViewportHeight()},scrollx(){return this._runtime.GetCurrentLayout().GetScrollX()},scrolly(){return this._runtime.GetCurrentLayout().GetScrollY()},layoutname(){return this._runtime.GetCurrentLayout().GetName()},layoutscale(){return this._runtime.GetCurrentLayout().GetScale()},layoutangle(){return C3$jscomp$177.toDegrees(this._runtime.GetCurrentLayout().GetAngle())},layoutwidth(){return this._runtime.GetCurrentLayout().GetWidth()},layoutheight(){return this._runtime.GetCurrentLayout().GetHeight()},vanishingpointx(){return 100*this._runtime.GetCurrentLayout().GetVanishingPointX()},vanishingpointy(){return 100*this._runtime.GetCurrentLayout().GetVanishingPointY()},viewportleft(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().getLeft():0},viewporttop(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().getTop():0},viewportright(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().getRight():0},viewportbottom(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().getBottom():0},viewportwidth(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().width():0},viewportheight(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().height():0},canvastolayerx(e,t,s){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.CanvasCssToLayer(t,s)[0]:0},canvastolayery(e,t,s){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.CanvasCssToLayer(t,s)[1]:0},layertocanvasx(e,t,s){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.LayerToCanvasCss(t,s)[0]:0},layertocanvasy(e,t,s){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.LayerToCanvasCss(t,s)[1]:0},layerscale(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetOwnScale():0},layerangle(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?C3$jscomp$177.toDegrees(e.GetOwnAngle()):0},layeropacity(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?100*e.GetOpacity():0},layerscalerate(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetScaleRate():0},layerscrollx(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetScrollX():0},layerscrolly(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetScrollY():0},layerparallaxx(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?100*e.GetParallaxX():0},layerparallaxy(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?100*e.GetParallaxY():0},layerzelevation(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetZElevation():0},layerindex(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetIndex():-1},canvassnapshot(){const e=this._runtime.GetCanvasManager();return e?e.GetCanvasSnapshotUrl():""},loopindex(e){const t=this._loopStack;return t.IsInLoop()?e?(e=t.FindByName(e))?e.GetIndex():0:t.GetCurrent().GetIndex():0},savestatejson(){return this._runtime.GetLastSaveJsonString()},callmapped(e,t,...s){var i=this._GetFunctionMap(e.toLowerCase(),!1);if(!i)return 0;let r=i.strMap.get(t.toLowerCase());if(!r){if(!i.defaultFunc)return 0;r=i.defaultFunc}i=r.GetReturnType();const n=r.GetDefaultReturnValue();if(0===i)return 0;if(!r.IsEnabled())return n;const a=0<(t=(e=this._runtime.GetEventSheetManager()).GetCurrentEvent().GetSolModifiersIncludingParents()).length;a&&(r.IsCopyPicked()?e.PushCopySol(t):e.PushCleanSol(t));var o=r.GetFunctionParameters();for(let e=s.length,t=o.length;e<t;++e)s.push(o[e].GetInitialValue());return s=(o=r.GetEventBlock()).RunAsExpressionFunctionCall(o.GetSolModifiersIncludingParents(),r.IsCopyPicked(),i,n,...s),a&&e.PopSol(t),s},loadingprogress(){return this._runtime.GetAssetManager().GetLoadProgress()},imageloadingprogress(){return 0===this._imagesLoadingTotal?1:this._imagesLoadingComplete/this._imagesLoadingTotal},renderer(){return this._runtime.GetWebGPURenderer()?"webgpu":"webgl"},rendererdetail(){return this._runtime.GetWebGPURenderer()?"<unavailable>":this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()},imagememoryusage(){let e=this._runtime.GetRenderer().GetEstimatedTextureMemoryUsage();return Math.round(100*e/1048576)/100},rgb:(e,t,s)=>C3$jscomp$177.PackRGB(e,t,s),rgbex:(e,t,s)=>C3$jscomp$177.PackRGBEx(e/100,t/100,s/100),rgba:(e,t,s,i)=>C3$jscomp$177.PackRGBAEx(e/100,t/100,s/100,i/100),rgbex255:(e,t,s)=>C3$jscomp$177.PackRGBEx(e/255,t/255,s/255),rgba255:(e,t,s,i)=>C3$jscomp$177.PackRGBAEx(e/255,t/255,s/255,i/255),projectname(){return this._runtime.GetProjectName()},projectversion(){return this._runtime.GetProjectVersion()},currenteventsheetname(){return this._runtime.GetCurrentEvent().GetEventSheet().GetName()},currenteventnumber(){return this._runtime.GetCurrentEvent().GetDisplayNumber()}};const C3$jscomp$178=self.C3;C3$jscomp$178.Plugins.TiledBg=class extends C3$jscomp$178.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$179=self.C3;function WrapModeToStr(e){switch(e){case 0:return"clamp-to-edge";case 2:return"mirror-repeat"}return"repeat"}C3$jscomp$179.Plugins.TiledBg.Type=class extends C3$jscomp$179.SDKTypeBase{constructor(e,t){super(e),this._wrapY=this._wrapX="repeat",t&&(this._wrapX=WrapModeToStr(t[0]),this._wrapY=WrapModeToStr(t[1]))}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling(),wrapX:this._wrapX,wrapY:this._wrapY})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}};const C3$jscomp$180=self.C3,C3X$jscomp$18=self.C3X,tempRect$jscomp$10=C3$jscomp$180.New(C3$jscomp$180.Rect),tempQuad$jscomp$6=C3$jscomp$180.New(C3$jscomp$180.Quad),rcTex$jscomp$3=C3$jscomp$180.New(C3$jscomp$180.Rect),qTex=C3$jscomp$180.New(C3$jscomp$180.Quad);C3$jscomp$180.Plugins.TiledBg.Instance=class extends C3$jscomp$180.SDKWorldInstanceBase{constructor(e,t){super(e),this._imageOffsetY=this._imageOffsetX=0,this._imageScaleY=this._imageScaleX=1,this._imageAngle=0,this._enableTileRandomization=!1,this._tileBlendMarginY=this._tileBlendMarginX=this._tileAngleRandom=this._tileYRandom=this._tileXRandom=0,this._ownImageInfo=null,t&&(this.GetWorldInfo().SetVisible(!!t[0]),this._imageOffsetX=t[4],this._imageOffsetY=t[5],this._imageScaleX=t[6],this._imageScaleY=t[7],this._imageAngle=C3$jscomp$180.toRadians(t[8]),this._enableTileRandomization=!!t[9],this._tileXRandom=t[10],this._tileYRandom=t[11],this._tileAngleRandom=t[12],this._tileBlendMarginX=t[13],this._tileBlendMarginY=t[14])}Release(){this._ReleaseOwnImage(),super.Release()}_ReleaseOwnImage(){this._ownImageInfo&&(this._ownImageInfo.Release(),this._ownImageInfo=null)}CalculateTextureCoordsFor3DFace(e,t,s){var i=this.GetCurrentImageInfo();const r=i.GetWidth();i=i.GetHeight();const n=this._imageOffsetX/r,a=this._imageOffsetY/i,o=this._imageAngle;rcTex$jscomp$3.set(0,0,e/(r*this._imageScaleX),t/(i*this._imageScaleY)),rcTex$jscomp$3.offset(-n,-a),0===o?s.setFromRect(rcTex$jscomp$3):s.setFromRotatedRect(rcTex$jscomp$3,-o)}SetTilingShaderProgram(e){if(this._enableTileRandomization){const t=this.GetCurrentImageInfo();e.SetTileRandomizationMode(),e.SetTileRandomizationInfo(t.GetWidth()*this._imageScaleX,t.GetHeight()*this._imageScaleY,this._tileXRandom,this._tileYRandom,this._tileAngleRandom,this._tileBlendMarginX,this._tileBlendMarginY)}else e.SetTextureFillMode()}Draw(e){var t=this.GetCurrentImageInfo(),s=t.GetTexture();if(null!==s){this.SetTilingShaderProgram(e),e.SetTexture(s),s=t.GetWidth(),t=t.GetHeight();var i=this._imageOffsetX/s,r=this._imageOffsetY/t,n=this.GetWorldInfo();rcTex$jscomp$3.set(0,0,n.GetWidth()/(s*this._imageScaleX),n.GetHeight()/(t*this._imageScaleY)),rcTex$jscomp$3.offset(-i,-r),n.HasMesh()?this._DrawMesh(n,e):this._DrawStandard(n,e)}}_DrawStandard(e,t){let s=e.GetBoundingQuad();this._runtime.IsPixelRoundingEnabled()&&(s=e.PixelRoundQuad(s)),0===this._imageAngle?t.Quad3(s,rcTex$jscomp$3):(qTex.setFromRotatedRect(rcTex$jscomp$3,-this._imageAngle),t.Quad4(s,qTex))}_DrawMesh(e,t){const s=e.GetTransformedMesh();if(e.IsMeshChanged()){e.CalculateBbox(tempRect$jscomp$10,tempQuad$jscomp$6,!1);let t=tempQuad$jscomp$6;this._runtime.IsPixelRoundingEnabled()&&(t=e.PixelRoundQuad(t));let i=rcTex$jscomp$3;0!==this._imageAngle&&(qTex.setFromRotatedRect(rcTex$jscomp$3,-this._imageAngle),i=qTex),s.CalculateTransformedMesh(e.GetSourceMesh(),t,i),e.SetMeshChanged(!1)}s.Draw(t)}GetCurrentImageInfo(){return this._ownImageInfo||this._objectClass.GetImageInfo()}IsOriginalSizeKnown(){return!0}GetTexture(){return this.GetCurrentImageInfo().GetTexture()}_SetMeshChanged(){this.GetWorldInfo().SetMeshChanged(!0)}_SetImageOffsetX(e){this._imageOffsetX!==e&&(this._imageOffsetX=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetX(){return this._imageOffsetX}_SetImageOffsetY(e){this._imageOffsetY!==e&&(this._imageOffsetY=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetY(){return this._imageOffsetY}_SetImageScaleX(e){this._imageScaleX!==e&&(this._imageScaleX=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleX(){return this._imageScaleX}_SetImageScaleY(e){this._imageScaleY!==e&&(this._imageScaleY=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleY(){return this._imageScaleY}_SetImageAngle(e){this._imageAngle!==e&&(this._imageAngle=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageAngle(){return this._imageAngle}_SetTileRandomizationEnabled(e){e=!!e,this._enableTileRandomization!==e&&(this._enableTileRandomization=e,this._runtime.UpdateRender())}_IsTileRandomizationEnabled(){return this._enableTileRandomization}_SetTileXRandom(e){this._tileXRandom!==e&&(this._tileXRandom=e,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileXRandom(){return this._tileXRandom}_SetTileYRandom(e){this._tileYRandom!==e&&(this._tileYRandom=e,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileYRandom(){return this._tileYRandom}_SetTileAngleRandom(e){this._tileAngleRandom!==e&&(this._tileAngleRandom=e,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileAngleRandom(){return this._tileAngleRandom}_SetTileBlendMarginX(e){this._tileBlendMarginX!==e&&(this._tileBlendMarginX=e,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileBlendMarginX(){return this._tileBlendMarginX}_SetTileBlendMarginY(e){this._tileBlendMarginY!==e&&(this._tileBlendMarginY=e,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileBlendMarginY(){return this._tileBlendMarginY}GetDebuggerProperties(){return[{title:"plugins.tiledbg.properties.image-transform.name",properties:[{name:"plugins.tiledbg.properties.image-offset-x.name",value:this._GetImageOffsetX(),onedit:e=>this._SetImageOffsetX(e)},{name:"plugins.tiledbg.properties.image-offset-y.name",value:this._GetImageOffsetY(),onedit:e=>this._SetImageOffsetY(e)},{name:"plugins.tiledbg.properties.image-scale-x.name",value:100*this._GetImageScaleX(),onedit:e=>this._SetImageScaleX(e/100)},{name:"plugins.tiledbg.properties.image-scale-y.name",value:100*this._GetImageScaleY(),onedit:e=>this._SetImageScaleY(e/100)},{name:"plugins.tiledbg.properties.image-angle.name",value:C3$jscomp$180.toDegrees(this._GetImageAngle()),onedit:e=>this._SetImageAngle(C3$jscomp$180.toRadians(e))}]},{title:"plugins.tiledbg.properties.tile-randomization.name",properties:[{name:"plugins.tiledbg.properties.enable-tile-randomization.name",value:this._IsTileRandomizationEnabled(),onedit:e=>this._SetTileRandomizationEnabled(e)},{name:"plugins.tiledbg.properties.x-random.name",value:100*this._GetTileXRandom(),onedit:e=>this._SetTileXRandom(e/100)},{name:"plugins.tiledbg.properties.y-random.name",value:100*this._GetTileYRandom(),onedit:e=>this._SetTileYRandom(e/100)},{name:"plugins.tiledbg.properties.angle-random.name",value:100*this._GetTileAngleRandom(),onedit:e=>this._SetTileAngleRandom(e/100)},{name:"plugins.tiledbg.properties.blend-margin-x.name",value:100*this._GetTileBlendMarginX(),onedit:e=>this._SetTileBlendMarginX(e/100)},{name:"plugins.tiledbg.properties.blend-margin-y.name",value:100*this._GetTileBlendMarginY(),onedit:e=>this._SetTileBlendMarginY(e/100)}]}]}GetPropertyValueByIndex(e){switch(e){case 4:return this._GetImageOffsetX();case 5:return this._GetImageOffsetY();case 6:return this._GetImageScaleX();case 7:return this._GetImageScaleY();case 8:return this._GetImageAngle();case 9:return this._IsTileRandomizationEnabled();case 10:return this._GetTileXRandom();case 11:return this._GetTileYRandom();case 12:return this._GetTileAngleRandom();case 13:return this._GetTileBlendMarginX();case 14:return this._GetTileBlendMarginY()}}SetPropertyValueByIndex(e,t){switch(e){case 4:this._SetImageOffsetX(t);break;case 5:this._SetImageOffsetY(t);break;case 6:this._SetImageScaleX(t);break;case 7:this._SetImageScaleY(t);break;case 8:this._SetImageAngle(t);break;case 9:this._SetTileRandomizationEnabled(!!t);break;case 10:this._SetTileXRandom(t);break;case 11:this._SetTileYRandom(t);break;case 12:this._SetTileAngleRandom(t);break;case 13:this._SetTileBlendMarginX(t);break;case 14:this._SetTileBlendMarginY(t)}}GetScriptInterfaceClass(){return self.ITiledBackgroundInstance}};const map$jscomp$19=new WeakMap;self.ITiledBackgroundInstance=class extends self.IWorldInstance{constructor(){super(),map$jscomp$19.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set imageOffsetX(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetImageOffsetX(e)}get imageOffsetX(){return map$jscomp$19.get(this)._GetImageOffsetX()}set imageOffsetY(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetImageOffsetY(e)}get imageOffsetY(){return map$jscomp$19.get(this)._GetImageOffsetY()}setImageOffset(e,t){C3X$jscomp$18.RequireFiniteNumber(e),C3X$jscomp$18.RequireFiniteNumber(t);const s=map$jscomp$19.get(this);s._SetImageOffsetX(e),s._SetImageOffsetY(t)}getImageOffset(){const e=map$jscomp$19.get(this);return[e._GetImageOffsetX(),e._GetImageOffsetY()]}set imageScaleX(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetImageScaleX(e)}get imageScaleX(){return map$jscomp$19.get(this)._GetImageScaleX()}set imageScaleY(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetImageScaleY(e)}get imageScaleY(){return map$jscomp$19.get(this)._GetImageScaleY()}setImageScale(e,t){C3X$jscomp$18.RequireFiniteNumber(e),C3X$jscomp$18.RequireFiniteNumber(t);const s=map$jscomp$19.get(this);s._SetImageScaleX(e),s._SetImageScaleY(t)}getImageScale(){const e=map$jscomp$19.get(this);return[e._GetImageScaleX(),e._GetImageScaleY()]}set imageAngle(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetImageAngle(e)}get imageAngle(){return map$jscomp$19.get(this)._GetImageAngle()}set imageAngleDegrees(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetImageAngle(C3$jscomp$180.toRadians(e))}get imageAngleDegrees(){return C3$jscomp$180.toDegrees(map$jscomp$19.get(this)._GetImageAngle())}get imageWidth(){return map$jscomp$19.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return map$jscomp$19.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){const e=map$jscomp$19.get(this).GetCurrentImageInfo();return[e.GetWidth(),e.GetHeight()]}set enableTileRandomization(e){map$jscomp$19.get(this)._SetTileRandomizationEnabled(!!e)}get enableTileRandomization(){return map$jscomp$19.get(this)._IsTileRandomizationEnabled()}set tileXRandom(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetTileXRandom(e)}get tileXRandom(){return map$jscomp$19.get(this)._GetTileXRandom()}set tileYRandom(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetTileYRandom(e)}get tileYRandom(){return map$jscomp$19.get(this)._GetTileYRandom()}setTileRandom(e,t){C3X$jscomp$18.RequireFiniteNumber(e),C3X$jscomp$18.RequireFiniteNumber(t);const s=map$jscomp$19.get(this);s._SetTileXRandom(e),s._SetTileYRandom(t)}getTileRandom(){const e=map$jscomp$19.get(this);return[e._GetTileXRandom(),e._GetTileYRandom()]}set tileAngleRandom(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetTileAngleRandom(e)}get tileAngleRandom(){return map$jscomp$19.get(this)._GetTileAngleRandom()}set tileBlendMarginX(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetTileBlendMarginX(e)}get tileBlendMarginX(){return map$jscomp$19.get(this)._GetTileBlendMarginX()}set tileBlendMarginY(e){C3X$jscomp$18.RequireFiniteNumber(e),map$jscomp$19.get(this)._SetTileBlendMarginY(e)}get tileBlendMarginY(){return map$jscomp$19.get(this)._GetTileBlendMarginY()}setTileBlendMargin(e,t){C3X$jscomp$18.RequireFiniteNumber(e),C3X$jscomp$18.RequireFiniteNumber(t);const s=map$jscomp$19.get(this);s._SetTileBlendMarginX(e),s._SetTileBlendMarginY(t)}getTileBlendMargin(){const e=map$jscomp$19.get(this);return[e._GetTileBlendMarginX(),e._GetTileBlendMarginY()]}},self.C3.Plugins.TiledBg.Cnds={OnURLLoaded:()=>!0,OnURLFailed:()=>!0,IsTileRandomizationEnabled(){return this._IsTileRandomizationEnabled()}};const C3$jscomp$182=self.C3;C3$jscomp$182.Plugins.TiledBg.Acts={SetImageOffsetX(e){this._SetImageOffsetX(e)},SetImageOffsetY(e){this._SetImageOffsetY(e)},SetImageScaleX(e){this._SetImageScaleX(e/100)},SetImageScaleY(e){this._SetImageScaleY(e/100)},SetImageAngle(e){this._SetImageAngle(C3$jscomp$182.toRadians(e))},SetTileRandomizationEnabled(e){this._SetTileRandomizationEnabled(e)},SetTilePosRandom(e,t){this._SetTileXRandom(e/100),this._SetTileYRandom(t/100)},SetTileAngleRandom(e){this._SetTileAngleRandom(e/100)},SetTileBlendMargin(e,t){this._SetTileBlendMarginX(e/100),this._SetTileBlendMarginY(t/100)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},async LoadURL(e,t){if(!this._ownImageInfo||this._ownImageInfo.GetURL()!==e){t=this._runtime;var s=C3$jscomp$182.New(C3$jscomp$182.ImageInfo);try{if(await s.LoadDynamicAsset(t,e),!s.IsLoaded())throw Error("image failed to load");if(this.WasReleased())return s.Release(),null;if(!await s.LoadStaticTexture(t.GetRenderer(),{sampling:t.GetSampling(),wrapX:"repeat",wrapY:"repeat"}))return}catch(e){return void(this.WasReleased()||this.Trigger(C3$jscomp$182.Plugins.TiledBg.Cnds.OnURLFailed))}this.WasReleased()?s.Release():(this._ReleaseOwnImage(),this._ownImageInfo=s,t.UpdateRender(),await this.TriggerAsync(C3$jscomp$182.Plugins.TiledBg.Cnds.OnURLLoaded))}}};const C3$jscomp$183=self.C3;C3$jscomp$183.Plugins.TiledBg.Exps={ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},ImageOffsetX(){return this._imageOffsetX},ImageOffsetY(){return this._imageOffsetY},ImageScaleX(){return 100*this._imageScaleX},ImageScaleY(){return 100*this._imageScaleY},ImageAngle(){return C3$jscomp$183.toDegrees(this._imageAngle)},TileXRandom(){return 100*this._GetTileXRandom()},TileYRandom(){return 100*this._GetTileYRandom()},TileAngleRandom(){return 100*this._GetTileAngleRandom()},TileBlendMarginX(){return 100*this._GetTileBlendMarginX()},TileBlendMarginY(){return 100*this._GetTileBlendMarginY()}};const C3$jscomp$184=self.C3;C3$jscomp$184.Plugins.Sprite=class extends C3$jscomp$184.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$185=self.C3,spawnPickStack=[];C3$jscomp$185.Plugins.Sprite.Type=class extends C3$jscomp$185.SDKTypeBase{constructor(e){super(e),this._animations=e.GetAnimations()}Release(){C3$jscomp$185.clearArray(this._animations),super.Release()}OnCreate(){for(const e of this._animations)e.LoadAllAssets(this._runtime)}LoadTextures(e){const t={sampling:this._runtime.GetSampling()};return Promise.all(this._animations.map((s=>s.LoadAllTextures(e,t))))}ReleaseTextures(){for(const e of this._animations)e.ReleaseAllTextures()}OnDynamicTextureLoadComplete(){this._UpdateAllCurrentTexture()}_UpdateAllCurrentTexture(){for(const e of this._objectClass.instancesIncludingPendingCreate())e.GetSdkInstance()._UpdateCurrentTexture()}FinishCondition(e){C3$jscomp$185.Plugins.Sprite.FinishCollisionCondition(this,e)}BeforeRunAction(e){spawnPickStack.push({objectClass:null,createHierarchy:!1,instances:[]})}_SpawnPickInstance(e,t,s){const i=spawnPickStack.at(-1);i.objectClass=e,i.createHierarchy=s,i.instances.push(t)}AfterRunAction(e){const t=(e=spawnPickStack.pop()).objectClass,s=e.createHierarchy;if(t){var i=new Map;for(const r of e.instances)r.CollectInstancesToPick(i,t,s);for(const[e,t]of i)e.GetCurrentSol().SetSetPicked(t)}}};const C3$jscomp$186=self.C3,C3X$jscomp$19=self.C3X,tempRect$jscomp$11=C3$jscomp$186.New(C3$jscomp$186.Rect),tempQuad$jscomp$7=C3$jscomp$186.New(C3$jscomp$186.Quad),tempVec2$jscomp$1=C3$jscomp$186.New(C3$jscomp$186.Vector2),FLAG_PLAYING_FORWARDS=1,FLAG_ANIMATION_PLAYING=2,FLAG_ANIMATION_TRIGGER=4;C3$jscomp$186.Plugins.Sprite.Instance=class extends C3$jscomp$186.SDKWorldInstanceBase{constructor(e,t){super(e);let s=!0,i="",r=0,n=!0;t&&(s=!!t[0],i=t[1],r=t[2],n=t[3]),this._currentAnimation=this._objectClass.GetAnimationByName(i)||this._objectClass.GetAnimations()[0],this._currentFrameIndex=C3$jscomp$186.clamp(r,0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex),t=this._currentAnimationFrame.GetImageInfo(),this._currentTexture=t.GetTexture(),this._currentRcTex=t.GetTexRect(),this._currentQuadTex=t.GetTexQuad(),this.HandleRendererContextLoss(),e.SetFlag(FLAG_ANIMATION_PLAYING,!0),e.SetFlag(FLAG_PLAYING_FORWARDS,0<=this._currentAnimation.GetSpeed()),this._currentAnimationSpeed=Math.abs(this._currentAnimation.GetSpeed()),this._currentAnimationRepeatTo=this._currentAnimation.GetRepeatTo(),this._animationTimer=C3$jscomp$186.New(C3$jscomp$186.KahanSum),this._animationRepeats=this._frameStartTime=0,this._animTriggerName="",this._changeAnimFrameIndex=-1,this._changeAnimationName="",this._changeAnimationFrom=0,e=this.GetWorldInfo(),this._bquadRef=e.GetBoundingQuad(),e.SetVisible(s),e.SetCollisionEnabled(n),e.SetOriginX(this._currentAnimationFrame.GetOriginX()),e.SetOriginY(this._currentAnimationFrame.GetOriginY()),e.SetSourceCollisionPoly(this._currentAnimationFrame.GetCollisionPoly()),e.SetBboxChanged(),1===this._objectClass.GetAnimationCount()&&1===this._objectClass.GetAnimations()[0].GetFrameCount()||0===this._currentAnimationSpeed||this._StartTicking()}Release(){this._animationTimer=this._currentTexture=this._currentAnimationFrame=this._currentAnimation=null,super.Release()}GetCurrentImageInfo(){return this._currentAnimationFrame.GetImageInfo()}IsOriginalSizeKnown(){return!0}OnRendererContextLost(){this._currentTexture=null}OnRendererContextRestored(){this._UpdateCurrentTexture()}Draw(e){var t=this._currentTexture;null!==t&&(e.SetTexture(t),(t=this.GetWorldInfo()).HasMesh()?this._DrawMesh(t,e):this._DrawStandard(t,e))}_DrawStandard(e,t){let s=this._bquadRef;this._runtime.IsPixelRoundingEnabled()&&(s=e.PixelRoundQuad(s)),t.Quad4(s,this._currentQuadTex)}_DrawMesh(e,t){const s=e.GetTransformedMesh();if(e.IsMeshChanged()){e.CalculateBbox(tempRect$jscomp$11,tempQuad$jscomp$7,!1);let t=tempQuad$jscomp$7;this._runtime.IsPixelRoundingEnabled()&&(t=e.PixelRoundQuad(t)),s.CalculateTransformedMesh(e.GetSourceMesh(),t,this._currentQuadTex),e.SetMeshChanged(!1)}s.Draw(t)}GetAnimationTime(){return this._animationTimer.Get()}IsAnimationPlaying(){return this._inst.GetFlag(FLAG_ANIMATION_PLAYING)}SetAnimationPlaying(e){this._inst.SetFlag(FLAG_ANIMATION_PLAYING,e)}IsPlayingForwards(){return this._inst.GetFlag(FLAG_PLAYING_FORWARDS)}SetPlayingForwards(e){this._inst.SetFlag(FLAG_PLAYING_FORWARDS,e)}IsInAnimationTrigger(){return this._inst.GetFlag(FLAG_ANIMATION_TRIGGER)}SetInAnimationTrigger(e){this._inst.SetFlag(FLAG_ANIMATION_TRIGGER,e)}Tick(){this._changeAnimationName&&this._DoChangeAnimation(),0<=this._changeAnimFrameIndex&&this._DoChangeAnimFrame();const e=this._currentAnimationSpeed;if(this.IsAnimationPlaying()&&0!==e){var t=this._runtime.GetDt(this._inst);this._animationTimer.Add(t),t=this.GetAnimationTime();var s=this._currentAnimationFrame,i=s.GetDuration()/e;if(!(t<this._frameStartTime+i)){var r=this._currentAnimation,n=this._currentAnimationRepeatTo,a=r.GetFrameCount(),o=r.GetRepeatCount(),h=r.IsLooping(),l=r.IsPingPong();this.IsPlayingForwards()?this._currentFrameIndex++:this._currentFrameIndex--,this._frameStartTime+=i,this._currentFrameIndex>=a&&(l?(this.SetPlayingForwards(!1),this._currentFrameIndex=a-2):h?this._currentFrameIndex=n:(this._animationRepeats++,this._animationRepeats>=o?this._FinishAnimation(!1):this._currentFrameIndex=n)),0>this._currentFrameIndex&&(l?(this._currentFrameIndex=1,this.SetPlayingForwards(!0),h||(this._animationRepeats++,this._animationRepeats>=o&&this._FinishAnimation(!0))):h?this._currentFrameIndex=n:(this._animationRepeats++,this._animationRepeats>=o?this._FinishAnimation(!0):this._currentFrameIndex=n)),this._currentFrameIndex=C3$jscomp$186.clamp(this._currentFrameIndex,0,a-1),i=r.GetFrameAt(this._currentFrameIndex),t>this._frameStartTime+i.GetDuration()/e&&(this._frameStartTime=t),this._OnFrameChanged(s,i)}}else this._StopTicking()}_FinishAnimation(e){this._currentFrameIndex=e?0:this._currentAnimation.GetFrameCount()-1,this.SetAnimationPlaying(!1),this._animTriggerName=this._currentAnimation.GetName(),this.SetInAnimationTrigger(!0),this.DispatchScriptEvent("animationend",!1,{animationName:this._animTriggerName}),this.Trigger(C3$jscomp$186.Plugins.Sprite.Cnds.OnAnyAnimFinished),this.Trigger(C3$jscomp$186.Plugins.Sprite.Cnds.OnAnimFinished),this.SetInAnimationTrigger(!1),this._animationRepeats=0}_OnFrameChanged(e,t){if(e!==t){var s=this.GetWorldInfo(),i=e.GetImageInfo(),r=t.GetImageInfo(),n=i.GetWidth();i=i.GetHeight();var a=r.GetWidth(),o=r.GetHeight();n!==a&&s.SetWidth(s.GetWidth()*(a/n)),i!==o&&s.SetHeight(s.GetHeight()*(o/i)),s.SetOriginX(t.GetOriginX()),s.SetOriginY(t.GetOriginY()),s.SetSourceCollisionPoly(t.GetCollisionPoly()),s.SetBboxChanged(),this._currentAnimationFrame=t,this._currentTexture=r.GetTexture(),this._currentRcTex=r.GetTexRect(),this._currentQuadTex=r.GetTexQuad();for(let i=0,r=(s=this.GetInstance().GetBehaviorInstances()).length;i<r;++i)s[i].OnSpriteFrameChanged(e,t);this.DispatchScriptEvent("framechange",!1,{animationName:this._currentAnimation.GetName(),animationFrame:this._currentFrameIndex}),this.Trigger(C3$jscomp$186.Plugins.Sprite.Cnds.OnFrameChanged),this._runtime.UpdateRender()}}_StartAnim(e){this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime(),1===e&&0!==this._currentFrameIndex&&(this._changeAnimFrameIndex=0,this.IsInAnimationTrigger()||this._DoChangeAnimFrame()),this._StartTicking()}_SetAnim(e,t){this._changeAnimationName=e,this._changeAnimationFrom=t,this._StartTicking(),this.IsInAnimationTrigger()||this._DoChangeAnimation()}_GetCurrentAnimation(){return this._currentAnimation}_GetCurrentAnimationName(){return this._changeAnimationName?this._changeAnimationName:this._currentAnimation.GetName()}_SetAnimFrame(e){isFinite(e)&&(this._changeAnimFrameIndex=e,this.IsInAnimationTrigger()||this._DoChangeAnimFrame())}_GetAnimFrame(){return this._currentFrameIndex}_SetAnimSpeed(e){this._currentAnimationSpeed=Math.abs(e),this.SetPlayingForwards(0<=e),0<this._currentAnimationSpeed&&this._StartTicking()}_GetAnimSpeed(){return this.IsPlayingForwards()?this._currentAnimationSpeed:-this._currentAnimationSpeed}_SetAnimRepeatToFrame(e){this._currentAnimationRepeatTo=e=C3$jscomp$186.clamp(Math.floor(e),0,this._currentAnimation.GetFrameCount()-1)}_GetAnimRepeatToFrame(){return this._currentAnimationRepeatTo}_DoChangeAnimation(){const e=this._currentAnimationFrame;var t=this._objectClass.GetAnimationByName(this._changeAnimationName);this._changeAnimationName="",!t||t===this._currentAnimation&&this.IsAnimationPlaying()||(this._currentAnimation=t,this.SetPlayingForwards(0<=t.GetSpeed()),this._currentAnimationSpeed=Math.abs(t.GetSpeed()),this._currentAnimationRepeatTo=t.GetRepeatTo(),this._currentFrameIndex=C3$jscomp$186.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1),1===this._changeAnimationFrom&&(this._currentFrameIndex=0),this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime(),t=this._currentAnimation.GetFrameAt(this._currentFrameIndex),this._OnFrameChanged(e,t))}_DoChangeAnimFrame(){const e=this._currentAnimationFrame;var t=this._currentFrameIndex;this._currentFrameIndex=C3$jscomp$186.clamp(Math.floor(this._changeAnimFrameIndex),0,this._currentAnimation.GetFrameCount()-1),this._changeAnimFrameIndex=-1,t!==this._currentFrameIndex&&(t=this._currentAnimation.GetFrameAt(this._currentFrameIndex),this._OnFrameChanged(e,t),this._frameStartTime=this.GetAnimationTime())}_UpdateCurrentTexture(){const e=this._currentAnimationFrame.GetImageInfo();this._currentTexture=e.GetTexture(),this._currentRcTex=e.GetTexRect(),this._currentQuadTex=e.GetTexQuad(),this.GetWorldInfo().SetMeshChanged(!0)}GetTexture(){return this._currentTexture}GetTexRect(){return this._currentRcTex}GetTexQuad(){return this._currentQuadTex}GetImagePointCount(){return this._currentAnimationFrame.GetImagePointCount()}GetImagePoint(e){const t=this._currentAnimationFrame,s=this.GetWorldInfo();if("string"==typeof e)e=t.GetImagePointByName(e);else{if("number"!=typeof e)throw new TypeError("expected string or number");e=t.GetImagePointByIndex(e-1)}if(!e)return[s.GetX(),s.GetY()];if(tempVec2$jscomp$1.copy(e.GetVec2()),s.HasMesh()){const[e,t]=s.GetSourceMesh().TransformPoint(tempVec2$jscomp$1.getX(),tempVec2$jscomp$1.getY());tempVec2$jscomp$1.set(e,t)}return tempVec2$jscomp$1.offset(-t.GetOriginX(),-t.GetOriginY()),tempVec2$jscomp$1.scale(s.GetWidth(),s.GetHeight()),tempVec2$jscomp$1.rotate(s.GetAngle()),tempVec2$jscomp$1.offset(s.GetX(),s.GetY()),[tempVec2$jscomp$1.getX(),tempVec2$jscomp$1.getY()]}GetCollisionPolyPointCount(){return this.GetWorldInfo().GetTransformedCollisionPoly().pointCount()}GetCollisionPolyPoint(e){e=Math.floor(e);const t=this.GetWorldInfo();var s=t.GetTransformedCollisionPoly();const i=s.pointCount();return e===i&&(e=0),0>e||e>=i?[0,0]:[(s=s.pointsArr())[2*e]+t.GetX(),s[2*e+1]+t.GetY()]}GetDebuggerProperties(){const e=C3$jscomp$186.Plugins.Sprite.Acts;return[{title:"plugins.sprite.debugger.animation-properties.title",properties:[{name:"plugins.sprite.debugger.animation-properties.current-animation",value:this._currentAnimation.GetName(),onedit:t=>this.CallAction(e.SetAnim,t,0)},{name:"plugins.sprite.debugger.animation-properties.current-frame",value:this._currentFrameIndex,onedit:t=>this.CallAction(e.SetAnimFrame,t)},{name:"plugins.sprite.debugger.animation-properties.is-playing",value:this.IsAnimationPlaying(),onedit:t=>t?this.CallAction(e.StartAnim,0):this.CallAction(e.StopAnim)},{name:"plugins.sprite.debugger.animation-properties.speed",value:this._currentAnimationSpeed,onedit:t=>this.CallAction(e.SetAnimSpeed,t)},{name:"plugins.sprite.debugger.animation-properties.repeats",value:this._animationRepeats,onedit:e=>this._animationRepeats=e}]}]}SaveToJson(){const e={a:this._currentAnimation.GetSID()};0!==this._frameStartTime&&(e.fs=this._frameStartTime);var t=this.GetAnimationTime();return 0!==t&&(e.at=t),0!==this._currentFrameIndex&&(e.f=this._currentFrameIndex),0!==this._currentAnimationSpeed&&(e.cas=this._currentAnimationSpeed),1!==this._animationRepeats&&(e.ar=this._animationRepeats),0!==this._currentAnimationRepeatTo&&(e.rt=this._currentAnimationRepeatTo),this.IsAnimationPlaying()||(e.ap=this.IsAnimationPlaying()),this.IsPlayingForwards()||(e.af=this.IsPlayingForwards()),(t=this.GetWorldInfo()).IsCollisionEnabled()&&(e.ce=t.IsCollisionEnabled()),e}LoadFromJson(e){var t=this.GetObjectClass().GetAnimationBySID(e.a);t&&(this._currentAnimation=t),this._frameStartTime=e.hasOwnProperty("fs")?e.fs:0,this._animationTimer.Set(e.hasOwnProperty("at")?e.at:0),t=e.hasOwnProperty("f")?e.f:0,this._currentFrameIndex=C3$jscomp$186.clamp(t,0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationSpeed=e.hasOwnProperty("cas")?e.cas:0,this._animationRepeats=e.hasOwnProperty("ar")?e.ar:1,t=e.hasOwnProperty("rt")?e.rt:0,this._currentAnimationRepeatTo=C3$jscomp$186.clamp(t,0,this._currentAnimation.GetFrameCount()-1),this.SetAnimationPlaying(!e.hasOwnProperty("ap")||!!e.ap),this.SetPlayingForwards(!e.hasOwnProperty("af")||!!e.af),this._currentAnimationFrame=t=this._currentAnimation.GetFrameAt(this._currentFrameIndex),this._UpdateCurrentTexture();const s=this.GetWorldInfo();s.SetOriginX(t.GetOriginX()),s.SetOriginY(t.GetOriginY()),s.SetSourceCollisionPoly(t.GetCollisionPoly()),s.SetCollisionEnabled(!!e.ce),this.IsAnimationPlaying()&&this._StartTicking()}GetPropertyValueByIndex(e){const t=this.GetWorldInfo();switch(e){case 3:return t.IsCollisionEnabled();case 2:return C3$jscomp$186.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1);case 1:return this._currentAnimation.GetName()}}SetPropertyValueByIndex(e,t){var s=this.GetWorldInfo();switch(e){case 3:s.SetCollisionEnabled(!!t);break;case 2:this.SetAnimationPlaying(!1),e=this._currentAnimation.GetFrameCount()-1,s=t=C3$jscomp$186.clamp(t,0,e),t=this._currentAnimation.GetFrameAt(this._currentFrameIndex);const i=this._currentAnimation.GetFrameAt(s);this._OnFrameChanged(t,i),this._currentFrameIndex=C3$jscomp$186.clamp(s,0,e);break;case 1:this._changeAnimationName=t,this._DoChangeAnimation()}}GetScriptInterfaceClass(){return self.ISpriteInstance}};const map$jscomp$20=new WeakMap,ANIM_FROM_MODES=new Map([["current-frame",0],["beginning",1]]);self.ISpriteInstance=class extends self.IWorldInstance{constructor(){super(),map$jscomp$20.set(this,self.IInstance._GetInitInst().GetSdkInstance())}getImagePointCount(){return map$jscomp$20.get(this).GetImagePointCount()}getImagePointX(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return map$jscomp$20.get(this).GetImagePoint(e)[0]}getImagePointY(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return map$jscomp$20.get(this).GetImagePoint(e)[1]}getImagePoint(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return map$jscomp$20.get(this).GetImagePoint(e)}getPolyPointCount(){return map$jscomp$20.get(this).GetCollisionPolyPointCount()}getPolyPointX(e){return C3X$jscomp$19.RequireFiniteNumber(e),map$jscomp$20.get(this).GetCollisionPolyPoint(e)[0]}getPolyPointY(e){return C3X$jscomp$19.RequireFiniteNumber(e),map$jscomp$20.get(this).GetCollisionPolyPoint(e)[1]}getPolyPoint(e){return C3X$jscomp$19.RequireFiniteNumber(e),map$jscomp$20.get(this).GetCollisionPolyPoint(e)}stopAnimation(){map$jscomp$20.get(this).SetAnimationPlaying(!1)}startAnimation(e="current-frame"){if(C3X$jscomp$19.RequireString(e),void 0===(e=ANIM_FROM_MODES.get(e)))throw Error("invalid mode");map$jscomp$20.get(this)._StartAnim(e)}setAnimation(e,t="beginning"){if(C3X$jscomp$19.RequireString(e),C3X$jscomp$19.RequireString(t),void 0===(t=ANIM_FROM_MODES.get(t)))throw Error("invalid mode");const s=map$jscomp$20.get(this);if(!s.GetObjectClass().GetAnimationByName(e))throw Error(`animation name "${e}" does not exist`);s._SetAnim(e,t)}getAnimation(e){return C3X$jscomp$19.RequireString(e),(e=map$jscomp$20.get(this).GetObjectClass().GetAnimationByName(e))?e.GetIAnimation():null}get animation(){return map$jscomp$20.get(this)._GetCurrentAnimation().GetIAnimation()}get animationName(){return map$jscomp$20.get(this)._GetCurrentAnimationName()}set animationFrame(e){C3X$jscomp$19.RequireFiniteNumber(e),map$jscomp$20.get(this)._SetAnimFrame(e)}get animationFrame(){return map$jscomp$20.get(this)._GetAnimFrame()}set animationSpeed(e){C3X$jscomp$19.RequireFiniteNumber(e),map$jscomp$20.get(this)._SetAnimSpeed(e)}get animationSpeed(){return map$jscomp$20.get(this)._GetAnimSpeed()}set animationRepeatToFrame(e){C3X$jscomp$19.RequireFiniteNumber(e),map$jscomp$20.get(this)._SetAnimRepeatToFrame(e)}get animationRepeatToFrame(){return map$jscomp$20.get(this)._GetAnimRepeatToFrame()}get imageWidth(){return map$jscomp$20.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return map$jscomp$20.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){const e=map$jscomp$20.get(this).GetCurrentImageInfo();return[e.GetWidth(),e.GetHeight()]}setSolidCollisionFilter(e,t){C3X$jscomp$19.RequireString(t),map$jscomp$20.get(this).GetWorldInfo().SetSolidCollisionFilter(!!e,t)}};const C3$jscomp$187=self.C3;C3$jscomp$187.Plugins.Sprite.Cnds={IsAnimPlaying(e){return C3$jscomp$187.equalsNoCase(this._GetCurrentAnimationName(),e)},CompareFrame(e,t){return C3$jscomp$187.compare(this._currentFrameIndex,e,t)},CompareAnimSpeed(e,t){return C3$jscomp$187.compare(this._GetAnimSpeed(),e,t)},OnAnimFinished(e){return C3$jscomp$187.equalsNoCase(this._animTriggerName,e)},OnAnyAnimFinished:()=>!0,OnFrameChanged:()=>!0,IsMirrored(){return 0>this.GetWorldInfo().GetWidth()},IsFlipped(){return 0>this.GetWorldInfo().GetHeight()},OnURLLoaded:()=>!0,OnURLFailed:()=>!0,IsCollisionEnabled(){return this.GetWorldInfo().IsCollisionEnabled()}};const C3$jscomp$188=self.C3;C3$jscomp$188.Plugins.Sprite.Acts={Spawn(e,t,s,i){if(e&&t){var[r,n]=this.GetImagePoint(s);(s=this._runtime.CreateInstance(e,t,r,n,i))&&(i&&t.SortAndAddInstancesByZIndex(s),e.GetPlugin().IsRotatable()&&((t=s.GetWorldInfo()).SetAngle(this.GetWorldInfo().GetAngle()),t.SetBboxChanged()),(t=this._runtime.GetEventSheetManager()).BlockFlushingInstances(!0),s._TriggerOnCreatedOnSelfAndRelated(),t.BlockFlushingInstances(!1),e!==this.GetObjectClass()&&this._sdkType._SpawnPickInstance(e,s,i))}},StopAnim(){this.SetAnimationPlaying(!1)},StartAnim(e){this._StartAnim(e)},SetAnim(e,t){this._SetAnim(e,t)},SetAnimFrame(e){this._SetAnimFrame(e)},SetAnimSpeed(e){this._SetAnimSpeed(e)},SetAnimRepeatToFrame(e){this._SetAnimRepeatToFrame(e)},SetMirrored(e){const t=this.GetWorldInfo(),s=t.GetWidth();s!==(e=Math.abs(s)*(0===e?-1:1))&&(t.SetWidth(e),t.SetBboxChanged())},SetFlipped(e){const t=this.GetWorldInfo(),s=t.GetHeight();s!==(e=Math.abs(s)*(0===e?-1:1))&&(t.SetHeight(e),t.SetBboxChanged())},SetScale(e){const t=this._currentAnimationFrame.GetImageInfo(),s=this.GetWorldInfo();var i=0>s.GetWidth()?-1:1;const r=0>s.GetHeight()?-1:1;i*=t.GetWidth()*e,e=t.GetHeight()*e*r,s.GetWidth()===i&&s.GetHeight()===e||(s.SetSize(i,e),s.SetBboxChanged())},async LoadURL(e,t,s){s=this._currentAnimationFrame.GetImageInfo();const i=this.GetWorldInfo(),r=this._runtime,n=this._sdkType;if(s.GetURL()===e)0===t&&(i.SetSize(s.GetWidth(),s.GetHeight()),i.SetBboxChanged()),this.Trigger(C3$jscomp$188.Plugins.Sprite.Cnds.OnURLLoaded);else{var a=C3$jscomp$188.New(C3$jscomp$188.ImageInfo);try{if(await a.LoadDynamicAsset(r,e),!a.IsLoaded())throw Error("image failed to load");await a.LoadStaticTexture(r.GetRenderer(),{sampling:r.GetSampling()})}catch(e){return void(this.WasReleased()||this.Trigger(C3$jscomp$188.Plugins.Sprite.Cnds.OnURLFailed))}s.ReplaceWith(a),n._UpdateAllCurrentTexture(),r.UpdateRender(),this.WasReleased()||(0===t&&(i.SetSize(s.GetWidth(),s.GetHeight()),i.SetBboxChanged()),await this.TriggerAsync(C3$jscomp$188.Plugins.Sprite.Cnds.OnURLLoaded))}},SetCollisions(e){this.GetWorldInfo().SetCollisionEnabled(e)},SetSolidCollisionFilter(e,t){this.GetWorldInfo().SetSolidCollisionFilter(0===e,t)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}},self.C3.Plugins.Sprite.Exps={AnimationFrame(){return this._currentFrameIndex},AnimationFrameCount(){return this._currentAnimation.GetFrameCount()},AnimationName(){return this._currentAnimation.GetName()},AnimationSpeed(){return this._GetAnimSpeed()},OriginalAnimationSpeed(){return this._currentAnimation.GetSpeed()},ImagePointX(e){return this.GetImagePoint(e)[0]},ImagePointY(e){return this.GetImagePoint(e)[1]},ImagePointCount(){return this.GetImagePointCount()},ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},PolyPointXAt(e){return this.GetCollisionPolyPoint(e)[0]},PolyPointYAt(e){return this.GetCollisionPolyPoint(e)[1]},PolyPointCount(){return this.GetCollisionPolyPointCount()}};const C3$jscomp$190=self.C3;C3$jscomp$190.Plugins.Mouse=class extends C3$jscomp$190.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$191=self.C3,C3X$jscomp$20=self.C3X;C3$jscomp$191.Plugins.Mouse.Type=class extends C3$jscomp$191.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IMouseObjectType}};let mouseObjectType=null;function GetMouseSdkInstance(){return mouseObjectType.GetSingleGlobalInstance().GetSdkInstance()}self.IMouseObjectType=class extends self.IObjectClass{constructor(e){super(e),mouseObjectType=e,e.GetRuntime()._GetCommonScriptInterfaces().mouse=this}getMouseX(e){return GetMouseSdkInstance().GetMousePositionForLayer(e)[0]}getMouseY(e){return GetMouseSdkInstance().GetMousePositionForLayer(e)[1]}getMousePosition(e){return GetMouseSdkInstance().GetMousePositionForLayer(e)}isMouseButtonDown(e){return GetMouseSdkInstance().IsMouseButtonDown(e)}setCursorStyle(e){C3X$jscomp$20.RequireString(e),GetMouseSdkInstance().SetCursorStyle(e)}setCursorObjectClass(e){const t=GetMouseSdkInstance();e=t.GetRuntime()._UnwrapIObjectClass(e),t.SetCursorObjectClass(e)}};const C3$jscomp$192=self.C3;let lastSetCursor=null;C3$jscomp$192.Plugins.Mouse.Instance=class extends C3$jscomp$192.SDKInstanceBase{constructor(e,t){super(e,"mouse"),this._buttonMap=[!1,!1,!1],this._wheelDeltaZ=this._wheelDeltaY=this._wheelDeltaX=this._triggerDir=this._triggerType=this._triggerButton=this._mouseYcanvas=this._mouseXcanvas=0,this._hasPointerLock=!1,this._movementY=this._movementX=0,this.AddDOMMessageHandlers([["pointer-lock-change",e=>this._OnPointerLockChange(e)],["pointer-lock-error",e=>this._OnPointerLockError(e)]]),e=this.GetRuntime().Dispatcher(),this._disposables=new C3$jscomp$192.CompositeDisposable(C3$jscomp$192.Disposable.From(e,"pointermove",(e=>this._OnPointerMove(e.data))),C3$jscomp$192.Disposable.From(e,"pointerdown",(e=>this._OnPointerDown(e.data))),C3$jscomp$192.Disposable.From(e,"pointerup",(e=>this._OnPointerUp(e.data))),C3$jscomp$192.Disposable.From(e,"dblclick",(e=>this._OnDoubleClick(e.data))),C3$jscomp$192.Disposable.From(e,"wheel",(e=>this._OnMouseWheel(e.data))),C3$jscomp$192.Disposable.From(e,"window-blur",(()=>this._OnWindowBlur())))}Release(){super.Release()}_OnPointerDown(e){"mouse"===e.pointerType&&(this._mouseXcanvas=e.pageX-this._runtime.GetCanvasClientX(),this._mouseYcanvas=e.pageY-this._runtime.GetCanvasClientY(),this._CheckButtonChanges(e.lastButtons,e.buttons))}_OnPointerMove(e){this._movementX=e.movementX,this._movementY=e.movementY,this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnMovement),this._movementY=this._movementX=0,"mouse"===e.pointerType&&(this._mouseXcanvas=e.pageX-this._runtime.GetCanvasClientX(),this._mouseYcanvas=e.pageY-this._runtime.GetCanvasClientY(),this._CheckButtonChanges(e.lastButtons,e.buttons))}_OnPointerUp(e){"mouse"===e.pointerType&&this._CheckButtonChanges(e.lastButtons,e.buttons)}_CheckButtonChanges(e,t){this._CheckButtonChange(e,t,1,0),this._CheckButtonChange(e,t,4,1),this._CheckButtonChange(e,t,2,2)}_CheckButtonChange(e,t,s,i){!(e&s)&&t&s?this._OnMouseDown(i):e&s&&!(t&s)&&this._OnMouseUp(i)}_OnMouseDown(e){this._buttonMap[e]=!0,this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnAnyClick),this._triggerButton=e,this._triggerType=0,this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnClick),this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseUp(e){this._buttonMap[e]&&(this._buttonMap[e]=!1,this._triggerButton=e,this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnRelease))}_OnDoubleClick(e){this._triggerButton=e.button,this._triggerType=1,this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnClick),this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseWheel(e){this._triggerDir=0>e.deltaY?1:0,this._wheelDeltaX=e.deltaX,this._wheelDeltaY=e.deltaY,this._wheelDeltaZ=e.deltaZ,this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnWheel)}_OnWindowBlur(){for(let e=0,t=this._buttonMap.length;e<t&&this._buttonMap[e];++e)this._buttonMap[e]=!1,this._triggerButton=e,this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnRelease)}GetMousePositionForLayer(e){const t=this._runtime.GetMainRunningLayout(),s=this._mouseXcanvas,i=this._mouseYcanvas;return void 0===e?t.GetLayerByIndex(0).CanvasCssToLayer_DefaultTransform(s,i):(e=t.GetLayer(e))?e.CanvasCssToLayer(s,i):[0,0]}IsMouseButtonDown(e){return e=Math.floor(e),!!this._buttonMap[e]}_IsMouseOverCanvas(){return 0<=this._mouseXcanvas&&0<=this._mouseYcanvas&&this._mouseXcanvas<this._runtime.GetCanvasCssWidth()&&this._mouseYcanvas<this._runtime.GetCanvasCssHeight()}SetCursorStyle(e){lastSetCursor!==e&&(lastSetCursor=e,this.PostToDOM("cursor",e))}async SetCursorObjectClass(e){if(!C3$jscomp$192.Platform.IsMobile&&e){var t=e.GetFirstPicked();t&&(e=t.GetWorldInfo(),t=t.GetCurrentImageInfo(),e&&t&&lastSetCursor!==t&&(lastSetCursor=t,e=`url(${await t.ExtractImageToBlobURL()}) ${Math.round(e.GetOriginX()*t.GetWidth())} ${Math.round(e.GetOriginY()*t.GetHeight())}, auto`,this.PostToDOM("cursor",e)))}}_OnPointerLockChange(e){this._UpdatePointerLockState(e["has-pointer-lock"])}_OnPointerLockError(e){this._UpdatePointerLockState(e["has-pointer-lock"]),this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnPointerLockError)}_UpdatePointerLockState(e){this._hasPointerLock!==e&&((this._hasPointerLock=e)?this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnPointerLocked):this.Trigger(C3$jscomp$192.Plugins.Mouse.Cnds.OnPointerUnlocked))}GetDebuggerProperties(){return[{title:"plugins.mouse.name",properties:[{name:"plugins.mouse.debugger.absolute-position",value:this._mouseXcanvas+","+this._mouseYcanvas},{name:"plugins.mouse.debugger.left-button",value:this._buttonMap[0]},{name:"plugins.mouse.debugger.middle-button",value:this._buttonMap[1]},{name:"plugins.mouse.debugger.right-button",value:this._buttonMap[2]}]},{title:"plugins.mouse.debugger.position-on-each-layer",properties:this._runtime.GetMainRunningLayout().GetLayers().map((e=>({name:"$"+e.GetName(),value:e.CanvasCssToLayer(this._mouseXcanvas,this._mouseYcanvas).join(", ")})))}]}};const C3$jscomp$193=self.C3;C3$jscomp$193.Plugins.Mouse.Cnds={OnClick(e,t){return this._triggerButton===e&&this._triggerType===t},OnAnyClick:()=>!0,IsButtonDown(e){return this._buttonMap[e]},OnRelease(e){return this._triggerButton===e},IsOverObject(e){if(!this._IsMouseOverCanvas())return!1;const t=this._runtime.GetCurrentCondition().IsInverted(),s=this._mouseXcanvas,i=this._mouseYcanvas;return C3$jscomp$193.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,s,i,t),t)},OnObjectClicked(e,t,s){return!(e!==this._triggerButton||t!==this._triggerType||!this._IsMouseOverCanvas())&&(e=this._mouseXcanvas,t=this._mouseYcanvas,this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(s,e,t,!1))},OnWheel(e){return 2===e||this._triggerDir===e},OnPointerLocked:()=>!0,OnPointerUnlocked:()=>!0,OnPointerLockError:()=>!0,HasPointerLock(){return this._hasPointerLock},OnMovement:()=>!0};const CURSOR_STYLES="auto pointer text crosshair move help wait none".split(" ");self.C3.Plugins.Mouse.Acts={SetCursor(e){this.SetCursorStyle(CURSOR_STYLES[e])},SetCursorSprite(e){this.SetCursorObjectClass(e)},RequestPointerLock(){this._PostToDOMMaybeSync("request-pointer-lock")},ReleasePointerLock(){this.PostToDOM("release-pointer-lock")}},self.C3.Plugins.Mouse.Exps={X(e){return this.GetMousePositionForLayer(e)[0]},Y(e){return this.GetMousePositionForLayer(e)[1]},AbsoluteX(){return this._mouseXcanvas},AbsoluteY(){return this._mouseYcanvas},MovementX(){return this._movementX},MovementY(){return this._movementY},WheelDeltaX(){return this._wheelDeltaX},WheelDeltaY(){return this._wheelDeltaY},WheelDeltaZ(){return this._wheelDeltaZ}};const C3$jscomp$196=self.C3;C3$jscomp$196.Plugins.Keyboard=class extends C3$jscomp$196.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$197=self.C3;C3$jscomp$197.Plugins.Keyboard.Type=class extends C3$jscomp$197.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IKeyboardObjectType}};let keyboardObjectType=null;function GetKeyboardSdkInstance(){return keyboardObjectType.GetSingleGlobalInstance().GetSdkInstance()}self.IKeyboardObjectType=class extends self.IObjectClass{constructor(e){super(e),keyboardObjectType=e,e.GetRuntime()._GetCommonScriptInterfaces().keyboard=this}isKeyDown(e){const t=GetKeyboardSdkInstance();if("string"==typeof e)return t.IsKeyDown(e);if("number"==typeof e)return t.IsKeyCodeDown(e);throw new TypeError("expected string or number")}};const C3$jscomp$198=self.C3;C3$jscomp$198.Plugins.Keyboard.Instance=class extends C3$jscomp$198.SDKInstanceBase{constructor(e,t){super(e),this._keysDownByString=new Set,this._keysDownByWhich=new Set,this._triggerWhich=0,this._triggerTypedKey=this._triggerString="",e=this.GetRuntime().Dispatcher(),this._disposables=new C3$jscomp$198.CompositeDisposable(C3$jscomp$198.Disposable.From(e,"keydown",(e=>this._OnKeyDown(e.data))),C3$jscomp$198.Disposable.From(e,"keyup",(e=>this._OnKeyUp(e.data))),C3$jscomp$198.Disposable.From(e,"window-blur",(()=>this._OnWindowOrKeyboardBlur())),C3$jscomp$198.Disposable.From(e,"keyboard-blur",(()=>this._OnWindowOrKeyboardBlur())))}Release(){super.Release()}_OnKeyDown(e){const t=e.which,s=e.code||t.toString();e=e.key,this._keysDownByString.has(s)||(this._keysDownByString.add(s),this._keysDownByWhich.add(t),this._triggerString=s,this._triggerWhich=t,this._triggerTypedKey=e,this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnAnyKey),this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnKey),this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnLeftRightKeyPressed),this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnKeyCode))}_OnKeyUp(e){const t=e.which,s=e.code||t.toString();e=e.key,this._keysDownByString.delete(s),this._keysDownByWhich.delete(t),this._triggerString=s,this._triggerWhich=t,this._triggerTypedKey=e,this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnAnyKeyReleased),this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnKeyReleased),this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnLeftRightKeyReleased),this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnKeyCodeReleased)}_OnWindowOrKeyboardBlur(){for(const e of this._keysDownByWhich)this._keysDownByWhich.delete(e),this._triggerWhich=e,this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnAnyKeyReleased),this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnKeyReleased),this.Trigger(C3$jscomp$198.Plugins.Keyboard.Cnds.OnKeyCodeReleased);this._keysDownByString.clear()}IsKeyDown(e){return this._keysDownByString.has(e)}IsKeyCodeDown(e){return this._keysDownByWhich.has(e)}SaveToJson(){return{tk:this._triggerWhich,tkk:this._triggerTypedKey}}LoadFromJson(e){this._triggerWhich=e.tk,e.hasOwnProperty("tkk")&&(this._triggerTypedKey=e.tkk)}GetDebuggerProperties(){return[{title:"plugins.keyboard.name",properties:[{name:"plugins.keyboard.debugger.last-key-code",value:this._triggerWhich},{name:"plugins.keyboard.debugger.last-key-string",value:C3$jscomp$198.Plugins.Keyboard.Exps.StringFromKeyCode(this._triggerWhich)},{name:"plugins.keyboard.debugger.last-typed-key",value:this._triggerTypedKey}]}]}};const LEFTRIGHT_KEY_STRINGS="ShiftLeft ShiftRight ControlLeft ControlRight AltLeft AltRight MetaLeft MetaRight".split(" ");function StringFromCharCode(e){switch(e=Math.floor(e)){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"";case 38:return"";case 39:return"";case 40:return"";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(e)}}self.C3.Plugins.Keyboard.Cnds={IsKeyDown(e){return this._keysDownByWhich.has(e)},OnKey(e){return this._triggerWhich===e},OnAnyKey:()=>!0,OnAnyKeyReleased:()=>!0,OnKeyReleased(e){return this._triggerWhich===e},IsKeyCodeDown(e){return e=Math.floor(e),this._keysDownByWhich.has(e)},OnKeyCode(e){return this._triggerWhich===e},OnKeyCodeReleased(e){return this._triggerWhich===e},OnLeftRightKeyPressed(e){return this._triggerString===LEFTRIGHT_KEY_STRINGS[e]},OnLeftRightKeyReleased(e){return this._triggerString===LEFTRIGHT_KEY_STRINGS[e]},IsLeftRightKeyDown(e){return this._keysDownByString.has(LEFTRIGHT_KEY_STRINGS[e])}},self.C3.Plugins.Keyboard.Acts={},self.C3.Plugins.Keyboard.Exps={LastKeyCode(){return this._triggerWhich},StringFromKeyCode:e=>StringFromCharCode(e),TypedKey(){return this._triggerTypedKey}};const C3$jscomp$202=self.C3;C3$jscomp$202.Plugins.Text=class extends C3$jscomp$202.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$203=self.C3;C3$jscomp$203.Plugins.Text.Type=class extends C3$jscomp$203.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}LoadTextures(e){}ReleaseTextures(){}};const C3$jscomp$204=self.C3,C3X$jscomp$22=self.C3X,TEMP_COLOR_ARRAY$jscomp$1=[0,0,0],HORIZONTAL_ALIGNMENTS=["left","center","right"],VERTICAL_ALIGNMENTS=["top","center","bottom"],tempRect$jscomp$12=new C3$jscomp$204.Rect,tempQuad$jscomp$8=new C3$jscomp$204.Quad,tempColor$jscomp$8=new C3$jscomp$204.Color;C3$jscomp$204.Plugins.Text.Instance=class extends C3$jscomp$204.SDKWorldInstanceBase{constructor(e,t){super(e),this._text="",this._enableBBcode=!0,this._faceName="Arial",this._ptSize=12,this._lineHeightOffset=0,this._isItalic=this._isBold=!1,this._color=C3$jscomp$204.New(C3$jscomp$204.Color),this._verticalAlign=this._horizontalAlign=0,this._wrapByWord=!0,this._readAloud=!1,this._screenReaderText=null,this._typewriterEndTime=this._typewriterStartTime=-1,this._typewriterLength=0,this._rendererText=C3$jscomp$204.New(C3$jscomp$204.Gfx.RendererText,this._runtime.GetRenderer(),{timeout:5}),this._rendererText.ontextureupdate=()=>this._runtime.UpdateRender(),this._rendererText.SetIsAsync(!1),t&&(this._text=t[0],this._enableBBcode=!!t[1],this._faceName=t[2],this._ptSize=t[3],this._lineHeightOffset=t[4],this._isBold=!!t[5],this._isItalic=!!t[6],this._horizontalAlign=t[8],this._verticalAlign=t[9],this._wrapByWord=0===t[10],e=t[7],this._color.setRgb(e[0],e[1],e[2]),this.GetWorldInfo().SetVisible(t[11]),this._readAloud=!!t[13]),this._UpdateTextSettings(),this._UpdateScreenReaderText()}Release(){this._CancelTypewriter(),this._screenReaderText&&(this._screenReaderText.Release(),this._screenReaderText=null),this._rendererText.Release(),this._rendererText=null,super.Release()}_UpdateTextSettings(){const e=this._rendererText;e.SetText(this._text),e.SetBBCodeEnabled(this._enableBBcode),e.SetFontName(this._faceName),e.SetLineHeight(this._lineHeightOffset),e.SetBold(this._isBold),e.SetItalic(this._isItalic),e.SetColor(this._color),e.SetHorizontalAlignment(HORIZONTAL_ALIGNMENTS[this._horizontalAlign]),e.SetVerticalAlignment(VERTICAL_ALIGNMENTS[this._verticalAlign]),e.SetWordWrapMode(this._wrapByWord?"word":"character")}_UpdateTextSize(){const e=this.GetWorldInfo();this._rendererText.SetFontSize(this._ptSize),this._rendererText.SetFontSizeScale(e.GetSceneGraphScale());var t=e.GetLayer();t=t.GetRenderScale()*t.Get2DScaleFactorToZ(e.GetTotalZElevation()),this._rendererText.SetSize(e.GetWidth(),e.GetHeight(),t)}_UpdateScreenReaderText(){if(this._readAloud){let e=this._text;this._enableBBcode&&(e=C3$jscomp$204.BBString.StripAnyTags(e)),this._screenReaderText?this._screenReaderText.SetText(e):this._screenReaderText=C3$jscomp$204.New(C3$jscomp$204.ScreenReaderText,this._runtime,e)}else this._screenReaderText&&(this._screenReaderText.Release(),this._screenReaderText=null)}Draw(e){var t=this.GetWorldInfo();this._UpdateTextSize();const s=this._rendererText.GetTexture();if(s){var i=t.GetLayer();if(0===t.GetAngle()&&0===i.GetAngle()&&0===t.GetTotalZElevation()&&!t.HasMesh()&&i.RendersIn2DMode()){t=t.GetBoundingQuad();const[r,n]=i.LayerToDrawSurface(t.getTlx(),t.getTly()),[a,o]=i.LayerToDrawSurface(t.getBrx(),t.getBry());t=r-Math.round(r);const h=n-Math.round(n);tempRect$jscomp$12.set(r,n,a,o),tempRect$jscomp$12.offset(-t,-h),tempQuad$jscomp$8.setFromRect(tempRect$jscomp$12);const[l,c]=e.GetRenderTargetSize(e.GetRenderTarget());this._runtime.GetCanvasManager().SetDeviceTransform(e,l,c),e.SetTexture(s),e.Quad3(tempQuad$jscomp$8,this._rendererText.GetTexRect()),i._SetTransform(e)}else e.SetTexture(s),t.HasMesh()?this._DrawMesh(t,e):this._DrawStandard(t,e)}}_DrawStandard(e,t){e=e.GetBoundingQuad(),this._runtime.IsPixelRoundingEnabled()&&(e=this._PixelRoundQuad(e)),t.Quad3(e,this._rendererText.GetTexRect())}_DrawMesh(e,t){const s=e.GetTransformedMesh();if(e.IsMeshChanged()){e.CalculateBbox(tempRect$jscomp$12,tempQuad$jscomp$8,!1);let t=tempQuad$jscomp$8;this._runtime.IsPixelRoundingEnabled()&&(t=this._PixelRoundQuad(t)),s.CalculateTransformedMesh(e.GetSourceMesh(),t,this._rendererText.GetTexRect()),e.SetMeshChanged(!1)}s.Draw(t)}_PixelRoundQuad(e){const t=e.getTlx()-Math.round(e.getTlx()),s=e.getTly()-Math.round(e.getTly());return 0===t&&0===s?e:(tempQuad$jscomp$8.copy(e),tempQuad$jscomp$8.offset(-t,-s),tempQuad$jscomp$8)}GetCurrentSurfaceSize(){const e=this._rendererText.GetTexture();return e?[e.GetWidth(),e.GetHeight()]:[100,100]}GetCurrentTexRect(){return this._rendererText.GetTexRect()}IsCurrentTexRotated(){return!1}SaveToJson(){const e={t:this._text,c:this._color.toJSON(),fn:this._faceName,ps:this._ptSize};return this._enableBBcode&&(e.bbc=this._enableBBcode),0!==this._horizontalAlign&&(e.ha=this._horizontalAlign),0!==this._verticalAlign&&(e.va=this._verticalAlign),this._wrapByWord||(e.wr=this._wrapByWord),0!==this._lineHeightOffset&&(e.lho=this._lineHeightOffset),this._isBold&&(e.b=this._isBold),this._isItalic&&(e.i=this._isItalic),-1!==this._typewriterEndTime&&(e.tw={st:this._typewriterStartTime,en:this._typewriterEndTime,l:this._typewriterLength}),e}LoadFromJson(e){this._CancelTypewriter(),this._text=e.t,this._color.setFromJSON(e.c),this._faceName=e.fn,this._ptSize=e.ps,this._enableBBcode=!!e.hasOwnProperty("bbc")&&e.bbc,this._horizontalAlign=e.hasOwnProperty("ha")?e.ha:0,this._verticalAlign=e.hasOwnProperty("va")?e.va:0,this._wrapByWord=!e.hasOwnProperty("wr")||e.wr,this._lineHeightOffset=e.hasOwnProperty("lho")?e.lho:0,this._isBold=!!e.hasOwnProperty("b")&&e.b,this._isItalic=!!e.hasOwnProperty("i")&&e.i,e.hasOwnProperty("tw")&&(e=e.tw,this._typewriterStartTime=e.st,this._typewriterEndTime=e.en,this._typewriterLength=e.l),this._UpdateTextSettings(),this._UpdateScreenReaderText(),-1!==this._typewriterEndTime&&this._StartTicking()}GetPropertyValueByIndex(e){switch(e){case 0:return this.GetText();case 1:return this._enableBBcode;case 2:return this._GetFontFace();case 3:return this._GetFontSize();case 4:return this._GetLineHeight();case 5:return this._IsBold();case 6:return this._IsItalic();case 7:return TEMP_COLOR_ARRAY$jscomp$1[0]=this._color.getR(),TEMP_COLOR_ARRAY$jscomp$1[1]=this._color.getG(),TEMP_COLOR_ARRAY$jscomp$1[2]=this._color.getB(),TEMP_COLOR_ARRAY$jscomp$1;case 8:return this._GetHAlign();case 9:return this._GetVAlign();case 10:return this._IsWrapByWord()?1:0;case 13:return this._IsReadAloud()}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._SetText(t);break;case 1:if(this._enableBBcode===!!t)break;this._enableBBcode=!!t,this._UpdateTextSettings();break;case 2:this._SetFontFace(t);break;case 3:this._SetFontSize(t);break;case 4:this._SetLineHeight(t);break;case 5:this._SetBold(t);break;case 6:this._SetItalic(t);break;case 7:if((e=this._color).getR()===t[0]&&e.getG()===t[1]&&e.getB()===t[2])break;this._color.setRgb(t[0],t[1],t[2]),this._UpdateTextSettings();break;case 8:this._SetHAlign(t);break;case 9:this._SetVAlign(t);break;case 10:this._SetWrapByWord(0===t)}}SetPropertyColorOffsetValueByIndex(e,t,s,i){if(0!==t||0!==s||0!==i)switch(e){case 7:this._color.addRgb(t,s,i),this._UpdateTextSettings()}}_SetText(e){this._text!==e&&(this._text=e,this._rendererText.SetText(e),this._UpdateScreenReaderText(),this._runtime.UpdateRender())}GetText(){return this._text}_StartTypewriter(e,t){this._SetText(e),this._typewriterStartTime=this._runtime.GetWallTime(),this._typewriterEndTime=this._typewriterStartTime+t/this.GetInstance().GetActiveTimeScale(),this._typewriterLength=C3$jscomp$204.CountGraphemes(C3$jscomp$204.BBString.StripAnyTags(e)),this._rendererText.SetDrawMaxCharacterCount(0),this._StartTicking()}_CancelTypewriter(){this._typewriterEndTime=this._typewriterStartTime=-1,this._typewriterLength=0,this._rendererText.SetDrawMaxCharacterCount(-1),this._StopTicking()}_FinishTypewriter(){-1!==this._typewriterEndTime&&(this._CancelTypewriter(),this.Trigger(C3$jscomp$204.Plugins.Text.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender())}_SetFontFace(e){this._faceName!==e&&(this._faceName=e,this._rendererText.SetFontName(e),this._runtime.UpdateRender())}_GetFontFace(){return this._faceName}_SetBold(e){e=!!e,this._isBold!==e&&(this._isBold=e,this._rendererText.SetBold(e),this._runtime.UpdateRender())}_IsBold(){return this._isBold}_SetItalic(e){e=!!e,this._isItalic!==e&&(this._isItalic=e,this._rendererText.SetItalic(e),this._runtime.UpdateRender())}_IsItalic(){return this._isItalic}_SetFontSize(e){this._ptSize!==e&&(this._ptSize=e,this._runtime.UpdateRender())}_GetFontSize(){return this._ptSize}_SetFontColor(e){this._color.equalsIgnoringAlpha(e)||(this._color.copyRgb(e),this._rendererText.SetColor(this._color),this._runtime.UpdateRender())}_GetFontColor(){return this._color}_SetLineHeight(e){this._lineHeightOffset!==e&&(this._lineHeightOffset=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetLineHeight(){return this._lineHeightOffset}_SetHAlign(e){this._horizontalAlign!==e&&(this._horizontalAlign=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetHAlign(){return this._horizontalAlign}_SetVAlign(e){this._verticalAlign!==e&&(this._verticalAlign=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetVAlign(){return this._verticalAlign}_SetWrapByWord(e){e=!!e,this._wrapByWord!==e&&(this._wrapByWord=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_IsWrapByWord(){return this._wrapByWord}_SetReadAloud(e){this._readAloud=!!e,this._UpdateScreenReaderText()}_IsReadAloud(){return this._readAloud}_GetTextWidth(){return this._UpdateTextSize(),this._rendererText.GetTextWidth()}_GetTextHeight(){return this._UpdateTextSize(),this._rendererText.GetTextHeight()}Tick(){var e=this._runtime.GetWallTime();e>=this._typewriterEndTime?(this._CancelTypewriter(),this.Trigger(C3$jscomp$204.Plugins.Text.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender()):(e=C3$jscomp$204.relerp(this._typewriterStartTime,this._typewriterEndTime,e,0,this._typewriterLength),(e=Math.floor(e))!==this._rendererText.GetDrawMaxCharacterCount()&&(this._rendererText.SetDrawMaxCharacterCount(e),this._runtime.UpdateRender()))}GetDebuggerProperties(){return[{title:"plugins.text.name",properties:[{name:"plugins.text.properties.text.name",value:this.GetText(),onedit:e=>this._SetText(e)},{name:"plugins.text.properties.font.name",value:this._GetFontFace(),onedit:e=>this._SetFontFace(e)},{name:"plugins.text.properties.size.name",value:this._GetFontSize(),onedit:e=>this._SetFontSize(e)},{name:"plugins.text.properties.line-height.name",value:this._GetLineHeight(),onedit:e=>this._SetLineHeight(e)},{name:"plugins.text.properties.bold.name",value:this._IsBold(),onedit:e=>this._SetBold(e)},{name:"plugins.text.properties.italic.name",value:this._IsItalic(),onedit:e=>this._SetItalic(e)}]}]}GetScriptInterfaceClass(){return self.ITextInstance}};const map$jscomp$21=new WeakMap,SCRIPT_HORIZONTAL_ALIGNMENTS=new Map([["left",0],["center",1],["right",2]]),SCRIPT_VERTICAL_ALIGNMENTS=new Map([["top",0],["center",1],["bottom",2]]),SCRIPT_WRAP_MODES=new Map([["word",!0],["character",!1]]);self.ITextInstance=class extends self.IWorldInstance{constructor(){super(),map$jscomp$21.set(this,self.IInstance._GetInitInst().GetSdkInstance())}get text(){return map$jscomp$21.get(this).GetText()}set text(e){C3X$jscomp$22.RequireString(e);const t=map$jscomp$21.get(this);t._CancelTypewriter(),t._SetText(e)}typewriterText(e,t){C3X$jscomp$22.RequireString(e),C3X$jscomp$22.RequireFiniteNumber(t);const s=map$jscomp$21.get(this);s._CancelTypewriter(),s._StartTypewriter(e,t)}typewriterFinish(){map$jscomp$21.get(this)._FinishTypewriter()}set fontFace(e){C3X$jscomp$22.RequireString(e),map$jscomp$21.get(this)._SetFontFace(e)}get fontFace(){return map$jscomp$21.get(this)._GetFontFace()}set isBold(e){map$jscomp$21.get(this)._SetBold(e)}get isBold(){return map$jscomp$21.get(this)._IsBold()}set isItalic(e){map$jscomp$21.get(this)._SetItalic(e)}get isItalic(){return map$jscomp$21.get(this)._IsItalic()}set sizePt(e){C3X$jscomp$22.RequireFiniteNumber(e),map$jscomp$21.get(this)._SetFontSize(e)}get sizePt(){return map$jscomp$21.get(this)._GetFontSize()}set fontColor(e){if(C3X$jscomp$22.RequireArray(e),3>e.length)throw Error("expected 3 elements");tempColor$jscomp$8.setRgb(e[0],e[1],e[2]),map$jscomp$21.get(this)._SetFontColor(tempColor$jscomp$8)}get fontColor(){const e=map$jscomp$21.get(this)._GetFontColor();return[e.getR(),e.getG(),e.getB()]}set lineHeight(e){C3X$jscomp$22.RequireFiniteNumber(e),map$jscomp$21.get(this)._SetLineHeight(e)}get lineHeight(){return map$jscomp$21.get(this)._GetLineHeight()}set horizontalAlign(e){if(C3X$jscomp$22.RequireString(e),void 0===(e=SCRIPT_HORIZONTAL_ALIGNMENTS.get(e)))throw Error("invalid mode");map$jscomp$21.get(this)._SetHAlign(e)}get horizontalAlign(){return HORIZONTAL_ALIGNMENTS[map$jscomp$21.get(this)._GetHAlign()]}set verticalAlign(e){if(C3X$jscomp$22.RequireString(e),void 0===(e=SCRIPT_VERTICAL_ALIGNMENTS.get(e)))throw Error("invalid mode");map$jscomp$21.get(this)._SetVAlign(e)}get verticalAlign(){return VERTICAL_ALIGNMENTS[map$jscomp$21.get(this)._GetVAlign()]}set wordWrapMode(e){if(C3X$jscomp$22.RequireString(e),void 0===(e=SCRIPT_WRAP_MODES.get(e)))throw Error("invalid mode");map$jscomp$21.get(this)._SetWrapByWord(e)}get wordWrapMode(){return map$jscomp$21.get(this)._IsWrapByWord()?"word":"character"}set readAloud(e){map$jscomp$21.get(this)._SetReadAloud(!!e)}get readAloud(){return map$jscomp$21.get(this)._IsReadAloud()}get textWidth(){return map$jscomp$21.get(this)._GetTextWidth()}get textHeight(){return map$jscomp$21.get(this)._GetTextHeight()}getTextSize(){const e=map$jscomp$21.get(this);return[e._GetTextWidth(),e._GetTextHeight()]}};const C3$jscomp$205=self.C3;C3$jscomp$205.Plugins.Text.Cnds={CompareText(e,t){return t?this._text===e:C3$jscomp$205.equalsNoCase(this._text,e)},IsRunningTypewriterText(){return-1!==this._typewriterEndTime},OnTypewriterTextFinished:()=>!0};const C3$jscomp$206=self.C3,tempColor$jscomp$9=C3$jscomp$206.New(C3$jscomp$206.Color);C3$jscomp$206.Plugins.Text.Acts={SetText(e){this._CancelTypewriter(),"number"==typeof e&&1e9>e&&(e=Math.round(1e10*e)/1e10),this._SetText(e.toString())},AppendText(e){this._CancelTypewriter(),"number"==typeof e&&1e9>e&&(e=Math.round(1e10*e)/1e10),(e=e.toString())&&this._SetText(this._text+e)},TypewriterText(e,t){this._CancelTypewriter(),"number"==typeof e&&1e9>e&&(e=Math.round(1e10*e)/1e10),this._StartTypewriter(e.toString(),t)},SetFontFace(e,t){let s=!1,i=!1;switch(t){case 1:s=!0;break;case 2:i=!0;break;case 3:i=s=!0}e===this._faceName&&s===this._isBold&&i===this._isItalic||(this._SetFontFace(e),this._SetBold(s),this._SetItalic(i))},SetFontSize(e){this._SetFontSize(e)},SetFontColor(e){tempColor$jscomp$9.setFromRgbValue(e),tempColor$jscomp$9.clamp(),this._SetFontColor(tempColor$jscomp$9)},SetWebFont(e,t){},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},TypewriterFinish(){this._FinishTypewriter()},SetLineHeight(e){this._SetLineHeight(e)},SetHAlign(e){this._SetHAlign(e)},SetVAlign(e){this._SetVAlign(e)},SetWrapping(e){this._SetWrapByWord(0===e)},SetReadAloud(e){this._SetReadAloud(e)}};const C3$jscomp$207=self.C3;C3$jscomp$207.Plugins.Text.Exps={Text(){return this._text},PlainText(){return this._enableBBcode?C3$jscomp$207.BBString.StripAnyTags(this._text):this._text},FaceName(){return this._faceName},FaceSize(){return this._ptSize},TextWidth(){return this._GetTextWidth()},TextHeight(){return this._GetTextHeight()},LineHeight(){return this._lineHeightOffset}};const C3$jscomp$208=self.C3;C3$jscomp$208.Plugins.Particles=class extends C3$jscomp$208.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$209=self.C3;C3$jscomp$209.Plugins.Particles.Type=class extends C3$jscomp$209.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling()})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}};const C3$jscomp$210=self.C3,C3X$jscomp$23=self.C3X,tempRect$jscomp$13=C3$jscomp$210.New(C3$jscomp$210.Rect);C3$jscomp$210.Plugins.Particles.Instance=class extends C3$jscomp$210.SDKWorldInstanceBase{constructor(e,t){super(e),this._isFirstTick=!0,this._particleEngine=e=C3$jscomp$210.New(self.ParticleEngine),e.ononeshotfinish=()=>this._OnOneShotFinish(),this._spawnObjectClass=null,this._particleUpdateCallback=(e,t,s,i,r,n)=>this._OnParticleUpdate(e,t,s,i,r,n),this._particleDestroyCallback=e=>this._OnParticleDestroy(e),this._hasAnyDefaultParticle=!0,t&&(e.SetRate(t[0]),e.SetSprayCone(C3$jscomp$210.toRadians(t[1])),e.SetSprayType(t[2]?"one-shot":"continuous-spray"),this._SetParticleObjectClass(this._runtime.GetObjectClassBySID(t[3])),e.SetInitSpeed(t[4]),e.SetInitSize(t[5]),e.SetInitOpacity(t[6]/100),e.SetGrowRate(t[7]),e.SetInitXRandom(t[8]),e.SetInitYRandom(t[9]),e.SetInitSpeedRandom(t[10]),e.SetInitSizeRandom(t[11]),e.SetGrowRandom(t[12]),e.SetAcceleration(t[13]),e.SetGravity(t[14]),e.SetLifeAngleRandom(t[15]),e.SetLifeSpeedRandom(t[16]),e.SetLifeOpacityRandom(t[17]),e.SetDestroyModeIndex(t[18]),e.SetTimeout(t[19])),this._UpdateEngineParameters(),this._spawnObjectClass&&(this._hasAnyDefaultParticle=!1),"one-shot"===e.GetSprayType()?e.CreateOneShotSpray():e.SetSpraying(!0);const s=this.GetWorldInfo();s.SetBboxChangeEventEnabled(!0),this._inst.Dispatcher().addEventListener("bboxchange",(()=>{s.OverwriteBoundingBox(this._particleEngine.GetBoundingBox())})),this.GetRuntime().GetRenderer().IsWebGPU()&&s.SetUsePointsShaderProgram(),this._afterLoad=e=>this._OnAfterLoad(e),this.GetRuntime().Dispatcher().addEventListener("afterload",this._afterLoad),this._StartTicking()}Release(){this.GetRuntime().Dispatcher().removeEventListener("afterload",this._afterLoad),this._afterLoad=null,this._particleEngine.Release(),this._particleDestroyCallback=this._particleUpdateCallback=this._particleEngine=null,super.Release()}GetParticleEngine(){return this._particleEngine}_SetRate(e){this._particleEngine.SetRate(e),"one-shot"===this._particleEngine.GetSprayType()&&this._isFirstTick&&this._particleEngine.SetParticleCount(e)}_SetParticleObjectClass(e){e===this.GetObjectClass()&&(e=null),e!==this._spawnObjectClass&&(this._spawnObjectClass=e,this._particleEngine.onparticlecreate=e?e=>this._OnParticleCreate(e):null,this._spawnObjectClass||(this._hasAnyDefaultParticle=!0))}_UpdateEngineParameters(){const e=this._particleEngine,t=this.GetWorldInfo();e.SetMasterOpacity(t.GetOpacity()),e.SetPixelRounding(this._runtime.IsPixelRoundingEnabled()),e.SetSpawnX(t.GetX()),e.SetSpawnY(t.GetY()),e.SetSpawnAngle(t.GetAngle()),e.SetInitSizeScale(Math.abs(t.GetSceneGraphScale()))}_OnOneShotFinish(){this._runtime.DestroyInstance(this._inst)}Draw(e){if(this._hasAnyDefaultParticle){var t=this._objectClass.GetImageInfo(),s=t.GetTexture();if(s){var i=this.GetWorldInfo(),r=i.GetLayer();this._runtime.GetCanvasManager().IsPastingToDrawingCanvas()?tempRect$jscomp$13.set(-1/0,-1/0,1/0,1/0):r.Has3DCamera()?r.CalculateViewport3D(i.GetTotalZElevation(),tempRect$jscomp$13):r.GetViewportForZ(i.GetTotalZElevation(),tempRect$jscomp$13),e.SetTexture(s),s=r.Get2DScaleFactorToZ(i.GetTotalZElevation()),this._particleEngine.SetParticleScale(r.GetRenderScale()*s),this._particleEngine.Draw(e,t.GetTexRect(),tempRect$jscomp$13,r.Has3DCamera())}}}SaveToJson(){const e=this._particleEngine;return{r:e.GetRate(),sc:e.GetSprayCone(),st:e.GetSprayType(),isp:e.GetInitSpeed(),isz:e.GetInitSize(),io:e.GetInitOpacity(),gr:e.GetGrowRate(),xr:e.GetInitXRandom(),yr:e.GetInitYRandom(),spr:e.GetInitSpeedRandom(),szr:e.GetInitSizeRandom(),grnd:e.GetGrowRandom(),acc:e.GetAcceleration(),g:e.GetGravity(),lar:e.GetLifeAngleRandom(),lsr:e.GetLifeSpeedRandom(),lor:e.GetLifeOpacityRandom(),dm:e.GetDestroyModeIndex(),to:e.GetTimeout(),s:e.IsSpraying(),pcc:e._GetCreateCounter(),ft:this._isFirstTick,soc:this._spawnObjectClass?this._spawnObjectClass.GetSID():null,p:e.GetParticles().map((e=>e.toJSON()))}}LoadFromJson(e,t){const s=this._particleEngine;if(s.SetRate(e.r),s.SetSprayCone(e.sc),s.SetSprayType(e.st),s.SetInitSpeed(e.isp),s.SetInitSize(e.isz),s.SetInitOpacity(e.io),s.SetGrowRate(e.gr),s.SetInitXRandom(e.xr),s.SetInitYRandom(e.yr),s.SetInitSpeedRandom(e.spr),s.SetInitSizeRandom(e.szr),s.SetGrowRandom(e.grnd),s.SetAcceleration(e.acc),s.SetGravity(e.g),s.SetLifeAngleRandom(e.lar),s.SetLifeSpeedRandom(e.lsr),s.SetLifeOpacityRandom(e.lor),s.SetDestroyModeIndex(e.dm),s.SetTimeout(e.to),s.SetSpraying(e.s),s._SetCreateCounter(e.pcc),this._isFirstTick=e.ft,e.hasOwnProperty("soc")){var i=this.GetRuntime().GetObjectClassBySID(e.soc);i&&this._SetParticleObjectClass(i)}e=e.p,s.SetParticleCount(e.length);for(let t=0,r=(i=s.GetParticles()).length;t<r;++t)i[t].setFromJSON(e[t]);"state"===t&&this._spawnObjectClass&&(s.UpdateAllParticlesUserData(),s.ApplyParticleDataToUserData(this))}_OnAfterLoad(){var e=this._particleEngine;if(e.UpdateAllParticlesUserData(),e.ApplyParticleDataToUserData(this),"one-shot"===e.GetSprayType())for(let i=0,r=(e=e.GetParticles()).length;i<r;++i){var t=e[i],s=t.GetUserData();s&&(s=s.GetWorldInfo())&&(s=s.GetInstance())&&(t=t.GetUserDataUID(),s=s.GetUID(),"number"!=typeof t||"number"!=typeof s||t!==s)&&((t=(s=this.GetRuntime()).GetInstanceByUID(t))&&s.DestroyInstance(t))}}Tick(){const e=this._runtime.GetDt(this._inst);this._UpdateEngineParameters(),this._isFirstTick&&"one-shot"===this._particleEngine.GetSprayType()&&this._particleEngine.ReInitAllParticles(),this._particleEngine.Tick(e),this._particleEngine.IsSpraying()&&this._runtime.UpdateRender(),this.GetWorldInfo().SetBboxChanged(),this._isFirstTick=!1}_OnParticleCreate(e){const t=this._runtime.CreateInstance(this._spawnObjectClass,this.GetWorldInfo().GetLayer(),e.GetX(),e.GetY()),s=t.GetWorldInfo();return s.SetSize(e.GetSize(),e.GetSize()),s.SetAngle(e.GetAngle()),s.SetOpacity(e.GetOpacity()),s.SetUnpremultipliedColor(this.GetWorldInfo().GetUnpremultipliedColor()),s.SetBboxChanged(),s.ZOrderMoveAdjacentToInstance(this.GetInstance(),!0),t._TriggerOnCreated(),e.SetUpdateCallback(this._particleUpdateCallback),e.SetDestroyCallback(this._particleDestroyCallback),t}_OnParticleUpdate(e,t,s,i,r,n){e.IsDestroyed()||((e=e.GetWorldInfo()).OffsetXY(t,s),e.SetSize(e.GetWidth()+i,e.GetHeight()+i),e.SetAngle(e.GetAngle()+r),e.SetOpacity(e.GetOpacity()+n),e.SetBboxChanged())}_OnParticleDestroy(e){e.IsDestroyed()||this._runtime.DestroyInstance(e)}GetPropertyValueByIndex(e){const t=this._particleEngine;switch(e){case 0:return t.GetRate();case 1:return C3$jscomp$210.toDegrees(t.GetSprayCone());case 2:return"one-shot"===t.GetSprayType()?1:0;case 4:return t.GetInitSpeed();case 5:return t.GetInitSize();case 6:return 100*t.GetInitOpacity();case 7:return t.GetGrowRate();case 8:return t.GetInitXRandom();case 9:return t.GetInitYRandom();case 10:return t.GetInitSpeedRandom();case 11:return t.GetInitSizeRandom();case 12:return t.GetGrowRandom();case 13:return t.GetAcceleration();case 14:return t.GetGravity();case 15:return t.GetLifeAngleRandom();case 16:return t.GetLifeSpeedRandom();case 17:return t.GetLifeOpacityRandom();case 18:return t.GetDestroyModeIndex();case 19:return t.GetTimeout()}}SetPropertyValueByIndex(e,t){const s=this._particleEngine;switch(e){case 0:s.SetRate(t);break;case 1:s.SetSprayCone(C3$jscomp$210.toRadians(t));break;case 2:s.SetSprayType(t?"one-shot":"continuous-spray");break;case 4:s.SetInitSpeed(t);break;case 5:s.SetInitSize(t);break;case 6:s.SetInitOpacity(t/100);break;case 7:s.SetGrowRate(t);break;case 8:s.SetInitXRandom(t);break;case 9:s.SetInitYRandom(t);break;case 10:s.SetInitSpeedRandom(t);break;case 11:s.SetInitSizeRandom(t);break;case 12:s.SetGrowRandom(t);break;case 13:s.SetAcceleration(t);break;case 14:s.SetGravity(t);break;case 15:s.SetLifeAngleRandom(t);break;case 16:s.SetLifeSpeedRandom(t);break;case 17:s.SetLifeOpacityRandom(t);break;case 18:s.SetDestroyModeIndex(t);break;case 19:s.SetTimeout(t)}}GetDebuggerProperties(){const e=this._particleEngine;return[{title:"plugins.particles.name",properties:[{name:"plugins.particles.debugger.particle-count",value:e.GetParticleCount()},{name:"plugins.particles.properties.type.name",value:["plugins.particles.properties.type.items."+e.GetSprayType()]},{name:"plugins.particles.debugger.is-spraying",value:e.IsSpraying(),onedit:t=>e.SetSpraying(t)},{name:"plugins.particles.properties.rate.name",value:e.GetRate(),onedit:t=>e.SetRate(t)},{name:"plugins.particles.properties.spray-cone.name",value:C3$jscomp$210.toDegrees(e.GetSprayCone()),onedit:t=>e.SetSprayCone(C3$jscomp$210.toRadians(t))},{name:"plugins.particles.properties.speed.name",value:e.GetInitSpeed(),onedit:t=>e.SetInitSpeed(t)},{name:"plugins.particles.properties.size.name",value:e.GetInitSize(),onedit:t=>e.SetInitSize(t)},{name:"plugins.particles.properties.opacity.name",value:e.GetInitOpacity(),onedit:t=>e.SetInitOpacity(t)},{name:"plugins.particles.properties.grow-rate.name",value:e.GetGrowRate(),onedit:t=>e.SetGrowRate(t)},{name:"plugins.particles.properties.x-randomiser.name",value:e.GetInitXRandom(),onedit:t=>e.SetInitXRandom(t)},{name:"plugins.particles.properties.y-randomiser.name",value:e.GetInitYRandom(),onedit:t=>e.SetInitYRandom(t)},{name:"plugins.particles.properties.initial-speed-randomiser.name",value:e.GetInitSpeedRandom(),onedit:t=>e.SetInitSpeedRandom(t)},{name:"plugins.particles.properties.size-randomiser.name",value:e.GetInitSizeRandom(),onedit:t=>e.SetInitSizeRandom(t)},{name:"plugins.particles.properties.grow-rate-randomiser.name",value:e.GetGrowRandom(),onedit:t=>e.SetGrowRandom(t)},{name:"plugins.particles.properties.acceleration.name",value:e.GetAcceleration(),onedit:t=>e.SetAcceleration(t)},{name:"plugins.particles.properties.gravity.name",value:e.GetGravity(),onedit:t=>e.SetGravity(t)},{name:"plugins.particles.properties.angle-randomiser.name",value:e.GetLifeAngleRandom(),onedit:t=>e.SetLifeAngleRandom(t)},{name:"plugins.particles.properties.life-speed-randomiser.name",value:e.GetLifeSpeedRandom(),onedit:t=>e.SetLifeSpeedRandom(t)},{name:"plugins.particles.properties.opacity-randomiser.name",value:e.GetLifeOpacityRandom(),onedit:t=>e.SetLifeOpacityRandom(t)},{name:"plugins.particles.properties.timeout.name",value:e.GetTimeout(),onedit:t=>e.SetTimeout(t)}]}]}GetScriptInterfaceClass(){return self.IParticlesInstance}};const map$jscomp$22=new WeakMap;function GetParticleEngine(e){return map$jscomp$22.get(e).GetParticleEngine()}self.IParticlesInstance=class extends self.IWorldInstance{constructor(){super(),map$jscomp$22.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set isSpraying(e){GetParticleEngine(this).SetSpraying(!!e)}get isSpraying(){return GetParticleEngine(this).IsSpraying()}set rate(e){C3X$jscomp$23.RequireFiniteNumber(e),map$jscomp$22.get(this)._SetRate(e)}get rate(){return GetParticleEngine(this).GetRate()}set sprayCone(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetSprayCone(e)}get sprayCone(){return GetParticleEngine(this).GetSprayCone()}set initSpeed(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetInitSpeed(e)}get initSpeed(){return GetParticleEngine(this).GetInitSpeed()}set initSize(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetInitSize(e)}get initSize(){return GetParticleEngine(this).GetInitSize()}set initOpacity(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetInitOpacity(e)}get initOpacity(){return GetParticleEngine(this).GetInitOpacity()}set initXRandom(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetInitXRandom(e)}get initXRandom(){return GetParticleEngine(this).GetInitXRandom()}set initYRandom(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetInitYRandom(e)}get initYRandom(){return GetParticleEngine(this).GetInitYRandom()}set initSpeedRandom(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetInitSpeedRandom(e)}get initSpeedRandom(){return GetParticleEngine(this).GetInitSpeedRandom()}set initSizeRandom(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetInitSizeRandom(e)}get initSizeRandom(){return GetParticleEngine(this).GetInitSizeRandom()}set initGrowRate(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetGrowRate(e)}get initGrowRate(){return GetParticleEngine(this).GetGrowRate()}set initGrowRandom(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetGrowRandom(e)}get initGrowRandom(){return GetParticleEngine(this).GetGrowRandom()}set acceleration(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetAcceleration(e)}get acceleration(){return GetParticleEngine(this).GetAcceleration()}set gravity(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetGravity(e)}get gravity(){return GetParticleEngine(this).GetGravity()}set lifeAngleRandom(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetLifeAngleRandom(e)}get lifeAngleRandom(){return GetParticleEngine(this).GetLifeAngleRandom()}set lifeSpeedRandom(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetLifeSpeedRandom(e)}get lifeSpeedRandom(){return GetParticleEngine(this).GetLifeSpeedRandom()}set lifeOpacityRandom(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetLifeOpacityRandom(e)}get lifeOpacityRandom(){return GetParticleEngine(this).GetLifeOpacityRandom()}set timeout(e){C3X$jscomp$23.RequireFiniteNumber(e),GetParticleEngine(this).SetTimeout(e)}get timeout(){return GetParticleEngine(this).GetTimeout()}setParticleObjectClass(e){const t=map$jscomp$22.get(this);e?t._SetParticleObjectClass(t.GetRuntime()._UnwrapIObjectClass(e)):t._SetParticleObjectClass(null)}},self.C3.Plugins.Particles.Cnds={IsSpraying(){return this._particleEngine.IsSpraying()}};const C3$jscomp$212=self.C3;C3$jscomp$212.Plugins.Particles.Acts={SetSpraying(e){this._particleEngine.SetSpraying(0!==e)},SetRate(e){this._SetRate(e)},SetParticleObject(e){this._SetParticleObjectClass(e)},UnsetParticleObject(){this._SetParticleObjectClass(null)},SetSprayCone(e){this._particleEngine.SetSprayCone(C3$jscomp$212.toRadians(e))},SetInitSpeed(e){this._particleEngine.SetInitSpeed(e)},SetInitSize(e){this._particleEngine.SetInitSize(e)},SetInitOpacity(e){this._particleEngine.SetInitOpacity(e/100)},SetGrowRate(e){this._particleEngine.SetGrowRate(e)},SetXRandomiser(e){this._particleEngine.SetInitXRandom(e)},SetYRandomiser(e){this._particleEngine.SetInitYRandom(e)},SetSpeedRandomiser(e){this._particleEngine.SetInitSpeedRandom(e)},SetSizeRandomiser(e){this._particleEngine.SetInitSizeRandom(e)},SetGrowRateRandomiser(e){this._particleEngine.SetGrowRandom(e)},SetParticleAcc(e){this._particleEngine.SetAcceleration(e)},SetGravity(e){this._particleEngine.SetGravity(e)},SetAngleRandomiser(e){this._particleEngine.SetLifeAngleRandom(e)},SetLifeSpeedRandomiser(e){this._particleEngine.SetLifeSpeedRandom(e)},SetOpacityRandomiser(e){this._particleEngine.SetLifeOpacityRandom(e)},SetTimeout(e){this._particleEngine.SetTimeout(e)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}};const C3$jscomp$213=self.C3;C3$jscomp$213.Plugins.Particles.Exps={ParticleCount(){return this._particleEngine.GetParticleCount()},Rate(){return this._particleEngine.GetRate()},SprayCone(){return C3$jscomp$213.toDegrees(this._particleEngine.GetSprayCone())},InitSpeed(){return this._particleEngine.GetInitSpeed()},InitSize(){return this._particleEngine.GetInitSize()},InitOpacity(){return 100*this._particleEngine.GetInitOpacity()},InitGrowRate(){return this._particleEngine.GetGrowRate()},XRandom(){return this._particleEngine.GetInitXRandom()},YRandom(){return this._particleEngine.GetInitYRandom()},InitSizeRandom(){return this._particleEngine.GetInitSizeRandom()},InitSpeedRandom(){return this._particleEngine.GetInitSpeedRandom()},InitGrowRandom(){return this._particleEngine.GetGrowRandom()},ParticleAcceleration(){return this._particleEngine.GetAcceleration()},Gravity(){return this._particleEngine.GetGravity()},ParticleAngleRandom(){return this._particleEngine.GetLifeAngleRandom()},ParticleSpeedRandom(){return this._particleEngine.GetLifeSpeedRandom()},ParticleOpacityRandom(){return this._particleEngine.GetLifeOpacityRandom()},Timeout(){return this._particleEngine.GetTimeout()}};const C3$jscomp$214=self.C3,inactiveParticles=[],VALID_SPRAY_TYPES=new Set(["continuous-spray","one-shot"]),DESTROY_MODES=["fade-to-invisible","timeout-expired","particle-stopped"];self.ParticleEngine=class{constructor(){this._sprayCone=this._rate=0,this._sprayType="continuous-spray",this._isSpraying=!1,this._masterOpacity=0,this._isPixelRounding=!1,this._initSize=this._initSpeed=this._spawnAngle=this._spawnY=this._spawnX=0,this._initSizeScale=1,this._createCounter=this._timeout=this._destroyMode=this._lifeOpacityRandom=this._lifeSpeedRandom=this._lifeAngleRandom=this._gravity=this._acceleration=this._growRandom=this._initSizeRandom=this._initSpeedRandom=this._yRandom=this._xRandom=this._growRate=this._initOpacity=0,this._particleScale=1,this.onparticlecreate=this.ononeshotfinish=null,this._particles=[],this._boundingBox=new C3$jscomp$214.Rect,this._color=new C3$jscomp$214.Color}Release(){this.Cancel(),C3$jscomp$214.clearArray(this._particles),this._color=this._boundingBox=this.onparticlecreate=this.ononeshotfinish=this._particles=null}Cancel(){const e=this._particles;for(let t=0,s=e.length;t<s;++t)e[t].Destroy();C3$jscomp$214.appendArray(inactiveParticles,e),C3$jscomp$214.clearArray(e),1e3<inactiveParticles.length&&C3$jscomp$214.truncateArray(inactiveParticles,1e3),this._isSpraying=!1}CreateOneShotSpray(){for(let e=0,t=this._rate;e<t;++e)this._CreateParticle();this._particles.length&&(this._isSpraying=!0)}_CreateParticle(){let e;return inactiveParticles.length?(e=inactiveParticles.pop(),e.SetEngine(this)):e=C3$jscomp$214.New(self.Particle,this),this._particles.push(e),e.Init(this.onparticlecreate),e}ReInitAllParticles(){const e=this._particles,t=this.onparticlecreate;for(let s=0,i=e.length;s<i;++s)e[s].Init(t)}UpdateAllParticlesUserData(){const e=this._particles,t=this.onparticlecreate;for(let s=0,i=e.length;s<i;++s)e[s].UpdateUserData(t)}ApplyParticleDataToUserData(e){const t=this._particles;for(let i=0,r=t.length;i<r;++i){const r=t[i];var s=r.GetUserData();s&&((s=s.GetWorldInfo()).SetX(r.GetX()),s.SetY(r.GetY()),s.SetSize(r.GetSize(),r.GetSize()),s.SetOpacity(r.GetOpacity()),s.SetAngle(r.GetAngle()),s.SetUnpremultipliedColor(e.GetWorldInfo().GetUnpremultipliedColor()),s.SetBboxChanged())}}SetParticleCount(e){var t=this._particles;if(e<t.length){e=t.length-e;for(let s=0;s<e;++s){const e=t.pop();e.Destroy(),inactiveParticles.push(e)}1e3<inactiveParticles.length&&C3$jscomp$214.truncateArray(inactiveParticles,1e3)}else if(e>t.length)for(t=e-t.length,e=0;e<t;++e)this._CreateParticle()}GetParticles(){return this._particles}GetParticleCount(){return this._particles.length}Tick(e){this._SpawnContinuous(e),this._TickParticles(e),this._MaybeFinishOneShot()}_SpawnContinuous(e){if("continuous-spray"===this._sprayType&&this._isSpraying){this._createCounter+=e*this._rate,e=Math.floor(this._createCounter),this._createCounter-=e;for(let t=0;t<e;++t)this._CreateParticle()}}_SetCreateCounter(e){this._createCounter=e}_GetCreateCounter(){return this._createCounter}_TickParticles(e){const t=this._boundingBox;t.set(this._spawnX,this._spawnY,this._spawnX,this._spawnY);const s=this._particles;let i=0;for(let r=0,n=s.length;r<n;++r){const n=s[r];s[i]=n,n.Tick(e),n.IsActive()?(++i,t.expandToContain(n.GetBoundingBox())):(n.Destroy(),inactiveParticles.push(n))}C3$jscomp$214.truncateArray(s,i),1e3<inactiveParticles.length&&C3$jscomp$214.truncateArray(inactiveParticles,1e3)}_MaybeFinishOneShot(){"one-shot"===this._sprayType&&0===this._particles.length&&this._isSpraying&&(this.ononeshotfinish&&this.ononeshotfinish(),this._isSpraying=!1)}Draw(e,t,s,i){e.StartRenderingPoints(t),this._color.copy(e.GetColor());const r=this._particles;for(let n=0,a=r.length;n<a;++n){const a=r[n];s.intersectsRect(a.GetBoundingBox())&&a.Draw(e,t,i)}e.FinishRenderingPoints()}GetColor(){return this._color}SetRate(e){this._rate=+e}GetRate(){return this._rate}SetSprayCone(e){this._sprayCone=+e}GetSprayCone(){return this._sprayCone}SetSprayType(e){if(!VALID_SPRAY_TYPES.has(e))throw Error("invalid spray type");this._sprayType=e}GetSprayType(){return this._sprayType}SetSpraying(e){this._isSpraying=!!e}IsSpraying(){return this._isSpraying}SetMasterOpacity(e){this._masterOpacity=+e}GetMasterOpacity(){return this._masterOpacity}SetPixelRounding(e){this._isPixelRounding=!!e}IsPixelRounding(){return this._isPixelRounding}SetSpawnX(e){this._spawnX=+e}GetSpawnX(){return this._spawnX}SetSpawnY(e){this._spawnY=+e}GetSpawnY(){return this._spawnY}SetSpawnAngle(e){this._spawnAngle=+e}GetInitAngle(){return this._spawnAngle}SetInitSpeed(e){this._initSpeed=+e}GetInitSpeed(){return this._initSpeed}SetInitSize(e){this._initSize=+e}GetInitSize(){return this._initSize}SetInitSizeScale(e){this._initSizeScale=+e}GetInitSizeScale(){return this._initSizeScale}SetInitOpacity(e){this._initOpacity=+e}GetInitOpacity(){return this._initOpacity}SetGrowRate(e){this._growRate=+e}GetGrowRate(){return this._growRate}SetInitXRandom(e){this._xRandom=+e}GetInitXRandom(){return this._xRandom}SetInitYRandom(e){this._yRandom=+e}GetInitYRandom(){return this._yRandom}SetInitSpeedRandom(e){this._initSpeedRandom=+e}GetInitSpeedRandom(){return this._initSpeedRandom}SetInitSizeRandom(e){this._initSizeRandom=+e}GetInitSizeRandom(){return this._initSizeRandom}SetGrowRandom(e){this._growRandom=+e}GetGrowRandom(){return this._growRandom}SetAcceleration(e){this._acceleration=+e}GetAcceleration(){return this._acceleration}SetGravity(e){this._gravity=+e}GetGravity(){return this._gravity}SetLifeAngleRandom(e){this._lifeAngleRandom=+e}GetLifeAngleRandom(){return this._lifeAngleRandom}SetLifeSpeedRandom(e){this._lifeSpeedRandom=+e}GetLifeSpeedRandom(){return this._lifeSpeedRandom}SetLifeOpacityRandom(e){this._lifeOpacityRandom=+e}GetLifeOpacityRandom(){return this._lifeOpacityRandom}SetDestroyMode(e){if(-1===(e=DESTROY_MODES.indexOf(e)))throw Error("invalid destroy mode");this._destroyMode=e}SetDestroyModeIndex(e){this.SetDestroyMode(DESTROY_MODES[e])}GetDestroyMode(){return DESTROY_MODES[this._destroyMode]}GetDestroyModeIndex(){return this._destroyMode}SetTimeout(e){this._timeout=+e}GetTimeout(){return this._timeout}SetParticleScale(e){this._particleScale=+e}GetParticleScale(){return this._particleScale}GetBoundingBox(){return this._boundingBox}};const C3$jscomp$215=self.C3;function randomOffset(e){return Math.random()*e-e/2}const tmpQuad$jscomp$3=new C3$jscomp$215.Quad,tmpColor=new C3$jscomp$215.Color,DPR=self.devicePixelRatio||1;let didChangeColor=!1;self.Particle=class{constructor(e){this._engine=e,this._isActive=!1,this._angle=this._speed=this._y=this._x=0,this._opacity=1,this._age=this._gs=this._halfSize=this._size=this._grow=this._lastOpacity=0,this._bbox=new C3$jscomp$215.Rect,this._userData=null,this._userDataUid=NaN,this._destroyCallback=this._updateCallback=null}SetEngine(e){this._engine=e}Init(e){const t=this._engine;this._isActive=!0,this._x=t.GetSpawnX()+randomOffset(t.GetInitXRandom()),this._y=t.GetSpawnY()+randomOffset(t.GetInitYRandom()),this._speed=t.GetInitSpeed()+randomOffset(t.GetInitSpeedRandom()),this._angle=t.GetInitAngle()+randomOffset(t.GetSprayCone()),this._lastOpacity=this._opacity=t.GetInitOpacity(),this._size=(t.GetInitSize()+randomOffset(t.GetInitSizeRandom()))*t.GetInitSizeScale(),this._halfSize=this._size/2,this._grow=t.GetGrowRate()+randomOffset(t.GetGrowRandom()),this._age=this._gs=0,this._UpdateBoundingBox(),e?this._userData||(this._userData=e(this)):this._destroyCallback=this._updateCallback=this._userData=null}UpdateUserData(e){e?this._userData&&!this._userData.IsDestroyed()||(this._userData=e(this)):this._destroyCallback=this._updateCallback=this._userData=null}SetUpdateCallback(e){this._updateCallback=e}SetDestroyCallback(e){this._destroyCallback=e}Destroy(){const e=this._destroyCallback;e&&e(this._userData),this._destroyCallback=this._updateCallback=this._userData=null}toJSON(){let e;return this._userData&&(e=this._userData.GetWorldInfo().GetInstance().GetUID()),[this._x,this._y,this._speed,this._angle,this._opacity,this._grow,this._size,this._gs,this._age,e]}setFromJSON(e){this._x=e[0],this._y=e[1],this._speed=e[2],this._angle=e[3],this._opacity=e[4],this._grow=e[5],this._size=e[6],this._gs=e[7],this._age=e[8],this._userDataUid=e[9],this._halfSize=this._size/2,this._UpdateBoundingBox()}Tick(e){var t=this._engine,s=this._speed*e,i=this._angle;const r=Math.cos(i)*s;s=Math.sin(i)*s+this._gs*e,this._x+=r,this._y+=s,i=this._grow*e,this._size+=i,this._halfSize=this._size/2,this._speed+=t.GetAcceleration()*e,this._gs+=t.GetGravity()*e,this._age+=e,this._UpdateBoundingBox();var n=t.GetLifeAngleRandom(),a=t.GetLifeSpeedRandom();const o=t.GetLifeOpacityRandom();let h=0;0!==n&&(h=randomOffset(n*e),this._angle+=h),0!==a&&(this._speed+=randomOffset(a*e)),0!==o&&(this._opacity=C3$jscomp$215.clamp(this._opacity+randomOffset(o*e),0,1)),e=1<=this._size&&(2===t.GetDestroyModeIndex()?0<this._speed:this._age<t.GetTimeout()),(n=this._updateCallback)&&e&&(a=t.GetMasterOpacity()*this._opacity,0===t.GetDestroyModeIndex()&&(a*=1-this._age/t.GetTimeout()),t=a-this._lastOpacity,this._lastOpacity=a,n(this._userData,r,s,i,h,t)),this._isActive=e}IsActive(){return this._isActive}GetBoundingBox(){return this._bbox}_UpdateBoundingBox(){const e=this._x,t=this._y,s=this._halfSize;this._bbox.set(e-s,t-s,e+s,t+s)}Draw(e,t,s){if(!this._userData){var i=this._engine,r=i.GetMasterOpacity()*this._opacity;if(0===i.GetDestroyModeIndex()&&(r*=1-this._age/i.GetTimeout()),!(0>=r)){var n=this._size,a=n*i.GetParticleScale()*DPR;if(!(1>a)){var o=this._x,h=this._y;i.IsPixelRounding()&&(o=o+.5|0,h=h+.5|0),e.IsWebGPU()?e.Point(o,h,n,r):s||a>e.GetMaxPointSize()||a<e.GetMinPointSize()?(tmpColor.copy(i.GetColor()),tmpColor.multiplyAlpha(r),e.SetColor(tmpColor),didChangeColor=!0,tmpQuad$jscomp$3.setFromRect(this._bbox),e.Quad3(tmpQuad$jscomp$3,t)):(didChangeColor&&(e.SetColor(i.GetColor()),didChangeColor=!1),e.Point(o,h,a,r))}}}}GetUserData(){return this._userData}GetUserDataUID(){return this._userDataUid}GetX(){return this._x}GetY(){return this._y}GetSize(){return this._size}GetAngle(){return this._angle}GetOpacity(){return this._opacity}};const C3$jscomp$216=self.C3;C3$jscomp$216.Plugins.PlatformInfo=class extends C3$jscomp$216.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$217=self.C3;C3$jscomp$217.Plugins.PlatformInfo.Type=class extends C3$jscomp$217.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$218=self.C3;C3$jscomp$218.Plugins.PlatformInfo.Instance=class extends C3$jscomp$218.SDKInstanceBase{constructor(e,t){super(e,"platform-info"),this._windowOuterHeight=this._windowOuterWidth=this._screenHeight=this._screenWidth=0,this._safeAreaInset=[0,0,0,0],this._isNwjs=this._isWakeLockActive=this._supportsWakeLock=!1,this.AddDOMMessageHandlers([["window-resize",e=>this._OnWindowResize(e)],["wake-lock-acquired",e=>this._OnWakeLockAcquired(e)],["wake-lock-error",e=>this._OnWakeLockError(e)],["wake-lock-released",e=>this._OnWakeLockReleased(e)]]),navigator.connection&&navigator.connection.addEventListener("change",(()=>this._OnNetworkChange())),this._runtime.AddLoadPromise(this.PostToDOMAsync("get-initial-state").then((e=>{this._screenWidth=e.screenWidth,this._screenHeight=e.screenHeight,this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._safeAreaInset=e.safeAreaInset,this._supportsWakeLock=e.supportsWakeLock,this._isNwjs=e.isNwjs})))}Release(){super.Release()}_OnWindowResize(e){this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._safeAreaInset=e.safeAreaInset}async _OnNetworkChange(){await this.TriggerAsync(C3$jscomp$218.Plugins.PlatformInfo.Cnds.OnNetworkChange)}async _OnWakeLockAcquired(){this._isWakeLockActive=!0,await this.TriggerAsync(C3$jscomp$218.Plugins.PlatformInfo.Cnds.OnWakeLockAcquired)}async _OnWakeLockError(){this._isWakeLockActive=!1,await this.TriggerAsync(C3$jscomp$218.Plugins.PlatformInfo.Cnds.OnWakeLockError)}async _OnWakeLockReleased(){this._isWakeLockActive=!1,await this.TriggerAsync(C3$jscomp$218.Plugins.PlatformInfo.Cnds.OnWakeLockReleased)}};const C3$jscomp$219=self.C3;C3$jscomp$219.Plugins.PlatformInfo.Cnds={IsOnMobile:()=>C3$jscomp$219.Platform.IsMobile,IsOnWindows:()=>"Windows"===C3$jscomp$219.Platform.OS,IsOnMacOS:()=>"macOS"===C3$jscomp$219.Platform.OS,IsOnLinux:()=>"Linux"===C3$jscomp$219.Platform.OS,IsOnChromeOS:()=>"Chrome OS"===C3$jscomp$219.Platform.OS,IsOnAndroid:()=>"Android"===C3$jscomp$219.Platform.OS,IsOniOS:()=>"iOS"===C3$jscomp$219.Platform.OS,IsWebExport(){const e=this._runtime.GetExportType();return"html5"===e||"scirra-arcade"===e||"preview"===e||"instant-games"===e},IsCordovaExport(){return this._runtime.IsCordova()},IsNWjsExport(){return"nwjs"===this._runtime.GetExportType()||this._isNwjs},IsWindowsUWPExport(){return"windows-uwp"===this._runtime.GetExportType()},IsWindowsWebView2Export(){return"windows-webview2"===this._runtime.GetExportType()},IsMacOSWKWebView2Export(){return"macos-wkwebview"===this._runtime.GetExportType()},OnNetworkChange:()=>!0,OnWakeLockAcquired:()=>!0,OnWakeLockError:()=>!0,OnWakeLockReleased:()=>!0,IsWakeLockActive(){return this._isWakeLockActive},IsWakeLockSupported(){return this._supportsWakeLock}},self.C3.Plugins.PlatformInfo.Acts={RequestWakeLock(){this._supportsWakeLock&&this._PostToDOMMaybeSync("request-wake-lock")},ReleaseWakeLock(){this._supportsWakeLock&&(this._isWakeLockActive=!1,this.PostToDOM("release-wake-lock"))}},self.C3.Plugins.PlatformInfo.Exps={Renderer(){let e;return e=this._runtime.GetWebGPURenderer()?"webgpu":"webgl"+this._runtime.GetWebGLRenderer().GetWebGLVersionNumber(),this._runtime.GetRenderer().HasMajorPerformanceCaveat()&&(e+="-software"),e},RendererDetail(){return this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()},DevicePixelRatio:()=>self.devicePixelRatio,ScreenWidth(){return this._screenWidth},ScreenHeight(){return this._screenHeight},WindowInnerWidth(){return this._runtime.GetCanvasManager().GetLastWidth()},WindowInnerHeight(){return this._runtime.GetCanvasManager().GetLastHeight()},WindowOuterWidth(){return this._windowOuterWidth},WindowOuterHeight(){return this._windowOuterHeight},CanvasCssWidth(){return this._runtime.GetCanvasManager().GetCssWidth()},CanvasCssHeight(){return this._runtime.GetCanvasManager().GetCssHeight()},CanvasDeviceWidth(){return this._runtime.GetCanvasManager().GetDeviceWidth()},CanvasDeviceHeight(){return this._runtime.GetCanvasManager().GetDeviceHeight()},Downlink:()=>navigator.connection&&navigator.connection.downlink||0,DownlinkMax:()=>navigator.connection&&navigator.connection.downlinkMax||0,ConnectionType:()=>navigator.connection&&navigator.connection.type||"unknown",ConnectionEffectiveType:()=>navigator.connection&&navigator.connection.effectiveType||"unknown",ConnectionRTT:()=>navigator.connection&&navigator.connection.rtt||0,HardwareConcurrency:()=>navigator.hardwareConcurrency||0,DeviceMemory:()=>navigator.deviceMemory||0,SafeAreaInsetTop(){return this._safeAreaInset[0]},SafeAreaInsetRight(){return this._safeAreaInset[1]},SafeAreaInsetBottom(){return this._safeAreaInset[2]},SafeAreaInsetLeft(){return this._safeAreaInset[3]}};const C3$jscomp$222=self.C3;C3$jscomp$222.Plugins.Browser=class extends C3$jscomp$222.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$223=self.C3;C3$jscomp$223.Plugins.Browser.Type=class extends C3$jscomp$223.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$224=self.C3;C3$jscomp$224.Plugins.Browser.Instance=class extends C3$jscomp$224.SDKInstanceBase{constructor(e,t){super(e,"browser"),this._initLocationStr="",this._isOnline=!1,this._docTitle=this._referrer="",this._isCookieEnabled=!1,this._windowOuterHeight=this._windowOuterWidth=this._screenHeight=this._screenWidth=0,this._isConstructArcade=!1,this._cssStyleMap=new Map,this.AddDOMMessageHandlers([["online-state",e=>this._OnOnlineStateChanged(e)],["backbutton",()=>this._OnBackButton()],["sw-message",e=>this._OnSWMessage(e)],["hashchange",e=>this._OnHashChange(e)]]),e=this.GetRuntime().Dispatcher(),this._disposables=new C3$jscomp$224.CompositeDisposable(C3$jscomp$224.Disposable.From(e,"afterfirstlayoutstart",(()=>this._OnAfterFirstLayoutStart())),C3$jscomp$224.Disposable.From(e,"window-resize",(()=>this._OnWindowResize())),C3$jscomp$224.Disposable.From(e,"suspend",(()=>this._OnSuspend())),C3$jscomp$224.Disposable.From(e,"resume",(()=>this._OnResume()))),this._runtime.AddLoadPromise(this.PostToDOMAsync("get-initial-state",{exportType:this._runtime.GetExportType()}).then((e=>{this._initLocationStr=e.location,this._isOnline=e.isOnline,this._referrer=e.referrer,this._docTitle=e.title,this._isCookieEnabled=e.isCookieEnabled,this._screenWidth=e.screenWidth,this._screenHeight=e.screenHeight,this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._isConstructArcade=e.isConstructArcade})))}Release(){super.Release()}_OnAfterFirstLayoutStart(){this.PostToDOM("ready-for-sw-messages")}async _OnOnlineStateChanged(e){e=!!e.isOnline,this._isOnline!==e&&((this._isOnline=e)?await this.TriggerAsync(C3$jscomp$224.Plugins.Browser.Cnds.OnOnline):await this.TriggerAsync(C3$jscomp$224.Plugins.Browser.Cnds.OnOffline))}async _OnWindowResize(){await this.TriggerAsync(C3$jscomp$224.Plugins.Browser.Cnds.OnResize)}_OnSuspend(){this.Trigger(C3$jscomp$224.Plugins.Browser.Cnds.OnPageHidden)}_OnResume(){this.Trigger(C3$jscomp$224.Plugins.Browser.Cnds.OnPageVisible)}async _OnBackButton(){await this.TriggerAsync(C3$jscomp$224.Plugins.Browser.Cnds.OnBackButton)}_OnSWMessage(e){"downloading-update"===(e=e.type)?this.Trigger(C3$jscomp$224.Plugins.Browser.Cnds.OnUpdateFound):"update-ready"===e||"update-pending"===e?this.Trigger(C3$jscomp$224.Plugins.Browser.Cnds.OnUpdateReady):"offline-ready"===e&&this.Trigger(C3$jscomp$224.Plugins.Browser.Cnds.OnOfflineReady)}_OnHashChange(e){this._initLocationStr=e.location,this.Trigger(C3$jscomp$224.Plugins.Browser.Cnds.OnHashChange)}GetDebuggerProperties(){return[{title:"plugins.browser.name",properties:[{name:"plugins.browser.debugger.user-agent",value:navigator.userAgent},{name:"plugins.browser.debugger.is-online",value:this._isOnline},{name:"plugins.browser.debugger.is-fullscreen",value:this._runtime.GetCanvasManager().IsDocumentFullscreen()}]}]}},self.C3.Plugins.Browser.Cnds={IsOnline(){return this._isOnline},OnOnline:()=>!0,OnOffline:()=>!0,OnResize:()=>!0,CookiesEnabled(){return this._isCookieEnabled},IsFullscreen(){return this._runtime.GetCanvasManager().IsDocumentFullscreen()},OnBackButton:()=>!0,IsPortraitLandscape(e){return(this._runtime.GetCanvasManager().GetLastWidth()<=this._runtime.GetCanvasManager().GetLastHeight()?0:1)===e},OnUpdateFound:()=>!0,OnUpdateReady:()=>!0,OnOfflineReady:()=>!0,OnHashChange:()=>!0,PageVisible(){return!this._runtime.IsSuspended()},OnPageHidden:()=>!0,OnPageVisible:()=>!0,HasJava:()=>!1,IsDownloadingUpdate:()=>!1,OnMenuButton:()=>!1,OnSearchButton:()=>!1,IsMetered:()=>!1,IsCharging:()=>!0,SupportsFullscreen:()=>!0};const C3$jscomp$226=self.C3,ORIENTATIONS="portrait landscape portrait-primary portrait-secondary landscape-primary landscape-secondary".split(" ");C3$jscomp$226.Plugins.Browser.Acts={Alert(e){this.PostToDOM("alert",{message:e.toString()})},Close(){this._isConstructArcade||(this._runtime.IsDebug()?self.C3Debugger.CloseWindow():this.PostToDOM("close"))},Focus(){this.PostToDOM("set-focus",{isFocus:!0})},Blur(){this.PostToDOM("set-focus",{isFocus:!1})},GoBack(){this._isConstructArcade||this.PostToDOM("navigate",{type:"back"})},GoForward(){this._isConstructArcade||this.PostToDOM("navigate",{type:"forward"})},GoHome(){},Reload(){this._isConstructArcade||(this._runtime.IsDebug()?this._runtime.PostToDebugger({type:"reload"}):this.PostToDOM("navigate",{type:"reload"}))},GoToURL(e,t){this._PostToDOMMaybeSync("navigate",{type:"url",url:e,target:t,exportType:this._runtime.GetExportType()})},GoToURLWindow(e,t){this._PostToDOMMaybeSync("navigate",{type:"new-window",url:e,tag:t,exportType:this._runtime.GetExportType()})},RequestFullScreen(e,t){2<=e&&(e+=1),6===e&&(e=2),1===e&&(e=0),e=C3$jscomp$226.CanvasManager._FullscreenModeNumberToString(e),this._runtime.GetCanvasManager().SetDocumentFullscreenMode(e),this._PostToDOMMaybeSync("request-fullscreen",{navUI:t})},CancelFullScreen(){this._PostToDOMMaybeSync("exit-fullscreen")},Vibrate(e){for(let t=0,s=(e=e.split(",")).length;t<s;++t)e[t]=parseInt(e[t],10);this._PostToDOMMaybeSync("vibrate",{pattern:e})},async InvokeDownload(e,t){e&&t&&(e=await this._runtime.GetAssetManager().GetProjectFileUrl(e),this._runtime.InvokeDownload(e,t))},InvokeDownloadString(e,t,s){s&&(e=`data:${t},${encodeURIComponent(e)}`,this._runtime.InvokeDownload(e,s))},ConsoleLog(e,t){t=t.toString()},ConsoleGroup(e){},ConsoleGroupEnd(){},ExecJs(a){try{eval(a)}catch(e){}},LockOrientation(e){0>(e=Math.floor(e))||e>=ORIENTATIONS.length||this._PostToDOMMaybeSync("lock-orientation",{orientation:ORIENTATIONS[e]})},UnlockOrientation(){this._PostToDOMMaybeSync("unlock-orientation")},LoadStyleSheet(e){this._runtime.GetAssetManager().LoadStyleSheet(e)},async SetDocumentCSSStyle(e,t,s,i){await this.PostToDOMAsync("set-document-css-style",{prop:C3$jscomp$226.CSSToCamelCase(e),value:t,selector:s,"is-all":0!==i})},async GetDocumentCSSStyle(e,t,s){(e=await this.PostToDOMAsync("get-document-css-style",{prop:e,selector:t})).isOk&&this._cssStyleMap.set(s.toLowerCase(),e.result.trim())},SetHash(e){this.PostToDOM("set-hash",{hash:e})}},self.C3.Plugins.Browser.Exps={URL(){return this._runtime.IsInWorker()?this._initLocationStr:location.toString()},Protocol(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).protocol:location.protocol},Domain(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).hostname:location.hostname},Port(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).port:location.port},PathName(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).pathname:location.pathname},Hash(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).hash:location.hash},QueryString(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).search:location.search},QueryParam(e){const t=this._runtime.IsInWorker()?new URL(this._initLocationStr).search:location.search;return(e=RegExp("[?&]"+e+"=([^&]*)").exec(t))?decodeURIComponent(e[1].replace(/\+/g," ")):""},Referrer(){return this._referrer},Title(){return this._docTitle},Language:()=>navigator.language,Platform:()=>navigator.platform,UserAgent:()=>navigator.userAgent,ExecJS(a){let b=0;try{b=eval(a)}catch(e){}return"number"==typeof b||"string"==typeof b?b:"boolean"==typeof b&&b?1:0},CSSStyleValue(e){return this._cssStyleMap.get(e)||""},Name:()=>navigator.appName,Version:()=>navigator.appVersion,Product:()=>navigator.product,Vendor:()=>navigator.vendor,BatteryLevel:()=>1,BatteryTimeLeft:()=>1/0,Bandwidth(){const e=navigator.connection;return e&&(e.downlink||e.downlinkMax||e.bandwidth)||1/0},ConnectionType(){const e=navigator.connection;return e&&e.type||"unknown"},DevicePixelRatio:()=>self.devicePixelRatio,ScreenWidth(){return this._screenWidth},ScreenHeight(){return this._screenHeight},WindowInnerWidth(){return this._runtime.GetCanvasManager().GetLastWidth()},WindowInnerHeight(){return this._runtime.GetCanvasManager().GetLastHeight()},WindowOuterWidth(){return this._windowOuterWidth},WindowOuterHeight(){return this._windowOuterWidth}};const C3$jscomp$228=self.C3;C3$jscomp$228.Plugins.Touch=class extends C3$jscomp$228.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$229=self.C3,C3X$jscomp$24=self.C3X;C3$jscomp$229.Plugins.Touch.Type=class extends C3$jscomp$229.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.ITouchObjectType}};let touchObjectType=null;function GetTouchSdkInstance(){return touchObjectType.GetSingleGlobalInstance().GetSdkInstance()}self.ITouchObjectType=class extends self.IObjectClass{constructor(e){super(e),touchObjectType=e,e.GetRuntime()._GetCommonScriptInterfaces().touch=this}requestPermission(e){C3X$jscomp$24.RequireString(e);const t=GetTouchSdkInstance();if("orientation"===e)return t._RequestPermission(0);if("motion"===e)return t._RequestPermission(1);throw Error("invalid type")}};const C3$jscomp$230=self.C3;C3$jscomp$230.Plugins.Touch.Instance=class extends C3$jscomp$230.SDKInstanceBase{constructor(e,t){super(e,"touch"),this._touches=new Map,this._isMouseDown=this._useMouseInput=!1,this._getTouchIndex=this._curTouchY=this._curTouchX=this._triggerPermission=this._triggerId=this._triggerIndex=this._accWithGZ=this._accWithGY=this._accWithGX=this._accZ=this._accY=this._accX=this._orientGamma=this._orientBeta=this._orientAlpha=this._orientCompassHeading=0,this._permissionPromises=[],t&&(this._useMouseInput=t[0]),this.AddDOMMessageHandler("permission-result",(e=>this._OnPermissionResult(e))),e=this.GetRuntime().Dispatcher(),this._disposables=new C3$jscomp$230.CompositeDisposable(C3$jscomp$230.Disposable.From(e,"pointerdown",(e=>this._OnPointerDown(e.data))),C3$jscomp$230.Disposable.From(e,"pointermove",(e=>this._OnPointerMove(e.data))),C3$jscomp$230.Disposable.From(e,"pointerup",(e=>this._OnPointerUp(e.data,!1))),C3$jscomp$230.Disposable.From(e,"pointercancel",(e=>this._OnPointerUp(e.data,!0))),C3$jscomp$230.Disposable.From(e,"deviceorientation",(e=>this._OnDeviceOrientation(e.data))),C3$jscomp$230.Disposable.From(e,"deviceorientationabsolute",(e=>this._OnDeviceOrientationAbsolute(e.data))),C3$jscomp$230.Disposable.From(e,"devicemotion",(e=>this._OnDeviceMotion(e.data))),C3$jscomp$230.Disposable.From(e,"tick2",(e=>this._OnTick2())))}Release(){this._touches.clear(),super.Release()}_OnPointerDown(e){if("mouse"===e.pointerType){if(!this._useMouseInput)return;this._isMouseDown=!0}const t=e.pointerId;if(!this._touches.has(t)){var s=e.pageX-this._runtime.GetCanvasClientX();e=e.pageY-this._runtime.GetCanvasClientY();var i=performance.now(),r=this._touches.size;this._triggerIndex=r,this._triggerId=t;var n=C3$jscomp$230.New(C3$jscomp$230.Plugins.Touch.TouchInfo);n.Init(i,s,e,t,r),this._touches.set(t,n),this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnNthTouchStart),this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnTouchStart),this._curTouchX=s,this._curTouchY=e,this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnTouchObject)}}_OnPointerMove(e){if("mouse"!==e.pointerType||this._isMouseDown){var t=this._touches.get(e.pointerId);if(t){var s=performance.now();if(!(2>s-t.GetTime())){var i=e.pageX-this._runtime.GetCanvasClientX(),r=e.pageY-this._runtime.GetCanvasClientY();t.Update(s,i,r,e.width,e.height,e.pressure)}}}}_OnPointerUp(e,t){if("mouse"===e.pointerType){if(!this._isMouseDown)return;this._isMouseDown=!1}const s=performance.now();e=e.pointerId;const i=this._touches.get(e);i&&(this._triggerIndex=i.GetStartIndex(),this._triggerId=i.GetId(),this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnNthTouchEnd),this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnTouchEnd),t||("single-tap"===(t=i.ShouldTriggerTap(s))?(this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnTapGesture),this._curTouchX=i.GetX(),this._curTouchY=i.GetY(),this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnTapGestureObject)):"double-tap"===t&&(this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnDoubleTapGesture),this._curTouchX=i.GetX(),this._curTouchY=i.GetY(),this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnDoubleTapGestureObject))),i.Release(),this._touches.delete(e))}_RequestPermission(e){return this._PostToDOMMaybeSync("request-permission",{type:e}),new Promise(((t,s)=>{this._permissionPromises.push({type:e,resolve:t,reject:s})}))}_OnPermissionResult(e){const t=e.result,s=e.type;this._triggerPermission=s,e=this._permissionPromises.filter((e=>e.type===s));for(const s of e)s.resolve(t?"granted":"denied");this._permissionPromises=this._permissionPromises.filter((e=>e.type!==s)),t?(this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnPermissionGranted),0===s?this._runtime.RequestDeviceOrientationEvent():this._runtime.RequestDeviceMotionEvent()):this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnPermissionDenied)}_OnDeviceOrientation(e){"number"==typeof e.webkitCompassHeading?this._orientCompassHeading=e.webkitCompassHeading:e.absolute&&(this._orientCompassHeading=e.alpha),this._orientAlpha=e.alpha,this._orientBeta=e.beta,this._orientGamma=e.gamma}_OnDeviceOrientationAbsolute(e){this._orientCompassHeading=e.alpha}_OnDeviceMotion(e){const t=e.acceleration;t&&(this._accX=t.x,this._accY=t.y,this._accZ=t.z),(e=e.accelerationIncludingGravity)&&(this._accWithGX=e.x,this._accWithGY=e.y,this._accWithGZ=e.z)}_OnTick2(){const e=performance.now();let t=0;for(const s of this._touches.values())s.GetTime()<=e-50&&s._SetLastTime(e),s.ShouldTriggerHold(e)&&(this._triggerIndex=s.GetStartIndex(),this._triggerId=s.GetId(),this._getTouchIndex=t,this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnHoldGesture),this._curTouchX=s.GetX(),this._curTouchY=s.GetY(),this.Trigger(C3$jscomp$230.Plugins.Touch.Cnds.OnHoldGestureObject),this._getTouchIndex=0),++t}_GetTouchByIndex(e){e=Math.floor(e);for(const t of this._touches.values()){if(0===e)return t;--e}return null}_IsClientPosOnCanvas(e,t){return 0<=e&&0<=t&&e<this._runtime.GetCanvasCssWidth()&&t<this._runtime.GetCanvasCssHeight()}GetDebuggerProperties(){return[{title:"plugins.touch.debugger.touches",properties:[...this._touches.values()].map((e=>({name:"$"+e.GetId(),value:e.GetX()+", "+e.GetY()})))}]}};const C3$jscomp$231=self.C3,tempArr=[];C3$jscomp$231.Plugins.Touch.Cnds={OnTouchStart:()=>!0,OnTouchEnd:()=>!0,IsInTouch(){return 0<this._touches.size},OnTouchObject(e){return!(!e||!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1)},IsTouchingObject(e){if(!e)return!1;const t=new Map,s=e.GetCurrentSol();var i=s.GetInstances();for(const e of i){const s=e.GetWorldInfo(),r=s.GetLayer();i=r;let n=t.get(i);if(void 0===n&&(n=i.IsSelfAndParentsInteractive(),t.set(i,n)),n&&s.IsInViewport2())for(const t of this._touches.values()){if(!this._IsClientPosOnCanvas(t.GetX(),t.GetY()))continue;const[i,n]=r.CanvasCssToLayer(t.GetX(),t.GetY(),s.GetTotalZElevation());if(s.ContainsPoint(i,n)){tempArr.push(e);break}}}return t.clear(),!!tempArr.length&&(s.SetArrayPicked(tempArr),e.ApplySolToContainer(),C3$jscomp$231.clearArray(tempArr),!0)},CompareTouchSpeed(e,t,s){return!!(e=this._GetTouchByIndex(e))&&C3$jscomp$231.compare(e.GetSpeed(),t,s)},OrientationSupported:()=>!0,MotionSupported:()=>!0,CompareOrientation(e,t,s){return this._runtime.RequestDeviceOrientationEvent(),C3$jscomp$231.compare(0===e?this._orientAlpha:1===e?this._orientBeta:this._orientGamma,t,s)},CompareAcceleration(e,t,s){return this._runtime.RequestDeviceMotionEvent(),C3$jscomp$231.compare(0===e?this._accWithGX:1===e?this._accWithGY:2===e?this._accWithGZ:3===e?this._accX:4===e?this._accY:this._accZ,t,s)},OnNthTouchStart(e){return(e=Math.floor(e))===this._triggerIndex},OnNthTouchEnd(e){return(e=Math.floor(e))===this._triggerIndex},HasNthTouch(e){return e=Math.floor(e),this._touches.size>=e+1},OnHoldGesture:()=>!0,OnTapGesture:()=>!0,OnDoubleTapGesture:()=>!0,OnHoldGestureObject(e){return!(!e||!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1)},OnTapGestureObject(e){return!(!e||!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1)},OnDoubleTapGestureObject(e){return!(!e||!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1)},OnPermissionGranted(e){return this._triggerPermission===e},OnPermissionDenied(e){return this._triggerPermission===e}},self.C3.Plugins.Touch.Acts={RequestPermission(e){this._RequestPermission(e)}};const C3$jscomp$233=self.C3;C3$jscomp$233.Plugins.Touch.Exps={TouchCount(){return this._touches.size},X(e){const t=this._GetTouchByIndex(this._getTouchIndex);return t?t.GetPositionForLayer(this._runtime.GetCurrentLayout(),e,!0):0},Y(e){const t=this._GetTouchByIndex(this._getTouchIndex);return t?t.GetPositionForLayer(this._runtime.GetCurrentLayout(),e,!1):0},XAt(e,t){return(e=this._GetTouchByIndex(e))?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!0):0},YAt(e,t){return(e=this._GetTouchByIndex(e))?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!1):0},XForID(e,t){return(e=this._touches.get(e))?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!0):0},YForID(e,t){return(e=this._touches.get(e))?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!1):0},AbsoluteX(){const e=this._GetTouchByIndex(0);return e?e.GetX():0},AbsoluteY(){const e=this._GetTouchByIndex(0);return e?e.GetY():0},AbsoluteXAt(e){return(e=this._GetTouchByIndex(e))?e.GetX():0},AbsoluteYAt(e){return(e=this._GetTouchByIndex(e))?e.GetY():0},AbsoluteXForID(e){return(e=this._touches.get(e))?e.GetX():0},AbsoluteYForID(e){return(e=this._touches.get(e))?e.GetY():0},SpeedAt(e){return(e=this._GetTouchByIndex(e))?e.GetSpeed():0},SpeedForID(e){return(e=this._touches.get(e))?e.GetSpeed():0},AngleAt(e){return(e=this._GetTouchByIndex(e))?C3$jscomp$233.toDegrees(e.GetAngle()):0},AngleForID(e){return(e=this._touches.get(e))?C3$jscomp$233.toDegrees(e.GetAngle()):0},CompassHeading(){return this._runtime.RequestDeviceOrientationEvent(),this._orientCompassHeading},Alpha(){return this._runtime.RequestDeviceOrientationEvent(),this._orientAlpha},Beta(){return this._runtime.RequestDeviceOrientationEvent(),this._orientBeta},Gamma(){return this._runtime.RequestDeviceOrientationEvent(),this._orientGamma},AccelerationXWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGX},AccelerationYWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGY},AccelerationZWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGZ},AccelerationX(){return this._runtime.RequestDeviceMotionEvent(),this._accX},AccelerationY(){return this._runtime.RequestDeviceMotionEvent(),this._accY},AccelerationZ(){return this._runtime.RequestDeviceMotionEvent(),this._accZ},TouchIndex(){return this._triggerIndex},TouchID(){return this._triggerId},WidthForID(e){return(e=this._touches.get(e))?e.GetWidth():0},HeightForID(e){return(e=this._touches.get(e))?e.GetHeight():0},PressureForID(e){return(e=this._touches.get(e))?e.GetPressure():0}};const C3$jscomp$234=self.C3;let lastTapX=-1e3,lastTapY=-1e3,lastTapTime=-1e4;C3$jscomp$234.Plugins.Touch.TouchInfo=class extends C3$jscomp$234.DefendedBase{constructor(){super(),this._pressure=this._height=this._width=this._lastY=this._lastX=this._y=this._x=this._startY=this._startX=this._lastTime=this._time=this._startTime=this._startIndex=this._pointerId=0,this._isTooFarForHold=this._hasTriggeredHold=!1}Release(){}Init(e,t,s,i,r){this._pointerId=i,this._startIndex=r,this._startTime=this._lastTime=this._time=e,this._startX=t,this._startY=s,this._x=t,this._y=s,this._lastX=t,this._lastY=s}Update(e,t,s,i,r,n){this._lastTime=this._time,this._time=e,this._lastX=this._x,this._lastY=this._y,this._x=t,this._y=s,this._width=i,this._height=r,this._pressure=n,!this._isTooFarForHold&&15<=C3$jscomp$234.distanceTo(this._startX,this._startY,this._x,this._y)&&(this._isTooFarForHold=!0)}GetId(){return this._pointerId}GetStartIndex(){return this._startIndex}GetTime(){return this._time}_SetLastTime(e){this._lastTime=e}GetX(){return this._x}GetY(){return this._y}GetSpeed(){const e=C3$jscomp$234.distanceTo(this._x,this._y,this._lastX,this._lastY),t=(this._time-this._lastTime)/1e3;return 0<t?e/t:0}GetAngle(){return C3$jscomp$234.angleTo(this._lastX,this._lastY,this._x,this._y)}GetWidth(){return this._width}GetHeight(){return this._height}GetPressure(){return this._pressure}ShouldTriggerHold(e){return!this._hasTriggeredHold&&(500<=e-this._startTime&&!this._isTooFarForHold&&15>C3$jscomp$234.distanceTo(this._startX,this._startY,this._x,this._y)&&(this._hasTriggeredHold=!0))}ShouldTriggerTap(e){return this._hasTriggeredHold?"":333>=e-this._startTime&&!this._isTooFarForHold&&15>C3$jscomp$234.distanceTo(this._startX,this._startY,this._x,this._y)?666>=e-lastTapTime&&25>C3$jscomp$234.distanceTo(lastTapX,lastTapY,this._x,this._y)?(lastTapY=lastTapX=-1e3,lastTapTime=-1e4,"double-tap"):(lastTapX=this._x,lastTapY=this._y,lastTapTime=e,"single-tap"):""}GetPositionForLayer(e,t,s){return void 0===t?e.GetLayerByIndex(0).CanvasCssToLayer_DefaultTransform(this._x,this._y)[s?0:1]:(e=e.GetLayer(t))?e.CanvasCssToLayer(this._x,this._y)[s?0:1]:0}};const C3$jscomp$235=self.C3,actionPromises=[];C3$jscomp$235.Plugins.Audio=class extends C3$jscomp$235.SDKPluginBase{constructor(e){super(e)}_AddActionPromise(e){actionPromises.push(e)}static async WaitForAllActionPromises(){await Promise.all(actionPromises),C3$jscomp$235.clearArray(actionPromises)}Release(){super.Release()}};const C3$jscomp$236=self.C3;function GetAudioDOMInterface(){if(self.C3Audio_DOMInterface)return self.C3Audio_DOMInterface;throw Error("audio scripting API cannot be used here - make sure the project is using DOM mode, not worker mode")}C3$jscomp$236.Plugins.Audio.Type=class extends C3$jscomp$236.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IAudioObjectType}},self.IAudioObjectType=class extends self.IObjectClass{constructor(e){super(e)}get audioContext(){return GetAudioDOMInterface().GetAudioContext()}get destinationNode(){return GetAudioDOMInterface().GetDestinationNode()}};const C3$jscomp$237=self.C3,LATENCY_HINTS=["interactive","balanced","playback"];C3$jscomp$237.Plugins.Audio.Instance=class extends C3$jscomp$237.SDKInstanceBase{constructor(e,t){super(e,"audio"),this._nextPlayTime=0,this._triggerTag="",this._saveLoadMode=this._timeScaleMode=0,this._playInBackground=!1,this._distanceModel=this._panningModel=1,this._listenerPos=[this._runtime.GetViewportWidth()/2,this._runtime.GetViewportHeight()/2,600],this._listenerForwardVec=[0,0,-1],this._listenerUpVec=[0,1,0],this._referenceDistance=600,this._maxDistance=1e4,this._rolloffFactor=1,this._listenerInst=null,this._loadListenerUid=-1,this._masterVolume=1,this._isSilent=!1,this._sampleRate=0,this._audioContextState="suspended",this._outputLatency=0,this._effectCount=new Map,this._preloadCount=this._preloadTotal=0,this._bufferMetadata=new Map,this._remoteUrls=new Map,e="interactive",t&&(this._timeScaleMode=t[0],this._saveLoadMode=t[1],this._playInBackground=t[2],e=LATENCY_HINTS[t[3]],this._panningModel=t[4],this._distanceModel=t[5],this._listenerPos[2]=t[6],this._referenceDistance=t[7],this._maxDistance=t[8],this._rolloffFactor=t[9]),this._lastAIState=[],this._lastFxState=[],this._lastAnalysersData=[],this.AddDOMMessageHandlers([["state",e=>this._OnUpdateState(e)],["audiocontext-state",e=>this._OnAudioContextStateChanged(e)],["fxstate",e=>this._OnUpdateFxState(e)],["trigger",e=>this._OnTrigger(e)],["buffer-metadata",e=>this._OnBufferMetadata(e)]]),t=this.GetRuntime().Dispatcher(),this._disposables=new C3$jscomp$237.CompositeDisposable(C3$jscomp$237.Disposable.From(t,"instancedestroy",(e=>this._OnInstanceDestroyed(e.instance))),C3$jscomp$237.Disposable.From(t,"afterload",(()=>this._OnAfterLoad())),C3$jscomp$237.Disposable.From(t,"suspend",(()=>this._OnSuspend())),C3$jscomp$237.Disposable.From(t,"resume",(()=>this._OnResume()))),this._runtime.AddLoadPromise(this.PostToDOMAsync("create-audio-context",{preloadList:this._runtime.GetAssetManager().GetAudioToPreload().map((e=>({originalUrl:e.originalUrl,url:e.url,type:e.type,fileSize:e.fileSize}))),isiOSCordova:this._runtime.IsiOSCordova(),isSafari:"Safari"===C3$jscomp$237.Platform.Browser,timeScaleMode:this._timeScaleMode,latencyHint:e,panningModel:this._panningModel,distanceModel:this._distanceModel,refDistance:this._referenceDistance,maxDistance:this._maxDistance,rolloffFactor:this._rolloffFactor,listenerPos:this._listenerPos}).then((e=>{this._sampleRate=e.sampleRate,this._audioContextState=e.audioContextState,this._outputLatency=e.outputLatency}))),this._StartTicking()}Release(){this._listenerInst=null,super.Release()}_AddActionPromise(e){this.GetPlugin()._AddActionPromise(e)}_OnInstanceDestroyed(e){this._listenerInst===e&&(this._listenerInst=null)}DbToLinearNoCap(e){return Math.pow(10,e/20)}DbToLinear(e){return e=this.DbToLinearNoCap(e),isFinite(e)?Math.max(Math.min(e,1),0):0}LinearToDbNoCap(e){return Math.log(e)/Math.log(10)*20}LinearToDb(e){return this.LinearToDbNoCap(Math.max(Math.min(e,1),0))}_OnSuspend(){this._playInBackground||this.PostToDOM("set-suspended",{isSuspended:!0})}_OnResume(){this._playInBackground||this.PostToDOM("set-suspended",{isSuspended:!1})}_OnUpdateState(e){const t=e.tickCount;this._outputLatency=e.outputLatency;const s=this._lastAIState.filter((e=>e.hasOwnProperty("placeholder")&&(e.placeholder>t||-1===e.placeholder)));this._lastAIState=e.audioInstances,this._lastAnalysersData=e.analysers,0<s.length&&C3$jscomp$237.appendArray(this._lastAIState,s)}_OnBufferMetadata(e){this._bufferMetadata.set(e.originalUrl,{duration:e.duration})}_OnAudioContextStateChanged(e){this._audioContextState=e.audioContextState}GetAudioContextState(){return this._runtime.IsExportToVideo()?"running":this._audioContextState}_OnUpdateFxState(e){this._lastFxState=e.fxstate}_GetFirstAudioStateByTag(e){for(const t of this._lastAIState)if(C3$jscomp$237.equalsNoCase(t.tag,e))return t;return null}_IsTagPlaying(e){return this._lastAIState.some((t=>C3$jscomp$237.equalsNoCase(e,t.tag)&&t.isPlaying))}_MaybeMarkAsPlaying(e,t,s,i,r){if(this._IsTagPlaying(t))return null;const n=this._bufferMetadata.get(e);return e={tag:t,duration:n?n.duration:0,volume:r,isPlaying:!0,playbackTime:0,playbackRate:1,uid:-1,bufferOriginalUrl:e,bufferUrl:"",bufferType:"",isMusic:s,isLooping:i,isMuted:!1,resumePosition:0,pan:null,placeholder:-1},this._lastAIState.push(e),e}async _OnTrigger(e){const t=e.type;if(this._triggerTag=e.tag,e=e.aiid,"ended"===t){for(const t of this._lastAIState)if(t.aiid===e){t.isPlaying=!1;break}await this.TriggerAsync(C3$jscomp$237.Plugins.Audio.Cnds.OnEnded)}else"fade-ended"===t&&await this.TriggerAsync(C3$jscomp$237.Plugins.Audio.Cnds.OnFadeEnded)}Tick(){const e={timeScale:this._runtime.GetTimeScale(),gameTime:this._runtime.GetGameTimeRaw(),instPans:this.GetInstancePans(),tickCount:this._runtime.GetTickCountNoSave()};if(this._listenerInst){const t=this._listenerInst.GetWorldInfo();this._listenerPos[0]=t.GetX(),this._listenerPos[1]=t.GetY(),e.listenerPos=this._listenerPos,e.listenerOrientation=[...this._listenerForwardVec,...this._listenerUpVec]}this.PostToDOM("tick",e)}rotatePtAround(e,t,s,i,r){if(0===s)return[e,t];const n=Math.sin(s),a=(e-=i)*n;return[(e=e*(s=Math.cos(s))-(t-=r)*n)+i,t*s+a+r]}GetInstancePans(){return this._lastAIState.filter((e=>-1!==e.uid)).map((e=>this._runtime.GetInstanceByUID(e.uid))).filter((e=>e)).map((e=>{const t=e.GetWorldInfo(),s=t.GetLayer().GetAngle(),[i,r]=this.rotatePtAround(t.GetX(),t.GetY(),-s,this._listenerPos[0],this._listenerPos[1]);return{uid:e.GetUID(),x:i,y:r,z:t.GetTotalZElevation(),angle:t.GetAngle()-s}}))}GetAnalyserData(e,t){for(const s of this._lastAnalysersData)if(s.index===t&&C3$jscomp$237.equalsNoCase(s.tag,e))return s;return null}_IncrementEffectCount(e){this._effectCount.set(e,(this._effectCount.get(e)||0)+1)}_ShouldSave(e){return!e.hasOwnProperty("placeholder")&&3!==this._saveLoadMode&&((!e.isMusic||1!==this._saveLoadMode)&&!(!e.isMusic&&2===this._saveLoadMode))}SaveToJson(){return{isSilent:this._isSilent,masterVolume:this._masterVolume,listenerZ:this._listenerPos[2],listenerForwardVec:this._listenerForwardVec,listenerUpVec:this._listenerUpVec,listenerUid:this._listenerInst?this._listenerInst.GetUID():-1,remoteUrls:[...this._remoteUrls.entries()],playing:this._lastAIState.filter((e=>this._ShouldSave(e))),effects:this._lastFxState,analysers:this._lastAnalysersData}}LoadFromJson(e){if(this._isSilent=e.isSilent,this._masterVolume=e.masterVolume,this._listenerPos[2]=e.listenerZ,this._listenerInst=null,this._loadListenerUid=e.listenerUid,e.hasOwnProperty("listenerForwardVec")?this._listenerForwardVec=e.listenerForwardVec:this._listenerForwardVec=[0,0,-1],e.hasOwnProperty("listenerUpVec")?this._listenerUpVec=e.listenerUpVec:this._listenerUpVec=[0,1,0],this._remoteUrls.clear(),e.remoteUrls)for(const[t,s]of e.remoteUrls)this._remoteUrls.set(t,s);this._lastAIState=e.playing,this._lastFxState=e.effects,this._lastAnalysersData=e.analysers}_OnAfterLoad(){if(-1!==this._loadListenerUid&&(this._listenerInst=this._runtime.GetInstanceByUID(this._loadListenerUid),this._loadListenerUid=-1,this._listenerInst)){var e=this._listenerInst.GetWorldInfo();this._listenerPos[0]=e.GetX(),this._listenerPos[1]=e.GetY()}for(var t of this._lastAIState)(e=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t.bufferOriginalUrl))?(t.bufferUrl=e.url,t.bufferType=e.type):t.bufferUrl=null;for(const e of Object.values(this._lastFxState))for(const s of e)s.hasOwnProperty("bufferOriginalUrl")&&(t=this._runtime.GetAssetManager().GetProjectAudioFileUrl(s.bufferOriginalUrl))&&(s.bufferUrl=t.url,s.bufferType=t.type);this.PostToDOM("load-state",{saveLoadMode:this._saveLoadMode,timeScale:this._runtime.GetTimeScale(),gameTime:this._runtime.GetGameTimeRaw(),listenerPos:this._listenerPos,listenerOrientation:[...this._listenerForwardVec,...this._listenerUpVec],isSilent:this._isSilent,masterVolume:this._masterVolume,playing:this._lastAIState.filter((e=>null!==e.bufferUrl)),effects:this._lastFxState})}GetDebuggerProperties(){const e=[];for(const[t,s]of Object.entries(this._lastFxState))e.push({name:"$"+t,value:s.map((e=>e.type)).join(", ")});return[{title:"plugins.audio.debugger.tag-effects",properties:e},{title:"plugins.audio.debugger.currently-playing",properties:[{name:"plugins.audio.debugger.currently-playing-count",value:this._lastAIState.length},...this._lastAIState.map(((e,t)=>({name:"$#"+t,value:`${e.bufferOriginalUrl} ("${e.tag}") ${Math.round(10*e.playbackTime)/10} / ${Math.round(10*e.duration)/10}`})))]}]}};const C3$jscomp$238=self.C3;C3$jscomp$238.Plugins.Audio.Cnds={OnEnded(e){return C3$jscomp$238.equalsNoCase(this._triggerTag,e)},OnFadeEnded(e){return C3$jscomp$238.equalsNoCase(this._triggerTag,e)},PreloadsComplete(){return this._preloadCount===this._preloadTotal},AdvancedAudioSupported:()=>!0,IsSilent(){return this._isSilent},IsAnyPlaying(){for(const e of this._lastAIState)if(e.isPlaying)return!0;return!1},IsTagPlaying(e){return this._IsTagPlaying(e)}};const C3$jscomp$239=self.C3,FILTER_TYPES="lowpass highpass bandpass lowshelf highshelf peaking notch allpass".split(" ");C3$jscomp$239.Plugins.Audio.Acts={Play(e,t,s,i,r){return e=C3$jscomp$239.Plugins.Audio.Acts._DoPlay.call(this,e,t,s,i,r),this._AddActionPromise(e),e},PlayFromTimeline(e,t,s,i){C3$jscomp$239.Plugins.Audio.Acts._DoPlay.call(this,e,0,t,0,s,i)},async _DoPlay(e,t,s,i,r,n){if(!this._isSilent){var a=e[1],o=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);if(o){var h=this._nextPlayTime;this._nextPlayTime=0;var l=this._MaybeMarkAsPlaying(e[0],r.toLowerCase(),a,0!==t,this.DbToLinear(s));try{await this.PostToDOMAsync("play",{originalUrl:e[0],url:o.url,type:o.type,isMusic:a,tag:r.toLowerCase(),isLooping:0!==t,vol:this.DbToLinear(s),stereoPan:C3$jscomp$239.clamp(i/100,-1,1),pos:n||0,off:h,trueClock:!!self.C3_GetAudioContextCurrentTime})}finally{l&&(l.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtPosition(e,t,s,i,r,n,a,o,h,l,c){if(!this._isSilent){var u=e[1],p=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);if(p){var _=this._nextPlayTime;this._nextPlayTime=0;var m=this._MaybeMarkAsPlaying(e[0],c.toLowerCase(),u,0!==t,this.DbToLinear(s));try{await this.PostToDOMAsync("play",{originalUrl:e[0],url:p.url,type:p.type,isMusic:u,tag:c.toLowerCase(),isLooping:0!==t,vol:this.DbToLinear(s),pos:0,off:_,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:i,y:r,z:n,angle:C3$jscomp$239.toRadians(a),innerAngle:C3$jscomp$239.toRadians(o),outerAngle:C3$jscomp$239.toRadians(h),outerGain:this.DbToLinear(l)}})}finally{m&&(m.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtObject(e,t,s,i,r,n,a,o){if(!this._isSilent&&i&&(i=i.GetFirstPicked())&&i.GetWorldInfo()){var h=i.GetWorldInfo(),l=h.GetLayer().GetAngle(),[c,u]=this.rotatePtAround(h.GetX(),h.GetY(),-l,this._listenerPos[0],this._listenerPos[1]),p=e[1],_=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);if(_){var m=this._nextPlayTime;this._nextPlayTime=0;var d=this._MaybeMarkAsPlaying(e[0],o.toLowerCase(),p,0!==t,this.DbToLinear(s));try{await this.PostToDOMAsync("play",{originalUrl:e[0],url:_.url,type:_.type,isMusic:p,tag:o.toLowerCase(),isLooping:0!==t,vol:this.DbToLinear(s),pos:0,off:m,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:c,y:u,z:h.GetTotalZElevation(),angle:h.GetAngle()-l,innerAngle:C3$jscomp$239.toRadians(r),outerAngle:C3$jscomp$239.toRadians(n),outerGain:this.DbToLinear(a),uid:i.GetUID()}})}finally{d&&(d.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayByName(e,t,s,i,r,n){if(!this._isSilent){e=1===e;var a=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());if(a){var o=this._nextPlayTime;this._nextPlayTime=0;var h=this._MaybeMarkAsPlaying(t,n.toLowerCase(),e,0!==s,this.DbToLinear(i));try{await this.PostToDOMAsync("play",{originalUrl:t,url:a.url,type:a.type,isMusic:e,tag:n.toLowerCase(),isLooping:0!==s,vol:this.DbToLinear(i),stereoPan:C3$jscomp$239.clamp(r/100,-1,1),pos:0,off:o,trueClock:!!self.C3_GetAudioContextCurrentTime})}finally{h&&(h.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtPositionByName(e,t,s,i,r,n,a,o,h,l,c,u){if(!this._isSilent){e=1===e;var p=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());if(p){var _=this._nextPlayTime;this._nextPlayTime=0;var m=this._MaybeMarkAsPlaying(t,u.toLowerCase(),e,0!==s,this.DbToLinear(i));try{await this.PostToDOMAsync("play",{originalUrl:t,url:p.url,type:p.type,isMusic:e,tag:u.toLowerCase(),isLooping:0!==s,vol:this.DbToLinear(i),pos:0,off:_,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:r,y:n,z:a,angle:C3$jscomp$239.toRadians(o),innerAngle:C3$jscomp$239.toRadians(h),outerAngle:C3$jscomp$239.toRadians(l),outerGain:this.DbToLinear(c)}})}finally{m&&(m.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtObjectByName(e,t,s,i,r,n,a,o,h){if(!this._isSilent&&!this._isSilent&&r&&(r=r.GetFirstPicked())&&r.GetWorldInfo()){var l=r.GetWorldInfo(),c=l.GetLayer().GetAngle(),[u,p]=this.rotatePtAround(l.GetX(),l.GetY(),-c,this._listenerPos[0],this._listenerPos[1]);e=1===e;var _=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());if(_){var m=this._nextPlayTime;this._nextPlayTime=0;var d=this._MaybeMarkAsPlaying(t,h.toLowerCase(),e,0!==s,this.DbToLinear(i));try{await this.PostToDOMAsync("play",{originalUrl:t,url:_.url,type:_.type,isMusic:e,tag:h.toLowerCase(),isLooping:0!==s,vol:this.DbToLinear(i),pos:0,off:m,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:u,y:p,z:l.GetTotalZElevation(),angle:l.GetAngle()-c,innerAngle:C3$jscomp$239.toRadians(n),outerAngle:C3$jscomp$239.toRadians(a),outerGain:this.DbToLinear(o),uid:r.GetUID()}})}finally{d&&(d.placeholder=this._runtime.GetTickCountNoSave())}}}},SetLooping(e,t){this.PostToDOM("set-looping",{tag:e.toLowerCase(),isLooping:0===t})},SetMuted(e,t){this.PostToDOM("set-muted",{tag:e.toLowerCase(),isMuted:0===t})},SetVolume(e,t){this.PostToDOM("set-volume",{tag:e.toLowerCase(),vol:this.DbToLinear(t)})},FadeVolume(e,t,s,i){this.PostToDOM("fade-volume",{tag:e.toLowerCase(),vol:this.DbToLinear(t),duration:s,stopOnEnd:0===i})},SetStereoPan(e,t){this.PostToDOM("set-stereo-pan",{tag:e.toLowerCase(),p:C3$jscomp$239.clamp(t/100,-1,1)})},async Preload(e){const t=e[1],s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);s&&(this._preloadTotal++,await this.PostToDOMAsync("preload",{originalUrl:e[0],url:s.url,type:s.type,isMusic:t}),this._preloadCount++)},async PreloadByName(e,t){e=1===e;const s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());s&&(this._preloadTotal++,await this.PostToDOMAsync("preload",{originalUrl:t,url:s.url,type:s.type,isMusic:e}),this._preloadCount++)},SetPlaybackRate(e,t){this.PostToDOM("set-playback-rate",{tag:e.toLowerCase(),rate:Math.max(t,0)})},Stop(e){this.PostToDOM("stop",{tag:e.toLowerCase()})},StopAll(){this.PostToDOM("stop-all")},SetPaused(e,t){this.PostToDOM("set-paused",{tag:e.toLowerCase(),paused:0===t})},Seek(e,t){this.PostToDOM("seek",{tag:e.toLowerCase(),pos:t})},SetSilent(e){2===e&&(e=this._isSilent?1:0),e=0===e,this._isSilent!==e&&(this._isSilent=e,this.PostToDOM("set-silent",{isSilent:e}))},SetMasterVolume(e){e=this.DbToLinear(e),this._masterVolume!==e&&(this._masterVolume=e,this.PostToDOM("set-master-volume",{vol:e}))},AddFilterEffect(e,t,s,i,r,n,a){e=e.toLowerCase(),t=FILTER_TYPES[t],this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"filter",tag:e,params:[t,s,i,r,n,C3$jscomp$239.clamp(a/100,0,1)]})},AddDelayEffect(e,t,s,i){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"delay",tag:e,params:[t,this.DbToLinear(s),C3$jscomp$239.clamp(i/100,0,1)]})},AddFlangerEffect(e,t,s,i,r,n){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"flanger",tag:e,params:[t/1e3,s/1e3,i,r/100,C3$jscomp$239.clamp(n/100,0,1)]})},AddPhaserEffect(e,t,s,i,r,n,a){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"phaser",tag:e,params:[t,s,i,r,n,C3$jscomp$239.clamp(a/100,0,1)]})},AddConvolutionEffect(e,t,s,i){e=e.toLowerCase();const r=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t[0]);r&&(this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"convolution",tag:e,bufferOriginalUrl:t[0],bufferUrl:r.url,bufferType:r.type,params:[0===s,C3$jscomp$239.clamp(i/100,0,1)]}))},AddGainEffect(e,t){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"gain",tag:e,params:[this.DbToLinear(t)]})},AddStereoPanEffect(e,t){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"stereopan",tag:e,params:[C3$jscomp$239.clamp(t/100,-1,1)]})},AddMuteEffect(e){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"gain",tag:e,params:[0]})},AddTremoloEffect(e,t,s){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"tremolo",tag:e,params:[t,C3$jscomp$239.clamp(s/100,0,1)]})},AddRingModEffect(e,t,s){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"ringmod",tag:e,params:[t,C3$jscomp$239.clamp(s/100,0,1)]})},AddDistortionEffect(e,t,s,i,r,n){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"distortion",tag:e,params:[this.DbToLinearNoCap(t),this.DbToLinearNoCap(s),i,this.DbToLinearNoCap(r),C3$jscomp$239.clamp(n/100,0,1)]})},AddCompressorEffect(e,t,s,i,r,n){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"compressor",tag:e,params:[t,s,i,r/1e3,n/1e3]})},AddAnalyserEffect(e,t,s){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"analyser",tag:e,params:[t,s]})},RemoveEffects(e){e=e.toLowerCase(),this._effectCount.set(e,0),this.PostToDOM("remove-effects",{tag:e}),this._lastFxState={}},SetEffectParameter(e,t,s,i,r,n){this.PostToDOM("set-effect-param",{tag:e.toLowerCase(),index:Math.floor(t),param:s,value:i,ramp:r,time:n})},SetListenerObject(e){e&&(e=e.GetFirstPicked())&&e.GetWorldInfo()&&(this._listenerInst=e)},SetListenerZ(e){this._listenerPos[2]=e},SetListenerOrientation(e,t,s,i,r,n){this._listenerForwardVec[0]=e,this._listenerForwardVec[1]=t,this._listenerForwardVec[2]=-s,this._listenerUpVec[0]=i,this._listenerUpVec[1]=r,this._listenerUpVec[2]=-n},ScheduleNextPlay(e){this._nextPlayTime=Math.max(e,0)},UnloadAudio(e){const t=e[1];(e=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]))&&this.PostToDOM("unload",{url:e.url,type:e.type,isMusic:t})},UnloadAudioByName(e,t){e=1===e,(t=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase()))&&this.PostToDOM("unload",{url:t.url,type:t.type,isMusic:e})},UnloadAll(){this.PostToDOM("unload-all")},AddRemoteURL(e,t,s){this._remoteUrls.set(s.toLowerCase(),{url:e,type:t})}},self.C3.Plugins.Audio.Exps={Duration(e){return(e=this._GetFirstAudioStateByTag(e))?e.duration:0},PlaybackTime(e){return(e=this._GetFirstAudioStateByTag(e))?e.playbackTime:0},PlaybackRate(e){return(e=this._GetFirstAudioStateByTag(e))?e.playbackRate:0},Volume(e){return(e=this._GetFirstAudioStateByTag(e))?this.LinearToDb(e.volume):0},MasterVolume(){return this.LinearToDb(this._masterVolume)},EffectCount(e){return this._effectCount.get(e.toLowerCase())||0},AnalyserFreqBinCount(e,t){return(e=this.GetAnalyserData(e,Math.floor(t)))?e.binCount:0},AnalyserFreqBinAt(e,t,s){return(e=this.GetAnalyserData(e,Math.floor(t)))?0>(s=Math.floor(s))||s>=e.binCount?0:e.freqBins[s]:0},AnalyserPeakLevel(e,t){return(e=this.GetAnalyserData(e,Math.floor(t)))?e.peak:0},AnalyserRMSLevel(e,t){return(e=this.GetAnalyserData(e,Math.floor(t)))?e.rms:0},SampleRate(){return this._sampleRate},CurrentTime:()=>self.C3_GetAudioContextCurrentTime?self.C3_GetAudioContextCurrentTime():performance.now()/1e3,OutputLatency(){return this._outputLatency}};const C3$jscomp$241=self.C3;C3$jscomp$241.Plugins.LocalStorage=class extends C3$jscomp$241.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$242=self.C3;C3$jscomp$242.Plugins.LocalStorage.Type=class extends C3$jscomp$242.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$243=self.C3;C3$jscomp$243.Plugins.LocalStorage.Instance=class extends C3$jscomp$243.SDKInstanceBase{constructor(e,t){super(e),this._lastValue=this._currentKey="",this._keyNamesList=[],this._errorMessage="",this._pendingSets=this._pendingGets=0,this._storage=this._runtime._GetProjectStorage(),this._debugCache=new Map,this._isLoadingDebugCache=!1}Release(){super.Release()}async _TriggerStorageError(e){this._errorMessage=this._GetErrorString(e),await this.TriggerAsync(C3$jscomp$243.Plugins.LocalStorage.Cnds.OnError)}_GetErrorString(e){return e?"string"==typeof e?e:"string"==typeof e.message?e.message:"string"==typeof e.name?e.name:"string"==typeof e.data?e.data:"unknown error":"unknown error"}GetDebuggerProperties(){return this._isLoadingDebugCache||this._DebugCacheStorage(),[{title:"plugins.localstorage.name",properties:[...this._debugCache.entries()].map((e=>({name:"$"+e[0],value:e[1],onedit:t=>this._storage.setItem(e[0],t)})))}]}async _DebugCacheStorage(){this._isLoadingDebugCache=!0;try{const e=await this._storage.keys();e.sort(((e,t)=>(e=e.toLowerCase())<(t=t.toLowerCase())?-1:t<e?1:0));const t=await Promise.all(e.map((e=>this._storage.getItem(e))));this._debugCache.clear();for(let s=0,i=e.length;s<i;++s)this._debugCache.set(e[s],t[s])}catch(e){}finally{this._isLoadingDebugCache=!1}}};const C3$jscomp$244=self.C3;C3$jscomp$244.Plugins.LocalStorage.Cnds={OnItemSet(e){return this._currentKey===e},OnAnyItemSet:()=>!0,OnItemGet(e){return this._currentKey===e},OnAnyItemGet:()=>!0,OnItemRemoved(e){return this._currentKey===e},OnAnyItemRemoved:()=>!0,OnCleared:()=>!0,OnAllKeyNamesLoaded:()=>!0,OnError:()=>!0,OnItemExists(e){return this._currentKey===e},OnItemMissing(e){return this._currentKey===e},CompareKey(e,t){return C3$jscomp$244.compare(this._currentKey,e,t)},CompareValue(e,t){return C3$jscomp$244.compare(this._lastValue,e,t)},IsProcessingSets(){return 0<this._pendingSets},IsProcessingGets(){return 0<this._pendingGets},OnAllSetsComplete:()=>!0,OnAllGetsComplete:()=>!0};const C3$jscomp$245=self.C3;function IsExpressionType(e){return"string"==typeof e||"number"==typeof e}C3$jscomp$245.Plugins.LocalStorage.Acts={async SetItem(e,t){this._pendingSets++;try{const s=await this._storage.setItem(e,t);await this.ScheduleTriggers((async()=>{this._currentKey=e,this._lastValue=s,await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnAnyItemSet),await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnItemSet)}))}catch(e){await this._TriggerStorageError(e)}finally{this._pendingSets--,0===this._pendingSets&&await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnAllSetsComplete)}},async SetBinaryItem(e,t){if(t&&(t=t.GetFirstPicked(this._inst))&&(t=t.GetSdkInstance())){t=t.GetArrayBufferReadOnly(),this._pendingSets++;try{await this._storage.setItem(e,t),await this.ScheduleTriggers((async()=>{this._currentKey=e,this._lastValue="",await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnAnyItemSet),await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnItemSet)}))}catch(e){await this._TriggerStorageError(e)}finally{this._pendingSets--,0===this._pendingSets&&await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnAllSetsComplete)}}},async GetItem(e){this._pendingGets++;try{const t=await this._storage.getItem(e);await this.ScheduleTriggers((async()=>{this._currentKey=e,this._lastValue=IsExpressionType(t)?t:"",await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnAnyItemGet),await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnItemGet)}))}catch(e){await this._TriggerStorageError(e)}finally{this._pendingGets--,0===this._pendingGets&&await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnAllGetsComplete)}},async GetBinaryItem(e,t){if(t&&(t=t.GetFirstPicked(this._inst))){var s=t.GetSdkInstance();this._pendingGets++;try{let t=await this._storage.getItem(e);t=t instanceof ArrayBuffer?t:new ArrayBuffer(0),await this.ScheduleTriggers((async()=>{this._lastValue="",this._currentKey=e,s.SetArrayBufferTransfer(t),await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnAnyItemGet),await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnItemGet)}))}catch(e){await this._TriggerStorageError(e)}finally{this._pendingGets--,0===this._pendingGets&&await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnAllGetsComplete)}}},async CheckItemExists(e){try{const t=await this._storage.getItem(e);await this.ScheduleTriggers((async()=>{this._currentKey=e,null==t?(this._lastValue="",await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnItemMissing)):(this._lastValue=IsExpressionType(t)?t:"",await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnItemExists))}))}catch(e){await this._TriggerStorageError(e)}},async RemoveItem(e){try{await this._storage.removeItem(e),await this.ScheduleTriggers((async()=>{this._currentKey=e,this._lastValue="",await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnAnyItemRemoved),await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnItemRemoved)}))}catch(e){await this._TriggerStorageError(e)}},async ClearStorage(){try{await this._storage.clear(),await this.ScheduleTriggers((async()=>{this._lastValue=this._currentKey="",C3$jscomp$245.clearArray(this._keyNamesList),await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnCleared)}))}catch(e){await this._TriggerStorageError(e)}},async GetAllKeyNames(){try{const e=await this._storage.keys();await this.ScheduleTriggers((async()=>{this._keyNamesList=e,await this.TriggerAsync(C3$jscomp$245.Plugins.LocalStorage.Cnds.OnAllKeyNamesLoaded)}))}catch(e){await this._TriggerStorageError(e)}}},self.C3.Plugins.LocalStorage.Exps={ItemValue(){return this._lastValue},Key(){return this._currentKey},KeyCount(){return this._keyNamesList.length},KeyAt(e){return 0>(e=Math.floor(e))||e>=this._keyNamesList.length?"":this._keyNamesList[e]},ErrorMessage(){return this._errorMessage}};const C3$jscomp$247=self.C3;C3$jscomp$247.Plugins.NinePatch=class extends C3$jscomp$247.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$248=self.C3;C3$jscomp$248.Plugins.NinePatch.Type=class extends C3$jscomp$248.SDKTypeBase{constructor(e){super(e),this._drawable=this._textureSet=null}Release(){this.ReleaseTextures(),super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}async LoadTextures(e){this._drawable=await this.GetImageInfo().ExtractImageToCanvas()}CreatePatch(e,t,s,i){!this._textureSet&&this._drawable&&(this._textureSet=new self.NinePatchTextureSet(this),this._textureSet.CreateTextures(this._drawable,e,t,s,i))}ReleaseTextures(){this._textureSet&&(this._textureSet.Release(),this._textureSet=null)}GetTextureSet(){return this._textureSet}};const C3$jscomp$249=self.C3,tempRect1=C3$jscomp$249.New(C3$jscomp$249.Rect),tempRect2$jscomp$2=C3$jscomp$249.New(C3$jscomp$249.Rect),tempQuad$jscomp$9=C3$jscomp$249.New(C3$jscomp$249.Quad);C3$jscomp$249.Plugins.NinePatch.Instance=class extends C3$jscomp$249.SDKWorldInstanceBase{constructor(e,t){super(e),this._bottomMargin=this._topMargin=this._rightMargin=this._leftMargin=16,this._fill=this._edges=1,this._isSeamless=!0,this._callback3d=null,t&&(this._leftMargin=t[0],this._rightMargin=t[1],this._topMargin=t[2],this._bottomMargin=t[3],this._edges=t[4],this._fill=t[5],this._isSeamless=!!t[8],this.GetWorldInfo().SetVisible(!!t[6])),this._sdkType.CreatePatch(this._leftMargin,this._rightMargin,this._topMargin,this._bottomMargin)}Release(){super.Release()}_Set3DCallback(e){this._callback3d=e}Draw(e){const t=this.GetWorldInfo(),s=t.GetBoundingQuad();this._Draw(e,s.getTlx(),s.getTly(),t.GetWidth(),t.GetHeight())}_Draw(e,t,s,i,r){let n=this._sdkType.GetTextureSet();if(!n&&(this._sdkType.CreatePatch(this._leftMargin,this._rightMargin,this._topMargin,this._bottomMargin),n=this._sdkType.GetTextureSet(),!n))return;const a=this._leftMargin,o=this._rightMargin,h=this._topMargin,l=this._bottomMargin;var c=n.GetImageWidth(),u=n.GetImageHeight();c-=o,u-=l;var p=this._isSeamless?1:0;const _=this._edges,m=this._fill;0<a&&0<h&&this._DrawPatch(e,n.GetTexture(),0,0,a+p,h+p,t,s,a+p,h+p),0<o&&0<h&&this._DrawPatch(e,n.GetTexture(),c-p,0,o+p,h+p,t+i-o-p,s,o+p,h+p),0<o&&0<l&&this._DrawPatch(e,n.GetTexture(),c-p,u-p,o+p,l+p,t+i-o-p,s+r-l-p,o+p,l+p),0<a&&0<l&&this._DrawPatch(e,n.GetTexture(),0,u-p,a+p,l+p,t,s+r-l-p,a+p,l+p),0===_?(p=2===m?0:p,0<a&&u>h&&this._TilePatch(e,n.GetLeftTexture(),t,s+h,a+p,r-h-l,0,0),0<o&&u>h&&this._TilePatch(e,n.GetRightTexture(),t+i-o-p,s+h,o+p,r-h-l,p,0),0<h&&c>a&&this._TilePatch(e,n.GetTopTexture(),t+a,s,i-a-o,h+p,0,0),0<l&&c>a&&this._TilePatch(e,n.GetBottomTexture(),t+a,s+r-l-p,i-a-o,l+p,0,p)):1===_&&(0<a&&u>h&&this._DrawPatch(e,n.GetTexture(),0,h,a,u-h,t,s+h,a,r-h-l),0<o&&u>h&&this._DrawPatch(e,n.GetTexture(),c,h,o,u-h,t+i-o,s+h,o,r-h-l),0<h&&c>a&&this._DrawPatch(e,n.GetTexture(),a,0,c-a,h,t+a,s,i-a-o,h),0<l&&c>a&&this._DrawPatch(e,n.GetTexture(),a,u,c-a,l,t+a,s+r-l,i-a-o,l)),u>h&&c>a&&(0===m?this._TilePatch(e,n.GetFillTexture(),t+a,s+h,i-a-o,r-h-l,0,0):1===m&&this._DrawPatch(e,n.GetTexture(),a,h,c-a,u-h,t+a,s+h,i-a-o,r-h-l))}_DrawPatch(e,t,s,i,r,n,a,o,h,l){const c=t.GetWidth(),u=t.GetHeight();e.SetTexture(t),tempRect1.set(a,o,a+h,o+l),tempRect2$jscomp$2.set(s/c,i/u,(s+r)/c,(i+n)/u),null===this._callback3d?(s=(i=(t=this.GetWorldInfo()).GetBoundingQuad()).getTlx(),i=i.getTly(),tempRect1.offset(-s,-i),tempQuad$jscomp$9.setFromRotatedRect(tempRect1,t.GetAngle()),tempQuad$jscomp$9.offset(s,i),e.Quad3(tempQuad$jscomp$9,tempRect2$jscomp$2)):this._callback3d(tempRect1,tempRect2$jscomp$2)}_TilePatch(e,t,s,i,r,n,a,o){const h=t.GetWidth(),l=t.GetHeight();e.SetTexture(t),tempRect1.set(s,i,s+r,i+n),tempRect2$jscomp$2.set(-a/h,-o/l,(r-a)/h,(n-o)/l),null===this._callback3d?(s=(i=(t=this.GetWorldInfo()).GetBoundingQuad()).getTlx(),i=i.getTly(),tempRect1.offset(-s,-i),tempQuad$jscomp$9.setFromRotatedRect(tempRect1,t.GetAngle()),tempQuad$jscomp$9.offset(s,i),e.Quad3(tempQuad$jscomp$9,tempRect2$jscomp$2)):this._callback3d(tempRect1,tempRect2$jscomp$2)}GetCurrentImageInfo(){this._objectClass.GetImageInfo()}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}},self.C3.Plugins.NinePatch.Cnds={},self.C3.Plugins.NinePatch.Acts={SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}},self.C3.Plugins.NinePatch.Exps={};const C3$jscomp$253=self.C3;function CloneDrawable(e){const t=C3$jscomp$253.CreateCanvas(e.width,e.height);return t.getContext("2d").drawImage(e,0,0),t}self.NinePatchTextureSet=class{constructor(e){this._sdkType=e,this._runtime=this._sdkType.GetRuntime(),this._bottomTexture=this._topTexture=this._rightTexture=this._leftTexture=this._fillTexture=this._texture=null,this._imageHeight=this._imageWidth=0,this._renderer=this._runtime.GetRenderer(),this._wasReleased=this._isLoading=!1}Release(){this._renderer.IsContextLost()||(this._renderer.DeleteTexture(this._texture),this._renderer.DeleteTexture(this._fillTexture),this._renderer.DeleteTexture(this._leftTexture),this._renderer.DeleteTexture(this._rightTexture),this._renderer.DeleteTexture(this._topTexture),this._renderer.DeleteTexture(this._bottomTexture)),this._renderer=this._sdkType=this._bottomTexture=this._topTexture=this._rightTexture=this._leftTexture=this._fillTexture=this._texture=null,this._wasReleased=!0}WasReleased(){return this._wasReleased}CreateTextures(e,t,s,i,r){this._SliceImage(e,t,s,i,r)}HasCreatedTextures(){return!!this._texture}_SliceImage(e,t,s,i,r){if(!this._wasReleased){var n=e.width,a=e.height;this._imageWidth=n,this._imageHeight=a;var o=n-s,h=a-r,l=this._runtime.GetSampling(),c=this._runtime.GetCanvasManager().GetTextureAnisotropy();this._texture=this._renderer.CreateStaticTexture(CloneDrawable(e),{sampling:l,anisotropy:c}),o>t&&h>i&&(this._fillTexture=this._renderer.CreateStaticTexture(this._SliceSubImage(CloneDrawable(e),t,i,o,h),{wrapX:"repeat",wrapY:"repeat",sampling:l,anisotropy:c})),0<t&&h>i&&(this._leftTexture=this._renderer.CreateStaticTexture(this._SliceSubImage(CloneDrawable(e),0,i,t,h),{wrapY:"repeat",sampling:l,anisotropy:c})),0<s&&h>i&&(this._rightTexture=this._renderer.CreateStaticTexture(this._SliceSubImage(CloneDrawable(e),o,i,n,h),{wrapY:"repeat",sampling:l,anisotropy:c})),0<i&&o>t&&(this._topTexture=this._renderer.CreateStaticTexture(this._SliceSubImage(CloneDrawable(e),t,0,o,i),{wrapX:"repeat",sampling:l,anisotropy:c})),0<r&&o>t&&(this._bottomTexture=this._renderer.CreateStaticTexture(this._SliceSubImage(CloneDrawable(e),t,h,o,a),{wrapX:"repeat",sampling:l,anisotropy:c}))}}_SliceSubImage(e,t,s,i,r){i-=t,r-=s;const n=C3$jscomp$253.CreateCanvas(i,r);return n.getContext("2d").drawImage(e,t,s,i,r,0,0,i,r),n}GetImageWidth(){return this._imageWidth}GetImageHeight(){return this._imageHeight}GetTexture(){return this._texture}GetFillTexture(){return this._fillTexture}GetLeftTexture(){return this._leftTexture}GetRightTexture(){return this._rightTexture}GetTopTexture(){return this._topTexture}GetBottomTexture(){return this._bottomTexture}};const C3$jscomp$254=self.C3,C3X$jscomp$26=self.C3X;let tempVec2a=null,tempVec2b=null,vec2RecycleCache=[],Box2D=null,physicsBehavior=null;function SetObjectTypeCollisionsEnabled(e,t,s){var i=e.GetSavedDataMap();const r=t.GetSavedDataMap();s?((i=i.get("Physics_DisabledCollisions"))&&i.delete(t.GetSID()),(t=r.get("Physics_DisabledCollisions"))&&t.delete(e.GetSID())):((s=i.get("Physics_DisabledCollisions"))||(s=new Set,i.set("Physics_DisabledCollisions",s)),(i=r.get("Physics_DisabledCollisions"))||(i=new Set,r.set("Physics_DisabledCollisions",i)),s.add(t.GetSID()),i.add(e.GetSID()))}C3$jscomp$254.Behaviors.Physics=class extends C3$jscomp$254.SDKBehaviorBase{constructor(e){e.scriptInterfaceClass=self.IPhysicsBehavior,super(e),this._world=null,this._worldG=10,this._worldScale=.02,this._worldManifold=null,this._lastUpdateTick=-1,this._steppingMode=1,this._velocityIterations=8,this._positionIterations=3,this._allCollisionsEnabled=!0,this._runtime.AddLoadPromise(this._LoadBox2DWasm())}async _LoadBox2DWasm(){const e=await this._runtime.GetAssetManager().GetProjectFileUrl("box2d.wasm");await new Promise((t=>{self.Box2DWasmModule({wasmBinaryFile:e}).then((e=>{Box2D=e,this._InitBox2DWorld(),t()}))}))}_InitBox2DWorld(){const e=this._runtime.GetCollisionEngine();tempVec2a=C3$jscomp$254.Behaviors.Physics.GetVec2(0,0),tempVec2b=C3$jscomp$254.Behaviors.Physics.GetVec2(0,0),this._world=new Box2D.b2World(C3$jscomp$254.Behaviors.Physics.GetTempVec2A(0,this._worldG),!0);var t=new Box2D.JSContactListener;t.BeginContact=t=>{var s=Box2D.wrapPointer(t,Box2D.b2Contact);t=C3$jscomp$254.Behaviors.Physics.Instance.LookupBehInstFromBody(s.GetFixtureA().GetBody()),s=C3$jscomp$254.Behaviors.Physics.Instance.LookupBehInstFromBody(s.GetFixtureB().GetBody()),e.RegisterCollision(t.GetObjectInstance(),s.GetObjectInstance())},t.EndContact=()=>{},t.PreSolve=()=>{},t.PostSolve=()=>{},this._world.SetContactListener(t),(t=new Box2D.JSContactFilter).ShouldCollide=(e,t)=>{if(this._allCollisionsEnabled)return!0;e=Box2D.wrapPointer(e,Box2D.b2Fixture),t=Box2D.wrapPointer(t,Box2D.b2Fixture),e=C3$jscomp$254.Behaviors.Physics.Instance.LookupBehInstFromBody(e.GetBody()),t=C3$jscomp$254.Behaviors.Physics.Instance.LookupBehInstFromBody(t.GetBody()),e=e.GetObjectInstance().GetObjectClass();const s=t.GetObjectInstance().GetObjectClass();t=e.GetSID();const i=s.GetSID();return(!(e=e.GetSavedDataMap().get("Physics_DisabledCollisions"))||!e.has(i))&&(!(e=s.GetSavedDataMap().get("Physics_DisabledCollisions"))||!e.has(t))},this._world.SetContactFilter(t),this._worldManifold=new Box2D.b2WorldManifold}Release(){super.Release()}GetBox2D(){return Box2D}GetWorld(){return this._world}GetWorldScale(){return this._worldScale}GetSteppingMode(){return this._steppingMode}SetSteppingMode(e){this._steppingMode=e}SetLastUpdateTick(e){this._lastUpdateTick=e}GetLastUpdateTick(){return this._lastUpdateTick}SetVelocityIterations(e){this._velocityIterations=Math.max(e,1)}GetVelocityIterations(){return this._velocityIterations}SetPositionIterations(e){this._positionIterations=Math.max(e,1)}GetPositionIterations(){return this._positionIterations}SetIterations(e,t){this.SetVelocityIterations(e),this.SetPositionIterations(t)}GetGravity(){return this._worldG}SetGravity(e){e!==this._worldG&&(this._world.SetGravity(C3$jscomp$254.Behaviors.Physics.GetTempVec2A(0,e)),this._worldG=e,this._WakeUpAllPhysicsBodies())}_WakeUpAllPhysicsBodies(){for(const t of this.GetInstances()){var e=C3$jscomp$254.Behaviors.Physics.Instance.LookupBehInstFromInst(t);e&&(e=e.GetBody())&&e.SetAwake(!0)}}DisableShouldCollideFastPath(){this._allCollisionsEnabled=!1}SetCollisionsEnabled(e,t,s){if(s=!!s,e&&t){if(t.IsFamily())for(const i of t.GetFamilyMembers())SetObjectTypeCollisionsEnabled(e,i,s);else SetObjectTypeCollisionsEnabled(e,t,s);this.DisableShouldCollideFastPath()}}GetWorldManifold(){return this._worldManifold}static GetPhysicsCollisionKey(){return"Physics_DisabledCollisions"}static GetVec2(e,t){if(vec2RecycleCache.length){const s=vec2RecycleCache.pop();return s.set_x(e),s.set_y(t),s}return new Box2D.b2Vec2(e,t)}static FreeVec2(e){vec2RecycleCache.push(e)}static GetTempVec2A(e,t){return tempVec2a.set_x(e),tempVec2a.set_y(t),tempVec2a}static GetTempVec2B(e,t){return tempVec2b.set_x(e),tempVec2b.set_y(t),tempVec2b}static CreatePolygonShape(e){const t=new Box2D.b2PolygonShape,s=Box2D._malloc(8*e.length);var i=0;for(let t=0;t<e.length;++t)Box2D.HEAPF32[s+i>>2]=e[t].get_x(),Box2D.HEAPF32[s+(i+4)>>2]=e[t].get_y(),i+=8;return i=Box2D.wrapPointer(s,Box2D.b2Vec2),t.Set(i,e.length),Box2D._free(s),t}};const STEPPING_MODES=["fixed","variable"];self.IPhysicsBehavior=class extends self.IBehavior{constructor(e){super(e),physicsBehavior=e}set worldGravity(e){C3X$jscomp$26.RequireFiniteNumber(e),physicsBehavior.SetGravity(e)}get worldGravity(){return physicsBehavior.GetGravity()}set steppingMode(e){if(0>(e=STEPPING_MODES.indexOf(e)))throw Error("invalid stepping mode");physicsBehavior.SetSteppingMode(STEPPING_MODES[e])}get steppingMode(){return STEPPING_MODES[physicsBehavior.GetSteppingMode()]}set velocityIterations(e){C3X$jscomp$26.RequireFiniteNumber(e),physicsBehavior.SetVelocityIterations(e)}get velocityIterations(){return physicsBehavior.GetVelocityIterations()}set positionIterations(e){C3X$jscomp$26.RequireFiniteNumber(e),physicsBehavior.SetPositionIterations(e)}get positionIterations(){return physicsBehavior.GetPositionIterations()}setCollisionsEnabled(e,t,s){const i=physicsBehavior.GetRuntime();e=i._UnwrapIObjectClass(e),t=i._UnwrapIObjectClass(t),physicsBehavior.SetCollisionsEnabled(e,t,!!s)}};const C3$jscomp$255=self.C3;C3$jscomp$255.Behaviors.Physics.Type=class extends C3$jscomp$255.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$256=self.C3,C3X$jscomp$27=self.C3X,IBehaviorInstance$jscomp$2=self.IBehaviorInstance,body2beh=new WeakMap,inst2beh=new WeakMap,tileConvexPolyCache=new WeakMap,GetTempVec2A=C3$jscomp$256.Behaviors.Physics.GetTempVec2A,GetTempVec2B=C3$jscomp$256.Behaviors.Physics.GetTempVec2B,tempRect$jscomp$14=C3$jscomp$256.New(C3$jscomp$256.Rect),tempQuad$jscomp$10=C3$jscomp$256.New(C3$jscomp$256.Quad);C3$jscomp$256.Behaviors.Physics.Instance=class extends C3$jscomp$256.SDKBehaviorInstanceBase{constructor(e,t){super(e),e=this.GetBehavior();const s=this.GetWorldInfo();this._box2d=e.GetBox2D(),this._world=e.GetWorld(),this._worldScale=e.GetWorldScale(),this._isImmovable=!1,this._actualCollisionMask=this._collisionMask=0,this._preventRotation=!1,this._density=1,this._friction=.5,this._restitution=.2,this._linearDamping=0,this._angularDamping=.01,this._isBullet=!1,this._isEnabled=!0,this._body=null,this._fixtures=[],this._myJoints=[],this._myCreatedJoints=[],this._joiningMe=new Set,this._lastKnownX=s.GetX(),this._lastKnownY=s.GetY(),this._lastKnownAngle=s.GetAngle(),this._lastHeight=this._lastWidth=0,this._lastTickOverride=!1,t&&(this._isImmovable=!!t[0],this._collisionMask=t[1],this._preventRotation=!!t[2],this._density=t[3],this._friction=t[4],this._restitution=t[5],this._linearDamping=t[6],this._angularDamping=t[7],this._isBullet=!!t[8],this._isEnabled=!!t[9]),t=this._runtime.Dispatcher(),this._disposables=new C3$jscomp$256.CompositeDisposable(C3$jscomp$256.Disposable.From(t,"instancedestroy",(e=>this._OnInstanceDestroyed(e.instance))),C3$jscomp$256.Disposable.From(t,"beforeload",(()=>this._OnBeforeLoad())),C3$jscomp$256.Disposable.From(t,"afterload",(()=>this._OnAfterLoad()))),inst2beh.set(this._inst,this),this._isEnabled&&this._StartTicking()}PostCreate(){this._CreateBody()}Release(){this._DestroyMyJoints(),C3$jscomp$256.clearArray(this._myCreatedJoints),this._joiningMe.clear(),this._body&&(this._DestroyFixtures(),this._world.DestroyBody(this._body),this._body=null),super.Release()}_CreateFixture(e){if(this._body)return e=this._body.CreateFixture(e),this._fixtures.push(e),e}_DestroyFixtures(){if(this._body){for(const e of this._fixtures)this._body.DestroyFixture(e);C3$jscomp$256.clearArray(this._fixtures)}}_GetBoundingQuadExcludingMesh(){const e=this.GetWorldInfo();return e.HasMesh()?(e.CalculateBbox(tempRect$jscomp$14,tempQuad$jscomp$10,!1),tempQuad$jscomp$10):e.GetBoundingQuad()}_Destroy(e){this._box2d.destroy(e)}_CreateBody(){if(this._isEnabled){var e=this._box2d.b2FixtureDef,t=this._box2d.b2BodyDef,s=this.GetWorldInfo(),i=s.HasOwnCollisionPoly();if(this._actualCollisionMask=this._collisionMask,i||this._inst.HasTilemap()||0!==this._actualCollisionMask||(this._actualCollisionMask=1),!this._body){(t=new t).set_type(this._isImmovable?0:2),i=s.GetX()*this._worldScale;var r=s.GetY()*this._worldScale;2===this._actualCollisionMask&&(i=(r=this._GetBoundingQuadExcludingMesh()).midX()*this._worldScale,r=r.midY()*this._worldScale),t.set_position(GetTempVec2B(i,r)),t.set_angle(s.GetAngle()),t.set_fixedRotation(this._preventRotation),t.set_linearDamping(this._linearDamping),t.set_angularDamping(this._angularDamping),t.set_bullet(this._isBullet),this._body=this._world.CreateBody(t),this._Destroy(t),body2beh.set(this._body,this)}this._DestroyFixtures(),(e=new e).set_density(this._density),e.set_friction(this._friction),e.set_restitution(this._restitution),t=Math.max(Math.abs(s.GetWidth()),1),i=Math.max(Math.abs(s.GetHeight()),1),0===this._actualCollisionMask?this._inst.HasTilemap()?this._CreateTilemapFixtures(e):this._CreatePolygonFixture(e,t,i):1===this._actualCollisionMask?this._CreateBoundingBoxFixture(e,s,t,i):this._CreateCircleFixture(e,t,i),this._lastWidth=s.GetWidth(),this._lastHeight=s.GetHeight(),s.SetPhysicsBodyChanged(!1),this._Destroy(e)}}_CreateBoundingBoxFixture(e,t,s,i){const r=new this._box2d.b2PolygonShape;s*=this._worldScale,i*=this._worldScale;const n=(.5-t.GetOriginX())*s;t=(.5-t.GetOriginY())*i,t=C3$jscomp$256.Behaviors.Physics.GetVec2(n,t),r.SetAsBox(s/2,i/2,t,0),e.set_shape(r),this._CreateFixture(e),this._Destroy(r),C3$jscomp$256.Behaviors.Physics.FreeVec2(t)}_CreateCircleFixture(e,t,s){const i=new this._box2d.b2CircleShape;i.set_m_radius(Math.min(t,s)*this._worldScale*.5),e.set_shape(i),this._CreateFixture(e),this._Destroy(i)}_CreatePolygonFixture(e,t,s){const i=this.GetWorldInfo();var r=0>i.GetWidth();const n=0>i.GetHeight(),a=this._worldScale,o=i.GetCustomTransformedCollisionPoly(r?-t:t,n?-s:s,0).pointsArr(),h=o.length/2,l=[];for(let e=0;e<h;++e)l.push(C3$jscomp$256.Behaviors.Physics.GetVec2(o[2*e],o[2*e+1]));r!==n&&l.reverse(),r=C3$jscomp$256.Behaviors.Physics.Separator.Separate(l,t*s);for(const e of l)C3$jscomp$256.Behaviors.Physics.FreeVec2(e);if(r.length)for(const s of r){for(const e of s)e.set_x(e.get_x()*a),e.set_y(e.get_y()*a);t=C3$jscomp$256.Behaviors.Physics.CreatePolygonShape(s),e.set_shape(t),this._CreateFixture(e),this._Destroy(t);for(const e of s)C3$jscomp$256.Behaviors.Physics.FreeVec2(e)}else this._CreateBoundingBoxFixture(e,i,t,s)}_CreateTilemapFixtures(e){const t=this._worldScale,s=C3$jscomp$256.Behaviors.Physics.GetVec2,i=C3$jscomp$256.Behaviors.Physics.FreeVec2,r=[];this._inst.GetSdkInstance().GetAllCollisionRects(r);const n=[];for(let c=0,u=r.length;c<u;++c){var a=r[c],o=a.GetRect(),h=a.GetPoly();if(h){var l=tileConvexPolyCache.get(h);if(!l){l=h.pointsArr();const e=h.pointCount();for(let t=0;t<e;++t)n.push(s(l[2*t],l[2*t+1]));(-2147483648===(a=3758096384&a.GetTileId())||1073741824===a||536870912===a||-2147483648&a&&1073741824&a&&536870912&a)&&n.reverse(),l=C3$jscomp$256.Behaviors.Physics.Separator.Separate(n,o.width()*o.height()),tileConvexPolyCache.set(h,l);for(const e of n)i(e);C3$jscomp$256.clearArray(n)}for(let r=0,a=l.length;r<a;++r){for(let e=0,i=(h=l[r]).length;e<i;++e)n.push(s((o.getLeft()+h[e].get_x())*t,(o.getTop()+h[e].get_y())*t));h=C3$jscomp$256.Behaviors.Physics.CreatePolygonShape(n),e.set_shape(h),this._CreateFixture(e),this._Destroy(h);for(const e of n)i(e);C3$jscomp$256.clearArray(n)}}else n.push(s(o.getLeft()*t,o.getTop()*t)),n.push(s(o.getRight()*t,o.getTop()*t)),n.push(s(o.getRight()*t,o.getBottom()*t)),n.push(s(o.getLeft()*t,o.getBottom()*t)),o=C3$jscomp$256.Behaviors.Physics.CreatePolygonShape(n),e.set_shape(o),this._CreateFixture(e),this._Destroy(o);for(const e of n)i(e);C3$jscomp$256.clearArray(n)}}_DestroyBody(){this._body&&(this._DestroyMyJoints(),body2beh.delete(this._body),this._DestroyFixtures(),this._world.DestroyBody(this._body),this._body=null)}_DestroyMyJoints(){for(const e of this._myJoints)this._world.DestroyJoint(e);C3$jscomp$256.clearArray(this._myJoints)}_RecreateMyJoints(){for(const e of this._myCreatedJoints)switch(e.type){case 0:this._DoCreateDistanceJoint(...e.params);break;case 1:this._DoCreateRevoluteJoint(...e.params);break;case 2:this._DoCreateLimitedRevoluteJoint(...e.params);break;case 3:this._DoCreatePrismaticJoint(...e.params)}}_GetInstImagePoint(e){var t=this.GetWorldInfo();return-1===e?[t.GetX(),t.GetY()]:0===e&&this._body?(e=this._body.GetPosition(),t=this._body.GetLocalCenter(),[(e.get_x()+t.get_x())/this._worldScale,(e.get_y()+t.get_y())/this._worldScale]):this._inst.GetImagePoint(e)}_CreateDistanceJoint(e,t,s,i,r){if(this._isEnabled&&t&&t!==this._inst){var n=C3$jscomp$256.Behaviors.Physics.Instance.LookupBehInstFromInst(t);n&&n._IsEnabled()&&(this._myCreatedJoints.push({type:0,params:[e,t.GetUID(),s,i,r]}),this._DoCreateDistanceJoint(e,t.GetUID(),s,i,r))}}_DoCreateDistanceJoint(e,t,s,i,r){if(this._isEnabled){var n=this._runtime.GetInstanceByUID(t);if(n&&n!==this._inst&&(t=C3$jscomp$256.Behaviors.Physics.Instance.LookupBehInstFromInst(n))&&t._IsEnabled()){t._joiningMe.add(this._inst),this._UpdateBodyToMatchInstance(!1),t._UpdateBodyToMatchInstance(!1);var[a,o]=this._GetInstImagePoint(e),[h,l]=n.GetImagePoint(s);e=a-h,s=o-l,n=this._worldScale;var c=new this._box2d.b2DistanceJointDef;c.Initialize(this._body,t.GetBody(),GetTempVec2A(a*n,o*n),GetTempVec2B(h*n,l*n)),c.set_length(Math.hypot(e,s)*n),c.set_dampingRatio(i),c.set_frequencyHz(r),this._myJoints.push(this._world.CreateJoint(c)),this._Destroy(c)}}}_CreateRevoluteJoint(e,t){if(this._isEnabled&&t&&t!==this._inst){var s=C3$jscomp$256.Behaviors.Physics.Instance.LookupBehInstFromInst(t);s&&s._IsEnabled()&&(this._myCreatedJoints.push({type:1,params:[e,t.GetUID()]}),this._DoCreateRevoluteJoint(e,t.GetUID()))}}_DoCreateRevoluteJoint(e,t){if(this._isEnabled&&(t=this._runtime.GetInstanceByUID(t))&&t!==this._inst&&(t=C3$jscomp$256.Behaviors.Physics.Instance.LookupBehInstFromInst(t))&&t._IsEnabled()){t._joiningMe.add(this._inst),this._UpdateBodyToMatchInstance(!1),t._UpdateBodyToMatchInstance(!1);var[s,i]=this._GetInstImagePoint(e);e=this._worldScale;var r=new this._box2d.b2RevoluteJointDef;r.Initialize(this._body,t.GetBody(),GetTempVec2A(s*e,i*e)),this._myJoints.push(this._world.CreateJoint(r)),this._Destroy(r)}}_CreateLimitedRevoluteJoint(e,t,s,i){if(this._isEnabled&&t&&t!==this._inst){var r=C3$jscomp$256.Behaviors.Physics.Instance.LookupBehInstFromInst(t);r&&r._IsEnabled()&&(s=C3$jscomp$256.toDegrees(s),i=C3$jscomp$256.toDegrees(i),this._myCreatedJoints.push({type:2,params:[e,t.GetUID(),s,i]}),this._DoCreateLimitedRevoluteJoint(e,t.GetUID(),s,i))}}_DoCreateLimitedRevoluteJoint(e,t,s,i){if(this._isEnabled&&(t=this._runtime.GetInstanceByUID(t))&&t!==this._inst&&(t=C3$jscomp$256.Behaviors.Physics.Instance.LookupBehInstFromInst(t))&&t._IsEnabled()){t._joiningMe.add(this._inst),this._UpdateBodyToMatchInstance(!1),t._UpdateBodyToMatchInstance(!1);var[r,n]=this._GetInstImagePoint(e);e=this._worldScale;var a=new this._box2d.b2RevoluteJointDef;a.Initialize(this._body,t.GetBody(),GetTempVec2A(r*e,n*e)),a.set_enableLimit(!0),a.set_lowerAngle(C3$jscomp$256.toRadians(s)),a.set_upperAngle(C3$jscomp$256.toRadians(i)),this._myJoints.push(this._world.CreateJoint(a)),this._Destroy(a)}}_CreatePrismaticJoint(e,t,s,i,r,n,a,o,h){if(this._isEnabled&&t&&t!==this._inst){var l=C3$jscomp$256.Behaviors.Physics.Instance.LookupBehInstFromInst(t);l&&l._IsEnabled()&&(s=C3$jscomp$256.toDegrees(s),o=C3$jscomp$256.toDegrees(o),this._myCreatedJoints.push({type:3,params:[e,t.GetUID(),s,i,r,n,a,o,h]}),this._DoCreatePrismaticJoint(e,t.GetUID(),s,i,r,n,a,o,h))}}_DoCreatePrismaticJoint(e,t,s,i,r,n,a,o,h){if(this._isEnabled&&(t=this._runtime.GetInstanceByUID(t))&&t!==this._inst&&(t=C3$jscomp$256.Behaviors.Physics.Instance.LookupBehInstFromInst(t))&&t._IsEnabled()){t._joiningMe.add(this._inst),this._UpdateBodyToMatchInstance(!1),t._UpdateBodyToMatchInstance(!1);var[l,c]=this._GetInstImagePoint(e);s=C3$jscomp$256.toRadians(s),e=Math.cos(s),s=Math.sin(s);var u=this._worldScale,p=new this._box2d.b2PrismaticJointDef;p.Initialize(this._body,t.GetBody(),GetTempVec2A(l*u,c*u),GetTempVec2B(e,s)),p.set_enableLimit(!!i),p.set_lowerTranslation(r*u),p.set_upperTranslation(n*u),p.set_enableMotor(!!a),p.set_motorSpeed(C3$jscomp$256.toRadians(o)),p.set_maxMotorForce(h),this._myJoints.push(this._world.CreateJoint(p)),this._Destroy(p)}}_RemoveJoints(){this._isEnabled&&(this._DestroyMyJoints(),C3$jscomp$256.clearArray(this._myCreatedJoints),this._joiningMe.clear())}_OnInstanceDestroyed(e){const t=e.GetUID();let s=0;for(let e=0,i=this._myCreatedJoints.length;e<i;++e)this._myCreatedJoints[s]=this._myCreatedJoints[e],s<this._myJoints.length&&(this._myJoints[s]=this._myJoints[e]),this._myCreatedJoints[e].params[1]===t?e<this._myJoints.length&&this._world.DestroyJoint(this._myJoints[e]):++s;C3$jscomp$256.truncateArray(this._myCreatedJoints,s),s<this._myJoints.length&&C3$jscomp$256.truncateArray(this._myJoints,s),this._joiningMe.delete(e)}GetBody(){return this._body}static LookupBehInstFromBody(e){return body2beh.get(e)||null}static LookupBehInstFromInst(e){return inst2beh.get(e)||null}SaveToJson(){const e={e:this._isEnabled,pr:this._preventRotation,d:this._density,fr:this._friction,re:this._restitution,ld:this._linearDamping,ad:this._angularDamping,b:this._isBullet,mcj:this._myCreatedJoints};if(this._isEnabled){const t=this._body.GetLinearVelocity();e.vx=t.get_x(),e.vy=t.get_y(),e.om=this._body.GetAngularVelocity()}return e}_OnBeforeLoad(){this._DestroyMyJoints(),C3$jscomp$256.clearArray(this._myCreatedJoints),this._joiningMe.clear()}LoadFromJson(e){this._DestroyBody(),this._isEnabled=e.e,this._preventRotation=e.pr,this._density=e.d,this._friction=e.fr,this._restitution=e.re,this._linearDamping=e.ld,this._angularDamping=e.ad,this._isBullet=e.b,this._myCreatedJoints=e.mcj;const t=this.GetWorldInfo();this._lastKnownX=t.GetX(),this._lastKnownY=t.GetY(),this._lastKnownAngle=t.GetAngle(),this._lastWidth=t.GetWidth(),this._lastHeight=t.GetHeight(),this._isEnabled&&(this._CreateBody(),this._body.SetLinearVelocity(GetTempVec2A(e.vx,e.vy)),this._body.SetAngularVelocity(e.om),0===e.vx&&0===e.vy&&0===e.om||this._body.SetAwake(!0),this._myCreatedJoints=e.mcj),this._isEnabled?this._StartTicking():this._StopTicking()}_OnAfterLoad(){this._isEnabled&&this._RecreateMyJoints()}Tick(){if(this._isEnabled){var e=this._runtime,t=this.GetBehavior();if(0===t.GetSteppingMode())var s=e.GetTimeScale()/60;else(s=e.GetDt(this._inst))>1/30&&(s=1/30);var i=e.GetTickCountNoSave();if(i>t.GetLastUpdateTick()&&0<e.GetTimeScale()){let r=0;(e=this._runtime.IsDebug())&&(r=performance.now()),0!==s&&this._world.Step(s,t.GetVelocityIterations(),t.GetPositionIterations()),this._world.ClearForces(),e&&self.C3Debugger.AddPhysicsTime(performance.now()-r),t.SetLastUpdateTick(i)}this._UpdateBodyToMatchInstance(!0)}}_UpdateBodyToMatchInstance(e){const t=this._inst.GetWorldInfo();var s=this._worldScale;(t.GetWidth()!==this._lastWidth||t.GetHeight()!==this._lastHeight||t.IsPhysicsBodyChanged())&&this._CreateBody();var i=this._body,r=t.GetX(),n=t.GetY(),a=r-this._lastKnownX;const o=n-this._lastKnownY,h=.001<Math.abs(a)||.001<Math.abs(o),l=t.GetAngle()!==this._lastKnownAngle;2===this._actualCollisionMask&&(r=(n=this._GetBoundingQuadExcludingMesh()).midX(),n=n.midY()),h?(l?i.SetTransform(GetTempVec2A(r*s,n*s),t.GetAngle()):i.SetTransform(GetTempVec2A(r*s,n*s),i.GetAngle()),e&&(i.SetLinearVelocity(GetTempVec2A(a,o)),this._lastTickOverride=!0),i.SetAwake(!0)):e&&this._lastTickOverride&&(this._lastTickOverride=!1,i.SetLinearVelocity(GetTempVec2A(0,0)),i.SetTransform(GetTempVec2A(r*s,n*s),i.GetAngle())),!h&&l&&(i.SetTransform(i.GetPosition(),t.GetAngle()),i.SetAwake(!0)),e=(a=i.GetPosition()).get_x()/s,s=a.get_y()/s,i=i.GetAngle(),e===t.GetX()&&s===t.GetY()&&i===t.GetAngle()||(t.SetXY(e,s),t.SetAngle(i),t.SetBboxChanged(),2===this._actualCollisionMask&&(i=(s=this._GetBoundingQuadExcludingMesh()).midX()-t.GetX(),s=s.midY()-t.GetY(),0!==i||0!==s)&&(t.OffsetXY(-i,-s),t.SetBboxChanged())),this._lastKnownX=t.GetX(),this._lastKnownY=t.GetY(),this._lastKnownAngle=t.GetAngle()}GetPropertyValueByIndex(e){switch(e){case 2:return this._IsPreventRotate();case 3:return this._GetDensity();case 4:return this._GetFriction();case 5:return this._GetElasticity();case 6:return this._GetLinearDamping();case 7:return this._GetAngularDamping();case 8:return this._IsBullet();case 9:return this._IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case 2:this._SetPreventRotate(t);break;case 3:this._SetDensity(t);break;case 4:this._SetFriction(t);break;case 5:this._SetElasticity(t);break;case 6:this._SetLinearDamping(t);break;case 7:this._SetAngularDamping(t);break;case 8:this._SetBullet(t);break;case 9:this._SetEnabled(t)}}_SetEnabled(e){e=!!e,this._isEnabled&&!e?(this._DestroyBody(),this._isEnabled=!1,this._StopTicking()):!this._isEnabled&&e&&(this._isEnabled=!0,this._CreateBody(),this._StartTicking())}_IsEnabled(){return this._isEnabled}GetDebuggerProperties(){const e=[{name:"behaviors.physics.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)},{name:"behaviors.physics.properties.immovable.name",value:this._IsImmovable(),onedit:e=>this._SetImmovable(e)},{name:"behaviors.physics.properties.density.name",value:this._GetDensity(),onedit:e=>this._SetDensity(e)},{name:"behaviors.physics.properties.friction.name",value:this._GetFriction(),onedit:e=>this._SetFriction(e)},{name:"behaviors.physics.properties.elasticity.name",value:this._GetElasticity(),onedit:e=>this._SetElasticity(e)},{name:"behaviors.physics.properties.linear-damping.name",value:this._GetLinearDamping(),onedit:e=>this._SetLinearDamping(e)},{name:"behaviors.physics.properties.angular-damping.name",value:this._GetAngularDamping(),onedit:e=>this._SetAngularDamping(e)}];return this._isEnabled&&(e.push({name:"behaviors.physics.debugger.is-sleeping",value:this._IsSleeping()}),e.push({name:"behaviors.physics.debugger.velocity-x",value:this._GetVelocityX(),onedit:e=>this._SetVelocity(e,this._GetVelocityY())}),e.push({name:"behaviors.physics.debugger.velocity-y",value:this._GetVelocityY(),onedit:e=>this._SetVelocity(this._GetVelocityX(),e)}),e.push({name:"behaviors.physics.debugger.angular-velocity",value:C3$jscomp$256.toDegrees(this._GetAngularVelocity()),onedit:e=>this._SetAngularVelocity(C3$jscomp$256.toRadians(e))}),e.push({name:"behaviors.physics.debugger.mass",value:this._GetMass()})),[{title:"$"+this.GetBehaviorType().GetName(),properties:e}]}_ApplyForce(e,t,s){const[i,r]=this._GetInstImagePoint(s);this._DoApplyForce(e,t,i,r)}_ApplyForceToward(e,t,s,i){const[r,n]=this._GetInstImagePoint(i);t=C3$jscomp$256.angleTo(r,n,t,s),this._DoApplyForce(Math.cos(t)*e,Math.sin(t)*e,r,n)}_ApplyForceAtAngle(e,t,s){const[i,r]=this._GetInstImagePoint(s);this._DoApplyForce(Math.cos(t)*e,Math.sin(t)*e,i,r)}_DoApplyForce(e,t,s,i){if(this._isEnabled){var r=this._worldScale;this._body.ApplyForce(GetTempVec2A(e,t),GetTempVec2B(s*r,i*r),!0)}}_ApplyImpulse(e,t,s){const[i,r]=this._GetInstImagePoint(s);this._DoApplyImpulse(e,t,i,r)}_ApplyImpulseToward(e,t,s,i){const[r,n]=this._GetInstImagePoint(i);t=C3$jscomp$256.angleTo(r,n,t,s),this._DoApplyImpulse(Math.cos(t)*e,Math.sin(t)*e,r,n)}_ApplyImpulseAtAngle(e,t,s){const[i,r]=this._GetInstImagePoint(s);this._DoApplyImpulse(Math.cos(t)*e,Math.sin(t)*e,i,r)}_DoApplyImpulse(e,t,s,i){if(this._isEnabled){var r=this._worldScale;this._body.ApplyLinearImpulse(GetTempVec2A(e,t),GetTempVec2B(s*r,i*r),!0),e=this.GetWorldInfo(),this._lastKnownX=e.GetX(),this._lastKnownY=e.GetY(),this._lastTickOverride=!1}}_ApplyTorque(e){this._isEnabled&&this._body.ApplyTorque(e,!0)}_ApplyTorqueToAngle(e,t){t=C3$jscomp$256.angleClockwise(this.GetWorldInfo().GetAngle(),t)?-1:1,this._ApplyTorque(e*t)}_ApplyTorqueToPosition(e,t,s){var i=this.GetWorldInfo();t=C3$jscomp$256.angleTo(i.GetX(),i.GetY(),t,s),i=C3$jscomp$256.angleClockwise(i.GetAngle(),t)?-1:1,this._ApplyTorque(e*i)}_SetAngularVelocity(e){this._isEnabled&&(this._body.SetAngularVelocity(e),this._body.SetAwake(!0))}_GetAngularVelocity(){return this._isEnabled?this._body.GetAngularVelocity():0}_SetVelocity(e,t){if(this._isEnabled){var s=this._worldScale;this._body.SetLinearVelocity(GetTempVec2A(e*s,t*s)),this._body.SetAwake(!0),e=this.GetWorldInfo(),this._lastKnownX=e.GetX(),this._lastKnownY=e.GetY(),this._lastTickOverride=!1}}_GetVelocity(){if(!this._isEnabled)return[0,0];const e=this._worldScale,t=this._body.GetLinearVelocity();return[t.get_x()/e,t.get_y()/e]}_GetVelocityX(){return this._isEnabled?this._body.GetLinearVelocity().get_x()/this._worldScale:0}_GetVelocityY(){return this._isEnabled?this._body.GetLinearVelocity().get_y()/this._worldScale:0}_SetDensity(e){if(this._isEnabled&&this._density!==e){this._density=e;for(const t of this._fixtures)t.SetDensity(e);this._body.ResetMassData()}}_GetDensity(){return this._isEnabled?this._density:0}_SetFriction(e){if(this._isEnabled&&this._friction!==e){for(var t of(this._friction=e,this._fixtures))t.SetFriction(e);for(e=this._body.GetContactList();this._box2d.getPointer(e);e=e.get_next())(t=e.get_contact())&&t.ResetFriction()}}_GetFriction(){return this._isEnabled?this._friction:0}_SetElasticity(e){if(this._isEnabled&&this._restitution!==e){this._restitution=e;for(const t of this._fixtures)t.SetRestitution(e)}}_GetElasticity(){return this._isEnabled?this._restitution:0}_SetLinearDamping(e){this._isEnabled&&this._linearDamping!==e&&(this._linearDamping=e,this._body.SetLinearDamping(e))}_GetLinearDamping(){return this._isEnabled?this._linearDamping:0}_SetAngularDamping(e){this._isEnabled&&this._angularDamping!==e&&(this._angularDamping=e,this._body.SetAngularDamping(e))}_GetAngularDamping(){return this._isEnabled?this._angularDamping:0}_SetImmovable(e){this._isEnabled&&(e=!!e,this._isImmovable!==e&&(this._isImmovable=e,this._body.SetType(this._isImmovable?0:2),this._body.SetAwake(!0)))}_IsImmovable(){return this._isImmovable}_SetPreventRotate(e){this._isEnabled&&(e=!!e,this._preventRotation!==e&&(this._preventRotation=e,this._body.SetFixedRotation(this._preventRotation),this._body.SetAngularVelocity(0),this._body.SetAwake(!0)))}_IsPreventRotate(){return this._preventRotation}_SetBullet(e){this._isEnabled&&(e=!!e,this._isBullet!==e&&(this._isBullet=e,this._body.SetBullet(this._isBullet),this._body.SetAwake(!0)))}_IsBullet(){return this._isBullet}_GetMass(){return this._isEnabled?this._body.GetMass()/this._worldScale:0}_GetCenterOfMassX(){return this._isEnabled?(this._body.GetPosition().get_x()+this._body.GetLocalCenter().get_x())/this._worldScale:0}_GetCenterOfMassY(){return this._isEnabled?(this._body.GetPosition().get_y()+this._body.GetLocalCenter().get_y())/this._worldScale:0}_GetCenterOfMass(){if(!this._isEnabled)return[0,0];const e=this._body.GetPosition(),t=this._body.GetLocalCenter(),s=this._worldScale;return[(e.get_x()+t.get_x())/s,(e.get_y()+t.get_y())/s]}_IsSleeping(){return!!this._isEnabled&&!this._body.IsAwake()}_GetContactCount(){if(!this._isEnabled)return 0;let e=0;for(let s=this._body.GetContactList();this._box2d.getPointer(s);s=s.get_next()){var t=s.get_contact();t&&(e+=t=t.GetManifold().get_pointCount())}return e}_GetContactPositionAt(e){if(e=Math.floor(e),!this._isEnabled)return[0,0];var t=0;for(let i=this._body.GetContactList();this._box2d.getPointer(i);i=i.get_next()){var s=i.get_contact();if(!s)continue;const r=s.GetManifold().get_pointCount();if(e>=t&&e<t+r)return e-=t,t=this.GetBehavior().GetWorldManifold(),s.GetWorldManifold(t),[(s=t.get_points(e)).get_x()/this._worldScale,s.get_y()/this._worldScale];t+=r}return[0,0]}GetScriptInterfaceClass(){return self.IPhysicsBehaviorInstance}};const map$jscomp$23=new WeakMap;function UnwrapIWorldInstance(e,t){return map$jscomp$23.get(e).GetRuntime()._UnwrapIWorldInstance(t)}self.IPhysicsBehaviorInstance=class extends IBehaviorInstance$jscomp$2{constructor(){super(),map$jscomp$23.set(this,IBehaviorInstance$jscomp$2._GetInitInst().GetSdkInstance())}get isEnabled(){return map$jscomp$23.get(this)._IsEnabled()}set isEnabled(e){map$jscomp$23.get(this)._SetEnabled(e)}applyForce(e,t,s=0){C3X$jscomp$27.RequireFiniteNumber(e),C3X$jscomp$27.RequireFiniteNumber(t),map$jscomp$23.get(this)._ApplyForce(e,t,s)}applyForceTowardPosition(e,t,s,i=0){C3X$jscomp$27.RequireFiniteNumber(e),C3X$jscomp$27.RequireFiniteNumber(t),C3X$jscomp$27.RequireFiniteNumber(s),map$jscomp$23.get(this)._ApplyForceToward(e,t,s,i)}applyForceAtAngle(e,t,s=0){C3X$jscomp$27.RequireFiniteNumber(e),C3X$jscomp$27.RequireFiniteNumber(t),map$jscomp$23.get(this)._ApplyForceAtAngle(e,t,s)}applyImpulse(e,t,s=0){C3X$jscomp$27.RequireFiniteNumber(e),C3X$jscomp$27.RequireFiniteNumber(t),map$jscomp$23.get(this)._ApplyImpulse(e,t,s)}applyImpulseTowardPosition(e,t,s,i=0){C3X$jscomp$27.RequireFiniteNumber(e),C3X$jscomp$27.RequireFiniteNumber(t),C3X$jscomp$27.RequireFiniteNumber(s),map$jscomp$23.get(this)._ApplyImpulseToward(e,t,s,i)}applyImpulseAtAngle(e,t,s=0){C3X$jscomp$27.RequireFiniteNumber(e),C3X$jscomp$27.RequireFiniteNumber(t),map$jscomp$23.get(this)._ApplyImpulseAtAngle(e,t,s)}applyTorque(e){C3X$jscomp$27.RequireFiniteNumber(e),map$jscomp$23.get(this)._ApplyTorque(e)}applyTorqueToAngle(e,t){C3X$jscomp$27.RequireFiniteNumber(e),C3X$jscomp$27.RequireFiniteNumber(t),map$jscomp$23.get(this)._ApplyTorqueToAngle(e,t)}applyTorqueToPosition(e,t,s){C3X$jscomp$27.RequireFiniteNumber(e),C3X$jscomp$27.RequireFiniteNumber(t),C3X$jscomp$27.RequireFiniteNumber(s),map$jscomp$23.get(this)._ApplyTorqueToPosition(e,t,s)}set angularVelocity(e){C3X$jscomp$27.RequireFiniteNumber(e),map$jscomp$23.get(this)._SetAngularVelocity(e)}get angularVelocity(){return map$jscomp$23.get(this)._GetAngularVelocity()}setVelocity(e,t){C3X$jscomp$27.RequireFiniteNumber(e),C3X$jscomp$27.RequireFiniteNumber(t),map$jscomp$23.get(this)._SetVelocity(e,t)}getVelocityX(){return map$jscomp$23.get(this)._GetVelocityX()}getVelocityY(){return map$jscomp$23.get(this)._GetVelocityY()}getVelocity(){return map$jscomp$23.get(this)._GetVelocity()}set density(e){C3X$jscomp$27.RequireFiniteNumber(e),map$jscomp$23.get(this)._SetDensity(e)}get density(){return map$jscomp$23.get(this)._GetDensity()}set friction(e){C3X$jscomp$27.RequireFiniteNumber(e),map$jscomp$23.get(this)._SetFriction(e)}get friction(){return map$jscomp$23.get(this)._GetFriction()}set elasticity(e){C3X$jscomp$27.RequireFiniteNumber(e),map$jscomp$23.get(this)._SetElasticity(e)}get elasticity(){return map$jscomp$23.get(this)._GetElasticity()}set linearDamping(e){C3X$jscomp$27.RequireFiniteNumber(e),map$jscomp$23.get(this)._SetLinearDamping(e)}get linearDamping(){return map$jscomp$23.get(this)._GetLinearDamping()}set angularDamping(e){C3X$jscomp$27.RequireFiniteNumber(e),map$jscomp$23.get(this)._SetAngularDamping(e)}get angularDamping(){return map$jscomp$23.get(this)._GetAngularDamping()}set isImmovable(e){map$jscomp$23.get(this)._SetImmovable(e)}get isImmovable(){return map$jscomp$23.get(this)._IsImmovable()}set isPreventRotation(e){map$jscomp$23.get(this)._SetPreventRotate(e)}get isPreventRotation(){return map$jscomp$23.get(this)._IsPreventRotate()}set isBullet(e){map$jscomp$23.get(this)._SetBullet(e)}get isBullet(){return map$jscomp$23.get(this)._IsBullet()}get mass(){return map$jscomp$23.get(this)._GetMass()}getCenterOfMassX(){return map$jscomp$23.get(this)._GetCenterOfMassX()}getCenterOfMassY(){return map$jscomp$23.get(this)._GetCenterOfMassY()}getCenterOfMass(){return map$jscomp$23.get(this)._GetCenterOfMass()}getContactCount(){return map$jscomp$23.get(this)._GetContactCount()}getContactX(e){return C3X$jscomp$27.RequireFiniteNumber(e),map$jscomp$23.get(this)._GetContactPositionAt(e)[0]}getContactY(e){return C3X$jscomp$27.RequireFiniteNumber(e),map$jscomp$23.get(this)._GetContactPositionAt(e)[1]}getContact(e){return C3X$jscomp$27.RequireFiniteNumber(e),map$jscomp$23.get(this)._GetContactPositionAt(e)}get isSleeping(){return map$jscomp$23.get(this)._IsSleeping()}createDistanceJoint(e,t,s,i,r){C3X$jscomp$27.RequireFiniteNumber(i),C3X$jscomp$27.RequireFiniteNumber(r),t=UnwrapIWorldInstance(this,t),map$jscomp$23.get(this)._CreateDistanceJoint(e,t,s,i,r)}createRevoluteJoint(e,t){t=UnwrapIWorldInstance(this,t),map$jscomp$23.get(this)._CreateRevoluteJoint(e,t)}createLimitedRevoluteJoint(e,t,s,i){C3X$jscomp$27.RequireFiniteNumber(s),C3X$jscomp$27.RequireFiniteNumber(i),t=UnwrapIWorldInstance(this,t),map$jscomp$23.get(this)._CreateLimitedRevoluteJoint(e,t,s,i)}createPrismaticJoint(e,t,s,i,r,n,a,o,h){t=UnwrapIWorldInstance(this,t),map$jscomp$23.get(this)._CreatePrismaticJoint(e,t,s,i,r,n,a,o,h)}removeAllJoints(){map$jscomp$23.get(this)._RemoveJoints()}};const C3$jscomp$257=self.C3;C3$jscomp$257.Behaviors.Physics.Cnds={IsSleeping(){return this._IsSleeping()},CompareVelocity(e,t,s){if(!this._isEnabled)return!1;if(0===e)e=this._GetVelocityX();else if(1===e)e=this._GetVelocityY();else{const[t,s]=this._GetVelocity();e=Math.hypot(t,s)}return C3$jscomp$257.compare(e,t,s)},CompareAngularVelocity(e,t){if(!this._isEnabled)return!1;const s=C3$jscomp$257.toDegrees(this._GetAngularVelocity());return C3$jscomp$257.compare(s,e,t)},CompareMass(e,t){if(!this._isEnabled)return!1;const s=this._GetMass();return C3$jscomp$257.compare(s,e,t)},IsEnabled(){return this._IsEnabled()}};const C3$jscomp$258=self.C3;C3$jscomp$258.Behaviors.Physics.Acts={ApplyForce(e,t,s){this._ApplyForce(e,t,s)},ApplyForceToward(e,t,s,i){this._ApplyForceToward(e,t,s,i)},ApplyForceAtAngle(e,t,s){this._ApplyForceAtAngle(e,C3$jscomp$258.toRadians(t),s)},ApplyImpulse(e,t,s){this._ApplyImpulse(e,t,s)},ApplyImpulseToward(e,t,s,i){this._ApplyImpulseToward(e,t,s,i)},ApplyImpulseAtAngle(e,t,s){this._ApplyImpulseAtAngle(e,C3$jscomp$258.toRadians(t),s)},ApplyTorque(e){this._ApplyTorque(C3$jscomp$258.toRadians(e))},ApplyTorqueToAngle(e,t){this._ApplyTorqueToAngle(C3$jscomp$258.toRadians(e),C3$jscomp$258.toRadians(t))},ApplyTorqueToPosition(e,t,s){this._ApplyTorqueToPosition(C3$jscomp$258.toRadians(e),t,s)},SetAngularVelocity(e){this._SetAngularVelocity(C3$jscomp$258.toRadians(e))},CreateDistanceJoint(e,t,s,i,r){t&&(t=t.GetFirstPicked(this._inst),this._CreateDistanceJoint(e,t,s,i,r))},CreateRevoluteJoint(e,t){t&&(t=t.GetFirstPicked(this._inst),this._CreateRevoluteJoint(e,t))},CreateLimitedRevoluteJoint(e,t,s,i){t&&(t=t.GetFirstPicked(this._inst),this._CreateLimitedRevoluteJoint(e,t,C3$jscomp$258.toRadians(s),C3$jscomp$258.toRadians(i)))},CreatePrismaticJoint(e,t,s,i,r,n,a,o,h){t&&(t=t.GetFirstPicked(this._inst),this._CreatePrismaticJoint(e,t,C3$jscomp$258.toRadians(s),i,r,n,a,C3$jscomp$258.toRadians(o),h))},RemoveJoints(){this._RemoveJoints()},SetWorldGravity(e){this.GetBehavior().SetGravity(e)},SetSteppingMode(e){this.GetBehavior().SetSteppingMode(e)},SetIterations(e,t){this.GetBehavior().SetIterations(e,t)},SetVelocity(e,t){this._SetVelocity(e,t)},SetDensity(e){this._SetDensity(e)},SetFriction(e){this._SetFriction(e)},SetElasticity(e){this._SetElasticity(e)},SetLinearDamping(e){this._SetLinearDamping(e)},SetAngularDamping(e){this._SetAngularDamping(e)},SetImmovable(e){this._SetImmovable(e)},EnableCollisions(e,t){this.GetBehavior().SetCollisionsEnabled(this.GetObjectClass(),e,0!==t)},SetPreventRotate(e){this._SetPreventRotate(0!==e)},SetBullet(e){this._SetBullet(0!==e)},SetEnabled(e){this._SetEnabled(0!==e)}};const C3$jscomp$259=self.C3;C3$jscomp$259.Behaviors.Physics.Exps={VelocityX(){return this._GetVelocityX()},VelocityY(){return this._GetVelocityY()},AngularVelocity(){return C3$jscomp$259.toDegrees(this._GetAngularVelocity())},Mass(){return this._GetMass()},CenterOfMassX(){return this._GetCenterOfMassX()},CenterOfMassY(){return this._GetCenterOfMassY()},Density(){return this._GetDensity()},Friction(){return this._GetFriction()},Elasticity(){return this._GetElasticity()},LinearDamping(){return this._GetLinearDamping()},AngularDamping(){return this._GetAngularDamping()},ContactCount(){return this._GetContactCount()},ContactXAt(e){return this._GetContactPositionAt(e)[0]},ContactYAt(e){return this._GetContactPositionAt(e)[1]}};const C3$jscomp$260=self.C3,b2Separator={};C3$jscomp$260.Behaviors.Physics.Separator=b2Separator;const GetVec2$jscomp$1=C3$jscomp$260.Behaviors.Physics.GetVec2,FreeVec2$jscomp$1=C3$jscomp$260.Behaviors.Physics.FreeVec2;function CloneVec2(e){return GetVec2$jscomp$1(e.get_x(),e.get_y())}function SplitConvexPolysOver8Points(e){const t=[];for(const s of e)8>=s.length?t.push(s):t.push.apply(t,SplitConvexPoly(s));return t}function SplitConvexPoly(e){const t=[];t.push(e.splice(0,8));const s=t[0][0];let i=t[0][7];for(;e.length;){const r=e.splice(0,Math.min(e.length,6));let n=r.at(-1);r.push(CloneVec2(s)),r.push(CloneVec2(i)),t.push(r),i=n}return t}b2Separator.det=function(e,t,s,i,r,n){return e*i+s*n+r*t-t*s-i*r-n*e},b2Separator.hitRay=function(e,t,s,i,r,n,a,o){var h=s-e,l=i-t,c=a-r;const u=o-n;return h=e+(c=(c*(n-t)-u*(r-e))/(l*c-h*u))*h,l=t+c*l,e=b2Separator.isOnSegment(s,i,e,t,h,l),r=b2Separator.isOnSegment(h,l,r,n,a,o),e&&r?GetVec2$jscomp$1(h,l):null},b2Separator.isOnSegment=function(e,t,s,i,r,n){return(s+.1>=e&&e>=r-.1||s-.1<=e&&e<=r+.1)&&(i+.1>=t&&t>=n-.1||i-.1<=t&&t<=n+.1)&&b2Separator.isOnLine(e,t,s,i,r,n)},b2Separator.isOnLine=function(e,t,s,i,r,n){return.1<Math.abs(r-s)?.1>Math.abs((n-i)/(r-s)*(e-s)+i-t):.1>Math.abs(e-s)},b2Separator.pointsMatch=function(e,t,s,i){return.1>Math.abs(s-e)&&.1>Math.abs(i-t)},b2Separator.Separate=function(e,t){let s=[];for(let i=0,r=(e=b2Separator.calcShapes(e)).length;i<r;++i){const r=e[i],n=[];let a=0;for(let e=0,t=r.length;e<t;++e){const s=r[e],i=r[(e+1)%t];a+=s.get_x()*i.get_y()-s.get_y()*i.get_x(),n.push(GetVec2$jscomp$1(s.get_x(),s.get_y()))}if(a=Math.abs(a/2),a>=.001*t)s.push(n);else for(let e=0,t=n.length;e<t;e++)FreeVec2$jscomp$1(n[e])}return s=SplitConvexPolysOver8Points(s)},b2Separator.calcShapes=function(e){var t;let s;var i;let r,n,a,o,h,l;var c=0;let u,p=0,_=[],m=[];for(m.push(e);m.length;){for(s=(e=m[0]).length,u=!0,t=0;t<s;t++){n=t,a=t<s-1?t+1:t+1-s;var d=t<s-2?t+2:t+2-s;if(o=e[n],h=e[a],d=e[d],0>(d=b2Separator.det(o.get_x(),o.get_y(),h.get_x(),h.get_y(),d.get_x(),d.get_y()))){u=!1;var g=1e9;for(i=0;i<s;i++)if(i!==n&&i!==a){d=i<s-1?i+1:0;var f=e[t=i],C=e[d];(f=b2Separator.hitRay(o.get_x(),o.get_y(),h.get_x(),h.get_y(),f.get_x(),f.get_y(),C.get_x(),C.get_y()))&&(C=h.get_x()-f.get_x(),r=h.get_y()-f.get_y(),(C=C*C+r*r)<g?(p=t,c=d,l=f,g=C):FreeVec2$jscomp$1(f))}if(1e9===g)return[];for(i=[],g=[],d=c,f=e[t=p],C=e[d],c=!1,b2Separator.pointsMatch(l.get_x(),l.get_y(),C.get_x(),C.get_y())||(i.push(l),c=!0),b2Separator.pointsMatch(l.get_x(),l.get_y(),f.get_x(),f.get_y())||(g.push(l),c=!0),c||FreeVec2$jscomp$1(l),p=-1,c=n;;){if(c===d){if(0>p||p>=s)return[];b2Separator.isOnSegment(C.get_x(),C.get_y(),e[p].get_x(),e[p].get_y(),o.get_x(),o.get_y())||i.push(e[c]);break}i.push(e[c]),p=c,0>c-1?c=s-1:c--}for(i.reverse(),p=-1,c=a;;){if(c===t){if(0>p||p>=s)return[];c!==t||b2Separator.isOnSegment(f.get_x(),f.get_y(),e[p].get_x(),e[p].get_y(),h.get_x(),h.get_y())||g.push(e[c]);break}g.push(e[c]),p=c,c+1>s-1?c=0:c++}m.push(i,g),m.shift();break}}u&&_.push(m.shift())}return _};const C3$jscomp$261=self.C3;C3$jscomp$261.Behaviors.Tween=class extends C3$jscomp$261.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$262=self.C3;C3$jscomp$262.Behaviors.Tween.Type=class extends C3$jscomp$262.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$263=self.C3,NAMESPACE=C3$jscomp$263.Behaviors.Tween;NAMESPACE.Instance=class extends C3$jscomp$263.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._allowMultiple=!1,this._enabled=!0,t&&(this._allowMultiple=!1,this._enabled=!!t[0]),this._activeTweens=new Map,this._disabledTweens=[],this._waitingForReleaseTweens=new Map,this._waitingForReleaseTweensJson=this._disabledTweensJson=this._activeTweensJson=this._finishingTween=null,this._finishingTweenName="",this._enabled&&this._StartTicking2(),this._afterLoad=e=>this._OnAfterLoad(e),this.GetRuntime().Dispatcher().addEventListener("afterload",this._afterLoad)}Release(){this.GetRuntime().Dispatcher().removeEventListener("afterload",this._afterLoad),this._afterLoad=null,this._finishingTween&&(this.ReleaseAndCompleteTween(this._finishingTween),this._finishingTween=null),this.ReleaseAndCompleteTweens(),this._tweens=null,this.ClearDisabledList(),this._disabledTweens=null,this._ReleaseWaitingTweens(),this._waitingForReleaseTweens=null,super.Release()}SetEnabled(e){this._enabled=!!e,e?this._StartTicking2():this._StopTicking2();for(const t of this.AllTweens())e?this.IsInDisabledList(t)&&t.Resume():((t.IsPlaying()||t.IsScheduled())&&this.AddToDisabledList(t),t.Stop());e&&this.ClearDisabledList()}IsEnabled(){return this._enabled}AddToDisabledList(e){this._disabledTweens.push(e)}IsInDisabledList(e){return this._disabledTweens.includes(e)}ClearDisabledList(){C3$jscomp$263.clearArray(this._disabledTweens)}GetFinishingTween(){return this._finishingTween}IsInstanceValid(){const e=this.GetObjectInstance();return!!e&&!e.IsDestroyed()}GetTween(e,t,s=!1){if((t=t?this.PropertyTweens(t,s):this.AllTweens(s))&&t.length)for(const s of t)if(s.HasTags(e))return s}GetTweenIncludingWaitingForRelease(e,t){return this.GetTween(e,t,!0)}*GetTweens(e,t,s=!1){if((t=t?this.PropertyTweens(t,s):this.AllTweens(s))&&t.length)for(const s of t)s.HasTags(e)&&(yield s)}*GetTweensIncludingWaitingForRelease(e,t){yield*this.GetTweens(e,t,!0)}PropertyTweens(e,t){return t?((t=this._activeTweens.get(e))||(t=[]),(e=this._waitingForReleaseTweens.get(e))||(e=[]),t.concat(e).filter((e=>e)).filter((e=>!e.IsReleased()))):((e=this._activeTweens.get(e))||(e=[]),e.filter((e=>e)).filter((e=>!e.IsReleased())))}AllTweens(e){if(e){e=[...this._activeTweens.values()].flat();const t=[...this._waitingForReleaseTweens.values()].flat();return e.concat(t).filter((e=>e)).filter((e=>!e.IsReleased()))}return[...this._activeTweens.values()].flat().filter((e=>e)).filter((e=>!e.IsReleased()))}AllTweensIncludingWaitingForRelease(){return this.AllTweens(!0)}SaveToJson(){return{s:!1,e:!!this._enabled,at:this._SaveActiveTweensToJson(),dt:this._SaveDisabledTweensToJson(),wt:this._SaveWaitingForReleaseTweensToJson(),ft:this._SaveFinishingTweenToJson()}}LoadFromJson(e){e&&(this._activeTweensJson=e.at,this._disabledTweensJson=e.dt,this._waitingForReleaseTweensJson=e.wt,this._finishingTweenName=e.ft,this._allowMultiple=!1,this._enabled=!!e.e)}_OnAfterLoad(e){if(e=this.GetRuntime().GetTimelineManager(),this._PopulateTweenMap(this._activeTweensJson,this._activeTweens,e),this._disabledTweensJson){C3$jscomp$263.clearArray(this._disabledTweens);for(const t of this._disabledTweensJson)this._PopulateTweenArray(this._disabledTweens,t,e)}this._PopulateTweenMap(this._waitingForReleaseTweensJson,this._waitingForReleaseTweens,e),this._finishingTween=this._GetTween(this._finishingTweenName,e),this._enabled?this._StartTicking2():this._StopTicking2()}_PopulateTweenMap(e,t,s){if(e)for(const r in e){let n=t.get(r);n?C3$jscomp$263.clearArray(n):n=[];var i=e[r];for(const e of i)this._PopulateTweenArray(n,e.name,s)?this._LoadTweenFromJson(e.name,e,s):((i=C3$jscomp$263.TweenState.Build({runtime:this.GetRuntime(),json:e})).AddCompletedCallback((e=>this._FinishTriggers(e))),s.AddScheduledTimeline(i),this._PopulateTweenArray(n,i,s));t.set(r,n)}}_GetTween(e,t){return t.GetScheduledOrPlayingTimelineByName(e)}_PopulateTweenArray(e,t,s){return!("string"==typeof t&&!(t=this._GetTween(t,s))||!e.push(t))}_LoadTweenFromJson(e,t,s){"string"==typeof e?(e=this._GetTween(e,s))&&e._LoadFromJson(t):e._LoadFromJson(t)}_SaveActiveTweensToJson(){const e={};for(const[t,s]of this._activeTweens)e[t]=s.filter((e=>!e.IsReleased())).map((e=>e._SaveToJson()));return e}_SaveDisabledTweensToJson(){return this._disabledTweens.filter((e=>!e.IsReleased())).map((e=>e.GetName()))}_SaveWaitingForReleaseTweensToJson(){const e={};for(const[t,s]of this._waitingForReleaseTweens)e[t]=s.map((e=>e._SaveToJson()));return e}_SaveFinishingTweenToJson(){return this._finishingTween?this._finishingTween.GetName():""}Tick2(){this._ReleaseWaitingTweens()}CreateTween(e){var t=NAMESPACE.Config.GetPropertyTracksConfig(e.property,e.startValue,e.endValue,e.ease,e.resultMode,this.GetObjectInstance());const s=NAMESPACE.Maps.GetPropertyFromIndex(e.property);return NAMESPACE.Maps.IsValueId(s)||this.ReleaseTweens(e.property),(t=C3$jscomp$263.TweenState.Build({runtime:this.GetRuntime(),id:s,tags:e.tags,time:e.time,instance:this.GetObjectInstance(),releaseOnComplete:!!e.releaseOnComplete,loop:!!e.loop,pingPong:!!e.pingPong,repeatCount:e.repeatCount,initialValueMode:e.initialValueMode,propertyTracksConfig:t})).AddCompletedCallback((e=>this._FinishTriggers(e))),this._AddTween(t,e.property),t}_MaybeRemoveFromActiveTweenMap(e){var t=e.GetId();this._activeTweens.has(t)&&(t=this._activeTweens.get(t))&&(-1!==(e=t.indexOf(e))&&t.splice(e,1))}ReleaseTween(e,t=!1){this._MaybeRemoveFromActiveTweenMap(e),e.IsReleased()||this._IsInWaitingList(e)||(e.Stop(t),this._AddToWaitingList(e))}ReleaseTweens(e,t=!1){if(C3$jscomp$263.IsFiniteNumber(e)){var s=NAMESPACE.Maps.GetPropertyFromIndex(e);if(this._activeTweens.has(s)){s=this._activeTweens.get(s);var i=this.GetFinishingTween();for(var r of s)r===i||r.IsReleased()||this._IsInWaitingList(r)||(r.Stop(t),r.Release());C3$jscomp$263.clearArray(s)}}else{for(s of(r=this.GetFinishingTween(),this.AllTweens()))s===r||s.IsReleased()||this._IsInWaitingList(s)||(s.Stop(t),s.Release());for(i of this._activeTweens.keys())C3$jscomp$263.clearArray(this._activeTweens.get(i)),this._activeTweens.delete(i);this._activeTweens.clear()}}ReleaseAndCompleteTween(e){this.ReleaseTween(e,!0)}ReleaseAndCompleteTweens(){this.ReleaseTweens(NaN,!0)}GetPropertyValueByIndex(e){switch(e){case 0:return this._enabled}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._enabled=!!t}}_GetBehaviorType(e){e=e.GetInstance().GetBehaviorInstances();for(const t of e)if((e=t.GetBehaviorType()).GetInstanceSdkCtor()===this.constructor)return e}Trigger(e,t,s,i){return this._runtime?super.Trigger(e):t.Trigger(e,s,i)}_FinishTriggers(e){let t,s;if(this._finishingTween=e,NAMESPACE.Cnds.SetFinishingTween(e),this.GetRuntime())t=this._inst,s=this._runtime,this.Trigger(NAMESPACE.Cnds.OnTweensFinished),this.Trigger(NAMESPACE.Cnds.OnAnyTweensFinished),this.ReleaseTween(e);else{if(t=e.GetInstance(),!t||t&&t.IsDestroyed())return;s=t.GetRuntime();const i=this._GetBehaviorType(e);this.Trigger(NAMESPACE.Cnds.OnTweensFinished,s,t,i),this.Trigger(NAMESPACE.Cnds.OnAnyTweensFinished,s,t,i),e.Stop()}this._finishingTween=null,NAMESPACE.Cnds.SetFinishingTween(null),e.GetDestroyInstanceOnComplete()&&s.DestroyInstance(t)}_AddTween(e,t){t=NAMESPACE.Maps.GetPropertyFromIndex(t),this._activeTweens.has(t)||this._activeTweens.set(t,[]),this._activeTweens.get(t).push(e)}_AddToWaitingList(e){const t=e.GetId();this._waitingForReleaseTweens.has(t)||this._waitingForReleaseTweens.set(t,[]),this._waitingForReleaseTweens.get(t).push(e)}_IsInWaitingList(e){const t=e.GetId();return!!this._waitingForReleaseTweens.has(t)&&this._waitingForReleaseTweens.get(t).includes(e)}_ReleaseWaitingTweens(){if(this._waitingForReleaseTweens.size){for(const e of this._waitingForReleaseTweens.values()){for(const t of e)t.IsReleased()||t.Release();C3$jscomp$263.clearArray(e)}this._waitingForReleaseTweens.clear()}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.tween.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this.SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.ITweenBehaviorInstance}};const C3$jscomp$264=self.C3;let finishingTween$jscomp$2=null;C3$jscomp$264.Behaviors.Tween.Cnds={SetFinishingTween(e){finishingTween$jscomp$2=e},OnTweensFinished:e=>finishingTween$jscomp$2.HasTags(e),OnAnyTweensFinished:()=>!0,IsPlaying(e){return!!(e=[...this.GetTweensIncludingWaitingForRelease(e)]).length&&e.some(C3$jscomp$264.TweenState.IsPlaying)},IsAnyPlaying(){const e=[...this.AllTweensIncludingWaitingForRelease()];return!(!e||!e.length)&&e.some(C3$jscomp$264.TweenState.IsPlaying)},IsPaused(e){return!!(e=[...this.GetTweensIncludingWaitingForRelease(e)]).length&&e.some(C3$jscomp$264.TweenState.IsPaused)},IsAnyPaused(){const e=[...this.AllTweensIncludingWaitingForRelease()];return!(!e||!e.length)&&e.some(C3$jscomp$264.TweenState.IsPaused)}};const C3$jscomp$265=self.C3,Ease$jscomp$3=self.Ease,NAMESPACE$jscomp$1=C3$jscomp$265.Behaviors.Tween;NAMESPACE$jscomp$1.Acts={SetEnabled(e){this.SetEnabled(!!e)},async TweenOneProperty(...e){this.IsEnabled()&&this.IsInstanceValid()&&((e=this.CreateTween(NAMESPACE$jscomp$1.TweenArguments.OneProperty(this,...e))).Play()&&await e.GetPlayPromise())},async TweenTwoProperties(...e){this.IsEnabled()&&this.IsInstanceValid()&&((e=this.CreateTween(NAMESPACE$jscomp$1.TweenArguments.TwoProperties(this,...e))).Play()&&await e.GetPlayPromise())},async TweenValue(...e){this.IsEnabled()&&this.IsInstanceValid()&&((e=this.CreateTween(NAMESPACE$jscomp$1.TweenArguments.ValueProperty(this,...e))).Play()&&await e.GetPlayPromise())},PauseTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))t.Stop()},PauseAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())e.Stop()},ResumeTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))t.Resume()},ResumeAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())e.Resume()},StopTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))this.ReleaseTween(t)},StopAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())this.ReleaseTween(e)},SetOnePropertyTweensEndValue(e,t,s){if(this.IsEnabled()&&this.IsInstanceValid()){t=C3$jscomp$265.Behaviors.Tween.Maps.GetSinglePropertyFromIndex(t);for(const i of this.GetTweens(e))i.BeforeSetEndValues([t]),i.SetEndValue(s,t)}},SetTwoPropertiesTweensEndValue(e,t,s,i){if(this.IsEnabled()&&this.IsInstanceValid()){t=C3$jscomp$265.Behaviors.Tween.Maps.GetRealProperties(t);for(const r of this.GetTweens(e))r.BeforeSetEndValues(t),r.SetEndValue(s,t[0]),r.SetEndValue(i,t[1])}},SetValuePropertyTweensStartValue(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e,"value"))s.SetStartValue(t,"value")},SetValuePropertyTweensEndValue(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e,"value"))s.BeforeSetEndValues(["value"]),s.SetEndValue(t,"value")},SetTweensEase(e,t){if(this.IsEnabled()&&this.IsInstanceValid()){t=Ease$jscomp$3.GetEaseFromIndex(t);for(const s of this.GetTweens(e))s.SetEase(t)}},SetAllTweensEase(e){if(this.IsEnabled()&&this.IsInstanceValid()){e=Ease$jscomp$3.GetEaseFromIndex(e);for(const t of this.AllTweens())t.SetEase(e)}},SetTweensTime(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetTime(t)},SetAllTweensTime(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetTime(e)},SetTweensPlaybackRate(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetPlaybackRate(t)},SetAllTweensPlaybackRate(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetPlaybackRate(e)},SetTweensDestroyOnComplete(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetDestroyInstanceOnComplete(!!t)},SetAllTweensDestroyOnComplete(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetDestroyInstanceOnComplete(!!e)}},self.C3.Behaviors.Tween.Exps={Time(e){return(e=this.GetTweenIncludingWaitingForRelease(e))?e.GetTime():0},Progress(e){return(e=this.GetTweenIncludingWaitingForRelease(e))?e.GetTime()/e.GetTotalTime():0},Value(e){return(e=this.GetTweenIncludingWaitingForRelease(e,"value"))?e.GetPropertyTrack("value").GetSourceAdapterValue():0},Tags(){return this.GetFinishingTween()?this.GetFinishingTween().GetStringTags():""}};const C3$jscomp$267=self.C3,Ease$jscomp$4=self.Ease,PAIR_PROPERTIES=["position","size","scale"],SINGLE_PROPERTIES="offsetX offsetY offsetWidth offsetHeight offsetAngle offsetOpacity offsetColor offsetZElevation offsetScaleX offsetScaleY".split(" "),VALUE_PROPERTIES=["value"],PROPERTY_INDEX_TO_NAME=[].concat(PAIR_PROPERTIES).concat(SINGLE_PROPERTIES).concat(VALUE_PROPERTIES),PROPERTY_PAIR_TO_REAL_PROPERTIES={position:["offsetX","offsetY"],size:["offsetWidth","offsetHeight"],scale:["offsetScaleX","offsetScaleY"]},ALL_REAL_PROPERTIES=Object.assign({},PROPERTY_INDEX_TO_NAME.reduce(((e,t)=>Object.assign({},e,{[t]:[t]})),{}),PROPERTY_PAIR_TO_REAL_PROPERTIES);C3$jscomp$267.Behaviors.Tween.Maps=class{constructor(){}static GetEases(){return[...Ease$jscomp$4.GetRuntimeEaseNames()]}static GetEaseFromIndex(e){return[...Ease$jscomp$4.GetRuntimeEaseNames()][e]}static GetPropertyFromIndex(e){return PROPERTY_INDEX_TO_NAME[e]}static GetPropertyIndexFromName(e){return PROPERTY_INDEX_TO_NAME.indexOf(e)}static GetPairPropertyFromIndex(e){return PAIR_PROPERTIES[e]}static GetSinglePropertyFromIndex(e){return SINGLE_PROPERTIES[e]}static GetValuePropertyFromIndex(e){return VALUE_PROPERTIES[e]}static GetPairProperties(e){return PROPERTY_PAIR_TO_REAL_PROPERTIES[e]}static GetRealProperties(e){return C3$jscomp$267.IsString(e)?ALL_REAL_PROPERTIES[e]:ALL_REAL_PROPERTIES[PROPERTY_INDEX_TO_NAME[e]]}static IsPairId(e){return!!PROPERTY_PAIR_TO_REAL_PROPERTIES[e]}static IsColorId(e){return"offsetColor"===e}static IsAngleId(e){return"offsetAngle"===e}static IsOpacityId(e){return"offsetOpacity"===e}static IsValueId(e){return"value"===e}};const C3$jscomp$268=self.C3,NAMESPACE$jscomp$2=C3$jscomp$268.Behaviors.Tween,TWEEN_CONFIGURATIONS=new Map;NAMESPACE$jscomp$2.Config=class{constructor(){}static GetPropertyTracksConfig(e,t,s,i,r,n){0===TWEEN_CONFIGURATIONS.size&&this._CreateConfigObjects();var a=NAMESPACE$jscomp$2.PropertyTypes.Pick(e);return a=TWEEN_CONFIGURATIONS.get(a),C3$jscomp$268.IsFiniteNumber(e)&&(e=NAMESPACE$jscomp$2.Maps.GetPropertyFromIndex(e)),this._GetConfig(a,e,t,s,i,r,n)}static TransformValue(e,t){return C3$jscomp$268.Behaviors.Tween.GetPropertyTracksConfig(e).valueGetter(t)}static _CreateConfigObjects(){const e=NAMESPACE$jscomp$2.PropertyTypes,t=NAMESPACE$jscomp$2.ValueGetters;this._AddConfigObject(e.PAIR,this._GetPairConfig,t._GetPropertyValue),this._AddConfigObject(e.COLOR,this._GetColorConfig,t._GetColorPropertyValue),this._AddConfigObject(e.ANGLE,this._GetAngleConfig,t._GetPropertyAngleValue),this._AddConfigObject(e.VALUE,this._GetValueConfig,t._GetPropertyValue),this._AddConfigObject(e.OTHER,this._GetCommonConfig,t._GetPropertyValue)}static _AddConfigObject(e,t,s){TWEEN_CONFIGURATIONS.set(e,this._CreateConfigObject(e,t,s))}static _CreateConfigObject(e,t,s){return{name:e,configFunc:t,valueGetter:s}}static _GetConfig(e,t,s,i,r,n,a){return e.configFunc(t,e.valueGetter(s),e.valueGetter(i),r,n,a)}static _GetPairConfig(e,t,s,i,r,n){return NAMESPACE$jscomp$2.Maps.GetPairProperties(e).map(((e,n)=>({sourceId:"world-instance",property:e,type:"float",valueType:"numeric",startValue:t[n],endValue:s[n],ease:NAMESPACE$jscomp$2.Maps.GetEaseFromIndex(i),resultMode:r})))}static _GetColorConfig(e,t,s,i,r,n){return C3$jscomp$268.Plugins.Text&&n.GetPlugin()instanceof C3$jscomp$268.Plugins.Text?{sourceId:"plugin",sourceArgs:[7],property:"color",type:"color",valueType:"color",startValue:t,endValue:s,ease:NAMESPACE$jscomp$2.Maps.GetEaseFromIndex(i),resultMode:r}:{sourceId:"world-instance",property:e,type:"color",valueType:"color",startValue:t,endValue:s,ease:NAMESPACE$jscomp$2.Maps.GetEaseFromIndex(i),resultMode:r}}static _GetAngleConfig(e,t,s,i,r,n){return{sourceId:"world-instance",property:e,type:"angle",valueType:"angle",startValue:t,endValue:s,ease:NAMESPACE$jscomp$2.Maps.GetEaseFromIndex(i),resultMode:r}}static _GetCommonConfig(e,t,s,i,r,n){return{sourceId:"world-instance",property:e,type:"float",valueType:"numeric",startValue:t,endValue:s,ease:NAMESPACE$jscomp$2.Maps.GetEaseFromIndex(i),resultMode:r}}static _GetValueConfig(e,t,s,i,r,n){return{sourceId:"value",property:e,type:"float",valueType:"numeric",startValue:t,endValue:s,ease:NAMESPACE$jscomp$2.Maps.GetEaseFromIndex(i),resultMode:r}}};const C3$jscomp$269=self.C3,NAMESPACE$jscomp$3=C3$jscomp$269.Behaviors.Tween,COMMON_VARIABLE_ARGS=Object.assign({},{resultMode:"absolute"},{tags:"",property:"",time:0,ease:0,releaseOnComplete:0,loop:!1,pingPong:!1,repeatCount:1}),ONE_PROPERTY_ARGS=Object.assign({},COMMON_VARIABLE_ARGS,{initialValueMode:"current-state",startValue:0,endValue:0}),TWO_PROPERTIES_ARGS=Object.assign({},COMMON_VARIABLE_ARGS,{initialValueMode:"current-state",startValue:[0,0],endValue:[0,0]}),COLOR_PROPERTY_ARGS=Object.assign({},COMMON_VARIABLE_ARGS,{initialValueMode:"current-state",startValue:[0,0,0],endValue:[0,0,0]}),VALUE_PROPERTY_ARGS=Object.assign({},ONE_PROPERTY_ARGS,{initialValueMode:"start-value"});NAMESPACE$jscomp$3.TweenArguments=class{constructor(){}static _SetCommonProperties(e,t,s,i,r,n,a,o){e.tags=t,e.time=s,e.ease=i,e.releaseOnComplete=r,e.loop=n,e.pingPong=a,e.repeatCount=o}static OneProperty(e,t,s,i,r,n,a,o,h,l){return e="string"==typeof s?s:NAMESPACE$jscomp$3.Maps.GetSinglePropertyFromIndex(s),s=NAMESPACE$jscomp$3.Maps.IsColorId(e)?COLOR_PROPERTY_ARGS:ONE_PROPERTY_ARGS,this._SetCommonProperties(s,t,r,n,a,o,h,l),NAMESPACE$jscomp$3.Maps.IsColorId(e)?(COLOR_PROPERTY_ARGS.endValue[0]=C3$jscomp$269.GetRValue(i),COLOR_PROPERTY_ARGS.endValue[1]=C3$jscomp$269.GetGValue(i),COLOR_PROPERTY_ARGS.endValue[2]=C3$jscomp$269.GetBValue(i),COLOR_PROPERTY_ARGS.property=NAMESPACE$jscomp$3.Maps.GetPropertyIndexFromName(e)):NAMESPACE$jscomp$3.Maps.IsOpacityId(e)?ONE_PROPERTY_ARGS.endValue=i/100:ONE_PROPERTY_ARGS.endValue=i,s.property=NAMESPACE$jscomp$3.Maps.GetPropertyIndexFromName(e),s}static TwoProperties(e,t,s,i,r,n,a,o,h,l,c){return this._SetCommonProperties(TWO_PROPERTIES_ARGS,t,n,a,o,h,l,c),e="string"==typeof s?s:NAMESPACE$jscomp$3.Maps.GetPairPropertyFromIndex(s),TWO_PROPERTIES_ARGS.endValue[0]=i,TWO_PROPERTIES_ARGS.endValue[1]=r,TWO_PROPERTIES_ARGS.property=NAMESPACE$jscomp$3.Maps.GetPropertyIndexFromName(e),TWO_PROPERTIES_ARGS}static ValueProperty(e,t,s,i,r,n,a,o,h,l){return this._SetCommonProperties(VALUE_PROPERTY_ARGS,t,r,n,a,o,h,l),VALUE_PROPERTY_ARGS.startValue=s,VALUE_PROPERTY_ARGS.endValue=i,VALUE_PROPERTY_ARGS.property=NAMESPACE$jscomp$3.Maps.GetPropertyIndexFromName("value"),VALUE_PROPERTY_ARGS}};const C3$jscomp$270=self.C3,NAMESPACE$jscomp$4=C3$jscomp$270.Behaviors.Tween,TYPE_CHECK_OBJECTS=[];NAMESPACE$jscomp$4.PropertyTypes=class{constructor(){}static Pick(e){0===TYPE_CHECK_OBJECTS.length&&(TYPE_CHECK_OBJECTS.push({checkFunc:NAMESPACE$jscomp$4.Maps.IsPairId,result:this.PAIR}),TYPE_CHECK_OBJECTS.push({checkFunc:NAMESPACE$jscomp$4.Maps.IsColorId,result:this.COLOR}),TYPE_CHECK_OBJECTS.push({checkFunc:NAMESPACE$jscomp$4.Maps.IsAngleId,result:this.ANGLE}),TYPE_CHECK_OBJECTS.push({checkFunc:NAMESPACE$jscomp$4.Maps.IsValueId,result:this.VALUE}),TYPE_CHECK_OBJECTS.push({checkFunc:()=>!0,result:this.OTHER})),C3$jscomp$270.IsFiniteNumber(e)&&(e=C3$jscomp$270.Behaviors.Tween.Maps.GetPropertyFromIndex(e));for(const t of TYPE_CHECK_OBJECTS)if(t.checkFunc(e))return t.result}static get PAIR(){return"pair"}static get COLOR(){return"color"}static get ANGLE(){return"angle"}static get VALUE(){return"value"}static get OTHER(){return"other"}};const C3$jscomp$271=self.C3;C3$jscomp$271.Behaviors.Tween.ValueGetters=class{constructor(){}static _GetPropertyAngleValue(e){return e=C3$jscomp$271.toRadians(parseFloat(e)),C3$jscomp$271.clampAngle(e)}static _GetColorPropertyValue(e){return e.slice(0)}static _GetPropertyValue(e){return e}};const C3$jscomp$272=self.C3,C3X$jscomp$28=self.C3X,IBehaviorInstance$jscomp$3=self.IBehaviorInstance,Ease$jscomp$5=self.Ease,NAMESPACE$jscomp$6=C3$jscomp$272.Behaviors.Tween,map$jscomp$25=new WeakMap,TWEEN_PROPERTIES=new Map([["x",{name:"offsetX",type:"one"}],["y",{name:"offsetY",type:"one"}],["width",{name:"offsetWidth",type:"one"}],["height",{name:"offsetHeight",type:"one"}],["angle",{name:"offsetAngle",type:"one"}],["opacity",{name:"offsetOpacity",type:"one"}],["color",{name:"offsetColor",type:"color"}],["z-elevation",{name:"offsetZElevation",type:"one"}],["x-scale",{name:"offsetScaleX",type:"one"}],["y-scale",{name:"offsetScaleY",type:"one"}],["position",{name:"position",type:"two"}],["size",{name:"size",type:"two"}],["scale",{name:"scale",type:"two"}],["value",{name:"value",type:"value"}]]);function getIndexForEase(e){C3X$jscomp$28.RequireString(e);var t=Ease$jscomp$5.ToInternal(e);if(-1===(t=t?Ease$jscomp$5.GetIndexForEase(t,null):Ease$jscomp$5.GetIndexForEase(e,null)))throw Error(`invalid ease name '${e}'`);return t}const TWEEN_OPTS={tags:"",destroyOnComplete:!1,loop:!1,pingPong:!1,repeatCount:1,startValue:0},I_TWEEN_OPTS={easeToIndexFunc:getIndexForEase};self.ITweenBehaviorInstance=class extends IBehaviorInstance$jscomp$3{constructor(){super(),map$jscomp$25.set(this,IBehaviorInstance$jscomp$3._GetInitInst().GetSdkInstance())}startTween(e,t,s,i,r){const n=map$jscomp$25.get(this);if(!n.IsEnabled()||!n.IsInstanceValid())return null;const a=TWEEN_PROPERTIES.get(e);if(!a)throw Error("invalid tween property");let o;if("one"===a.type||"value"===a.type?C3X$jscomp$28.RequireNumber(t):(C3X$jscomp$28.RequireArray(t),"two"===a.type?(C3X$jscomp$28.RequireNumber(t[0]),C3X$jscomp$28.RequireNumber(t[1])):"color"===a.type&&(C3X$jscomp$28.RequireNumber(t[0]),C3X$jscomp$28.RequireNumber(t[1]),C3X$jscomp$28.RequireNumber(t[2]))),"angle"===e?t=C3$jscomp$272.toDegrees(t):"opacity"===e?t*=100:"color"===e&&(t=C3$jscomp$272.PackRGBEx(t[0],t[1],t[2])),e=getIndexForEase(i),C3X$jscomp$28.RequireFiniteNumber(s),r=Object.assign({},TWEEN_OPTS,r),"value"===a.type&&C3X$jscomp$28.RequireNumber(r.startValue),"one"===a.type||"color"===a.type?o=n.CreateTween(NAMESPACE$jscomp$6.TweenArguments.OneProperty(n,r.tags,a.name,t,s,e,!!r.destroyOnComplete,!!r.loop,!!r.pingPong,r.repeatCount)):"two"===a.type?o=n.CreateTween(NAMESPACE$jscomp$6.TweenArguments.TwoProperties(n,r.tags,a.name,t[0],t[1],s,e,!!r.destroyOnComplete,!!r.loop,!!r.pingPong,r.repeatCount)):"value"===a.type&&(o=n.CreateTween(NAMESPACE$jscomp$6.TweenArguments.ValueProperty(n,r.tags,r.startValue,t,s,e,!!r.destroyOnComplete,!!r.loop,!!r.pingPong,r.repeatCount))),!o.Play())throw Error("failed to start tween");return o.GetITweenState(n,I_TWEEN_OPTS)}*allTweens(){const e=map$jscomp$25.get(this);for(const t of e.AllTweens())yield t.GetITweenState(e,I_TWEEN_OPTS)}*tweensByTags(e){C3X$jscomp$28.RequireString(e);const t=map$jscomp$25.get(this);for(const s of t.GetTweens(e))yield s.GetITweenState(t,I_TWEEN_OPTS)}get isEnabled(){return map$jscomp$25.get(this).IsEnabled()}set isEnabled(e){map$jscomp$25.get(this).SetEnabled(e)}};const C3$jscomp$273=self.C3;C3$jscomp$273.Behaviors.Timer=class extends C3$jscomp$273.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$274=self.C3;C3$jscomp$274.Behaviors.Timer.Type=class extends C3$jscomp$274.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$275=self.C3,C3X$jscomp$29=self.C3X,IBehaviorInstance$jscomp$4=self.IBehaviorInstance;C3$jscomp$275.Behaviors.Timer.SingleTimer=class{constructor(e,t,s,i){this._current=C3$jscomp$275.New(C3$jscomp$275.KahanSum),this._current.Set(e||0),this._total=C3$jscomp$275.New(C3$jscomp$275.KahanSum),this._total.Set(t||0),this._duration=s||0,this._isRegular=!!i,this._isPaused=!1}GetCurrentTime(){return this._current.Get()}GetTotalTime(){return this._total.Get()}GetDuration(){return this._duration}SetPaused(e){this._isPaused=!!e}IsPaused(){return this._isPaused}Add(e){this._current.Add(e),this._total.Add(e)}HasFinished(){return this._current.Get()>=this._duration}Update(){if(this.HasFinished()){if(!this._isRegular)return!0;this._current.Subtract(this._duration)}return!1}SaveToJson(){return{c:this._current.Get(),t:this._total.Get(),d:this._duration,r:this._isRegular,p:this._isPaused}}LoadFromJson(e){this._current.Set(e.c),this._total.Set(e.t),this._duration=e.d,this._isRegular=!!e.r,this._isPaused=!!e.p}},C3$jscomp$275.Behaviors.Timer.Instance=class extends C3$jscomp$275.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._timers=new Map}Release(){this._timers.clear(),super.Release()}_StartTimer(e,t,s){e=new C3$jscomp$275.Behaviors.Timer.SingleTimer(0,0,e,s),this._timers.set(t.toLowerCase(),e),this._UpdateTickState()}_StopTimer(e){this._timers.delete(e.toLowerCase()),this._UpdateTickState()}_StopAllTimers(){this._timers.clear(),this._UpdateTickState()}_IsTimerRunning(e){return this._timers.has(e.toLowerCase())}_GetTimerCurrentTime(e){return(e=this._timers.get(e.toLowerCase()))?e.GetCurrentTime():0}_GetTimerTotalTime(e){return(e=this._timers.get(e.toLowerCase()))?e.GetTotalTime():0}_GetTimerDuration(e){return(e=this._timers.get(e.toLowerCase()))?e.GetDuration():0}_HasTimerFinished(e){return!!(e=this._timers.get(e.toLowerCase()))&&e.HasFinished()}_SetTimerPaused(e,t){(e=this._timers.get(e.toLowerCase()))&&e.SetPaused(t)}_IsTimerPaused(e){return!!(e=this._timers.get(e.toLowerCase()))&&e.IsPaused()}_UpdateTickState(){0<this._timers.size?(this._StartTicking(),this._StartTicking2()):(this._StopTicking(),this._StopTicking2())}SaveToJson(){const e={};for(const[t,s]of this._timers.entries())e[t]=s.SaveToJson();return e}LoadFromJson(e){this._timers.clear();for(const[t,s]of Object.entries(e))(e=new C3$jscomp$275.Behaviors.Timer.SingleTimer).LoadFromJson(s),this._timers.set(t,e);this._UpdateTickState()}Tick(){const e=this._runtime.GetDt(this._inst);for(const[t,s]of this._timers)s.IsPaused()||(s.Add(e),s.HasFinished()&&this.DispatchScriptEvent("timer",!1,{tag:t}))}Tick2(){for(const[e,t]of this._timers.entries())t.Update()&&this._timers.delete(e)}GetDebuggerProperties(){return[{title:"behaviors.timer.debugger.timers",properties:[...this._timers.entries()].map((e=>({name:"$"+e[0],value:`${Math.round(10*e[1].GetCurrentTime())/10} / ${Math.round(10*e[1].GetDuration())/10}`})))}]}GetScriptInterfaceClass(){return self.ITimerBehaviorInstance}};const map$jscomp$26=new WeakMap,VALID_TIMER_TYPES=["once","regular"];self.ITimerBehaviorInstance=class extends IBehaviorInstance$jscomp$4{constructor(){super(),map$jscomp$26.set(this,IBehaviorInstance$jscomp$4._GetInitInst().GetSdkInstance())}startTimer(e,t,s="once"){if(C3X$jscomp$29.RequireFiniteNumber(e),C3X$jscomp$29.RequireString(t),-1===(s=VALID_TIMER_TYPES.indexOf(s)))throw Error("invalid type");map$jscomp$26.get(this)._StartTimer(e,t,1===s)}setTimerPaused(e,t){C3X$jscomp$29.RequireString(e),map$jscomp$26.get(this)._SetTimerPaused(e,!!t)}stopTimer(e){C3X$jscomp$29.RequireString(e),map$jscomp$26.get(this)._StopTimer(e)}stopAllTimers(){map$jscomp$26.get(this)._StopAllTimers()}isTimerRunning(e){return C3X$jscomp$29.RequireString(e),map$jscomp$26.get(this)._IsTimerRunning(e)}isTimerPaused(e){return C3X$jscomp$29.RequireString(e),map$jscomp$26.get(this)._IsTimerPaused(e)}getCurrentTime(e){return C3X$jscomp$29.RequireString(e),map$jscomp$26.get(this)._GetTimerCurrentTime(e)}getTotalTime(e){return C3X$jscomp$29.RequireString(e),map$jscomp$26.get(this)._GetTimerTotalTime(e)}getDuration(e){return C3X$jscomp$29.RequireString(e),map$jscomp$26.get(this)._GetTimerDuration(e)}hasFinished(e){return C3X$jscomp$29.RequireString(e),map$jscomp$26.get(this)._HasTimerFinished(e)}},self.C3.Behaviors.Timer.Cnds={OnTimer(e){return this._HasTimerFinished(e)},IsTimerRunning(e){return this._IsTimerRunning(e)},IsTimerPaused(e){return this._IsTimerPaused(e)}},self.C3.Behaviors.Timer.Acts={StartTimer(e,t,s){this._StartTimer(e,s,1===t)},StopTimer(e){this._StopTimer(e)},StopAllTimers(){this._StopAllTimers()},PauseResumeTimer(e,t){this._SetTimerPaused(e,0===t)}},self.C3.Behaviors.Timer.Exps={CurrentTime(e){return this._GetTimerCurrentTime(e)},TotalTime(e){return this._GetTimerTotalTime(e)},Duration(e){return this._GetTimerDuration(e)}};const C3$jscomp$279=self.C3;C3$jscomp$279.Behaviors.aekiroWater=class extends C3$jscomp$279.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$280=self.C3;C3$jscomp$280.Behaviors.aekiroWater.Type=class extends C3$jscomp$280.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$281=self.C3,Segment=class{constructor(e,t,s,i,r,n,a,o){this.speed=this.height=0,this.quad=new C3$jscomp$281.Quad(e,t,s,i,r,n,a,o),this._i=0}},_2pi=2*Math.PI;C3$jscomp$281.Behaviors.aekiroWater.Instance=class extends C3$jscomp$281.SDKBehaviorInstanceBase{constructor(e,t){if(super(e),this.dampening=this.tension=.025,this.spread=.25,this.segmentWidth=4,this.isAutowavesEnabled=!0,this._waveLength=100,this._mag=this._period=2,this.GetObjectClass()._plugin instanceof C3$jscomp$281.Plugins.TiledBg){t&&(this.tension=t[0],this.dampening=t[1],this.spread=t[2],this.segmentWidth=t[3],this.isSmoothingON=t[4],this.useMesh=t[5],this.meshColumns=t[6],this.meshRows=t[7],this.isAutowavesEnabled=t[8],this._waveLength=t[9],this._period=t[10],this._mag=t[11]),this.wi=this.GetWorldInfo(),this.targetHeight=this.wi.GetHeight(),this.lDeltas=[],this.rDeltas=[],e=Math.round(this.wi.GetWidth()/this.segmentWidth),this.useMesh&&(e=this.meshColumns),this.segments=[];var s=this.targetHeight;for(let i=0;i<e;i++)(t=new Segment).height=s,this.SetSegmentHeight(t,i,s),this.segments.push(t);this.useMesh&&this.wi.CreateMesh(this.meshColumns,this.meshRows),this.GetObjectInstance().GetUnsavedDataMap().aekiro_water=this,this._StartTicking()}else alert("The Water addon works only on Tiled Backgrounds !")}PostCreate(){var e=this.GetObjectInstance().GetSdkInstance();e.segments=this.segments,e.segmentWidth=this.segmentWidth,e.SetSegmentHeight=this.SetSegmentHeight,e.useMesh=this.useMesh,e.rcTex=C3$jscomp$281.New(C3$jscomp$281.Rect),e.qTex=C3$jscomp$281.New(C3$jscomp$281.Quad),e.tempRect=C3$jscomp$281.New(C3$jscomp$281.Rect),e.tempQuad=C3$jscomp$281.New(C3$jscomp$281.Quad),this.oldDraw=e.Draw,this.old_DrawMesh=e._DrawMesh,e.Draw=this._Draw,e._DrawMesh=this._DrawMesh2,this.wi.SetWidth_old2=this.wi.SetWidth,this.wi.SetWidth=function(e){var t=this.GetWidth();this.SetWidth_old2(e),e!=t&&this.GetInstance().GetUnsavedDataMap().aekiro_water.OnSizeChanged()}}OnSizeChanged(){if(!this.useMesh){var e=Math.round(this.wi.GetWidth()/this.segmentWidth);this.segments.length=0;var t=this.targetHeight;for(let i=0;i<e;i++){var s=new Segment;s.height=t,this.SetSegmentHeight(s,i,t),this.segments.push(s)}}}Release(){var e=this.GetObjectInstance().GetSdkInstance();e.Draw=this.oldDraw,e._DrawMesh=this.old_DrawMesh,this.old_DrawMesh=this.oldDraw=null,super.Release()}_Draw(e){const t=this.GetCurrentImageInfo(),s=t.GetTexture();if(null!==s){e.SetTexture(s);var i=t.GetWidth(),r=t.GetHeight(),n=this._imageOffsetX/i,a=this._imageOffsetY/r,o=this.GetWorldInfo(),h=this.rcTex,l=this.qTex;o.GetBoundingQuad(),this.useMesh?(h.set(0,0,o.GetWidth()/(i*this._imageScaleX),o.GetHeight()/(r*this._imageScaleY)),h.offset(-n,-a),this._DrawMesh(o,e)):this.segments.forEach(((t,s)=>{h.set(s*this.segmentWidth/(i*this._imageScaleX),0,this.segmentWidth*(s+1)/(i*this._imageScaleX),o.GetHeight()/(r*this._imageScaleY)),h.offset(-n,-a),this._runtime.IsPixelRoundingEnabled()&&(t.quad=o.PixelRoundQuad(t.quad)),0===this._imageAngle?e.Quad3(t.quad,h):(l.setFromRotatedRect(h,-this._imageAngle),e.Quad4(t.quad,l))}))}}_DrawMesh2(e,t){const s=this.rcTex,i=this.qTex;var r=this.tempQuad,n=this.tempRect;const a=e.GetTransformedMesh();e.IsMeshChanged()&&(e.CalculateBbox(n,r,!1),this._runtime.IsPixelRoundingEnabled()&&(r=e.PixelRoundQuad(r)),n=s,0!==this._imageAngle&&(i.setFromRotatedRect(s,-this._imageAngle),n=i),a.CalculateTransformedMesh(e.GetSourceMesh(),r,n),e.SetMeshChanged(!1)),a.Draw(t)}SetSegmentHeight(e,t){var s=0;if(this.isAutowavesEnabled){var i=this.segmentWidth;this.useMesh&&(i=this.wi.GetWidth()/(this.meshColumns-1));var r=this._runtime.GetDt(this._inst);r&&(e._i=0===this._period?0:(e._i+r/this._period*_2pi)%_2pi,e._i%=_2pi,s=Math.sin(e._i+_2pi/this._waveLength*i*t)*this._mag)}if(this.useMesh)i=this.wi.GetBoundingBox().getBottom(),r=this.wi.GetBoundingBox().getTop(),e=C3$jscomp$281.unlerp(r,i,r+(this.targetHeight-e.height)+s),this.wi.SetMeshPoint(t,0,{mode:"relative",x:0,y:e})&&this.wi.SetBboxChanged();else{i=(r=this.GetWorldInfo().GetBoundingQuad()).getBly();const n=r.getTlx();r=e.height,r+=s,s=(t=n+t*this.segmentWidth)+this.segmentWidth,r=i-r,e.quad.set(t,r,s,r,s,i,t,i)}}smoothSegments(){this.segments.forEach(((e,t)=>{var s=this.GetWorldInfo().GetBoundingQuad();const i=s.getBly(),r=(s=s.getTlx()+t*this.segmentWidth)+this.segmentWidth;let n=e.quad.getTly(),a=n;const o=this.segments[t+1];o&&e.quad.getTry()>=o.quad.getTly()&&(a=o.quad.getTly()),(t=this.segments[t-1])&&e.quad.getTly()>t.quad.getTry()&&(n=t.quad.getTry()),e.quad.set(s,n,r,a,r,i,s,i)}))}setSegmentHeight2(e,t){(e=e.quad).setTly(e.getBly()-t),e.setTry(e.getBry()-t)}UpdateSegment(e){e.speed+=this.tension*(this.targetHeight-e.height)-e.speed*this.dampening,e.height+=e.speed}Tick(){const e=this.segments,t=e.length;for(var s=0;s<t;s++)this.UpdateSegment(e[s],s);this.segments.forEach(((e,t)=>{this.SetSegmentHeight(e,t)})),this.isSmoothingON&&!this.useMesh&&this.smoothSegments(),s=this.spread;const i=this.lDeltas,r=this.rDeltas;i.length=0,r.length=0;for(let a=0;7>a;a++){for(var n=0;n<t;n++)0<n&&(i[n]=s*(e[n].height-e[n-1].height),e[n-1].speed+=i[n]),n<t-1&&(r[n]=s*(e[n].height-e[n+1].height),e[n+1].speed+=r[n]);for(n=0;n<t;n++)0<n&&(e[n-1].height+=i[n]),n<t-1&&(e[n+1].height+=r[n])}this._runtime.UpdateRender()}_SetMyProperty(e){this._myProperty=0}_GetMyProperty(){return this._myProperty}SaveToJson(){return{}}LoadFromJson(e){}GetScriptInterfaceClass(){return self.IMyBehaviorInstance}};const map$jscomp$27=new WeakMap;self.IMyBehaviorInstance=class extends self.IBehaviorInstance{constructor(){super(),map$jscomp$27.set(this,self.IBehaviorInstance._GetInitInst().GetSdkInstance())}set myProperty(e){map$jscomp$27.get(this)._SetMyProperty(e)}get myProperty(){return map$jscomp$27.get(this)._GetMyProperty()}},self.C3.Behaviors.aekiroWater.Cnds={IsMoving:()=>!1},self.C3.Behaviors.aekiroWater.Acts={applyForce(e,t,s){var i=this.segmentWidth;this.useMesh&&(i=this.wi.GetWidth()/(this.meshColumns-1));var r=this.wi.GetBoundingQuad();for(e=Math.floor((e-r.getBlx())/i),r=-(s=Math.floor(s/i/2));r<=s;r++)i=e+r,this.segments[i]&&(this.segments[i].speed=t);this.IsTicking()||this._StartTicking()},SetAutoWavesEnabled(e){this.isAutowavesEnabled=e},SetSmoothing(e){this.isSmoothingON=e},SetDampening(e){this.dampening=e},SetSpread(e){this.spread=e},SetTension(e){this.tension=e},SetWaveLength(e){this._waveLength=e},SetPeriod(e){this._period=e},SetMagnitude(e){this._mag=e}},self.C3.Behaviors.aekiroWater.Exps={surfaceY(e){var t=this.segmentWidth;return this.useMesh&&(t=this.wi.GetWidth()/(this.meshColumns-1)),e-=this.wi.GetBoundingBox().getLeft(),t=Math.floor(e/t),this.segments[t]?this.segments[t].quad.getTly():this.wi.GetBoundingBox().getTop()},isAutoWaveEnabled(){return this.isAutowavesEnabled?1:0},isSmoothingON(){return this.isSmoothingON?1:0}};const C3$jscomp$282=self.C3;C3$jscomp$282.Behaviors.scrollto=class extends C3$jscomp$282.SDKBehaviorBase{constructor(e){super(e),this._shakeMode=this._shakeEnd=this._shakeStart=this._shakeMag=0}Release(){super.Release()}SetShakeMagnitude(e){this._shakeMag=e}GetShakeMagnitude(){return this._shakeMag}SetShakeStart(e){this._shakeStart=e}GetShakeStart(){return this._shakeStart}SetShakeEnd(e){this._shakeEnd=e}GetShakeEnd(){return this._shakeEnd}SetShakeMode(e){this._shakeMode=e}GetShakeMode(){return this._shakeMode}};const C3$jscomp$283=self.C3;C3$jscomp$283.Behaviors.scrollto.Type=class extends C3$jscomp$283.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$284=self.C3;C3$jscomp$284.Behaviors.scrollto.Instance=class extends C3$jscomp$284.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._isEnabled=!0,t&&(this._isEnabled=t[0]),this._isEnabled&&this._StartTicking2()}Release(){super.Release()}SaveToJson(){const e=this.GetBehavior();return{e:this._isEnabled,smg:e.GetShakeMagnitude(),ss:e.GetShakeStart(),se:e.GetShakeEnd(),smd:e.GetShakeMode()}}LoadFromJson(e){const t=this.GetBehavior();t.SetShakeMagnitude(e.smg),t.SetShakeStart(e.ss),t.SetShakeEnd(e.se),t.SetShakeMode(e.smd),(this._isEnabled=e.e)?this._StartTicking2():this._StopTicking2()}_SetEnabled(e){(this._isEnabled=!!e)?this._StartTicking2():this._StopTicking2()}IsEnabled(){return this._isEnabled}Tick2(){if(this.IsEnabled()){this._runtime.GetDt(this._inst);var e=this.GetBehavior(),t=e.GetInstances(),s=0,i=0,r=0;for(var n of t)(t=n.GetBehaviorInstanceFromCtor(C3$jscomp$284.Behaviors.scrollto))&&t.GetSdkInstance().IsEnabled()&&(s+=(t=n.GetWorldInfo()).GetX(),i+=t.GetY(),++r);n=this._inst.GetWorldInfo().GetLayout();var a=this._runtime.GetGameTime(),o=t=0;a>=e.GetShakeStart()&&a<e.GetShakeEnd()&&(t=e.GetShakeMagnitude()*Math.min(this._runtime.GetTimeScale(),1),0===e.GetShakeMode()&&(t*=1-(a-e.GetShakeStart())/(e.GetShakeEnd()-e.GetShakeStart())),e=this._runtime.Random()*Math.PI*2,a=this._runtime.Random()*t,t=Math.cos(e)*a,o=Math.sin(e)*a),n.SetScrollX(s/r+t),n.SetScrollY(i/r+o)}}GetPropertyValueByIndex(e){switch(e){case 0:return this._isEnabled}}SetPropertyValueByIndex(e,t){switch(e){case 0:(this._isEnabled=!!t)?this._StartTicking2():this._StopTicking2()}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.scrollto.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}},self.C3.Behaviors.scrollto.Cnds={IsEnabled(){return this.IsEnabled()}},self.C3.Behaviors.scrollto.Acts={Shake(e,t,s){const i=this.GetBehavior();i.SetShakeMagnitude(e),i.SetShakeStart(this._runtime.GetGameTime()),i.SetShakeEnd(this._runtime.GetGameTime()+t),i.SetShakeMode(s)},SetEnabled(e){this._SetEnabled(0!==e)}},self.C3.Behaviors.scrollto.Exps={};const C3$jscomp$288=self.C3;C3$jscomp$288.Behaviors.Sin=class extends C3$jscomp$288.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$289=self.C3;C3$jscomp$289.Behaviors.Sin.Type=class extends C3$jscomp$289.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$290=self.C3,C3X$jscomp$30=self.C3X,IBehaviorInstance$jscomp$5=self.IBehaviorInstance,_2pi$jscomp$1=2*Math.PI,_pi_2$jscomp$1=Math.PI/2,_3pi_2$jscomp$1=3*Math.PI/2,MOVEMENT_LOOKUP=[0,1,8,3,4,2,5,6,9,7];C3$jscomp$290.Behaviors.Sin.Instance=class extends C3$jscomp$290.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._mag=this._period=this._wave=this._movement=this._i=0,this._isEnabled=!0,this._ratio=this._lastKnownValue2=this._lastKnownValue=this._initialValue2=this._initialValue=this._magnitudeRandom=this._periodOffsetRandom=this._periodRandom=this._baseMag=this._basePeriodOffset=this._basePeriod=0,t&&(this._movement=MOVEMENT_LOOKUP[t[0]],this._wave=t[1],this._periodRandom=this._runtime.Random()*t[3],this._basePeriod=t[2],this._period=t[2],this._period+=this._periodRandom,this._basePeriodOffset=t[4],0!==this._period&&(this._periodOffsetRandom=this._runtime.Random()*t[5],this._i=t[4]/this._period*_2pi$jscomp$1,this._i+=this._periodOffsetRandom/this._period*_2pi$jscomp$1),this._magnitudeRandom=this._runtime.Random()*t[7],this._baseMag=t[6],this._mag=t[6],this._mag+=this._magnitudeRandom,this._isEnabled=!!t[8]),5===this._movement&&(this._mag=C3$jscomp$290.toRadians(this._mag)),this.Init(),this._isEnabled&&this._StartTicking()}Release(){super.Release()}SaveToJson(){return{i:this._i,e:this._isEnabled,mv:this._movement,w:this._wave,p:this._period,mag:this._mag,iv:this._initialValue,iv2:this._initialValue2,r:this._ratio,lkv:this._lastKnownValue,lkv2:this._lastKnownValue2}}LoadFromJson(e){this._i=e.i,this._SetEnabled(e.e),this._movement=e.mv,this._wave=e.w,this._period=e.p,this._mag=e.mag,this._initialValue=e.iv,this._initialValue2=e.iv2,this._ratio=e.r,this._lastKnownValue=e.lkv,this._lastKnownValue2=e.lkv2}Init(){const e=this._inst.GetWorldInfo();switch(this._movement){case 0:this._initialValue=e.GetX();break;case 1:this._initialValue=e.GetY();break;case 2:this._initialValue=e.GetWidth(),this._ratio=e.GetHeight()/e.GetWidth();break;case 3:this._initialValue=e.GetWidth();break;case 4:this._initialValue=e.GetHeight();break;case 5:this._initialValue=e.GetAngle();break;case 6:this._initialValue=e.GetOpacity();break;case 7:this._initialValue=0;break;case 8:this._initialValue=e.GetX(),this._initialValue2=e.GetY();break;case 9:this._initialValue=e.GetZElevation()}this._lastKnownValue=this._initialValue,this._lastKnownValue2=this._initialValue2}WaveFunc(e){switch(e%=_2pi$jscomp$1,this._wave){case 0:return Math.sin(e);case 1:return e<=_pi_2$jscomp$1?e/_pi_2$jscomp$1:e<=_3pi_2$jscomp$1?1-2*(e-_pi_2$jscomp$1)/Math.PI:(e-_3pi_2$jscomp$1)/_pi_2$jscomp$1-1;case 2:return 2*e/_2pi$jscomp$1-1;case 3:return-2*e/_2pi$jscomp$1+1;case 4:return e<Math.PI?-1:1}return 0}Tick(){const e=this._runtime.GetDt(this._inst);this._isEnabled&&0!==e&&(this._i=0===this._period?0:(this._i+e/this._period*_2pi$jscomp$1)%_2pi$jscomp$1,this._UpdateFromPhase())}_UpdateFromPhase(){const e=this._inst.GetWorldInfo();switch(this._movement){case 0:e.GetX()!==this._lastKnownValue&&(this._initialValue+=e.GetX()-this._lastKnownValue),e.SetX(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetX();break;case 1:e.GetY()!==this._lastKnownValue&&(this._initialValue+=e.GetY()-this._lastKnownValue),e.SetY(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetY();break;case 2:e.SetWidth(this._initialValue+this.WaveFunc(this._i)*this._mag),e.SetHeight(e.GetWidth()*this._ratio);break;case 3:e.SetWidth(this._initialValue+this.WaveFunc(this._i)*this._mag);break;case 4:e.SetHeight(this._initialValue+this.WaveFunc(this._i)*this._mag);break;case 5:e.GetAngle()!==this._lastKnownValue&&(this._initialValue=C3$jscomp$290.clampAngle(this._initialValue+(e.GetAngle()-this._lastKnownValue))),e.SetAngle(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetAngle();break;case 6:e.SetOpacity(this._initialValue+this.WaveFunc(this._i)*this._mag/100);break;case 8:e.GetX()!==this._lastKnownValue&&(this._initialValue+=e.GetX()-this._lastKnownValue),e.GetY()!==this._lastKnownValue2&&(this._initialValue2+=e.GetY()-this._lastKnownValue2),e.SetX(this._initialValue+Math.cos(e.GetAngle())*this.WaveFunc(this._i)*this._mag),e.SetY(this._initialValue2+Math.sin(e.GetAngle())*this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetX(),this._lastKnownValue2=e.GetY();break;case 9:e.SetZElevation(this._initialValue+this.WaveFunc(this._i)*this._mag)}e.SetBboxChanged()}_OnSpriteFrameChanged(e,t){}_SetPeriod(e){this._period=e}_GetPeriod(){return this._period}_SetMagnitude(e){this._mag=e}_SetMagnitude_ConvertAngle(e){5===this._movement&&(e=C3$jscomp$290.toRadians(e)),this._SetMagnitude(e)}_GetMagnitude(){return this._mag}_GetMagnitude_ConvertAngle(){let e=this._GetMagnitude();return 5===this._movement&&(e=C3$jscomp$290.toDegrees(e)),e}_SetMovement(e){5===this._movement&&5!==e&&(this._mag=C3$jscomp$290.toDegrees(this._mag)),this._movement=e,this.Init()}_GetMovement(){return this._movement}_SetWave(e){this._wave=e}_GetWave(){return this._wave}_SetPhase(e){this._i=C3$jscomp$290.clamp(e,0,2*Math.PI),this._UpdateFromPhase()}_GetPhase(){return this._i}_SetEnabled(e){(this._isEnabled=!!e)?this._StartTicking():this._StopTicking()}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(e){switch(e){case 0:return this._movement;case 1:return this._wave;case 2:return this._basePeriod;case 6:return this._baseMag;case 8:return this._isEnabled}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._movement=MOVEMENT_LOOKUP[t],this.Init();break;case 1:this._wave=t;break;case 2:this._basePeriod=t,this._period=this._basePeriod+this._periodRandom,this._isEnabled||(0!==this._period?(this._i=this._basePeriodOffset/this._period*_2pi$jscomp$1,this._i+=this._periodOffsetRandom/this._period*_2pi$jscomp$1):this._i=0);break;case 6:this._baseMag=t,this._mag=this._baseMag+this._magnitudeRandom,5===this._movement&&(this._mag=C3$jscomp$290.toRadians(this._mag));break;case 8:this._isEnabled=!!t}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.sin.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)},{name:"behaviors.sin.properties.period.name",value:this._GetPeriod(),onedit:e=>this._SetPeriod(e)},{name:"behaviors.sin.properties.magnitude.name",value:this._GetMagnitude_ConvertAngle(),onedit:e=>this._SetMagnitude_ConvertAngle(e)},{name:"behaviors.sin.debugger.value",value:this.WaveFunc(this._GetPhase())*this._GetMagnitude_ConvertAngle()}]}]}GetScriptInterfaceClass(){return self.ISineBehaviorInstance}};const map$jscomp$28=new WeakMap,VALID_MOVEMENTS="horizontal vertical size width height angle opacity value-only forwards-backwards z-elevation".split(" "),VALID_WAVES=["sine","triangle","sawtooth","reverse-sawtooth","square"];self.ISineBehaviorInstance=class extends IBehaviorInstance$jscomp$5{constructor(){super(),map$jscomp$28.set(this,IBehaviorInstance$jscomp$5._GetInitInst().GetSdkInstance())}set period(e){C3X$jscomp$30.RequireFiniteNumber(e),map$jscomp$28.get(this)._SetPeriod(e)}get period(){return map$jscomp$28.get(this)._GetPeriod()}set magnitude(e){C3X$jscomp$30.RequireFiniteNumber(e),map$jscomp$28.get(this)._SetMagnitude(e)}get magnitude(){return map$jscomp$28.get(this)._GetMagnitude()}set phase(e){map$jscomp$28.get(this)._SetPhase(e)}get phase(){return map$jscomp$28.get(this)._GetPhase()}set movement(e){if(C3X$jscomp$30.RequireString(e),-1===(e=VALID_MOVEMENTS.indexOf(e)))throw Error("invalid movement");map$jscomp$28.get(this)._SetMovement(e)}get movement(){return VALID_MOVEMENTS[map$jscomp$28.get(this)._GetMovement()]}set wave(e){if(C3X$jscomp$30.RequireString(e),-1===(e=VALID_WAVES.indexOf(e)))throw Error("invalid wave");map$jscomp$28.get(this)._SetWave(e)}get wave(){return VALID_WAVES[map$jscomp$28.get(this)._GetWave()]}get value(){const e=map$jscomp$28.get(this);return e.WaveFunc(e._GetPhase())*e._GetMagnitude()}updateInitialState(){map$jscomp$28.get(this).Init()}set isEnabled(e){map$jscomp$28.get(this)._SetEnabled(!!e)}get isEnabled(){return map$jscomp$28.get(this)._IsEnabled()}};const C3$jscomp$291=self.C3;C3$jscomp$291.Behaviors.Sin.Cnds={IsEnabled(){return this._IsEnabled()},CompareMovement(e){return this._GetMovement()===e},ComparePeriod(e,t){return C3$jscomp$291.compare(this._GetPeriod(),e,t)},CompareMagnitude(e,t){return C3$jscomp$291.compare(this._GetMagnitude_ConvertAngle(),e,t)},CompareWave(e){return this._GetWave()===e}},self.C3.Behaviors.Sin.Acts={SetEnabled(e){this._SetEnabled(0!==e)},SetPeriod(e){this._SetPeriod(e)},SetMagnitude(e){this._SetMagnitude_ConvertAngle(e)},SetMovement(e){this._SetMovement(e)},SetWave(e){this._wave=e},SetPhase(e){const t=2*Math.PI;this._SetPhase(e*t%t)},UpdateInitialState(){this.Init()}},self.C3.Behaviors.Sin.Exps={CyclePosition(){return this._GetPhase()/(2*Math.PI)},Period(){return this._GetPeriod()},Magnitude(){return this._GetMagnitude_ConvertAngle()},Value(){return this.WaveFunc(this._GetPhase())*this._GetMagnitude_ConvertAngle()}};const C3$jscomp$294=self.C3;C3$jscomp$294.Behaviors.Persist=class extends C3$jscomp$294.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$295=self.C3;C3$jscomp$295.Behaviors.Persist.Type=class extends C3$jscomp$295.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$296=self.C3;C3$jscomp$296.Behaviors.Persist.Instance=class extends C3$jscomp$296.SDKBehaviorInstanceBase{constructor(e,t){super(e)}Release(){super.Release()}},self.C3.Behaviors.Persist.Cnds={},self.C3.Behaviors.Persist.Acts={},self.C3.Behaviors.Persist.Exps={};const C3$jscomp$300=self.C3;C3$jscomp$300.Behaviors.Bullet=class extends C3$jscomp$300.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$301=self.C3;C3$jscomp$301.Behaviors.Bullet.Type=class extends C3$jscomp$301.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$302=self.C3,C3X$jscomp$31=self.C3X,IBehaviorInstance$jscomp$6=self.IBehaviorInstance;C3$jscomp$302.Behaviors.Bullet.Instance=class extends C3$jscomp$302.SDKBehaviorInstanceBase{constructor(e,t){super(e),e=this.GetWorldInfo(),this._g=this._acc=this._speed=0,this._isStepping=this._setAngle=this._bounceOffSolid=!1,this._isEnabled=!0,this._dy=this._dx=0,this._lastX=e.GetX(),this._lastY=e.GetY(),this._lastKnownAngle=e.GetAngle(),this._travelled=0,this._stepSize=Math.min(Math.abs(e.GetWidth()),Math.abs(e.GetHeight())/2),this._stopStepping=!1,t&&(this._speed=t[0],this._acc=t[1],this._g=t[2],this._bounceOffSolid=!!t[3],this._setAngle=!!t[4],this._isStepping=!!t[5],this._isEnabled=!!t[6]),t=e.GetAngle(),this._dx=Math.cos(t)*this._speed,this._dy=Math.sin(t)*this._speed,this._isEnabled&&(this._StartTicking(),this._bounceOffSolid&&this._StartPostTicking())}Release(){super.Release()}SaveToJson(){const e={dx:this._dx,dy:this._dy,lx:this._lastX,ly:this._lastY,lka:this._lastKnownAngle,t:this._travelled};return 0!==this._acc&&(e.acc=this._acc),0!==this._g&&(e.g=this._g),this._isStepping&&(e.st=this._isStepping),this._isEnabled||(e.e=this._isEnabled),this._bounceOffSolid&&(e.bos=this._bounceOffSolid),this._setAngle&&(e.sa=this._setAngle),e}LoadFromJson(e){this._dx=e.dx,this._dy=e.dy,this._lastX=e.lx,this._lastY=e.ly,this._lastKnownAngle=e.lka,this._travelled=e.t,this._acc=e.hasOwnProperty("acc")?e.acc:0,this._g=e.hasOwnProperty("g")?e.g:0,this._isStepping=!!e.hasOwnProperty("st")&&e.st,this._bounceOffSolid=!!e.hasOwnProperty("bos")&&e.bos,this._setAngle=!!e.hasOwnProperty("sa")&&e.sa,this._SetEnabled(!e.hasOwnProperty("e")||e.e)}Tick(){if(this._isEnabled){var e=this._runtime.GetDt(this._inst),t=this._inst.GetWorldInfo();if(t.GetAngle()!==this._lastKnownAngle){var s=t.GetAngle();if(this._setAngle){var i=C3$jscomp$302.distanceTo(0,0,this._dx,this._dy);this._dx=Math.cos(s)*i,this._dy=Math.sin(s)*i}this._lastKnownAngle=s}if(s=i=0,0!==this._acc){let r,n=C3$jscomp$302.distanceTo(0,0,this._dx,this._dy);r=0===this._dx&&0===this._dy?t.GetAngle():C3$jscomp$302.angleTo(0,0,this._dx,this._dy),n+=this._acc*e,i=Math.cos(r)*this._acc,s=Math.sin(r)*this._acc,0>n&&(s=i=n=0),this._dx=Math.cos(r)*n,this._dy=Math.sin(r)*n}0!==this._g&&(this._dy+=this._g*e,s+=this._g),this._lastX=t.GetX(),this._lastY=t.GetY(),0===this._dx&&0===this._dy||(i=this._dx*e+.5*i*e*e,e=this._dy*e+.5*s*e*e,s=C3$jscomp$302.distanceTo(0,0,i,e),this._MoveBy(i,e,s),this._travelled+=s,!this._setAngle||0===i&&0===e||(e=C3$jscomp$302.angleTo(0,0,i,e),t.SetAngle(e),this._lastKnownAngle=t.GetAngle()),t.SetBboxChanged())}}_MoveBy(e,t,s){const i=this.GetWorldInfo();if(!this._isStepping||s<=this._stepSize)i.OffsetXY(e,t),i.SetBboxChanged(),this._isStepping&&this.Trigger(C3$jscomp$302.Behaviors.Bullet.Cnds.OnStep);else{this._stopStepping=!1;var r=i.GetX(),n=i.GetY(),a=r+e,o=n+t;t=C3$jscomp$302.angleTo(0,0,e,t),e=Math.cos(t)*this._stepSize,t=Math.sin(t)*this._stepSize,s=Math.floor(s/this._stepSize);for(let a=1;a<=s;++a)if(i.SetXY(r+e*a,n+t*a),i.SetBboxChanged(),this.Trigger(C3$jscomp$302.Behaviors.Bullet.Cnds.OnStep),this._inst.IsDestroyed()||this._stopStepping)return;i.SetXY(a,o),i.SetBboxChanged(),this.Trigger(C3$jscomp$302.Behaviors.Bullet.Cnds.OnStep)}}PostTick(){if(this._isEnabled&&this._bounceOffSolid&&(0!==this._dx||0!==this._dy)){var e=this._runtime.GetDt(this._inst),t=this._inst.GetWorldInfo(),s=this._runtime.GetCollisionEngine(),i=s.TestOverlapSolid(this._inst);if(i){s.RegisterCollision(this._inst,i),i=C3$jscomp$302.distanceTo(0,0,this._dx,this._dy);const r=s.CalculateBounceAngle(this._inst,this._lastX,this._lastY);this._dx=Math.cos(r)*i,this._dy=Math.sin(r)*i,t.OffsetXY(this._dx*e,this._dy*e),t.SetBboxChanged(),this._setAngle&&(t.SetAngle(r),this._lastKnownAngle=t.GetAngle(),t.SetBboxChanged()),s.PushOutSolid(this._inst,this._dx/i,this._dy/i,Math.max(2.5*i*e,30))||s.PushOutSolidNearest(this._inst,100)}}}GetPropertyValueByIndex(e){switch(e){case 0:return this._GetSpeed();case 1:return this._GetAcceleration();case 2:return this._GetGravity();case 4:return this._setAngle;case 5:return this._isStepping;case 6:return this._IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._SetSpeed(t);break;case 1:this._acc=t;break;case 2:this._g=t;break;case 4:this._setAngle=!!t;break;case 5:this._isStepping=!!t;break;case 6:this._SetEnabled(!!t)}}_SetSpeed(e){const t=C3$jscomp$302.angleTo(0,0,this._dx,this._dy);this._dx=Math.cos(t)*e,this._dy=Math.sin(t)*e}_GetSpeed(){return C3$jscomp$302.round6dp(C3$jscomp$302.distanceTo(0,0,this._dx,this._dy))}_SetAcceleration(e){this._acc=e}_GetAcceleration(){return this._acc}_SetGravity(e){this._g=e}_GetGravity(){return this._g}_SetAngleOfMotion(e){const t=C3$jscomp$302.distanceTo(0,0,this._dx,this._dy);this._dx=Math.cos(e)*t,this._dy=Math.sin(e)*t}_GetAngleOfMotion(){return C3$jscomp$302.angleTo(0,0,this._dx,this._dy)}_SetBounceOffSolids(e){e=!!e,this._bounceOffSolid!==e&&(this._bounceOffSolid=e,this._isEnabled&&(this._bounceOffSolid?this._StartPostTicking():this._StopPostTicking()))}_IsBounceOffSolids(){return this._bounceOffSolid}_SetDistanceTravelled(e){this._travelled=e}_GetDistanceTravelled(){return this._travelled}_SetEnabled(e){(this._isEnabled=!!e)?(this._StartTicking(),this._bounceOffSolid&&this._StartPostTicking()):(this._StopTicking(),this._StopPostTicking())}_IsEnabled(){return this._isEnabled}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.bullet.debugger.vector-x",value:this._dx,onedit:e=>this._dx=e},{name:"behaviors.bullet.debugger.vector-y",value:this._dy,onedit:e=>this._dy=e},{name:"behaviors.bullet.properties.speed.name",value:this._GetSpeed(),onedit:e=>this._SetSpeed(e)},{name:"behaviors.bullet.debugger.angle-of-motion",value:C3$jscomp$302.toDegrees(this._GetAngleOfMotion())},{name:"behaviors.bullet.properties.gravity.name",value:this._GetGravity(),onedit:e=>this._SetGravity(e)},{name:"behaviors.bullet.properties.acceleration.name",value:this._GetAcceleration(),onedit:e=>this._SetAcceleration(e)},{name:"behaviors.bullet.debugger.distance-travelled",value:this._GetDistanceTravelled()},{name:"behaviors.bullet.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IBulletBehaviorInstance}};const map$jscomp$29=new WeakMap;self.IBulletBehaviorInstance=class extends IBehaviorInstance$jscomp$6{constructor(){super(),map$jscomp$29.set(this,IBehaviorInstance$jscomp$6._GetInitInst().GetSdkInstance())}get speed(){return map$jscomp$29.get(this)._GetSpeed()}set speed(e){C3X$jscomp$31.RequireFiniteNumber(e),map$jscomp$29.get(this)._SetSpeed(e)}get acceleration(){return map$jscomp$29.get(this)._GetAcceleration()}set acceleration(e){C3X$jscomp$31.RequireFiniteNumber(e),map$jscomp$29.get(this)._SetAcceleration(e)}get gravity(){return map$jscomp$29.get(this)._GetGravity()}set gravity(e){C3X$jscomp$31.RequireFiniteNumber(e),map$jscomp$29.get(this)._SetGravity(e)}get angleOfMotion(){return map$jscomp$29.get(this)._GetAngleOfMotion()}set angleOfMotion(e){C3X$jscomp$31.RequireFiniteNumber(e),map$jscomp$29.get(this)._SetAngleOfMotion(e)}get bounceOffSolids(){return map$jscomp$29.get(this)._IsBounceOffSolids()}set bounceOffSolids(e){map$jscomp$29.get(this)._SetBounceOffSolids(!!e)}get distanceTravelled(){return map$jscomp$29.get(this)._GetDistanceTravelled()}set distanceTravelled(e){C3X$jscomp$31.RequireFiniteNumber(e),map$jscomp$29.get(this)._SetDistanceTravelled(e)}get isEnabled(){return map$jscomp$29.get(this)._IsEnabled()}set isEnabled(e){map$jscomp$29.get(this)._SetEnabled(e)}};const C3$jscomp$303=self.C3;C3$jscomp$303.Behaviors.Bullet.Cnds={CompareSpeed(e,t){return C3$jscomp$303.compare(Math.hypot(this._dx,this._dy),e,t)},CompareTravelled(e,t){return C3$jscomp$303.compare(this._GetDistanceTravelled(),e,t)},OnStep:()=>!0,IsEnabled(){return this._IsEnabled()}};const C3$jscomp$304=self.C3;C3$jscomp$304.Behaviors.Bullet.Acts={SetSpeed(e){this._SetSpeed(e)},SetAcceleration(e){this._SetAcceleration(e)},SetGravity(e){this._SetGravity(e)},SetAngleOfMotion(e){this._SetAngleOfMotion(C3$jscomp$304.toRadians(e))},Bounce(e){if(e&&(e=e.GetFirstPicked(this._inst))){var t=this._inst.GetWorldInfo(),s=this._runtime.GetCollisionEngine(),i=this._runtime.GetDt(this._inst),r=C3$jscomp$304.distanceTo(0,0,this._dx,this._dy),n=s.CalculateBounceAngle(this._inst,this._lastX,this._lastY,e);this._dx=Math.cos(n)*r,this._dy=Math.sin(n)*r,t.OffsetXY(this._dx*i,this._dy*i),t.SetBboxChanged(),this._setAngle&&(t.SetAngle(n),this._lastKnownAngle=t.GetAngle(),t.SetBboxChanged()),0!==r&&(this._bounceOffSolid?s.PushOutSolid(this._inst,this._dx/r,this._dy/r,Math.max(2.5*r*i,30))||s.PushOutSolidNearest(this._inst,100):s.PushOut(this._inst,this._dx/r,this._dy/r,Math.max(2.5*r*i,30),e))}},SetBounceOffSolids(e){this._SetBounceOffSolids(e)},SetDistanceTravelled(e){this._SetDistanceTravelled(e)},SetEnabled(e){this._SetEnabled(e)},StopStepping(){this._stopStepping=!0}};const C3$jscomp$305=self.C3;C3$jscomp$305.Behaviors.Bullet.Exps={Speed(){return this._GetSpeed()},Acceleration(){return this._GetAcceleration()},AngleOfMotion(){return C3$jscomp$305.toDegrees(this._GetAngleOfMotion())},DistanceTravelled(){return this._GetDistanceTravelled()},Gravity(){return this._GetGravity()}};const C3$jscomp$306=self.C3;C3$jscomp$306.Behaviors.Fade=class extends C3$jscomp$306.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$307=self.C3;C3$jscomp$307.Behaviors.Fade.Type=class extends C3$jscomp$307.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$308=self.C3,C3X$jscomp$32=self.C3X,IBehaviorInstance$jscomp$7=self.IBehaviorInstance;C3$jscomp$308.Behaviors.Fade.Instance=class extends C3$jscomp$308.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._fadeOutTime=this._waitTime=this._fadeInTime=0,this._activeAtStart=this._destroy=!0,this._setMaxOpacity=!1,this._stage=0,this._stageTime=C3$jscomp$308.New(C3$jscomp$308.KahanSum),this._maxOpacity=this._inst.GetWorldInfo().GetOpacity()||1,t&&(this._fadeInTime=t[0],this._waitTime=t[1],this._fadeOutTime=t[2],this._destroy=!!t[3],this._stage=(this._activeAtStart=!!t[4])?0:3),this._activeAtStart&&(0===this._fadeInTime?(this._stage=1,0===this._waitTime&&(this._stage=2)):(this._inst.GetWorldInfo().SetOpacity(0),this._runtime.UpdateRender())),this._StartTicking()}Release(){super.Release()}SaveToJson(){return{fit:this._fadeInTime,wt:this._waitTime,fot:this._fadeOutTime,d:this._destroy,s:this._stage,st:this._stageTime.Get(),mo:this._maxOpacity}}LoadFromJson(e){this._fadeInTime=e.fit,this._waitTime=e.wt,this._fadeOutTime=e.fot,this._destroy=e.d,this._stage=e.s,this._stageTime.Set(e.st),this._maxOpacity=e.mo,3===this._stage?this._StopTicking():this._StartTicking()}Tick(){var e=this._runtime.GetDt(this._inst);this._stageTime.Add(e),e=this._inst.GetWorldInfo(),0===this._stage&&(e.SetOpacity(this._stageTime.Get()/this._fadeInTime*this._maxOpacity),this._runtime.UpdateRender(),e.GetOpacity()>=this._maxOpacity&&(e.SetOpacity(this._maxOpacity),this._stage=1,this._stageTime.Reset(),this.DispatchScriptEvent("fadeinend"),this.Trigger(C3$jscomp$308.Behaviors.Fade.Cnds.OnFadeInEnd))),1===this._stage&&this._stageTime.Get()>=this._waitTime&&(this._stage=2,this._stageTime.Reset(),this.DispatchScriptEvent("waitend"),this.Trigger(C3$jscomp$308.Behaviors.Fade.Cnds.OnWaitEnd)),2===this._stage&&(0!==this._fadeOutTime?(e.SetOpacity(this._maxOpacity-this._stageTime.Get()/this._fadeOutTime*this._maxOpacity),this._runtime.UpdateRender(),0>=e.GetOpacity()&&(this._stage=3,this._stageTime.Reset(),this.DispatchScriptEvent("fadeoutend"),this.Trigger(C3$jscomp$308.Behaviors.Fade.Cnds.OnFadeOutEnd),this._destroy&&this._runtime.DestroyInstance(this._inst))):(this._stage=3,this._stageTime.Reset())),3===this._stage&&this._StopTicking()}_StartFade(){this._activeAtStart||this._setMaxOpacity||(this._maxOpacity=this._inst.GetWorldInfo().GetOpacity()||1,this._setMaxOpacity=!0),3===this._stage&&this.Start()}_RestartFade(){this.Start()}Start(){this._stage=0,this._stageTime.Reset(),0===this._fadeInTime?(this._stage=1,0===this._waitTime&&(this._stage=2)):(this._inst.GetWorldInfo().SetOpacity(0),this._runtime.UpdateRender()),this._StartTicking()}_SetFadeInTime(e){this._fadeInTime=Math.max(e,0)}_GetFadeInTime(){return this._fadeInTime}_SetWaitTime(e){this._waitTime=Math.max(e,0)}_GetWaitTime(){return this._waitTime}_SetFadeOutTime(e){this._fadeOutTime=Math.max(e,0)}_GetFadeOutTime(){return this._fadeOutTime}GetPropertyValueByIndex(e){switch(e){case 0:return this._GetFadeInTime();case 1:return this._GetWaitTime();case 2:return this._GetFadeOutTime();case 3:return this._destroy}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._SetFadeInTime(t);break;case 1:this._SetWaitTime(t);break;case 2:this._SetFadeOutTime(t);break;case 3:this._destroy=!!t}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.fade.properties.fade-in-time.name",value:this._GetFadeInTime(),onedit:e=>this._SetFadeInTime(e)},{name:"behaviors.fade.properties.wait-time.name",value:this._GetWaitTime(),onedit:e=>this._SetWaitTime(e)},{name:"behaviors.fade.properties.fade-out-time.name",value:this._GetFadeOutTime(),onedit:e=>this._SetFadeOutTime(e)},{name:"behaviors.fade.debugger.stage",value:["behaviors.fade.debugger."+["fade-in","wait","fade-out","done"][this._stage]]}]}]}GetScriptInterfaceClass(){return self.IFadeBehaviorInstance}};const map$jscomp$30=new WeakMap;self.IFadeBehaviorInstance=class extends IBehaviorInstance$jscomp$7{constructor(){super(),map$jscomp$30.set(this,IBehaviorInstance$jscomp$7._GetInitInst().GetSdkInstance())}startFade(){map$jscomp$30.get(this)._StartFade()}restartFade(){map$jscomp$30.get(this)._RestartFade()}set fadeInTime(e){C3X$jscomp$32.RequireFiniteNumber(e),map$jscomp$30.get(this)._SetFadeInTime(e)}get fadeInTime(){return map$jscomp$30.get(this)._GetFadeInTime()}set waitTime(e){C3X$jscomp$32.RequireFiniteNumber(e),map$jscomp$30.get(this)._SetWaitTime(e)}get waitTime(){return map$jscomp$30.get(this)._GetWaitTime()}set fadeOutTime(e){C3X$jscomp$32.RequireFiniteNumber(e),map$jscomp$30.get(this)._SetFadeOutTime(e)}get fadeOutTime(){return map$jscomp$30.get(this)._GetFadeOutTime()}},self.C3.Behaviors.Fade.Cnds={OnFadeOutEnd:()=>!0,OnFadeInEnd:()=>!0,OnWaitEnd:()=>!0},self.C3.Behaviors.Fade.Acts={StartFade(){this._StartFade()},RestartFade(){this._RestartFade()},SetFadeInTime(e){this._SetFadeInTime(e)},SetWaitTime(e){this._SetWaitTime(e)},SetFadeOutTime(e){this._SetFadeOutTime(e)}},self.C3.Behaviors.Fade.Exps={FadeInTime(){return this._GetFadeInTime()},WaitTime(){return this._GetWaitTime()},FadeOutTime(){return this._GetFadeOutTime()}};const C3$jscomp$312=self.C3;C3$jscomp$312.Behaviors.Anchor=class extends C3$jscomp$312.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$313=self.C3;C3$jscomp$313.Behaviors.Anchor.Type=class extends C3$jscomp$313.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$314=self.C3,IBehaviorInstance$jscomp$8=self.IBehaviorInstance;C3$jscomp$314.Behaviors.Anchor.Instance=class extends C3$jscomp$314.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._anchorTop=this._anchorLeft=2,this._anchorBottom=this._anchorRight=0,this._isEnabled=!0,e=this._inst.GetWorldInfo().GetBoundingBox(),this._xLeft=e.getLeft(),this._yTop=e.getTop(),this._xRight=this._runtime.GetOriginalViewportWidth()-e.getLeft(),this._yBottom=this._runtime.GetOriginalViewportHeight()-e.getTop(),this._rDiff=this._runtime.GetOriginalViewportWidth()-e.getRight(),this._bDiff=this._runtime.GetOriginalViewportHeight()-e.getBottom(),t&&(this._anchorLeft=t[0],this._anchorTop=t[1],this._anchorRight=t[2],this._anchorBottom=t[3],this._isEnabled=!!t[4]),t=this._runtime.Dispatcher(),this._disposables=new C3$jscomp$314.CompositeDisposable(C3$jscomp$314.Disposable.From(t,"layoutchange",(()=>this._OnLayoutChange()))),this._isEnabled&&this._StartTicking()}Release(){super.Release()}SaveToJson(){return{xl:this._xLeft,yt:this._yTop,xr:this._xRight,yb:this._yBottom,rd:this._rDiff,bd:this._bDiff,al:this._anchorLeft,at:this._anchorTop,ar:this._anchorRight,ab:this._anchorBottom,e:this._isEnabled}}LoadFromJson(e){this._xLeft=e.xl,this._yTop=e.yt,this._xRight=e.xr,this._yBottom=e.yb,this._rDiff=e.rd,this._bDiff=e.bd,this._anchorLeft=e.al,this._anchorTop=e.at,this._anchorRight=e.ar,this._anchorBottom=e.ab,(this._isEnabled=e.e)?this._StartTicking():this._StopTicking()}_SetEnabled(e){this._isEnabled&&!e?(this._isEnabled=!1,this._StopTicking()):!this._isEnabled&&e&&(e=this._inst.GetWorldInfo().GetBoundingBox(),this._xLeft=e.getLeft(),this._yTop=e.getTop(),this._xRight=this._runtime.GetOriginalViewportWidth()-e.getLeft(),this._yBottom=this._runtime.GetOriginalViewportHeight()-e.getTop(),this._rDiff=this._runtime.GetOriginalViewportWidth()-e.getRight(),this._bDiff=this._runtime.GetOriginalViewportHeight()-e.getBottom(),this._isEnabled=!0,this._StartTicking())}_IsEnabled(){return this._isEnabled}_UpdatePosition(){if(this._isEnabled){var e=this._inst.GetWorldInfo(),t=e.GetLayer().GetViewport();if(0===this._anchorLeft){var s=t.getLeft()+this._xLeft-e.GetBoundingBox().getLeft();0!==s&&(e.OffsetX(s),e.SetBboxChanged())}else 1===this._anchorLeft&&(0!==(s=t.getRight()-this._xRight-e.GetBoundingBox().getLeft())&&(e.OffsetX(s),e.SetBboxChanged()));0===this._anchorTop?0!==(s=t.getTop()+this._yTop-e.GetBoundingBox().getTop())&&(e.OffsetY(s),e.SetBboxChanged()):1===this._anchorTop&&(0!==(s=t.getBottom()-this._yBottom-e.GetBoundingBox().getTop())&&(e.OffsetY(s),e.SetBboxChanged())),1===this._anchorRight&&(0!==(s=t.getRight()-this._rDiff-e.GetBoundingBox().getRight())&&(e.OffsetX(e.GetOriginX()*s),e.SetWidth(Math.max(e.GetWidth()+s),0),e.SetBboxChanged(),this._rDiff=t.getRight()-e.GetBoundingBox().getRight())),1===this._anchorBottom&&(0!==(s=t.getBottom()-this._bDiff-e.GetBoundingBox().getBottom())&&(e.OffsetY(e.GetOriginY()*s),e.SetHeight(Math.max(e.GetHeight()+s,0)),e.SetBboxChanged(),this._bDiff=t.getBottom()-e.GetBoundingBox().getBottom()))}}Tick(){this._UpdatePosition()}_OnLayoutChange(){this._UpdatePosition()}GetPropertyValueByIndex(e){switch(e){case 0:return this._anchorLeft;case 1:return this._anchorTop;case 2:return this._anchorRight;case 3:return this._anchorBottom;case 4:return this._isEnabled}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._anchorLeft=t;break;case 1:this._anchorTop=t;break;case 2:this._anchorRight=t;break;case 3:this._anchorBottom=t;break;case 4:(this._isEnabled=!!t)?this._StartTicking():this._StopTicking()}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.anchor.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IAnchorBehaviorInstance}};const map$jscomp$31=new WeakMap;self.IAnchorBehaviorInstance=class extends IBehaviorInstance$jscomp$8{constructor(){super(),map$jscomp$31.set(this,IBehaviorInstance$jscomp$8._GetInitInst().GetSdkInstance())}get isEnabled(){return map$jscomp$31.get(this)._IsEnabled()}set isEnabled(e){map$jscomp$31.get(this)._SetEnabled(e)}},self.C3.Behaviors.Anchor.Cnds={IsEnabled(){return this._IsEnabled()}},self.C3.Behaviors.Anchor.Acts={SetEnabled(e){this._SetEnabled(0!==e)}},self.C3.Behaviors.Anchor.Exps={};const C3$jscomp$318=self.C3;C3$jscomp$318.Behaviors.destroy=class extends C3$jscomp$318.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$319=self.C3;C3$jscomp$319.Behaviors.destroy.Type=class extends C3$jscomp$319.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$320=self.C3;C3$jscomp$320.Behaviors.destroy.Instance=class extends C3$jscomp$320.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._StartTicking()}Release(){super.Release()}Tick(){var e=this._inst.GetWorldInfo();const t=e.GetBoundingBox();e=e.GetLayout(),(0>t.getRight()||0>t.getBottom()||t.getLeft()>e.GetWidth()||t.getTop()>e.GetHeight())&&this._runtime.DestroyInstance(this._inst)}},self.C3.Behaviors.destroy.Cnds={},self.C3.Behaviors.destroy.Acts={},self.C3.Behaviors.destroy.Exps={};const C3$jscomp$324=self.C3;C3$jscomp$324.Behaviors.Rotate=class extends C3$jscomp$324.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}};const C3$jscomp$325=self.C3;C3$jscomp$325.Behaviors.Rotate.Type=class extends C3$jscomp$325.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$326=self.C3,C3X$jscomp$34=self.C3X,IBehaviorInstance$jscomp$9=self.IBehaviorInstance;C3$jscomp$326.Behaviors.Rotate.Instance=class extends C3$jscomp$326.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._acceleration=this._speed=0,this._isEnabled=!0,t&&(this._speed=C3$jscomp$326.toRadians(t[0]),this._acceleration=C3$jscomp$326.toRadians(t[1]),this._isEnabled=t[2]),this._isEnabled&&this._StartTicking()}Release(){super.Release()}_SetSpeed(e){this._speed=e}_GetSpeed(){return this._speed}_SetAcceleration(e){this._acceleration=e}_GetAcceleration(){return this._acceleration}SaveToJson(){return{s:this._speed,a:this._acceleration,e:this._isEnabled}}LoadFromJson(e){this._speed=e.s,this._acceleration=e.a,this._SetEnabled(e.e)}Tick(){if(this._isEnabled){var e=this._runtime.GetDt(this._inst);if(0!==e&&(0!==this._acceleration&&(this._speed+=this._acceleration*e),0!==this._speed)){const t=this._inst.GetWorldInfo();t.SetAngle(t.GetAngle()+this._speed*e),t.SetBboxChanged()}}}GetPropertyValueByIndex(e){switch(e){case 0:return C3$jscomp$326.toDegrees(this._GetSpeed());case 1:return C3$jscomp$326.toDegrees(this._GetAcceleration());case 2:return this._IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._SetSpeed(C3$jscomp$326.toRadians(t));break;case 1:this._SetAcceleration(C3$jscomp$326.toRadians(t));break;case 2:this._SetEnabled(t)}}_SetEnabled(e){(this._isEnabled=!!e)?this._StartTicking():this._StopTicking()}_IsEnabled(){return this._isEnabled}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.rotate.properties.speed.name",value:C3$jscomp$326.toDegrees(this._GetSpeed()),onedit:e=>this._SetSpeed(C3$jscomp$326.toRadians(e))},{name:"behaviors.rotate.properties.acceleration.name",value:C3$jscomp$326.toDegrees(this._GetAcceleration()),onedit:e=>this._SetAcceleration(C3$jscomp$326.toRadians(e))},{name:"behaviors.rotate.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IRotateBehaviorInstance}};const map$jscomp$32=new WeakMap;self.IRotateBehaviorInstance=class extends IBehaviorInstance$jscomp$9{constructor(){super(),map$jscomp$32.set(this,IBehaviorInstance$jscomp$9._GetInitInst().GetSdkInstance())}set speed(e){C3X$jscomp$34.RequireFiniteNumber(e),map$jscomp$32.get(this)._SetSpeed(e)}get speed(){return map$jscomp$32.get(this)._GetSpeed()}set acceleration(e){C3X$jscomp$34.RequireFiniteNumber(e),map$jscomp$32.get(this)._SetAcceleration(e)}get acceleration(){return map$jscomp$32.get(this)._GetAcceleration()}get isEnabled(){return map$jscomp$32.get(this)._IsEnabled()}set isEnabled(e){map$jscomp$32.get(this)._SetEnabled(e)}},self.C3.Behaviors.Rotate.Cnds={IsEnabled(){return this._IsEnabled()}};const C3$jscomp$328=self.C3;C3$jscomp$328.Behaviors.Rotate.Acts={SetSpeed(e){this._SetSpeed(C3$jscomp$328.toRadians(e))},SetAcceleration(e){this._SetAcceleration(C3$jscomp$328.toRadians(e))},SetEnabled(e){this._SetEnabled(e)}};const C3$jscomp$329=self.C3;C3$jscomp$329.Behaviors.Rotate.Exps={Speed(){return C3$jscomp$329.toDegrees(this._GetSpeed())},Acceleration(){return C3$jscomp$329.toDegrees(this._GetAcceleration())}};const C3$jscomp$330=self.C3;C3$jscomp$330.Behaviors.DragnDrop=class extends C3$jscomp$330.SDKBehaviorBase{constructor(e){super(e),e=this._runtime.Dispatcher(),this._disposables=new C3$jscomp$330.CompositeDisposable(C3$jscomp$330.Disposable.From(e,"pointerdown",(e=>this._OnPointerDown(e.data))),C3$jscomp$330.Disposable.From(e,"pointermove",(e=>this._OnPointerMove(e.data))),C3$jscomp$330.Disposable.From(e,"pointerup",(e=>this._OnPointerUp(e.data,!1))),C3$jscomp$330.Disposable.From(e,"pointercancel",(e=>this._OnPointerUp(e.data,!0))))}Release(){this._disposables.Release(),this._disposables=null,super.Release()}_OnPointerDown(e){"mouse"===e.pointerType&&0!==e.button||this._OnInputDown(e.pointerId.toString(),e.pageX-this._runtime.GetCanvasClientX(),e.pageY-this._runtime.GetCanvasClientY())}_OnPointerMove(e){0!=(1&e.lastButtons)&&0==(1&e.buttons)?this._OnInputUp(e.pointerId.toString()):this._OnInputMove(e.pointerId.toString(),e.pageX-this._runtime.GetCanvasClientX(),e.pageY-this._runtime.GetCanvasClientY())}_OnPointerUp(e,t){"mouse"===e.pointerType&&0!==e.button||this._OnInputUp(e.pointerId.toString())}async _OnInputDown(e,t,s){var i=this.GetInstances();let r=null,n=null,a=0,o=0;for(const e of i){if(!(i=e.GetBehaviorSdkInstanceFromCtor(C3$jscomp$330.Behaviors.DragnDrop)).IsEnabled()||i.IsDragging()||e.IsDestroyed())continue;const h=e.GetWorldInfo(),l=h.GetLayer(),[c,u]=l.CanvasCssToLayer(t,s,h.GetTotalZElevation());if(!l.IsSelfAndParentsInteractive()||!h.ContainsPoint(c,u))continue;if(!r){r=e,n=i,a=c,o=u;continue}const p=r.GetWorldInfo();(l.GetIndex()>p.GetLayer().GetIndex()||l.GetIndex()===p.GetLayer().GetIndex()&&h.GetZIndex()>p.GetZIndex())&&(r=e,n=i,a=c,o=u)}r&&await n._OnDown(e,a,o)}_OnInputMove(e,t,s){var i=this.GetInstances();for(const r of i){if(!(i=r.GetBehaviorSdkInstanceFromCtor(C3$jscomp$330.Behaviors.DragnDrop)).IsEnabled()||!i.IsDragging()||i.IsDragging()&&i.GetDragSource()!==e)continue;const n=r.GetWorldInfo(),a=n.GetLayer(),[o,h]=a.CanvasCssToLayer(t,s,n.GetTotalZElevation());i._OnMove(o,h)}}async _OnInputUp(e){var t=this.GetInstances();for(const s of t)(t=s.GetBehaviorSdkInstanceFromCtor(C3$jscomp$330.Behaviors.DragnDrop)).IsDragging()&&t.GetDragSource()===e&&await t._OnUp()}};const C3$jscomp$331=self.C3;C3$jscomp$331.Behaviors.DragnDrop.Type=class extends C3$jscomp$331.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$332=self.C3,IBehaviorInstance$jscomp$10=self.IBehaviorInstance;C3$jscomp$332.Behaviors.DragnDrop.Instance=class extends C3$jscomp$332.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._isDragging=!1,this._dy=this._dx=0,this._dragSource="<none>",this._axes=0,this._isEnabled=!0,t&&(this._axes=t[0],this._isEnabled=t[1])}Release(){super.Release()}SaveToJson(){return{a:this._axes,e:this._isEnabled}}LoadFromJson(e){this._axes=e.a,this._isEnabled=e.e,this._isDragging=!1}_SetEnabled(e){this._isEnabled=!!e,this._isEnabled||(this._isDragging=!1)}IsEnabled(){return this._isEnabled}_SetAxes(e){this._axes=e}_GetAxes(){return this._axes}_Drop(){this._isDragging&&this._OnUp()}IsDragging(){return this._isDragging}GetDragSource(){return this._dragSource}async _OnDown(e,t,s){const i=this.GetWorldInfo();this._dx=t-i.GetX(),this._dy=s-i.GetY(),this._isDragging=!0,this._dragSource=e,this.DispatchScriptEvent("dragstart"),await this.TriggerAsync(C3$jscomp$332.Behaviors.DragnDrop.Cnds.OnDragStart)}_OnMove(e,t){const s=this.GetWorldInfo();e-=this._dx,t-=this._dy,0===this._axes?s.GetX()===e&&s.GetY()===t||(s.SetXY(e,t),s.SetBboxChanged()):1===this._axes?s.GetX()!==e&&(s.SetX(e),s.SetBboxChanged()):2===this._axes&&s.GetY()!==t&&(s.SetY(t),s.SetBboxChanged())}async _OnUp(){this._isDragging=!1,this.DispatchScriptEvent("drop"),await this.TriggerAsync(C3$jscomp$332.Behaviors.DragnDrop.Cnds.OnDrop)}GetPropertyValueByIndex(e){switch(e){case 0:return this._GetAxes();case 1:return this.IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._SetAxes(t);break;case 1:this._SetEnabled(!!t)}}GetDebuggerProperties(){let e="";return 0===this._axes?e="behaviors.dragndrop.properties.axes.items.both":1===this._axes?e="behaviors.dragndrop.properties.axes.items.horizontal-only":2===this._axes&&(e="behaviors.dragndrop.properties.axes.items.vertical-only"),[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.dragndrop.debugger.is-dragging",value:this.IsDragging()},{name:"behaviors.dragndrop.properties.axes.name",value:[e]},{name:"behaviors.dragndrop.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IDragDropBehaviorInstance}};const map$jscomp$33=new WeakMap,VALID_AXES=["both","horizontal","vertical"];self.IDragDropBehaviorInstance=class extends IBehaviorInstance$jscomp$10{constructor(){super(),map$jscomp$33.set(this,IBehaviorInstance$jscomp$10._GetInitInst().GetSdkInstance())}set axes(e){if(-1===(e=VALID_AXES.indexOf(e)))throw Error("invalid axes");map$jscomp$33.get(this)._SetAxes(e)}get axes(){return VALID_AXES[map$jscomp$33.get(this)._GetAxes()]}drop(){map$jscomp$33.get(this)._Drop()}get isDragging(){return map$jscomp$33.get(this).IsDragging()}get isEnabled(){return map$jscomp$33.get(this).IsEnabled()}set isEnabled(e){map$jscomp$33.get(this)._SetEnabled(e)}},self.C3.Behaviors.DragnDrop.Cnds={IsDragging(){return this.IsDragging()},OnDragStart:()=>!0,OnDrop:()=>!0,IsEnabled(){return this.IsEnabled()}},self.C3.Behaviors.DragnDrop.Acts={SetEnabled(e){this._SetEnabled(!!e)},SetAxes(e){this._SetAxes(e)},Drop(){this._Drop()}},self.C3.Behaviors.DragnDrop.Exps={};const C3$jscomp$336=self.C3;self.C3_GetObjectRefTable=function(){return[C3$jscomp$336.Plugins.TiledBg,C3$jscomp$336.Behaviors.Physics,C3$jscomp$336.Plugins.Sprite,C3$jscomp$336.Behaviors.Tween,C3$jscomp$336.Behaviors.Timer,C3$jscomp$336.Plugins.Mouse,C3$jscomp$336.Plugins.Keyboard,C3$jscomp$336.Behaviors.aekiroWater,C3$jscomp$336.Plugins.Text,C3$jscomp$336.Behaviors.scrollto,C3$jscomp$336.Behaviors.Sin,C3$jscomp$336.Plugins.Particles,C3$jscomp$336.Behaviors.Persist,C3$jscomp$336.Behaviors.Bullet,C3$jscomp$336.Behaviors.Fade,C3$jscomp$336.Plugins.PlatformInfo,C3$jscomp$336.Plugins.Browser,C3$jscomp$336.Plugins.Touch,C3$jscomp$336.Behaviors.Anchor,C3$jscomp$336.Plugins.Audio,C3$jscomp$336.Behaviors.destroy,C3$jscomp$336.Behaviors.Rotate,C3$jscomp$336.Plugins.LocalStorage,C3$jscomp$336.Plugins.NinePatch,C3$jscomp$336.Behaviors.DragnDrop,C3$jscomp$336.Plugins.System.Cnds.IsGroupActive,C3$jscomp$336.Plugins.System.Cnds.OnLayoutStart,C3$jscomp$336.Plugins.PlatformInfo.Cnds.IsOnMobile,C3$jscomp$336.Plugins.System.Cnds.EvaluateExpression,C3$jscomp$336.Plugins.Browser.Exps.ExecJS,C3$jscomp$336.Plugins.System.Acts.SetBoolVar,C3$jscomp$336.Plugins.System.Acts.SetLayoutScale,C3$jscomp$336.Behaviors.Physics.Acts.SetWorldGravity,C3$jscomp$336.Plugins.Sprite.Acts.SetInstanceVar,C3$jscomp$336.Plugins.Sprite.Exps.X,C3$jscomp$336.Plugins.Sprite.Exps.Y,C3$jscomp$336.Plugins.Sprite.Exps.Height,C3$jscomp$336.Plugins.Sprite.Exps.Width,C3$jscomp$336.Plugins.Sprite.Acts.MoveToLayer,C3$jscomp$336.Plugins.Sprite.Acts.Spawn,C3$jscomp$336.Plugins.Sprite.Acts.AddChild,C3$jscomp$336.Plugins.System.Cnds.PickByEvaluate,C3$jscomp$336.Plugins.Sprite.Acts.SetPos,C3$jscomp$336.Plugins.Sprite.Acts.MoveToTop,C3$jscomp$336.Plugins.System.Cnds.Else,C3$jscomp$336.Plugins.Sprite.Cnds.IsOnLayer,C3$jscomp$336.Plugins.Sprite.Acts.SetBoolInstanceVar,C3$jscomp$336.Plugins.Sprite.Exps.LayerName,C3$jscomp$336.Plugins.TiledBg.Acts.SetVisible,C3$jscomp$336.Plugins.Sprite.Cnds.IsBoolInstanceVarSet,C3$jscomp$336.Plugins.Sprite.Exps.ImagePointX,C3$jscomp$336.Plugins.Sprite.Exps.ImagePointY,C3$jscomp$336.Plugins.Audio.Acts.RemoveEffects,C3$jscomp$336.Plugins.Audio.Acts.AddFilterEffect,C3$jscomp$336.Plugins.System.Acts.CreateObject,C3$jscomp$336.Plugins.Sprite.Acts.SetVisible,C3$jscomp$336.Plugins.Text.Acts.SetY,C3$jscomp$336.Plugins.Text.Exps.Y,C3$jscomp$336.Plugins.Text.Acts.SetText,C3$jscomp$336.Plugins.System.Exps.zeropad,C3$jscomp$336.Plugins.System.Cnds.Compare,C3$jscomp$336.Plugins.System.Cnds.CompareBoolVar,C3$jscomp$336.ScriptsInEvents.EventSheet1_Event15_Act1,C3$jscomp$336.Plugins.Sprite.Cnds.OnCreated,C3$jscomp$336.Behaviors.Sin.Acts.SetEnabled,C3$jscomp$336.Plugins.System.Exps.layoutname,C3$jscomp$336.Plugins.Sprite.Cnds.IsOverlapping,C3$jscomp$336.Plugins.System.Acts.SetGroupActive,C3$jscomp$336.Plugins.Text.Acts.SetVisible,C3$jscomp$336.Behaviors.Timer.Acts.StartTimer,C3$jscomp$336.Plugins.System.Cnds.PickByComparison,C3$jscomp$336.Plugins.Sprite.Acts.SetAnimFrame,C3$jscomp$336.Plugins.Sprite.Acts.SetY,C3$jscomp$336.Plugins.System.Cnds.Every,C3$jscomp$336.Plugins.System.Exps.random,C3$jscomp$336.Plugins.System.Exps.scrollx,C3$jscomp$336.Plugins.System.Exps.scrolly,C3$jscomp$336.Plugins.Audio.Acts.Play,C3$jscomp$336.Plugins.Audio.Acts.SetPlaybackRate,C3$jscomp$336.Plugins.System.Acts.SetVar,C3$jscomp$336.Plugins.System.Acts.Wait,C3$jscomp$336.Plugins.System.Acts.AddVar,C3$jscomp$336.Plugins.System.Acts.GoToLayout,C3$jscomp$336.Plugins.System.Cnds.TriggerOnce,C3$jscomp$336.Plugins.System.Acts.RestartLayout,C3$jscomp$336.Plugins.Keyboard.Cnds.OnKey,C3$jscomp$336.Plugins.Touch.Cnds.OnTouchStart,C3$jscomp$336.Plugins.Touch.Cnds.IsTouchingObject,C3$jscomp$336.Plugins.Sprite.Cnds.OnCollision,C3$jscomp$336.Plugins.Particles.Exps.Count,C3$jscomp$336.Plugins.TiledBg.Cnds.IsBoolInstanceVarSet,C3$jscomp$336.Behaviors.Physics.Acts.SetVelocity,C3$jscomp$336.Behaviors.Physics.Exps.VelocityY,C3$jscomp$336.Behaviors.Bullet.Acts.SetAngleOfMotion,C3$jscomp$336.Behaviors.scrollto.Acts.Shake,C3$jscomp$336.Plugins.Particles.Acts.SetAngle,C3$jscomp$336.Plugins.Particles.Acts.SetSpraying,C3$jscomp$336.Plugins.Sprite.Acts.SetWidth,C3$jscomp$336.Plugins.Sprite.Acts.SetHeight,C3$jscomp$336.Behaviors.Tween.Acts.TweenTwoProperties,C3$jscomp$336.Plugins.System.Acts.GoToLayoutByName,C3$jscomp$336.Plugins.System.Acts.NextPrevLayout,C3$jscomp$336.Plugins.System.Acts.SubVar,C3$jscomp$336.Plugins.Sprite.Exps.AnimationFrame,C3$jscomp$336.Plugins.System.Exps.viewportbottom,C3$jscomp$336.Behaviors.aekiroWater.Acts.applyForce,C3$jscomp$336.Plugins.Sprite.Acts.SetScale,C3$jscomp$336.Plugins.System.Acts.SetLayerBackground,C3$jscomp$336.Plugins.Sprite.Exps.ColorValue,C3$jscomp$336.Plugins.Sprite.Acts.SetDefaultColor,C3$jscomp$336.Plugins.Sprite.Acts.Destroy,C3$jscomp$336.Plugins.TiledBg.Acts.Destroy,C3$jscomp$336.Plugins.Sprite.Acts.SetSize,C3$jscomp$336.Plugins.TiledBg.Cnds.OnCreated,C3$jscomp$336.Behaviors.Timer.Cnds.OnTimer,C3$jscomp$336.Plugins.Sprite.Cnds.CompareInstanceVar,C3$jscomp$336.Plugins.Keyboard.Cnds.IsKeyDown,C3$jscomp$336.Plugins.Sprite.Acts.SetAnim,C3$jscomp$336.Plugins.Keyboard.Cnds.OnKeyReleased,C3$jscomp$336.Plugins.Sprite.Cnds.IsAnimPlaying,C3$jscomp$336.Behaviors.Timer.Acts.StopTimer,C3$jscomp$336.Plugins.Sprite.Acts.AddInstanceVar,C3$jscomp$336.Plugins.System.Exps.dt,C3$jscomp$336.Behaviors.Physics.Acts.ApplyImpulseAtAngle,C3$jscomp$336.Plugins.Audio.Acts.Stop,C3$jscomp$336.Plugins.System.Exps.choose,C3$jscomp$336.Plugins.Audio.Cnds.IsTagPlaying,C3$jscomp$336.Plugins.Touch.Cnds.IsInTouch,C3$jscomp$336.Plugins.Touch.Cnds.OnTouchEnd,C3$jscomp$336.Plugins.Sprite.Acts.SetAnimSpeed,C3$jscomp$336.Behaviors.Physics.Acts.ApplyForceAtAngle,C3$jscomp$336.Plugins.System.Cnds.EveryTick,C3$jscomp$336.Plugins.TiledBg.Acts.SetImageOffsetY,C3$jscomp$336.Plugins.TiledBg.Exps.ImageOffsetY,C3$jscomp$336.Plugins.TiledBg.Exps.Angle,C3$jscomp$336.Behaviors.Physics.Acts.SetFriction,C3$jscomp$336.Behaviors.Tween.Cnds.IsPlaying,C3$jscomp$336.Plugins.System.Exps.rgbex255,C3$jscomp$336.Plugins.Sprite.Acts.SetAngle,C3$jscomp$336.Behaviors.Bullet.Acts.SetSpeed,C3$jscomp$336.Plugins.System.Cnds.ForEach,C3$jscomp$336.Plugins.TiledBg.Cnds.IsBetweenAngles,C3$jscomp$336.Plugins.TiledBg.Exps.LayerName,C3$jscomp$336.Plugins.TiledBg.Exps.X,C3$jscomp$336.Plugins.TiledBg.Exps.Y,C3$jscomp$336.Plugins.TiledBg.Acts.MoveToTop,C3$jscomp$336.Plugins.TiledBg.Acts.AddChild,C3$jscomp$336.Plugins.TiledBg.Exps.Width,C3$jscomp$336.Plugins.TiledBg.Acts.SetWidth,C3$jscomp$336.Plugins.TiledBg.Acts.SetBoolInstanceVar,C3$jscomp$336.Plugins.Sprite.Acts.ZMoveToObject,C3$jscomp$336.Plugins.TiledBg.Acts.SetHeight,C3$jscomp$336.Plugins.TiledBg.Acts.SetY,C3$jscomp$336.Plugins.TiledBg.Exps.Height,C3$jscomp$336.Behaviors.Physics.Acts.SetElasticity,C3$jscomp$336.Plugins.System.Exps.layoutscale,C3$jscomp$336.Plugins.Sprite.Exps.Count,C3$jscomp$336.Plugins.System.Exps.viewportleft,C3$jscomp$336.Plugins.System.Exps.viewportright,C3$jscomp$336.Plugins.System.Exps.viewporttop,C3$jscomp$336.Plugins.Text.Acts.SetPos,C3$jscomp$336.Plugins.Touch.Cnds.OnTouchObject,C3$jscomp$336.Plugins.Sprite.Acts.ToggleBoolInstanceVar,C3$jscomp$336.Plugins.Sprite.Cnds.CompareFrame,C3$jscomp$336.Plugins.Audio.Acts.SetSilent,C3$jscomp$336.Plugins.Sprite.Acts.SetOpacity,C3$jscomp$336.Behaviors.Tween.Acts.TweenOneProperty,C3$jscomp$336.Plugins.TiledBg.Acts.SetOpacity,C3$jscomp$336.Behaviors.Tween.Cnds.OnTweensFinished,C3$jscomp$336.Plugins.TiledBg.Acts.SetInstanceVar,C3$jscomp$336.Plugins.TiledBg.Acts.SetPos,C3$jscomp$336.Plugins.System.Exps.fps,C3$jscomp$336.Plugins.System.Cnds.OnLayoutEnd,C3$jscomp$336.Plugins.System.Acts.SetTimescale,C3$jscomp$336.Behaviors.Timer.Cnds.IsTimerRunning,C3$jscomp$336.Plugins.LocalStorage.Acts.RemoveItem,C3$jscomp$336.Plugins.System.Cnds.LayerCmpOpacity,C3$jscomp$336.Plugins.System.Acts.SetLayerOpacity,C3$jscomp$336.Plugins.System.Cnds.CompareVar,C3$jscomp$336.Plugins.TiledBg.Acts.SetDefaultColor,C3$jscomp$336.Plugins.System.Exps.loadingprogress,C3$jscomp$336.ScriptsInEvents.Epokimanager_Event4_Act3,C3$jscomp$336.Plugins.TiledBg.Acts.SetImageOffsetX,C3$jscomp$336.Plugins.TiledBg.Exps.ImageOffsetX,C3$jscomp$336.ScriptsInEvents.Epokimanager_Event9_Act4,C3$jscomp$336.ScriptsInEvents.Epokimanager_Event11_Act4,C3$jscomp$336.ScriptsInEvents.Epokimanager_Event13_Act1,C3$jscomp$336.ScriptsInEvents.Epokimanager_Event15_Act1,C3$jscomp$336.Plugins.LocalStorage.Acts.CheckItemExists,C3$jscomp$336.Plugins.LocalStorage.Cnds.OnItemExists,C3$jscomp$336.Plugins.LocalStorage.Acts.GetItem,C3$jscomp$336.Plugins.LocalStorage.Cnds.OnItemGet,C3$jscomp$336.Plugins.LocalStorage.Exps.ItemValue,C3$jscomp$336.Plugins.LocalStorage.Acts.SetItem,C3$jscomp$336.Plugins.Sprite.Cnds.CompareX,C3$jscomp$336.Plugins.Audio.Acts.StopAll,C3$jscomp$336.Plugins.Sprite.Cnds.IsVisible]},self.C3_JsPropNameTable=[{isIce:0},{finish:0},{isLast:0},{Physics:0},{ground:0},{jumpForce:0},{startX:0},{startY:0},{startWidth:0},{startHeight:0},{colide:0},{canJump:0},{cantTouch:0},{hasFinished:0},{playerID:0},{Tween:0},{Timer:0},{Player:0},{Mouse:0},{Keyboard:0},{isUI:0},{slime3:0},{squarePattern:0},{gradiant:0},{Water:0},{waterGraphs:0},{Text:0},{detector:0},{Level:0},{slimeReflection:0},{isUi:0},{slimeFace:0},{ID:0},{ScrollTo:0},{cam:0},{triggerCam:0},{camTarget:0},{Sine:0},{Sine2:0},{confettis:0},{Particles:0},{colorConfettis:0},{Text2:0},{levelReached:0},{colorID:0},{Persist:0},{GameManager:0},{Debug:0},{TextTransition:0},{TextTransition2:0},{TransitionTextLevels:0},{ColorBlob:0},{velocity:0},{forcePush:0},{airPusher:0},{NoConfettis:0},{colLeftCircle:0},{colRightCircle:0},{colCenterCircle:0},{isLeft:0},{isRight:0},{isColliding:0},{isTuto:0},{isFinal:0},{finishPlatform:0},{noConfettis:0},{colFinishRight:0},{bounciness:0},{isSlippy:0},{colCenter:0},{TiledBackground2:0},{colSquare:0},{colFinishLeft:0},{colReflection:0},{flagStick:0},{flagFlag:0},{flagTop:0},{isFinish:0},{Bullet:0},{Fade:0},{Smoke:0},{colorPlatform:0},{colorInside:0},{colorInsideCenter:0},{ColorRefletBlob:0},{colorReflectPlatform:0},{colorBG:0},{colorBGgradiant:0},{colorGrid:0},{colorPalmtree:0},{colorFinishSides:0},{colorFlag:0},{palmTreeLeaf:0},{palmTreeTrunk:0},{DebugHome:0},{PlatformInfo:0},{Browser:0},{Touch:0},{TXT_LoadingPercentage_txt:0},{Anchor:0},{UI_simplePanel_tilBG:0},{UI_loadBar_tilBG:0},{Logo3:0},{Audio:0},{propeller:0},{propellerBase:0},{UIMouseIcon:0},{is2P:0},{Hand:0},{touchFeedback:0},{mouseArrow:0},{UIBG:0},{Sprite:0},{colCenter2:0},{ParentObject:0},{logo:0},{plainColorBottom:0},{slime4:0},{flash:0},{DestroyOutsideLayout:0},{YES:0},{Levels:0},{debugFPS:0},{movingPlatform:0},{snowflake:0},{iceAgain:0},{bumpers:0},{startW:0},{startH:0},{forceBump:0},{bumperBG:0},{colorBumperBG:0},{colorBumper:0},{BGTuto:0},{arrow:0},{Sprite2:0},{colorSmoke:0},{Particles2:0},{firerworks:0},{Rotate:0},{firerworks2:0},{finishTrigger:0},{LocalStorage:0},{isActivated:0},{soundButton:0},{TextColorRefs:0},{colReflection2:0},{colCenterIce:0},{colRightCircleIce:0},{colLeftCircleIce:0},{Ball:0},{reflectBall:0},{DebugLevels:0},{UIrestart:0},{buttonOK:0},{FxRotate:0},{rotator:0},{fadeDark:0},{RareItem:0},{frameUI:0},{cross:0},{textNothanks:0},{textItem:0},{TextItem2:0},{DragDrop:0},{ParentPopUp:0},{Particles3:0},{propellerBase2:0},{crown:0},{fadeDark2:0},{CONGRATULATIONS:0},{finalCrown:0},{crown2:0},{CrownCounter:0},{"2P":0},{"1PButton":0},{"2PButton":0},{welcome:0},{BGHome:0},{sinParent:0},{IconKeyboard:0},{keyIcon:0},{zoomFactor:0},{camTarget2:0},{P1Arrow:0},{P2Arrow:0},{isShadow:0},{isP1:0},{isP2:0},{score:0},{trophee:0},{timer2Pscreen:0},{winLight:0},{winLight2:0},{readyUI:0},{Go:0},{HouseButton:0},{"2PButton1":0},{"2PButton2":0},{FColorBlob:0},{FColors:0},{FPlayer:0},{Tuto2P:0},{hasPropeller:0},{levelReached_:0},{colorID_:0},{is5th:0},{canPlaySounds:0},{firstInput:0},{soundFinishRate:0},{isOnMobile:0},{showPopup:0},{isHidingPopup:0},{PropellerCounter:0},{death:0},{haveStarted:0},{soundButtonON:0},{is2PMode:0},{player1HasFinished:0},{player2HasFinished:0},{"2PCamXAverage":0},{"2PCamYAverage":0},{score1P:0},{score2P:0},{finishPlatformCanscore:0},{P1WillScore:0},{P2WillScore:0},{"2PhasPlayed":0},{PokiLogingWasTracked:0},{PokiHasInitialised:0},{PokiIsPlayingRewardedAd:0},{PokiIsPlayingMidrollAd:0},{GmIsPaused:0},{PokiIsPaused:0},{PokiHasSounds:0},{PokiGiveReward:0}];const C3$jscomp$337=self.C3;function and(e,t){return"string"==typeof e||"string"==typeof t?("number"==typeof e?(Math.round(1e10*e)/1e10).toString():e)+("number"==typeof t?(Math.round(1e10*t)/1e10).toString():t):e&&t?1:0}self.C3_ExpressionFuncs=[()=>"INIT",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>1<t("navigator.maxTouchPoints")?1:0},()=>1.5,()=>40,e=>{const t=e._GetNode(0);return()=>t.ExpObject()},()=>"UI",()=>"Collision",()=>1,e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()},e=>{const t=e._GetNode(0);return()=>2===t.ExpInstVar()?1:0},()=>0,e=>{const t=e._GetNode(0);return()=>t.ExpObject()-10},()=>"FXs",e=>{const t=e._GetNode(0);return()=>1===t.ExpInstVar()?1:0},e=>{const t=e._GetNode(0);return()=>0===t.ExpInstVar()?1:0},()=>"PopUpRwd",()=>"BGTuto",()=>"Fxs",e=>{const t=e._GetNode(0);return()=>t.ExpObject(3)},()=>2,()=>"bounce",()=>350,()=>50,()=>"charge",()=>652,()=>-1554,()=>"",e=>{const t=e._GetNode(0);return()=>t.ExpObject()-30},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar();return()=>"WORLD "+t(s.GetValue()+1,2)+" CLEARED!"},e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()},e=>{const t=e._GetNode(0).GetVar();return()=>0<t.GetValue()?1:0},e=>{const t=e._GetNode(0).GetVar();return()=>0==t.GetValue()%5?1:0},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>"Home2"===t()?1:0},()=>"ControlsPlayer1",()=>"ControlsPlayer2",()=>"Controls",()=>"Camera",()=>"Camera2P",()=>"Flow2P",()=>"Slimes Interactions",()=>"Flow",()=>.1,()=>"ready",()=>"go",()=>"ControlsPlayer3",()=>"ControlsPlayer4",()=>4,e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t()},()=>"Level2P 152",e=>{const t=e._GetNode(0);return()=>t.ExpObject()-100},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>"Level 151"===t()?1:0},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>"2PWinner"===t()?1:0},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(.1,3)},()=>"Crown",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod();return()=>t()+s(600,-600)},()=>"firework",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(.5,1.5)},()=>10,e=>{const t=e._GetNode(0);return()=>1e3<t.ExpObject()?1:0},()=>.8,e=>{const t=e._GetNode(0);return()=>0===t.ExpObject()?1:0},e=>{const t=e._GetNode(0);return()=>t.ExpBehavior()},e=>{const t=e._GetNode(0);return()=>t.ExpObject()-150},()=>270,()=>20,()=>.4,()=>"yes",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(.6,3)},()=>.5,()=>245,()=>290,e=>{const t=e._GetNode(0).GetVar();return()=>Math.floor((t.GetValue()-1)/5)},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpInstVar()+.1*s.ExpInstVar()},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpInstVar()-.2*s.ExpInstVar()},()=>"finish",()=>.15,e=>{const t=e._GetNode(0).GetVar();return()=>and("Level ",t.GetValue())},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject()===s.GetValue()+1?1:0},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(0)},()=>-5,()=>"up",()=>60,()=>"BG",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(.2,.5)},()=>-10,()=>3,e=>{const t=e._GetNode(0);return()=>t.ExpObject(1)},()=>2e3,()=>.45,()=>25,()=>"bal",e=>{const t=e._GetNode(0);return()=>1.5*t.ExpObject()},()=>.25,()=>"keyboard",()=>6,()=>"Animation 2",()=>"Animation 1",()=>.2,()=>"collide1",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>30*t()},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject()+17*s()},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject()-17*s()},()=>-2,()=>2.7,()=>.02,()=>37.7,()=>60.4,()=>"charge2",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(2,1.5)},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpInstVar()-.3*s.ExpInstVar()},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpInstVar()+.3*s.ExpInstVar()},()=>"jump",()=>.75,e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpInstVar()+.2*s.ExpInstVar()},()=>"ground1",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(-10,-5)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(.8,1.4)},()=>"AnimationSystem",()=>"collide",()=>"ground",()=>"AnimationSystem2",()=>"AnimationSystem3",()=>"collide2",()=>250,()=>"AnimationSystem4",()=>"AnimationSystem5",()=>"GPEs",()=>"Propeller",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>"Level 150"===t()?1:0},()=>55,()=>"propeler",()=>2.2,()=>"Ball",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(-15,-10)},()=>"ball",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(.4,1)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(.8,1.7)},()=>"AirPusher",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()-s.ExpInstVar()},e=>{const t=e._GetNode(0);return()=>t.ExpObject()-90},()=>100,()=>"water",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(.8,1.2)},()=>30,e=>{const t=e._GetNode(0),s=e._GetNode(1),i=e._GetNode(2);return()=>t.ExpObject()<s.ExpObject()-i.ExpObject()/2?1:0},()=>.3,()=>"bump",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpInstVar()+.4*s.ExpInstVar()},()=>.35,()=>"boing",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(.7,1.2)},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2).GetBoundMethod(),r=e._GetNode(3).GetBoundMethod(),n=e._GetNode(4).GetBoundMethod();return()=>t(s(125,100,255),i(125,255,105),r(252,255,71),n(255,112,155))},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(360)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(10,20)},()=>.05,e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()-.05*s.ExpObject()},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(.2,1)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(15,30)},()=>"Gradiant",()=>"fireworks",()=>"LevelGeneration",()=>-1,e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()+s.ExpObject()},e=>{const t=e._GetNode(0);return()=>t.ExpObject()+3},e=>{const t=e._GetNode(0);return()=>t.ExpObject()-12},e=>{const t=e._GetNode(0);return()=>t.ExpObject()+20},e=>{const t=e._GetNode(0);return()=>.85*t.ExpObject()},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()-s.ExpObject()/2},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>C3$jscomp$337.lerp(t.ExpObject(),s.ExpObject(),.07)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>C3$jscomp$337.lerp(t(),1,.07)},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod();return()=>(t(0)+s(0))/2},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>C3$jscomp$337.lerp(t(),s.ExpInstVar(),.07)},e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1);return()=>t.GetValue()/s.ExpObject()},()=>"Audio",()=>"Tuto",()=>"reset",e=>{const t=e._GetNode(0);return()=>t.ExpObject()-20},e=>{const t=e._GetNode(0);return()=>1.3*t.ExpInstVar()},e=>{const t=e._GetNode(0);return()=>.7*t.ExpInstVar()},()=>1.2,e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()+210},e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()-150},()=>70,()=>"flash",e=>{const t=e._GetNode(0);return()=>t.ExpObject()-800},()=>"intro",()=>"woosh",()=>"TrackAds",()=>.001,()=>"Debug",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t()+"/150"},e=>{const t=e._GetNode(0).GetVar();return()=>and("X ",t.GetValue())},()=>"SaveBlumgiSlime",()=>"SaveBlumgiSlimeCrown",e=>{const t=e._GetNode(0).GetVar();return()=>0===t.GetValue()?1:0},()=>"RwdsAds",e=>{const t=e._GetNode(0);return()=>"PopUpRwd"===t.ExpObject()?1:0},e=>{const t=e._GetNode(0);return()=>t.ExpObject()-1500},()=>"PopUp",()=>"fade",()=>90,()=>"PopUpBack",e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()-1500},()=>"fadeBack",()=>5,e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpInstVar()===s.ExpInstVar()?1:0},e=>{const t=e._GetNode(0),s=e._GetNode(1),i=e._GetNode(2),r=e._GetNode(3);return()=>C3$jscomp$337.distanceTo(t.ExpObject(),s.ExpObject(),i.ExpObject(),r.ExpObject())},()=>7,e=>{const t=e._GetNode(0),s=e._GetNode(1),i=e._GetNode(2),r=e._GetNode(3);return()=>C3$jscomp$337.toDegrees(C3$jscomp$337.angleTo(t.ExpObject(),s.ExpObject(),i.ExpObject(),r.ExpObject()))+180},()=>"FINISH SCREEN",()=>"P2 WINS!",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(225,255,77)},()=>"P1 WINS!",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(255,71,71)},()=>"Keys2P",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("UI")+100},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("UI")-100},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject()===s.GetValue()?1:0},()=>"InitSDK",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>and(Math.round(100*t()),"%")},e=>{const t=e._GetNode(0);return()=>t.ExpObject()+1},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t()-s.ExpObject()/2},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t()+30},()=>"FUNCTIONS POKI",()=>"Trigger Midroll",()=>"Trigger Rwd",()=>"Trigger GameStart()",()=>"Trigger GameStop()",()=>"Layer 2",()=>-717706215031807,()=>"WORLD O2",()=>"LevelsAndColors",()=>"CROWN",e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()-500},e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()+500},e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()+1e3},e=>{const t=e._GetNode(0);return()=>1.02*t.ExpInstVar()},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>Math.floor(t(0,27))},()=>"music",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>C3$jscomp$337.lerp(t(),1,.2)},()=>"SoundButton",()=>.9,e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpInstVar()===s.GetValue()?1:0},e=>{const t=e._GetNode(0);return()=>t.ExpObject()-5},e=>{const t=e._GetNode(0);return()=>t.ExpObject()+10},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpInstVar()<=s.GetValue()?1:0},()=>"2PScreen",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>and("Level2P ",Math.floor(t(152,188)))}];var module$str$c3runtime={};function addScript$$module$str$scripts$project$main(e,t,s){if(!document.getElementById(t)){var i=document.getElementsByTagName("script")[0],r=document.createElement("script");r.id=t,i.parentNode.insertBefore(r,i),r.onload=s,r.src=e}}addScript$$module$str$scripts$project$main("patch/js/poki-sdk-v2.js","poki-sdk",(()=>{PokiSDK.init().then((()=>{globalThis.PokiHasInitialised=!0})).catch((()=>{globalThis.PokiHasInitialised=!0})),PokiSDK.setDebug(!1)})),window.addEventListener("keydown",(e=>{["ArrowDown","ArrowUp"," "].includes(e.key)&&e.preventDefault()})),window.addEventListener("wheel",(e=>e.preventDefault()),{passive:!1});var module$str$scripts$project$main={};const scriptsInEvents$$module$str$scripts$project$scriptsInEvents={async EventSheet1_Event15_Act1(e,t){PokiSDK.customEvent("game","segment",{segment:e.layout.name})},async Epokimanager_Event4_Act3(e,t){e.globalVars.PokiHasInitialised=globalThis.PokiHasInitialised},async Epokimanager_Event9_Act4(e,t){PokiSDK.commercialBreak().then((()=>{e.globalVars.PokiIsPaused=!1,e.globalVars.PokiHasSounds=!0,e.globalVars.PokiIsPlayingMidrollAd=!1,PokiSDK.gameplayStart()}))},async Epokimanager_Event11_Act4(e,t){PokiSDK.gameplayStop(),PokiSDK.rewardedBreak().then((t=>{t?(e.globalVars.PokiIsPaused=!1,e.globalVars.PokiHasSounds=!0,e.globalVars.PokiIsPlayingRewardedAd=!1,PokiSDK.gameplayStart(),e.globalVars.PokiGiveReward=!0):(e.globalVars.PokiIsPaused=!1,e.globalVars.PokiHasSounds=!0,e.globalVars.PokiIsPlayingRewardedAd=!1,PokiSDK.gameplayStart())}))},async Epokimanager_Event13_Act1(e,t){PokiSDK.gameplayStart()},async Epokimanager_Event15_Act1(e,t){PokiSDK.gameplayStop()}};self.C3.ScriptsInEvents=scriptsInEvents$$module$str$scripts$project$scriptsInEvents;var module$str$scripts$project$scriptsInEvents={},module$str$__c3root__={};