import*as constant from"./constant";export const checkMoveDown=t=>t.checkTimeMovement(constant.moveDownMovement);export const getMoveDownValue=(t,e)=>{const a=e?e.pixelsPerFrame:t.pixelsPerFrame.bind(t),o=t.getVariable(constant.successCount),n=2*t.getVariable(constant.blockHeight);return a(o<=4?1.25*n:n)};export const getAngleBase=t=>{const e=t.getVariable(constant.successCount),a=t.getVariable(constant.gameScore),{hookAngle:o}=t.getVariable(constant.gameUserOption);if(o)return o(e,a);if(t.getVariable(constant.hardMode))return 90;switch(!0){case e<10:return 30;case e<20:return 60;default:return 80}};export const getSwingBlockVelocity=(t,e)=>{const a=t.getVariable(constant.successCount),o=t.getVariable(constant.gameScore),{hookSpeed:n}=t.getVariable(constant.gameUserOption);if(n)return n(a,o);let s;switch(!0){case a<1:s=0;break;case a<10:s=1;break;case a<20:s=.8;break;case a<30:s=.7;break;default:s=.74;break}return t.getVariable(constant.hardMode)&&(s=1.1),Math.sin(e/(200/s))};export const getLandBlockVelocity=(t,e)=>{const a=t.getVariable(constant.successCount),o=t.getVariable(constant.gameScore),{landBlockSpeed:n}=t.getVariable(constant.gameUserOption);if(n)return n(a,o);const{width:s}=t;let r;switch(!0){case a<5:r=0;break;case a<13:r=.001;break;case a<23:r=.002;break;default:r=.003;break}return Math.cos(e/200)*r*s};export const getHookStatus=t=>t.checkTimeMovement(constant.hookDownMovement)?constant.hookDown:t.checkTimeMovement(constant.hookUpMovement)?constant.hookUp:constant.hookNormal;export const touchEventHandler=t=>{if(!t.getVariable(constant.gameStartNow))return;if(t.debug&&t.paused)return;if(getHookStatus(t)!==constant.hookNormal)return;t.removeInstance("tutorial"),t.removeInstance("tutorial-arrow");const e=t.getInstance(`block_${t.getVariable(constant.blockCount)}`);e&&e.status===constant.swing&&(t.setTimeMovement(constant.hookUpMovement,500),e.status=constant.beforeDrop)};export const addSuccessCount=t=>{const{setGameSuccess:e}=t.getVariable(constant.gameUserOption),a=t.getVariable(constant.successCount)+1;t.setVariable(constant.successCount,a),t.getVariable(constant.hardMode)&&t.setVariable(constant.ropeHeight,t.height*t.utils.random(.35,.55)),e&&e(a)};export const addFailedCount=t=>{const{setGameFailed:e}=t.getVariable(constant.gameUserOption),a=t.getVariable(constant.failedCount)+1;t.setVariable(constant.failedCount,a),t.setVariable(constant.perfectCount,0),e&&e(a),a>=3&&(t.pauseAudio("bgm"),t.playAudio("game-over"),t.setVariable(constant.gameStartNow,!1))};export const addScore=(t,e)=>{const{setGameScore:a,successScore:o,perfectScore:n}=t.getVariable(constant.gameUserOption),s=t.getVariable(constant.perfectCount,0),r=e?s+1:0,c=t.getVariable(constant.gameScore)+(o||25)+(n||25)*r;t.setVariable(constant.gameScore,c),t.setVariable(constant.perfectCount,r),a&&a(c)};export const drawYellowString=(t,e)=>{const{string:a,size:o,x:n,y:s,textAlign:r,fontName:c="wenxue",fontWeight:i="normal"}=e,{ctx:l}=t,g=o,u=.1*g;l.save(),l.beginPath();const b=l.createLinearGradient(0,0,0,s);b.addColorStop(0,"#FAD961"),b.addColorStop(1,"#F76B1C"),l.fillStyle=b,l.lineWidth=u,l.strokeStyle="#FFF",l.textAlign=r||"center",l.font=`${i} ${g}px ${c}`,l.strokeText(a,n,s),l.fillText(a,n,s),l.restore()};