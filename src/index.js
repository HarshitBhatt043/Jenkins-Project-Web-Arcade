import{Engine,Instance}from"cooljs";import{touchEventHandler}from"./utils";import{background}from"./background";import{lineAction,linePainter}from"./line";import{cloudAction,cloudPainter}from"./cloud";import{hookAction,hookPainter}from"./hook";import{tutorialAction,tutorialPainter}from"./tutorial";import*as constant from"./constant";import{startAnimate,endAnimate}from"./animateFuncs";window.TowerGame=(t={})=>{const{width:n,height:a,canvasId:o,soundOn:e}=t,i=new Engine({canvasId:o,highResolution:!0,width:n,height:a,soundOn:e}),r=t=>`./assets/${t}`;i.addImg("background",r("background.png")),i.addImg("hook",r("hook.png")),i.addImg("blockRope",r("block-rope.png")),i.addImg("block",r("block.png")),i.addImg("block-perfect",r("block-perfect.png"));for(let t=1;t<=8;t+=1)i.addImg(`c${t}`,r(`c${t}.png`));i.addLayer(constant.flightLayer);for(let t=1;t<=7;t+=1)i.addImg(`f${t}`,r(`f${t}.png`));i.swapLayer(0,1),i.addImg("tutorial",r("tutorial.png")),i.addImg("tutorial-arrow",r("tutorial-arrow.png")),i.addImg("heart",r("heart.png")),i.addImg("score",r("score.png")),i.addAudio("drop-perfect",r("drop-perfect.mp3")),i.addAudio("drop",r("drop.mp3")),i.addAudio("game-over",r("game-over.mp3")),i.addAudio("rotate",r("rotate.mp3")),i.addAudio("bgm",r("bgm.mp3")),i.setVariable(constant.blockWidth,.25*i.width),i.setVariable(constant.blockHeight,.71*i.getVariable(constant.blockWidth)),i.setVariable(constant.cloudSize,.3*i.width),i.setVariable(constant.ropeHeight,.4*i.height),i.setVariable(constant.blockCount,0),i.setVariable(constant.successCount,0),i.setVariable(constant.failedCount,0),i.setVariable(constant.gameScore,0),i.setVariable(constant.hardMode,!1),i.setVariable(constant.gameUserOption,t);for(let t=1;t<=4;t+=1){const n=new Instance({name:`cloud_${t}`,action:cloudAction,painter:cloudPainter});n.index=t,n.count=5-t,i.addInstance(n)}const d=new Instance({name:"line",action:lineAction,painter:linePainter});i.addInstance(d);const c=new Instance({name:"hook",action:hookAction,painter:hookPainter});return i.addInstance(c),i.startAnimate=startAnimate,i.endAnimate=endAnimate,i.paintUnderInstance=background,i.addKeyDownListener("enter",(()=>{i.debug&&i.togglePaused()})),i.touchStartListener=()=>{touchEventHandler(i)},i.playBgm=()=>{i.playAudio("bgm",!0)},i.pauseBgm=()=>{i.pauseAudio("bgm")},i.start=()=>{const t=new Instance({name:"tutorial",action:tutorialAction,painter:tutorialPainter});i.addInstance(t);const n=new Instance({name:"tutorial-arrow",action:tutorialAction,painter:tutorialPainter});i.addInstance(n),i.setTimeMovement(constant.bgInitMovement,500),i.setTimeMovement(constant.tutorialMovement,500),i.setVariable(constant.gameStartNow,!0)},i};