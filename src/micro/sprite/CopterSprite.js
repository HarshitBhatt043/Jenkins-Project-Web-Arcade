import{BaseSprite}from"./BaseSprite.js";import{Micro}from"../Micro.js";import{Tile}from"../Tile.js";import{Messages}from"../Messages.js";import{SpriteUtils}from"./SpriteUtils.js";import{math}from"../math/math.js";export class CopterSprite extends BaseSprite{constructor(t,s,i,e){super(),this.init(Micro.SPRITE_HELICOPTER,t,s,i,e),this.width=32,this.height=32,this.xOffset=-16,this.yOffset=-16,this.frame=5,this.count=1500,this.destX=math.getRandom(SpriteUtils.worldToPix(t.width))+8,this.destY=math.getRandom(SpriteUtils.worldToPix(t.height))+8,this.origX=i,this.origY=e,this.xDelta=[0,0,3,5,3,0,-3,-5,-3],this.yDelta=[0,-5,-3,0,3,5,3,0,-3]}move(t,s,i,e){if(this.soundCount>0&&this.soundCount--,this.count>0&&this.count--,0===this.count){let t=this.spriteManager.getSprite(Micro.SPRITE_MONSTER);if(null!==t?(this.destX=t.x,this.destY=t.y):(t=this.spriteManager.getSprite(Micro.SPRITE_TORNADO),null!==t?(this.destX=t.x,this.destY=t.y):(this.destX=this.origX,this.destY=this.origY)),SpriteUtils.absoluteDistance(this.x,this.y,this.origX,this.origY)<30)return void(this.frame=0)}if(0===this.soundCount){let t=SpriteUtils.pixToWorld(this.x),i=SpriteUtils.pixToWorld(this.y);t>=0&&t<this.map.width&&i>=0&&i<this.map.height&&e.trafficDensityMap.worldGet(t,i)>170&&0==(7&math.getRandom16())&&(s.sendMessage(Messages.HEAVY_TRAFFIC,{x:t,y:i}),s.sendMessage(Messages.SOUND_HEAVY_TRAFFIC),this.soundCount=200)}let h=this.frame;if(0==(3&t)){let t=SpriteUtils.getDir(this.x,this.y,this.destX,this.destY);h=SpriteUtils.turnTo(h,t),this.frame=h}this.x+=this.xDelta[h],this.y+=this.yDelta[h]}explodeSprite(t){this.frame=0,this.spriteManager.makeExplosionAt(this.x,this.y),t.sendMessage(Messages.HELICOPTER_CRASHED)}}