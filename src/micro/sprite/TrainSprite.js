import{BaseSprite}from"./BaseSprite.js";import{Micro}from"../Micro.js";import{Tile}from"../Tile.js";import{Messages}from"../Messages.js";import{SpriteUtils}from"./SpriteUtils.js";import{math}from"../math/math.js";export class TrainSprite extends BaseSprite{constructor(i,t,s,e){super(),this.init(Micro.SPRITE_TRAIN,i,t,s,e),this.width=32,this.height=32,this.xOffset=-16,this.yOffset=-16,this.frame=1,this.dir=4,this.tileDeltaX=[0,16,0,-16],this.tileDeltaY=[-16,0,16,0],this.xDelta=[0,4,0,-4,0],this.yDelta=[-4,0,4,0,0],this.TrainPic2=[1,2,1,2,5],this.NORTHSOUTH=1,this.EASTWEST=2,this.NWSE=3,this.NESW=4,this.UNDERWATER=5,this.NORTH=0,this.EAST=1,this.SOUTH=2,this.WEST=3,this.CANTMOVE=4}move(i,t,s,e){if(this.frame!==this.NWSE&&this.frame!==this.NESW||(this.frame=this.TrainPic2[this.dir]),this.x+=this.xDelta[this.dir],this.y+=this.yDelta[this.dir],0==(3&i)){let i=3&math.getRandom16();for(let t=i;t<i+4;t++){let i=3&t;if(this.dir!==this.CANTMOVE&&i===(this.dir+2&3))continue;let s=SpriteUtils.getTileValue(this.map,this.x+this.tileDeltaX[i],this.y+this.tileDeltaY[i]);if(s>=Tile.RAILBASE&&s<=Tile.LASTRAIL||s===Tile.RAILVPOWERH||s===Tile.RAILHPOWERV)return this.dir!==i&&this.dir!==this.CANTMOVE?this.dir+i===this.WEST?this.frame=this.NWSE:this.frame=this.NESW:this.frame=this.TrainPic2[i],s!==Tile.HRAIL&&s!==Tile.VRAIL||(this.frame=this.UNDERWATER),void(this.dir=i)}if(this.dir===this.CANTMOVE)return void(this.frame=0);this.dir=this.CANTMOVE}}explodeSprite(i){this.frame=0,this.spriteManager.makeExplosionAt(this.x,this.y),i.sendMessage(Messages.TRAIN_CRASHED)}}