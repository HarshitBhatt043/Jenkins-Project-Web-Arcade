import{BaseSprite}from"./BaseSprite.js";import{Micro}from"../Micro.js";import{Tile}from"../Tile.js";import{Messages}from"../Messages.js";import{SpriteUtils}from"./SpriteUtils.js";import{math}from"../math/math.js";export class MonsterSprite extends BaseSprite{constructor(t,i,s,e){super(),this.init(Micro.SPRITE_MONSTER,t,i,s,e),this.width=48,this.height=48,this.xOffset=-24,this.yOffset=-24,s>SpriteUtils.worldToPix(t.width)/2?e>SpriteUtils.worldToPix(t.height)/2?this.frame=10:this.frame=7:e>SpriteUtils.worldToPix(t.height)/2?this.frame=1:this.frame=4,this.flag=0,this.count=1e3,this.destX=SpriteUtils.worldToPix(t.pollutionMaxX),this.destY=SpriteUtils.worldToPix(t.pollutionMaxY),this.origX=this.x,this.origY=this.y,this._seenLand=!1,this.xDelta=[2,2,-2,-2,0],this.yDelta=[-2,2,2,-2,0],this.cardinals1=[0,1,2,3],this.cardinals2=[1,2,3,0],this.diagonals1=[2,5,8,11],this.diagonals2=[11,2,5,8]}move(t,i,s,e){this.soundCount>0&&this.soundCount--;let h,r,o=Math.floor((this.frame-1)/3);if(o<4){if(h=(this.frame-1)%3,2===h&&(this.step=0),0===h&&(this.step=1),this.step?h++:h--,SpriteUtils.absoluteDistance(this.x,this.y,this.destX,this.destY)<60){if(0!==this.flag)return void(this.frame=0);this.flag=1,this.destX=this.origX,this.destY=this.origY}r=SpriteUtils.getDir(this.x,this.y,this.destX,this.destY),r=Math.floor((r-1)/2),r!==o&&math.getChance(10)&&(h=1&math.getRandom16()?this.cardinals1[o]:this.cardinals2[o],o=4,this.soundCount||(i.sendMessage(Messages.SOUND_MONSTER),this.soundCount=50+math.getRandom(100)))}else o=4,r=this.frame,h=r-13&3,3&math.getRandom16()||(h=1&math.getRandom16()?this.diagonals1[h]:this.diagonals2[h],o=Math.floor((h-1)/3),h=(h-1)%3);h=3*o+h+1,h>16&&(h=16),this.frame=h,this.x+=this.xDelta[o],this.y+=this.yDelta[o],this.count>0&&this.count--;let a=SpriteUtils.getTileValue(this.map,this.x,this.y);(-1===a||a===Tile.RIVER&&this.count<500)&&(this.frame=0),(a===Tile.DIRT||a>Tile.WATER_HIGH)&&(this._seenLand=!0);let l=this.spriteManager.getSpriteList();for(let t=0;t<l.length;t++){let s=l[t];0===s.frame||s.type!==Micro.SPRITE_AIRPLANE&&s.type!==Micro.SPRITE_HELICOPTER&&s.type!==Micro.SPRITE_SHIP&&s.type!==Micro.SPRITE_TRAIN||!SpriteUtils.checkSpriteCollision(this,s)||s.explodeSprite(i)}SpriteUtils.destroyMapTile(this.spriteManager,this.map,e,this.x,this.y)}}