import{BaseToolConnector}from"./BaseToolConnector.js";import{Tile,ZoneUtils}from"../Tile.js";export class BuildingTool extends BaseToolConnector{constructor(i,t,e,s,l){super(),this.init(i,e,!1),this.centreTile=t,this.size=s,this.animated=l}putBuilding(i,t){let e,s,l,o,r=this.centreTile-this.size-1;for(let h=0;h<this.size;h++){s=t+h;for(let t=0;t<this.size;t++)e=i+t,l=r,o=Tile.BNCNBIT,1===t&&(1===h?o|=Tile.ZONEBIT:2===h&&this.animated&&(o|=Tile.ANIMBIT)),this._worldEffects.setTile(e,s,l,o),r++}}prepareBuildingSite(i,t){if(i<0||i+this.size>this._map.width)return this.TOOLRESULT_FAILED;if(t<0||t+this.size>this._map.height)return this.TOOLRESULT_FAILED;let e,s,l;for(let o=0;o<this.size;o++){s=t+o;for(let t=0;t<this.size;t++)if(e=i+t,l=this._worldEffects.getTileValue(e,s),l!==Tile.DIRT){if(!this.autoBulldoze)return this.TOOLRESULT_NEEDS_BULLDOZE;if(!ZoneUtils.canBulldoze(l))return this.TOOLRESULT_NEEDS_BULLDOZE;this._worldEffects.setTile(e,s,Tile.DIRT),this.addCost(this.bulldozerCost)}}return this.TOOLRESULT_OK}buildBuilding(i,t){i--,t--;let e=this.prepareBuildingSite(i,t);return e!==this.TOOLRESULT_OK?e:(this.addCost(this.toolCost),this.putBuilding(i,t),this.checkBorder(i,t),this.TOOLRESULT_OK)}doTool(i,t,e){this.result=this.buildBuilding(i,t)}}