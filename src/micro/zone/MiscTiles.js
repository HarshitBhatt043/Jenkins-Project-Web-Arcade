import{Micro}from"../Micro.js";import{Tiles,Tile,ZoneUtils}from"../Tile.js";import{math}from"../math/math.js";const xDelta=[-1,0,1,0],yDelta=[0,-1,0,1];export const MiscTiles={registerHandlers:function(i,o){i.addAction(ZoneUtils.isFire,MiscTiles.fireFound,!0),i.addAction(Tile.RADTILE,MiscTiles.radiationFound,!0),i.addAction(ZoneUtils.isFlood,MiscTiles.floodFound,!0)},fireFound:function(i,o,e,t){if(t||(t=Micro.simData),t.census.firePop+=1,0!=(3&math.getRandom16()))return;let n,s,a,l;for(n=0;n<4;n++)if(math.getChance(7)&&(s=o+xDelta[n],a=e+yDelta[n],i.testBounds(s,a))){if(l=i.getTile(o,e),!l.isCombustible())continue;l.isZone()&&(ZoneUtils.fireZone(i,o,e,t.blockMaps),l.getValue()>Tile.IZB&&t.spriteManager.makeExplosionAt(o,e)),i.setTo(ZoneUtils.randomFire())}let r=10;n=t.blockMaps.fireStationEffectMap.worldGet(o,e),n>100?r=1:n>20?r=2:n>0&&(r=3),0===math.getRandom(r)&&i.setTo(o,e,ZoneUtils.randomRubble())},radiationFound:function(i,o,e,t){t||(t=Micro.simData),math.getChance(4095)&&i.setTile(o,e,Tile.DIRT,0)},floodFound:function(i,o,e,t){t||(t=Micro.simData),t.disasterManager.doFlood(o,e,t.blockMaps)}};