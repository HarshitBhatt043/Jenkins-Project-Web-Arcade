import{Micro}from"../Micro.js";import{Tiles,Tile,ZoneUtils}from"../Tile.js";import{math}from"../math/math.js";export const Commercial={registerHandlers:function(o,e){o.addAction(ZoneUtils.isCommercialZone,Commercial.commercialFound)},getZonePopulation:function(o,e,i,a){return a===Tile.COMCLR?0:Math.floor((a-Tile.CZB)/9)%5+1},placeCommercial:function(o,e,i,a,l,t){var n=9*(5*l+a)+Tile.CZB;ZoneUtils.putZone(o,e,i,n,t)},growZone:function(o,e,i,a,l,t,n){var r=a.landValueMap.worldGet(e,i);l>(r>>=5)||l<5&&(Commercial.placeCommercial(o,e,i,l,t,n),ZoneUtils.incRateOfGrowth(a,e,i,8))},degradeZone:function(o,e,i,a,l,t,n){l>1?Commercial.placeCommercial(o,e,i,l-2,t,n):ZoneUtils.putZone(o,e,i,Tile.COMCLR,n),ZoneUtils.incRateOfGrowth(a,e,i,-8)},commercialFound:function(o,e,i,a){var l;a||(a=Micro.simData),a.census.comZonePop+=1;var t=o.getTileValue(e,i),n=Commercial.getZonePopulation(o,e,i,t);a.census.comPop+=n;var r=o.getTile(e,i).isPowered(),c=Micro.ROUTE_FOUND;if(n>math.getRandom(5)&&(c=a.traffic.makeTraffic(e,i,a.blockMaps,ZoneUtils.isIndustrial))===Micro.NO_ROAD_FOUND)return l=ZoneUtils.getLandPollutionValue(a.blockMaps,e,i),void Commercial.degradeZone(o,e,i,a.blockMaps,n,l,r);if(math.getChance(7)){var m=c===Micro.NO_ROAD_FOUND?-3e3:a.blockMaps.cityCentreDistScoreMap.worldGet(e,i),s=a.valves.comValve+m;if(r||(s=-500),r&&s>-350&&s-26380>math.getRandom16Signed())return l=ZoneUtils.getLandPollutionValue(a.blockMaps,e,i),void Commercial.growZone(o,e,i,a.blockMaps,n,l,r);s<350&&s+26380<math.getRandom16Signed()&&(l=ZoneUtils.getLandPollutionValue(a.blockMaps,e,i),Commercial.degradeZone(o,e,i,a.blockMaps,n,l,r))}}};