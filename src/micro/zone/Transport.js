import{Micro}from"../Micro.js";import{Tiles,Tile,ZoneUtils}from"../Tile.js";import{math}from"../math/math.js";export const Transport={registerHandlers:function(e,i){e.addAction(ZoneUtils.isRail,Transport.railFound),e.addAction(Tile.PORT,Transport.portFound),e.addAction(Tile.AIRPORT,Transport.airportFound),i.addAction(Tile.PORT,15,4),i.addAction(Tile.AIRPORT,7,6)},railFound:function(e,i,t,r){if(r||(r=Micro.simData),r.census.railTotal+=1,r.spriteManager.generateTrain(r.census,i,t),r.budget.shouldDegradeRoad()&&math.getChance(511)){let a=e.getTile(i,t);if(a.isConductive())return;if(r.budget.roadEffect<(31&math.getRandom16())){a.getValue()<Tile.RAILBASE+2?e.setTile(i,t,Tile.RIVER,0):e.setTo(i,t,ZoneUtils.randomRubble())}}},airportFound:function(e,i,t,r){if(r||(r=Micro.simData),r.census.airportPop+=1,e.getTile(i,t).isPowered()){if(e.getTileValue(i+1,t-1)===Tile.RADAR&&e.setTile(i+1,t-1,Tile.RADAR0,Tile.CONDBIT|Tile.ANIMBIT|Tile.BURNBIT),0===math.getRandom(5))return void r.spriteManager.generatePlane(i,t);0===math.getRandom(12)&&r.spriteManager.generateCopter(i,t)}else e.setTile(i+1,t-1,Tile.RADAR,Tile.CONDBIT|Tile.BURNBIT)},portFound:function(e,i,t,r){r||(r=Micro.simData),r.census.seaportPop+=1,e.getTile(i,t).isPowered()&&null===r.spriteManager.getSprite(Micro.SPRITE_SHIP)&&r.spriteManager.generateShip()}};