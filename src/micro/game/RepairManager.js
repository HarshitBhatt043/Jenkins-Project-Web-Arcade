import{MiscUtils}from"../Micro.js";import{Tiles,Tile}from"../Tile.js";export class RepairManager{constructor(i){this._map=i,this._actions=[]}addAction(i,e,t){this._actions.push({criterion:i,period:e,zoneSize:t})}repairZone(i,e,t){let s,o,r,l,a=this._map.getTileValue(i,e)-t-2;for(o=-1;o<t-1;o++)for(s=-1;s<t-1;s++)a++,r=this._map.getTile(i+s,e+o),r.isZone()||r.isAnimated()||(l=r.getValue(),(l<Tile.RUBBLE||l>=Tile.ROADBASE)&&this._map.setTile(i+s,e+o,a,Tile.CONDBIT|Tile.BURNBIT))}checkTile(i,e,t){let s,o,r,l,a,n=this._actions.length;for(;n--;)s=this._actions[n],o=s.period,0==(t&o)&&(r=this._map.getTile(i,e),l=r.getValue(),a=MiscUtils.isCallable(s.criterion),a&&s.criterion.call(null,r)?this.repairZone(i,e,s.zoneSize):a||s.criterion!==l||this.repairZone(i,e,s.zoneSize))}}