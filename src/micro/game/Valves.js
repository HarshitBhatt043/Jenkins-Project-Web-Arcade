import{EventEmitter,Micro}from"../Micro.js";import{Messages}from"../Messages.js";import{math}from"../math/math.js";export class Valves{constructor(){this.resValve=0,this.comValve=0,this.indValve=0,this.resCap=!1,this.comCap=!1,this.indCap=!1}save(i){i.resValve=this.resValve,i.comValve=this.comValve,i.indValve=this.indValve}load(i){this.resValve=i.resValve,this.comValve=i.comValve,this.indValve=i.indValve,EventEmitter.emitEvent(Messages.VALVES_UPDATED,{residential:this.resValve,commercial:this.comValve,industrial:this.indValve})}setValves(i,a,t){var e,s=a.resPop/8;a.totalPop=Math.round(s+a.comPop+a.indPop);var o=s+s*((a.resPop>0?(a.comHist10[1]+a.indHist10[1])/s:1)-1)+.02*s;e=(e=a.comHist10[1]+a.indHist10[1])>0?a.resHist10[1]/e:1,e=math.clamp(e,0,1.3);var r,l,m,V=(s+a.comPop+a.indPop)/3.7*e,h=a.indPop*e*Micro.extMarketParamTable[i];h=Math.max(h,5),r=s>0?o/s:1.3,l=a.comPop>0?V/a.comPop:V,m=a.indPop>0?h/a.indPop:h,r=Math.min(r,2),l=Math.min(l,2),m=Math.min(m,2);var v=Math.min(t.cityTax+i,20);r=600*(r-1)+Micro.taxTable[v],l=600*(l-1)+Micro.taxTable[v],m=600*(m-1)+Micro.taxTable[v],this.resValve=math.clamp(this.resValve+Math.round(r),-Micro.RES_VALVE_RANGE,Micro.RES_VALVE_RANGE),this.comValve=math.clamp(this.comValve+Math.round(l),-Micro.COM_VALVE_RANGE,Micro.COM_VALVE_RANGE),this.indValve=math.clamp(this.indValve+Math.round(m),-Micro.IND_VALVE_RANGE,Micro.IND_VALVE_RANGE),this.resCap&&this.resValve>0&&(this.resValve=0),this.comCap&&this.comValve>0&&(this.comValve=0),this.indCap&&this.indValve>0&&(this.indValve=0),EventEmitter.emitEvent(Messages.VALVES_UPDATED,{residential:this.resValve,commercial:this.comValve,industrial:this.indValve})}}