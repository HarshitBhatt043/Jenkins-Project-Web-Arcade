import{Traffic}from"../Traffic.js";export class ControlSignals{constructor(t){this.intersection=t,this.onTick=Traffic.binding(this.onTick,this),this.flipMultiplier=Traffic.random(),this.phaseOffset=100*Traffic.random(),this.time=this.phaseOffset,this.stateNum=0,this.states=[["L","","L",""],["FR","","FR",""],["","L","","L"],["","FR","","FR"]]}get flipInterval(){return(.1+.05*this.flipMultiplier)*Traffic.settings.lightsFlipInterval}get state(){let t,i,e,s=this.states[this.stateNum%this.states.length];for(this.intersection.roads.length<=2&&(s=["LFR","LFR","LFR","LFR"]),e=[],t=0,i=s.length;t<i;t++)e.push(this._decode(s[t]));return e}copy(t,i){var e;return null==t?new ControlSignals(i):((e=Object.create(ControlSignals.prototype)).flipMultiplier=t.flipMultiplier,e.time=e.phaseOffset=t.phaseOffset,e.stateNum=0,e.intersection=i,e)}toJSON(){return{flipMultiplier:this.flipMultiplier,phaseOffset:this.phaseOffset}}_decode(t){let i=[0,0,0];return Traffic.indexOf.call(t,"L")>=0&&(i[0]=1),Traffic.indexOf.call(t,"F")>=0&&(i[1]=1),Traffic.indexOf.call(t,"R")>=0&&(i[2]=1),i}flip(){this.stateNum+=1}onTick(t){this.time+=t,this.time>this.flipInterval&&(this.flip(),this.time-=this.flipInterval)}}