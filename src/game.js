MG.game=function(){var e="wait_start",t="starting",i="running",r="finished",n="crashed",s=e,u=5,a=0,M=0,l=0,o=0,G=0,c=function(){return a?"LEVEL "+a:"QUALIFYING LEVEL"},f={title:c,text:function(){return"CLICK TO BEGIN"}},b={title:function(){return"CRASHED"},text:function(){return"CLICK TO RETRY"}},m={title:function(){return"GAME OVER"},text:function(){return"CLICK TO START AGAIN"}},d={title:function(){return"LEVEL COMPLETED"},text:function(){return"CLICK TO CONTINUE"}},E=function(){MG.banner.show(f.title(),f.text()),MG.util.showMouse(),MG.missile.setAutopilot(),MG.missile.setVelocity(350+100*a),0===a&&(u=1/0),s=e},A=function(){MG.util.showMouse(),0===u?MG.banner.show(m.title(),m.text()):MG.banner.show(b.title(),b.text()),function(){var e=document.getElementById("explosion");if(e){var t=e.querySelector("animate");t&&(t.beginElement(),e.setAttribute("visibility","visible"),setTimeout((function(){e.setAttribute("visibility","hidden")}),400))}}(),s=n};return{init:function(){var e,t,i=document.getElementById("tunnel");MG.missile.init(),(e=document.createElementNS(NAMESPACE_SVG,"g")).setAttribute("transform","scale(1,-1)"),MG.tunnelWall.init(e),i.appendChild(e),(t=document.createElementNS(NAMESPACE_SVG,"g")).setAttribute("transform","scale(1,-1)"),MG.barrierQueue.init(t),i.appendChild(t),E(),i.setAttribute("visibility","visible")},update:function(e){if(MG.missile.update(e),MG.tunnelWall.update(e),MG.barrierQueue.update(e),!MG.barrierQueue.isEmpty()&&MG.missile.getOffset()<MG.MISSILE_LENGTH&&!MG.missile.isCrashed()){var n=MG.barrierQueue.nextBarrier();if(n.collides(MG.missile.getPosition().x,MG.missile.getPosition().y))MG.missile.onCrash(),A();else if(MG.barrierQueue.popBarrier(),MG.missile.onBarrierPassed(),s===i||s===t)switch(n.getType()){case MG.BarrierType.FINISH:MG.banner.show(d.title(),d.text()),MG.util.showMouse(),MG.missile.setAutopilot(),MG.missile.setVelocity(550+100*a),s=r;break;case MG.BarrierType.BLANK:break;case MG.BarrierType.START:s=i;default:l--;var u=300+100*a,c=function(e){return 400+100*e}(a);MG.missile.setVelocity(u+(u-c)*(l-20)/20);break}}for(;MG.barrierQueue.numBarriers()<MG.LINE_OF_SIGHT/MG.BARRIER_SPACING;){var f=MG.BarrierType.BLANK;s!==i&&s!==t||(f=--M>0?MG.BarrierType.RANDOM:0===M?MG.BarrierType.FINISH:MG.BarrierType.BLANK),MG.barrierQueue.pushBarrier(f)}switch(s){case i:o=1-(l*MG.BARRIER_SPACING+MG.missile.getOffset())/(20*MG.BARRIER_SPACING),G=Math.max(o,G);break;case r:o=1,G=1;break;case t:o=0;break;default:break}},updateDOM:function(){var e=MG.missile.getPosition(),t=MG.missile.getOffset();MG.barrierQueue.updateDOM(-e.x,-e.y,t),MG.tunnelWall.updateDOM(-e.x,-e.y,t)},onMouseMove:function(e,t){var i=window.innerWidth,r=window.innerHeight;MG.missile.setTarget(e-.5*i,-(t-.5*r))},onMouseClick:function(){if(MG.banner.isFullyVisible())switch(s){case e:MG.banner.hide(),MG.util.hideMouse(),M=20,MG.barrierQueue.pushBarrier(MG.BarrierType.START),l=20,MG.missile.setManual(),s=t;break;case r:0===a&&(u=5),a++,G=0,E();break;case n:MG.banner.hide(),MG.fog.fadeIn((function(){0===u?(a=0,u=5,G=0):u--,MG.missile.reset(),MG.barrierQueue.reset(),MG.fog.fadeOut(),E()}));break}},getLevel:function(){return a},getLevelString:c,getNumLives:function(){return u},getProgress:function(){return o},getBestProgress:function(){return G}}}();