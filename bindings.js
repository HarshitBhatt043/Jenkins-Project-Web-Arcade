var keymap={38:"up",39:"right",40:"down",37:"left",87:"up",68:"right",83:"down",65:"left"},userInput=[],mouseDown=!1,initializeOnUp=!1;function resizeWindow(){$canv.width=window.innerWidth*devPixelRatio*quality/10,$canv.height=window.innerHeight*devPixelRatio*quality/10,ctx=$canv.getContext("2d"),ctx.lineJoin="round","playing"===GAME.state?(GAME.spawner.resize($canv.width,$canv.height),GAME.levelBar.resize($canv.width,$canv.height),GAME.levelBalls.resize($canv.width,$canv.height)):ASSETS.loaded&&drawMenu()}function eventPos(e){return-1===e.type.indexOf("touch")?{x:e.pageX*devPixelRatio,y:e.pageY*devPixelRatio,width:1,height:1}:"touchend"===e.type?{x:0,y:0,width:0,height:0}:{x:e.touches[0].pageX*devPixelRatio-35,y:e.touches[0].pageY*devPixelRatio-35,width:70,height:70}}function touchDown(e){e.preventDefault();var t=eventPos(e);"playing"===GAME.state?(GAME.player.updateInput([t.x-$canv.width/2,t.y-$canv.height/2],!0),mouseDown=!0):"menu"===GAME.state&&GAME.MENU.button&&collideBox(t,GAME.MENU.button)&&(drawMenuButton(!0),initializeOnUp=!0),collideBox(t,{x:$canv.width-25,y:10,width:20,height:26})&&toggleMute(),about?(collideBox(t,{x:32,y:10,width:80,height:12})&&window.open("http://zolmeister.com"),collideBox(t,{x:48,y:32,width:48,height:12})&&window.open("https://soundcloud.com/chrissij")):collideBox(t,{x:10,y:10,width:40,height:20})&&showAbout()}function touchUp(e){e.preventDefault();eventPos(e);"playing"===GAME.state?(GAME.player.updateInput([],!0),mouseDown=!1):"menu"===GAME.state&&GAME.MENU.button&&(drawMenuButton(initializeOnUp),initializeOnUp&&(init(),initializeOnUp=!1))}function touchMove(e){e.preventDefault();var t=eventPos(e);"playing"===GAME.state&&mouseDown&&GAME.player.updateInput([t.x-$canv.width/2,t.y-$canv.height/2],!0)}window.onresize=resizeWindow,$canv.addEventListener("mousedown",touchDown),$canv.addEventListener("touchstart",touchDown),$canv.addEventListener("mouseup",touchUp),$canv.addEventListener("touchend",touchUp),$canv.addEventListener("mousemove",touchMove),$canv.addEventListener("touchmove",touchMove),window.onkeydown=function(e){if("playing"===GAME.state){var t=keymap[e.which];if(!t)return;-1!=userInput.indexOf(t)&&userInput.splice(userInput.indexOf(t),1),userInput.unshift(t),GAME.player.updateInput(userInput,!1)}},window.onkeyup=function(e){if("playing"===GAME.state){var t=keymap[e.which];if(!t)return;-1!=userInput.indexOf(t)&&userInput.splice(userInput.indexOf(t),1),GAME.player.updateInput(userInput,!1)}};