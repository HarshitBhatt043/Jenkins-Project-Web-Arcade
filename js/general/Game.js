define((function(e,t,n){"use strict";var o,l,i,d=e("general/Scene"),s=e("general/Switcher"),c=e("general/BeginStage"),u=e("lib/addEvent"),a=e("lib/Storage"),r=e("lib/util"),m=e("lib/stopEvent"),g=document.getElementById("stage"),h=document.getElementById("begin"),y=document.getElementById("tip"),f=document.getElementById("btnFW"),p=document.getElementById("btnReset"),b=document.getElementById("wxArrow"),w=g.getContext("2d"),v="core-ball-level",E=c(h),B=+a.getValue(v)||1,x=!1,S=0;function T(){f.href="sinaweibo://share?content=Core Ball(酷啵) - 练手活的HTML5小游戏，我已玩到第#{level}关了，你也来试试吧！ http://coreball.sinaapp.com".replace(/#\{level\}/,B)}function I(e){B=+e,a.setValue(v,B),document.title="Core Ball(酷啵)-练手活的HTML5游戏，我已玩到第#{level}关了，你也来试试吧!".replace(/\#\{level\}/,B),E.level(B),!r.isWeixin&&r.isMobile&&T()}function W(){window.clearTimeout(S),o.update(),o.render(),l.update(),l.render(),S=window.setTimeout(W,1e3/60)}var C={start:function(){var e,t;e=document.body.scrollWidth||document.documentElement.scrollWidth,t=document.body.scrollHeight||document.documentElement.scrollHeight,g.width=e,g.height=t,l=s(w,e,t),h.style.backgroundColor=l.color,h.style.width=e+"px",h.style.height=t+"px",i=t/560,o=d(document.body,g,w,i),u(document.body,"mousedown",(function(e){var t;if(e&&e.changedTouches)for(t=e.changedTouches.length;t--;)o.shot();else o.shot();"1"!=e.target.getAttribute("data-capture")&&m(e)})),u(b,"mousedown",(function(){b.style.display="none"})),u(p,"mousedown",(function(){x||(x=!0,y.style.display="",I(1),setTimeout((function(){y.style.display="none",x=!1}),1e3))})),o.on("passed",(function(){l.switchStage(0,(function(){o.enabled=!1,I(B+1),g.style.display="none",E.show()}))})),o.on("failed",(function(){l.switchStage(0,(function(){o.enabled=!1,g.style.display="none",E.level(B),E.show()}))})),E.on("start",(function(){g.style.display="",E.hide(),l.switchStage(1,(function(){o.run(B)}))})),r.isWeixin?u(f,"mousedown",(function(){b.style.display=""})):r.isMobile&&T(),E.level(B),E.show(),W()}};n.exports=C}));