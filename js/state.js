function State(t){var e,i=this,r={};this.grid=t,this.clear=function(){e={}},this.save=function(t,e){var n={id:t=t||"1",values:[],restoreCount:0};if(e)for(var u=0;u<e.length;u++)n.values.push(e[u]);else for(u=0;u<i.grid.tiles.length;u++)n.values.push(i.grid.tiles[u].value);return r[t]=n,i},this.restore=function(t){var e=r[t=t||"1"];e.restoreCount++;for(var n=0;n<e.values.length;n++)i.grid.tiles[n].value=e.values[n];return i},this.push=function(t){var i=1==t.value?t.id1:t.id2,r={parent:e,tile:t};e[i]=r,e[t.id]?e[t.id]++:e[t.id]=1,e=r},this.pop=function(){do{var t=e.tile;t.clear(),e=e.parent}while(e&&2==e[t.id])},this.getValueForTile=function(t,e,n){var u=r[t];if(!u)return-1;if(isNaN(n)){var a=e;e=a%i.grid.width,n=Math.floor(a/i.grid.width)}return u.values[n*i.grid.width+e]},this.__defineGetter__("currentState",(function(){return e}))}