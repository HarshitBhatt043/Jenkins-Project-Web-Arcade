var JSON;function buildIOSMeta(){for(var e=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],t=0;t<e.length;t++){var n=document.createElement("meta");n.name=e[t].name,n.content=e[t].content;var i=window.document.head.querySelector('meta[name="'+n.name+'"]');i&&i.parentNode.removeChild(i),window.document.head.appendChild(n)}}function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none"),jQuery(".xxx-ios-fullscreen-scroll").css("display","none"),jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block"),jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}function __iosResize(){if(window.scrollTo(0,0),"iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize(),setTimeout((function(){__iosResize()}),500)}function iosInIframe(){try{return window.self!==window.top}catch(e){return!0}}function isIOSLessThen13(){var e=platform.os,t=e.family.toLowerCase();return e=parseFloat(e.version),"ios"===t&&13>e}"undefined"==typeof _pio&&(_pio={}),_pio.channel=function(){},_pio.channel.prototype.call=function(e,t,n,i,o){var a="undefined"!=typeof PLAYERIO_API_HOST?PLAYERIO_API_HOST:(PlayerIO.useSecureApiRequests?"https":"http")+"://api.playerio.com/json/",r=new XMLHttpRequest;"withCredentials"in r?r.open("post",a,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest).open("post",a):r=new _pio.flashWebRequest("post",a);var s=Error();null!=r?(r.send("["+e+"|"+(this.token||"")+"]"+JSON.stringify(t)),r.onload=function(){var e=null;try{var t=r.response||r.responseText;if("["==t[0]){var a=t.indexOf("]");this.token=t.substring(1,a),t=t.substring(a+1)}e=JSON.parse(t)}catch(e){return void _pio.handleError(s,i,PlayerIOErrorCode.GeneralError,"Error decoding response from webservice: "+e)}if(void 0===e.errorcode&&void 0===e.message){if(t=e,o)try{t=o(e)}catch(e){_pio.handleError(s,i,PlayerIOErrorCode.GeneralError,e.message)}n&&n(t)}else _pio.handleError(s,i,e.errorcode,e.message)},r.onerror=function(e){_pio.handleError(s,i,PlayerIOErrorCode.GeneralError,"Error talking to webservice: "+JSON.stringify(e))}):_pio.handleError(s,i,PlayerIOErrorCode.GeneralError,"Need to implement flash calling")},_pio.runCallback=function(e,t,n){try{e&&e(t)}catch(t){e=(e="Unhandled error in callback: "+t.message)+"\nStack:\n"+(t.stack||t.stacktrace||t.StackTrace),n&&(e=e+"\nCallsite stack:\n"+(n.stack||n.stacktrace||n.StackTrace))}},_pio.handleError=function(e,t,n,i){n=_pio.error(n,i),e&&(e.stack&&(n.stack=e.stack),e.stacktrace&&(n.stacktrace=e.stacktrace),e.StackTrace&&(n.StackTrace=e.StackTrace)),t?_pio.runCallback(t,n,e):"undefined"!=typeof console||alert("No error callback specified for: "+n.code+": "+n.message+"\n"+(n.stack||n.stacktrace||n.StackTrace))},_pio.error=function(e,t){if(1==arguments.length&&(t=e,e=PlayerIOErrorCode.GeneralError),"number"==typeof e&&(e=PlayerIOErrorCode.codes[e]),"string"!=typeof e)throw"Code must be a string!";var n=Error();return new PlayerIOError(e,t,n.stack||n.stacktrace||n.StackTrace)},_pio.debugLog=function(e){},_pio.convertToKVArray=function(e){var t=[];if(e)for(var n in e)t.push({key:""+n,value:""+e[n]});return t},_pio.convertFromKVArray=function(e){var t={};if(e&&e.length)for(var n in e)t[e[n].key]=e[n].value;return t},_pio.convertToSegmentArray=function(e){var t=[];if(e)for(var n in e)t.push(n+":"+e[n]);return t},PlayerIO={useSecureApiRequests:!1,authenticate:function(e,t,n,i,o,a){if("auto"==n.publishingnetworklogin)void 0===window.PublishingNetwork?a(new PlayerIOError(PlayerIOErrorCode.GeneralError,"Could not find the PublishingNetwork object on the current page. Did you include the PublishingNetwork.js script?")):PublishingNetwork.dialog("login",{gameId:e,connectionId:t,__use_usertoken__:!0},(function(n){n.error?a(new PlayerIOError(PlayerIOErrorCode.GeneralError,n.error)):void 0===n.userToken?a(new PlayerIOError(PlayerIOErrorCode.GeneralError,"Missing userToken value in result, but no error message given.")):PlayerIO.authenticate(e,t,{userToken:n.userToken},i,o,a)}));else{var r=new _pio.channel;r.authenticate(e,t,_pio.convertToKVArray(n),_pio.convertToSegmentArray(i),"javascript",_pio.convertToKVArray({}),null,o,a,(function(t){return r.token=t.token,new _pio.client(r,e,t.gamefsredirectmap,t.userid)}))}},quickConnect:null,gameFS:function(e){return new _pio.gameFS(e)}},JSON||(JSON={}),function(){function a(e){return 10>e?"0"+e:e}function c(e){return d.lastIndex=0,d.test(e)?'"'+e.replace(d,(function(e){var t=h[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function b(e,t){var n,i=f,o=t[e];switch(o&&"object"==typeof o&&"function"==typeof o.toJSON&&(o=o.toJSON(e)),"function"==typeof l&&(o=l.call(t,e,o)),typeof o){case"string":return c(o);case"number":return isFinite(o)?String(o):"null";case"boolean":case"null":return String(o);case"object":if(!o)return"null";f+=g;var a=[];if("[object Array]"===Object.prototype.toString.apply(o)){var r=o.length;for(n=0;n<r;n+=1)a[n]=b(n,o)||"null";var s=0===a.length?"[]":f?"[\n"+f+a.join(",\n"+f)+"\n"+i+"]":"["+a.join(",")+"]";return f=i,s}if(l&&"object"==typeof l){for(r=l.length,n=0;n<r;n+=1)if("string"==typeof l[n]){var u=l[n];(s=b(u,o))&&a.push(c(u)+(f?": ":":")+s)}}else for(u in o)Object.prototype.hasOwnProperty.call(o,u)&&(s=b(u,o))&&a.push(c(u)+(f?": ":":")+s);return s=0===a.length?"{}":f?"{\n"+f+a.join(",\n"+f)+"\n"+i+"}":"{"+a.join(",")+"}",f=i,s}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(g=f="","number"==typeof n)for(i=0;i<n;i+=1)g+=" ";else"string"==typeof n&&(g=n);if((l=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return b("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(k,m){function n(e,t){var i,o=e[t];if(o&&"object"==typeof o)for(i in o)if(Object.prototype.hasOwnProperty.call(o,i)){var a=n(o,i);void 0!==a?o[i]=a:delete o[i]}return m.call(e,t,o)}if(k=String(k),e.lastIndex=0,e.test(k)&&(k=k.replace(e,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))),/^[\],:{}\s]*$/.test(k.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var p=eval("("+k+")");return"function"==typeof m?n({"":p},""):p}throw new SyntaxError("JSON.parse")})}(),function(){function e(e){if(null!=i)e(i);else if(o)e(null);else if(null==a){a=[e];var t=setInterval((function(){var e=function(){var e='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="10" height="10" style="$style$" id="$id$">\t<param name="movie" value="$src$" />\t<param name="allowNetworking" value="all" />\t<param name="allowScriptAccess" value="always" />\t\x3c!--[if !IE]>--\x3e\t<object type="application/x-shockwave-flash" data="$src$" width="10" height="10" style="$style$">\t\t<param name="allowNetworking" value="all" />\t\t<param name="allowScriptAccess" value="always" />\t</object>\t\x3c!--<![endif]--\x3e</object>'.replace(/\$id\$/gi,"__pio_flashfallback__");e=(e=e.replace(/\$src\$/gi,"http://192.168.30.154/html5client/FlashFallback/bin-debug/FlashFallback.swf")).replace(/\$style\$/gi,"width:10px;height:10px");var t=document.getElementById("containerId");if(!t){var n=document.createElement("div");n.setAttribute("id",t),n.setAttribute("style","position:absolute;top:-20px;left:-20px"),n.innerHTML=e;try{document.body.appendChild(n)}catch(e){}}return e=function(e){e=document.getElementsByTagName(e);for(var t=0;t!=e.length;t++)if(e[t].ping&&"pong"==e[t].ping())return e[t]},e("embed")||e("object")}();null!=e&&n(e)}),50);setTimeout((function(){null==i&&n(null)}),3e4);var n=function(e){i=e,o=null==e,clearInterval(t);for(var n=0;n!=a.length;n++)a[n](e)}}else a.push(e)}var t={},n=0;__pio_flashfallback_callback__=function(){var e=t[arguments[0]];if(e){for(var n=[],i=1;i!=arguments.length;i++)n[i-1]=arguments[i];e.apply(null,n)}},_pio.flashWebRequest=function(i,o){var a=this;this.response=null,this.onload=function(){},this.onerror=function(){},this.send=function(r){e((function(e){if(null==e)a.onerror("Browser does not support Cross-Origin (CORS) webrequest or Flash as a fallback method");else{var s="cb"+n++;t[s]=function(e,n){delete t[s],e?(a.response=n,a.onload()):a.onerror(n)},e.webrequest(s,i,o,r)}}))}},_pio.flashSocketConnection=function(i,o,a,r,s){var l="cb"+n++,c=this,u=new _pio.messageSerializer,h=!1,d=!1,_=setTimeout((function(){h||(h=!0,a(!1,"Connect attempt timed out"))}),o);this.disconnect=function(){},this.sendMessage=function(e){},e((function(e){null==e?(h=!0,a(!1,"Browser does not support WebSocket connections and the Flash fallback failed.")):(t[l]=function(t,n){switch(t){case"onopen":h||(clearTimeout(_),d=h=!0,e.socketSend(l,[0]),a(d));break;case"onclose":c.disconnect();break;case"onerror":c.disconnect();break;case"onmessage":s(u.deserializeMessage(n,0,n.length))}},c.disconnect=function(){if(d){d=!1,r();try{e.socketClose(l)}catch(e){_pio.debugLog(e)}}},c.sendMessage=function(t){t=u.serializeMessage(t),e.socketSend(l,t)},e.socketConnection(l,i))}))},_pio.isFlashFallbackEnabled=function(t){e((function(e){t(null!=e)}))};var i=null,o=!1,a=null}(),function(){var e=_pio.channel.prototype;e.connect=function(e,t,n,i,o,a,r,s,l,c,u){this.call(10,{gameid:e,connectionid:t,userid:n,auth:i,partnerid:o,playerinsightsegments:a,clientapi:r,clientinfo:s},l,c,u)},_pio.ApiSecurityRule={RespectClientSetting:0,UseHttp:1,UseHttps:2},e.authenticate=function(e,t,n,i,o,a,r,s,l,c){this.call(13,{gameid:e,connectionid:t,authenticationarguments:n,playerinsightsegments:i,clientapi:o,clientinfo:a,playcodes:r},s,l,c)},e.createRoom=function(e,t,n,i,o,a,r,s){this.call(21,{roomid:e,roomtype:t,visible:n,roomdata:i,isdevroom:o},a,r,s)},e.joinRoom=function(e,t,n,i,o,a,r){this.call(24,{roomid:e,joindata:t,isdevroom:n,serverdomainnameneeded:i},o,a,r)},e.createJoinRoom=function(e,t,n,i,o,a,r,s,l,c){this.call(27,{roomid:e,roomtype:t,visible:n,roomdata:i,joindata:o,isdevroom:a,serverdomainnameneeded:r},s,l,c)},e.listRooms=function(e,t,n,i,o,a,r,s){this.call(30,{roomtype:e,searchcriteria:t,resultlimit:n,resultoffset:i,onlydevrooms:o},a,r,s)},e.userLeftRoom=function(e,t,n,i,o,a){this.call(40,{extendedroomid:e,newplayercount:t,closed:n},i,o,a)},e.writeError=function(e,t,n,i,o,a,r,s){this.call(50,{source:e,error:t,details:n,stacktrace:i,extradata:o},a,r,s)},e.updateRoom=function(e,t,n,i,o,a){this.call(53,{extendedroomid:e,visible:t,roomdata:n},i,o,a)},_pio.ValueType={String:0,Int:1,UInt:2,Long:3,Bool:4,Float:5,Double:6,ByteArray:7,DateTime:8,Array:9,Obj:10},e.createObjects=function(e,t,n,i,o){this.call(82,{objects:e,loadexisting:t},n,i,o)},e.loadObjects=function(e,t,n,i){this.call(85,{objectids:e},t,n,i)},_pio.LockType={NoLocks:0,LockIndividual:1,LockAll:2},e.saveObjectChanges=function(e,t,n,i,o,a){this.call(88,{locktype:e,changesets:t,createifmissing:n},i,o,a)},e.deleteObjects=function(e,t,n,i){this.call(91,{objectids:e},t,n,i)},e.loadMatchingObjects=function(e,t,n,i,o,a,r){this.call(94,{table:e,index:t,indexvalue:n,limit:i},o,a,r)},e.loadIndexRange=function(e,t,n,i,o,a,r,s){this.call(97,{table:e,index:t,startindexvalue:n,stopindexvalue:i,limit:o},a,r,s)},e.deleteIndexRange=function(e,t,n,i,o,a,r){this.call(100,{table:e,index:t,startindexvalue:n,stopindexvalue:i},o,a,r)},e.loadMyPlayerObject=function(e,t,n){this.call(103,{},e,t,n)},e.payVaultReadHistory=function(e,t,n,i,o,a){this.call(160,{page:e,pagesize:t,targetuserid:n},i,o,a)},e.payVaultRefresh=function(e,t,n,i,o){this.call(163,{lastversion:e,targetuserid:t},n,i,o)},e.payVaultConsume=function(e,t,n,i,o){this.call(166,{ids:e,targetuserid:t},n,i,o)},e.payVaultCredit=function(e,t,n,i,o,a){this.call(169,{amount:e,reason:t,targetuserid:n},i,o,a)},e.payVaultDebit=function(e,t,n,i,o,a){this.call(172,{amount:e,reason:t,targetuserid:n},i,o,a)},e.payVaultBuy=function(e,t,n,i,o,a){this.call(175,{items:e,storeitems:t,targetuserid:n},i,o,a)},e.payVaultGive=function(e,t,n,i,o){this.call(178,{items:e,targetuserid:t},n,i,o)},e.payVaultPaymentInfo=function(e,t,n,i,o,a){this.call(181,{provider:e,purchasearguments:t,items:n},i,o,a)},e.payVaultUsePaymentInfo=function(e,t,n,i,o){this.call(184,{provider:e,providerarguments:t},n,i,o)},e.partnerPayTrigger=function(e,t,n,i,o){this.call(200,{key:e,count:t},n,i,o)},e.partnerPaySetTag=function(e,t,n,i){this.call(203,{partnerid:e},t,n,i)},e.notificationsRefresh=function(e,t,n,i){this.call(213,{lastversion:e},t,n,i)},e.notificationsRegisterEndpoints=function(e,t,n,i,o){this.call(216,{lastversion:e,endpoints:t},n,i,o)},e.notificationsSend=function(e,t,n,i){this.call(219,{notifications:e},t,n,i)},e.notificationsToggleEndpoints=function(e,t,n,i,o,a){this.call(222,{lastversion:e,endpoints:t,enabled:n},i,o,a)},e.notificationsDeleteEndpoints=function(e,t,n,i,o){this.call(225,{lastversion:e,endpoints:t},n,i,o)},e.gameRequestsSend=function(e,t,n,i,o,a){this.call(241,{requesttype:e,requestdata:t,requestrecipients:n},i,o,a)},e.gameRequestsRefresh=function(e,t,n,i){this.call(244,{playcodes:e},t,n,i)},e.gameRequestsDelete=function(e,t,n,i){this.call(247,{requestids:e},t,n,i)},e.achievementsRefresh=function(e,t,n,i){this.call(271,{lastversion:e},t,n,i)},e.achievementsLoad=function(e,t,n,i){this.call(274,{userids:e},t,n,i)},e.achievementsProgressSet=function(e,t,n,i,o){this.call(277,{achievementid:e,progress:t},n,i,o)},e.achievementsProgressAdd=function(e,t,n,i,o){this.call(280,{achievementid:e,progressdelta:t},n,i,o)},e.achievementsProgressMax=function(e,t,n,i,o){this.call(283,{achievementid:e,progress:t},n,i,o)},e.achievementsProgressComplete=function(e,t,n,i){this.call(286,{achievementid:e},t,n,i)},e.playerInsightRefresh=function(e,t,n){this.call(301,{},e,t,n)},e.playerInsightSetSegments=function(e,t,n,i){this.call(304,{segments:e},t,n,i)},e.playerInsightTrackInvitedBy=function(e,t,n,i,o){this.call(307,{invitinguserid:e,invitationchannel:t},n,i,o)},e.playerInsightTrackEvents=function(e,t,n,i){this.call(311,{events:e},t,n,i)},e.playerInsightTrackExternalPayment=function(e,t,n,i,o){this.call(314,{currency:e,amount:t},n,i,o)},e.playerInsightSessionKeepAlive=function(e,t,n){this.call(317,{},e,t,n)},e.playerInsightSessionStop=function(e,t,n){this.call(320,{},e,t,n)},e.oneScoreLoad=function(e,t,n,i){this.call(351,{userids:e},t,n,i)},e.oneScoreSet=function(e,t,n,i){this.call(354,{score:e},t,n,i)},e.oneScoreAdd=function(e,t,n,i){this.call(357,{score:e},t,n,i)},e.oneScoreRefresh=function(e,t,n){this.call(360,{},e,t,n)},e.simpleConnect=function(e,t,n,i,o,a,r,s,l){this.call(400,{gameid:e,usernameoremail:t,password:n,playerinsightsegments:i,clientapi:o,clientinfo:a},r,s,l)},e.simpleRegister=function(e,t,n,i,o,a,r,s,l,c,u,h,d,_){this.call(403,{gameid:e,username:t,password:n,email:i,captchakey:o,captchavalue:a,extradata:r,partnerid:s,playerinsightsegments:l,clientapi:c,clientinfo:u},h,d,_)},e.simpleRecoverPassword=function(e,t,n,i,o){this.call(406,{gameid:e,usernameoremail:t},n,i,o)},e.kongregateConnect=function(e,t,n,i,o,a,r,s,l){this.call(412,{gameid:e,userid:t,gameauthtoken:n,playerinsightsegments:i,clientapi:o,clientinfo:a},r,s,l)},e.simpleGetCaptcha=function(e,t,n,i,o,a){this.call(415,{gameid:e,width:t,height:n},i,o,a)},e.facebookOAuthConnect=function(e,t,n,i,o,a,r,s,l){this.call(418,{gameid:e,accesstoken:t,partnerid:n,playerinsightsegments:i,clientapi:o,clientinfo:a},r,s,l)},e.steamConnect=function(e,t,n,i,o,a,r,s,l){this.call(421,{gameid:e,steamappid:t,steamsessionticket:n,playerinsightsegments:i,clientapi:o,clientinfo:a},r,s,l)},e.simpleUserGetSecureLoginInfo=function(e,t,n){this.call(424,{},e,t,n)},e.leaderboardsGet=function(e,t,n,i,o,a,r,s,l){this.call(431,{group:e,leaderboard:t,index:n,count:i,neighbouruserid:o,filteruserids:a},r,s,l)},e.leaderboardsSet=function(e,t,n,i,o,a){this.call(434,{group:e,leaderboard:t,score:n},i,o,a)},e.leaderboardsCount=function(e,t,n,i,o){this.call(437,{group:e,leaderboard:t},n,i,o)},e.joinCluster=function(e,t,n,i,o,a,r,s,l,c,u,h,d,_,p,f,g){this.call(504,{clusteraccesskey:e,isdevelopmentserver:t,ports:n,machinename:i,version:o,machineid:a,os:r,cpu:s,cpucores:l,cpulogicalcores:c,cpuaddresswidth:u,cpumaxclockspeed:h,rammegabytes:d,ramspeed:_},p,f,g)},e.serverHeartbeat=function(e,t,n,i,o,a,r,s,l,c,u,h,d,_,p,f,g,m,C,y){this.call(510,{serverid:e,appdomains:t,servertypes:n,machinecpu:i,processcpu:o,memoryusage:a,avaliablememory:r,freememory:s,runningrooms:l,usedresources:c,apirequests:u,apirequestserror:h,apirequestsfailed:d,apirequestsexecuting:_,apirequestsqueued:p,apirequeststime:f,serverunixtimeutc:g},m,C,y)},e.getGameAssemblyUrl=function(e,t,n,i,o,a){this.call(513,{clusteraccesskey:e,gamecodeid:t,machineid:n},i,o,a)},e.devServerLogin=function(e,t,n,i,o){this.call(524,{username:e,password:t},n,i,o)},e.webserviceOnlineTest=function(e,t,n){this.call(533,{},e,t,n)},e.getServerInfo=function(e,t,n,i){this.call(540,{machineid:e},t,n,i)},e.socialRefresh=function(e,t,n){this.call(601,{},e,t,n)},e.socialLoadProfiles=function(e,t,n,i){this.call(604,{userids:e},t,n,i)}}(),PlayerIOError=function(e,t,n){this.code=e,this.message=t,this.stack=n,this.stack||(n=Error(),this.stack=n.stack||n.stacktrace||n.StackTrace),this.toString=function(){return"PlayerIOError["+e+"]: "+t}},PlayerIOError.prototype=Error(),PlayerIOErrorCode={UnsupportedMethod:"UnsupportedMethod",GeneralError:"GeneralError",InternalError:"InternalError",AccessDenied:"AccessDenied",InvalidMessageFormat:"InvalidMessageFormat",MissingValue:"MissingValue",GameRequired:"GameRequired",ExternalError:"ExternalError",ArgumentOutOfRange:"ArgumentOutOfRange",GameDisabled:"GameDisabled",UnknownGame:"UnknownGame",UnknownConnection:"UnknownConnection",InvalidAuth:"InvalidAuth",NoServersAvailable:"NoServersAvailable",RoomDataTooLarge:"RoomDataTooLarge",RoomAlreadyExists:"RoomAlreadyExists",UnknownRoomType:"UnknownRoomType",UnknownRoom:"UnknownRoom",MissingRoomId:"MissingRoomId",RoomIsFull:"RoomIsFull",NotASearchColumn:"NotASearchColumn",QuickConnectMethodNotEnabled:"QuickConnectMethodNotEnabled",UnknownUser:"UnknownUser",InvalidPassword:"InvalidPassword",InvalidRegistrationData:"InvalidRegistrationData",InvalidBigDBKey:"InvalidBigDBKey",BigDBObjectTooLarge:"BigDBObjectTooLarge",BigDBObjectDoesNotExist:"BigDBObjectDoesNotExist",UnknownTable:"UnknownTable",UnknownIndex:"UnknownIndex",InvalidIndexValue:"InvalidIndexValue",NotObjectCreator:"NotObjectCreator",KeyAlreadyUsed:"KeyAlreadyUsed",StaleVersion:"StaleVersion",CircularReference:"CircularReference",HeartbeatFailed:"HeartbeatFailed",InvalidGameCode:"InvalidGameCode",VaultNotLoaded:"VaultNotLoaded",UnknownPayVaultProvider:"UnknownPayVaultProvider",DirectPurchaseNotSupportedByProvider:"DirectPurchaseNotSupportedByProvider",BuyingCoinsNotSupportedByProvider:"BuyingCoinsNotSupportedByProvider",NotEnoughCoins:"NotEnoughCoins",ItemNotInVault:"ItemNotInVault",InvalidPurchaseArguments:"InvalidPurchaseArguments",InvalidPayVaultProviderSetup:"InvalidPayVaultProviderSetup",UnknownPartnerPayAction:"UnknownPartnerPayAction",InvalidType:"InvalidType",IndexOutOfBounds:"IndexOutOfBounds",InvalidIdentifier:"InvalidIdentifier",InvalidArgument:"InvalidArgument",LoggedOut:"LoggedOut",InvalidSegment:"InvalidSegment",GameRequestsNotLoaded:"GameRequestsNotLoaded",AchievementsNotLoaded:"AchievementsNotLoaded",UnknownAchievement:"UnknownAchievement",NotificationsNotLoaded:"NotificationsNotLoaded",InvalidNotificationsEndpoint:"InvalidNotificationsEndpoint",NetworkIssue:"NetworkIssue",OneScoreNotLoaded:"OneScoreNotLoaded",PublishingNetworkNotAvailable:"PublishingNetworkNotAvailable",PublishingNetworkNotLoaded:"PublishingNetworkNotLoaded",DialogClosed:"DialogClosed",AdTrackCheckCookie:"AdTrackCheckCookie",codes:{0:"UnsupportedMethod",1:"GeneralError",2:"InternalError",3:"AccessDenied",4:"InvalidMessageFormat",5:"MissingValue",6:"GameRequired",7:"ExternalError",8:"ArgumentOutOfRange",9:"GameDisabled",10:"UnknownGame",11:"UnknownConnection",12:"InvalidAuth",13:"NoServersAvailable",14:"RoomDataTooLarge",15:"RoomAlreadyExists",16:"UnknownRoomType",17:"UnknownRoom",18:"MissingRoomId",19:"RoomIsFull",20:"NotASearchColumn",21:"QuickConnectMethodNotEnabled",22:"UnknownUser",23:"InvalidPassword",24:"InvalidRegistrationData",25:"InvalidBigDBKey",26:"BigDBObjectTooLarge",27:"BigDBObjectDoesNotExist",28:"UnknownTable",29:"UnknownIndex",30:"InvalidIndexValue",31:"NotObjectCreator",32:"KeyAlreadyUsed",33:"StaleVersion",34:"CircularReference",40:"HeartbeatFailed",41:"InvalidGameCode",50:"VaultNotLoaded",51:"UnknownPayVaultProvider",52:"DirectPurchaseNotSupportedByProvider",54:"BuyingCoinsNotSupportedByProvider",55:"NotEnoughCoins",56:"ItemNotInVault",57:"InvalidPurchaseArguments",58:"InvalidPayVaultProviderSetup",70:"UnknownPartnerPayAction",80:"InvalidType",81:"IndexOutOfBounds",82:"InvalidIdentifier",83:"InvalidArgument",84:"LoggedOut",90:"InvalidSegment",100:"GameRequestsNotLoaded",110:"AchievementsNotLoaded",111:"UnknownAchievement",120:"NotificationsNotLoaded",121:"InvalidNotificationsEndpoint",130:"NetworkIssue",131:"OneScoreNotLoaded",200:"PublishingNetworkNotAvailable",201:"PublishingNetworkNotLoaded",301:"DialogClosed",302:"AdTrackCheckCookie"}},_pio.client=function(e,t,n,i){this.connectUserId=i,this.gameId=t,this.gameFS=new _pio.gameFS(t,n),this.errorLog=new _pio.errorLog(e),this.payVault=new _pio.payVault(e),this.bigDB=new _pio.bigDB(e),this.multiplayer=new _pio.multiplayer(e),this.gameRequests=new _pio.gameRequests(e),this.achievements=new _pio.achievements(e),this.playerInsight=new _pio.playerInsight(e),this.oneScore=new _pio.oneScore(e),this.leaderboards=new _pio.leaderboards(e,this.connectUserId),this.notifications=new _pio.notifications(e),this.publishingNetwork=new _pio.publishingNetwork(e,this.connectUserId)},function(){var e={};_pio.gameFS=function(t,n){if("string"==typeof n&&0<n.length){var i=(n||"").split("|");if(1<=i.length)for(var o=e[t.toLowerCase()]={},a=0;a!=i.length;a++){var r=i[a];"alltoredirect"==r||"cdnmap"==r?o.baseUrl=i[a+1]:"alltoredirectsecure"==r||"cdnmapsecure"==r?o.secureBaseUrl=i[a+1]:o["."+r]=i[a+1]}}this.getUrl=function(n,i){if("/"==!n[0])throw _pio.error("The path given to getUrl must start with a slash, like: '/myfile.swf' or '/folder/file.jpg'");var o=e[t];return o?(i?o.secureBaseUrl:o.baseUrl)+(o["."+n]||n):(i?"https":"http")+"://r.playerio.com/r/"+t+n}}}(),_pio.gameRequests=function(e){function t(e){if(null==e||0==e.length)return[];for(var t=[],n=0;n!=e.length;n++){var i=e[n];t.push(new _pio.gameRequest(i.id,i.type,i.senderuserid,i.created,i.data))}return t}var n=[];this.waitingRequests="[ERROR: You tried to access gameRequests.waitingRequests before loading waiting requests. You have to call the refresh method first.]";var i=this;this.send=function(t,n,i,o,a){e.gameRequestsSend(t,_pio.convertToKVArray(n),i,o,a,(function(e){}))},this.refresh=function(o,a){e.gameRequestsRefresh(n,o,a,(function(e){i._playCodes=e.newplaycodes,i.waitingRequests=t(e.requests)}))},this.delete=function(n,o,a){if("object"==typeof n||n.length){for(var r=[],s=0;s!=n.length;s++){var l=n[s].id;if(!l)return n=_pio.error("No GameRequest id found on item#"+s+". You have to use requests from the gameRequests.waitingRequests array. For instance: client.gameRequests.delete(client.gameRequests.waitingRequests, ...)"),void _pio.handleError(n,a,n.code,n.message);r.push(l)}e.gameRequestsDelete(r,o,a,(function(e){i.waitingRequests=t(e.requests)}))}else n=_pio.error("The first argument to delete should be an array: client.gameRequests.delete([requests], ...)"),_pio.handleError(n,a,n.code,n.message)}},_pio.gameRequest=function(e,t,n,i,o){this.id=e,this.type=t,this.senderUserId=n,this.created=new Date(i),this.data=_pio.convertFromKVArray(o)},_pio.errorLog=function(e){this.writeError=function(t,n,i,o){e.writeError("Javascript",t,n,i,_pio.convertToKVArray(o))}},_pio.quickConnect=function(){this.simpleGetCaptcha=function(e,t,n,i,o){(new _pio.channel).simpleGetCaptcha(e,t,n,i,o,(function(e){return new _pio.simpleGetCaptchaOutput(e.captchakey,e.captchaimageurl)}))},this.simpleRecoverPassword=function(e,t,n,i){(new _pio.channel).simpleRecoverPassword(e,t,n,i,(function(e){}))}},_pio.simpleGetCaptchaOutput=function(e,t){this.captchaKey=e,this.captchaImageUrl=t},PlayerIO.quickConnect=new _pio.quickConnect,_pio.payVault=function(e){function t(e){if(null!=e&&(n=e.version,i.coins=e.coins||0,i.items=[],e.items&&e.items.length))for(var t=0;t!=e.items.length;t++){var o=e.items[t],a=i.items[t]=new _pio.vaultItem(o.id,o.itemkey,(new Date).setTime(o.purchasedate));_pio.bigDBDeserialize(o.properties,a,!0)}}var n=null;this.coins="[ERROR: you tried to access payVault.coins before the vault was loaded. You have to refresh the vault before the .coins property is set to the right value]",this.items="[ERROR: you tried to access payVault.items before the vault was loaded. You have to refresh the vault before the .items property is set to the right value]",this.has=function(e){if(null==n)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var t=0;t!=this.items.length;t++)if(this.items[t].itemKey==e)return!0;return!1},this.first=function(e){if(null==n)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var t=0;t!=this.items.length;t++)if(this.items[t].itemKey==e)return this.items[t];return null},this.count=function(e){if(null==n)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var t=0,i=0;i!=this.items.length;i++)this.items[i].itemKey==e&&t++;return t},this.refresh=function(i,o){e.payVaultRefresh(n,null,i,o,(function(e){t(e.vaultcontents)}))},this.readHistory=function(t,n,i,o){e.payVaultReadHistory(t,n,null,i,o,(function(e){for(var t=[],n=0;n!=e.entries.length;n++){var i=e.entries[n];t.push(new _pio.payVaultHistoryEntry(i.type,i.amount,i.timestamp,i.itemkeys||[],i.reason,i.providertransactionid,i.providerprice))}return t}))},this.credit=function(n,i,o,a){e.payVaultCredit(n,i,null,o,a,(function(e){t(e.vaultcontents)}))},this.debit=function(n,i,o,a){e.payVaultDebit(n,i,null,o,a,(function(e){t(e.vaultcontents)}))},this.consume=function(n,i,o){if("object"==typeof n||n.length){for(var a=[],r=0;r!=n.length;r++){var s=n[r].id;if(!s)return n=_pio.error("No PayVault item id found on item#"+r+". You have to use items from the payVault.items array. For instance: client.payVault.consume([client.payVault.first('sportscar')], ...)"),void _pio.handleError(n,o,n.code,n.message);a.push(s)}e.payVaultConsume(a,null,i,o,(function(e){t(e.vaultcontents)}))}else n=_pio.error("The first argument to consume should be an array: client.payVault.consume([item], ...)"),_pio.handleError(n,o,n.code,n.message)},this.buy=function(n,i,o,a){e.payVaultBuy(_pio.convertBuyItems(n),i,null,o,a,(function(e){t(e.vaultcontents)}))},this.give=function(n,i,o){e.payVaultGive(_pio.convertBuyItems(n),null,i,o,(function(e){t(e.vaultcontents)}))},this.getBuyCoinsInfo=function(t,n,i,o){e.payVaultPaymentInfo(t,_pio.convertToKVArray(n),null,i,o,(function(e){return _pio.convertFromKVArray(e.providerarguments)}))},this.getBuyDirectInfo=function(t,n,i,o,a){e.payVaultPaymentInfo(t,_pio.convertToKVArray(n),_pio.convertBuyItems(i),o,a,(function(e){return _pio.convertFromKVArray(e.providerarguments)}))};var i=this},_pio.convertBuyItems=function(e){if(null==e)return[];for(var t=[],n=0;n!=e.length;n++){var i=e[n].itemkey;if(!i)throw _pio.error("You have to specify an itemkey for the payvault item. Example:  {itemkey:'car'}");t.push({itemkey:i,payload:_pio.compareForChanges({itemkey:i},e[n],!0,!0)})}return t},_pio.vaultItem=function(e,t,n){this.id=e,this.itemKey=t,this.purchaseDate=n},_pio.payVaultHistoryEntry=function(e,t,n,i,o,a,r){this.type=e,this.amount=t,this.timestamp=(new Date).setTime(n),this.itemKeys=i,this.reason=o,this.providerTransactionId=a,this.providerPrice=r},_pio.bigDB=function(e){function t(){for(var e=0;e<o.length;e++){var t,n=o[e],i=!0;for(t in n.objects)if(n.objects[t]._internal_("get-is-saving")){i=!1;break}if(i){for(t in n.objects)for(i=e+1;i<o.length;i++){futureSave=o[i];for(var a=0;a<futureSave.objects.length;a++)futureSave.objects[a]==n.objects[t]&&futureSave.fullOverwrite==n.fullOverwrite&&futureSave.useOptimisticLock==n.useOptimisticLock&&(n.changesets[t]=futureSave.changesets[a],n.futureSaves.push(futureSave))}o.splice(e,1),e--,n.execute()}}}function n(e,t){null==e?e=[]:e instanceof Array||(e=[e]),null!=t&&(e=e.concat([t]));for(var n=[],i=0;i!=e.length;i++){var o=e[i];switch(typeof o){case"boolean":n.push({valuetype:_pio.ValueType.Bool,bool:o});break;case"string":n.push({valuetype:_pio.ValueType.String,string:o});break;case"number":0!=o%1?n.push({valuetype:_pio.ValueType.Double,double:o}):-2147483648<o&&2147483647>o?n.push({valuetype:_pio.ValueType.Int,int:o}):0<o&&4294967295>o?n.push({valuetype:_pio.ValueType.UInt,uint:o}):n.push({valuetype:_pio.ValueType.Long,long:o});break;case"object":if(!o.getTime||!o.getMilliseconds)throw Error("Don't know how to serialize type '"+typeof o+"' for BigDB");n.push({valuetype:_pio.ValueType.DateTime,datetime:o.getTime()});break;default:throw Error("Don't know how to serialize type '"+typeof o+"' for BigDB")}}return n}var i=this,o=[];this.createObject=function(t,n,o,a,r){var s=_pio.compareForChanges({},o||{},!0,!0);e.createObjects([{key:n,table:t,properties:s}],!1,a,r,(function(e){if(1==e.objects.length)return new _pio.databaseobject(i,t,e.objects[0].key,e.objects[0].version,!1,s);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error creating object")}))},this.loadMyPlayerObject=function(t,n){e.loadMyPlayerObject(t,n,(function(e){return new _pio.databaseobject(i,"PlayerObjects",e.playerobject.key,e.playerobject.version,!0,e.playerobject.properties)}))},this.load=function(t,n,o,a){e.loadObjects([{table:t,keys:[n]}],o,a,(function(e){if(1==e.objects.length)return null==e.objects[0]?null:new _pio.databaseobject(i,t,e.objects[0].key,e.objects[0].version,!1,e.objects[0].properties);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error loading object")}))},this.loadKeys=function(t,n,o,a){e.loadObjects([{table:t,keys:n}],o,a,(function(e){for(var n=[],o=0;o!=e.objects.length;o++){var a=e.objects[o];n[o]=null==a?null:new _pio.databaseobject(i,t,a.key,a.version,!1,a.properties)}return n}))},this.loadOrCreate=function(t,n,o,a){e.createObjects([{key:n,table:t,properties:[]}],!0,o,a,(function(e){if(1==e.objects.length)return new _pio.databaseobject(i,t,e.objects[0].key,e.objects[0].version,!1,e.objects[0].properties);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error creating object")}))},this.deleteKeys=function(t,n,i,o){e.deleteObjects([{table:t,keys:n}],i,o,(function(e){return null}))},this.loadKeysOrCreate=function(t,n,o,a){for(var r=[],s=0;s!=n.length;s++)r.push({key:n[s],table:t,properties:[]});e.createObjects(r,!0,o,a,(function(e){for(var n=[],o=0;o!=e.objects.length;o++){var a=e.objects[o];n[o]=new _pio.databaseobject(i,t,a.key,a.version,!1,a.properties)}return n}))},this.loadSingle=function(t,o,a,r,s){e.loadMatchingObjects(t,o,n(a),1,r,s,(function(e){return 0==e.objects.length?null:new _pio.databaseobject(i,t,e.objects[0].key,e.objects[0].version,!1,e.objects[0].properties)}))},this.loadRange=function(t,o,a,r,s,l,c,u){e.loadIndexRange(t,o,n(a,r),n(a,s),l,c,u,(function(e){for(var n=[],o=0;o!=e.objects.length;o++){var a=e.objects[o];n[o]=null==a?null:new _pio.databaseobject(i,t,a.key,a.version,!1,a.properties)}return n}))},this.deleteRange=function(t,i,o,a,r,s,l){e.deleteIndexRange(t,i,n(o,a),n(o,r),s,l,(function(){}))},this.saveChanges=function(n,i,a,r,s,l){var c=1==l;for(var u in l=[],a){var h=a[u];if(!(h.existsInDatabase&&h.key&&h.table&&h._internal_&&h.save))return n=_pio.error("You can only save database objects that exist in the database"),void _pio.handleError(n,s,n.code,n.message);var d=_pio.compareForChanges(i?{}:h._internal_("get-dbCurrent"),h,!0,!0);(i||0<d.length)&&l.push({key:h._internal_("get-key"),table:h._internal_("get-table"),fulloverwrite:i,onlyifversion:n?h._internal_("get-version"):null,changes:d})}o.push({objects:a,changesets:l,fullOverwrite:i,useOptimisticLock:n,futureSaves:[],setIsSavingOnAll:function(e){for(var t=0;t!=this.objects.length;t++)this.objects[t]._internal_("set-is-saving",e)},done:function(){this.setIsSavingOnAll(!1),t()},execute:function(){var t=this;t.setIsSavingOnAll(!0),0<t.changesets.length?e.saveObjectChanges(_pio.LockType.LockAll,t.changesets,c,r,(function(e){t.done(),_pio.handleError(e,s,e.code,e.message)}),(function(e){for(var n=0;n!=t.objects.length;n++){var i=t.objects[n];i._internal_("set-version",e.versions[n]),i._internal_("change-dbCurrent",t.changesets[n].changes);for(var o=0;o!=t.futureSaves.length;o++)for(var a=t.futureSaves[o],r=0;r<a.objects.length;r++)a.objects[r]==i&&(a.changesets.splice(r,1),a.objects.splice(r,1),r--)}t.done()})):(t.done(),setTimeout(r,1))}}),t()}},_pio.databaseobject=function(e,t,n,i,o,a){var r={},s=!1;_pio.bigDBDeserialize(a,r,!0),this.table=t,this.key=n,this.existsInDatabase=!0,this.save=function(t,n,i,a){e.saveChanges(t,n,[this],i,a,o)},this._internal_=function(e,o){switch(e){case"get-table":return t;case"get-key":return n;case"set-is-saving":s=o;case"get-is-saving":return s;case"get-version":return i;case"set-version":i=o;case"get-dbCurrent":return r;case"change-dbCurrent":_pio.bigDBDeserialize(o,r,!0)}},_pio.bigDBDeserialize(a,this,!0)},_pio.compareForChanges=function(e,t,n,i){var o,a=[];for(o in t){var r=t[o],s=e?e[o]:null;switch(o){case"table":if(i)continue;case"key":if(i)continue;case"save":if(i)continue;case"existsInDatabase":if(i)continue;case"_internal_":if(i)continue;case"_circular_reference_finder_":continue}if(null!=r){var l=n?{name:o}:{index:parseInt(o)};switch(typeof r){case"boolean":r!=s&&(l.value={valuetype:_pio.ValueType.Bool,bool:r},a.push(l));break;case"number":r!=s&&(isFinite(r)&&Math.floor(r)===r?l.value=-2147483648<=r&&2147483647>=r?{valuetype:_pio.ValueType.Int,int:r}:0<r&&4294967295>=r?{valuetype:_pio.ValueType.UInt,uint:r}:-0x7ffffffffffffc00<=r&&0x7ffffffffffffc00>=r?{valuetype:_pio.ValueType.Long,long:r}:0<r&&0xfffffffffffff800>=r?{valuetype:_pio.ValueType.ULong,ulong:r}:{valuetype:_pio.ValueType.Double,double:r}:l.value={valuetype:_pio.ValueType.Double,double:r},a.push(l));break;case"string":r!=s&&(l.value={valuetype:_pio.ValueType.String,string:r},a.push(l));break;case"object":if(r.getTime&&r.getMilliseconds)r+""!=s+""&&(l.value={valuetype:_pio.ValueType.DateTime,datetime:r.getTime()},a.push(l));else{if(r._circular_reference_finder_)throw new PlayerIOError(PlayerIOErrorCode.CircularReference,"The object you're trying to save contains a circular reference for "+(n?"a property named":"the array entry")+"): "+o);r._circular_reference_finder_=!0;var c=r instanceof Array;if(c&&r.bytearray){for(c=Array(r.length),s=0;s!=c.length;s++){var u=r[s];if(!(0<=u&&255>=u))throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"The bytearray property '"+o+"' was supposed to only contain byte (0-255) values, but contained the value: "+u);c[s]=u}l.value={valuetype:_pio.ValueType.ByteArray,bytearray:c}}else s=_pio.compareForChanges(s,r,!c,!1),l.value=c?{valuetype:_pio.ValueType.Array,arrayproperties:s}:{valuetype:_pio.ValueType.Obj,objectproperties:s};a.push(l),delete r._circular_reference_finder_}break;case"undefined":break;case"function":break;default:throw Error("Don't know how to serialize type '"+typeof r+"' for BigDB")}}}for(o in e)null!=t[o]&&void 0!==t[o]||a.push(n?{name:o}:{index:parseInt(o)});return a},_pio.bigDBDeserialize=function(e,t,n){for(var i in e){var o=e[i],a=n?o.name:o.index||0;if(o=o.value)switch(o.valuetype||0){case _pio.ValueType.String:t[a]=o.string||"";break;case _pio.ValueType.Int:t[a]=o.int||0;break;case _pio.ValueType.UInt:t[a]=o.uint||0;break;case _pio.ValueType.Long:t[a]=o.long||0;break;case _pio.ValueType.Bool:t[a]=o.bool||0;break;case _pio.ValueType.Float:t[a]=o.float||0;break;case _pio.ValueType.Double:t[a]=o.double||0;break;case _pio.ValueType.ByteArray:t[a]=o.bytearray,t[a].bytearray=!0;break;case _pio.ValueType.DateTime:t[a]=new Date(o.datetime||0);break;case _pio.ValueType.Array:var r=t[a]instanceof Array?t[a]:[];_pio.bigDBDeserialize(o.arrayproperties,r,!1),t[a]=r;break;case _pio.ValueType.Obj:r="object"==typeof t[a]?t[a]:{},_pio.bigDBDeserialize(o.objectproperties,r,!0),t[a]=r}else delete t[a]}},function(){_pio.multiplayer=function(e){var t=this;this.developmentServer=null,this.useSecureConnections=!1,this.createRoom=function(n,i,o,a,r,s){e.createRoom(n,i,o,_pio.convertToKVArray(a),null!=t.developmentServer,r,s,(function(e){return e.roomid}))},this.joinRoom=function(n,i,o,a){clearTimeout(setTimeout((function(){o(new _pio.connection)}),1e4));var r=Error();e.joinRoom(n,_pio.convertToKVArray(i),null!=t.developmentServer,t.useSecureConnections,(function(){}),a,(function(e){return new _pio.connection(r,t.developmentServer,t.useSecureConnections,e.endpoints,e.joinkey,i||{},o,a)}))},this.createJoinRoom=function(n,i,o,a,r,s,l){clearTimeout(setTimeout((function(){s(new _pio.connection)}),1e4));var c=Error();e.createJoinRoom(n,i,o,_pio.convertToKVArray(a),_pio.convertToKVArray(r),null!=t.developmentServer,t.useSecureConnections,(function(){}),l,(function(e){return new _pio.connection(c,t.developmentServer,t.useSecureConnections,e.endpoints,e.joinkey,r||{},s,l)}))},this.listRooms=function(n,i,o,a,r,s){e.listRooms(n,_pio.convertToKVArray(i),o,a,null!=t.developmentServer,r,s,(function(e){var t=[];if(e.rooms&&0<e.rooms.length)for(var n=0;n!=e.rooms.length;n++){var i=e.rooms[n];t.push(new _pio.roomInfo(i.id,i.roomtype,i.onlineusers,_pio.convertFromKVArray(i.roomdata)))}return t}))}},_pio.websocketConnection=function(e,t,n,i,o,a,r){var s=this,l=!1,c=new _pio.messageSerializer,u=!1,h=null;t=(t?"wss://":"ws://")+n+"/";try{h="undefined"!=typeof MozWebSocket?new MozWebSocket(t):new WebSocket(t)}catch(e){return void o(!1,""+e)}var d=setTimeout((function(){l||(l=!0,o(!1,"Connect attempt timed out"))}),i);h.onopen=function(){l||(clearTimeout(d),u=l=!0,o(u))},h.onclose=function(e){s.disconnect()},h.onerror=function(e){s.disconnect()},h.onmessage=function(t){if(u)if(e){var n=new FileReader;n.onloadend=function(){for(var e=new Uint8Array(n.result),t=Array(e.length),i=0;i!=e.length;i++)t[i]=e[i];r(c.deserializeMessage(t,0,t.length))},n.readAsArrayBuffer(t.data)}else t=_pio.base64decode(t.data),r(c.deserializeMessage(t,0,t.length))},this.disconnect=function(){if(u){u=!1,a();try{h.close()}catch(e){_pio.debugLog(e)}}},this.sendMessage=function(t){if(t=c.serializeMessage(t),e){for(var n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t[i];h.send(n.buffer)}else t=_pio.base64encode(t),h.send(t)}},_pio.connection=function(e,t,n,i,o,a,r,s){function l(l){function _(e,t){var n=d[e];if(n)for(var i=0;i<n.length;i++)_pio.runCallback(n[i].callback,t,n[i].stackSource)}var f=[];if(t)f.push(t);else for(var g=0;g!=i.length;g++)f.push(i[g].address+":"+i[g].port);!function t(){if(0<f.length){var i=f[0];f.splice(0,1);var d=l(n,i,4e3,(function(e,n){if(e){p=d,c.connected=!0;var r=c.createMessage("join");if(r.addString(o),null!=a)for(var s in a)r.addString(s),r.addString(""+a[s]);c.sendMessage(r)}else _pio.debugLog("Unable to connect to endpoint: "+i+'. reason: "'+n+(0<f.length?'". Trying next endpoint.':'". No more endpoints to try.')),t()}),(function(e){c.connected&&(c.connected=!1,setTimeout((function(){for(var e=0;e!=h.length;e++)_pio.runCallback(h[e].callback,c,h[e].stackSource)}),100))}),(function(t){u?"playerio.joinresult"==t.type?(u=!1,t.getBoolean(0)?_pio.runCallback(r,c,null):_pio.handleError(e,s,t.getInt(1),t.getString(2))):_pio.handleError(e,s,PlayerIOErrorCode.GeneralError,"The expected inital messagetype is: playerio.joinresult, received: "+joinResult.getType()):(_(t.type,t),_("*",t))}))}else _pio.handleError(e,s,PlayerIOErrorCode.GeneralError,"Could not establish a socket connection to any of the given endpoints for the room")}()}var c=this,u=!0,h=[],d={},_=[],p=null,f=/(WebKit|Firefox|Trident)\/([0-9]+)/gi.exec(navigator.userAgent),g=f&&3<=f.length?f[1]:null;f=f&&3<=f.length?parseInt(f[2]):null,window.FileReader&&"WebKit"==g&&535<=f||"Firefox"==g&&11<=f||"Trident"==g&&6<=f?l((function(e,t,n,i,o,a){return new _pio.websocketConnection(!0,e,t,n,i,o,a)})):_pio.isFlashFallbackEnabled((function(e){l(e?function(e,t,n,i,o,a){return new _pio.flashSocketConnection(t,n,i,o,a)}:function(e,t,n,i,o,a){return new _pio.websocketConnection(!1,e,t,n,i,o,a)})})),this.connected=!1,this.addDisconnectCallback=function(e){h.push({callback:e,stackSourc:Error()})},this.addMessageCallback=function(e,t){null==e&&(e="*");var n=d[e];n||(d[e]=n=[]),n.push({callback:t,stackSource:Error()})},this.removeDisconnectCallback=function(e){for(var t=0;t<h.length;t++)h[t].callback==e&&(h.splice(t,1),t--)},this.removeMessageCallback=function(e){for(var t in d)for(var n=d[t],i=0;i<n.length;i++)n[i].callback==e&&(n.splice(i,1),i--)},this.createMessage=function(e){for(var t=new _pio.message(e),n=1;n<arguments.length;n++)t.add(arguments[n]);return t},this.send=function(e){var t=this.createMessage.apply(this,arguments);this.sendMessage(t)},this.sendMessage=function(e){c.connected?p.sendMessage(e):_.push(e)},this.disconnect=function(){c.connected&&p.disconnect()}},_pio.message=function(e){function t(e,t,n,i){if(!e)throw _pio.error("The given value ("+t+") is not "+i);s.push(t),r.push(n),a.length=s.length}function n(e,t){if(e>s.length)throw _pio.error("this message ("+a.type+") only has "+s.length+" entries");if(r[e]==t)return s[e];throw _pio.error("Value at index:"+e+" is a "+i(r[e])+" and not a "+i(t)+" as requested. The value is: "+s[e])}function i(e){return{0:"Integer",1:"Unsigned Integer",2:"Long",3:"Unsigned Long",4:"Double",5:"Float",6:"String",7:"ByteArray",8:"Boolean"}[e]}function o(e){var t="object"==typeof e&&void 0!==e.length;if(t)for(var n=0;n!=e.length;n++)if(255<e[n]||0>e[n]){t=!1;break}return t}var a=this,r=[],s=[];this.type=e,this.length=0,this.add=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];switch(typeof t){case"string":a.addString(t);break;case"boolean":a.addBoolean(t);break;case"number":if(isFinite(t)&&Math.floor(t)===t){if(-2147483648<=t&&2147483647>=t){a.addInt(t);break}if(0<t&&4294967295>=t){a.addUInt(t);break}if(-0x7ffffffffffffc00<=t&&0x7ffffffffffffc00>=t){a.addLong(t);break}if(0<t&&0xfffffffffffff800>=t){a.addULong(t);break}}a.addDouble(t);break;case"object":if(o(t)){this.addByteArray(t);break}default:throw _pio.error("The type of the value ("+t+") cannot be inferred")}}},this.addInt=function(e){t(-2147483648<=e&&2147483647>=e,Math.trunc(e),0,"an integer (32bit)")},this.addUInt=function(e){t(0<=e&&4294967295>=e,Math.trunc(e),1,"an unsigned integer (32bit)")},this.addLong=function(e){t(-0x7ffffffffffffc00<=e&&0x7ffffffffffffc00>=e,Math.trunc(e),2,"a long (64bit)")},this.addULong=function(e){t(0<=e&&0xfffffffffffff800>=e,e,3,"an unsigned long (64bit)")},this.addBoolean=function(e){t(!0,!!e,8,"a boolean value")},this.addFloat=function(e){t(!0,Number(e),5,"a floating point value (32bit)")},this.addDouble=function(e){t(!0,Number(e),4,"a double floating point value (64bit)")},this.addByteArray=function(e){t(o(e),e,7,"a bytearray")},this.addString=function(e){t(!0,e+"",6,"a string")},this.getInt=function(e){return n(e,0)},this.getUInt=function(e){return n(e,1)},this.getLong=function(e){return n(e,2)},this.getULong=function(e){return n(e,3)},this.getBoolean=function(e){return n(e,8)},this.getDouble=function(e){return n(e,4)},this.getFloat=function(e){return n(e,5)},this.getByteArray=function(e){return n(e,7)},this.getString=function(e){return n(e,6)},this.toString=function(){for(var e="msg.Type = "+this.type,t=0;t!=this.length;t++)e+=", msg["+t+"] = "+s[t]+" ("+i(r[t])+")";return e},this._internal_=function(e,t){switch(e){case"get-objects":return s;case"get-types":return r}}},_pio.roomInfo=function(e,t,n,i){this.id=e,this.roomType=t,this.onlineUsers=n,this.roomData=i},_pio.byteWriter=function(){this.bytes=[],this.writeByte=function(e){if(!(0<=e&&255>=e))throw Error("This is not a byte value: "+e);this.bytes.push(e)},this.writeBytes=function(e){for(var t=0;t!=e.length;t++)this.writeByte(e[t])},this.writeTagWithLength=function(e,t,n){63<e||0>e?this.writeBottomPatternAndBytes(n,_pio.binaryserializer.bytesFromInt(e)):this.writeByte(t|e)},this.writeBottomPatternAndBytes=function(e,t){var n=0;for(0!=t[0]?n=3:0!=t[1]?n=2:0!=t[2]&&(n=1),this.writeByte(e|n),n=t.length-n-1;n!=t.length;n++)this.writeByte(t[n])},this.writeLongPattern=function(e,t,n){for(var i=0,o=0;7!=o;o++)if(0!=n[o]){i=7-o;break}for(3<i?this.writeByte(t|i-4):this.writeByte(e|i),o=n.length-i-1;o!=n.length;o++)this.writeByte(n[o])}},_pio.messageSerializer=function(){this.serializeMessage=function(e){var t=new _pio.byteWriter;t.writeTagWithLength(e.length,128,4);var n=_pio.binaryserializer.bytesFromString(e.type);t.writeTagWithLength(n.length,192,12),t.writeBytes(n);for(var i=0;i!=e.length;i++)switch(n=e._internal_("get-objects")[i],e._internal_("get-types")[i]){case 6:n=_pio.binaryserializer.bytesFromString(n),t.writeTagWithLength(n.length,192,12),t.writeBytes(n);break;case 0:t.writeTagWithLength(n,128,4);break;case 1:t.writeBottomPatternAndBytes(8,_pio.binaryserializer.bytesFromUInt(n));break;case 2:t.writeLongPattern(48,52,_pio.binaryserializer.bytesFromLong(n));break;case 3:t.writeLongPattern(56,60,_pio.binaryserializer.bytesFromULong(n));break;case 7:t.writeTagWithLength(n.length,64,16),t.writeBytes(n);break;case 4:t.writeByte(3),t.writeBytes(_pio.binaryserializer.bytesFromDouble(n));break;case 5:t.writeByte(2),n=_pio.binaryserializer.bytesFromFloat(n),t.writeBytes(n);break;case 8:t.writeByte(n?1:0)}return t.bytes},this.deserializeMessage=function(e,t,n){var i=t;t+=n,n=null;for(var o=0;i<t;){var a=0,r=0,s=e[i];i++;var l=192&s;switch(0==l&&(0==(l=60&s)&&(l=s)),l){case 12:case 16:if(i+(a=1+(3&s))>t)throw Error("Unexpected: Unfinished message");s=a,a=_pio.binaryserializer.intFromBytes(e,i,a),i+=s;break;case 192:a=63&s;break;case 128:r=63&s;break;case 64:a=63&s;break;case 4:case 8:case 48:case 56:a=1+(3&s);break;case 52:case 60:a=5+(3&s);break;case 3:a=8;break;case 2:a=4}if(i+a>t)throw Error("Unexpected: Unfinished message");switch(l){case 12:case 192:null==n?(n=new _pio.message(_pio.binaryserializer.stringFromBytes(e,i,a)),o++):n.addString(_pio.binaryserializer.stringFromBytes(e,i,a));break;case 4:r=_pio.binaryserializer.intFromBytes(e,i,a);case 128:0==o?o=r:n.addInt(r);break;case 16:case 64:n.addByteArray(e.slice(i,i+a));break;case 8:n.addUInt(_pio.binaryserializer.uintFromBytes(e,i,a));break;case 48:case 52:n.addLong(_pio.binaryserializer.longFromBytes(e,i,a));break;case 56:case 60:n.addULong(_pio.binaryserializer.ulongFromBytes(e,i,a));break;case 3:n.addDouble(_pio.binaryserializer.doubleFromBytes(e,i,a));break;case 2:n.addFloat(_pio.binaryserializer.floatFromBytes(e,i,a));break;case 1:n.addBoolean(!0);break;case 0:n.addBoolean(!1)}if(i+=a,null!=n&&0==--o)return n}throw Error("Unexpected: Misaligned message")}},_pio.binaryserializer={pow2:function(e){return 0<=e&&31>e?1<<e:this.pow2[e]||(this.pow2[e]=Math.pow(2,e))},_intEncode:function(e,t){if(4==t)var n=[e>>>24&255,e>>>16&255,e>>>8&255,255&e];else{if(0<=e)var i=e-(n=Math.floor(e/this.pow2(32)))*this.pow2(32);else i=e-(n=Math.floor(e/this.pow2(32)))*this.pow2(32),n+=this.pow2(32);n=[n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i]}return n},_floatEncode:function(e,t,n){var i,o=0>e?1:0,a=~(-1<<n-1),r=1-a;for(0>e&&(e=-e),0===e?e=i=0:isNaN(e)?(i=2*a+1,e=1):1/0===e?(i=2*a+1,e=0):(i=Math.floor(Math.log(e)/Math.LN2))>=r&&i<=a?(e=Math.floor((e*this.pow2(-i)-1)*this.pow2(t)),i+=a):(e=Math.floor(e/this.pow2(r-t)),i=0),a=[];8<=t;)a.push(e%256),e=Math.floor(e/256),t-=8;for(i=i<<t|e,n+=t;8<=n;)a.push(255&i),i>>>=8,n-=8;return a.push(o<<n|i),a.reverse(),a},bytesFromString:function(e){for(var t=[],n=0;n<e.length;n++)if(127>=e.charCodeAt(n))t.push(e.charCodeAt(n));else for(var i=encodeURIComponent(e.charAt(n)).substr(1).split("%"),o=0;o<i.length;o++)t.push(parseInt(i[o],16));return t},bytesFromInt:function(e){return this._intEncode(e,4)},bytesFromUInt:function(e){return this._intEncode(e,4)},bytesFromLong:function(e){return this._intEncode(e,8)},bytesFromULong:function(e){return this._intEncode(e,8)},bytesFromFloat:function(e){return this._floatEncode(e,23,8)},bytesFromDouble:function(e){return this._floatEncode(e,52,11)},_intDecode:function(e,t,n,i,o){var a=t+n-1;t=o&&n==i&&128&e[t],i=0,o=1;for(var r=0;r<n;r++){var s=e[a-r];t&&(o=(s=(255^s)+o)>>8,s&=255),i+=s*this.pow2(8*r)}return t?-i:i},_float32Decode:function(e,t){var n=e.slice(t,t+4).reverse(),i=1-2*(n[3]>>7),o=(n[3]<<1&255|n[2]>>7)-127;return n=(127&n[2])<<16|n[1]<<8|n[0],128===o?0!==n?NaN:1/0*i:-127===o?i*n*this.pow2(-149):i*(1+n*this.pow2(-23))*this.pow2(o)},_float64Decode:function(e,t){var n=e.slice(t,t+8).reverse(),i=1-2*(n[7]>>7),o=((n[7]<<1&255)<<3|n[6]>>4)-1023;return n=(15&n[6])*this.pow2(48)+n[5]*this.pow2(40)+n[4]*this.pow2(32)+n[3]*this.pow2(24)+n[2]*this.pow2(16)+n[1]*this.pow2(8)+n[0],1024===o?0!==n?NaN:1/0*i:-1023===o?i*n*this.pow2(-1074):i*(1+n*this.pow2(-52))*this.pow2(o)},stringFromBytes:function(e,t,n){for(var i="",o=t;o<t+n;o++)i+=127>=e[o]?37===e[o]?"%25":String.fromCharCode(e[o]):"%"+e[o].toString(16).toUpperCase();return decodeURIComponent(i)},intFromBytes:function(e,t,n){return this._intDecode(e,t,n,4,!0)},uintFromBytes:function(e,t,n){return this._intDecode(e,t,n,4,!1)},longFromBytes:function(e,t,n){return this._intDecode(e,t,n,8,!0)},ulongFromBytes:function(e,t,n){return this._intDecode(e,t,n,8,!1)},floatFromBytes:function(e,t,n){return 4==n?this._float32Decode(e,t):NaN},doubleFromBytes:function(e,t,n){return 8==n?this._float64Decode(e,t):NaN}};for(var e=[],t=0;65!=t;t++)e["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(t)]=t;_pio.base64encode=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],o=++n<=e.length?e[n]:NaN,a=++n<=e.length?e[n]:NaN,r=i>>2;i=(3&i)<<4|o>>4;var s=(15&o)<<2|a>>6,l=63&a;isNaN(o)?s=l=64:isNaN(a)&&(l=64),t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r)),t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i)),t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(s)),t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l))}return t.join("")},_pio.base64decode=function(t){for(var n=[],i=0;i<t.length;i++){var o=e[t.charCodeAt(i)],a=++i<t.length?e[t.charCodeAt(i)]:64,r=++i<t.length?e[t.charCodeAt(i)]:64,s=++i<t.length?e[t.charCodeAt(i)]:64,l=(15&a)<<4|r>>2,c=(3&r)<<6|s;n.push(o<<2|a>>4),64!=r&&(n.push(l),64!=s&&n.push(c))}return n}}(),_pio.achievements=function(e){function t(e,t){var n=new _pio.achievement(e.identifier,e.title,e.description,e.imageurl,e.progress,e.progressgoal,e.lastupdated);if("string"!=typeof i.myAchievements)for(var o=0;o<i.myAchievements.length;o++)i.myAchievements[o].id==n.id&&(i.myAchievements[o]=n,i.currentVersion=null);if(t)for(o=0;o<i.onCompleteHandlers.length;o++)(0,i.onCompleteHandlers[o])(n);return n}var n=null;this.myAchievements="[ERROR: You tried to access achievements.myAchievements before loading them. You have to call the refresh method first.]",this.onCompleteHandlers=[];var i=this;this.addOnComplete=function(e){if("function"!=typeof e||1!=e.length)throw new PlayerIOError(PlayerIOErrorCode.InvalidArgument,"Expects argument to be a function that takes an achievement as an argument.");i.onCompleteHandlers.push(e)},this.get=function(e){if("string"==typeof i.myAchievements)return null;for(var t=0;t<i.myAchievements.length;t++)if(i.myAchievements[t].id==e)return i.myAchievements[t];return null},this.refresh=function(t,o){e.achievementsRefresh(n,t,o,(function(e){if(n!=e.version)if(n=e.version,null==e.achievements||0==e.achievements.length)i.myAchievements=[];else{for(var t=[],o=0;o<e.achievements.length;o++){var a=e.achievements[o];t.push(new _pio.achievement(a.identifier,a.title,a.description,a.imageurl,a.progress,a.progressgoal,a.lastupdated))}i.myAchievements=t}}))},this.load=function(t,n,i){"object"==typeof t||requests.length?e.achievementsLoad(t,n,i,(function(e){if(null==e||0==e.length)return{};for(var t={},n=0;n<e.userachievements.length;n++){for(var i=e.userachievements[n],o=[],a=0;a<i.achievements.length;a++){var r=i.achievements[a];o.push(new _pio.achievement(r.identifier,r.title,r.description,r.imageurl,r.progress,r.progressgoal,r.lastupdated))}t[i.userid]=o}return t})):(t=_pio.error("The first argument to load should be an array: client.achievements.load(['user1', 'user2', ...], ...)"),_pio.handleError(t,i,t.code,t.message))},this.progressSet=function(n,i,o,a){e.achievementsProgressSet(n,i,o,a,(function(e){return t(e.achievement,e.completednow)}))},this.progressAdd=function(n,i,o,a){e.achievementsProgressAdd(n,i,o,a,(function(e){return t(e.achievement,e.completednow)}))},this.progressMax=function(n,i,o,a){e.achievementsProgressMax(n,i,o,a,(function(e){return t(e.achievement,e.completednow)}))},this.progressComplete=function(n,i,o){e.achievementsProgressComplete(n,i,o,(function(e){return t(e.achievement,e.completednow)}))}},_pio.achievement=function(e,t,n,i,o,a,r){this.id=e,this.title=t,this.description=n,this.imageUrl=i,this.progress=void 0===o?0:o,this.progressGoal=a,this.lastUpdated=new Date(1e3*r),this.progressRatio=this.progress/this.progressGoal,this.completed=this.progress==this.progressGoal},_pio.playerInsight=function(e){function t(e){n.playersOnline=-1==e.playersonline?"[ERROR: The current connection does not have the rights required to read the playersonline variable.]":e.playersonline,n.segments=_pio.convertFromKVArray(e.segments)}this.playersOnline="[ERROR: You tried to access playerInsight.playersOnline before loading it. You have to call the refresh method first.]",this.segments={};var n=this;this.refresh=function(n,i){e.playerInsightRefresh(n,i,(function(e){t(e.state)}))},this.setSegments=function(n,i,o){e.playerInsightSetSegments(_pio.convertToSegmentArray(n),i,o,(function(e){t(e.state)}))},this.trackInvitedBy=function(t,n,i,o){e.playerInsightTrackInvitedBy(t,n,i,o,(function(e){}))},this.trackEvent=function(t,n,i,o){e.playerInsightTrackEvents([{eventtype:t,value:n}],i,o,(function(e){}))},this.trackExternalPayment=function(t,n,i,o){e.playerInsightTrackExternalPayment(t,n,i,o,(function(e){}))},this.sessionKeepAlive=function(t,n){e.playerInsightSessionKeepAlive(t,n,(function(e){}))}},_pio.leaderboards=function(e,t){this.set=function(t,n,i,o,a){e.leaderboardsSet(t,n,i,o,a,(function(e){return new _pio.leaderboardEntry(e.leaderboardentry.userid,e.leaderboardentry.rank,e.leaderboardentry.score)}))},this.count=function(t,n,i,o){e.leaderboardsCount(t,n,i,o,(function(e){return e.count}))},this.getTop=function(t,n,i,o,a,r,s){e.leaderboardsGet(t,n,i,o,null,a,r,s,(function(e){if(null==e||null==e.leaderboardentry||0==e.leaderboardentry.length)return[];for(var t=[],n=0;n<e.leaderboardentry.length;n++)t.push(new _pio.leaderboardEntry(e.leaderboardentry[n].userid,e.leaderboardentry[n].rank,e.leaderboardentry[n].score));return t}))},this.getNeighbourhood=function(n,i,o,a,r,s,l){e.leaderboardsGet(n,i,o,a,t,r,s,l,(function(e){if(null==e||null==e.leaderboardentry||0==e.leaderboardentry.length)return[];for(var t=[],n=0;n<e.leaderboardentry.length;n++)t.push(new _pio.leaderboardEntry(e.leaderboardentry[n].userid,e.leaderboardentry[n].rank,e.leaderboardentry[n].score));return t}))}},_pio.leaderboardEntry=function(e,t,n){this.userId=e,this.rank=t,this.score=n},_pio.oneScore=function(e){this.percentile="[ERROR: You tried to access oneScore.percentile before loading the OneScore. You have to call the refresh method first.]",this.score="[ERROR: You tried to access oneScore.score before loading the OneScore. You have to call the refresh method first.]",this.topRank="[ERROR: You tried to access oneScore.topRank before loading the OneScore. You have to call the refresh method first.]";var t=this;this.refresh=function(n,i){e.oneScoreRefresh(n,i,(function(e){e=new _pio.oneScoreValue(e.onescore.percentile,e.onescore.score,e.onescore.toprank),t.percentile=e.percentile,t.score=e.score,t.topRank=e.toprank}))},this.set=function(n,i,o){e.oneScoreSet(n,i,o,(function(e){return e=new _pio.oneScoreValue(e.onescore.percentile,e.onescore.score,e.onescore.toprank),t.percentile=e.percentile,t.score=e.score,t.topRank=e.toprank,e}))},this.add=function(n,i,o){e.oneScoreAdd(n,i,o,(function(e){return e=new _pio.oneScoreValue(e.onescore.percentile,e.onescore.score,e.onescore.toprank),t.percentile=e.percentile,t.score=e.score,t.topRank=e.toprank,e}))},this.load=function(t,n,i){"object"==typeof t||requests.length?e.oneScoreLoad(t,n,i,(function(e){if(null==e||null==e.onescores||0==e.onescores.length)return[];for(var n=[],i=0,o=0;o<t.length;o++){var a=e.onescores[i];a&&t[o]==a.userid?(n.push(new _pio.oneScoreValue(a.percentile,a.score,a.toprank)),i++):n.push(null)}return n})):(n=_pio.error("The first argument to load should be an array: client.oneScore.load(['user1', 'user2', ...], ...)"),_pio.handleError(n,i,n.code,n.message))}},_pio.oneScoreValue=function(e,t,n){this.percentile=void 0===e?0:e,this.score=void 0===t?0:t,this.topRank=void 0===n?0:n},_pio.notifications=function(e){function t(e){if(e.version!=o){var t=[];if(e.endpoints)for(var n=0;n!=e.endpoints.length;n++){var a=e.endpoints[n];t[n]=new _pio.notificationEndpoint(a.type,a.identifier,_pio.convertFromKVArray(a.configuration),!!a.enabled)}o=e.version,i.myEndpoints=t}}function n(e){var t=[];if(e&&0<e.length)for(var n=0;n!=e.length;n++){var i=e[n];i.type&&i.identifier&&t.push({type:i.type,identifier:i.identifier})}return t}this.myEndpoints="[ERROR: You tried to access notifications.myEndpoints before calling refresh.]";var i=this,o="";this.refresh=function(n,i){e.notificationsRefresh(o,n,i,t)},this.registerEndpoint=function(n,a,r,s,l,c){var u;e:{if(""!=o)for(u=0;u!=i.myEndpoints.length;u++){var h=i.myEndpoints[u];if(h.type==n&&h.identifier==a){u=h;break e}}u=null}(h=null==u||u.enabled!=s)||(h=JSON.stringify(u.configuration)!=JSON.stringify(r)),h?e.notificationsRegisterEndpoints(o,[{type:n,identifier:a,configuration:_pio.convertToKVArray(r),enabled:s}],l,c,t):l&&l()},this.toggleEndpoints=function(i,a,r,s){0<(i=n(i)).length?e.notificationsToggleEndpoints(o,i,!!a,r,s,t):r&&r()},this.deleteEndpoints=function(i,a,r){0<(i=n(i)).length?e.notificationsDeleteEndpoints(o,i,a,r,t):a&&a()},this.send=function(t,n,i){for(var o=[],a=0;a!=t.length;a++){var r=t[a],s={recipient:r.recipientUserId,endpointtype:r.endpointType,data:{}};for(var l in 0!=(s.recipient+"").length&&s.endpointtype,r)"recipientUserId"!=l&&"endpointType"!=l&&(s.data[l]=r[l]);o[a]=s}0<o.length?e.notificationsSend(o,n,i,null):n&&n()}},_pio.notificationEndpoint=function(e,t,n,i){this.type=e,this.identifier=t,this.configuration=n,this.enabled=i},_pio.publishingNetwork=function(e,t){var n=this;this.profiles=new _pio.publishingNetworkProfiles(e),this.payments=new _pio.publishingNetworkPayments(e),this.relations=new _pio.publishingNetworkRelations(e,t,this),this.userToken="[ERROR: you tried to access publishingNetwork.userToken before calling publishingNetwork.refresh(callback)]",this.refresh=function(t,i){e.socialRefresh(t,i,(function(e){n.userToken=e.myprofile.usertoken,n.profiles.myProfile=new _pio.publishingNetworkProfile(e.myprofile),void 0===_pio.friendLookup&&(_pio.friendLookup={},_pio.blockedLookup={});var t=_pio.friendLookup[n.profiles.myProfile.userId],i=_pio.blockedLookup[n.profiles.myProfile.userId];t||i||(t=_pio.friendLookup[n.profiles.myProfile.userId]={},i=_pio.blockedLookup[n.profiles.myProfile.userId]={}),n.relations.friends=[];for(var o=0;o!=e.friends.length;o++){var a=new _pio.publishingNetworkProfile(e.friends[o]);n.relations.friends.push(a),t[a.userId]=!0}for(o=0;o!=e.blocked.length;o++)i[e.blocked[o]]=!0}))}},_pio.showDialog=function(e,t,n,i){if(void 0===window.PublishingNetwork)throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotAvailable,"PublishingNetwork.js was not found on the current page. You have to include the 'piocdn.com/publishingnetwork.js' on the containing page to show dialogs. See http://playerio.com/documentation/ for more information.");n.__apitoken__=t.token,window.PublishingNetwork.dialog(e,n,i)},_pio.publishingNetworkPayments=function(e){this.showBuyCoinsDialog=function(t,n,i,o){n||(n={}),n.coinamount=t,e.payVaultPaymentInfo("publishingnetwork",_pio.convertToKVArray(n),null,(function(t){_pio.showDialog("buy",e,t,(function(e){e.error?o(new PlayerIOError(PlayerIOErrorCode.GeneralError,e.error)):i(e)}))}),o,(function(e){return _pio.convertFromKVArray(e.providerarguments)}))},this.showBuyItemsDialog=function(t,n,i,o){e.payVaultPaymentInfo("publishingnetwork",_pio.convertToKVArray(n||{}),_pio.convertBuyItems(t),(function(t){_pio.showDialog("buy",e,t,(function(e){e.error?o(new PlayerIOError(PlayerIOErrorCode.GeneralError,e.error)):i(e)}))}),o,(function(e){return _pio.convertFromKVArray(e.providerarguments)}))}},_pio.publishingNetworkProfiles=function(e){this.myProfile="[ERROR: you tried to access publishingNetworkProfiles.myProfile before calling publishingNetwork.refresh(callback)]",this.showProfile=function(t,n){_pio.showDialog("profile",e,{userId:t},n)},this.loadProfiles=function(t,n,i){e.socialLoadProfiles(t,n,i,(function(e){for(var n=[],i=0;i!=t.length;i++){var o=t[i];n[i]=null;for(var a=0;a!=e.profiles.length;a++){var r=e.profiles[a];if(r&&r.userid==o){n[i]=new _pio.publishingNetworkProfile(e.profiles[a]);break}}}return n}))}},_pio.publishingNetworkProfile=function(e){this.userId=e.userid,this.displayName=e.displayname,this.avatarUrl=e.avatarurl,this.lastOnline=new Date(e.lastonline),this.countryCode=e.countrycode},_pio.publishingNetworkRelations=function(e,t,n){this.friends="[ERROR: you tried to access publishingNetworkRelations.friends before calling publishingNetwork.refresh(callback)]",this.isFriend=function(e){if(void 0!==_pio.friendLookup&&void 0!==_pio.friendLookup[t])return _pio.friendLookup[t][e]||!1;throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotLoaded,"Cannot access profile, friends, ignored before Publishing Network has been loaded. Please refresh Publishing Network first")},this.isBlocked=function(e){if(void 0!==_pio.blockedLookup&&void 0!==_pio.blockedLookup[t])return _pio.blockedLookup[t][e]||!1;throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotLoaded,"Cannot access profile, friends, ignored before Publishing Network has been loaded. Please refresh Publishing Network first")},this.showRequestFriendshipDialog=function(t,n){_pio.showDialog("requestfriendship",e,{userId:t},n)},this.showRequestBlockUserDialog=function(t,i){_pio.showDialog("requestblockuser",e,{userId:t},(function(){n.refresh((function(){i&&i()}),(function(){i&&i()}))}))},this.showFriendsManager=function(t){_pio.showDialog("friendsmanager",e,{},(function(e){e.updated?n.refresh((function(){t&&t()}),(function(){t&&t()})):t&&t()}))},this.showBlockedUsersManager=function(t){_pio.showDialog("blockedusersmanager",e,{},(function(e){e.updated?n.refresh((function(){t&&t()}),(function(){t&&t()})):t&&t()}))}},function(){function e(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function t(t){return t=String(t).replace(/^ +| +$/g,""),/^(?:webOS|i(?:OS|P))/.test(t)?t:e(t)}function n(e,t){for(var n in e)d.call(e,n)&&t(e[n],n,e)}function i(t){return null==t?e(t):_.call(t).slice(8,-1)}function o(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function a(e,t){var i=null;return function(e,t){var i=-1,o=e?e.length:0;if("number"==typeof o&&-1<o&&o<=u)for(;++i<o;)t(e[i],i,e);else n(e,t)}(e,(function(n,o){i=t(i,n,o,e)})),i}var r={function:!0,object:!0},s=r[typeof window]&&window||this,l=r[typeof exports]&&exports;r=r[typeof module]&&module&&!module.nodeType&&module;var c=l&&r&&"object"==typeof global&&global;!c||c.global!==c&&c.window!==c&&c.self!==c||(s=c);var u=Math.pow(2,53)-1,h=/\bOpera/,d=(c=Object.prototype).hasOwnProperty,_=c.toString,p=function e(r){function l(e){return a(e,(function(e,n){var i=n.pattern||o(n);return!e&&(e=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(r)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(r)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(r))&&((e=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=t(e[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}var c=s,u=r&&"object"==typeof r&&"String"!=i(r);u&&(c=r,r=null);var d=c.navigator||{},p=d.userAgent||"";r||(r=p);var f=u?!!d.likeChrome:/\bChrome\b/.test(r)&&!/internal|\n/i.test(_.toString()),g=u?"Object":"ScriptBridgingProxyObject",m=u?"Object":"Environment",C=u&&c.java?"JavaPackage":i(c.java),y=u?"Object":"RuntimeObject";m=(C=/\bJava/.test(C)&&c.java)&&i(c.environment)==m;var S,b=C?"a":"",T=C?"b":"",E=c.document||{},v=c.operamini||c.opera,w=h.test(w=u&&v?v["[[Class]]"]:i(v))?w:v=null,O=r;u=[];var A=null,N=r==p;p=N&&v&&"function"==typeof v.version&&v.version();var M=a([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,t){return e||RegExp("\\b"+(t.pattern||o(t))+"\\b","i").exec(r)&&(t.label||t)})),I=a(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],(function(e,t){return e||RegExp("\\b"+(t.pattern||o(t))+"\\b","i").exec(r)&&(t.label||t)})),R=l([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),P=a({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},(function(e,t,n){return e||(t[R]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(R)]||RegExp("\\b"+o(n)+"(?:\\b|\\w*\\d)","i").exec(r))&&n})),k=a(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],(function(e,n){var i=n.pattern||o(n);if(!e&&(e=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(r))){var a=e,s=n.label||n,l={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};i&&s&&/^Win/i.test(a)&&!/^Windows Phone /i.test(a)&&(l=l[/[\d.]+$/.exec(a)])&&(a="Windows "+l),a=String(a),i&&s&&(a=a.replace(RegExp(i,"i"),s)),e=a=t(a.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return e}));if(M&&(M=[M]),P&&!R&&(R=l([P])),(S=/\bGoogle TV\b/.exec(R))&&(R=S[0]),/\bSimulator\b/i.test(r)&&(R=(R?R+" ":"")+"Simulator"),"Opera Mini"==I&&/\bOPiOS\b/.test(r)&&u.push("running in Turbo/Uncompressed mode"),"IE"==I&&/\blike iPhone OS\b/.test(r)?(P=(S=e(r.replace(/like iPhone OS/,""))).manufacturer,R=S.product):/^iP/.test(R)?(I||(I="Safari"),k="iOS"+((S=/ OS ([\d_]+)/i.exec(r))?" "+S[1].replace(/_/g,"."):"")):"Konqueror"!=I||/buntu/i.test(k)?P&&"Google"!=P&&(/Chrome/.test(I)&&!/\bMobile Safari\b/i.test(r)||/\bVita\b/.test(R))||/\bAndroid\b/.test(k)&&/^Chrome/.test(I)&&/\bVersion\//i.test(r)?(I="Android Browser",k=/\bAndroid\b/.test(k)?k:"Android"):"Silk"==I?(/\bMobi/i.test(r)||(k="Android",u.unshift("desktop mode")),/Accelerated *= *true/i.test(r)&&u.unshift("accelerated")):"PaleMoon"==I&&(S=/\bFirefox\/([\d.]+)\b/.exec(r))?u.push("identifying as Firefox "+S[1]):"Firefox"==I&&(S=/\b(Mobile|Tablet|TV)\b/i.exec(r))?(k||(k="Firefox OS"),R||(R=S[1])):!I||(S=!/\bMinefield\b/i.test(r)&&/\b(?:Firefox|Safari)\b/.exec(I))?(I&&!R&&/[\/,]|^[^(]+?\)/.test(r.slice(r.indexOf(S+"/")+8))&&(I=null),(S=R||P||k)&&(R||P||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(k))&&(I=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(k)?k:S)+" Browser")):"Electron"==I&&(S=(/\bChrome\/([\d.]+)\b/.exec(r)||0)[1])&&u.push("Chromium "+S):k="Kubuntu",p||(p=a(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",o(I),"(?:Firefox|Minefield|NetFront)"],(function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(r)||0)[1]||null}))),(S=("iCab"==M&&3<parseFloat(p)?"WebKit":/\bOpera\b/.test(I)&&(/\bOPR\b/.test(r)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(r)&&!/^(?:Trident|EdgeHTML)$/.test(M)&&"WebKit"||!M&&/\bMSIE\b/i.test(r)&&("Mac OS"==k?"Tasman":"Trident")||"WebKit"==M&&/\bPlayStation\b(?! Vita\b)/i.test(I)&&"NetFront")&&(M=[S]),"IE"==I&&(S=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(r)||0)[1])?(I+=" Mobile",k="Windows Phone "+(/\+$/.test(S)?S:S+".x"),u.unshift("desktop mode")):/\bWPDesktop\b/i.test(r)?(I="IE Mobile",k="Windows Phone 8.x",u.unshift("desktop mode"),p||(p=(/\brv:([\d.]+)/.exec(r)||0)[1])):"IE"!=I&&"Trident"==M&&(S=/\brv:([\d.]+)/.exec(r))&&(I&&u.push("identifying as "+I+(p?" "+p:"")),I="IE",p=S[1]),N){if(function(e,t){var n=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}(c,"global"))if(C&&(O=(S=C.lang.System).getProperty("os.arch"),k=k||S.getProperty("os.name")+" "+S.getProperty("os.version")),m){try{p=c.require("ringo/engine").version.join("."),I="RingoJS"}catch(e){(S=c.system)&&S.global.system==c.system&&(I="Narwhal",k||(k=S[0].os||null))}I||(I="Rhino")}else"object"==typeof c.process&&!c.process.browser&&(S=c.process)&&("object"==typeof S.versions&&("string"==typeof S.versions.electron?(u.push("Node "+S.versions.node),I="Electron",p=S.versions.electron):"string"==typeof S.versions.nw&&(u.push("Chromium "+p,"Node "+S.versions.node),I="NW.js",p=S.versions.nw)),I||(I="Node.js",O=S.arch,k=S.platform,p=(p=/[\d.]+/.exec(S.version))?p[0]:null));else i(S=c.runtime)==g?(I="Adobe AIR",k=S.flash.system.Capabilities.os):i(S=c.phantom)==y?(I="PhantomJS",p=(S=S.version||null)&&S.major+"."+S.minor+"."+S.patch):"number"==typeof E.documentMode&&(S=/\bTrident\/(\d+)/i.exec(r))?(p=[p,E.documentMode],(S=+S[1]+4)!=p[1]&&(u.push("IE "+p[1]+" mode"),M&&(M[1]=""),p[1]=S),p="IE"==I?String(p[1].toFixed(1)):p[0]):"number"==typeof E.documentMode&&/^(?:Chrome|Firefox)\b/.test(I)&&(u.push("masking as "+I+" "+p),I="IE",p="11.0",M=["Trident"],k="Windows");k=k&&t(k)}if(p&&(S=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(p)||/(?:alpha|beta)(?: ?\d)?/i.exec(r+";"+(N&&d.appMinorVersion))||/\bMinefield\b/i.test(r)&&"a")&&(A=/b/i.test(S)?"beta":"alpha",p=p.replace(RegExp(S+"\\+?$"),"")+("beta"==A?T:b)+(/\d+\+?/.exec(S)||"")),"Fennec"==I||"Firefox"==I&&/\b(?:Android|Firefox OS)\b/.test(k))I="Firefox Mobile";else if("Maxthon"==I&&p)p=p.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(R))"Xbox 360"==R&&(k=null),"Xbox 360"==R&&/\bIEMobile\b/.test(r)&&u.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(I)&&(!I||R||/Browser|Mobi/.test(I))||"Windows CE"!=k&&!/Mobi/i.test(r))if("IE"==I&&N)try{null===c.external&&u.unshift("platform preview")}catch(e){u.unshift("embedded")}else(/\bBlackBerry\b/.test(R)||/\bBB10\b/.test(r))&&(S=(RegExp(R.replace(/ +/g," *")+"/([.\\d]+)","i").exec(r)||0)[1]||p)?(k=((S=[S,/BB10/.test(r)])[1]?(R=null,P="BlackBerry"):"Device Software")+" "+S[0],p=null):this!=n&&"Wii"!=R&&(N&&v||/Opera/.test(I)&&/\b(?:MSIE|Firefox)\b/i.test(r)||"Firefox"==I&&/\bOS X (?:\d+\.){2,}/.test(k)||"IE"==I&&(k&&!/^Win/.test(k)&&5.5<p||/\bWindows XP\b/.test(k)&&8<p||8==p&&!/\bTrident\b/.test(r)))&&!h.test(S=e.call(n,r.replace(h,"")+";"))&&S.name&&(S="ing as "+S.name+((S=S.version)?" "+S:""),h.test(I)?(/\bIE\b/.test(S)&&"Mac OS"==k&&(k=null),S="identify"+S):(S="mask"+S,I=w?t(w.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(S)&&(k=null),N||(p=null)),M=["Presto"],u.push(S));else I+=" Mobile";if((S=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(r)||0)[1])&&(S=[parseFloat(S.replace(/\.(\d)$/,".0$1")),S],"Safari"==I&&"+"==S[1].slice(-1)?(I="WebKit Nightly",A="alpha",p=S[1].slice(0,-1)):p!=S[1]&&p!=(S[2]=(/\bSafari\/([\d.]+\+?)/i.exec(r)||0)[1])||(p=null),S[1]=(/\bChrome\/([\d.]+)/i.exec(r)||0)[1],537.36==S[0]&&537.36==S[2]&&28<=parseFloat(S[1])&&"WebKit"==M&&(M=["Blink"]),N&&(f||S[1])?(M&&(M[1]="like Chrome"),S=S[1]||(530>(S=S[0])?1:532>S?2:532.05>S?3:533>S?4:534.03>S?5:534.07>S?6:534.1>S?7:534.13>S?8:534.16>S?9:534.24>S?10:534.3>S?11:535.01>S?12:535.02>S?"13+":535.07>S?15:535.11>S?16:535.19>S?17:536.05>S?18:536.1>S?19:537.01>S?20:537.11>S?"21+":537.13>S?23:537.18>S?24:537.24>S?25:537.36>S?26:"Blink"!=M?"27":"28")):(M&&(M[1]="like Safari"),S=400>(S=S[0])?1:500>S?2:526>S?3:533>S?4:534>S?"4+":535>S?5:537>S?6:538>S?7:601>S?8:"8"),M&&(M[1]+=" "+(S+="number"==typeof S?".x":/[.+]/.test(S)?"":"+")),"Safari"==I&&(!p||45<parseInt(p))&&(p=S)),"Opera"==I&&(S=/\bzbov|zvav$/.exec(k))?(I+=" ",u.unshift("desktop mode"),"zvav"==S?(I+="Mini",p=null):I+="Mobile",k=k.replace(RegExp(" *"+S+"$"),"")):"Safari"==I&&/\bChrome\b/.exec(M&&M[1])&&(u.unshift("desktop mode"),I="Chrome Mobile",p=null,/\bOS X\b/.test(k)?(P="Apple",k="iOS 4.3+"):k=null),p&&0==p.indexOf(S=/[\d.]+$/.exec(k))&&-1<r.indexOf("/"+S+"-")&&(k=String(k.replace(S,"")).replace(/^ +| +$/g,"")),M&&!/\b(?:Avant|Nook)\b/.test(I)&&(/Browser|Lunascape|Maxthon/.test(I)||"Safari"!=I&&/^iOS/.test(k)&&/\bSafari\b/.test(M[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(I)&&M[1])&&(S=M[M.length-1])&&u.push(S),u.length&&(u=["("+u.join("; ")+")"]),P&&R&&0>R.indexOf(P)&&u.push("on "+P),R&&u.push((/^on /.test(u[u.length-1])?"":"on ")+R),k){var L=(S=/ ([\d.+]+)$/.exec(k))&&"/"==k.charAt(k.length-S[0].length-1);k={architecture:32,family:S&&!L?k.replace(S[0],""):k,version:S?S[1]:null,toString:function(){var e=this.version;return this.family+(e&&!L?" "+e:"")+(64==this.architecture?" 64-bit":"")}}}return(S=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(O))&&!/\bi686\b/i.test(O)?(k&&(k.architecture=64,k.family=k.family.replace(RegExp(" *"+S),"")),I&&(/\bWOW64\b/i.test(r)||N&&/\w(?:86|32)$/.test(d.cpuClass||d.platform)&&!/\bWin64; x64\b/i.test(r))&&u.unshift("32-bit")):k&&/^OS X/.test(k.family)&&"Chrome"==I&&39<=parseFloat(p)&&(k.architecture=64),r||(r=null),(c={}).description=r,c.layout=M&&M[0],c.manufacturer=P,c.name=I,c.prerelease=A,c.product=R,c.ua=r,c.version=I&&p,c.os=k||{architecture:null,family:null,version:null,toString:function(){return"null"}},c.parse=e,c.toString=function(){return this.description||""},c.version&&u.unshift(p),c.name&&u.unshift(I),k&&I&&(k!=String(k).split(" ")[0]||k!=I.split(" ")[0]&&!R)&&u.push(R?"("+k+")":"on "+k),u.length&&(c.description=u.join(" ")),c}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(s.platform=p,define((function(){return p}))):l&&r?n(p,(function(e,t){l[t]=e})):s.platform=p}.call(this),$(document).ready((function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())})),jQuery(window).resize((function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&iosResize()})),function(){var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},t="undefined"!=typeof module&&module.exports,n=function(){for(var t,n=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],i=0,o=n.length,a={};i<o;i++)if((t=n[i])&&t[1]in e){for(i=0;i<t.length;i++)a[n[0][i]]=t[i];return a}return!1}(),i={change:n.fullscreenchange,error:n.fullscreenerror},o={request:function(t){return new Promise(function(i,o){var a=function(){this.off("change",a),i()}.bind(this);this.on("change",a),t=t||e.documentElement,Promise.resolve(t[n.requestFullscreen]()).catch(o)}.bind(this))},exit:function(){return new Promise(function(t,i){if(this.isFullscreen){var o=function(){this.off("change",o),t()}.bind(this);this.on("change",o),Promise.resolve(e[n.exitFullscreen]()).catch(i)}else t()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(t,n){var o=i[t];o&&e.addEventListener(o,n,!1)},off:function(t,n){var o=i[t];o&&e.removeEventListener(o,n,!1)},raw:n};n?(Object.defineProperties(o,{isFullscreen:{get:function(){return!!e[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return e[n.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!e[n.fullscreenEnabled]}}}),t?module.exports=o:window.screenfull=o):t?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}();var s_iScaleFactor=1,s_bIsIphone=!1,s_iOffsetX,s_iOffsetY,s_bFocus=!0;function trace(e){}function getSize(e){var t=e.toLowerCase(),n=window.document,i=n.documentElement;if(void 0===window["inner"+e])e=i["client"+e];else if(window["inner"+e]!=i["client"+e]){var o=n.createElement("body");o.id="vpw-test-b",o.style.cssText="overflow:scroll";var a=n.createElement("div");a.id="vpw-test-d",a.style.cssText="position:absolute;top:-1000px",a.innerHTML="<style>@media("+t+":"+i["client"+e]+"px){body#vpw-test-b div#vpw-test-d{"+t+":7px!important}}</style>",o.appendChild(a),i.insertBefore(o,n.head),e=7==a["offset"+e]?i["client"+e]:window["inner"+e],i.removeChild(o)}else e=window["inner"+e];return e}function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler(),window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function isMobile(){return!!isIpad()||jQuery.browser.mobile}function isIpad(){var e=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!!(!e&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints)||e}function isIOS(){for(var e="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");e.length;)if(navigator.platform===e.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var e=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<e?e:0}function sizeHandler(){if(window.scrollTo(0,1),$("#canvas")){var e=null!==platform.name&&"safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height"),t=getSize("Width");s_bFocus&&_checkOrientation(t,e);var n=Math.min(e/CANVAS_HEIGHT,t/CANVAS_WIDTH),i=Math.round(CANVAS_WIDTH*n);if((n=Math.round(CANVAS_HEIGHT*n))<e){var o=e-n;n+=o,i+=CANVAS_WIDTH/CANVAS_HEIGHT*o}else i<t&&(i+=o=t-i,n+=CANVAS_HEIGHT/CANVAS_WIDTH*o);o=e/2-n/2;var a=t/2-i/2,r=CANVAS_WIDTH/i;(a*r<-EDGEBOARD_X||o*r<-EDGEBOARD_Y)&&(n=Math.min(e/(CANVAS_HEIGHT-2*EDGEBOARD_Y),t/(CANVAS_WIDTH-2*EDGEBOARD_X)),i=Math.round(CANVAS_WIDTH*n),o=(e-(n=Math.round(CANVAS_HEIGHT*n)))/2,a=(t-i)/2,r=CANVAS_WIDTH/i),s_iOffsetX=-1*a*r,s_iOffsetY=-1*o*r,0<=o&&(s_iOffsetY=0),0<=a&&(s_iOffsetX=0),null!==s_oInterface&&s_oInterface.refreshButtonPos(),null!==s_oMenu&&s_oMenu.refreshButtonPos(),null!==s_oSelectPlayers&&s_oSelectPlayers.refreshButtonPos(),s_bIsIphone?(canvas=document.getElementById("canvas"),s_oStage.canvas.width=2*i,s_oStage.canvas.height=2*n,canvas.style.width=i+"px",canvas.style.height=n+"px",s_oStage.scaleX=s_oStage.scaleY=2*Math.min(i/CANVAS_WIDTH,n/CANVAS_HEIGHT)):s_bMobile||isChrome()?($("#canvas").css("width",i+"px"),$("#canvas").css("height",n+"px")):(s_oStage.canvas.width=i,s_oStage.canvas.height=n,s_iScaleFactor=Math.min(i/CANVAS_WIDTH,n/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor),0>o||(o=(e-n)/2),$("#canvas").css("top",o+"px"),$("#canvas").css("left",a+"px"),fullscreenHandler()}}function _checkOrientation(e,t){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(e>t?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()))}function playSound(e,t,n){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[e].play(),s_aSounds[e].volume(t),s_aSounds[e].loop(n),s_aSounds[e]):null}function stopSound(e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].stop()}function setVolume(e,t){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].volume(t)}function setMute(e,t){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].mute(t)}function createBitmap(e,t,n){var i=new createjs.Bitmap(e),o=new createjs.Shape;return t&&n?o.graphics.beginFill("#fff").drawRect(0,0,t,n):o.graphics.beginFill("#ff0").drawRect(0,0,e.width,e.height),i.hitArea=o,i}function createSprite(e,t,n,i,o,a){return e=null!==t?new createjs.Sprite(e,t):new createjs.Sprite(e),(t=new createjs.Shape).graphics.beginFill("#000000").drawRect(-n,-i,o,a),e.hitArea=t,e}function pad(e,t,n){return(e+="").length>=t?e:Array(t-e.length+1).join(n||"0")+e}function randomFloatBetween(e,t,n){return void 0===n&&(n=2),parseFloat(Math.min(e+Math.random()*(t-e),t).toFixed(n))}function rotateVector2D(e,t){var n=t.getX()*Math.cos(e)+t.getY()*Math.sin(e),i=t.getX()*-Math.sin(e)+t.getY()*Math.cos(e);t.set(n,i)}function tweenVectorsOnX(e,t,n){return e+n*(t-e)}function shuffle(e){for(var t,n,i=e.length;0!==i;)n=Math.floor(Math.random()*i),t=e[--i],e[i]=e[n],e[n]=t;return e}function bubbleSort(e){do{for(var t=!1,n=0;n<e.length-1;n++)e[n]>e[n+1]&&(t=e[n],e[n]=e[n+1],e[n+1]=t,t=!0)}while(t)}function compare(e,t){return e.index>t.index?-1:e.index<t.index?1:0}function easeLinear(e,t,n,i){return n*e/i+t}function easeInQuad(e,t,n,i){return n*(e/=i)*e+t}function easeInSine(e,t,n,i){return-n*Math.cos(e/i*(Math.PI/2))+n+t}function easeInCubic(e,t,n,i){return n*(e/=i)*e*e+t}function getTrajectoryPoint(e,t){var n=new createjs.Point,i=(1-e)*(1-e),o=e*e;return n.x=i*t.start.x+2*(1-e)*e*t.traj.x+o*t.end.x,n.y=i*t.start.y+2*(1-e)*e*t.traj.y+o*t.end.y,n}function formatTime(e){e/=1e3;var t=Math.floor(e/60),n="";return n=10>t?n+"0"+t+":":n+(t+":"),10>(e=parseFloat(e-60*t).toFixed(1))?n+"0"+e:n+e}function degreesToRadians(e){return e*Math.PI/180}function checkRectCollision(e,t){return calculateIntersection(getBounds(e,.9),getBounds(t,.98))}function calculateIntersection(e,t){var n,i,o,a,r=e.x+(n=e.width/2),s=e.y+(i=e.height/2),l=t.x+(o=t.width/2),c=t.y+(a=t.height/2);return r=Math.abs(r-l)-(n+o),s=Math.abs(s-c)-(i+a),0>r&&0>s?(r=Math.min(Math.min(e.width,t.width),-r),s=Math.min(Math.min(e.height,t.height),-s),{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y),width:r,height:s,rect1:e,rect2:t}):null}function getBounds(e,t){var n={x:1/0,y:1/0,width:0,height:0};if(e instanceof createjs.Container){n.x2=-1/0,n.y2=-1/0;var i,o=e.children,a=o.length;for(i=0;i<a;i++){var r=getBounds(o[i],1);r.x<n.x&&(n.x=r.x),r.y<n.y&&(n.y=r.y),r.x+r.width>n.x2&&(n.x2=r.x+r.width),r.y+r.height>n.y2&&(n.y2=r.y+r.height)}1/0==n.x&&(n.x=0),1/0==n.y&&(n.y=0),1/0==n.x2&&(n.x2=0),1/0==n.y2&&(n.y2=0),n.width=n.x2-n.x,n.height=n.y2-n.y,delete n.x2,delete n.y2}else{if(e instanceof createjs.Bitmap){i=(a=e.sourceRect||e.image).width*t;var s=a.height*t}else if(e instanceof createjs.Sprite)if(e.spriteSheet._frames&&e.spriteSheet._frames[e.currentFrame]&&e.spriteSheet._frames[e.currentFrame].image){i=(a=e.spriteSheet.getFrame(e.currentFrame)).rect.width,s=a.rect.height,o=a.regX;var l=a.regY}else n.x=e.x||0,n.y=e.y||0;else n.x=e.x||0,n.y=e.y||0;o=o||0,i=i||0,l=l||0,s=s||0,n.regX=o,n.regY=l,a=e.localToGlobal(0-o,0-l),r=e.localToGlobal(i-o,s-l),i=e.localToGlobal(i-o,0-l),o=e.localToGlobal(0-o,s-l),n.x=Math.min(Math.min(Math.min(a.x,r.x),i.x),o.x),n.y=Math.min(Math.min(Math.min(a.y,r.y),i.y),o.y),n.width=Math.max(Math.max(Math.max(a.x,r.x),i.x),o.x)-n.x,n.height=Math.max(Math.max(Math.max(a.y,r.y),i.y),o.y)-n.y}return n}function NoClickDelay(e){this.element=e,window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(e){for(var t,n,i=e.length;0<i;)n=Math.floor(Math.random()*i),t=e[--i],e[i]=e[n],e[n]=t;return e}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var i=t[n].split("=");if(i[0]==e)return i[1]}}function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oSelectPlayers&&s_oSelectPlayers.resetFullscreenBut())}!function(e){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),$(window).resize((function(){sizeHandler()})),window.addEventListener("orientationchange",onOrientationChange),NoClickDelay.prototype={handleEvent:function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onTouchEnd(e)}},onTouchStart:function(e){e.preventDefault(),this.moved=!1,this.element.addEventListener("touchmove",this,!1),this.element.addEventListener("touchend",this,!1)},onTouchMove:function(e){this.moved=!0},onTouchEnd:function(e){if(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1),!this.moved){3==(e=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)).nodeType&&(e=e.parentNode);var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e.dispatchEvent(t)}}},function(){function e(e){var n={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};(e=e||window.event).type in n?document.body.className=n[e.type]:(document.body.className=this[t]?"hidden":"visible","hidden"===document.body.className?(s_oMain.stopUpdate(),s_bFocus=!1):(s_oMain.startUpdate(),s_bFocus=!0))}var t="hidden";t in document?document.addEventListener("visibilitychange",e):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(t="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e}(),screenfull.isEnabled&&screenfull.on("change",(function(){s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oSelectPlayers&&s_oSelectPlayers.resetFullscreenBut()}));var s_szGameID="f2520bae00624e93a4f4614732fa259e";window.GD_OPTIONS={gameId:s_szGameID,onEvent:function(e){switch(e.name){case"SDK_READY":s_bMobile||($("#div_display_id").css("display","block"),"undefined"!=typeof gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd(gdsdk.AdType.Display,{containerId:"div_display_id"}).then((function(){})).catch((function(e){})));break;case"SDK_GAME_START":s_bAdShown=!1,s_oMain&&s_oMain.startUpdate();break;case"SDK_GAME_PAUSE":s_bAdShown=!0,s_oMain&&s_oMain.stopUpdate()}}},function(e,t,n){var i=e.getElementsByTagName(t)[0];e.getElementById(n)||((e=e.createElement(t)).id=n,e.src="main.min.js",i.parentNode.insertBefore(e,i))}(document,"script","gamedistribution-jssdk");var s_bAdShown=!1;function CSpriteLibrary(){var e,t,n,i,o,a,r={};this.init=function(r,s,l){e={},n=t=0,i=r,o=s,a=l},this.addSprite=function(n,i){if(!r.hasOwnProperty(n)){var o=new Image;r[n]=e[n]={szPath:i,oSprite:o,bLoaded:!1},t++}},this.getSprite=function(e){return r.hasOwnProperty(e)?r[e].oSprite:null},this._onSpritesLoaded=function(){t=0,o.call(a)},this._onSpriteLoaded=function(){i.call(a),++n===t&&this._onSpritesLoaded()},this.loadSprites=function(){for(var t in e)e[t].oSprite.oSpriteLibrary=this,e[t].oSprite.szKey=t,e[t].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey),this.oSpriteLibrary._onSpriteLoaded(this.szKey)},e[t].oSprite.onerror=function(t){var n=t.currentTarget;setTimeout((function(){e[n.szKey].oSprite.src=e[n.szKey].szPath}),500)},e[t].oSprite.src=e[t].szPath},this.setLoaded=function(e){r[e].bLoaded=!0},this.isLoaded=function(e){return r[e].bLoaded},this.getNumSprites=function(){return t}}function CTextButton(e,t,n,i,o,a,r,s){var l,c,u,h,d,_,p,f,g,m,C,y;return this._init=function(e,t,n,i,o,a,r,s){l=!1,h=[],d=[],y=createBitmap(n),c=n.width,u=n.height;var _=Math.ceil(r/20),p=(m=new createjs.Text(i,r+"px "+o,"#000000")).getBounds();m.textAlign="center",m.lineWidth=.9*c,m.textBaseline="alphabetic",m.x=n.width/2+_,m.y=Math.floor(n.height/2)+p.height/3+_,(C=new createjs.Text(i,r+"px "+o,a)).textAlign="center",C.textBaseline="alphabetic",C.lineWidth=.9*c,C.x=n.width/2,C.y=Math.floor(n.height/2)+p.height/3,(g=new createjs.Container).x=e,g.y=t,g.regX=n.width/2,g.regY=n.height/2,s_bMobile||(g.cursor="pointer"),g.addChild(y,m,C),!1!==s&&s_oStage.addChild(g),this._initListener()},this.unload=function(){g.off("mousedown",p),g.off("pressup",f),s_oStage.removeChild(g)},this.setVisible=function(e){g.visible=e},this.setAlign=function(e){C.textAlign=e,m.textAlign=e},this.enable=function(){l=!1,y.filters=[],y.cache(0,0,c,u)},this.disable=function(){l=!0;var e=(new createjs.ColorMatrix).adjustSaturation(-100).adjustBrightness(40);y.filters=[new createjs.ColorMatrixFilter(e)],y.cache(0,0,c,u)},this._initListener=function(){p=g.on("mousedown",this.buttonDown),f=g.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,n){h[e]=t,d[e]=n},this.addEventListenerWithParams=function(e,t,n,i){h[e]=t,d[e]=n,_=i},this.buttonRelease=function(){l||(playSound("click",1,!1),g.scaleX=1,g.scaleY=1,h[ON_MOUSE_UP]&&h[ON_MOUSE_UP].call(d[ON_MOUSE_UP],_))},this.buttonDown=function(){l||(g.scaleX=.9,g.scaleY=.9,h[ON_MOUSE_DOWN]&&h[ON_MOUSE_DOWN].call(d[ON_MOUSE_DOWN]))},this.setPosition=function(e,t){g.x=e,g.y=t},this.changeText=function(e){C.text=e,m.text=e},this.setX=function(e){g.x=e},this.setY=function(e){g.y=e},this.getButtonImage=function(){return g},this.getX=function(){return g.x},this.getY=function(){return g.y},this.getSprite=function(){return g},this._init(e,t,n,i,o,a,r,s),this}function CToggle(e,t,n,i,o){var a,r,s,l,c,u;this._init=function(e,t,n,i,o){r=[],s=[];var l=new createjs.SpriteSheet({images:[n],frames:{width:n.width/2,height:n.height,regX:n.width/2/2,regY:n.height/2},animations:{state_true:[0],state_false:[1]}});(u=createSprite(l,"state_"+(a=i),n.width/2/2,n.height/2,n.width/2,n.height)).x=e,u.y=t,u.stop(),u.cursor="pointer",o.addChild(u),this._initListener()},this.unload=function(){u.off("mousedown",l),u.off("pressup",c),o.removeChild(u)},this._initListener=function(){l=u.on("mousedown",this.buttonDown),c=u.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,n){r[e]=t,s[e]=n},this.setActive=function(e){a=e,u.gotoAndStop("state_"+a)},this.buttonRelease=function(){u.scaleX=1,u.scaleY=1,playSound("click",1,!1),a=!a,u.gotoAndStop("state_"+a),r[ON_MOUSE_UP]&&r[ON_MOUSE_UP].call(s[ON_MOUSE_UP],a)},this.buttonDown=function(){u.scaleX=.9,u.scaleY=.9,r[ON_MOUSE_DOWN]&&r[ON_MOUSE_DOWN].call(s[ON_MOUSE_DOWN])},this.setPosition=function(e,t){u.x=e,u.y=t},this._init(e,t,n,i,o)}function CGfxButton(e,t,n,i){var o,a,r,s,l,c,u;this._init=function(e,t,n,i){o=!1,a=1,r=[],s=[],(u=createBitmap(n)).x=e,u.y=t,u.scaleX=u.scaleY=a,u.regX=n.width/2,u.regY=n.height/2,u.cursor="pointer",i.addChild(u),this._initListener()},this.unload=function(){u.off("mousedown",l),u.off("pressup",c),i.removeChild(u)},this.setVisible=function(e){u.visible=e},this.setClickable=function(e){o=!e},this._initListener=function(){l=u.on("mousedown",this.buttonDown),c=u.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,n){r[e]=t,s[e]=n},this.buttonRelease=function(){o||(u.scaleX=a,u.scaleY=a,r[ON_MOUSE_UP]&&r[ON_MOUSE_UP].call(s[ON_MOUSE_UP]))},this.buttonDown=function(){o||(u.scaleX=.9*a,u.scaleY=.9*a,playSound("click",1,!1),r[ON_MOUSE_DOWN]&&r[ON_MOUSE_DOWN].call(s[ON_MOUSE_DOWN]))},this.pulseAnimation=function(){createjs.Tween.get(u).to({scaleX:.9*a,scaleY:.9*a},850,createjs.Ease.quadOut).to({scaleX:a,scaleY:a},650,createjs.Ease.quadIn).call((function(){h.pulseAnimation()}))},this.trembleAnimation=function(){createjs.Tween.get(u).to({rotation:10},75,createjs.Ease.quadOut).to({rotation:-10},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).call((function(){h.trembleAnimation()}))},this.removeAnimation=function(){u.scale=a,u.rotation=0,createjs.Tween.removeTweens(u)},this.setPosition=function(e,t){u.x=e,u.y=t},this.setX=function(e){u.x=e},this.setY=function(e){u.y=e},this.setImage=function(e){u.image=e},this.getButtonImage=function(){return u},this.getX=function(){return u.x},this.getY=function(){return u.y};var h=this;return this._init(e,t,n,i),this}function CTLText(e,t,n,i,o,a,r,s,l,c,u,h,d,_,p,f,g){this._oContainer=e,this._x=t,this._y=n,this._iWidth=i,this._iHeight=o,this._bMultiline=f,this._iFontSize=a,this._szAlign=r,this._szColor=s,this._szFont=l,this._iPaddingH=u,this._iPaddingV=h,this._bVerticalAlign=p,this._bFitText=_,this._bDebug=g,this._oDebugShape=null,this._fLineHeightFactor=c,this._oText=null,d&&this.__createText(d)}CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){for(var e=this._iFontSize;(this._oText.getBounds().height>this._iHeight-2*this._iPaddingV||this._oText.getBounds().width>this._iWidth-2*this._iPaddingH)&&(e--,this._oText.font=e+"px "+this._szFont,this._oText.lineHeight=Math.round(e*this._fLineHeightFactor),this.__updateY(),this.__verticalAlign(),!(8>e)););this._iFontSize=e}},__verticalAlign:function(){if(this._bVerticalAlign){var e=this._oText.getBounds().height;this._oText.y-=(e-this._iHeight)/2+this._iPaddingV}},__updateY:function(){switch(this._oText.y=this._y+this._iPaddingV,this._oText.textBaseline){case"middle":this._oText.y+=this._oText.lineHeight/2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__createText:function(e){switch(this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(0,0,this._iWidth,this._iHeight),this._oDebugShape.x=this._x,this._oDebugShape.y=this._y,this._oContainer.addChild(this._oDebugShape)),this._oText=new createjs.Text(e,this._iFontSize+"px "+this._szFont,this._szColor),this._oText.textBaseline="middle",this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor),this._oText.textAlign=this._szAlign,this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null,this._szAlign){case"center":this._oText.x=this._x+this._iWidth/2;break;case"left":this._oText.x=this._x+this._iPaddingH;break;case"right":this._oText.x=this._x+this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText),this.refreshText(e)},setVerticalAlign:function(e){this._bVerticalAlign=e},setOutline:function(e){null!==this._oText&&(this._oText.outline=e)},setShadow:function(e,t,n,i){null!==this._oText&&(this._oText.shadow=new createjs.Shadow(e,t,n,i))},setColor:function(e){this._oText.color=e},setAlpha:function(e){this._oText.alpha=e},setAlign:function(e){this._oText.textAlign=e},removeTweens:function(){createjs.Tween.removeTweens(this._oText)},getText:function(){return this._oText},getX:function(){return this._x},getY:function(){return this._y},getFontSize:function(){return this._iFontSize},setY:function(e){this._y=e,this._oText.y=this._y},setPos:function(e,t){if(this._x=e,this._y=t,this._oText.x=this._x,this._oText.y=this._y,this._bDebug){this._oContainer.removeChild(this._oDebugShape);var n="left"===this._oText.textAlign?0:-this._iWidth;this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(n,0,this._iWidth,this._iHeight),this._oDebugShape.x=this._x,this._oDebugShape.y=this._y,this._oContainer.addChild(this._oDebugShape)}this.__autofit(),this.__updateY(),this.__verticalAlign()},refreshText:function(e){""===e&&(e=" "),null===this._oText&&this.__createText(e),this._oText.text=e,this._oText.font=this._iFontSize+"px "+this._szFont,this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor),this.__autofit(),this.__updateY(),this.__verticalAlign()}},function(){function e(t){var o,a,r=t;if(i[r])r=i[r];else{for(var s,l=r,c=[],u=0;l;){if(null!==(s=n.text.exec(l)))c.push(s[0]);else if(null!==(s=n.modulo.exec(l)))c.push("%");else{if(null===(s=n.placeholder.exec(l)))throw new SyntaxError("[sprintf] unexpected placeholder");if(s[2]){u|=1;var h,d=[],_=s[2];if(null===(h=n.key.exec(_)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(d.push(h[1]);""!==(_=_.substring(h[0].length));)if(null!==(h=n.key_access.exec(_)))d.push(h[1]);else{if(null===(h=n.index_access.exec(_)))throw new SyntaxError("[sprintf] failed to parse named argument key");d.push(h[1])}s[2]=d}else u|=2;if(3===u)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");c.push({placeholder:s[0],param_no:s[1],keys:s[2],sign:s[3],pad_char:s[4],align:s[5],width:s[6],precision:s[7],type:s[8]})}l=l.substring(s[0].length)}r=i[r]=c}for(l=arguments,s=1,c=r.length,d="",_=0;_<c;_++)if("string"==typeof r[_])d+=r[_];else if("object"==typeof r[_]){if((h=r[_]).keys)for(u=l[s],o=0;o<h.keys.length;o++){if(null==u)throw Error(e('[sprintf] Cannot access property "%s" of undefined value "%s"',h.keys[o],h.keys[o-1]));u=u[h.keys[o]]}else u=h.param_no?l[h.param_no]:l[s++];if(n.not_type.test(h.type)&&n.not_primitive.test(h.type)&&u instanceof Function&&(u=u()),n.numeric_arg.test(h.type)&&"number"!=typeof u&&isNaN(u))throw new TypeError(e("[sprintf] expecting number but found %T",u));switch(n.number.test(h.type)&&(a=0<=u),h.type){case"b":u=parseInt(u,10).toString(2);break;case"c":u=String.fromCharCode(parseInt(u,10));break;case"d":case"i":u=parseInt(u,10);break;case"j":u=JSON.stringify(u,null,h.width?parseInt(h.width):0);break;case"e":u=h.precision?parseFloat(u).toExponential(h.precision):parseFloat(u).toExponential();break;case"f":u=h.precision?parseFloat(u).toFixed(h.precision):parseFloat(u);break;case"g":u=h.precision?String(Number(u.toPrecision(h.precision))):parseFloat(u);break;case"o":u=(parseInt(u,10)>>>0).toString(8);break;case"s":u=String(u),u=h.precision?u.substring(0,h.precision):u;break;case"t":u=String(!!u),u=h.precision?u.substring(0,h.precision):u;break;case"T":u=Object.prototype.toString.call(u).slice(8,-1).toLowerCase(),u=h.precision?u.substring(0,h.precision):u;break;case"u":u=parseInt(u,10)>>>0;break;case"v":u=u.valueOf(),u=h.precision?u.substring(0,h.precision):u;break;case"x":u=(parseInt(u,10)>>>0).toString(16);break;case"X":u=(parseInt(u,10)>>>0).toString(16).toUpperCase()}if(n.json.test(h.type))d+=u;else{if(!n.number.test(h.type)||a&&!h.sign)var p="";else p=a?"+":"-",u=u.toString().replace(n.sign,"");o=h.pad_char?"0"===h.pad_char?"0":h.pad_char.charAt(1):" ";var f=h.width-(p+u).length;f=h.width&&0<f?o.repeat(f):"",d+=h.align?p+u+f:"0"===o?p+f+u:f+p+u}}return d}function t(t,n){return e.apply(null,[t].concat(n||[]))}var n={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/},i=Object.create(null);"undefined"!=typeof exports&&(exports.sprintf=e,exports.vsprintf=t),"undefined"!=typeof window&&(window.sprintf=e,window.vsprintf=t,"function"==typeof define&&define.amd&&define((function(){return{sprintf:e,vsprintf:t}})))}();var CCTLMultiplayerGui=function(){this._cssClassDomain="ctl-multiplayer-",this._idCurDialog,this._idLoadingDialog,this._iMaxPlayersInRoom=2,this._iStartNumPlayers=3;var e=localStorage.getItem("nickname");this._szNickName=null==e?"":e,jQuery(document).on("click","."+this._cssClassDomain+"room-list li",(function(){var e=jQuery(this).find("."+g_oCTLMultiplayer._cssClassDomain+"room-name").text(),t=jQuery(this).attr("data-accessible"),n=jQuery(this).attr("data-private");"false"!==t&&(g_oCTLMultiplayer.closeCurrentDialog(),"true"===n?g_oCTLMultiplayer.showTypeRoomPassword(e):(g_oCTLMultiplayer.showLoading(TEXT_NETWORK_CONNECTING),on_ctl_multiplayer_join_room(e)))}))};CCTLMultiplayerGui.prototype.refreshRoomList=function(e){for(var t="",n=0;n<e.length;n++)t+='<li data-private="'+e[n].private+'" data-accessible="'+e[n].accessible+'">',t+='<span class="'+this._cssClassDomain+'room-name">',t+=e[n].name,t+="</span>",t+='<span class="'+this._cssClassDomain+'current-users">',t+=e[n].curusers+"/"+e[n].maxusers,t+="</span>",t=!0===e[n].private?t+'<i class="'+this._cssClassDomain+'icons-lock"></i>':!1===e[n].accessible?t+'<i class="'+this._cssClassDomain+'icons-block"></i>':t+'<i class="'+this._cssClassDomain+'icons-login"></i>',t+="</li>";jQuery("."+this._cssClassDomain+"room-list").html(t)},CCTLMultiplayerGui.prototype.showRoomList=function(e){var t='<ul class="'+this._cssClassDomain+"list "+this._cssClassDomain+'room-list">';t=t+'</ul><button onclick="on_ctl_multiplayer_refresh_room_list()" type="button" class="'+this._cssClassDomain+"update "+this._cssClassDomain+'btn-gray">',t+='<i class="'+this._cssClassDomain+'icons-arrows-cw"></i>',t+="<span>"+TEXT_SYS_UPDATE+"</span>",this._idCurDialog=this.showDialog(TEXT_SYS_MATCH_LIST,t+"</button>",[{txt:TEXT_SYS_QUICKMATCH,cb:"on_ctl_multiplayer_join_quick_match",classes:""},{txt:TEXT_SYS_CREATEMATCH,cb:"on_ctl_multiplayer_show_create_match",classes:""},{txt:TEXT_SYS_BACK,cb:"g_oCTLMultiplayer.closeCurrentDialog",classes:""}]),this.refreshRoomList(e)},CCTLMultiplayerGui.prototype.showTypeRoomPassword=function(e){var t='<div class="'+this._cssClassDomain+'form-group">';t+="<label>"+TEXT_SYS_TYPEROOMPASS+"</label>",this._idCurDialog=this.showDialog(TEXT_SYS_TYPEROOMPASS,t+'<input type="password" name="password" data-room-name="'+e+'"></div>',[{txt:TEXT_SYS_OK,cb:"on_ctl_multiplayer_send_password",classes:""},{txt:TEXT_SYS_BACK,cb:"on_ctl_multiplayer_close_type_room_password",classes:""}])},CCTLMultiplayerGui.prototype.showCreateRoom=function(){var e='<div class="'+this._cssClassDomain+'form-group">';if(e+="<label>"+TEXT_SYS_NAMEROOM+"</label>",e=(e+='<input type="text" name="roomname" value="'+this._szNickName+"'s room\">")+'</div><div class="'+this._cssClassDomain+'form-group">',e=(e=(e+="<label>"+TEXT_SYS_PASSWORD+"</label>")+'<input type="password" name="password"><p>'+TEXT_SYS_INFOPASS+"</p>")+'</div><div class="'+this._cssClassDomain+"form-group"+(2===this._iMaxPlayersInRoom?" "+this._cssClassDomain+"display-none":"")+'">',e+="<label>"+TEXT_SYS_MAXPLAYERS+"</label>",e+='<ul class="'+this._cssClassDomain+'inline-list">',2<this._iMaxPlayersInRoom)for(var t=2;t<this._iMaxPlayersInRoom+1;t++)e=this._iStartNumPlayers===t?e+'<li><input type="radio" name="maxplayers" value="'+t+'" checked="checked"><span>'+t+"</span></li>":e+'<li><input type="radio" name="maxplayers" value="'+t+'"><span>'+t+"</span></li>";e+="<p>"+TEXT_SYS_CHOOSEMAXNUMPLAYERS+"</p>",this._idCurDialog=this.showDialog("Create room",e+"</div>",[{txt:TEXT_SYS_CREATE,cb:"on_ctl_multiplayer_create_room",classes:""},{txt:TEXT_SYS_BACK,cb:"on_ctl_multiplayer_close_create_room",classes:""}])},CCTLMultiplayerGui.prototype.showChooseNickName=function(){this._idCurDialog=this.showDialog(TEXT_SYS_CHOOSENICK,'<input type="text" name="nickname" maxlength="20" value="'+this._szNickName+'">',[{txt:TEXT_SYS_OK,cb:"on_ctl_multiplayer_send_nickname",classes:""},{txt:TEXT_SYS_CLOSE,cb:"g_oCTLMultiplayer.closeCurrentDialog",classes:""}])},CCTLMultiplayerGui.prototype.showGeneralDialog=function(e,t){this._idCurDialog=this.showDialog(e,"",[{txt:TEXT_SYS_BACK,cb:t,classes:""}])},CCTLMultiplayerGui.prototype.closeLoadingDialog=function(){this.closeDlg(this._idLoadingDialog)},CCTLMultiplayerGui.prototype.closeCurrentDialog=function(){this.closeDlg(this._idCurDialog)},CCTLMultiplayerGui.prototype.makeCode=function(){for(var e="",t=0;32>t;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e},CCTLMultiplayerGui.prototype.showDialog=function(e,t,n,i){var o="";if(i||(i=this.makeCode()),o+="<div id='"+i+"' class='"+this._cssClassDomain+"dlg-wrapper'>",o+="<div class='"+this._cssClassDomain+"dlg-block'></div>",o+="<div class='"+this._cssClassDomain+"dlg-content'>",o=(o+="<div class='"+this._cssClassDomain+"dlg-header'>")+"<h1>"+e+"</h1></div><div class='"+this._cssClassDomain+"dlg-content-body'>",o+=t,o+="</div>",n&&0<n.length){for(o+="<div class='"+this._cssClassDomain+"dlg-footer'>",e=0;e<n.length;e++)o+="<button type='button' onclick='"+n[e].cb+'("'+i+"\");' class='"+this._cssClassDomain+"mini "+n[e].classes+"'>"+n[e].txt+"</button>";o+=this.buildExtraFooter(),o+="</div>"}return o+="</div>",o+="</div>",jQuery("body").append(o),i},CCTLMultiplayerGui.prototype.buildExtraFooter=function(){return""},CCTLMultiplayerGui.prototype.showLoading=function(e,t){var n="";this._idLoadingDialog=this.makeCode(),e||(e=TEXT_SYS_LOADING),n+="<div id='"+this._idLoadingDialog+"' class='"+this._cssClassDomain+"dlg-wrapper "+this._cssClassDomain+"fixed'>",n+="<div class='"+this._cssClassDomain+"dlg-block'></div>",n+="<div class='"+this._cssClassDomain+"dlg-content'>",n=(n+="<div class='"+this._cssClassDomain+"dlg-header'>")+"<h1>"+e+"</h1></div><div class='"+this._cssClassDomain+"dlg-content-body "+this._cssClassDomain+"align-center'>",n+='<i class="'+this._cssClassDomain+'icons-spin5 animate-spin"></i>',n+="</div>",t&&(n+="<div class='"+this._cssClassDomain+"dlg-footer "+this._cssClassDomain+"center'>",n+="<button type='button' onclick='"+t+'("'+this._idLoadingDialog+"\");' class='"+this._cssClassDomain+"mini '>"+TEXT_SYS_BACK+"</button>",n+=this.buildExtraFooter(),n+="</div>"),n+="</div>",n+="</div>",jQuery("body").append(n)},CCTLMultiplayerGui.prototype.updateRoomUserList=function(e,t){var n=jQuery("."+this._cssClassDomain+"user-list");if(0<n.length){n.html("");for(var i=0;i<e.length;i++)n.append("<li>"+e[i]+"</li>");n=TEXT_WAITING_ROOM_MESSAGE.replace("%d",t),jQuery("."+this._cssClassDomain+"room-info").text(n),0<jQuery("."+this._cssClassDomain+"room-play-now").length&&(1===e.length?jQuery("."+this._cssClassDomain+"room-play-now").addClass(this._cssClassDomain+"display-none"):jQuery("."+this._cssClassDomain+"room-play-now").removeClass(this._cssClassDomain+"display-none"))}},CCTLMultiplayerGui.prototype.showWaitingPlayersInRoom=function(e,t,n){var i="";for(this._idLoadingDialog=this.makeCode(),e||(e=TEXT_SYS_LOADING),i+="<div id='"+this._idLoadingDialog+"' class='"+this._cssClassDomain+"dlg-wrapper "+this._cssClassDomain+"fixed'>",i+="<div class='"+this._cssClassDomain+"dlg-block'></div>",i+="<div class='"+this._cssClassDomain+"dlg-content'>",i=(i+="<div class='"+this._cssClassDomain+"dlg-header'>")+"<h1>"+e+"</h1></div><div class='"+this._cssClassDomain+"dlg-content-body "+this._cssClassDomain+"align-center'>",i+="<ul class='"+this._cssClassDomain+"list "+this._cssClassDomain+"user-list'>",e=0;e<t.length;e++)i+="<li>"+t[e]+"</li>";if(i+="</ul>",i+="<p class='"+this._cssClassDomain+"room-info'></p>",i+='<i class="'+this._cssClassDomain+'icons-spin5 animate-spin"></i>',i+="</div>",n){for(i+="<div class='"+this._cssClassDomain+"dlg-footer "+this._cssClassDomain+"center'>",e=0;e<n.length;e++)i+="<button type='button' onclick='"+(t=n[e]).func+'("'+this._idLoadingDialog+"\");' class='"+this._cssClassDomain+"mini"+(t.classes?" "+t.classes:"")+" '>"+t.label+"</button>";i+=this.buildExtraFooter(),i+="</div>"}i+="</div>",i+="</div>",jQuery("body").append(i)},CCTLMultiplayerGui.prototype.closeDlg=function(e){jQuery("#"+e).remove()},CCTLMultiplayerGui.prototype.closeAllDialog=function(){g_oCTLMultiplayer.closeLoadingDialog(),g_oCTLMultiplayer.closeCurrentDialog()},CCTLMultiplayerGui.prototype.setNickName=function(e){this._szNickName=null==e?"":e,localStorage.setItem("nickname",this._szNickName)},CCTLMultiplayerGui.prototype.getNickname=function(){return this._szNickName},CCTLMultiplayerGui.prototype.setMaxPlayersInRoom=function(e){2>e||4<e||(this._iMaxPlayersInRoom=e)};var g_oCTLMultiplayer=new CCTLMultiplayerGui;g_oCTLMultiplayer.setMaxPlayersInRoom(4);var ON_CONNECTION_ERROR=0,ON_DISCONNECTION=1,ON_DISCONNECTION_FROM_MATCH=2,ON_LOGIN_SUCCESS=3,ON_MATCHMAKING_CONNECTION_SUCCESS=4,ON_GAMEROOM_CONNECTION_SUCCESS=5,ON_USEROWNERROOM_CREATE_SUCCESS=6,ON_USEROWNERROOM_JOIN_SUCCESS=7,ON_ROOM_INFO_RETURNED=8,ON_BACK_FROM_A_ROOM=9,ERROR_CODE_UNKNOWNROOM="UnknownRoom",ON_STATUS_ONLINE="online",ON_STATUS_OFFLINE="offline",ROOM_TYPE_MATCHMAKING="MatchmakingRoom",ROOM_TYPE_USEROWNER="UserOwnerRoom",ROOM_TYPE_GAME="GameRoom",WAITING_PLAYERS_TIMEOUT=1e4;function CNetworkManager(){var e,t,n,i,o,a,r,s,l,c,u,h,d,_,p,f,g,m,C,y;this._init=function(){e=navigator.onLine,t=[],n=[],i=[],o=[],h=0,window.addEventListener("online",this._onConnectionChangeStatusOnline),window.addEventListener("offline",this._onConnectionChangeStatusOffline),s=new CNetworkMessageForwarder,y=this},this.unload=function(){s_oNetworkManager=null},this.disconnectFromSystem=function(){g_oCTLMultiplayer.closeAllDialog(),y.disconnectFromCurRoom()},this.connectToSystem=function(){e?(y.addEventListener(ON_LOGIN_SUCCESS,y.gotoLobby,y),g_oCTLMultiplayer.showChooseNickName()):y.showErrorMessage(TEXT_NO_CONNECTION)},this.login=function(e){_=e,e=y._setValidNick(e),PlayerIO.useSecureApiRequests=!MULTIPLAYER_TEST_LOCAL,PlayerIO.authenticate(GAME_PLAYERIO_ID,"public",{userId:e},{},(function(e){(r=e).multiplayer.useSecureConnections=!MULTIPLAYER_TEST_LOCAL,MULTIPLAYER_TEST_LOCAL&&(r.multiplayer.developmentServer="localhost:8184"),t[ON_LOGIN_SUCCESS]&&t[ON_LOGIN_SUCCESS].call(n[ON_LOGIN_SUCCESS])}),y.callbackError)},this._setValidNick=function(e){var t=y._getRandomCodeNumber();return""===e?_=e="guest-"+t:e=e+"-"+t,e},this._getRandomCodeNumber=function(){return Math.floor(1e3*Math.random())},this.generateRandomName=function(){var e="xmariox alex max mahuro biajus rob idah fabrix seth ikillyou commander admiral general seasalt emperorofthesea Aspect Kraken Dragon Shiver Dracula Doom Scar Roadkill Cobra Psycho Ranger Ripley Clink Bruise Bowser Creep Cannon Daemon Steel Tempest Hurricane Titanium Tito Lightning IronHeart Sabotage Rex Hydra Terminator Agrippa Gash Blade Katana Gladius Angon Claymore Pike Hammer Club Heart Gauntlet Montante Longbow bow Dagger".split(" "),t=Math.floor(Math.random()*e.length);if(e=e[t],.5<Math.random()){var n=Math.floor(100*Math.random());if(.5<Math.random()){var i=["-","_"];e+=i[t=Math.floor(Math.random()*i.length)]}e+=n}return C=e},this.getBotName=function(){return C},this._onConnectionChangeStatusOnline=function(i){e=!0,t[ON_STATUS_ONLINE]&&t[ON_STATUS_ONLINE].call(n[ON_STATUS_ONLINE]),0<jQuery(".ctl-multiplayer-dlg-content").length&&y._onReconnection()},this._onConnectionChangeStatusOffline=function(){e=!1,t[ON_STATUS_OFFLINE]&&t[ON_STATUS_OFFLINE].call(n[ON_STATUS_OFFLINE]),0<jQuery(".ctl-multiplayer-dlg-content").length&&(y.showErrorMessage(TEXT_NO_CONNECTION),y.disconnect())},this._onReconnection=function(){null==_?(g_oCTLMultiplayer.closeAllDialog(),y.connectToSystem()):(g_oCTLMultiplayer.closeAllDialog(),y.gotoLobby())},this.showErrorMessage=function(e){g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(e,"g_oCTLMultiplayer.closeAllDialog")},this.addEventListener=function(e,i,o){t[e]=i,n[e]=o},this.callbackError=function(e){t[ON_CONNECTION_ERROR]&&t[ON_CONNECTION_ERROR].call(n[ON_CONNECTION_ERROR],e),y.showErrorMessage(e)},this.callbackDisconnect=function(e){t[ON_DISCONNECTION]&&t[ON_DISCONNECTION].call(n[ON_DISCONNECTION],e)},this.callbackDisconnectFromMatch=function(e){t[ON_DISCONNECTION_FROM_MATCH]&&t[ON_DISCONNECTION_FROM_MATCH].call(n[ON_DISCONNECTION_FROM_MATCH],e)},this.sendMsg=function(e,t){a&&a.send(e,t)},this.disconnect=function(){a&&(a.disconnect(),a=null)},this.isUserA=function(){return 0===parseInt(l)},this.getPlayerOrderID=function(){return l},this.getPlayerNickname=function(){return _},this.getNicknameByID=function(e){return p[e]},this.getNicknameList=function(){return p},this.getAvatarByID=function(e){return f[e]},this.getAvatarList=function(){return f},this.createRoom=function(e,i,o){y.addEventListener(ON_USEROWNERROOM_CREATE_SUCCESS,y._onRoomCreated),MULTIPLAYER_TEST_LOCAL&&(r.multiplayer.developmentServer="localhost:8184"),r.multiplayer.createJoinRoom(e,ROOM_TYPE_USEROWNER,!0,{id:e,pass:i,curusers:1,maxusers:o},{nickname:_,avatar:""},(function(e){a=e,e.addMessageCallback("*",s.messageHandler),e.addDisconnectCallback(y.callbackDisconnect),t[ON_USEROWNERROOM_CREATE_SUCCESS]&&t[ON_USEROWNERROOM_CREATE_SUCCESS].call(n[ON_USEROWNERROOM_CREATE_SUCCESS])}),y.callbackError)},this.joinRoom=function(e){y.addEventListener(ON_CONNECTION_ERROR,y._onRoomJoinedFailed),y.addEventListener(ON_USEROWNERROOM_JOIN_SUCCESS,y._onRoomJoined),g=e,MULTIPLAYER_TEST_LOCAL&&(r.multiplayer.developmentServer="localhost:8184"),r.multiplayer.joinRoom(e,{nickname:_,avatar:""},(function(e){a=e,e.addMessageCallback("*",s.messageHandler),e.addDisconnectCallback(y.callbackDisconnect),t[ON_USEROWNERROOM_JOIN_SUCCESS]&&t[ON_USEROWNERROOM_JOIN_SUCCESS].call(n[ON_USEROWNERROOM_JOIN_SUCCESS])}),y.callbackError)},this.gotoGameRoom=function(e){MULTIPLAYER_TEST_LOCAL&&(r.multiplayer.developmentServer="localhost:8184"),g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showLoading(TEXT_MATCH_FOUND.toUpperCase());var i=e.getString(0);l=e.getInt(1),e=e.getString(2);var o=JSON.parse(e);o=Object.values(o),p=[],f=[];for(var c=0;c<o.length;c++)p[c]=o[c].nickname,f[c]=o[c].avatar;u=o.length,r.multiplayer.createJoinRoom(i,ROOM_TYPE_GAME,!0,{pass:"",maxusers:u,playersinfo:e},{ingameid:l},(function(e){y.disconnectFromCurRoom(),a=e,e.addMessageCallback("*",s.messageHandler),e.addDisconnectCallback(y.callbackDisconnectFromMatch),t[ON_GAMEROOM_CONNECTION_SUCCESS]&&t[ON_GAMEROOM_CONNECTION_SUCCESS].call(n[ON_GAMEROOM_CONNECTION_SUCCESS],u),y._onGameRoomEntered()}),y.callbackError)},this.gotoGameRoomWithBot=function(){MULTIPLAYER_TEST_LOCAL&&(r.multiplayer.developmentServer="localhost:8184");var e=randomFloatBetween(1e6,2e6,0)+"";l=0,(p=[])[0]=_,p[1]=C,f=["",""],r.multiplayer.createJoinRoom(e,ROOM_TYPE_GAME,!0,{pass:"",maxusers:2,bot:!0},{ingameid:l},(function(e){y.disconnectFromCurRoom(),a=e,e.addMessageCallback("*",s.messageHandler),e.addDisconnectCallback(y.callbackDisconnectFromMatch),g_oCTLMultiplayer.closeAllDialog()}),y.callbackError)},this.gotoMatchMakingRoom=function(){MULTIPLAYER_TEST_LOCAL&&(r.multiplayer.developmentServer="localhost:8184"),r.multiplayer.createJoinRoom("matchmakingroom1",ROOM_TYPE_MATCHMAKING,!0,null,{nickname:_,avatar:""},(function(e){a=e,e.addMessageCallback("*",s.messageHandler),e.addDisconnectCallback(y.callbackDisconnect),t[ON_MATCHMAKING_CONNECTION_SUCCESS]&&t[ON_MATCHMAKING_CONNECTION_SUCCESS].call(n[ON_MATCHMAKING_CONNECTION_SUCCESS]),g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showLoading(TEXT_FIND_OPPONENT,"s_oNetworkManager._onDisconnectFromARoom")}),y.callbackError)},this._onGameRoomEntered=function(){d=setTimeout((function(){g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_OPPONENT_LEFT,"s_oNetworkManager.gotoLobby"),y.disconnect()}),WAITING_PLAYERS_TIMEOUT)},this.onGameStarted=function(){g_oCTLMultiplayer.closeAllDialog(),clearTimeout(d)},this.tryCreateUniqueRoom=function(e,t,n){g=e,m=t,c=n,r.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:e},0,0,y._onUniqueListRoomSearch,y.callbackError)},this._onUniqueListRoomSearch=function(e){0<e.length&&(g+="-"+y._getRandomCodeNumber()),y.createRoom(g,m,c)},this._onPlayNow=function(){y.sendMsg(MSG_PLAYNOW,"")},this._addBotInRoom=function(){COMBINED_PLAYERS_MODE&&(y.sendMsg(MSG_ADDBOT,y.generateRandomName()+"-bot"),jQuery(".ctl-multiplayer-room-add-bot").addClass("ctl-multiplayer-display-none"),jQuery(".ctl-multiplayer-room-remove-bot").addClass("ctl-multiplayer-display-none"))},this._removeBotInRoom=function(){COMBINED_PLAYERS_MODE&&(y.sendMsg(MSG_REMOVEBOT,""),jQuery(".ctl-multiplayer-room-add-bot").addClass("ctl-multiplayer-display-none"),jQuery(".ctl-multiplayer-room-remove-bot").addClass("ctl-multiplayer-display-none"))},this.onBotAdded=function(e){COMBINED_PLAYERS_MODE&&(jQuery(".ctl-multiplayer-room-add-bot").removeClass("ctl-multiplayer-display-none"),jQuery(".ctl-multiplayer-room-remove-bot").removeClass("ctl-multiplayer-display-none"))},this.onBotRemoved=function(e){COMBINED_PLAYERS_MODE&&(0<e?(jQuery(".ctl-multiplayer-room-add-bot").removeClass("ctl-multiplayer-display-none"),jQuery(".ctl-multiplayer-room-remove-bot").removeClass("ctl-multiplayer-display-none")):(jQuery(".ctl-multiplayer-room-add-bot").removeClass("ctl-multiplayer-display-none"),jQuery(".ctl-multiplayer-room-remove-bot").addClass("ctl-multiplayer-display-none")))},this.disconnectFromCurRoom=function(){a&&(a.removeDisconnectCallback(y.callbackDisconnect),a.disconnect())},this._onDisconnectFromARoom=function(){t[ON_BACK_FROM_A_ROOM]&&t[ON_BACK_FROM_A_ROOM].call(n[ON_BACK_FROM_A_ROOM]),g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showLoading(TEXT_CONNECT_TO_LOBBY),y.disconnectFromCurRoom(),setTimeout((function(){y.gotoLobby()}),500)},this._onRoomCreated=function(){var e={func:"s_oNetworkManager._addBotInRoom",label:TEXT_SYS_ADD_BOT,classes:"ctl-multiplayer-room-add-bot ctl-multiplayer-display-block"},t={func:"s_oNetworkManager._removeBotInRoom",label:TEXT_SYS_REMOVE_BOT,classes:"ctl-multiplayer-room-remove-bot ctl-multiplayer-display-none"},n=[{func:"s_oNetworkManager._onPlayNow",label:TEXT_PLAY_NOW,classes:"ctl-multiplayer-room-play-now ctl-multiplayer-display-none"},{func:"s_oNetworkManager._onDisconnectFromARoom",label:TEXT_SYS_BACK}];COMBINED_PLAYERS_MODE&&n.push(e,t),g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showWaitingPlayersInRoom(TEXT_WAITING_FOR_PLAYERS_IN_ROOM+g,[_],n)},this._onRoomJoined=function(){g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showWaitingPlayersInRoom(TEXT_WAITING_FOR_PLAYERS_IN_ROOM+g,[],[{func:"s_oNetworkManager._onDisconnectFromARoom",label:TEXT_SYS_BACK}])},this._onRoomJoinedFailed=function(e){switch(y.addEventListener(ON_CONNECTION_ERROR,(function(){})),e.code){case ERROR_CODE_UNKNOWNROOM:g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_DOESNT_EXIST,"s_oNetworkManager.gotoLobby")}},this.gotoLobby=function(){g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showLoading(TEXT_CONNECT_TO_LOBBY),y.refreshRooms()},this.refreshRooms=function(){r.multiplayer.listRooms(ROOM_TYPE_USEROWNER,null,0,0,y._onFillWithOwnerRoom,y.callbackError),r.multiplayer.listRooms(ROOM_TYPE_GAME,null,0,0,y._onFillWithGameRoom,y.callbackError)},this._onFillWithOwnerRoom=function(e){h++,y._extractOwnerRoomInfo(e),2<=h&&y._onFinalUpdateRoomList()},this._onFillWithGameRoom=function(e){h++,y._extractGameRoomInfo(e),2<=h&&y._onFinalUpdateRoomList()},this._onFinalUpdateRoomList=function(){var e=y._getCombinedRoomsLists();0<jQuery(".ctl-multiplayer-room-list").length?g_oCTLMultiplayer.refreshRoomList(e):this._showLobby(e)},this._showLobby=function(e){h=0,g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showRoomList(e)},this._extractOwnerRoomInfo=function(e){i=[];for(var t=0;t<e.length;t++)i[t]={name:e[t].id,private:0!==e[t].roomData.pass.length,accessible:!0,curusers:e[t].roomData.curusers,maxusers:e[t].roomData.maxusers};return i},this._extractGameRoomInfo=function(e){o=[];for(var t=0;t<e.length;t++)o[t]={name:"game-"+e[t].id,private:0!==e[t].roomData.pass.length,accessible:!1,curusers:e[t].roomData.curusers,maxusers:e[t].roomData.maxusers};return o},this._getCombinedRoomsLists=function(){for(var e=[],t=0;t<i.length;t++)e.push(i[t]);for(t=0;t<o.length;t++)e.push(o[t]);return e},this.joinQuickMatch=function(){g_oCTLMultiplayer.showLoading(TEXT_NETWORK_CONNECTING),y.gotoMatchMakingRoom()},this.tryJoinRoomWithPass=function(e,t){g=e,m=t,y.addEventListener(ON_ROOM_INFO_RETURNED,y._checkUserPermissionToJoin),y.getRoomInfo(e,t)},this._checkUserPermissionToJoin=function(e){0<e.length?y.joinRoom(e[0].roomData.id,e[0].roomData.pass):(g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_WRONG_PASSWORD,"s_oNetworkManager._onPasswordFailed"))},this._onPasswordFailed=function(){g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showTypeRoomPassword(g)},this.getRoomInfo=function(e,t){r.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:e,pass:t},0,0,y._onRoomInfoReturned,y.callbackError)},this._onRoomInfoReturned=function(e){t[ON_ROOM_INFO_RETURNED]&&t[ON_ROOM_INFO_RETURNED].call(n[ON_ROOM_INFO_RETURNED],e)},this._init()}var MSG_ROOM_UPDATE="room_update",MSG_ROOM_IS_FULL="room_is_full",MSG_ROOM_EXPIRED="room_expired",MSG_GAME_FOUND="game_found",MSG_PLAYER_LEFT_GAME="player_left_game",MSG_REMATCH_PANEL="rematch_panel",MSG_REMATCH_ANSWER_RESULTS="rematch_answer_results",MSG_NEXTMATCH_ANSWER_RESULTS="next_match_answer_results",MSG_OPPONENT_MOVES="opponent_moves",MSG_PIECES_RECEIVED="pieces_received",MSG_START_THE_GAME="start_the_game",MSG_BOT_ADDED="bot_added",MSG_BOT_REMOVED="bot_removed",MSG_END_MATCH="end_match",MSG_END_GAME="end_game",MSG_ACCEPT_REMATCH="accept_rematch",MSG_ACCEPT_NEXTMATCH="accept_next_match",MSG_DISCONNECTION="disconnection",MSG_MOVE="move",MSG_REQUEST_PIECES="request_pieces",MSG_PLAYNOW="play_now",MSG_ADDBOT="add_bot",MSG_REMOVEBOT="remove_bot";function CNetworkMessageForwarder(){this._init=function(){},this.messageHandler=function(t){switch(t.type){case MSG_ROOM_UPDATE:e._onUpdateRoom(t);break;case MSG_ROOM_IS_FULL:e._onFullRoom(t);break;case MSG_ROOM_EXPIRED:e._onExpiredRoom(t);break;case MSG_GAME_FOUND:e._onGameFound(t);break;case MSG_PLAYER_LEFT_GAME:e._onOpponentLeftTheGame(t);break;case MSG_REMATCH_PANEL:e._onRematchPanel(t);break;case MSG_REMATCH_ANSWER_RESULTS:e._onRematchResults(t);break;case MSG_NEXTMATCH_ANSWER_RESULTS:e._onNextMatchResults(t);break;case MSG_OPPONENT_MOVES:e._onEnemyMoves(t);break;case MSG_PIECES_RECEIVED:e._onPiecesReceived(t);break;case MSG_START_THE_GAME:e._onGameStart(t);break;case MSG_BOT_ADDED:e._onBotAdded(t);break;case MSG_BOT_REMOVED:e._onBotRemoved(t)}},this._onUpdateRoom=function(e){e=e.getString(0);var t=JSON.parse(e);e=t.nicknamelist,t=parseInt(t.maxnumplayers),g_oCTLMultiplayer.updateRoomUserList(e,t)},this._onFullRoom=function(){g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_IS_FULL,"s_oNetworkManager.gotoLobby")},this._onExpiredRoom=function(){s_oNetworkManager.disconnectFromCurRoom(),g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_IS_EXPIRED,"s_oNetworkManager.gotoLobby")},this._onGameFound=function(e){s_oNetworkManager.gotoGameRoom(e)},this._onGameStart=function(e){e=e.getString(0);var t=JSON.parse(e);t=parseInt(t.maxusers),s_oMenu&&s_oMenu.onRemoteGameStart(t),s_oNetworkManager.onGameStarted()},this._onBotAdded=function(e){e=e.getInt(0),e=parseInt(JSON.parse(e)),s_oNetworkManager.onBotAdded(e)},this._onBotRemoved=function(e){e=e.getInt(0),e=parseInt(JSON.parse(e)),s_oNetworkManager.onBotRemoved(e)},this._onOpponentLeftTheGame=function(e){e=parseInt(e.getInt(0)),s_oGame.opponentLeftTheGame(e)},this._onRematchPanel=function(){s_oGame.showRematchQuestion()},this._onNextMatchResults=function(e){e.getBoolean(0)?s_oGame.onOpponentAcceptNextMatch():s_oGame.onOpponentRefuseNextMatch()},this._onRematchResults=function(e){e.getBoolean(0)?s_oGame.onOpponentAcceptRematch():s_oGame.onOpponentRefuseRematch()},this._onPiecesReceived=function(e){e=e.getString(0),e=JSON.parse(e),s_oGame._onPiecesReceived(e)},this._onEnemyMoves=function(e){e=e.getString(0),e=JSON.parse(e),s_oGame.onActionReceived(e)};var e=this;this._init()}var CANVAS_WIDTH=1920,CANVAS_HEIGHT=1080,EDGEBOARD_X=256,EDGEBOARD_Y=84,PRIMARY_FONT="comfortaabold",FPS=30,FPS_TIME=1e3/FPS,DISABLE_SOUND_MOBILE=!1,ENABLE_FULLSCREEN=!0,GAME_PLAYERIO_ID="four-colors-o2yb5hcxu2o4lkmfuuykw",GAME_NAME="four_colors",MULTIPLAYER_TEST_LOCAL=!1,COMBINED_PLAYERS_MODE=!1,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,STATE_SELECT_PLAYERS=4,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_CARD_DEALED=6,ON_HOME=7,ON_CHECK=8,ON_NEXT=9,ENABLE_CHECK_ORIENTATION,AD_SHOW_COUNTER,NUM_PLAYERS,STARTING_NUM_CARDS,CARD_WIDTH=156,CARD_HEIGHT=242,SOUNDTRACK_VOLUME_IN_GAME=.4,DEBUG_SHOW_CARDS=!1,CARD_SCORE=[0,1,2,3,4,5,6,7,8,9,20,20,20,50,50],NUM_PENALTY_CARDS=2,GAME_SCORE_WIN=250,BOTTOM=0,TOP=1,LEFT=2,RIGHT=3,HAND_POS=[];HAND_POS.num_player_2=[{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2+350,side:BOTTOM},{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2-350,side:TOP}],HAND_POS.num_player_3=[{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2+350,side:BOTTOM},{x:CANVAS_WIDTH/2-650,y:CANVAS_HEIGHT/2-40,side:LEFT},{x:CANVAS_WIDTH/2+650,y:CANVAS_HEIGHT/2,side:RIGHT}],HAND_POS.num_player_4=[{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2+350,side:BOTTOM},{x:CANVAS_WIDTH/2-650,y:CANVAS_HEIGHT/2-40,side:LEFT},{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2-350,side:TOP},{x:CANVAS_WIDTH/2+650,y:CANVAS_HEIGHT/2-40,side:RIGHT}];var FOTOGRAM_COLOR=52,FOTOGRAM_DRAW_FOUR=53,ON_COLOR_SELECTED=0,ACTION_NEXT_TURN=0,ACTION_USE_CARD=1,ACTION_ON_SHUFFLECARDS=2,ACTION_ON_DRAWCARDS=3,ACTION_ON_UNO_CLICK=4,ACTION_SELECT_COLOR=5,ACTION_DRAW_FOUR=6,ACTION_BLOCK_TURN=7,ACTION_INVERT_TURN=8,ACTION_DRAW_TWO_COLORED=9,EFFECT_SELECT_COLOR=0,EFFECT_DRAW_FOUR=1,EFFECT_STOP=2,EFFECT_INVERT_TURN=3,EFFECT_DRAW_TWO_COLORED=4,EFFECT_NORMAL_CARD=5,ON_APPLY_EFFECT=0,ON_APPLY_PENALITY=1,ON_UNO_CLICK=2,DRAW_TYPE_NORMAL=0,DRAW_TYPE_PENALITY=1,DRAW_TYPE_DRAW2_COLORED=2,DRAW_TYPE_DRAW3=3;function CPreloader(){var e,t,n,i,o,a,r,s,l,c;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this),s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png"),s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg"),s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png"),s_oSpriteLibrary.loadSprites(),c=new createjs.Container,s_oStage.addChild(c)},this.unload=function(){c.removeAllChildren(),l.unload()},this._onImagesLoaded=function(){},this._onAllImagesLoaded=function(){this.attachSprites(),s_oMain.preloaderReady()},this.attachSprites=function(){var u=new createjs.Shape;u.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),c.addChild(u),u=s_oSpriteLibrary.getSprite("200x200"),(r=createBitmap(u)).regX=.5*u.width,r.regY=.5*u.height,r.x=CANVAS_WIDTH/2,r.y=CANVAS_HEIGHT/2-180,c.addChild(r),(s=new createjs.Shape).graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(r.x-100,r.y-100,200,200,10),c.addChild(s),r.mask=s,u=s_oSpriteLibrary.getSprite("progress_bar"),(i=createBitmap(u)).x=CANVAS_WIDTH/2-u.width/2,i.y=CANVAS_HEIGHT/2+50,c.addChild(i),e=u.width,t=u.height,(o=new createjs.Shape).graphics.beginFill("rgba(0,0,0,0.01)").drawRect(i.x,i.y,1,t),c.addChild(o),i.mask=o,(n=new createjs.Text("","30px "+PRIMARY_FONT,"#fff")).x=CANVAS_WIDTH/2,n.y=CANVAS_HEIGHT/2+100,n.textBaseline="alphabetic",n.textAlign="center",c.addChild(n),u=s_oSpriteLibrary.getSprite("but_start"),(l=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,u,TEXT_PRELOADER_CONTINUE,"Arial","#000","bold 50",c)).addEventListener(ON_MOUSE_UP,this._onButStartRelease,this),l.setVisible(!1),(a=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),c.addChild(a),createjs.Tween.get(a).to({alpha:0},500).call((function(){createjs.Tween.removeTweens(a),c.removeChild(a)}))},this._onButStartRelease=function(){s_oMain.onRemovePreloader()},this.refreshLoader=function(a){n.text=a+"%",100===a&&(s_oMain.onRemovePreloader(),n.visible=!1,i.visible=!1),o.graphics.clear(),a=Math.floor(a*e/100),o.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(i.x,i.y,a,t)},this._init()}function CMain(e){var t,n,i,o=0,a=0,r=STATE_LOADING;this.initContainer=function(){s_oCanvas=document.getElementById("canvas"),(s_oStage=new createjs.Stage(s_oCanvas)).preventSelection=!0,createjs.Touch.enable(s_oStage,!0),!1===(s_bMobile=isMobile())&&s_oStage.enableMouseOver(FPS),s_iPrevTime=(new Date).getTime(),createjs.Ticker.addEventListener("tick",this._update),createjs.Ticker.framerate=FPS,navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0),s_oSpriteLibrary=new CSpriteLibrary,s_oNetworkManager=new CNetworkManager,n=new CPreloader},this.preloaderReady=function(){this._loadImages(),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds(),t=!0},this.soundLoaded=function(){o++,n.refreshLoader(Math.floor(o/a*100))},this._initSounds=function(){Howler.mute(!s_bAudioActive),(s_aSoundsInfo=[]).push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"}),s_aSoundsInfo.push({path:"./sounds/",filename:"click",loop:!1,volume:1,ingamename:"click"}),s_aSoundsInfo.push({path:"./sounds/",filename:"game_over",loop:!1,volume:1,ingamename:"game_over"}),s_aSoundsInfo.push({path:"./sounds/",filename:"card_dealing",loop:!1,volume:1,ingamename:"card_dealing"}),s_aSoundsInfo.push({path:"./sounds/",filename:"snap",loop:!1,volume:1,ingamename:"snap"}),s_aSoundsInfo.push({path:"./sounds/",filename:"card",loop:!1,volume:1,ingamename:"card"}),s_aSoundsInfo.push({path:"./sounds/",filename:"special_card",loop:!1,volume:1,ingamename:"special_card"}),s_aSoundsInfo.push({path:"./sounds/",filename:"change_color",loop:!1,volume:1,ingamename:"change_color"}),a+=s_aSoundsInfo.length,s_aSounds=[];for(var e=0;e<s_aSoundsInfo.length;e++)this.tryToLoadSound(s_aSoundsInfo[e],!1)},this.tryToLoadSound=function(e,t){setTimeout((function(){s_aSounds[e.ingamename]=new Howl({src:[e.path+e.filename+".mp3"],autoplay:!1,preload:!0,loop:e.loop,volume:e.volume,onload:s_oMain.soundLoaded,onloaderror:function(e,t){for(var n=0;n<s_aSoundsInfo.length;n++)if(e===s_aSounds[s_aSoundsInfo[n].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[n],!0);break}},onplayerror:function(e){for(var t=0;t<s_aSoundsInfo.length;t++)if(e===s_aSounds[s_aSoundsInfo[t].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[t].ingamename].once("unlock",(function(){s_aSounds[s_aSoundsInfo[t].ingamename].play(),"soundtrack"===s_aSoundsInfo[t].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)}));break}}})}),t?200:0)},this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this),s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png"),s_oSpriteLibrary.addSprite("credits_panel","./sprites/credits_panel.png"),s_oSpriteLibrary.addSprite("select_color_panel","./sprites/select_color_panel.png"),s_oSpriteLibrary.addSprite("ctl_logo","./sprites/ctl_logo.png"),s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png"),s_oSpriteLibrary.addSprite("but_yes_big","./sprites/but_yes_big.png"),s_oSpriteLibrary.addSprite("but_exit_big","./sprites/but_exit_big.png"),s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png"),s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png"),s_oSpriteLibrary.addSprite("but_uno","./sprites/but_uno.png"),s_oSpriteLibrary.addSprite("but_p2","./sprites/but_p2.png"),s_oSpriteLibrary.addSprite("but_p3","./sprites/but_p3.png"),s_oSpriteLibrary.addSprite("but_p4","./sprites/but_p4.png"),s_oSpriteLibrary.addSprite("but_red","./sprites/oButRed.png"),s_oSpriteLibrary.addSprite("but_green","./sprites/oButGreen.png"),s_oSpriteLibrary.addSprite("but_blue","./sprites/oButBlue.png"),s_oSpriteLibrary.addSprite("but_yellow","./sprites/oButYellow.png"),s_oSpriteLibrary.addSprite("stop_turn","./sprites/stop_turn.png"),s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg"),s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg"),s_oSpriteLibrary.addSprite("bg_select_players","./sprites/bg_select_players.jpg"),s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png"),s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png"),s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png"),s_oSpriteLibrary.addSprite("but_arrow","./sprites/arrow.png"),s_oSpriteLibrary.addSprite("but_skip","./sprites/but_skip.png"),s_oSpriteLibrary.addSprite("line_player","./sprites/line_players.png"),s_oSpriteLibrary.addSprite("cards","./sprites/cards.png"),s_oSpriteLibrary.addSprite("colors","./sprites/colors.png"),s_oSpriteLibrary.addSprite("draw_3","./sprites/draw_3.png"),s_oSpriteLibrary.addSprite("draw_two_anim","./sprites/draw_2.png"),s_oSpriteLibrary.addSprite("stop_turn_anim","./sprites/stop_turn.png"),s_oSpriteLibrary.addSprite("clock_wise_anim","./sprites/change_clockwise.png"),s_oSpriteLibrary.addSprite("change_color","./sprites/change_color.png"),s_oSpriteLibrary.addSprite("cloud_uno","./sprites/cloud.png"),s_oSpriteLibrary.addSprite("finger","./sprites/finger.png"),s_oSpriteLibrary.addSprite("shuffle_anim","./sprites/shuffle_anim.png"),s_oSpriteLibrary.addSprite("local_but","./sprites/local_but.png"),s_oSpriteLibrary.addSprite("multiplayer_but","./sprites/multiplayer_but.png"),s_oSpriteLibrary.addSprite("but_next","./sprites/but_next.png"),s_oSpriteLibrary.addSprite("but_show","./sprites/but_show.png"),s_oSpriteLibrary.addSprite("score_icon","./sprites/score_icon.png"),s_oSpriteLibrary.addSprite("info_label","./sprites/info_label.png"),s_oSpriteLibrary.addSprite("cup_icon","./sprites/cup_icon.png"),a+=s_oSpriteLibrary.getNumSprites(),s_oSpriteLibrary.loadSprites()},this._onImagesLoaded=function(){o++,n.refreshLoader(Math.floor(o/a*100))},this._onAllImagesLoaded=function(){},this.onRemovePreloader=function(){try{checkMoreGames(s_szGameID,"middle-left",["cards","board","multiplayer"],[],-1,"blue")}catch(e){}n.unload(),s_oSoundtrack=playSound("soundtrack",1,!0),this.gotoMenu()},this.gotoMenu=function(){try{showMoreGames()}catch(e){}new CMenu,r=STATE_MENU},this.gotoSelectPlayers=function(){new CSelectPlayers,r=STATE_SELECT_PLAYERS},this.gotoGame=function(e){s_bFirstGame=!1!==e,s_oGame=i=new CGameSingle(s),r=STATE_GAME},this.gotoGameMulti=function(e){s_bFirstGame=!1,NUM_PLAYERS=e,s_oGame=i=new CGameMulti(s),r=STATE_GAME},this.gotoGameWithBot=function(){s_bFirstGame=!1,NUM_PLAYERS=2,s_oGame=i=new CGameSingleWithBot(s),r=STATE_GAME},this.gotoHelp=function(){new CHelp,r=STATE_HELP},this.stopUpdate=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)},this.startUpdate=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||!s_bAudioActive||s_bAdShown||Howler.mute(!1)},this._update=function(e){if(!1!==t){var n=(new Date).getTime();s_iTimeElaps=n-s_iPrevTime,s_iCntFps++,s_iPrevTime=n,1e3<=(s_iCntTime+=s_iTimeElaps)&&(s_iCurFps=s_iCntFps,s_iCntTime-=1e3,s_iCntFps=0),r===STATE_GAME&&i.update(),s_oStage.update(e)}},s_oMain=this;var s=e;ENABLE_FULLSCREEN=ENABLE_CHECK_ORIENTATION=!0,STARTING_NUM_CARDS=7,s_bAudioActive=!0,this.initContainer()}var s_bMobile,s_bAudioActive=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_bFullscreen=!1,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundtrack=null,s_oCanvas,s_bFirstGame=!1,s_aSounds,s_aSoundsInfo,s_oNetworkManager,s_bMultiplayer,s_bPlayWithBot,s_oGame;function CPanelTutorial(){var e,t,n,i,o,a;this.init=function(){a=new createjs.Container,o=0,(e=new createjs.Container).x=CANVAS_WIDTH/2,e.y=CANVAS_HEIGHT/2,(t=new createBitmap(s_oSpriteLibrary.getSprite("msg_box"))).regX=398,t.regY=258.5,t.alpha=.8,e.addChild(t),s_oStage.addChild(e),(n=new CGfxButton(e.getBounds().width/2-50,0,s_oSpriteLibrary.getSprite("but_arrow"),e)).addEventListener(ON_MOUSE_DOWN,this.onButNext,this);var r=s_oSpriteLibrary.getSprite("but_arrow");(i=new CGfxButton(-(e.getBounds().width/2-50),0,r,e)).addEventListener(ON_MOUSE_DOWN,this.onButBack,this),i.getButtonImage().rotation=180,new CGfxButton(e.getBounds().width/2-53,e.getBounds().height/2-53,s_oSpriteLibrary.getSprite("but_skip"),e).addEventListener(ON_MOUSE_DOWN,this.onButSkip,this),this.loadPage(o)},this.loadPage=function(t){switch(t){case 0:i.setVisible(!1),new CTLText(a,-300,-200,600,50,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_WELCOME,!0,!0,!0,!1),new CTLText(a,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1,0,0,sprintf(TEXT_TUTORIAL1,GAME_SCORE_WIN),!0,!0,!0,!1),(t=new CCard(-215,0,a,"card_1_7",0,0)).setAnimTutorial("tutorial"),e.addChild(a);break;case 1:i.setVisible(!0),new CTLText(a,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1,0,0,sprintf(TEXT_TUTORIAL2,CARD_SCORE[12]),!0,!0,!0,!1),(t=new CCard(-215,0,a,"card_0_12",0,0)).setAnimTutorial("draw2tutorial");break;case 2:new CTLText(a,-80,-105,300,210,50,"center","#fff",PRIMARY_FONT,1,0,0,sprintf(TEXT_TUTORIAL3,CARD_SCORE[10]),!0,!0,!0,!1),(t=new CCard(-215,0,a,"card_1_7",0,0)).setAnimTutorial("stopTurnTutorial");break;case 3:new CTLText(a,-80,-105,300,210,50,"center","#fff",PRIMARY_FONT,1,0,0,sprintf(TEXT_TUTORIAL4,CARD_SCORE[11]),!0,!0,!0,!1),(t=new CCard(-215,0,a,"card_1_7",0,0)).setAnimTutorial("changeClockWiseTutorial");break;case 4:new CTLText(a,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1,0,0,sprintf(TEXT_TUTORIAL5,CARD_SCORE[13]),!0,!0,!0,!1),(t=new CCard(-215,0,a,FOTOGRAM_COLOR,0,0)).instantShow();break;case 5:n.setVisible(!0),new CTLText(a,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1,0,0,sprintf(TEXT_TUTORIAL6,CARD_SCORE[14]),!0,!0,!0,!1),(t=new CCard(-215,0,a,FOTOGRAM_DRAW_FOUR,0,0)).instantShow();break;case 6:n.setVisible(!1),new CTLText(a,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1,0,0,sprintf(TEXT_TUTORIAL7,NUM_PENALTY_CARDS),!0,!0,!0,!1),(t=new createBitmap(s_oSpriteLibrary.getSprite("but_uno"))).regX=50,t.regY=50.5,t.x=-215,t.scaleX=1.5,t.scaleY=1.5,a.addChild(t)}},this.onButNext=function(){o++,a.removeAllChildren(),this.loadPage(o)},this.onButBack=function(){o--,a.removeAllChildren(),this.loadPage(o)},this.onButSkip=function(){s_oStage.removeChild(e),s_oGame._startGame()},this.init()}function CTurnManager(){var e,t,n,i;this.init=function(){e=!0,n=i=0,t=n+1,s_oTurnManager=this},this.changeClockWise=function(){e=!0!==e},this.nextTurn=function(){!0===e?(++n===NUM_PLAYERS&&(n=0),(t=n+1)===NUM_PLAYERS&&(t=0)):(0>--n&&(n=NUM_PLAYERS-1),0>(t=n-1)&&(t=NUM_PLAYERS-1))},this.prevTurn=function(){!0===e?(n--,t=n+1,0>n&&(n=NUM_PLAYERS-1,t=0)):(n++,t=n-1,n===NUM_PLAYERS&&(n=0,t=NUM_PLAYERS-1))},this.setTurn=function(i){n=i,t=!0===e?n===NUM_PLAYERS-1?0:n+1:0===n?NUM_PLAYERS-1:n-1},this.setFirstPlayerToBegin=function(){this.setTurn(i),++i===NUM_PLAYERS&&(i=0)},this.resetClockWise=function(){e=!0},this.resetFirstPlayer=function(){i=0},this.getTurn=function(){return n},this.getNextPlayer=function(){return t},this.getClockWise=function(){return e},this.init()}function CAnimation(){var e,t,n,i,o,a,r;this.init=function(){a=!1;var s=s_oSpriteLibrary.getSprite("draw_3");s={images:[s],frames:{width:292,height:290,regX:146,regY:145},animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],next:"stop",speed:.8},reverse:{frames:[13,12,11,10,9,8,7,6,5,4,3,2,1,0],next:[0],speed:.8},stop:[13]}},s=new createjs.SpriteSheet(s),e=new createjs.Sprite(s,0),s={images:[s=s_oSpriteLibrary.getSprite("draw_two_anim")],frames:{width:292,height:322,regX:146,regY:161},animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],next:"stop",speed:.8},reverse:{frames:[13,12,11,10,9,8,7,6,5,4,3,2,1,0],next:[0],speed:.8},stop:[13]}},s=new createjs.SpriteSheet(s),t=new createjs.Sprite(s,0),s=s_oSpriteLibrary.getSprite("stop_turn_anim"),n=new createBitmap(s,292,300),s=s_oSpriteLibrary.getSprite("clock_wise_anim"),i=new createBitmap(s,292,300),s={images:[s=s_oSpriteLibrary.getSprite("change_color")],frames:{width:328,height:315,regX:164,regY:157.5},animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],next:"anim",speed:.8},stop:[16],color_0:{frames:[0,1,2,3,4,5,6],speed:.8},color_1:{frames:[0,1,2],speed:.8},color_2:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],speed:.8},color_3:{frames:[0,1,2,3,4,5,6,7,8,9,10],speed:.8}}},s=new createjs.SpriteSheet(s),o=new createjs.Sprite(s,0),s={images:[s=s_oSpriteLibrary.getSprite("shuffle_anim")],frames:{width:403,height:386,regX:201.5,regY:193},animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],next:"anim"},idle:[17]}},s=new createjs.SpriteSheet(s),r=new createjs.Sprite(s,"idle")},this.drawThreeAnim=function(t,n,i,o){e.alpha=0,e.x=CANVAS_WIDTH/2,e.y=CANVAS_HEIGHT/2,e.scaleX=.01,e.scaleY=.01,s_oStage.addChild(e),e.stop(),playSound("special_card",.5,!1),new createjs.Tween.get(e).to({alpha:1,scaleX:1.4,scaleY:1.4},200,createjs.Ease.cubicOut).wait(200).call((function(){e.gotoAndPlay("anim")})).wait(1e3).call((function(){e.gotoAndPlay("reverse")})).wait(200).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call((function(){s_oStage.removeChild(e),s_oGame.drawCardsTween(t,n,i,o)}))},this.drawTwoAnim=function(e,n,i,o){t.alpha=0,t.x=CANVAS_WIDTH/2,t.y=CANVAS_HEIGHT/2,t.scaleX=.01,t.scaleY=.01,s_oStage.addChild(t),t.stop(),playSound("special_card",.5,!1),new createjs.Tween.get(t).to({alpha:1,scaleX:1.4,scaleY:1.4},200,createjs.Ease.cubicOut).wait(200).call((function(){t.gotoAndPlay("anim"),setVolume("special_card",.2)})).wait(1e3).call((function(){t.gotoAndPlay("reverse"),setVolume("special_card",.1)})).wait(200).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call((function(){s_oStage.removeChild(t),s_oGame.drawCardsTween(e,n,i,o)}))},this.stopTurn=function(){return new Promise((function(e,t){n.alpha=0,n.regX=146,n.regY=150,n.x=CANVAS_WIDTH/2,n.y=CANVAS_HEIGHT/2,n.scaleX=.01,n.scaleY=.01,s_oStage.addChild(n),playSound("game_over",1,!1),new createjs.Tween.get(n).to({alpha:1,scaleX:2,scaleY:2},200,createjs.Ease.cubicOut).to({scaleX:1.6,scaleY:1.6},200).to({scaleX:2,scaleY:2},200).to({scaleX:1.6,scaleY:1.6},200).to({scaleX:2,scaleY:2},200).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call((function(){s_oStage.removeChild(n),e()}))}))},this.changeClockWise=function(e){return new Promise((function(t,n){i.alpha=0,i.rotation=0,i.regX=146,i.regY=150,i.x=CANVAS_WIDTH/2,i.y=CANVAS_HEIGHT/2,i.scaleX=.01,i.scaleY=.01,s_oStage.addChild(i),playSound("special_card",.5,!1),!1===e?new createjs.Tween.get(i).to({alpha:1,scaleX:2,scaleY:2},200,createjs.Ease.cubicOut).to({rotation:360},500).wait(500).to({rotation:-360},500).wait(500).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call((function(){s_oStage.removeChild(i),t()})):new createjs.Tween.get(i).to({alpha:1,scaleX:2,scaleY:2},200,createjs.Ease.cubicOut).to({rotation:-360},500).wait(500).to({rotation:360},500).wait(500).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call((function(){s_oStage.removeChild(i),t()}))}))},this.changeColor=function(e){return new Promise((function(t,n){o.alpha=0,o.x=CANVAS_WIDTH/2,o.y=CANVAS_HEIGHT/2,o.scaleX=.01,o.scaleY=.01,s_oStage.addChild(o),o.stop(),playSound("change_color",.5,!1),new createjs.Tween.get(o).to({alpha:1,scaleX:1.4,scaleY:1.4},200,createjs.Ease.cubicOut).call((function(){o.gotoAndPlay("anim")})).wait(1300).call((function(){a=!0,o.on("animationend",s_oCAnimation.endAnimation,s_oCAnimation,!1,t),o.gotoAndStop(16),o.gotoAndPlay("color_"+e)}))}))},this.endAnimation=function(e,t){!0===a&&(stopSound("change_color"),playSound("special_card",1,!1),a=!1,o.removeAllEventListeners(),o.stop(),t(),new createjs.Tween.get(o).to({scaleX:2,scaleY:2},250).to({scaleX:1.4,scaleY:1.4},250).to({scaleX:2,scaleY:2},250).to({scaleX:1.4,scaleY:1.4},250).to({alpha:0,scaleX:.1,scaleY:.1},200,createjs.Ease.cubicIn).call((function(){s_oStage.removeChild(o),o.gotoAndStop(0)})))},this.shuffleAnimation=function(){return new Promise((function(e,t){r.alpha=0,r.x=CANVAS_WIDTH/2,r.y=CANVAS_HEIGHT/2,r.scaleX=.01,r.scaleY=.01,s_oStage.addChild(r),r.stop(),new createjs.Tween.get(r).to({alpha:1,scaleX:1.6,scaleY:1.6},400,createjs.Ease.cubicOut).call((function(){r.gotoAndPlay("anim"),playSound("card_dealing",1,!0)})).wait(1700).call((function(){r.gotoAndStop("idle"),stopSound("change_color")})).to({alpha:0,scaleX:.01,scaleY:.01},300,createjs.Ease.cubicIn).call((function(){s_oStage.removeChild(r),stopSound("card_dealing"),e()}))}))},this.init(),s_oCAnimation=this}function CMenu(){var e,t,n,i,o,a,r,s,l,c,u,h,d,_,p=null,f=null;this._init=function(){s_bMobile||$("#div_display_id").css("display","block"),r=createBitmap(s_oSpriteLibrary.getSprite("bg_menu")),s_oStage.addChild(r);var _=CANVAS_WIDTH/2-300,g=CANVAS_HEIGHT-400,m=s_oSpriteLibrary.getSprite("local_but");(h=new CGfxButton(_,g,m,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButLocalRelease,this),_=CANVAS_WIDTH/2+300,g=CANVAS_HEIGHT-400,m=s_oSpriteLibrary.getSprite("multiplayer_but"),(d=new CGfxButton(_,g,m,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButMultiplayerRelease,this),m=s_oSpriteLibrary.getSprite("but_info"),o=m.width/2+10,a=m.height/2+10,(c=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-240,m,s_oStage)).addEventListener(ON_MOUSE_UP,this._onCreditsBut,this),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(m=s_oSpriteLibrary.getSprite("audio_icon"),n=CANVAS_WIDTH-m.height/2-10,i=m.height/2+10,(l=new CToggle(n,i,m,s_bAudioActive,s_oStage)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this)),_=(m=window.document).documentElement,p=_.requestFullscreen||_.mozRequestFullScreen||_.webkitRequestFullScreen||_.msRequestFullscreen,f=m.exitFullscreen||m.mozCancelFullScreen||m.webkitExitFullscreen||m.msExitFullscreen,!1===ENABLE_FULLSCREEN&&(p=!1),p&&screenfull.isEnabled&&(m=s_oSpriteLibrary.getSprite("but_fullscreen"),e=o+m.width/2+10,(u=new CToggle(e,t=a,m,s_bFullscreen,s_oStage)).addEventListener(ON_MOUSE_UP,this._onFullscreen,this)),(s=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),s_oStage.addChild(s),createjs.Tween.get(s).to({alpha:0},1e3).call((function(){s.visible=!1})),null!==s_oSoundtrack&&setVolume("soundtrack",1),this.refreshButtonPos()},this.unload=function(){h.unload(),d.unload(),s.visible=!1,c.unload(),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(l.unload(),l=null),p&&screenfull.isEnabled&&u.unload(),s_oStage.removeAllChildren(),s_oMenu=null},this.refreshButtonPos=function(){c.setPosition(o+s_iOffsetX,s_iOffsetY+a),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.setPosition(n-s_iOffsetX,s_iOffsetY+i),p&&screenfull.isEnabled&&u.setPosition(e+s_iOffsetX,t+s_iOffsetY)},this.resetFullscreenBut=function(){p&&screenfull.isEnabled&&u.setActive(s_bFullscreen)},this._onFullscreen=function(){s_bFullscreen?f.call(window.document):p.call(window.document.documentElement),sizeHandler()},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},this._onCreditsBut=function(){new CCreditsPanel},this._onButLocalRelease=function(){"undefined"!=typeof gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd();try{hideMoreGames()}catch(e){}$("#div_display_id").css("display","none"),s_bPlayWithBot=s_bMultiplayer=!1,s_oMenu.unload(),$(s_oMain).trigger("start_session"),s_oMain.gotoSelectPlayers()},this._onButMultiplayerRelease=function(){"undefined"!=typeof gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd();try{hideMoreGames()}catch(e){}$("#div_display_id").css("display","none"),$(s_oMain).trigger("start_session"),s_bMultiplayer=!0,s_bPlayWithBot=!1,s_oNetworkManager.addEventListener(ON_MATCHMAKING_CONNECTION_SUCCESS,this._onMatchmakingConnected),s_oNetworkManager.addEventListener(ON_GAMEROOM_CONNECTION_SUCCESS,this.clearBotCheck),s_oNetworkManager.addEventListener(ON_BACK_FROM_A_ROOM,this.clearBotCheck),s_oNetworkManager.connectToSystem()},this.onRemoteGameStart=function(e){s_oMenu.clearBotCheck(),s_bMultiplayer=!0,s_bPlayWithBot=!1,s_oMenu.unload(),s_oMain.gotoGameMulti(e)},this._onMatchmakingConnected=function(){s_oMenu._checkMatchWithBot()},this._checkMatchWithBot=function(){var e=randomFloatBetween(18e3,26e3);_=setTimeout((function(){s_bPlayWithBot=s_bMultiplayer=!0,g_oCTLMultiplayer.closeAllDialog(),s_oNetworkManager.disconnect(),s_oNetworkManager.generateRandomName(),s_oMenu.unload(),s_oMain.gotoGameWithBot()}),e)},this.clearBotCheck=function(){clearTimeout(_)},s_oMenu=this,this._init()}s_oTurnManager=null,s_oCAnimation=null;var s_oMenu=null;function CSelectPlayers(){var e,t,n,i,o,a,r,s,l,c=null,u=null;this._init=function(){var h=createBitmap(s_oSpriteLibrary.getSprite("bg_select_players"));s_oStage.addChild(h),h=s_oSpriteLibrary.getSprite("but_p2"),(o=new CGfxButton(CANVAS_WIDTH/2-450,CANVAS_HEIGHT-500,h,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButP2,this),h=s_oSpriteLibrary.getSprite("but_p3"),(a=new CGfxButton(CANVAS_WIDTH/2+10,CANVAS_HEIGHT-500,h,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButP3,this),h=s_oSpriteLibrary.getSprite("but_p4"),(r=new CGfxButton(CANVAS_WIDTH/2+450,CANVAS_HEIGHT-500,h,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButP4,this),new CTLText(s_oStage,CANVAS_WIDTH/2-500,300,1e3,150,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SELECT_PLAYERS,!0,!0,!0,!1),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(h=s_oSpriteLibrary.getSprite("audio_icon"),n=CANVAS_WIDTH-h.height/2-10,i=h.height/2+10,(l=new CToggle(n,i,h,s_bAudioActive,s_oStage)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this));var d=(h=window.document).documentElement;c=d.requestFullscreen||d.mozRequestFullScreen||d.webkitRequestFullScreen||d.msRequestFullscreen,u=h.exitFullscreen||h.mozCancelFullScreen||h.webkitExitFullscreen||h.msExitFullscreen,!1===ENABLE_FULLSCREEN&&(c=!1),c&&screenfull.isEnabled&&(h=s_oSpriteLibrary.getSprite("but_fullscreen"),e=h.width/4+10,t=h.height/2+10,(s=new CToggle(e,t,h,s_bFullscreen,s_oStage)).addEventListener(ON_MOUSE_UP,this._onFullscreen,this)),this.refreshButtonPos()},this._onButP2=function(){NUM_PLAYERS=2,this.unload(),$(s_oMain).trigger("select_players",2),s_oMain.gotoGame()},this._onButP3=function(){NUM_PLAYERS=3,this.unload(),$(s_oMain).trigger("select_players",3),s_oMain.gotoGame()},this._onButP4=function(){NUM_PLAYERS=4,this.unload(),$(s_oMain).trigger("select_players",4),s_oMain.gotoGame()},this.unload=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(l.unload(),l=null),c&&screenfull.isEnabled&&s.unload(),o.unload(),a.unload(),r.unload(),s_oStage.removeAllChildren(),s_oSelectPlayers=null},this.refreshButtonPos=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.setPosition(n-s_iOffsetX,s_iOffsetY+i),c&&screenfull.isEnabled&&s.setPosition(e+s_iOffsetX,t+s_iOffsetY)},this.resetFullscreenBut=function(){c&&screenfull.isEnabled&&s.setActive(s_bFullscreen)},this._onFullscreen=function(){s_bFullscreen?u.call(window.document):c.call(window.document.documentElement),sizeHandler()},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},s_oSelectPlayers=this,this._init()}var s_oSelectPlayers=null;function CCard(e,t,n,i,o,a,r){var s,l,c,u,h,d,_,p,f,g,m,C;this._init=function(e,t,n,i,o,a,r){m=n,u=o,h=a,c=i,this.setEffect(i),s=!1,C=r,l=0===h||2===h?"red":"black",(g=new createjs.Container).x=e,g.y=t,m.addChild(g),e={images:[s_oSpriteLibrary.getSprite("cards")],frames:{width:CARD_WIDTH,height:CARD_HEIGHT,regX:CARD_WIDTH/2,regY:CARD_HEIGHT/2},animations:{card_0_0:[0],card_0_1:[1],card_0_2:[2],card_0_3:[3],card_0_4:[4],card_0_5:[5],card_0_6:[6],card_0_7:[7],card_0_8:[8],card_0_9:[9],card_0_10:[10],card_0_11:[11],card_0_12:[12],card_1_0:[13],card_1_1:[14],card_1_2:[15],card_1_3:[16],card_1_4:[17],card_1_5:[18],card_1_6:[19],card_1_7:[20],card_1_8:[21],card_1_9:[22],card_1_10:[23],card_1_11:[24],card_1_12:[25],card_2_0:[26],card_2_1:[27],card_2_2:[28],card_2_3:[29],card_2_4:[30],card_2_5:[31],card_2_6:[32],card_2_7:[33],card_2_8:[34],card_2_9:[35],card_2_10:[36],card_2_11:[37],card_2_12:[38],card_3_0:[39],card_3_1:[40],card_3_2:[41],card_3_3:[42],card_3_4:[43],card_3_5:[44],card_3_6:[45],card_3_7:[46],card_3_8:[47],card_3_9:[48],card_3_10:[49],card_3_11:[50],card_3_12:[51],color:[52],draw_four:[53],back:[54],tutorial:{frames:[20,5,47,31],speed:.1},draw2tutorial:{frames:[12,25,38,51],speed:.1},stopTurnTutorial:{frames:[10,23,36,49],speed:.1},changeClockWiseTutorial:{frames:[11,24,37,50],speed:.1}}},e=new createjs.SpriteSheet(e),(f=createSprite(e,"back",CARD_WIDTH/2,CARD_HEIGHT/2,CARD_WIDTH,CARD_HEIGHT)).stop(),g.addChild(f),f.on("mousedown",this._mouseDown),_=[],p=[]},this.getCardSprite=function(){return f},this.setEffect=function(e){switch(e){case 52:d=EFFECT_SELECT_COLOR;break;case 53:d=EFFECT_DRAW_FOUR;break;default:switch(u){case 10:d=EFFECT_STOP;break;case 11:d=EFFECT_INVERT_TURN;break;case 12:d=EFFECT_DRAW_TWO_COLORED;break;default:d=e===FOTOGRAM_COLOR?EFFECT_SELECT_COLOR:e===FOTOGRAM_DRAW_FOUR?EFFECT_DRAW_FOUR:EFFECT_NORMAL_CARD}}},this.setAnimTutorial=function(e){f.gotoAndPlay(e)},this.unload=function(){f.off("mousedown",this._mouseDown),m.removeChild(g)},this.unloadEvent=function(){f.off("mousedown",this._mouseDown)},this.saveInfo=function(){return{szFotogram:c,iRank:u,iSuit:h,bValue:!0}},this.instantShow=function(){f.gotoAndStop(c)},this.setValue=function(){f.gotoAndStop(c),playSound("card",1,!1),createjs.Tween.get(g).to({scaleX:1},200)},this.setActive=function(e){e?g.addChild(void 0):g.removeChild(void 0)},this.setVisible=function(e){g.visible=!0===e},this.onSetTurned=function(){s=!0},this.offSetTurned=function(){s=!1},this.moveCard=function(e,t,n,i){var o=this;createjs.Tween.get(g).wait(i).to({x:e,y:t},n,createjs.Ease.linear).call((function(){s_oGame.playedCard(o)}))},this.moveCardFirstHand=function(e,t,n,i){var o=this;createjs.Tween.get(g).wait(i).to({x:e,y:t},n,createjs.Ease.cubicOut).call((function(){playSound("card_dealing",1,!1),s_oGame.onCardDealed(o)}))},this.moveFirstLastCard=function(e,t,n,i){var o=this;createjs.Tween.get(g).wait(i).to({x:e,y:t},n,createjs.Ease.linear).call((function(){s_oGame.onFirstLastCardDealed(o)}))},this.setOnTop=function(){m.addChildAt(g,m.numChildren)},this.stackAndDeactive=function(e,t,n){createjs.Tween.get(g).to({x:e,y:t},n,createjs.Ease.cubicOut)},this._mouseDown=function(e){!1!==s&&s_oGame.playCard(y,e)},this.showCard=function(e,t){var n=this;createjs.Tween.get(g).wait(e).to({scaleX:.1},200).call((function(){n.setValue(t)})).call((function(){}))},this.showCardNoInput=function(e,t){var n=this;createjs.Tween.get(g).wait(e).to({scaleX:.1},200).call((function(){n.setValue(t)})).call((function(){s=!1}))},this.hideCard=function(){var e=this;createjs.Tween.get(g).to({scaleX:.1},200).call((function(){e.setBack()}))},this.setPos=function(e,t){g.x=e,g.y=t},this.setBack=function(){s=!1,f.gotoAndStop("back");var e=this;createjs.Tween.get(g).to({scaleX:1},200).call((function(){e.cardHidden()}))},this.cardHidden=function(){_[ON_CARD_HIDE]&&_[ON_CARD_HIDE].call(p[ON_CARD_HIDE],this)},this.getEffect=function(){return d},this.getRank=function(){return u},this.getSuit=function(){return h},this.getColor=function(){return l},this.getFotogram=function(){return c},this.getPos=function(){return{x:g.x,y:g.y}},this.getSprite=function(){return g},this.getLogicRect=function(){return new createjs.Rectangle(g.x-CARD_WIDTH/2,g.y-CARD_HEIGHT/2,CARD_WIDTH,CARD_HEIGHT)},this.getTurned=function(){return s},this.getGlobalToLocal=function(e,t){return f.globalToLocal(e/s_oStage.scaleX,t/s_oStage.scaleY)},this.getUniqueID=function(){return C};var y=this;this._init(e,t,n,i,o,a,r)}function CDeckDisplayer(e,t,n,i){var o,a,r,s,l,c,u;this._init=function(){if(l=n,o=[],(a=new createjs.Container).x=e,a.y=t,a.on("mousedown",this.onDraw,this),l.addChild(a),i){(s=new createjs.Container).x=e,s.y=t,s.visible=!1,l.addChild(s);var u=s_oSpriteLibrary.getSprite("finger"),h=u.width/5,d=u.height/2;u=new createjs.SpriteSheet({images:[u],frames:{width:h,height:d,regX:h/2,regY:d/2},animations:{idle:{frames:[0,1,2,3,4,5,6,7,8,9],speed:.9}}}),(c=createSprite(u,"idle",h/2,d/2,h,d)).scaleX=.5,c.scaleY=.5,c.x=-100,c.y=-100,s.addChild(c)}r=!1},this.initializeDeck=function(){for(var e,t=0,n=0;4>n;n++)for(var i=0;10>i;i++)e=i,o.push(new CCard(0,0,a,"card_"+n+"_"+i,e,n,t++));for(n=0;4>n;n++)for(i=0;9>i;i++)e=i+1,o.push(new CCard(0,0,a,"card_"+n+"_"+e,e,n,t++));for(n=0;4>n;n++)for(i=0;2>i;i++)o.push(new CCard(0,0,a,"card_"+n+"_10",10,n,t++)),o.push(new CCard(0,0,a,"card_"+n+"_11",11,n,t++)),o.push(new CCard(0,0,a,"card_"+n+"_12",12,n,t++));for(n=0;4>n;n++)o.push(new CCard(0,0,a,FOTOGRAM_COLOR,13,4,t++)),o.push(new CCard(0,0,a,FOTOGRAM_DRAW_FOUR,14,4,t++))},this.initializeFromData=function(e){for(var t,n,i=0,r=0;r<e.length;r++){switch(e[r]){case FOTOGRAM_COLOR:t=13,n=4;break;case FOTOGRAM_DRAW_FOUR:t=14,n=4;break;default:t=e[r]%13,n=Math.floor(e[r]/13)}o.push(new CCard(0,0,a,e[r],t,n,i++))}},this.shuffle=function(){var e;for(e=o.length;e;e--){var t=Math.floor(Math.random()*e),n=o[e-1];o[e-1]=o[t],o[t]=n}},this.clearCards=function(){for(var e=0;e<o.length;e++)o[e].unload();o=[]},this.moveContainer=function(e,t,n,i){createjs.Tween.get(a).wait(i).to({x:e,y:t},n,createjs.Ease.linear)},this.takeFirstLastCard=function(){return o.pop()},this.takeLastCard=function(){return o.pop()},this.getLastCard=function(){return o[o.length-1]},this.getCardByIndex=function(e){return o[e]},this.removeCardByIndex=function(e){return o.splice(e,1)},this.pushCard=function(e){o.push(e)},this.getContainer=function(){return a},this.getLength=function(){return o.length},this.onDraw=function(){!1===r&&s_oGame.onDraw()},this.disableInputUsedCards=function(){o[o.length-1].offSetTurned()},this.disableInputDraw=function(){r=!0},this.enableInputDraw=function(){r=!1},this.getIndexChild=function(){return s_oStage.getChildIndex(a)},this.setChildDepth=function(e){s_oStage.addChildAt(a,e)},this.getGlobalPosition=function(){return{x:a.x,y:a.y}},this.setOnTop=function(){l.addChildAt(a,l.numChildren)},this.setHelp=function(){l.setChildIndex(s,l.numChildren-1),this.setPointer(!0),u=setTimeout((function(){s.visible=!0}),5e3)},this.hideHelp=function(){clearTimeout(u),s.visible=!1,this.setPointer(!1)},this.setPointer=function(e){a.cursor=e?"pointer":"default"},this.addNewCardUnderTheDeck=function(e){for(var t=0;t<e.length;t++)o.push(e[t])},this.removeAllCardUnderTheDeck=function(){for(var e=[],t=0;t<o.length-1;t++)o[t].unload(),e.push(o.shift()),t--;return e},this._init()}function CHandDisplayer(e,t,n,i,o,a,r,s){var l,c,u,h,d,_,p,f,g,m,C,y;this.init=function(){C=r,m=0,y=o,h=[],d=new createjs.Container,(g=a).addChild(d),_=new CPlayerInfo(n,i,g,r),(p=new CInfoLabel(n,i,g)).setVisible(!1);var l={images:[s_oSpriteLibrary.getSprite("cloud_uno")],frames:{width:261,height:194,regX:130.5,regY:97},animations:{cloud1:[0],cloud2:[1]}};l=new createjs.SpriteSheet(l),(f=new createjs.Sprite(l,"cloud1")).alpha=0,f.scaleX=.1,f.scaleY=.1,this.setPosition(e,t,n,i,s)},this.setPosition=function(e,t,n,i,o){switch(l=e,c=t,d.x=n,d.y=i,u=o,p.setPosition(d.x,d.y,u),o){case BOTTOM:var a=d.x,r=d.y-140;break;case TOP:a=d.x,r=d.y+140;break;case LEFT:a=d.x+110,r=d.y,p.setPosition(d.x+20,d.y,u);break;case RIGHT:a=d.x-110,r=d.y,p.setPosition(d.x-20,d.y,u)}_.setPosition(a,r,u)},this.clearCards=function(){for(var e=0;e<h.length;e++)h[e].unload();h=[]},this.getGlobalPosition=function(){for(var e=0,t=0,n=0;n<h.length;n++)0!==l?e+=CARD_WIDTH/2:t+=CARD_HEIGHT/2;return{x:d.x+e,y:d.y+t}},this.getContainerPos=function(){return{x:d.x,y:d.y}},this.getCardPositionByIndex=function(e){return{x:(e=h[e].getPos()).x,y:e.y}},this.searchIndexCard=function(e){for(var t=0;t<h.length;t++)if(e===h[t])return t},this.removeCardByIndex=function(e){return h.splice(e,1)},this.getPosNewCard=function(){return{x:h.length*l,y:h.length*c}},this.pushCard=function(e){h.push(e),0===c&&d.y>CANVAS_HEIGHT/2&&h[h.length-1].getCardSprite().on("mouseover",this.onMouseOver)},this.getContainer=function(){return d},this.getLastCard=function(){return h[h.length-1]},this.getLength=function(){return h.length},this.centerContainer=function(){var e=d.getBounds();0!==l?createjs.Tween.get(d).to({x:CANVAS_WIDTH/2-e.width/2+CARD_WIDTH/2},300,createjs.Ease.linear):createjs.Tween.get(d).to({y:CANVAS_HEIGHT/2-e.height/2+CARD_HEIGHT/1.5-40},300,createjs.Ease.linear)},this.setOnTop=function(){g.addChildAt(d,g.numChildren)},this.setChildDepth=function(e){e>d.s_oStage.numChild-1&&(e=d.s_oStage.numChild-1),s_oStage.addChildAt(e)},this.getContainerInfo=function(){return d.getBounds()},this.getCardByIndex=function(e){return h[e]},this.organizeHand=function(e){var t=this;if(0!==l)for(var n=0;n<h.length;n++)e=l*n,createjs.Tween.get(h[n].getSprite()).to({x:e},300,createjs.Ease.linear).call(t.centerContainer);else for(n=0;n<h.length;n++)e=c*n,createjs.Tween.get(h[n].getSprite()).to({y:e},300,createjs.Ease.linear).call((function(){t.centerContainer()}))},this.setOnTurn=function(){_.highlight()},this.setOffTurn=function(){_.disable()},this.checkUno=function(){1===h.length&&(this.setOnTop(),0!==l?d.y<CANVAS_HEIGHT/2?(f.gotoAndStop("cloud2"),f.x=CANVAS_WIDTH/2-270,f.y=CANVAS_HEIGHT/2-300):(f.gotoAndStop("cloud1"),f.x=CANVAS_WIDTH/2+300,f.y=CANVAS_HEIGHT/2+100):d.x<CANVAS_WIDTH/2?(f.gotoAndStop("cloud1"),f.x=CANVAS_WIDTH/2-350,f.y=CANVAS_HEIGHT/2-30):(f.gotoAndStop("cloud2"),f.x=CANVAS_WIDTH/2+350,f.y=CANVAS_HEIGHT/2-200),s_oStage.addChild(f),new createjs.Tween.get(f).to({alpha:1,scaleX:1,scaleY:1},300,createjs.Ease.bounceOut).wait(1500).to({scaleX:.1,scaleY:.1},300,createjs.Ease.cubicIn).to({alpha:0},20).call((function(){s_oStage.removeChild(f)})))},this.onMouseOver=function(e){s_bMobile||(e.target.cursor="pointer")},this.showAllCards=function(){for(var e=0;e<h.length;e++)h[e].showCard()},this.changeName=function(e){C=e,_.setName(e)},this.refreshScore=function(){_.setScore(m),p.setVisible(!1)},this.getCardByUniqueID=function(e){for(var t=0;t<h.length;t++)if(h[t].getUniqueID()===e)return h[t]},this.getPlayerID=function(){return y},this.getName=function(){return C},this.getSide=function(){return u},this.getScore=function(){return m},this.setScore=function(e){m=e},this.showHandScore=function(e){p.setVisible(!0),p.setTextScore(e),p.setOnTop()},this.calculateHandScore=function(){for(var e=0,t=0;t<h.length;t++){var n=h[t].getRank();e+=CARD_SCORE[n]}return e},this.init()}var CGameBase=function(e){this._iCounterDraw,this._oInterface,this._oParent,this._oDeck,this._aPlayersHand,this._oUsedCards,this._oTurnManager,this._iCurrentColor,this._bUNO,this._bEndGame,this._oAnimation,this._iCurPlayer,this._iNextPlayer,this._oFinger,this._oFade,this._oDecksContainer,this._oHandsContainer,this._oCardsContainer,this._oAIManager,this._oUnoController,this._oSummaryPanel};CGameBase.prototype._init=function(){this._bEndGame=this._bUNO=!1,this._iCounterDraw=0,this._oTurnManager=new CTurnManager,this._oAnimation=new CAnimation;var e=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));s_oStage.addChild(e),this._oUnoController=new CUnoController,this._oInterface=new CInterface,this._oCardsContainer=new createjs.Container,this._oHandsContainer=new createjs.Container,this._oPanelContainer=new createjs.Container,this._oDecksContainer=new createjs.Container,(e=[])[0]=TEXT_PLAYER_1,e[1]=TEXT_PLAYER_2,e[2]=TEXT_PLAYER_3,e[3]=TEXT_PLAYER_4,this._aPlayersHand=[];for(var t=0;t<NUM_PLAYERS;t++){var n=0,i=0;HAND_POS["num_player_"+NUM_PLAYERS][t].x===CANVAS_WIDTH/2?n=CARD_WIDTH/2:i=CARD_HEIGHT/4,this._aPlayersHand[t]=new CHandDisplayer(n,i,HAND_POS["num_player_"+NUM_PLAYERS][t].x,HAND_POS["num_player_"+NUM_PLAYERS][t].y,t,this._oHandsContainer,e[t],HAND_POS["num_player_"+NUM_PLAYERS][t].side)}this._oCardsContainer.addChild(this._oDecksContainer),this._oCardsContainer.addChild(this._oHandsContainer),s_oStage.addChild(this._oCardsContainer),s_oStage.addChild(this._oPanelContainer),this._oSummaryPanel=new CSummaryPanel(this._oPanelContainer),this._oSummaryPanel.addEventListener(ON_CHECK,this._onCheck,this),this._oMsgBox=new CMsgBox(this._oPanelContainer),this._oDeck=new CDeckDisplayer(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,this._oDecksContainer,!0),this._oUsedCards=new CDeckDisplayer(CANVAS_WIDTH/2+CARD_WIDTH,CANVAS_HEIGHT/2,this._oDecksContainer,!1),this._oUsedCards.disableInputDraw(),this.setOffTurn(),this._oAIManager=new CAIManager,setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)},CGameBase.prototype.reset=function(){this._iCounterDraw=0,this._oTurnManager.resetClockWise(),this._oDeck.clearCards(),this._oUsedCards.clearCards(),this._oUsedCards.disableInputDraw();for(var e=0;e<this._aPlayersHand.length;e++)this._aPlayersHand[e].clearCards(),this._aPlayersHand[e].refreshScore();this._oSummaryPanel.reset(),this.setOffTurn()},CGameBase.prototype.getFirstHand=function(){var e=this._oDeck.takeLastCard(),t=this._oTurnManager.getTurn(),n=this._aPlayersHand[t].getContainerPos();t=this._aPlayersHand[t].getPosNewCard();var i=this._oDeck.getGlobalPosition();e.setOnTop(),this._oCardsContainer.addChildAt(this._oDecksContainer,this._oCardsContainer.numChildren),this._oDeck.setOnTop(),e.moveCardFirstHand(n.x+t.x-i.x,n.y+t.y-i.y,250)},CGameBase.prototype.onCardDealed=function(e){var t=this._oTurnManager.getTurn();this._aPlayersHand[t].pushCard(new CCard(this._aPlayersHand[t].getPosNewCard().x,this._aPlayersHand[t].getPosNewCard().y,this._aPlayersHand[t].getContainer(),e.getFotogram(),e.getRank(),e.getSuit(),e.getUniqueID())),e.unload(),e=this._aPlayersHand[t].getLastCard(),this._aPlayersHand[t].centerContainer(),this.canCardBeShown(t)&&e.showCard(),this._oTurnManager.nextTurn(),this.matchCanStart()?(this._oCardsContainer.addChildAt(this._oDecksContainer,this._oCardsContainer),this._oDeck.setOnTop(),(e=this._oDeck.takeFirstLastCard()).moveFirstLastCard(CARD_WIDTH,0,600)):this.getFirstHand()},CGameBase.prototype.onFirstLastCardDealed=function(e){this._oUsedCards.pushCard(new CCard(0,0,this._oUsedCards.getContainer(),e.getFotogram(),e.getRank(),e.getSuit(),e.getUniqueID())),e.unload(),this._oUsedCards.getLastCard().showCardNoInput(),this._oDeck.moveContainer(CANVAS_WIDTH/2-CARD_WIDTH/2,CANVAS_HEIGHT/2,400),this._oUsedCards.moveContainer(CANVAS_WIDTH/2+CARD_WIDTH/2,CANVAS_HEIGHT/2,400),this._iCurrentColor=this._oUsedCards.getLastCard().getSuit(),this._oInterface.refreshColor(this._iCurrentColor),this._oTurnManager.setFirstPlayerToBegin(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._aPlayersHand[this._iCurPlayer].setOnTurn(),this._oUsedCards.disableInputUsedCards(),this._onFirstTurnStart()},CGameBase.prototype._onFirstTurnStart=function(){this._oTurnManager.prevTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this.setOffTurn();var e=this._oUsedCards.getLastCard();this._checkFirstCardEffect(e.getEffect())},CGameBase.prototype.cpuPlayCard=function(e){var t=this._iCurPlayer,n=this._aPlayersHand[t].getContainerPos(),i=this._oUsedCards.getGlobalPosition();this._oCardsContainer.addChildAt(this._oHandsContainer,this._oCardsContainer.numChildren),this._aPlayersHand[t].setOnTop(),e.moveCard(i.x-n.x,i.y-n.y,400,1e3),this._oDeck.setChildDepth(2),this._oUsedCards.setChildDepth(2),e.showCard(1e3)},CGameBase.prototype.checkUno=function(e){var t=this._oTurnManager.getTurn();1===this._aPlayersHand[t].getLength()&&(this._bUNO=!0),this._oUnoController.check(e)},CGameBase.prototype.setUNO=function(e){this._bUNO=e},CGameBase.prototype.applyPenality=function(){this._bUNO=!1,this.drawCards(this._iCurPlayer,NUM_PENALTY_CARDS,0,DRAW_TYPE_PENALITY)},CGameBase.prototype._checkEffect=function(e){switch(e){case EFFECT_SELECT_COLOR:this._applySelectColor();break;case EFFECT_DRAW_FOUR:this._applyDrawThreeEffect();break;case EFFECT_STOP:this._applyStopTurn();break;case EFFECT_INVERT_TURN:this._applyInvertTurn();break;case EFFECT_DRAW_TWO_COLORED:this._applyDrawTwoColored();break;default:this._applyNormalCardEffect()}},CGameBase.prototype.onDraw=function(){var e=!0,t=0;if(s_bMultiplayer&&!s_bPlayWithBot&&(t=s_oNetworkManager.getPlayerOrderID()),0!==this._oUsedCards.getLength()&&this._iCurPlayer===t){for(var n=0;n<this._aPlayersHand[t].getLength();n++){var i=this._aPlayersHand[t].getCardByIndex(n);this.cardMatchTheWaste(i)&&(e=!1)}!0===e&&(this._oDeck.disableInputDraw(),this._oDeck.hideHelp(),this.drawCards(t,1,0,DRAW_TYPE_NORMAL))}},CGameBase.prototype._checkNumberCardsToDraw=function(e,t,n,i){switch(this._iCounterDraw=t,i){case DRAW_TYPE_PENALITY:this.drawCardsTween(e,t,n,i);break;case DRAW_TYPE_DRAW2_COLORED:s_oCAnimation.drawTwoAnim(e,t,n,i);break;case DRAW_TYPE_DRAW3:s_oCAnimation.drawThreeAnim(e,t,n,i);break;default:this.drawCardsTween(e,t,n,i)}},CGameBase.prototype.drawCardsTween=function(e,t,n,i){this._oCardsContainer.addChildAt(this._oDecksContainer,this._oCardsContainer.numChildren),this._oDeck.setOnTop();var o=this._aPlayersHand[e].getContainerPos(),a=this._aPlayersHand[e].getPosNewCard(),r=this._oDeck.getGlobalPosition(),s=this,l=this._oDeck.takeLastCard();l.setOnTop();var c=o.x+a.x-r.x;o=o.y+a.y-r.y,createjs.Tween.get(l.getSprite()).wait(n).to({x:c,y:o},400,createjs.Ease.cubicOut).call((function(){s._aPlayersHand[e].pushCard(new CCard(s._aPlayersHand[e].getPosNewCard().x,s._aPlayersHand[e].getPosNewCard().y,s._aPlayersHand[e].getContainer(),l.getFotogram(),l.getRank(),l.getSuit(),l.getUniqueID())),l.unload();var o=s._aPlayersHand[e].getLastCard();s.canCardBeShown(e)?o.showCard():playSound("card",1,!1),s._aPlayersHand[e].centerContainer(),s.checkForMoreDraws(e,t,n,i)}))},CGameBase.prototype.checkForMoreDraws=function(e,t,n,i){0===this._oDeck.getLength()?this.shuffleCards(e,t,n,i):(this._iCounterDraw--,0<this._iCounterDraw?this.drawCardsTween(e,t,n,i):this._onAllCardsDrawCompleted(e,i))},CGameBase.prototype._checkEffectAfterDrawCompleted=function(e,t){switch(t){case DRAW_TYPE_PENALITY:this.applyEffectOnCard(this._oUsedCards.getLastCard().getEffect());break;case DRAW_TYPE_DRAW2_COLORED:this._oTurnManager.nextTurn(),this._notifyChangeTurn();break;case DRAW_TYPE_DRAW3:this._oTurnManager.nextTurn(),this._notifyChangeTurn();break;default:this._checkIfCanStillPlayTheTurn(e)}},CGameBase.prototype.onInputPlayer=function(e){for(var t=0;t<this._aPlayersHand[e].getLength();t++)this._aPlayersHand[e].getCardByIndex(t).onSetTurned()},CGameBase.prototype.offInputPlayer=function(e){for(var t=0;t<this._aPlayersHand[e].getLength();t++)this._aPlayersHand[e].getCardByIndex(t).offSetTurned()},CGameBase.prototype.setOffTurn=function(){for(var e=0;e<NUM_PLAYERS;e++)this._aPlayersHand[e].setOffTurn(e),this.offInputPlayer(e)},CGameBase.prototype.prevTurn=function(){this._oTurnManager.prevTurn()},CGameBase.prototype.getPlayerTurn=function(){return this._iCurPlayer},CGameBase.prototype.getbUNO=function(){return this._bUNO},CGameBase.prototype.cardCanBePlayed=function(e,t){if(e.getFotogram()===FOTOGRAM_DRAW_FOUR){for(var n=!1,i=0;i<this._aPlayersHand[t].getLength();i++){var o=this._aPlayersHand[t].getCardByIndex(i);if(o.getFotogram()!==FOTOGRAM_DRAW_FOUR&&(o.getRank()===this._oUsedCards.getLastCard().getRank()||o.getSuit()===this._iCurrentColor||o.getFotogram()===FOTOGRAM_COLOR)){n=!0;break}}n=!n}else n=e.getFotogram()===FOTOGRAM_COLOR||this.cardMatchTheWaste(e);return n},CGameBase.prototype.cardMatchTheWaste=function(e){var t=!1;return e.getRank()!==this._oUsedCards.getLastCard().getRank()&&e.getSuit()!==this._iCurrentColor&&e.getFotogram()!==FOTOGRAM_COLOR&&e.getFotogram()!==FOTOGRAM_DRAW_FOUR||(t=!0),t},CGameBase.prototype.playerCanPlay=function(e){for(var t=!1,n=0;n<this._aPlayersHand[e].getLength();n++){var i=this._aPlayersHand[e].getCardByIndex(n);if(this.cardMatchTheWaste(i)){t=!0;break}}return t},CGameBase.prototype.shuffle=function(e){var t;for(t=e.length;t;t--){var n=Math.floor(Math.random()*t),i=e[t-1];e[t-1]=e[n],e[n]=i}},CGameBase.prototype.unload=function(){this._oUnoController.unload(),this._oInterface.unload(),this._oSummaryPanel.unload(),this._oMsgBox.unload(),createjs.Tween.removeAllTweens(),s_oStage.removeAllChildren()},CGameBase.prototype.gameOver=function(e){this.setOffTurn(),this._showAllPlayersCards(),this._showAllPlayersMatchScore();var t=this._calculateMatchScore(),n=this._aPlayersHand[e].getScore()+t;this._aPlayersHand[e].setOnTurn(),this._aPlayersHand[e].setScore(n);var i=this._getPlayersRank();this._oSummaryPanel.setAndShow(i,e,t),n>=GAME_SCORE_WIN&&(this._bEndGame=!0,this._oSummaryPanel.endMode(sprintf(TEXT_PLAYER_WON,this._aPlayersHand[e].getName())),$(s_oMain).trigger("share_event",n))},CGameBase.prototype.checkWinner=function(){for(var e=null,t=0;t<this._aPlayersHand.length;t++)if(0===this._aPlayersHand[t].getLength()){e=t;break}return e},CGameBase.prototype._calculateMatchScore=function(){for(var e=0,t=0;t<this._aPlayersHand.length;t++)e+=this._aPlayersHand[t].calculateHandScore();return e},CGameBase.prototype._showAllPlayersCards=function(){for(var e=0;e<this._aPlayersHand.length;e++)this._aPlayersHand[e].getSide()!==BOTTOM&&this._aPlayersHand[e].showAllCards()},CGameBase.prototype._showAllPlayersMatchScore=function(){for(var e=0;e<this._aPlayersHand.length;e++){var t=this._aPlayersHand[e].calculateHandScore();0<this._aPlayersHand[e].getLength()?this._aPlayersHand[e].showHandScore(sprintf(TEXT_PTS_TO_WINNER,t)):this._aPlayersHand[e].showHandScore(TEXT_WINNER)}},CGameBase.prototype._getPlayersRank=function(){for(var e=[],t=0;t<this._aPlayersHand.length;t++){var n=this._aPlayersHand[t].getName(),i=this._aPlayersHand[t].getScore();e.push({name:n,score:i,index:t})}return e.sort((function(e,t){return e.score>t.score?-1:1})),e},CGameBase.prototype.matchCanStart=function(){for(var e=!1,t=0,n=0;n<this._aPlayersHand.length;n++)this._aPlayersHand[n].getLength()===STARTING_NUM_CARDS&&t++;return t===NUM_PLAYERS&&(e=!0),e},CGameBase.prototype._checkUnoNotify=function(e,t,n){e&&(n===t?(e=sprintf(TEXT_ALERT_1,NUM_PENALTY_CARDS),this._oUnoController.unoAnimation()):(e=this._aPlayersHand[n].getName().toUpperCase(),e=sprintf(TEXT_ALERT_2,e,NUM_PENALTY_CARDS)),this._oUnoController.showAlertMsg(e))},CGameBase.prototype.canCardBeShown=function(e){return this._aPlayersHand[e].getSide()===BOTTOM||DEBUG_SHOW_CARDS},CGameBase.prototype.getPlayersHand=function(e){return this._aPlayersHand[e]},CGameBase.prototype.getCurColor=function(e){return this._iCurrentColor},CGameBase.prototype.getLastCard=function(e){return this._oUsedCards.getLastCard()},CGameBase.prototype.update=function(){},CGameBase.prototype._onCheck=function(){this._oSummaryPanel.hide()};var CGameSingle=function(e){CGameBase.call(this,e),this._init()};CGameSingle.prototype=Object.create(CGameBase.prototype),CGameSingle.prototype._init=function(){CGameBase.prototype._init(),!0===s_bFirstGame?new CPanelTutorial:this._startGame()},CGameSingle.prototype._startGame=function(){this._oUnoController.setVisible(!0),this._oUnoController.addEventListener(ON_APPLY_EFFECT,this.applyEffectOnCard,this),this._oUnoController.addEventListener(ON_APPLY_PENALITY,this.applyPenality,this),this._oUnoController.addEventListener(ON_UNO_CLICK,this._onUnoClick,this),this._oSummaryPanel.addEventListener(ON_NEXT,this._onConfirmNextMatch,this),this._oSummaryPanel.addEventListener(ON_HOME,this.onExit,this),this._oMsgBox.addEventListener(ON_HOME,this.onExit,this),this._setPieces()},CGameSingle.prototype._setPieces=function(){this._oDeck.initializeDeck(),this._oDeck.shuffle(),this.getFirstHand()},CGameSingle.prototype.setNewGame=function(){for(var e=0;e<this._aPlayersHand.length;e++)this._aPlayersHand[e].setScore(0);this._oTurnManager.resetFirstPlayer()},CGameSingle.prototype.restart=function(){this.reset(),this._setPieces()},CGameSingle.prototype._checkFirstCardEffect=function(e){switch(e){case EFFECT_SELECT_COLOR:this._oTurnManager.nextTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._applySelectColor(),this._oTurnManager.prevTurn();break;case EFFECT_DRAW_FOUR:this._oTurnManager.nextTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._iNextPlayer=this._iCurPlayer=this._oTurnManager.getTurn(),this._applyDrawThreeEffect(),this._oTurnManager.prevTurn();break;case EFFECT_STOP:this._applyStopTurn();break;case EFFECT_INVERT_TURN:2!==NUM_PLAYERS&&this._oTurnManager.nextTurn(),this._applyInvertTurn();break;case EFFECT_DRAW_TWO_COLORED:this._applyDrawTwoColored();break;default:this._oTurnManager.nextTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),0===this._iCurPlayer?(this.onInputPlayer(this._iCurPlayer),this._oDeck.enableInputDraw()):this._oAIManager.selectACard(this._iCurPlayer),this._aPlayersHand[this._iCurPlayer].setOnTurn()}},CGameSingle.prototype.onNextTurn=function(){this._bUNO=!1;var e=this.checkWinner();null!==e?(this.gameOver(e),0===e&&$(s_oMain).trigger("save_score",this._calculateMatchScore())):(this.setOffTurn(),this._oDeck.enableInputDraw(),this._oTurnManager.nextTurn(),this._iCurPlayer=e=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._aPlayersHand[e].setOnTurn(),0===e?(this.onInputPlayer(e),this.playerCanPlay(e)||this._oDeck.setHelp()):this._oAIManager.selectACard(e))},CGameSingle.prototype.playCard=function(e,t){var n=this._oTurnManager.getTurn(),i=!1;0===n&&(i=this.cardCanBePlayed(e,n)),i&&(this._oCardsContainer.addChildAt(this._oHandsContainer,this._oCardsContainer.numChildren),this._aPlayersHand[n].setOnTop(),this._oDeck.disableInputDraw(),this.offInputPlayer(0),n=this._aPlayersHand[n].getContainerPos(),i=this._oUsedCards.getGlobalPosition(),playSound("card",1,!1),e.moveCard(i.x-n.x,i.y-n.y,300),e.showCard(),this._oUsedCards.setChildDepth(2))},CGameSingle.prototype.playedCard=function(e){var t=this._oTurnManager.getTurn(),n=this._aPlayersHand[t].searchIndexCard(e);this._oUsedCards.pushCard(new CCard(0,0,this._oUsedCards.getContainer(),e.getFotogram(),e.getRank(),e.getSuit(),e.getUniqueID())),this._oUsedCards.disableInputUsedCards(),this._oUsedCards.getLastCard().instantShow(),this._aPlayersHand[t].removeCardByIndex(n),e.unload(),4!==this._oUsedCards.getLastCard().getSuit()&&(this._iCurrentColor=this._oUsedCards.getLastCard().getSuit(),this._oInterface.refreshColor(this._iCurrentColor)),this._aPlayersHand[t].organizeHand(n),this.checkUno(e.getEffect()),0!==t&&this._onUnoClick()},CGameSingle.prototype._onUnoClick=function(){!0===this._bUNO&&(this._bUNO=!1,this._aPlayersHand[this._iCurPlayer].checkUno())},CGameSingle.prototype.applyEffectOnCard=function(e){this._checkEffect(e)},CGameSingle.prototype._applySelectColor=function(){if(0===this._iCurPlayer)new CSelectColorPanel(EFFECT_SELECT_COLOR).addEventListener(ON_COLOR_SELECTED,(function(e){this._onActionSelectColor({colorindex:e})}),this);else{var e={colorindex:this._oAIManager.onSelectColorCpu(this._iCurPlayer)};this._onActionSelectColor(e)}},CGameSingle.prototype._applyDrawThreeEffect=function(){if(0===this._iCurPlayer)new CSelectColorPanel(EFFECT_DRAW_FOUR).addEventListener(ON_COLOR_SELECTED,(function(e){this._onActionDrawThree({playerindex:this._iNextPlayer,colorindex:e})}),this);else{var e=this._oAIManager.onSelectColorCpu(this._iCurPlayer);this._onActionDrawThree({playerindex:this._iNextPlayer,colorindex:e})}},CGameSingle.prototype._applyStopTurn=function(){var e=this;this._oAnimation.stopTurn().then((function(){e._oTurnManager.nextTurn(),e._notifyChangeTurn()}))},CGameSingle.prototype._applyInvertTurn=function(){var e=this;this._oTurnManager.changeClockWise(),2===NUM_PLAYERS&&this._oTurnManager.nextTurn(),this._oAnimation.changeClockWise(s_oGame._oTurnManager.getClockWise()).then((function(){e._notifyChangeTurn()}))},CGameSingle.prototype._applyDrawTwoColored=function(){this.drawCards(this._iNextPlayer,2,0,DRAW_TYPE_DRAW2_COLORED)},CGameSingle.prototype._applyNormalCardEffect=function(){this._notifyChangeTurn()},CGameSingle.prototype.drawCards=function(e,t,n,i){this._checkUnoNotify(i===DRAW_TYPE_PENALITY,0,e),this._checkNumberCardsToDraw(e,t,n,i)},CGameSingle.prototype._notifyChangeTurn=function(){s_oGame.onNextTurn()},CGameSingle.prototype.shuffleCards=function(e,t,n,i){for(var o=this,a=this._oUsedCards.removeAllCardUnderTheDeck(),r=[],s=0;s<a.length;s++)r.push(a[s].getFotogram());this._oAnimation.shuffleAnimation().then((function(){shuffle(r),o._oDeck.clearCards(),o._oDeck.initializeFromData(r),o.checkForMoreDraws(e,t,n,i)}))},CGameSingle.prototype._onAllCardsDrawCompleted=function(e,t){this._checkEffectAfterDrawCompleted(e,t)},CGameSingle.prototype._checkIfCanStillPlayTheTurn=function(e){this.playerCanPlay(e)?(this.onInputPlayer(e),0!==this._iCurPlayer&&this._oAIManager.selectACard(this._iCurPlayer)):(this._aPlayersHand[e].centerContainer(),this._notifyChangeTurn())},CGameSingle.prototype._onActionDrawThree=function(e){var t=this;this._iCurrentColor=e.colorindex,this._oAnimation.changeColor(this._iCurrentColor).then((function(){t._oInterface.refreshColor(t._iCurrentColor),t.drawCards(e.playerindex,3,0,DRAW_TYPE_DRAW3)}))},CGameSingle.prototype._onActionSelectColor=function(e){var t=this;this._iCurrentColor=e.colorindex,this._oAnimation.changeColor(this._iCurrentColor).then((function(){t._oInterface.refreshColor(t._iCurrentColor),t._notifyChangeTurn()}))},CGameSingle.prototype._onConfirmNextMatch=function(){$(s_oMain).trigger("show_interlevel_ad"),this._bEndGame&&(this._bEndGame=!1,this.setNewGame()),this.restart()},CGameSingle.prototype.onExit=function(){s_oGame.unload(),s_oMain.gotoMenu(),$(s_oMain).trigger("end_session"),$(s_oMain).trigger("show_interlevel_ad")};var CGameSingleWithBot=function(e){CGameSingle.call(this,e)};CGameSingleWithBot.prototype=Object.create(CGameSingle.prototype),CGameSingleWithBot.prototype._startGame=function(){this._oUnoController.setVisible(!0),this._oUnoController.addEventListener(ON_APPLY_EFFECT,this.applyEffectOnCard,this),this._oUnoController.addEventListener(ON_APPLY_PENALITY,this.applyPenality,this),this._oUnoController.addEventListener(ON_UNO_CLICK,this._onUnoClick,this),this._oSummaryPanel.addEventListener(ON_NEXT,this._onConfirmNextMatch,this),this._oSummaryPanel.addEventListener(ON_HOME,this.onExit,this),this._oMsgBox.addEventListener(ON_HOME,this.onExit,this),this._setPieces(),this._aPlayersHand[0].changeName(s_oNetworkManager.getPlayerNickname()),this._aPlayersHand[1].changeName(s_oNetworkManager.getBotName())},CGameSingleWithBot.prototype._onConfirmNextMatch=function(){$(s_oMain).trigger("show_interlevel_ad"),s_oGame._oSummaryPanel.waitingMode();var e=randomFloatBetween(200,2e3);setTimeout((function(){s_oGame._bEndGame?.4<Math.random()?s_oGame.onOpponentAcceptNextMatch():s_oGame.opponentLeftTheGame():s_oGame.onOpponentAcceptNextMatch()}),e)},CGameSingleWithBot.prototype.onOpponentAcceptNextMatch=function(){this._bEndGame&&(this._bEndGame=!1,this.setNewGame()),this.restart()},CGameSingleWithBot.prototype.opponentLeftTheGame=function(){var e=s_oNetworkManager.getBotName();this._oSummaryPanel.isShown()?this._oSummaryPanel.playerQuitMode(sprintf(TEXT_QUIT_FROM_GAME,e)):this._oMsgBox.isShown()||(this._oSummaryPanel.hide(),this._oMsgBox.show(sprintf(TEXT_QUIT_FROM_GAME,e)))};var CGameMulti=function(e){CGameBase.call(this,e),this._bActionInProgress,this._aMessageQueue,this._init()};function CInterface(){var e,t,n,i,o,a,r,s,l,c,u,h,d,_=null,p=null;return this._init=function(){d=new createjs.Container;var f=s_oSpriteLibrary.getSprite("but_exit");o=CANVAS_WIDTH-f.height/2-10,a=f.height/2+10,(c=new CGfxButton(o,a,f,d)).addEventListener(ON_MOUSE_UP,this._onExit,this),n=CANVAS_WIDTH-f.width/2-100,i=f.height/2+10,!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(f=s_oSpriteLibrary.getSprite("audio_icon"),(l=new CToggle(n,i,f,s_bAudioActive,d)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this));var g=(f=window.document).documentElement;_=g.requestFullscreen||g.mozRequestFullScreen||g.webkitRequestFullScreen||g.msRequestFullscreen,p=f.exitFullscreen||f.mozCancelFullScreen||f.webkitExitFullscreen||f.msExitFullscreen,!1===ENABLE_FULLSCREEN&&(_=!1),_&&screenfull.isEnabled&&(f=s_oSpriteLibrary.getSprite("but_fullscreen"),e=f.width/4+10,t=f.height/2+10,(u=new CToggle(e,t,f,s_bFullscreen,d)).addEventListener(ON_MOUSE_UP,this._onFullscreen,this)),f=s_oSpriteLibrary.getSprite("colors"),f=new createjs.SpriteSheet({images:[f],frames:{width:103,height:102,regX:51.5,regY:51},animations:{red:[0],green:[1],blue:[2],yellow:[3]}}),r=CANVAS_WIDTH/2+220,s=CANVAS_HEIGHT/2-60,(h=new createjs.Sprite(f,0)).stop(),h.x=r,h.y=s,s_oStage.addChild(d),this.refreshButtonPos()},this.refreshColor=function(e){h.gotoAndStop(e),s_oStage.addChildAt(h,1)},this.unload=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(l.unload(),l=null),c.unload(),_&&screenfull.isEnabled&&u.unload(),s_oInterface=null},this.refreshButtonPos=function(){c.setPosition(o-s_iOffsetX,s_iOffsetY+a),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.setPosition(n-s_iOffsetX,s_iOffsetY+i),_&&screenfull.isEnabled&&u.setPosition(e+s_iOffsetX,t+s_iOffsetY)},this.setOnTop=function(){s_oStage.addChildAt(d,s_oStage.numChildren)},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},this._onExit=function(){new CAreYouSurePanel(s_oGame.onExit)},this._onRestart=function(){s_oGame.restart()},this.resetFullscreenBut=function(){_&&screenfull.isEnabled&&u.setActive(s_bFullscreen)},this._onFullscreen=function(){s_bFullscreen?p.call(window.document):_.call(window.document.documentElement),sizeHandler()},s_oInterface=this,this._init(),this}CGameMulti.prototype=Object.create(CGameBase.prototype),CGameMulti.prototype._init=function(){CGameBase.prototype._init(),this._startGame()},CGameMulti.prototype._startGame=function(){this._bActionInProgress=!0,this._aMessageQueue=[],this._oUnoController.addEventListener(ON_APPLY_EFFECT,this.applyEffectOnCard,this),this._oUnoController.addEventListener(ON_APPLY_PENALITY,this.applyPenality,this),this._oUnoController.addEventListener(ON_UNO_CLICK,this._onUnoClick,this),this._oSummaryPanel.addEventListener(ON_NEXT,this._onConfirmNextMatch,this),this._oSummaryPanel.addEventListener(ON_HOME,this.onExit,this),this._oMsgBox.addEventListener(ON_HOME,this.onExit,this),this._initHandPlayers(),s_oNetworkManager.addEventListener(ON_STATUS_OFFLINE,this._onConnectionCrashed,this),s_oNetworkManager.sendMsg(MSG_REQUEST_PIECES,"")},CGameMulti.prototype.setNewGame=function(){for(var e=0;e<this._aPlayersHand.length;e++)this._aPlayersHand[e].setScore(0);this._oTurnManager.resetFirstPlayer()},CGameMulti.prototype.restart=function(){this.reset(),s_oNetworkManager.sendMsg(MSG_REQUEST_PIECES,"")},CGameMulti.prototype._initHandPlayers=function(){for(var e=HAND_POS["num_player_"+NUM_PLAYERS],t=[],n=0;n<e.length;n++){var i=e[n];t.push({x:i.x,y:i.y,side:i.side})}for(i=s_oNetworkManager.getPlayerOrderID(),n=0;n<i;n++)e=t.pop(),t.splice(0,0,e);for(n=0;n<NUM_PLAYERS;n++){var o=e=0;(i=t[n]).x===CANVAS_WIDTH/2?e=CARD_WIDTH/2:o=CARD_HEIGHT/4,this._aPlayersHand[n].setPosition(e,o,t[n].x,t[n].y,t[n].side),this._aPlayersHand[n].changeName(s_oNetworkManager.getNicknameByID(n))}},CGameMulti.prototype._onPiecesReceived=function(e){this._oUnoController.setVisible(!0),this._oDeck.initializeFromData(e),this.getFirstHand()},CGameMulti.prototype._checkFirstCardEffect=function(e){switch(e){case EFFECT_SELECT_COLOR:this.onActionStop(),this._oTurnManager.nextTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._iCurPlayer===s_oNetworkManager.getPlayerOrderID()&&this._applySelectColor(),this._oTurnManager.prevTurn();break;case EFFECT_DRAW_FOUR:this.onActionStop(),this._oTurnManager.nextTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._iCurPlayer===s_oNetworkManager.getPlayerOrderID()&&(this._applyDrawThreeEffect(),this._iNextPlayer=this._iCurPlayer=this._oTurnManager.getTurn()),this._oTurnManager.prevTurn();break;case EFFECT_STOP:this._onActionBlockTurn();break;case EFFECT_INVERT_TURN:2!==NUM_PLAYERS&&this._oTurnManager.nextTurn(),this._onActionInvertTurn();break;case EFFECT_DRAW_TWO_COLORED:this._onActionDrawTwoColored({playerindex:this._iNextPlayer});break;default:this._oTurnManager.nextTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._iCurPlayer===s_oNetworkManager.getPlayerOrderID()&&(this.onInputPlayer(this._iCurPlayer),this._oDeck.enableInputDraw()),this._aPlayersHand[this._iCurPlayer].setOnTurn(),this.onActionStop()}},CGameMulti.prototype.onNextTurn=function(){this._bUNO=!1;var e=this.checkWinner();null!==e?this.gameOver(e):(this.setOffTurn(),this._oDeck.enableInputDraw(),this._oTurnManager.nextTurn(),this._iCurPlayer=e=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._aPlayersHand[e].setOnTurn(),e===s_oNetworkManager.getPlayerOrderID()&&(this.onInputPlayer(e),this.playerCanPlay(e)||this._oDeck.setHelp())),this.onActionStop()},CGameMulti.prototype.playCard=function(e,t){var n=this._oTurnManager.getTurn(),i=!1,o=s_oNetworkManager.getPlayerOrderID();n===o&&(i=this.cardCanBePlayed(e,n)),i&&(this._oCardsContainer.addChildAt(this._oHandsContainer,this._oCardsContainer.numChildren),this._aPlayersHand[n].setOnTop(),this._oDeck.disableInputDraw(),this.offInputPlayer(o),n=e.getUniqueID(),s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify({action:ACTION_USE_CARD,playerindex:o,cardindex:n})))},CGameMulti.prototype.playedCard=function(e){var t=this._oTurnManager.getTurn(),n=this._aPlayersHand[t].searchIndexCard(e);this._oUsedCards.pushCard(new CCard(0,0,this._oUsedCards.getContainer(),e.getFotogram(),e.getRank(),e.getSuit(),e.getUniqueID())),this._oUsedCards.disableInputUsedCards(),this._oUsedCards.getLastCard().instantShow(),this._aPlayersHand[t].removeCardByIndex(n),e.unload(),4!==this._oUsedCards.getLastCard().getSuit()&&(this._iCurrentColor=this._oUsedCards.getLastCard().getSuit(),this._oInterface.refreshColor(this._iCurrentColor)),this._aPlayersHand[t].organizeHand(n),this.onActionStop(),t===s_oNetworkManager.getPlayerOrderID()&&this.checkUno(e.getEffect())},CGameMulti.prototype._onUnoClick=function(){!0===this._bUNO&&(this._bUNO=!1,this._aPlayersHand[this._iCurPlayer].checkUno(),s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify({action:ACTION_ON_UNO_CLICK,playerindex:this._iCurPlayer})))},CGameMulti.prototype.applyEffectOnCard=function(e){this._iCurPlayer===s_oNetworkManager.getPlayerOrderID()&&this._checkEffect(e)},CGameMulti.prototype._applySelectColor=function(){new CSelectColorPanel(EFFECT_SELECT_COLOR).addEventListener(ON_COLOR_SELECTED,(function(e){e={action:ACTION_SELECT_COLOR,playerindex:s_oNetworkManager.getPlayerOrderID(),colorindex:e},s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify(e))}),this)},CGameMulti.prototype._applyDrawThreeEffect=function(){new CSelectColorPanel(EFFECT_DRAW_FOUR).addEventListener(ON_COLOR_SELECTED,(function(e){s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify({action:ACTION_DRAW_FOUR,playerindex:this._iNextPlayer,colorindex:e}))}),this)},CGameMulti.prototype._applyStopTurn=function(){s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify({action:ACTION_BLOCK_TURN}))},CGameMulti.prototype._applyInvertTurn=function(){s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify({action:ACTION_INVERT_TURN}))},CGameMulti.prototype._applyDrawTwoColored=function(){s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify({action:ACTION_DRAW_TWO_COLORED,playerindex:this._iNextPlayer}))},CGameMulti.prototype._applyNormalCardEffect=function(){this._notifyChangeTurn()},CGameMulti.prototype._notifyChangeTurn=function(){if(this._iCurPlayer===s_oNetworkManager.getPlayerOrderID()){var e={action:ACTION_NEXT_TURN,playerindex:s_oNetworkManager.getPlayerOrderID()};s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify(e))}},CGameMulti.prototype.shuffleCards=function(e,t,n,i){for(var o=this,a=this._oUsedCards.removeAllCardUnderTheDeck(),r=[],s=0;s<a.length;s++)r.push(a[s].getFotogram());this._oAnimation.shuffleAnimation().then((function(){o.onActionStop(),o._iCurPlayer===s_oNetworkManager.getPlayerOrderID()&&(shuffle(r),s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify({action:ACTION_ON_SHUFFLECARDS,playerindex:e,numberofcards:t,delay:n,drawtype:i,cards:r})))}))},CGameMulti.prototype.drawCards=function(e,t,n,i){s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify({action:ACTION_ON_DRAWCARDS,playerindex:e,numberofcards:t,delay:n,drawtype:i}))},CGameMulti.prototype._onAllCardsDrawCompleted=function(e,t){this._checkEffectAfterDrawCompleted(e,t),this.onActionStop()},CGameMulti.prototype._checkIfCanStillPlayTheTurn=function(e){this.playerCanPlay(e)?this.onInputPlayer(e):(this._aPlayersHand[e].centerContainer(),this._notifyChangeTurn())},CGameMulti.prototype.onActionReceived=function(e){this._aMessageQueue.push(e),this._evaluateMessageQueue()},CGameMulti.prototype.onActionStop=function(){this._bActionInProgress=!1,this._evaluateMessageQueue()},CGameMulti.prototype._evaluateMessageQueue=function(){if(0!==this._aMessageQueue.length&&!this._bActionInProgress){this._bActionInProgress=!0;var e=this._aMessageQueue.shift();switch(e.action){case ACTION_NEXT_TURN:this.onNextTurn();break;case ACTION_USE_CARD:this._onActionPlayCard(e);break;case ACTION_ON_SHUFFLECARDS:this._onActionShuffleCard(e);break;case ACTION_ON_DRAWCARDS:this._onActionDrawCards(e);break;case ACTION_ON_UNO_CLICK:this._onActionUnoClick(e);break;case ACTION_SELECT_COLOR:this._onActionSelectColor(e);break;case ACTION_DRAW_FOUR:this._onActionDrawThree(e);break;case ACTION_BLOCK_TURN:this._onActionBlockTurn(e);break;case ACTION_INVERT_TURN:this._onActionInvertTurn(e);break;case ACTION_DRAW_TWO_COLORED:this._onActionDrawTwoColored(e)}}},CGameMulti.prototype._onActionPlayCard=function(e){var t=e.playerindex,n=this._aPlayersHand[t].getContainerPos(),i=this._oUsedCards.getGlobalPosition();e=this._aPlayersHand[t].getCardByUniqueID(e.cardindex),playSound("card",1,!1),e.moveCard(i.x-n.x,i.y-n.y,300),e.showCard(),this._oUsedCards.setChildDepth(2)},CGameMulti.prototype._onActionShuffleCard=function(e){var t=e.playerindex,n=e.numberofcards,i=e.delay,o=e.drawtype;e=e.cards,this._oDeck.clearCards(),this._oDeck.initializeFromData(e),this.checkForMoreDraws(t,n,i,o)},CGameMulti.prototype._onActionDrawCards=function(e){var t=e.drawtype,n=e.numberofcards,i=e.delay;e=e.playerindex,this._checkUnoNotify(t===DRAW_TYPE_PENALITY,s_oNetworkManager.getPlayerOrderID(),e),this._checkNumberCardsToDraw(e,n,i,t)},CGameMulti.prototype._onActionUnoClick=function(e){this._aPlayersHand[e.playerindex].checkUno(),this.onActionStop()},CGameMulti.prototype._onActionSelectColor=function(e){var t=this;this._iCurrentColor=e.colorindex,this._oAnimation.changeColor(this._iCurrentColor).then((function(){t._oInterface.refreshColor(t._iCurrentColor),t._notifyChangeTurn(),t.onActionStop()}))},CGameMulti.prototype._onActionDrawThree=function(e){var t=this;this._iCurrentColor=e.colorindex,this._oAnimation.changeColor(this._iCurrentColor).then((function(){t._oInterface.refreshColor(t._iCurrentColor),e={playerindex:e.playerindex,numberofcards:3,delay:0,drawtype:DRAW_TYPE_DRAW3},t._onActionDrawCards(e)}))},CGameMulti.prototype._onActionBlockTurn=function(e){var t=this;this._oAnimation.stopTurn().then((function(){t._oTurnManager.nextTurn(),t._notifyChangeTurn(),t.onActionStop()}))},CGameMulti.prototype._onActionInvertTurn=function(e){var t=this;this._oTurnManager.changeClockWise(),2===NUM_PLAYERS&&this._oTurnManager.nextTurn(),this._oAnimation.changeClockWise(s_oGame._oTurnManager.getClockWise()).then((function(){t._notifyChangeTurn(),t.onActionStop()}))},CGameMulti.prototype._onActionDrawTwoColored=function(e){e={playerindex:e.playerindex,numberofcards:2,delay:0,drawtype:DRAW_TYPE_DRAW2_COLORED},this._onActionDrawCards(e)},CGameMulti.prototype.onExit=function(){s_oGame.unload(),s_oMain.gotoMenu(),$(s_oMain).trigger("end_session"),$(s_oMain).trigger("show_interlevel_ad"),s_oNetworkManager.disconnect()},CGameMulti.prototype._onConfirmNextMatch=function(){$(s_oMain).trigger("show_interlevel_ad"),this._oSummaryPanel.waitingMode(),s_oNetworkManager.sendMsg(MSG_ACCEPT_NEXTMATCH,"")},CGameMulti.prototype.onOpponentAcceptNextMatch=function(){this._bEndGame&&(this._bEndGame=!1,this.setNewGame()),this.restart()},CGameMulti.prototype.opponentLeftTheGame=function(e){e=s_oNetworkManager.getNicknameByID(e),this._oSummaryPanel.isShown()?this._oSummaryPanel.playerQuitMode(sprintf(TEXT_QUIT_FROM_GAME,e)):this._oMsgBox.isShown()||(this._oSummaryPanel.hide(),this._oMsgBox.show(sprintf(TEXT_QUIT_FROM_GAME,e)))},CGameMulti.prototype._onConnectionCrashed=function(){this._oSummaryPanel.hide(),this._oMsgBox.show(TEXT_SOMETHING_WENT_WRONG)};var s_oInterface=null;function CCreditsPanel(){var e,t,n,i,o;this._init=function(){(t=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),t.alpha=0,t.on("mousedown",(function(){})),s_oStage.addChild(t),new createjs.Tween.get(t).to({alpha:.7},500),n=new createjs.Container,s_oStage.addChild(n);var a=s_oSpriteLibrary.getSprite("credits_panel"),r=createBitmap(a);r.regX=a.width/2,r.regY=a.height/2,n.addChild(r),n.x=CANVAS_WIDTH/2,n.y=CANVAS_HEIGHT+a.height/2,e=n.y,new createjs.Tween.get(n).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.quartIn),(r=new createjs.Text(TEXT_DEVELOPED,"20px "+PRIMARY_FONT,"#ffffff")).y=-a.height/2+80,r.textAlign="center",r.textBaseline="middle",r.lineWidth=300,n.addChild(r),(a=new createjs.Text("codethislab","30px "+PRIMARY_FONT,"#ffffff")).y=80,a.textAlign="center",a.textBaseline="middle",a.lineWidth=500,n.addChild(a),a=s_oSpriteLibrary.getSprite("ctl_logo"),(o=createBitmap(a)).regX=a.width/2,o.regY=a.height/2,n.addChild(o),a=s_oSpriteLibrary.getSprite("but_exit"),(i=new CGfxButton(230,-107,a,n)).addEventListener(ON_MOUSE_UP,this.unload,this)},this.unload=function(){i.setClickable(!1),new createjs.Tween.get(t).to({alpha:0},500),new createjs.Tween.get(n).to({y:e},400,createjs.Ease.backIn).call((function(){s_oStage.removeChild(t),s_oStage.removeChild(n),i.unload()})),t.off("mousedown",(function(){}))},this._init()}function CSelectColorPanel(e){var t,n,i,o,a,r,s,l,c,u,h=this;this._init=function(){n=[],i=[],e===EFFECT_SELECT_COLOR&&playSound("special_card",.5,!1),(o=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),o.alpha=0,o.on("mousedown",(function(){})),s_oStage.addChild(o),new createjs.Tween.get(o,{override:!0}).to({alpha:.7},500),a=new createjs.Container,s_oStage.addChild(a),r=new createjs.Container,a.addChild(r);var d=s_oSpriteLibrary.getSprite("select_color_panel"),_=createBitmap(d);_.regX=d.width/2,_.regY=d.height/2,a.addChildAt(_,0),a.x=CANVAS_WIDTH/2,a.y=CANVAS_HEIGHT+d.height/2,t=a.y,new createjs.Tween.get(a,{override:!0}).to({y:CANVAS_HEIGHT/2-40},600,createjs.Ease.backOut),new CTLText(a,-250,-d.height/2+10,500,110,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SELECT_COLOR,!0,!0,!0,!1),r.y=a.getBounds().height/5,d=s_oSpriteLibrary.getSprite("but_red"),(s=new CGfxButton(-190,-20,d,r)).addEventListener(ON_MOUSE_UP,(function(){h.onSelectColor(0)})),d=s_oSpriteLibrary.getSprite("but_green"),(l=new CGfxButton(-65,-20,d,r)).addEventListener(ON_MOUSE_UP,(function(){h.onSelectColor(1)})),d=s_oSpriteLibrary.getSprite("but_blue"),(c=new CGfxButton(65,-20,d,r)).addEventListener(ON_MOUSE_UP,(function(){h.onSelectColor(2)})),d=s_oSpriteLibrary.getSprite("but_yellow"),(u=new CGfxButton(190,-20,d,r)).addEventListener(ON_MOUSE_UP,(function(){h.onSelectColor(3)}))},this.unload=function(){s_oStage.removeChild(o),s_oStage.removeChild(a),s.unload(),l.unload(),c.unload(),u.unload(),o.off("mousedown",(function(){}))},this.disableButtons=function(){s.setClickable(!1),l.setClickable(!1),c.setClickable(!1),u.setClickable(!1)},this.addEventListener=function(e,t,o){n[e]=t,i[e]=o},this.onSelectColor=function(r){new createjs.Tween.get(o,{override:!0}).to({alpha:0},500),new createjs.Tween.get(a,{override:!0}).to({y:t},400,createjs.Ease.backIn),h.disableButtons(),n[ON_COLOR_SELECTED]&&n[ON_COLOR_SELECTED].call(i[ON_COLOR_SELECTED],r,e)},h=this,this._init()}function CAreYouSurePanel(e){var t,n,i,o,a;this._init=function(e){(o=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),o.alpha=0,o.on("mousedown",(function(){})),s_oStage.addChild(o),new createjs.Tween.get(o).to({alpha:.7},500),a=new createjs.Container,s_oStage.addChildAt(a,s_oStage.numChildren);var r=createBitmap(e=s_oSpriteLibrary.getSprite("credits_panel"));r.regX=e.width/2,r.regY=e.height/2,a.addChild(r),a.x=CANVAS_WIDTH/2,a.y=CANVAS_HEIGHT+e.height/2,t=a.y,new createjs.Tween.get(a).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.quartIn).call((function(){})),new CTLText(a,-250,-130,500,150,50,"center","#000000",PRIMARY_FONT,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1).setOutline(5),new CTLText(a,-250,-130,500,150,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1),(n=new CGfxButton(110,80,s_oSpriteLibrary.getSprite("but_yes_big"),a)).addEventListener(ON_MOUSE_UP,this._onButYes,this),(i=new CGfxButton(-110,80,s_oSpriteLibrary.getSprite("but_exit_big"),a)).addEventListener(ON_MOUSE_UP,this._onButNo,this)},this._onButYes=function(){i.setClickable(!1),n.setClickable(!1),new createjs.Tween.get(o).to({alpha:0},500),new createjs.Tween.get(a).to({y:t},400,createjs.Ease.backIn).call((function(){e(),r.unload()}))},this._onButNo=function(){i.setClickable(!1),n.setClickable(!1),new createjs.Tween.get(o).to({alpha:0},500),new createjs.Tween.get(a).to({y:t},400,createjs.Ease.backIn).call((function(){r.unload()}))},this.unload=function(){i.unload(),n.unload(),s_oStage.removeChild(o),s_oStage.removeChild(a),o.off("mousedown",(function(){}))};var r=this;this._init(e)}function CAIManager(){this._init=function(){},this.unload=function(){},this.onSelectColorCpu=function(e){e=s_oGame.getPlayersHand(e);for(var t,n=[{iColor:0,iPoints:0},{iColor:1,iPoints:0},{iColor:2,iPoints:0},{iColor:3,iPoints:0}],i=0;i<e.getLength();i++){t=e.getCardByIndex(i);for(var o=0;o<n.length;o++)t.getSuit()===o&&n[o].iPoints++}return n.sort((function(e,t){return parseFloat(t.iPoints)-parseFloat(e.iPoints)})),n[0].iColor},this.selectACard=function(e){for(var t=s_oGame.getPlayersHand(e),n=s_oGame.getCurColor(),i=s_oGame.getLastCard(),o=[],a=0;a<t.getLength();a++)4===t.getCardByIndex(a).getSuit()||t.getCardByIndex(a).getRank()!==i.getRank()&&t.getCardByIndex(a).getSuit()!==n?t.getCardByIndex(a).getFotogram()===FOTOGRAM_COLOR?o.push({oCard:t.getCardByIndex(a),iValue:2}):t.getCardByIndex(a).getFotogram()===FOTOGRAM_DRAW_FOUR&&o.push({oCard:t.getCardByIndex(a),iValue:1}):12===t.getCardByIndex(a).getRank()?o.push({oCard:t.getCardByIndex(a),iValue:6}):10===t.getCardByIndex(a).getRank()?o.push({oCard:t.getCardByIndex(a),iValue:5}):11===t.getCardByIndex(a).getRank()?o.push({oCard:t.getCardByIndex(a),iValue:4}):o.push({oCard:t.getCardByIndex(a),iValue:3});0===o.length?s_oGame.drawCards(e,1,1e3,DRAW_TYPE_NORMAL):(o.sort((function(e,t){return parseFloat(t.iValue)-parseFloat(e.iValue)})),s_oGame.cpuPlayCard(o[0].oCard))},this._init()}function CUnoController(){var e,t,n,i,o;this._init=function(){e=[],t=[],(i=new createjs.Container).visible=!1,s_oStage.addChild(i);var a=s_oSpriteLibrary.getSprite("but_uno");(o=new CGfxButton(CANVAS_WIDTH/2+222,CANVAS_HEIGHT/2+70,a,i)).addEventListener(ON_MOUSE_UP,this._onButUno,this),(n=new CTLText(i,CANVAS_WIDTH/2+280,CANVAS_HEIGHT/2,200,150,50,"center","#fff",PRIMARY_FONT,1,0,0,sprintf(TEXT_ALERT_1,NUM_PENALTY_CARDS),!0,!0,!0,!1)).setAlpha(0)},this.unload=function(){o.unload()},this.addEventListener=function(n,i,o){e[n]=i,t[n]=o},this.setVisible=function(e){i.visible=e},this.check=function(e){!0===s_oGame.getbUNO()?setTimeout((function(){!0===s_oGame.getbUNO()?a._triggerPenality():a._triggerEffect(e)}),2e3):a._triggerEffect(e)},this._triggerPenality=function(){e[ON_APPLY_PENALITY]&&e[ON_APPLY_PENALITY].call(t[ON_APPLY_PENALITY])},this._triggerEffect=function(n){e[ON_APPLY_EFFECT]&&e[ON_APPLY_EFFECT].call(t[ON_APPLY_EFFECT],n)},this._onButUno=function(){e[ON_UNO_CLICK]&&e[ON_UNO_CLICK].call(t[ON_UNO_CLICK])},this.showAlertMsg=function(e){n.refreshText(e),createjs.Tween.get(n.getText()).to({alpha:1},400).wait(4e3).to({alpha:0},400).call((function(){o.removeAnimation()}))},this.unoAnimation=function(){o.trembleAnimation()};var a=this;this._init()}function CSummaryPanel(e){var t,n,i,o,a,r,s,l,c,u,h,d,_,p;this._init=function(){t=[],n=[],(a=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),a.alpha=0,a.on("mousedown",(function(){})),e.addChild(a),(s=new createjs.Container).alpha=0,s.visible=!1,e.addChild(s);var f=s_oSpriteLibrary.getSprite("msg_box");f=(r=createBitmap(f)).getBounds(),r.regX=f.width/2,r.regY=f.height/2,r.x=CANVAS_WIDTH/2,r.y=CANVAS_HEIGHT/2,s.addChild(r),(u=new createjs.Container).x=r.x,u.y=r.y-10,s.addChild(u);var g=NUM_PLAYERS;f=40*g,o=[];for(var m=0;m<g;m++)o[m]=new CPlayerInfo(0,0,u,"szPlayerName"),o[m].setPosition(0,-f/2+f/(g-1)*m,BOTTOM);i="#35bd1b",(c=new createjs.Text(0," 30px "+PRIMARY_FONT,i)).textBaseline="middle",u.addChild(c),l=new CTLText(s,(g=CANVAS_WIDTH/2)-250,(m=CANVAS_HEIGHT/2-185)-(f=150)/2,500,f,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SUMMARY,!0,!0,!0,!1),f=s_oSpriteLibrary.getSprite("cup_icon"),(h=createBitmap(f)).regX=f.width/2,h.regY=f.height/2,h.x=-300,h.y=o[0].getTextScorePos().y,h.visible=!1,u.addChild(h),f=s_oSpriteLibrary.getSprite("but_home"),(d=new CGfxButton(CANVAS_WIDTH/2-180,CANVAS_HEIGHT/2+170,f,s)).addEventListener(ON_MOUSE_DOWN,this._onExit,this),f=s_oSpriteLibrary.getSprite("but_show"),(_=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+170,f,s)).addEventListener(ON_MOUSE_DOWN,this._onShow,this),f=s_oSpriteLibrary.getSprite("but_next"),(p=new CGfxButton(CANVAS_WIDTH/2+180,CANVAS_HEIGHT/2+170,f,s)).addEventListener(ON_MOUSE_DOWN,this._onNext,this),p.pulseAnimation()},this.unload=function(){p.unload(),_.unload(),d.unload(),a.removeAllEventListeners(),s.removeAllEventListeners(),e.removeChild(a),e.removeChild(s)},this.addEventListener=function(e,i,o){t[e]=i,n[e]=o},this.setAndShow=function(e,t,n){s_bMobile||$("#div_display_id").css("display","block");for(var i=0;i<o.length;i++)if(o[i].setName(e[i].name),o[i].setScore(e[i].score+" /"+GAME_SCORE_WIN),e[i].index===t){var r=o[i].getTextScorePos();c.x=r.x+46,c.y=r.y+18,c.text="(+"+n+")",o[i].highlight()}playSound("game_over",1,!1),s.visible=!0,createjs.Tween.get(a).to({alpha:.7},500),createjs.Tween.get(s).to({alpha:1},500)},this.reset=function(){s.visible=!1,a.alpha=0,a.on("mousedown",(function(){})),h.visible=!1,l.setY(CANVAS_HEIGHT/2-185-75),l.refreshText(TEXT_SUMMARY),u.visible=!0,d.setX(CANVAS_WIDTH/2-180),_.setX(CANVAS_WIDTH/2),p.setX(CANVAS_WIDTH/2+180),d.setVisible(!0),_.setVisible(!0),p.setVisible(!0);var e=s_oSpriteLibrary.getSprite("but_next");for(p.setImage(e),e=0;e<o.length;e++)o[e].enable(),o[e].setNameColor("#FFF")},this.show=function(){s.visible=!0,a.alpha=.7,a.removeAllEventListeners(),a.on("mousedown",(function(){}))},this.hide=function(){s.visible=!1,a.alpha=.01,a.removeAllEventListeners(),a.on("mousedown",this.show,this)},this.waitingMode=function(){s.visible=!0,s.alpha=1,a.alpha=.7,u.visible=!1,l.refreshText(TEXT_WAIT_OPPONENT),l.setY(CANVAS_HEIGHT/2-50-75),d.setX(CANVAS_WIDTH/2-100),p.setVisible(!1),_.setX(CANVAS_WIDTH/2+100)},this.playerQuitMode=function(e){s.visible=!0,s.alpha=1,a.alpha=.7,l.refreshText(e.toUpperCase()),d.setX(CANVAS_WIDTH/2-100),p.setVisible(!1),_.setX(CANVAS_WIDTH/2+100)},this.endMode=function(e){s_bMobile||$("#div_display_id").css("display","block"),l.refreshText(e.toUpperCase()),e=s_oSpriteLibrary.getSprite("but_restart"),p.setImage(e),o[0].setNameColor(i),h.visible=!0},this.isShown=function(){return s.visible},this.stopTweens=function(){$("#div_display_id").css("display","none"),createjs.Tween.removeTweens(a),createjs.Tween.removeTweens(s)},this._onExit=function(){f.stopTweens(),t[ON_HOME]&&t[ON_HOME].call(n[ON_HOME])},this._onShow=function(){f.stopTweens(),t[ON_CHECK]&&t[ON_CHECK].call(n[ON_CHECK])},this._onNext=function(){f.stopTweens(),t[ON_NEXT]&&t[ON_NEXT].call(n[ON_NEXT])},this._init();var f=this;return this}function CPlayerInfo(e,t,n,i){var o,a,r,s,l,c,u,h,d,_,p;this._init=function(e,t,n,i){o=i,a=10,(c=new createjs.Container).x=e,c.y=t,n.addChild(c),u=new createjs.Container,c.addChild(u),e=s_oSpriteLibrary.getSprite("line_player"),r=e.width/2,s=e.height,e=new createjs.SpriteSheet({images:[e],frames:{width:r,height:s,regX:r/2,regY:s/2},animations:{off:[0],on:[1],idle:{frames:[0,1],speed:.1}}}),(h=createSprite(e,"off",r/2,s/2,r,s)).stop(),c.addChild(h),d=new CTLText(u,0,0,340,l=40,30,"left","#fff",PRIMARY_FONT,1,0,0,o,!0,!0,!1,!1),e=s_oSpriteLibrary.getSprite("score_icon"),(p=createBitmap(e)).regX=e.width/2,p.regY=e.height/2,u.addChild(p),_=new CTLText(u,0,0,100,l,30,"left","#fff",PRIMARY_FONT,1,0,0,"0",!0,!0,!1,!1)},this.unload=function(){n.removeChild(c)},this.highlight=function(){h.gotoAndStop("on"),u.alpha=1,createjs.Tween.get(d.getText(),{override:!0,loop:!0}).to({alpha:0},500,createjs.Ease.cubicIn).to({alpha:1},500,createjs.Ease.cubicOut).wait(500)},this.enable=function(){h.gotoAndStop("on"),d.setAlpha(1),u.alpha=1,createjs.Tween.removeTweens(d.getText())},this.disable=function(){h.gotoAndStop("off"),d.setAlpha(1),u.alpha=.15,createjs.Tween.removeTweens(d.getText())},this.setScore=function(e){_.refreshText(e)},this.setName=function(e){d.refreshText(e)},this.setPosition=function(e,t,n){switch(c.x=e,c.y=t,n){case BOTTOM:this._setBottom();break;case TOP:this._setTop();break;case LEFT:this._setLeft();break;case RIGHT:this._setRight()}},this._setBottom=function(){this._setNormalDir(),c.rotation=0},this._setTop=function(){this._setInverseDir(),c.rotation=0},this._setLeft=function(){this._setNormalDir(),c.rotation=90},this._setRight=function(){this._setInverseDir(),c.rotation=90},this._setNormalDir=function(){d.setAlign("left"),d.setPos(-r/2+a,-l),p.x=r/2-a-p.getBounds().width/2,p.y=d.getY()+l/2-2,_.setAlign("right"),_.setPos(p.x-p.getBounds().width/2-2,d.getY())},this._setInverseDir=function(){d.setAlign("right"),d.setPos(r/2-a,4),p.x=-r/2+a+p.getBounds().width/2,p.y=d.getY()+l/2-2,_.setAlign("left"),_.setPos(p.x+p.getBounds().width/2+2,d.getY())},this.getTextScorePos=function(){return{x:c.x+_.getX(),y:c.y+_.getY()}},this.setNameColor=function(e){d.setColor(e)},this._init(e,t,n,i)}function CInfoLabel(e,t,n){var i,o;this._init=function(e,t,n){(i=new createjs.Container).x=e,i.y=t,n.addChild(i),(t=createBitmap(e=s_oSpriteLibrary.getSprite("info_label"))).regX=e.width/2,t.regY=e.height/2,i.addChild(t),e=e.width-20,o=new CTLText(i,-e/2,-40,e,80,30,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_PTS_TO_WINNER,0),!0,!0,!0,!1),this.pulseAnimation()},this.setOnTop=function(){n.setChildIndex(i,n.numChildren-1)},this.setPosition=function(e,t,n){i.x=e,i.y=t},this.setTextScore=function(e){o.refreshText(e)},this.setVisible=function(e){i.visible=e},this.pulseAnimation=function(){createjs.Tween.get(i,{loop:!0}).to({scaleX:.9,scaleY:.9},850,createjs.Ease.quadOut).to({scaleX:1,scaleY:1},650,createjs.Ease.quadIn)},this._init(e,t,n)}function CMsgBox(e){var t,n,i,o,a,r,s;this._init=function(e){t=[],n=[],(i=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),i.alpha=0,i.on("mousedown",(function(){})),e.addChild(i),(o=new createjs.Container).alpha=0,o.visible=!1,e.addChild(o),e=s_oSpriteLibrary.getSprite("msg_box"),e=(a=createBitmap(e)).getBounds(),a.regX=e.width/2,a.regY=e.height/2,a.x=CANVAS_WIDTH/2,a.y=CANVAS_HEIGHT/2,o.addChild(a),r=new CTLText(o,CANVAS_WIDTH/2-250,CANVAS_HEIGHT/2-50-75,500,150,50,"center","#fff",PRIMARY_FONT,1,0,0," ",!0,!0,!0,!1),e=s_oSpriteLibrary.getSprite("but_home"),(s=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+170,e,o)).addEventListener(ON_MOUSE_DOWN,this._onExit,this)},this.unload=function(){s.unload(),i.removeAllEventListeners(),o.removeAllEventListeners(),e.removeChild(i),e.removeChild(o)},this.addEventListener=function(e,i,o){t[e]=i,n[e]=o},this.show=function(e){playSound("game_over",1,!1),o.visible=!0,r.refreshText(e.toUpperCase()),createjs.Tween.get(i).to({alpha:.7},500),createjs.Tween.get(o).to({alpha:1},500)},this._onExit=function(){t[ON_HOME]&&t[ON_HOME].call(n[ON_HOME])},this.isShown=function(){return o.visible},this._init(e)}