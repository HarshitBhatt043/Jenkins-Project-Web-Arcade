function Path(t){arguments.length>0&&this.init(t)}function arcToCurve(t,e,s,n,a,h,r,o,i,l){var g,u,p,c,m,y=120*Math.PI/180,P=Math.PI/180*(+a||0),v=[],f=function(t,e,s){return{x:t*Math.cos(s)-e*Math.sin(s),y:t*Math.sin(s)+e*Math.cos(s)}};if(l)u=l[0],p=l[1],c=l[2],m=l[3];else{t=(g=f(t,e,-P)).x,e=g.y,o=(g=f(o,i,-P)).x,i=g.y;Math.cos(Math.PI/180*a),Math.sin(Math.PI/180*a);var x=(t-o)/2,w=(e-i)/2,M=x*x/(s*s)+w*w/(n*n);M>1&&(s*=M=Math.sqrt(M),n*=M);var b=s*s,d=n*n,A=(h==r?-1:1)*Math.sqrt(Math.abs((b*d-b*w*w-d*x*x)/(b*w*w+d*x*x)));c=A*s*w/n+(t+o)/2,m=A*-n*x/s+(e+i)/2,u=Math.asin(((e-m)/n).toFixed(9)),p=Math.asin(((i-m)/n).toFixed(9)),u=t<c?Math.PI-u:u,p=o<c?Math.PI-p:p,u=u<0?2*Math.PI+u:u,p=p<0?2*Math.PI+p:p,r&&u>p&&(u-=2*Math.PI),!r&&p>u&&(p-=2*Math.PI)}var k=p-u;if(Math.abs(k)>y){var E=p,R=o,C=i;p=u+y*(r&&p>u?1:-1),v=arcToCurve(o=c+s*Math.cos(p),i=m+n*Math.sin(p),s,n,a,0,r,R,C,[p,E,c,m])}k=p-u;var S=Math.cos(u),I=Math.sin(u),N=Math.cos(p),H=Math.sin(p),z=Math.tan(k/4),L=4/3*s*z,D=4/3*n*z,T=[t,e],O=[t+L*I,e-D*S],B=[o+L*H,i-D*N],U=[o,i];if(O[0]=2*T[0]-O[0],O[1]=2*T[1]-O[1],l)return[O,B,U].concat(v);for(var q=[],$=0,F=(v=[O,B,U].concat(v).join().split(",")).length;$<F;$++)q[$]=$%2?f(v[$-1],v[$],P).y:f(v[$],v[$+1],P).x;return q}Path.prototype=new Shape,Path.prototype.constructor=Path,Path.superclass=Shape.prototype,Path.COMMAND=0,Path.NUMBER=1,Path.EOD=2,Path.PARAMS={A:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],a:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],C:["x1","y1","x2","y2","x","y"],c:["x1","y1","x2","y2","x","y"],H:["x"],h:["x"],L:["x","y"],l:["x","y"],M:["x","y"],m:["x","y"],Q:["x1","y1","x","y"],q:["x1","y1","x","y"],S:["x2","y2","x","y"],s:["x2","y2","x","y"],T:["x","y"],t:["x","y"],V:["y"],v:["y"],Z:[],z:[]},Path.prototype.init=function(t){if(null==t||"path"!=t.localName)throw new Error("Path.init: Invalid localName: "+t.localName);Path.superclass.init.call(this,t),this.segments=null,this.parseData(t.getAttributeNS(null,"d"))},Path.prototype.realize=function(){for(var t=0;t<this.segments.length;t++)this.segments[t].realize();this.svgNode.addEventListener("mousedown",this,!1)},Path.prototype.unrealize=function(){for(var t=0;t<this.segments.length;t++)this.segments[t].unrealize();this.svgNode.removeEventListener("mousedown",this,!1)},Path.prototype.refresh=function(){for(var t=new Array,e=0;e<this.segments.length;e++)t.push(this.segments[e].toString());this.svgNode.setAttributeNS(null,"d",t.join(" "))},Path.prototype.registerHandles=function(){for(var t=0;t<this.segments.length;t++)this.segments[t].registerHandles()},Path.prototype.unregisterHandles=function(){for(var t=0;t<this.segments.length;t++)this.segments[t].unregisterHandles()},Path.prototype.selectHandles=function(t){for(var e=0;e<this.segments.length;e++)this.segments[e].selectHandles(t)},Path.prototype.showHandles=function(t){for(var e=0;e<this.segments.length;e++)this.segments[e].showHandles(t)},Path.prototype.appendPathSegment=function(t){t.previous=this.segments[this.segments.length-1],this.segments.push(t)},Path.prototype.parseData=function(t){var e=this.tokenize(t),s=0,n=e[s],a="BOD";for(this.segments=new Array;!n.typeis(Path.EOD);){var h,r=new Array;if("BOD"==a){if("M"!=n.text&&"m"!=n.text)throw new Error("Path data must begin with a moveto command");s++,h=Path.PARAMS[n.text].length,a=n.text}else n.typeis(Path.NUMBER)?h=Path.PARAMS[a].length:(s++,h=Path.PARAMS[n.text].length,a=n.text);if(!(s+h<e.length))throw new Error("Path data ended before all parameters were found");for(var o=s;o<s+h;o++){var i=e[o];if(!i.typeis(Path.NUMBER))throw new Error("Parameter type is not a number: "+a+","+i.text);r[r.length]=i.text}var l=this.segments.length,g=0==l?null:this.segments[l-1];switch(a){case"A":var u=g.getLastPoint(),p=u.x,c=u.y,m=arcToCurve.apply(this,[p,c].concat(r));for(o=0;o<m.length/6;o++){for(var y=new Array,P=0;P<6;P++)y.push(m.shift());this.segments.push(new AbsoluteCurveto3(y,this,g)),g=this.segments[l-1]}break;case"C":this.segments.push(new AbsoluteCurveto3(r,this,g));break;case"c":this.segments.push(new RelativeCurveto3(r,this,g));break;case"H":this.segments.push(new AbsoluteHLineto(r,this,g));break;case"L":this.segments.push(new AbsoluteLineto(r,this,g));break;case"l":this.segments.push(new RelativeLineto(r,this,g));break;case"M":this.segments.push(new AbsoluteMoveto(r,this,g));break;case"m":this.segments.push(new RelativeMoveto(r,this,g));break;case"Q":this.segments.push(new AbsoluteCurveto2(r,this,g));break;case"q":this.segments.push(new RelativeCurveto2(r,this,g));break;case"S":this.segments.push(new AbsoluteSmoothCurveto3(r,this,g));break;case"s":this.segments.push(new RelativeSmoothCurveto3(r,this,g));break;case"T":this.segments.push(new AbsoluteSmoothCurveto2(r,this,g));break;case"t":this.segments.push(new RelativeSmoothCurveto2(r,this,g));break;case"Z":this.segments.push(new RelativeClosePath(r,this,g));break;case"z":this.segments.push(new RelativeClosePath(r,this,g));break;default:throw new Error("Unsupported segment type: "+a)}n=e[s+=h],"M"==a&&(a="L"),"m"==a&&(a="l")}},Path.prototype.tokenize=function(t){for(var e=new Array;""!=t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]=new Token(Path.COMMAND,RegExp.$1),t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))throw new Error("Unrecognized segment command: "+t);e[e.length]=new Token(Path.NUMBER,parseFloat(RegExp.$1)),t=t.substr(RegExp.$1.length)}return e[e.length]=new Token(Path.EOD,null),e},Path.prototype.intersectShape=function(t){for(var e=new Intersection("No Intersection"),s=0;s<this.segments.length;s++){var n=Intersection.intersectShapes(this.segments[s],t);e.appendPoints(n.points)}return e.points.length>0&&(e.status="Intersection"),e},Path.prototype.getIntersectionParams=function(){return new IntersectionParams("Path",[])};